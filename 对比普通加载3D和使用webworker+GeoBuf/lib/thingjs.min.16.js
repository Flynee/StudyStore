!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.THREE={})}(this,function(e){"use strict";function t(){}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:e>0?1:+e}),"name"in Function.prototype==!1&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),i=1;i<arguments.length;i++){var r=arguments[i];if(null!=r)for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t}),Object.assign(t.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var i=this._listeners[e];if(void 0!==i){var r=i.indexOf(t);-1!==r&&i.splice(r,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var i=t.slice(0),r=0,n=i.length;r<n;r++)i[r].call(this,e)}}}});var i,r,n,o,a,s,l,c,u,h,p,d,f=0,m=1,g=2,v=1,y=2,b=0,_=1,x=2,E=0,w=1,T=2,S=0,M=1,R=2,P=3,A=4,C=5,O=100,L=101,k=102,H=103,j=104,F=200,D=201,B=202,I=203,N=204,U=205,V=206,z=207,q=208,W=209,G=210,X=0,Y=1,Q=2,Z=3,J=4,K=5,$=6,ee=7,te=0,ie=1,re=2,ne=0,oe=1,ae=2,se=3,le=4,ce=5,ue=301,he=302,pe=303,de=304,fe=305,me=306,ge=307,ve=1e3,ye=1001,be=1002,_e=1003,xe=1004,Ee=1005,we=1006,Te=1007,Se=1008,Me=1009,Re=1010,Pe=1011,Ae=1012,Ce=1013,Oe=1014,Le=1015,ke=1016,He=1017,je=1018,Fe=1019,De=1020,Be=1021,Ie=1022,Ne=1023,Ue=1024,Ve=1025,ze=Ne,qe=1026,We=1027,Ge=1028,Xe=33776,Ye=33777,Qe=33778,Ze=33779,Je=35840,Ke=35841,$e=35842,et=35843,tt=36196,it=37808,rt=37809,nt=37810,ot=37811,at=37812,st=37813,lt=37814,ct=37815,ut=37816,ht=37817,pt=37818,dt=37819,ft=37820,mt=37821,gt=2201,vt=2400,yt=0,bt=1,_t=2,xt=3e3,Et=3001,wt=3007,Tt=3002,St=3004,Mt=3005,Rt=3006,Pt=3200,At=3201,Ct=0,Ot=1,Lt={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);return function(){var t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&i]+e[i>>8&255]+"-"+e[i>>16&15|64]+e[i>>24&255]+"-"+e[63&r|128]+e[r>>8&255]+"-"+e[r>>16&255]+e[r>>24&255]+e[255&n]+e[n>>8&255]+e[n>>16&255]+e[n>>24&255]).toUpperCase()}}(),clamp:function(e,t,i){return Math.max(t,Math.min(i,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,i,r,n){return r+(e-t)*(n-r)/(i-t)},lerp:function(e,t,i){return(1-i)*e+i*t},smoothstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*(3-2*e)},smootherstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*Lt.DEG2RAD},radToDeg:function(e){return e*Lt.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}};function kt(e,t){this.x=e||0,this.y=t||0}function Ht(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function jt(e,t,i,r){this._x=e||0,this._y=t||0,this._z=i||0,this._w=void 0!==r?r:1}function Ft(e,t,i){this.x=e||0,this.y=t||0,this.z=i||0}function Dt(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.defineProperties(kt.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(kt.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){var t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:(i=new kt,r=new kt,function(e,t){return i.set(e,e),r.set(t,t),this.clamp(i,r)}),clampLength:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},cross:function(e){return this.x*e.y-this.y*e.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y;return t*t+i*i},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var i=Math.cos(t),r=Math.sin(t),n=this.x-e.x,o=this.y-e.y;return this.x=n*i-o*r+e.x,this.y=n*r+o*i+e.y,this}}),Object.assign(Ht.prototype,{isMatrix4:!0,set:function(e,t,i,r,n,o,a,s,l,c,u,h,p,d,f,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=r,g[1]=n,g[5]=o,g[9]=a,g[13]=s,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=p,g[7]=d,g[11]=f,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new Ht).fromArray(this.elements)},copy:function(e){var t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this},copyPosition:function(e){var t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this},extractBasis:function(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this},extractRotation:(h=new Ft,function(e){var t=this.elements,i=e.elements,r=1/h.setFromMatrixColumn(e,0).length(),n=1/h.setFromMatrixColumn(e,1).length(),o=1/h.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*n,t[5]=i[5]*n,t[6]=i[6]*n,t[7]=0,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}),makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,i=e.x,r=e.y,n=e.z,o=Math.cos(i),a=Math.sin(i),s=Math.cos(r),l=Math.sin(r),c=Math.cos(n),u=Math.sin(n);if("XYZ"===e.order){var h=o*c,p=o*u,d=a*c,f=a*u;t[0]=s*c,t[4]=-s*u,t[8]=l,t[1]=p+d*l,t[5]=h-f*l,t[9]=-a*s,t[2]=f-h*l,t[6]=d+p*l,t[10]=o*s}else if("YXZ"===e.order){var m=s*c,g=s*u,v=l*c,y=l*u;t[0]=m+y*a,t[4]=v*a-g,t[8]=o*l,t[1]=o*u,t[5]=o*c,t[9]=-a,t[2]=g*a-v,t[6]=y+m*a,t[10]=o*s}else if("ZXY"===e.order){m=s*c,g=s*u,v=l*c,y=l*u;t[0]=m-y*a,t[4]=-o*u,t[8]=v+g*a,t[1]=g+v*a,t[5]=o*c,t[9]=y-m*a,t[2]=-o*l,t[6]=a,t[10]=o*s}else if("ZYX"===e.order){h=o*c,p=o*u,d=a*c,f=a*u;t[0]=s*c,t[4]=d*l-p,t[8]=h*l+f,t[1]=s*u,t[5]=f*l+h,t[9]=p*l-d,t[2]=-l,t[6]=a*s,t[10]=o*s}else if("YZX"===e.order){var b=o*s,_=o*l,x=a*s,E=a*l;t[0]=s*c,t[4]=E-b*u,t[8]=x*u+_,t[1]=u,t[5]=o*c,t[9]=-a*c,t[2]=-l*c,t[6]=_*u+x,t[10]=b-E*u}else if("XZY"===e.order){b=o*s,_=o*l,x=a*s,E=a*l;t[0]=s*c,t[4]=-u,t[8]=l*c,t[1]=b*u+E,t[5]=o*c,t[9]=_*u-x,t[2]=x*u-_,t[6]=a*c,t[10]=E*u+b}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:(c=new Ft(0,0,0),u=new Ft(1,1,1),function(e){return this.compose(c,e,u)}),lookAt:(a=new Ft,s=new Ft,l=new Ft,function(e,t,i){var r=this.elements;return l.subVectors(e,t),0===l.lengthSq()&&(l.z=1),l.normalize(),a.crossVectors(i,l),0===a.lengthSq()&&(1===Math.abs(i.z)?l.x+=1e-4:l.z+=1e-4,l.normalize(),a.crossVectors(i,l)),a.normalize(),s.crossVectors(l,a),r[0]=a.x,r[4]=s.x,r[8]=l.x,r[1]=a.y,r[5]=s.y,r[9]=l.y,r[2]=a.z,r[6]=s.z,r[10]=l.z,this}),multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var i=e.elements,r=t.elements,n=this.elements,o=i[0],a=i[4],s=i[8],l=i[12],c=i[1],u=i[5],h=i[9],p=i[13],d=i[2],f=i[6],m=i[10],g=i[14],v=i[3],y=i[7],b=i[11],_=i[15],x=r[0],E=r[4],w=r[8],T=r[12],S=r[1],M=r[5],R=r[9],P=r[13],A=r[2],C=r[6],O=r[10],L=r[14],k=r[3],H=r[7],j=r[11],F=r[15];return n[0]=o*x+a*S+s*A+l*k,n[4]=o*E+a*M+s*C+l*H,n[8]=o*w+a*R+s*O+l*j,n[12]=o*T+a*P+s*L+l*F,n[1]=c*x+u*S+h*A+p*k,n[5]=c*E+u*M+h*C+p*H,n[9]=c*w+u*R+h*O+p*j,n[13]=c*T+u*P+h*L+p*F,n[2]=d*x+f*S+m*A+g*k,n[6]=d*E+f*M+m*C+g*H,n[10]=d*w+f*R+m*O+g*j,n[14]=d*T+f*P+m*L+g*F,n[3]=v*x+y*S+b*A+_*k,n[7]=v*E+y*M+b*C+_*H,n[11]=v*w+y*R+b*O+_*j,n[15]=v*T+y*P+b*L+_*F,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToBufferAttribute:function(){var e=new Ft;return function(t){for(var i=0,r=t.count;i<r;i++)e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.applyMatrix4(this),t.setXYZ(i,e.x,e.y,e.z);return t}}(),determinant:function(){var e=this.elements,t=e[0],i=e[4],r=e[8],n=e[12],o=e[1],a=e[5],s=e[9],l=e[13],c=e[2],u=e[6],h=e[10],p=e[14];return e[3]*(+n*s*u-r*l*u-n*a*h+i*l*h+r*a*p-i*s*p)+e[7]*(+t*s*p-t*l*h+n*o*h-r*o*p+r*l*c-n*s*c)+e[11]*(+t*l*u-t*a*p-n*o*u+i*o*p+n*a*c-i*l*c)+e[15]*(-r*a*c-t*s*u+t*a*h+r*o*u-i*o*h+i*s*c)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var i=this.elements,r=e.elements,n=r[0],o=r[1],a=r[2],s=r[3],l=r[4],c=r[5],u=r[6],h=r[7],p=r[8],d=r[9],f=r[10],m=r[11],g=r[12],v=r[13],y=r[14],b=r[15],_=d*y*h-v*f*h+v*u*m-c*y*m-d*u*b+c*f*b,x=g*f*h-p*y*h-g*u*m+l*y*m+p*u*b-l*f*b,E=p*v*h-g*d*h+g*c*m-l*v*m-p*c*b+l*d*b,w=g*d*u-p*v*u-g*c*f+l*v*f+p*c*y-l*d*y,T=n*_+o*x+a*E+s*w;if(0===T){var S="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(S);return console.warn(S),this.identity()}var M=1/T;return i[0]=_*M,i[1]=(v*f*s-d*y*s-v*a*m+o*y*m+d*a*b-o*f*b)*M,i[2]=(c*y*s-v*u*s+v*a*h-o*y*h-c*a*b+o*u*b)*M,i[3]=(d*u*s-c*f*s-d*a*h+o*f*h+c*a*m-o*u*m)*M,i[4]=x*M,i[5]=(p*y*s-g*f*s+g*a*m-n*y*m-p*a*b+n*f*b)*M,i[6]=(g*u*s-l*y*s-g*a*h+n*y*h+l*a*b-n*u*b)*M,i[7]=(l*f*s-p*u*s+p*a*h-n*f*h-l*a*m+n*u*m)*M,i[8]=E*M,i[9]=(g*d*s-p*v*s-g*o*m+n*v*m+p*o*b-n*d*b)*M,i[10]=(l*v*s-g*c*s+g*o*h-n*v*h-l*o*b+n*c*b)*M,i[11]=(p*c*s-l*d*s-p*o*h+n*d*h+l*o*m-n*c*m)*M,i[12]=w*M,i[13]=(p*v*a-g*d*a+g*o*f-n*v*f-p*o*y+n*d*y)*M,i[14]=(g*c*a-l*v*a-g*o*u+n*v*u+l*o*y-n*c*y)*M,i[15]=(l*d*a-p*c*a+p*o*u-n*d*u-l*o*f+n*c*f)*M,this},scale:function(e){var t=this.elements,i=e.x,r=e.y,n=e.z;return t[0]*=i,t[4]*=r,t[8]*=n,t[1]*=i,t[5]*=r,t[9]*=n,t[2]*=i,t[6]*=r,t[10]*=n,t[3]*=i,t[7]*=r,t[11]*=n,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))},makeTranslation:function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var i=Math.cos(t),r=Math.sin(t),n=1-i,o=e.x,a=e.y,s=e.z,l=n*o,c=n*a;return this.set(l*o+i,l*a-r*s,l*s+r*a,0,l*a+r*s,c*a+i,c*s-r*o,0,l*s-r*a,c*s+r*o,n*s*s+i,0,0,0,0,1),this},makeScale:function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},makeShear:function(e,t,i){return this.set(1,t,i,0,e,1,i,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,i){var r=this.elements,n=t._x,o=t._y,a=t._z,s=t._w,l=n+n,c=o+o,u=a+a,h=n*l,p=n*c,d=n*u,f=o*c,m=o*u,g=a*u,v=s*l,y=s*c,b=s*u,_=i.x,x=i.y,E=i.z;return r[0]=(1-(f+g))*_,r[1]=(p+b)*_,r[2]=(d-y)*_,r[3]=0,r[4]=(p-b)*x,r[5]=(1-(h+g))*x,r[6]=(m+v)*x,r[7]=0,r[8]=(d+y)*E,r[9]=(m-v)*E,r[10]=(1-(h+f))*E,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this},decompose:(n=new Ft,o=new Ht,function(e,t,i){var r=this.elements,a=n.set(r[0],r[1],r[2]).length(),s=n.set(r[4],r[5],r[6]).length(),l=n.set(r[8],r[9],r[10]).length();this.determinant()<0&&(a=-a),e.x=r[12],e.y=r[13],e.z=r[14],o.copy(this);var c=1/a,u=1/s,h=1/l;return o.elements[0]*=c,o.elements[1]*=c,o.elements[2]*=c,o.elements[4]*=u,o.elements[5]*=u,o.elements[6]*=u,o.elements[8]*=h,o.elements[9]*=h,o.elements[10]*=h,t.setFromRotationMatrix(o),i.x=a,i.y=s,i.z=l,this}),makePerspective:function(e,t,i,r,n,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var a=this.elements,s=2*n/(t-e),l=2*n/(i-r),c=(t+e)/(t-e),u=(i+r)/(i-r),h=-(o+n)/(o-n),p=-2*o*n/(o-n);return a[0]=s,a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=l,a[9]=u,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makeOrthographic:function(e,t,i,r,n,o){var a=this.elements,s=1/(t-e),l=1/(i-r),c=1/(o-n),u=(t+e)*s,h=(i+r)*l,p=(o+n)*c;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-u,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2*c,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},equals:function(e){for(var t=this.elements,i=e.elements,r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var i=0;i<16;i++)this.elements[i]=e[i+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}),Object.assign(jt,{slerp:function(e,t,i,r){return i.copy(e).slerp(t,r)},slerpFlat:function(e,t,i,r,n,o,a){var s=i[r+0],l=i[r+1],c=i[r+2],u=i[r+3],h=n[o+0],p=n[o+1],d=n[o+2],f=n[o+3];if(u!==f||s!==h||l!==p||c!==d){var m=1-a,g=s*h+l*p+c*d+u*f,v=g>=0?1:-1,y=1-g*g;if(y>Number.EPSILON){var b=Math.sqrt(y),_=Math.atan2(b,g*v);m=Math.sin(m*_)/b,a=Math.sin(a*_)/b}var x=a*v;if(s=s*m+h*x,l=l*m+p*x,c=c*m+d*x,u=u*m+f*x,m===1-a){var E=1/Math.sqrt(s*s+l*l+c*c+u*u);s*=E,l*=E,c*=E,u*=E}}e[t]=s,e[t+1]=l,e[t+2]=c,e[t+3]=u}}),Object.defineProperties(jt.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this.onChangeCallback()}}}),Object.assign(jt.prototype,{isQuaternion:!0,set:function(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var i=e._x,r=e._y,n=e._z,o=e.order,a=Math.cos,s=Math.sin,l=a(i/2),c=a(r/2),u=a(n/2),h=s(i/2),p=s(r/2),d=s(n/2);return"XYZ"===o?(this._x=h*c*u+l*p*d,this._y=l*p*u-h*c*d,this._z=l*c*d+h*p*u,this._w=l*c*u-h*p*d):"YXZ"===o?(this._x=h*c*u+l*p*d,this._y=l*p*u-h*c*d,this._z=l*c*d-h*p*u,this._w=l*c*u+h*p*d):"ZXY"===o?(this._x=h*c*u-l*p*d,this._y=l*p*u+h*c*d,this._z=l*c*d+h*p*u,this._w=l*c*u-h*p*d):"ZYX"===o?(this._x=h*c*u-l*p*d,this._y=l*p*u+h*c*d,this._z=l*c*d-h*p*u,this._w=l*c*u+h*p*d):"YZX"===o?(this._x=h*c*u+l*p*d,this._y=l*p*u+h*c*d,this._z=l*c*d-h*p*u,this._w=l*c*u-h*p*d):"XZY"===o&&(this._x=h*c*u-l*p*d,this._y=l*p*u-h*c*d,this._z=l*c*d+h*p*u,this._w=l*c*u+h*p*d),!1!==t&&this.onChangeCallback(),this},setFromAxisAngle:function(e,t){var i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this.onChangeCallback(),this},setFromRotationMatrix:function(e){var t,i=e.elements,r=i[0],n=i[4],o=i[8],a=i[1],s=i[5],l=i[9],c=i[2],u=i[6],h=i[10],p=r+s+h;return p>0?(t=.5/Math.sqrt(p+1),this._w=.25/t,this._x=(u-l)*t,this._y=(o-c)*t,this._z=(a-n)*t):r>s&&r>h?(t=2*Math.sqrt(1+r-s-h),this._w=(u-l)/t,this._x=.25*t,this._y=(n+a)/t,this._z=(o+c)/t):s>h?(t=2*Math.sqrt(1+s-r-h),this._w=(o-c)/t,this._x=(n+a)/t,this._y=.25*t,this._z=(l+u)/t):(t=2*Math.sqrt(1+h-r-s),this._w=(a-n)/t,this._x=(o+c)/t,this._y=(l+u)/t,this._z=.25*t),this.onChangeCallback(),this},setFromUnitVectors:function(){var e,t=new Ft;return function(i,r){return void 0===t&&(t=new Ft),(e=i.dot(r)+1)<1e-6?(e=0,Math.abs(i.x)>Math.abs(i.z)?t.set(-i.y,i.x,0):t.set(0,-i.z,i.y)):t.crossVectors(i,r),this._x=t.x,this._y=t.y,this._z=t.z,this._w=e,this.normalize()}}(),angleTo:function(e){return 2*Math.acos(Math.abs(Lt.clamp(this.dot(e),-1,1)))},rotateTowards:function(e,t){var i=this.angleTo(e);if(0===i)return this;var r=Math.min(1,t/i);return this.slerp(e,r),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var i=e._x,r=e._y,n=e._z,o=e._w,a=t._x,s=t._y,l=t._z,c=t._w;return this._x=i*c+o*a+r*l-n*s,this._y=r*c+o*s+n*a-i*l,this._z=n*c+o*l+i*s-r*a,this._w=o*c-i*a-r*s-n*l,this.onChangeCallback(),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var i=this._x,r=this._y,n=this._z,o=this._w,a=o*e._w+i*e._x+r*e._y+n*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=i,this._y=r,this._z=n,this;var s=1-a*a;if(s<=Number.EPSILON){var l=1-t;return this._w=l*o+t*this._w,this._x=l*i+t*this._x,this._y=l*r+t*this._y,this._z=l*n+t*this._z,this.normalize()}var c=Math.sqrt(s),u=Math.atan2(c,a),h=Math.sin((1-t)*u)/c,p=Math.sin(t*u)/c;return this._w=o*h+this._w*p,this._x=i*h+this._x*p,this._y=r*h+this._y*p,this._z=n*h+this._z*p,this.onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}}),Object.assign(Ft.prototype,{isVector3:!0,set:function(e,t,i){return this.x=e,this.y=t,this.z=i,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:(p=new jt,function(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(p.setFromEuler(e))}),applyAxisAngle:function(){var e=new jt;return function(t,i){return this.applyQuaternion(e.setFromAxisAngle(t,i))}}(),applyMatrix3:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6]*r,this.y=n[1]*t+n[4]*i+n[7]*r,this.z=n[2]*t+n[5]*i+n[8]*r,this},applyMatrix4:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements,o=1/(n[3]*t+n[7]*i+n[11]*r+n[15]);return this.x=(n[0]*t+n[4]*i+n[8]*r+n[12])*o,this.y=(n[1]*t+n[5]*i+n[9]*r+n[13])*o,this.z=(n[2]*t+n[6]*i+n[10]*r+n[14])*o,this},applyQuaternion:function(e){var t=this.x,i=this.y,r=this.z,n=e.x,o=e.y,a=e.z,s=e.w,l=s*t+o*r-a*i,c=s*i+a*t-n*r,u=s*r+n*i-o*t,h=-n*t-o*i-a*r;return this.x=l*s+h*-n+c*-a-u*-o,this.y=c*s+h*-o+u*-n-l*-a,this.z=u*s+h*-a+l*-o-c*-n,this},project:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},unproject:function(){var e=new Ht;return function(t){return this.applyMatrix4(e.getInverse(t.projectionMatrix)).applyMatrix4(t.matrixWorld)}}(),transformDirection:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*r,this.y=n[1]*t+n[5]*i+n[9]*r,this.z=n[2]*t+n[6]*i+n[10]*r,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(){var e=new Ft,t=new Ft;return function(i,r){return e.set(i,i,i),t.set(r,r,r),this.clamp(e,t)}}(),clampLength:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)},cross:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},crossVectors:function(e,t){var i=e.x,r=e.y,n=e.z,o=t.x,a=t.y,s=t.z;return this.x=r*s-n*a,this.y=n*o-i*s,this.z=i*a-r*o,this},projectOnVector:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)},projectOnPlane:function(){var e=new Ft;return function(t){return e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e=new Ft;return function(t){return this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){var t=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq());return Math.acos(Lt.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)},setFromSphericalCoords:function(e,t,i){var r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this},setFromCylindrical:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)},setFromCylindricalCoords:function(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this},setFromMatrixPosition:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,4*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}}),Object.assign(Dt.prototype,{isMatrix3:!0,set:function(e,t,i,r,n,o,a,s,l){var c=this.elements;return c[0]=e,c[1]=r,c[2]=a,c[3]=t,c[4]=n,c[5]=s,c[6]=i,c[7]=o,c[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this},setFromMatrix4:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},applyToBufferAttribute:function(){var e=new Ft;return function(t){for(var i=0,r=t.count;i<r;i++)e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.applyMatrix3(this),t.setXYZ(i,e.x,e.y,e.z);return t}}(),multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var i=e.elements,r=t.elements,n=this.elements,o=i[0],a=i[3],s=i[6],l=i[1],c=i[4],u=i[7],h=i[2],p=i[5],d=i[8],f=r[0],m=r[3],g=r[6],v=r[1],y=r[4],b=r[7],_=r[2],x=r[5],E=r[8];return n[0]=o*f+a*v+s*_,n[3]=o*m+a*y+s*x,n[6]=o*g+a*b+s*E,n[1]=l*f+c*v+u*_,n[4]=l*m+c*y+u*x,n[7]=l*g+c*b+u*E,n[2]=h*f+p*v+d*_,n[5]=h*m+p*y+d*x,n[8]=h*g+p*b+d*E,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],o=e[4],a=e[5],s=e[6],l=e[7],c=e[8];return t*o*c-t*a*l-i*n*c+i*a*s+r*n*l-r*o*s},getInverse:function(e,t){e&&e.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var i=e.elements,r=this.elements,n=i[0],o=i[1],a=i[2],s=i[3],l=i[4],c=i[5],u=i[6],h=i[7],p=i[8],d=p*l-c*h,f=c*u-p*s,m=h*s-l*u,g=n*d+o*f+a*m;if(0===g){var v="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(v);return console.warn(v),this.identity()}var y=1/g;return r[0]=d*y,r[1]=(a*h-p*o)*y,r[2]=(c*o-a*l)*y,r[3]=f*y,r[4]=(p*n-a*u)*y,r[5]=(a*s-c*n)*y,r[6]=m*y,r[7]=(o*u-h*n)*y,r[8]=(l*n-o*s)*y,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function(e,t,i,r,n,o,a){var s=Math.cos(n),l=Math.sin(n);this.set(i*s,i*l,-i*(s*o+l*a)+o+e,-r*l,r*s,-r*(-l*o+s*a)+a+t,0,0,1)},scale:function(e,t){var i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=t,i[4]*=t,i[7]*=t,this},rotate:function(e){var t=Math.cos(e),i=Math.sin(e),r=this.elements,n=r[0],o=r[3],a=r[6],s=r[1],l=r[4],c=r[7];return r[0]=t*n+i*s,r[3]=t*o+i*l,r[6]=t*a+i*c,r[1]=-i*n+t*s,r[4]=-i*o+t*l,r[7]=-i*a+t*c,this},translate:function(e,t){var i=this.elements;return i[0]+=e*i[2],i[3]+=e*i[5],i[6]+=e*i[8],i[1]+=t*i[2],i[4]+=t*i[5],i[7]+=t*i[8],this},equals:function(e){for(var t=this.elements,i=e.elements,r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var i=0;i<9;i++)this.elements[i]=e[i+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}});var Bt,It,Nt,Ut,Vt,zt={getDataURL:function(e){var t;if("undefined"==typeof HTMLCanvasElement)return e.src;if(e instanceof HTMLCanvasElement)t=e;else{void 0===d&&(d=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),d.width=e.width,d.height=e.height;var i=d.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=d}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}},qt=0;function Wt(e,t,i,r,n,o,a,s,l,c){Object.defineProperty(this,"id",{value:qt++}),this.uuid=Lt.generateUUID(),this.name="",this.image=void 0!==e?e:Wt.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:Wt.DEFAULT_MAPPING,this.wrapS=void 0!==i?i:ye,this.wrapT=void 0!==r?r:ye,this.magFilter=void 0!==n?n:we,this.minFilter=void 0!==o?o:Se,this.anisotropy=void 0!==l?l:1,this.format=void 0!==a?a:Ne,this.type=void 0!==s?s:Me,this.offset=new kt(0,0),this.repeat=new kt(1,1),this.center=new kt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Dt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==c?c:xt,this.version=0,this.onUpdate=null}function Gt(e,t,i,r){this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0!==r?r:1}function Xt(e,t,i){this.width=e,this.height=t,this.scissor=new Gt(0,0,e,t),this.scissorTest=!1,this.viewport=new Gt(0,0,e,t),i=i||{},this.texture=new Wt(void 0,void 0,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:we,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0===i.stencilBuffer||i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null}function Yt(e,t,i){Xt.call(this,e,t,i),this.samples=4}function Qt(e,t,i){Xt.call(this,e,t,i),this.activeCubeFace=0,this.activeMipMapLevel=0}function Zt(e,t,i,r,n,o,a,s,l,c,u,h){Wt.call(this,null,o,a,s,l,c,r,n,u,h),this.image={data:e,width:t,height:i},this.magFilter=void 0!==l?l:_e,this.minFilter=void 0!==c?c:_e,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}function Jt(e,t){this.min=void 0!==e?e:new Ft(1/0,1/0,1/0),this.max=void 0!==t?t:new Ft(-1/0,-1/0,-1/0)}function Kt(e,t){this.center=void 0!==e?e:new Ft,this.radius=void 0!==t?t:0}function $t(e,t){this.normal=void 0!==e?e:new Ft(1,0,0),this.constant=void 0!==t?t:0}function ei(e,t,i,r,n,o){this.planes=[void 0!==e?e:new $t,void 0!==t?t:new $t,void 0!==i?i:new $t,void 0!==r?r:new $t,void 0!==n?n:new $t,void 0!==o?o:new $t]}Wt.DEFAULT_IMAGE=void 0,Wt.DEFAULT_MAPPING=300,Wt.prototype=Object.assign(Object.create(t.prototype),{constructor:Wt,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var r=this.image;if(void 0===r.uuid&&(r.uuid=Lt.generateUUID()),!t&&void 0===e.images[r.uuid]){var n;if(Array.isArray(r)){n=[];for(var o=0,a=r.length;o<a;o++)n.push(zt.getDataURL(r[o]))}else n=zt.getDataURL(r);e.images[r.uuid]={uuid:r.uuid,url:n}}i.image=r.uuid}return t||(e.textures[this.uuid]=i),i},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case ve:e.x=e.x-Math.floor(e.x);break;case ye:e.x=e.x<0?0:1;break;case be:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case ve:e.y=e.y-Math.floor(e.y);break;case ye:e.y=e.y<0?0:1;break;case be:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(Wt.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(Gt.prototype,{isVector4:!0,set:function(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,i=this.y,r=this.z,n=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*r+o[12]*n,this.y=o[1]*t+o[5]*i+o[9]*r+o[13]*n,this.z=o[2]*t+o[6]*i+o[10]*r+o[14]*n,this.w=o[3]*t+o[7]*i+o[11]*r+o[15]*n,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,i,r,n,o=e.elements,a=o[0],s=o[4],l=o[8],c=o[1],u=o[5],h=o[9],p=o[2],d=o[6],f=o[10];if(Math.abs(s-c)<.01&&Math.abs(l-p)<.01&&Math.abs(h-d)<.01){if(Math.abs(s+c)<.1&&Math.abs(l+p)<.1&&Math.abs(h+d)<.1&&Math.abs(a+u+f-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var m=(a+1)/2,g=(u+1)/2,v=(f+1)/2,y=(s+c)/4,b=(l+p)/4,_=(h+d)/4;return m>g&&m>v?m<.01?(i=0,r=.707106781,n=.707106781):(r=y/(i=Math.sqrt(m)),n=b/i):g>v?g<.01?(i=.707106781,r=0,n=.707106781):(i=y/(r=Math.sqrt(g)),n=_/r):v<.01?(i=.707106781,r=.707106781,n=0):(i=b/(n=Math.sqrt(v)),r=_/n),this.set(i,r,n,t),this}var x=Math.sqrt((d-h)*(d-h)+(l-p)*(l-p)+(c-s)*(c-s));return Math.abs(x)<.001&&(x=1),this.x=(d-h)/x,this.y=(l-p)/x,this.z=(c-s)/x,this.w=Math.acos((a+u+f-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(){var e,t;return function(i,r){return void 0===e&&(e=new Gt,t=new Gt),e.set(i,i,i,i),t.set(r,r,r,r),this.clamp(e,t)}}(),clampLength:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,i){return void 0!==i&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}}),Xt.prototype=Object.assign(Object.create(t.prototype),{constructor:Xt,isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Yt.prototype=Object.assign(Object.create(Xt.prototype),{constructor:Yt,isWebGLMultisampleRenderTarget:!0,copy:function(e){return Xt.prototype.copy.call(this,e),this.samples=e.samples,this}}),Qt.prototype=Object.create(Xt.prototype),Qt.prototype.constructor=Qt,Qt.prototype.isWebGLRenderTargetCube=!0,Zt.prototype=Object.create(Wt.prototype),Zt.prototype.constructor=Zt,Zt.prototype.isDataTexture=!0,Object.assign(Jt.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=1/0,i=1/0,r=1/0,n=-1/0,o=-1/0,a=-1/0,s=0,l=e.length;s<l;s+=3){var c=e[s],u=e[s+1],h=e[s+2];c<t&&(t=c),u<i&&(i=u),h<r&&(r=h),c>n&&(n=c),u>o&&(o=u),h>a&&(a=h)}return this.min.set(t,i,r),this.max.set(n,o,a),this},setFromBufferAttribute:function(e){for(var t=1/0,i=1/0,r=1/0,n=-1/0,o=-1/0,a=-1/0,s=0,l=e.count;s<l;s++){var c=e.getX(s),u=e.getY(s),h=e.getZ(s);c<t&&(t=c),u<i&&(i=u),h<r&&(r=h),c>n&&(n=c),u>o&&(o=u),h>a&&(a=h)}return this.min.set(t,i,r),this.max.set(n,o,a),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new Ft;return function(t,i){var r=e.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}}(),setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new Ft),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new Ft),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(){var e,t,i,r=new Ft;function n(n){var o=n.geometry;if(void 0!==o)if(o.isGeometry){var a=o.vertices;for(t=0,i=a.length;t<i;t++)r.copy(a[t]),r.applyMatrix4(n.matrixWorld),e.expandByPoint(r)}else if(o.isBufferGeometry){var s=o.attributes.position;if(void 0!==s)for(t=0,i=s.count;t<i;t++)r.fromBufferAttribute(s,t).applyMatrix4(n.matrixWorld),e.expandByPoint(r)}}return function(t){return e=this,t.updateMatrixWorld(!0),t.traverse(n),this}}(),containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new Ft),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:(It=new Ft,function(e){return this.clampPoint(e.center,It),It.distanceToSquared(e.center)<=e.radius*e.radius}),intersectsPlane:function(e){var t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant},intersectsTriangle:function(){var e=new Ft,t=new Ft,i=new Ft,r=new Ft,n=new Ft,o=new Ft,a=new Ft,s=new Ft,l=new Ft,c=new Ft;function u(r){var n,o;for(n=0,o=r.length-3;n<=o;n+=3){a.fromArray(r,n);var s=l.x*Math.abs(a.x)+l.y*Math.abs(a.y)+l.z*Math.abs(a.z),c=e.dot(a),u=t.dot(a),h=i.dot(a);if(Math.max(-Math.max(c,u,h),Math.min(c,u,h))>s)return!1}return!0}return function(a){if(this.isEmpty())return!1;this.getCenter(s),l.subVectors(this.max,s),e.subVectors(a.a,s),t.subVectors(a.b,s),i.subVectors(a.c,s),r.subVectors(t,e),n.subVectors(i,t),o.subVectors(e,i);var h=[0,-r.z,r.y,0,-n.z,n.y,0,-o.z,o.y,r.z,0,-r.x,n.z,0,-n.x,o.z,0,-o.x,-r.y,r.x,0,-n.y,n.x,0,-o.y,o.x,0];return!!u(h)&&(!!u(h=[1,0,0,0,1,0,0,0,1])&&(c.crossVectors(r,n),u(h=[c.x,c.y,c.z])))}}(),clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new Ft),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new Ft;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),getBoundingSphere:function(){var e=new Ft;return function(t){return void 0===t&&(console.warn("THREE.Box3: .getBoundingSphere() target is now required"),t=new Kt),this.getCenter(t.center),t.radius=.5*this.getSize(e).length(),t}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:(Bt=[new Ft,new Ft,new Ft,new Ft,new Ft,new Ft,new Ft,new Ft],function(e){return this.isEmpty()?this:(Bt[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Bt[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Bt[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Bt[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Bt[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Bt[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Bt[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Bt[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Bt),this)}),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),Object.assign(Kt.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:(Nt=new Jt,function(e,t){var i=this.center;void 0!==t?i.copy(t):Nt.setFromPoints(e).getCenter(i);for(var r=0,n=0,o=e.length;n<o;n++)r=Math.max(r,i.distanceToSquared(e[n]));return this.radius=Math.sqrt(r),this}),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var i=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new Ft),t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},getBoundingBox:function(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new Jt),e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}}),Object.assign($t.prototype,{set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new Ft,t=new Ft;return function(i,r,n){var o=e.subVectors(n,r).cross(t.subVectors(i,r)).normalize();return this.setFromNormalAndCoplanarPoint(o,i),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new Ft),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(){var e=new Ft;return function(t,i){void 0===i&&(console.warn("THREE.Plane: .intersectLine() target is now required"),i=new Ft);var r=t.delta(e),n=this.normal.dot(r);if(0===n)return 0===this.distanceToPoint(t.start)?i.copy(t.start):void 0;var o=-(t.start.dot(this.normal)+this.constant)/n;return o<0||o>1?void 0:i.copy(r).multiplyScalar(o).add(t.start)}}(),intersectsLine:function(e){var t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new Ft),e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new Ft,t=new Dt;return function(i,r){var n=r||t.getNormalMatrix(i),o=this.coplanarPoint(e).applyMatrix4(i),a=this.normal.applyMatrix3(n).normalize();return this.constant=-o.dot(a),this}}(),translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}),Object.assign(ei.prototype,{set:function(e,t,i,r,n,o){var a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(r),a[4].copy(n),a[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){for(var t=this.planes,i=0;i<6;i++)t[i].copy(e.planes[i]);return this},setFromMatrix:function(e){var t=this.planes,i=e.elements,r=i[0],n=i[1],o=i[2],a=i[3],s=i[4],l=i[5],c=i[6],u=i[7],h=i[8],p=i[9],d=i[10],f=i[11],m=i[12],g=i[13],v=i[14],y=i[15];return t[0].setComponents(a-r,u-s,f-h,y-m).normalize(),t[1].setComponents(a+r,u+s,f+h,y+m).normalize(),t[2].setComponents(a+n,u+l,f+p,y+g).normalize(),t[3].setComponents(a-n,u-l,f-p,y-g).normalize(),t[4].setComponents(a-o,u-c,f-d,y-v).normalize(),t[5].setComponents(a+o,u+c,f+d,y+v).normalize(),this},intersectsObject:(Vt=new Kt,function(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),Vt.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Vt)}),intersectsSprite:function(){var e=new Kt;return function(t){return e.center.set(0,0,0),e.radius=.7071067811865476,e.applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function(e){for(var t=this.planes,i=e.center,r=-e.radius,n=0;n<6;n++){if(t[n].distanceToPoint(i)<r)return!1}return!0},intersectsBox:(Ut=new Ft,function(e){for(var t=this.planes,i=0;i<6;i++){var r=t[i];if(Ut.x=r.normal.x>0?e.max.x:e.min.x,Ut.y=r.normal.y>0?e.max.y:e.min.y,Ut.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(Ut)<0)return!1}return!0}),containsPoint:function(e){for(var t=this.planes,i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}});var ti={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) {\n\t\tdiscard;\n\t} else {\n\t\tdiffuseColor.a = opacity;\n\t}\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"#ifdef USE_CARTESIAN3\n    vec3 transformed = czm_converPosition(position);\n#else\n    vec3 transformed = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick( specularColor, dotNV );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvarying vec3 vViewPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nvec3 czm_converPosition(vec3 origin) {\n   vec3 res = vec3(0.0);\n       res.x = -origin.x;\n       res.y = origin.z;\n       res.z = origin.y;\n       return res;\n}\nvec3 applyQuaternion (vec3 v, vec4 q){\n        float ix = q.w * v.x + q.y * v.z - q.z * v.y;\n\t\tfloat iy = q.w * v.y + q.z * v.x - q.x * v.z;\n\t\tfloat iz = q.w * v.z + q.x * v.y - q.y * v.x;\n\t\tfloat iw = - q.x * v.x - q.y * v.y - q.z * v.z;\n\t\treturn vec3(ix * q.w + iw * (-q.x) + iy * (-q.z) - iz * (-q.y),\n\t\t            iy * q.w + iw * (-q.y) + iz * (-q.x) - ix * (-q.z),\n\t\t            iz * q.w + iw * (-q.z) + ix * (-q.y) - iy * (-q.x)\n\t\t);\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV( sampler2D envMap, vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = normalMatrix * objectNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t\n\t\t   #ifdef  BASE_QUATERNION\n\t\t        vec3 newNormal = applyQuaternion(worldNormal, baseQuaternion);\n\t\t    #endif\n\t\t#ifdef ENVMAP_TYPE_CUBE\n            #ifdef  BASE_QUATERNION\n                vec3 queryVec = vec3( flipEnvMap * newNormal.x, newNormal.yz );\n            #else\n                vec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n            #endif\n\t\t\t\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n             #ifdef  BASE_QUATERNION\n                vec3 queryVec = vec3( flipEnvMap * newNormal.x, newNormal.yz );\n              #else\n                vec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n              #endif\n    \n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n          \n\t    #ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\n\t\t#ifdef  BASE_QUATERNION\n\t\t        reflectVec = applyQuaternion(reflectVec, baseQuaternion);\n\t\t#endif \n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent ));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif",lights_pars_begin:"uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#endif\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\tfloat clearCoatInv = 1.0 - clearCoatDHR;\n\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec3 singleScattering = vec3( 0.0 );\n\t\tvec3 multiScattering = vec3( 0.0 );\n\t\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\t\tvec3 diffuse = material.diffuseColor;\n\t\treflectedLight.indirectSpecular += clearCoatInv * radiance * singleScattering;\n\t\treflectedLight.indirectDiffuse += multiScattering * cosineWeightedIrradiance;\n\t\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n\t#else\n\t\treflectedLight.indirectSpecular += clearCoatInv * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#endif\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearCoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), maxMipLevel );\n\t#ifndef STANDARD\n\t\tclearCoatRadiance += getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, irradiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\tgl_Position.z *= gl_Position.w;\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform mat3 uvTransform;\n\tuniform sampler2D map;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n#endif",normal_fragment_maps:"#ifdef USE_NORMALMAP\n\t#ifdef OBJECTSPACE_NORMALMAP\n\t\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t#ifdef FLIP_SIDED\n\t\t\tnormal = - normal;\n\t\t#endif\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\tnormal = normalize( normalMatrix * normal );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\t#ifdef OBJECTSPACE_NORMALMAP\n\t\tuniform mat3 normalMatrix;\n\t#else\n\t\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\t\tvec2 st0 = dFdx( vUv.st );\n\t\t\tvec2 st1 = dFdy( vUv.st );\n\t\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\t\tvec3 N = normalize( surf_norm );\n\t\t\tmat3 tsn = mat3( S, T, N );\n\t\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t\tmapN.xy *= normalScale;\n\t\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\treturn normalize( tsn * mapN );\n\t\t}\n\t#endif\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#if defined( DITHERING )\n  gl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#if defined( DITHERING )\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform mat4 localBindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( localBindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n\t#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );\n}",uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n#endif",colormapping_fragment:"#ifdef COLOR_MAPPING\n    float gray = clamp( dot( diffuseColor.rgb, vec3(0.333, 0.333, 0.333) ), 0.0, 1.0 );\n    diffuseColor.rgb = texture2D( colorMapping, vec2( gray, 0.5 ) ).rgb;\n  #endif",colormapping_pars_fragment:"#ifdef COLOR_MAPPING\n    uniform sampler2D colorMapping;\n  #endif",baseQuaternion_pars_fragment:"#ifdef BASE_QUATERNION\n    uniform vec4 baseQuaternion;\n  #endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nuniform mat4 colorMatrix;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = colorMatrix * mapTexelToLinear( texColor );\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n#include <colormapping_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <colormapping_fragment>\n\t\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n#include <colormapping_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <colormapping_fragment>\n\t\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n#include <colormapping_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <colormapping_fragment>\n\t\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_pars_fragment>\n#include <baseQuaternion_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n#include <colormapping_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <colormapping_fragment>\n\t\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"};function ii(e){var t={};for(var i in e)for(var r in t[i]={},e[i]){var n=e[i][r];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4)?t[i][r]=n.clone():Array.isArray(n)?t[i][r]=n.slice():t[i][r]=n}return t}function ri(e){for(var t={},i=0;i<e.length;i++){var r=ii(e[i]);for(var n in r)t[n]=r[n]}return t}var ni,oi,ai,si={clone:ii,merge:ri},li={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function ci(e,t,i){return void 0===t&&void 0===i?this.set(e):this.setRGB(e,t,i)}Object.assign(ci.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setScalar:function(e){return this.r=e,this.g=e,this.b=e,this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,i){return this.r=e,this.g=t,this.b=i,this},setHSL:function(){function e(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+6*(t-e)*(2/3-i):e}return function(t,i,r){if(t=Lt.euclideanModulo(t,1),i=Lt.clamp(i,0,1),r=Lt.clamp(r,0,1),0===i)this.r=this.g=this.b=r;else{var n=r<=.5?r*(1+i):r+i-r*i,o=2*r-n;this.r=e(o,n,t+1/3),this.g=e(o,n,t),this.b=e(o,n,t-1/3)}return this}}(),setStyle:function(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var i;if(i=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var r,n=i[1],o=i[2];switch(n){case"rgb":case"rgba":if(r=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,t(r[5]),this;if(r=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,t(r[5]),this;break;case"hsl":case"hsla":if(r=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o)){var a=parseFloat(r[1])/360,s=parseInt(r[2],10)/100,l=parseInt(r[3],10)/100;return t(r[5]),this.setHSL(a,s,l)}}}else if(i=/^\#([A-Fa-f0-9]+)$/.exec(e)){var c,u=(c=i[1]).length;if(3===u)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,this;if(6===u)return this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,this}e&&e.length>0&&(void 0!==(c=li[e])?this.setHex(c):console.warn("THREE.Color: Unknown color "+e));return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var i=t>0?1/t:1;return this.r=Math.pow(e.r,i),this.g=Math.pow(e.g,i),this.b=Math.pow(e.b,i),this},convertGammaToLinear:function(e){return this.copyGammaToLinear(this,e),this},convertLinearToGamma:function(e){return this.copyLinearToGamma(this,e),this},copySRGBToLinear:function(){function e(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}return function(t){return this.r=e(t.r),this.g=e(t.g),this.b=e(t.b),this}}(),copyLinearToSRGB:function(){function e(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}return function(t){return this.r=e(t.r),this.g=e(t.g),this.b=e(t.b),this}}(),convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t,i,r=this.r,n=this.g,o=this.b,a=Math.max(r,n,o),s=Math.min(r,n,o),l=(s+a)/2;if(s===a)t=0,i=0;else{var c=a-s;switch(i=l<=.5?c/(a+s):c/(2-a-s),a){case r:t=(n-o)/c+(n<o?6:0);break;case n:t=(o-r)/c+2;break;case o:t=(r-n)/c+4}t/=6}return e.h=t,e.s=i,e.l=l,e},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:(ai={},function(e,t,i){return this.getHSL(ai),ai.h+=e,ai.s+=t,ai.l+=i,this.setHSL(ai.h,ai.s,ai.l),this}),add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},lerpHSL:(ni={h:0,s:0,l:0},oi={h:0,s:0,l:0},function(e,t){this.getHSL(ni),e.getHSL(oi);var i=Lt.lerp(ni.h,oi.h,t),r=Lt.lerp(ni.s,oi.s,t),n=Lt.lerp(ni.l,oi.l,t);return this.setHSL(i,r,n),this}),equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()},getColorKeyword:function(){return li}});var ui,hi={common:{diffuse:{value:new ci(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Dt},uvTransform1:{value:new Dt},uvTransform2:{value:new Dt},alphaMap:{value:null},alphaMap1:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new kt(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ci(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new ci(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new Dt}},sprite:{diffuse:{value:new ci(15658734)},opacity:{value:1},center:{value:new kt(.5,.5)},rotation:{value:0},map:{value:null},uvTransform:{value:new Dt}}},pi={basic:{uniforms:ri([hi.common,hi.specularmap,hi.envmap,hi.aomap,hi.lightmap,hi.fog]),vertexShader:ti.meshbasic_vert,fragmentShader:ti.meshbasic_frag},lambert:{uniforms:ri([hi.common,hi.specularmap,hi.envmap,hi.aomap,hi.lightmap,hi.emissivemap,hi.fog,hi.lights,{emissive:{value:new ci(0)}}]),vertexShader:ti.meshlambert_vert,fragmentShader:ti.meshlambert_frag},phong:{uniforms:ri([hi.common,hi.specularmap,hi.envmap,hi.aomap,hi.lightmap,hi.emissivemap,hi.bumpmap,hi.normalmap,hi.displacementmap,hi.gradientmap,hi.fog,hi.lights,{emissive:{value:new ci(0)},specular:{value:new ci(1118481)},shininess:{value:30}}]),vertexShader:ti.meshphong_vert,fragmentShader:ti.meshphong_frag},standard:{uniforms:ri([hi.common,hi.envmap,hi.aomap,hi.lightmap,hi.emissivemap,hi.bumpmap,hi.normalmap,hi.displacementmap,hi.roughnessmap,hi.metalnessmap,hi.fog,hi.lights,{emissive:{value:new ci(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:ti.meshphysical_vert,fragmentShader:ti.meshphysical_frag},matcap:{uniforms:ri([hi.common,hi.bumpmap,hi.normalmap,hi.displacementmap,hi.fog,{matcap:{value:null}}]),vertexShader:ti.meshmatcap_vert,fragmentShader:ti.meshmatcap_frag},points:{uniforms:ri([hi.points,hi.fog]),vertexShader:ti.points_vert,fragmentShader:ti.points_frag},dashed:{uniforms:ri([hi.common,hi.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ti.linedashed_vert,fragmentShader:ti.linedashed_frag},depth:{uniforms:ri([hi.common,hi.displacementmap]),vertexShader:ti.depth_vert,fragmentShader:ti.depth_frag},normal:{uniforms:ri([hi.common,hi.bumpmap,hi.normalmap,hi.displacementmap,{opacity:{value:1}}]),vertexShader:ti.normal_vert,fragmentShader:ti.normal_frag},sprite:{uniforms:ri([hi.sprite,hi.fog]),vertexShader:ti.sprite_vert,fragmentShader:ti.sprite_frag},background:{uniforms:{uvTransform:{value:new Dt},t2D:{value:null}},vertexShader:ti.background_vert,fragmentShader:ti.background_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1},colorMatrix:{value:new Ht}},vertexShader:ti.cube_vert,fragmentShader:ti.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ti.equirect_vert,fragmentShader:ti.equirect_frag},distanceRGBA:{uniforms:ri([hi.common,hi.displacementmap,{referencePosition:{value:new Ft},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ti.distanceRGBA_vert,fragmentShader:ti.distanceRGBA_frag},shadow:{uniforms:ri([hi.lights,hi.fog,{color:{value:new ci(0)},opacity:{value:1}}]),vertexShader:ti.shadow_vert,fragmentShader:ti.shadow_frag}};function di(){var e=null,t=!1,i=null;function r(n,o){!1!==t&&(i(n,o),e.requestAnimationFrame(r))}return{start:function(){!0!==t&&null!==i&&(e.requestAnimationFrame(r),t=!0)},stop:function(){t=!1},setAnimationLoop:function(e){i=e},setContext:function(t){e=t}}}function fi(e){var t=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),t.get(e)},remove:function(i){i.isInterleavedBufferAttribute&&(i=i.data);var r=t.get(i);r&&(e.deleteBuffer(r.buffer),t.delete(i))},update:function(i,r){i.isInterleavedBufferAttribute&&(i=i.data);var n=t.get(i);void 0===n?t.set(i,function(t,i){var r=t.array,n=t.dynamic?35048:35044,o=e.createBuffer();e.bindBuffer(i,o),e.bufferData(i,r,n),t.onUploadCallback();var a=5126;return r instanceof Float32Array?a=5126:r instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?a=5123:r instanceof Int16Array?a=5122:r instanceof Uint32Array?a=5125:r instanceof Int32Array?a=5124:r instanceof Int8Array?a=5120:r instanceof Uint8Array&&(a=5121),{buffer:o,type:a,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version}}(i,r)):n.version<i.version&&(!function(t,i,r){var n=i.array,o=i.updateRange;e.bindBuffer(r,t),!1===i.dynamic?e.bufferData(r,n,35044):-1===o.count?e.bufferSubData(r,0,n):0===o.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(e.bufferSubData(r,o.offset*n.BYTES_PER_ELEMENT,n.subarray(o.offset,o.offset+o.count)),o.count=-1)}(n.buffer,i,r),n.version=i.version)}}}function mi(e,t,i,r,n,o){this.a=e,this.b=t,this.c=i,this.normal=r&&r.isVector3?r:new Ft,this.vertexNormals=Array.isArray(r)?r:[],this.color=n&&n.isColor?n:new ci,this.vertexColors=Array.isArray(n)?n:[],this.materialIndex=void 0!==o?o:0}function gi(e,t,i,r){this._x=e||0,this._y=t||0,this._z=i||0,this._order=r||gi.DefaultOrder}function vi(){this.mask=1}pi.physical={uniforms:ri([pi.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:ti.meshphysical_vert,fragmentShader:ti.meshphysical_frag},Object.assign(mi.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,i=e.vertexNormals.length;t<i;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(t=0,i=e.vertexColors.length;t<i;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}}),gi.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],gi.DefaultOrder="XYZ",Object.defineProperties(gi.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this.onChangeCallback()}}}),Object.assign(gi.prototype,{isEuler:!0,set:function(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._order=r||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(e,t,i){var r=Lt.clamp,n=e.elements,o=n[0],a=n[4],s=n[8],l=n[1],c=n[5],u=n[9],h=n[2],p=n[6],d=n[10];return"XYZ"===(t=t||this._order)?(this._y=Math.asin(r(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(-u,d),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(p,c),this._z=0)):"YXZ"===t?(this._x=Math.asin(-r(u,-1,1)),Math.abs(u)<.99999?(this._y=Math.atan2(s,d),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,o),this._z=0)):"ZXY"===t?(this._x=Math.asin(r(p,-1,1)),Math.abs(p)<.99999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-a,c)):(this._y=0,this._z=Math.atan2(l,o))):"ZYX"===t?(this._y=Math.asin(-r(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(p,d),this._z=Math.atan2(l,o)):(this._x=0,this._z=Math.atan2(-a,c))):"YZX"===t?(this._z=Math.asin(r(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,o)):(this._x=0,this._y=Math.atan2(s,d))):"XZY"===t?(this._z=Math.asin(-r(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(p,c),this._y=Math.atan2(s,o)):(this._x=Math.atan2(-u,d),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==i&&this.onChangeCallback(),this},setFromQuaternion:function(){var e=new Ht;return function(t,i,r){return e.makeRotationFromQuaternion(t),this.setFromRotationMatrix(e,i,r)}}(),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:(ui=new jt,function(e){return ui.setFromEuler(this),this.setFromQuaternion(ui,e)}),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new Ft(this._x,this._y,this._z)},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}}),Object.assign(vi.prototype,{set:function(e){this.mask=1<<e|0},enable:function(e){this.mask|=1<<e|0},toggle:function(e){this.mask^=1<<e|0},disable:function(e){this.mask&=~(1<<e|0)},test:function(e){return 0!=(this.mask&e.mask)}});var yi,bi,_i,xi,Ei=0;function wi(){Object.defineProperty(this,"id",{value:Ei++}),this.uuid=Lt.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=wi.DefaultUp.clone();var e=new Ft,t=new gi,i=new jt,r=new Ft(1,1,1);t.onChange(function(){i.setFromEuler(t,!1)}),i.onChange(function(){t.setFromQuaternion(i,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Ht},normalMatrix:{value:new Dt}}),this.matrix=new Ht,this.matrixWorld=new Ht,this.matrixAutoUpdate=wi.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new vi,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}wi.DefaultUp=new Ft(0,1,0),wi.DefaultMatrixAutoUpdate=!0,wi.prototype=Object.assign(Object.create(t.prototype),{constructor:wi,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:(xi=new jt,function(e,t){return xi.setFromAxisAngle(e,t),this.quaternion.multiply(xi),this}),rotateOnWorldAxis:function(){var e=new jt;return function(t,i){return e.setFromAxisAngle(t,i),this.quaternion.premultiply(e),this}}(),rotateX:function(){var e=new Ft(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new Ft(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new Ft(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new Ft;return function(t,i){return e.copy(t).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(i)),this}}(),translateX:function(){var e=new Ft(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new Ft(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new Ft(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:(_i=new Ht,function(e){return e.applyMatrix4(_i.getInverse(this.matrixWorld))}),lookAt:function(){var e=new jt,t=new Ht,i=new Ft,r=new Ft;return function(n,o,a){n.isVector3?i.copy(n):i.set(n,o,a);var s=this.parent;this.updateWorldMatrix(!0,!1),r.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?t.lookAt(r,i,this.up):t.lookAt(i,r,this.up),this.quaternion.setFromRotationMatrix(t),s&&(t.extractRotation(s.matrixWorld),e.setFromRotationMatrix(t),this.quaternion.premultiply(e.inverse()))}}(),add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e),this.dispatchEvent({type:"addedChild",object:e})):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var i=this.children.indexOf(e);return-1!==i&&(e.parent=null,e.dispatchEvent({type:"removed"}),this.children.splice(i,1)),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var i=0,r=this.children.length;i<r;i++){var n=this.children[i].getObjectByProperty(e,t);if(void 0!==n)return n}},getWorldPosition:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new Ft),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:(yi=new Ft,bi=new Ft,function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new jt),this.updateMatrixWorld(!0),this.matrixWorld.decompose(yi,e,bi),e}),getWorldScale:function(){var e=new Ft,t=new jt;return function(i){return void 0===i&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),i=new Ft),this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,t,i),i}}(),getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new Ft),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);for(var t=this.children,i=0,r=t.length;i<r;i++)t[i].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,i=0,r=t.length;i<r;i++)t[i].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,i=0,r=t.length;i<r;i++)t[i].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){var i=this.parent;if(!0===e&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(var r=this.children,n=0,o=r.length;n<o;n++)r[n].updateWorldMatrix(!1,!0)},toJSON:function(e){var t=void 0===e||"string"==typeof e,i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var r={};function n(t,i){return void 0===t[i.uuid]&&(t[i.uuid]=i.toJSON(e)),i.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isMesh&&this.drawMode!==yt&&(r.drawMode=this.drawMode),this.isMesh||this.isLine||this.isPoints){r.geometry=n(e.geometries,this.geometry);var o=this.geometry.parameters;if(void 0!==o&&void 0!==o.shapes){var a=o.shapes;if(Array.isArray(a))for(var s=0,l=a.length;s<l;s++){var c=a[s];n(e.shapes,c)}else n(e.shapes,a)}}if(void 0!==this.material)if(Array.isArray(this.material)){var u=[];for(s=0,l=this.material.length;s<l;s++)u.push(n(e.materials,this.material[s]));r.material=u}else r.material=n(e.materials,this.material);if(this.children.length>0){r.children=[];for(s=0;s<this.children.length;s++)r.children.push(this.children[s].toJSON(e).object)}if(t){var h=m(e.geometries),p=m(e.materials),d=m(e.textures),f=m(e.images);a=m(e.shapes);h.length>0&&(i.geometries=h),p.length>0&&(i.materials=p),d.length>0&&(i.textures=d),f.length>0&&(i.images=f),a.length>0&&(i.shapes=a)}return i.object=r,i;function m(e){var t=[];for(var i in e){var r=e[i];delete r.metadata,t.push(r)}return t}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var i=0;i<e.children.length;i++){var r=e.children[i];this.add(r.clone())}return this}});var Ti,Si,Mi=0;function Ri(){Object.defineProperty(this,"id",{value:Mi+=2}),this.uuid=Lt.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}function Pi(e,t,i){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===i,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function Ai(e,t,i){Pi.call(this,new Int8Array(e),t,i)}function Ci(e,t,i){Pi.call(this,new Uint8Array(e),t,i)}function Oi(e,t,i){Pi.call(this,new Uint8ClampedArray(e),t,i)}function Li(e,t,i){Pi.call(this,new Int16Array(e),t,i)}function ki(e,t,i){Pi.call(this,new Uint16Array(e),t,i)}function Hi(e,t,i){Pi.call(this,new Int32Array(e),t,i)}function ji(e,t,i){Pi.call(this,new Uint32Array(e),t,i)}function Fi(e,t,i){Pi.call(this,new Float32Array(e),t,i)}function Di(e,t,i){Pi.call(this,new Float64Array(e),t,i)}function Bi(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function Ii(e){if(0===e.length)return-1/0;for(var t=e[0],i=1,r=e.length;i<r;++i)e[i]>t&&(t=e[i]);return t}Ri.prototype=Object.assign(Object.create(t.prototype),{constructor:Ri,isGeometry:!0,applyMatrix:function(e){for(var t=(new Dt).getNormalMatrix(e),i=0,r=this.vertices.length;i<r;i++){this.vertices[i].applyMatrix4(e)}for(i=0,r=this.faces.length;i<r;i++){var n=this.faces[i];n.normal.applyMatrix3(t).normalize();for(var o=0,a=n.vertexNormals.length;o<a;o++)n.vertexNormals[o].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var e=new Ht;return function(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e=new Ht;return function(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e=new Ht;return function(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e=new Ht;return function(t,i,r){return e.makeTranslation(t,i,r),this.applyMatrix(e),this}}(),scale:function(){var e=new Ht;return function(t,i,r){return e.makeScale(t,i,r),this.applyMatrix(e),this}}(),lookAt:(Si=new wi,function(e){Si.lookAt(e),Si.updateMatrix(),this.applyMatrix(Si.matrix)}),fromBufferGeometry:function(e){var t=this,i=null!==e.index?e.index.array:void 0,r=e.attributes,n=r.position.array,o=void 0!==r.normal?r.normal.array:void 0,a=void 0!==r.color?r.color.array:void 0,s=void 0!==r.uv?r.uv.array:void 0,l=void 0!==r.uv2?r.uv2.array:void 0;void 0!==l&&(this.faceVertexUvs[1]=[]);for(var c=0,u=0;c<n.length;c+=3,u+=2)t.vertices.push((new Ft).fromArray(n,c)),void 0!==a&&t.colors.push((new ci).fromArray(a,c));function h(e,i,r,n){var c=void 0===a?[]:[t.colors[e].clone(),t.colors[i].clone(),t.colors[r].clone()],u=new mi(e,i,r,void 0===o?[]:[(new Ft).fromArray(o,3*e),(new Ft).fromArray(o,3*i),(new Ft).fromArray(o,3*r)],c,n);t.faces.push(u),void 0!==s&&t.faceVertexUvs[0].push([(new kt).fromArray(s,2*e),(new kt).fromArray(s,2*i),(new kt).fromArray(s,2*r)]),void 0!==l&&t.faceVertexUvs[1].push([(new kt).fromArray(l,2*e),(new kt).fromArray(l,2*i),(new kt).fromArray(l,2*r)])}var p=e.groups;if(p.length>0)for(c=0;c<p.length;c++)for(var d=p[c],f=d.start,m=(u=f,f+d.count);u<m;u+=3)void 0!==i?h(i[u],i[u+1],i[u+2],d.materialIndex):h(u,u+1,u+2,d.materialIndex);else if(void 0!==i)for(c=0;c<i.length;c+=3)h(i[c],i[c+1],i[c+2]);else for(c=0;c<n.length/3;c+=3)h(c,c+1,c+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:(Ti=new Ft,function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ti).negate(),this.translate(Ti.x,Ti.y,Ti.z),this}),normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,i=0===t?1:1/t,r=new Ht;return r.set(i,0,0,-i*e.x,0,i,0,-i*e.y,0,0,i,-i*e.z,0,0,0,1),this.applyMatrix(r),this},computeFaceNormals:function(){for(var e=new Ft,t=new Ft,i=0,r=this.faces.length;i<r;i++){var n=this.faces[i],o=this.vertices[n.a],a=this.vertices[n.b],s=this.vertices[n.c];e.subVectors(s,a),t.subVectors(o,a),e.cross(t),e.normalize(),n.normal.copy(e)}},computeVertexNormals:function(e){var t,i,r,n,o,a;for(void 0===e&&(e=!0),a=new Array(this.vertices.length),t=0,i=this.vertices.length;t<i;t++)a[t]=new Ft;if(e){var s,l,c,u=new Ft,h=new Ft;for(r=0,n=this.faces.length;r<n;r++)o=this.faces[r],s=this.vertices[o.a],l=this.vertices[o.b],c=this.vertices[o.c],u.subVectors(c,l),h.subVectors(s,l),u.cross(h),a[o.a].add(u),a[o.b].add(u),a[o.c].add(u)}else for(this.computeFaceNormals(),r=0,n=this.faces.length;r<n;r++)a[(o=this.faces[r]).a].add(o.normal),a[o.b].add(o.normal),a[o.c].add(o.normal);for(t=0,i=this.vertices.length;t<i;t++)a[t].normalize();for(r=0,n=this.faces.length;r<n;r++){var p=(o=this.faces[r]).vertexNormals;3===p.length?(p[0].copy(a[o.a]),p[1].copy(a[o.b]),p[2].copy(a[o.c])):(p[0]=a[o.a].clone(),p[1]=a[o.b].clone(),p[2]=a[o.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e,t,i;for(this.computeFaceNormals(),e=0,t=this.faces.length;e<t;e++){var r=(i=this.faces[e]).vertexNormals;3===r.length?(r[0].copy(i.normal),r[1].copy(i.normal),r[2].copy(i.normal)):(r[0]=i.normal.clone(),r[1]=i.normal.clone(),r[2]=i.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,i,r,n;for(i=0,r=this.faces.length;i<r;i++)for((n=this.faces[i]).__originalFaceNormal?n.__originalFaceNormal.copy(n.normal):n.__originalFaceNormal=n.normal.clone(),n.__originalVertexNormals||(n.__originalVertexNormals=[]),e=0,t=n.vertexNormals.length;e<t;e++)n.__originalVertexNormals[e]?n.__originalVertexNormals[e].copy(n.vertexNormals[e]):n.__originalVertexNormals[e]=n.vertexNormals[e].clone();var o=new Ri;for(o.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var a=this.morphNormals[e].faceNormals,s=this.morphNormals[e].vertexNormals;for(i=0,r=this.faces.length;i<r;i++)l=new Ft,c={a:new Ft,b:new Ft,c:new Ft},a.push(l),s.push(c)}var l,c,u=this.morphNormals[e];for(o.vertices=this.morphTargets[e].vertices,o.computeFaceNormals(),o.computeVertexNormals(),i=0,r=this.faces.length;i<r;i++)n=this.faces[i],l=u.faceNormals[i],c=u.vertexNormals[i],l.copy(n.normal),c.a.copy(n.vertexNormals[0]),c.b.copy(n.vertexNormals[1]),c.c.copy(n.vertexNormals[2])}for(i=0,r=this.faces.length;i<r;i++)(n=this.faces[i]).normal=n.__originalFaceNormal,n.vertexNormals=n.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Jt),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Kt),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,i){if(e&&e.isGeometry){var r,n=this.vertices.length,o=this.vertices,a=e.vertices,s=this.faces,l=e.faces,c=this.faceVertexUvs[0],u=e.faceVertexUvs[0],h=this.colors,p=e.colors;void 0===i&&(i=0),void 0!==t&&(r=(new Dt).getNormalMatrix(t));for(var d=0,f=a.length;d<f;d++){var m=a[d].clone();void 0!==t&&m.applyMatrix4(t),o.push(m)}for(d=0,f=p.length;d<f;d++)h.push(p[d].clone());for(d=0,f=l.length;d<f;d++){var g,v,y,b=l[d],_=b.vertexNormals,x=b.vertexColors;(g=new mi(b.a+n,b.b+n,b.c+n)).normal.copy(b.normal),void 0!==r&&g.normal.applyMatrix3(r).normalize();for(var E=0,w=_.length;E<w;E++)v=_[E].clone(),void 0!==r&&v.applyMatrix3(r).normalize(),g.vertexNormals.push(v);g.color.copy(b.color);for(E=0,w=x.length;E<w;E++)y=x[E],g.vertexColors.push(y.clone());g.materialIndex=b.materialIndex+i,s.push(g)}for(d=0,f=u.length;d<f;d++){var T=u[d],S=[];if(void 0!==T){for(E=0,w=T.length;E<w;E++)S.push(T[E].clone());c.push(S)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){var e,t,i,r,n,o,a,s,l={},c=[],u=[],h=Math.pow(10,4);for(i=0,r=this.vertices.length;i<r;i++)e=this.vertices[i],void 0===l[t=Math.round(e.x*h)+"_"+Math.round(e.y*h)+"_"+Math.round(e.z*h)]?(l[t]=i,c.push(this.vertices[i]),u[i]=c.length-1):u[i]=u[l[t]];var p=[];for(i=0,r=this.faces.length;i<r;i++){(n=this.faces[i]).a=u[n.a],n.b=u[n.b],n.c=u[n.c],o=[n.a,n.b,n.c];for(var d=0;d<3;d++)if(o[d]===o[(d+1)%3]){p.push(i);break}}for(i=p.length-1;i>=0;i--){var f=p[i];for(this.faces.splice(f,1),a=0,s=this.faceVertexUvs.length;a<s;a++)this.faceVertexUvs[a].splice(f,1)}var m=this.vertices.length-c.length;return this.vertices=c,m},setFromPoints:function(e){this.vertices=[];for(var t=0,i=e.length;t<i;t++){var r=e[t];this.vertices.push(new Ft(r.x,r.y,r.z||0))}return this},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,i=0;i<t;i++)e[i]._id=i;e.sort(function(e,t){return e.materialIndex-t.materialIndex});var r,n,o=this.faceVertexUvs[0],a=this.faceVertexUvs[1];o&&o.length===t&&(r=[]),a&&a.length===t&&(n=[]);for(i=0;i<t;i++){var s=e[i]._id;r&&r.push(o[s]),n&&n.push(a[s])}r&&(this.faceVertexUvs[0]=r),n&&(this.faceVertexUvs[1]=n)},toJSON:function(){var e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var i in t)void 0!==t[i]&&(e[i]=t[i]);return e}for(var r=[],n=0;n<this.vertices.length;n++){var o=this.vertices[n];r.push(o.x,o.y,o.z)}var a=[],s=[],l={},c=[],u={},h=[],p={};for(n=0;n<this.faces.length;n++){var d=this.faces[n],f=void 0!==this.faceVertexUvs[0][n],m=d.normal.length()>0,g=d.vertexNormals.length>0,v=1!==d.color.r||1!==d.color.g||1!==d.color.b,y=d.vertexColors.length>0,b=0;if(b=w(b,0,0),b=w(b,1,!0),b=w(b,2,!1),b=w(b,3,f),b=w(b,4,m),b=w(b,5,g),b=w(b,6,v),b=w(b,7,y),a.push(b),a.push(d.a,d.b,d.c),a.push(d.materialIndex),f){var _=this.faceVertexUvs[0][n];a.push(M(_[0]),M(_[1]),M(_[2]))}if(m&&a.push(T(d.normal)),g){var x=d.vertexNormals;a.push(T(x[0]),T(x[1]),T(x[2]))}if(v&&a.push(S(d.color)),y){var E=d.vertexColors;a.push(S(E[0]),S(E[1]),S(E[2]))}}function w(e,t,i){return i?e|1<<t:e&~(1<<t)}function T(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==l[t]?l[t]:(l[t]=s.length/3,s.push(e.x,e.y,e.z),l[t])}function S(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==u[t]?u[t]:(u[t]=c.length,c.push(e.getHex()),u[t])}function M(e){var t=e.x.toString()+e.y.toString();return void 0!==p[t]?p[t]:(p[t]=h.length/2,h.push(e.x,e.y),p[t])}return e.data={},e.data.vertices=r,e.data.normals=s,c.length>0&&(e.data.colors=c),h.length>0&&(e.data.uvs=[h]),e.data.faces=a,e},clone:function(){return(new Ri).copy(this)},copy:function(e){var t,i,r,n,o,a;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var s=e.vertices;for(t=0,i=s.length;t<i;t++)this.vertices.push(s[t].clone());var l=e.colors;for(t=0,i=l.length;t<i;t++)this.colors.push(l[t].clone());var c=e.faces;for(t=0,i=c.length;t<i;t++)this.faces.push(c[t].clone());for(t=0,i=e.faceVertexUvs.length;t<i;t++){var u=e.faceVertexUvs[t];for(void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]),r=0,n=u.length;r<n;r++){var h=u[r],p=[];for(o=0,a=h.length;o<a;o++){var d=h[o];p.push(d.clone())}this.faceVertexUvs[t].push(p)}}var f=e.morphTargets;for(t=0,i=f.length;t<i;t++){var m={};if(m.name=f[t].name,void 0!==f[t].vertices)for(m.vertices=[],r=0,n=f[t].vertices.length;r<n;r++)m.vertices.push(f[t].vertices[r].clone());if(void 0!==f[t].normals)for(m.normals=[],r=0,n=f[t].normals.length;r<n;r++)m.normals.push(f[t].normals[r].clone());this.morphTargets.push(m)}var g=e.morphNormals;for(t=0,i=g.length;t<i;t++){var v={};if(void 0!==g[t].vertexNormals)for(v.vertexNormals=[],r=0,n=g[t].vertexNormals.length;r<n;r++){var y=g[t].vertexNormals[r],b={};b.a=y.a.clone(),b.b=y.b.clone(),b.c=y.c.clone(),v.vertexNormals.push(b)}if(void 0!==g[t].faceNormals)for(v.faceNormals=[],r=0,n=g[t].faceNormals.length;r<n;r++)v.faceNormals.push(g[t].faceNormals[r].clone());this.morphNormals.push(v)}var _=e.skinWeights;for(t=0,i=_.length;t<i;t++)this.skinWeights.push(_[t].clone());var x=e.skinIndices;for(t=0,i=x.length;t<i;t++)this.skinIndices.push(x[t].clone());var E=e.lineDistances;for(t=0,i=E.length;t<i;t++)this.lineDistances.push(E[t]);var w=e.boundingBox;null!==w&&(this.boundingBox=w.clone());var T=e.boundingSphere;return null!==T&&(this.boundingSphere=T.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(Pi.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(Pi.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");return this.count=void 0!==e?e.length/this.itemSize:0,this.array=e,this},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.dynamic=e.dynamic,this},copyAt:function(e,t,i){e*=this.itemSize,i*=t.itemSize;for(var r=0,n=this.itemSize;r<n;r++)this.array[e+r]=t.array[i+r];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,i=0,r=0,n=e.length;r<n;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),o=new ci),t[i++]=o.r,t[i++]=o.g,t[i++]=o.b}return this},copyVector2sArray:function(e){for(var t=this.array,i=0,r=0,n=e.length;r<n;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),o=new kt),t[i++]=o.x,t[i++]=o.y}return this},copyVector3sArray:function(e){for(var t=this.array,i=0,r=0,n=e.length;r<n;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),o=new Ft),t[i++]=o.x,t[i++]=o.y,t[i++]=o.z}return this},copyVector4sArray:function(e){for(var t=this.array,i=0,r=0,n=e.length;r<n;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),o=new Gt),t[i++]=o.x,t[i++]=o.y,t[i++]=o.z,t[i++]=o.w}return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this},setXYZ:function(e,t,i,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this},setXYZW:function(e,t,i,r,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=n,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}}),Ai.prototype=Object.create(Pi.prototype),Ai.prototype.constructor=Ai,Ci.prototype=Object.create(Pi.prototype),Ci.prototype.constructor=Ci,Oi.prototype=Object.create(Pi.prototype),Oi.prototype.constructor=Oi,Li.prototype=Object.create(Pi.prototype),Li.prototype.constructor=Li,ki.prototype=Object.create(Pi.prototype),ki.prototype.constructor=ki,Hi.prototype=Object.create(Pi.prototype),Hi.prototype.constructor=Hi,ji.prototype=Object.create(Pi.prototype),ji.prototype.constructor=ji,Fi.prototype=Object.create(Pi.prototype),Fi.prototype.constructor=Fi,Di.prototype=Object.create(Pi.prototype),Di.prototype.constructor=Di,Object.assign(Bi.prototype,{computeGroups:function(e){for(var t,i=[],r=void 0,n=e.faces,o=0;o<n.length;o++){var a=n[o];a.materialIndex!==r&&(r=a.materialIndex,void 0!==t&&(t.count=3*o-t.start,i.push(t)),t={start:3*o,materialIndex:r})}void 0!==t&&(t.count=3*o-t.start,i.push(t)),this.groups=i},fromGeometry:function(e){var t,i=e.faces,r=e.vertices,n=e.faceVertexUvs,o=n[0]&&n[0].length>0,a=n[1]&&n[1].length>0,s=e.morphTargets,l=s.length;if(l>0){t=[];for(var c=0;c<l;c++)t[c]={name:s[c].name,data:[]};this.morphTargets.position=t}var u,h=e.morphNormals,p=h.length;if(p>0){u=[];for(c=0;c<p;c++)u[c]={name:h[c].name,data:[]};this.morphTargets.normal=u}var d=e.skinIndices,f=e.skinWeights,m=d.length===r.length,g=f.length===r.length;r.length>0&&0===i.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(c=0;c<i.length;c++){var v=i[c];this.vertices.push(r[v.a],r[v.b],r[v.c]);var y=v.vertexNormals;if(3===y.length)this.normals.push(y[0],y[1],y[2]);else{var b=v.normal;this.normals.push(b,b,b)}var _,x=v.vertexColors;if(3===x.length)this.colors.push(x[0],x[1],x[2]);else{var E=v.color;this.colors.push(E,E,E)}if(!0===o)void 0!==(_=n[0][c])?this.uvs.push(_[0],_[1],_[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",c),this.uvs.push(new kt,new kt,new kt));if(!0===a)void 0!==(_=n[1][c])?this.uvs2.push(_[0],_[1],_[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",c),this.uvs2.push(new kt,new kt,new kt));for(var w=0;w<l;w++){var T=s[w].vertices;t[w].data.push(T[v.a],T[v.b],T[v.c])}for(w=0;w<p;w++){var S=h[w].vertexNormals[c];u[w].data.push(S.a,S.b,S.c)}m&&this.skinIndices.push(d[v.a],d[v.b],d[v.c]),g&&this.skinWeights.push(f[v.a],f[v.b],f[v.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}});var Ni=1;function Ui(){Object.defineProperty(this,"id",{value:Ni+=2}),this.uuid=Lt.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}function Vi(e,t,i,r,n,o){Ri.call(this),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:n,depthSegments:o},this.fromBufferGeometry(new zi(e,t,i,r,n,o)),this.mergeVertices()}function zi(e,t,i,r,n,o){Ui.call(this),this.type="BoxBufferGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:n,depthSegments:o};var a=this;e=e||1,t=t||1,i=i||1,r=Math.floor(r)||1,n=Math.floor(n)||1,o=Math.floor(o)||1;var s=[],l=[],c=[],u=[],h=0,p=0;function d(e,t,i,r,n,o,d,f,m,g,v){var y,b,_=o/m,x=d/g,E=o/2,w=d/2,T=f/2,S=m+1,M=g+1,R=0,P=0,A=new Ft;for(b=0;b<M;b++){var C=b*x-w;for(y=0;y<S;y++){var O=y*_-E;A[e]=O*r,A[t]=C*n,A[i]=T,l.push(A.x,A.y,A.z),A[e]=0,A[t]=0,A[i]=f>0?1:-1,c.push(A.x,A.y,A.z),u.push(y/m),u.push(1-b/g),R+=1}}for(b=0;b<g;b++)for(y=0;y<m;y++){var L=h+y+S*b,k=h+y+S*(b+1),H=h+(y+1)+S*(b+1),j=h+(y+1)+S*b;s.push(L,k,j),s.push(k,H,j),P+=6}a.addGroup(p,P,v),p+=P,h+=R}d("z","y","x",-1,-1,i,t,e,o,n,0),d("z","y","x",1,-1,i,t,-e,o,n,1),d("x","z","y",1,1,e,i,t,r,o,2),d("x","z","y",1,-1,e,i,-t,r,o,3),d("x","y","z",1,-1,e,t,i,r,n,4),d("x","y","z",-1,-1,e,t,-i,r,n,5),this.setIndex(s),this.addAttribute("position",new Fi(l,3)),this.addAttribute("normal",new Fi(c,3)),this.addAttribute("uv",new Fi(u,2))}function qi(e,t,i,r){Ri.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r},this.fromBufferGeometry(new Wi(e,t,i,r)),this.mergeVertices()}function Wi(e,t,i,r){Ui.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};var n,o,a=(e=e||1)/2,s=(t=t||1)/2,l=Math.floor(i)||1,c=Math.floor(r)||1,u=l+1,h=c+1,p=e/l,d=t/c,f=[],m=[],g=[],v=[];for(o=0;o<h;o++){var y=o*d-s;for(n=0;n<u;n++){var b=n*p-a;m.push(b,-y,0),g.push(0,0,1),v.push(n/l),v.push(1-o/c)}}for(o=0;o<c;o++)for(n=0;n<l;n++){var _=n+u*o,x=n+u*(o+1),E=n+1+u*(o+1),w=n+1+u*o;f.push(_,x,w),f.push(x,E,w)}this.setIndex(f),this.addAttribute("position",new Fi(m,3)),this.addAttribute("normal",new Fi(g,3)),this.addAttribute("uv",new Fi(v,2))}Ui.prototype=Object.assign(Object.create(t.prototype),{constructor:Ui,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(Ii(e)>65535?ji:ki)(e,1):this.index=e},addAttribute:function(e,t){return t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):(this.attributes[e]=t,this):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.addAttribute(e,new Pi(arguments[1],arguments[2])))},getAttribute:function(e){return this.attributes[e]},removeAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,i){this.groups.push({start:e,count:t,materialIndex:void 0!==i?i:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToBufferAttribute(t),t.needsUpdate=!0);var i=this.attributes.normal;void 0!==i&&((new Dt).getNormalMatrix(e).applyToBufferAttribute(i),i.needsUpdate=!0);return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var e=new Ht;return function(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e=new Ht;return function(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e=new Ht;return function(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e=new Ht;return function(t,i,r){return e.makeTranslation(t,i,r),this.applyMatrix(e),this}}(),scale:function(){var e=new Ht;return function(t,i,r){return e.makeScale(t,i,r),this.applyMatrix(e),this}}(),lookAt:function(){var e=new wi;return function(t){e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),center:function(){var e=new Ft;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(e).negate(),this.translate(e.x,e.y,e.z),this}}(),setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){var i=new Fi(3*t.vertices.length,3),r=new Fi(3*t.colors.length,3);if(this.addAttribute("position",i.copyVector3sArray(t.vertices)),this.addAttribute("color",r.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var n=new Fi(t.lineDistances.length,1);this.addAttribute("lineDistance",n.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){for(var t=[],i=0,r=e.length;i<r;i++){var n=e[i];t.push(n.x,n.y,n.z||0)}return this.addAttribute("position",new Fi(t,3)),this},updateFromObject:function(e){var t,i=e.geometry;if(e.isMesh){var r=i.__directGeometry;if(!0===i.elementsNeedUpdate&&(r=void 0,i.elementsNeedUpdate=!1),void 0===r)return this.fromGeometry(i);r.verticesNeedUpdate=i.verticesNeedUpdate,r.normalsNeedUpdate=i.normalsNeedUpdate,r.colorsNeedUpdate=i.colorsNeedUpdate,r.uvsNeedUpdate=i.uvsNeedUpdate,r.groupsNeedUpdate=i.groupsNeedUpdate,i.verticesNeedUpdate=!1,i.normalsNeedUpdate=!1,i.colorsNeedUpdate=!1,i.uvsNeedUpdate=!1,i.groupsNeedUpdate=!1,i=r}return!0===i.verticesNeedUpdate&&(void 0!==(t=this.attributes.position)&&(t.copyVector3sArray(i.vertices),t.needsUpdate=!0),i.verticesNeedUpdate=!1),!0===i.normalsNeedUpdate&&(void 0!==(t=this.attributes.normal)&&(t.copyVector3sArray(i.normals),t.needsUpdate=!0),i.normalsNeedUpdate=!1),!0===i.colorsNeedUpdate&&(void 0!==(t=this.attributes.color)&&(t.copyColorsArray(i.colors),t.needsUpdate=!0),i.colorsNeedUpdate=!1),i.uvsNeedUpdate&&(void 0!==(t=this.attributes.uv)&&(t.copyVector2sArray(i.uvs),t.needsUpdate=!0),i.uvsNeedUpdate=!1),i.lineDistancesNeedUpdate&&(void 0!==(t=this.attributes.lineDistance)&&(t.copyArray(i.lineDistances),t.needsUpdate=!0),i.lineDistancesNeedUpdate=!1),i.groupsNeedUpdate&&(i.computeGroups(e.geometry),this.groups=i.groups,i.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new Bi).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.addAttribute("position",new Pi(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){var i=new Float32Array(3*e.normals.length);this.addAttribute("normal",new Pi(i,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var r=new Float32Array(3*e.colors.length);this.addAttribute("color",new Pi(r,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var n=new Float32Array(2*e.uvs.length);this.addAttribute("uv",new Pi(n,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var o=new Float32Array(2*e.uvs2.length);this.addAttribute("uv2",new Pi(o,2).copyVector2sArray(e.uvs2))}for(var a in this.groups=e.groups,e.morphTargets){for(var s=[],l=e.morphTargets[a],c=0,u=l.length;c<u;c++){var h=l[c],p=new Fi(3*h.data.length,3);p.name=h.name,s.push(p.copyVector3sArray(h.data))}this.morphAttributes[a]=s}if(e.skinIndices.length>0){var d=new Fi(4*e.skinIndices.length,4);this.addAttribute("skinIndex",d.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var f=new Fi(4*e.skinWeights.length,4);this.addAttribute("skinWeight",f.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Jt);var e=this.attributes.position;void 0!==e?this.boundingBox.setFromBufferAttribute(e):this.boundingBox.makeEmpty(),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var e=new Jt,t=new Ft;return function(){null===this.boundingSphere&&(this.boundingSphere=new Kt);var i=this.attributes.position;if(i){var r=this.boundingSphere.center;e.setFromBufferAttribute(i),e.getCenter(r);for(var n=0,o=0,a=i.count;o<a;o++)t.x=i.getX(o),t.y=i.getY(o),t.z=i.getZ(o),n=Math.max(n,r.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes;if(t.position){var i=t.position.array;if(void 0===t.normal)this.addAttribute("normal",new Pi(new Float32Array(i.length),3));else for(var r=t.normal.array,n=0,o=r.length;n<o;n++)r[n]=0;var a,s,l,c=t.normal.array,u=new Ft,h=new Ft,p=new Ft,d=new Ft,f=new Ft;if(e){var m=e.array;for(n=0,o=e.count;n<o;n+=3)a=3*m[n+0],s=3*m[n+1],l=3*m[n+2],u.fromArray(i,a),h.fromArray(i,s),p.fromArray(i,l),d.subVectors(p,h),f.subVectors(u,h),d.cross(f),c[a]+=d.x,c[a+1]+=d.y,c[a+2]+=d.z,c[s]+=d.x,c[s+1]+=d.y,c[s+2]+=d.z,c[l]+=d.x,c[l+1]+=d.y,c[l+2]+=d.z}else for(n=0,o=i.length;n<o;n+=9)u.fromArray(i,n),h.fromArray(i,n+3),p.fromArray(i,n+6),d.subVectors(p,h),f.subVectors(u,h),d.cross(f),c[n]=d.x,c[n+1]=d.y,c[n+2]=d.z,c[n+3]=d.x,c[n+4]=d.y,c[n+5]=d.z,c[n+6]=d.x,c[n+7]=d.y,c[n+8]=d.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var i=this.attributes;for(var r in i)if(void 0!==e.attributes[r])for(var n=i[r].array,o=e.attributes[r],a=o.array,s=0,l=o.itemSize*t;s<a.length;s++,l++)n[l]=a[s];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){var e=new Ft;return function(){for(var t=this.attributes.normal,i=0,r=t.count;i<r;i++)e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.normalize(),t.setXYZ(i,e.x,e.y,e.z)}}(),toNonIndexed:function(){function e(e,t){for(var i=e.array,r=e.itemSize,n=new i.constructor(t.length*r),o=0,a=0,s=0,l=t.length;s<l;s++){o=t[s]*r;for(var c=0;c<r;c++)n[a++]=i[o++]}return new Pi(n,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var t=new Ui,i=this.index.array,r=this.attributes;for(var n in r){var o=e(r[n],i);t.addAttribute(n,o)}var a=this.morphAttributes;for(n in a){for(var s=[],l=a[n],c=0,u=l.length;c<u;c++){o=e(l[c],i);s.push(o)}t.morphAttributes[n]=s}for(var h=this.groups,p=(c=0,h.length);c<p;c++){var d=h[c];t.addGroup(d.start,d.count,d.materialIndex)}return t},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(var i in t)void 0!==t[i]&&(e[i]=t[i]);return e}e.data={attributes:{}};var r=this.index;if(null!==r){var n=Array.prototype.slice.call(r.array);e.data.index={type:r.array.constructor.name,array:n}}var o=this.attributes;for(var i in o){var a=o[i];n=Array.prototype.slice.call(a.array);e.data.attributes[i]={itemSize:a.itemSize,type:a.array.constructor.name,array:n,normalized:a.normalized}}var s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));var l=this.boundingSphere;return null!==l&&(e.data.boundingSphere={center:l.center.toArray(),radius:l.radius}),e},clone:function(){return(new Ui).copy(this)},copy:function(e){var t,i,r;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var n=e.index;null!==n&&this.setIndex(n.clone());var o=e.attributes;for(t in o){var a=o[t];this.addAttribute(t,a.clone())}var s=e.morphAttributes;for(t in s){var l=[],c=s[t];for(i=0,r=c.length;i<r;i++)l.push(c[i].clone());this.morphAttributes[t]=l}var u=e.groups;for(i=0,r=u.length;i<r;i++){var h=u[i];this.addGroup(h.start,h.count,h.materialIndex)}var p=e.boundingBox;null!==p&&(this.boundingBox=p.clone());var d=e.boundingSphere;return null!==d&&(this.boundingSphere=d.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Vi.prototype=Object.create(Ri.prototype),Vi.prototype.constructor=Vi,zi.prototype=Object.create(Ui.prototype),zi.prototype.constructor=zi,qi.prototype=Object.create(Ri.prototype),qi.prototype.constructor=qi,Wi.prototype=Object.create(Ui.prototype),Wi.prototype.constructor=Wi;var Gi,Xi,Yi,Qi,Zi,Ji,Ki,$i,er,tr,ir,rr,nr=0;function or(){Object.defineProperty(this,"id",{value:nr++}),this.uuid=Lt.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=M,this.side=b,this.flatShading=!1,this.vertexColors=E,this.opacity=1,this.transparent=!1,this.blendSrc=N,this.blendDst=U,this.blendEquation=O,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Z,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.colorMapping=null,this.baseQuaternion=null,this.visible=!0,this.userData={},this.needsUpdate=!0}function ar(e){or.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function sr(e,t){this.origin=void 0!==e?e:new Ft,this.direction=void 0!==t?t:new Ft}function lr(e,t,i){this.a=void 0!==e?e:new Ft,this.b=void 0!==t?t:new Ft,this.c=void 0!==i?i:new Ft}function cr(e){or.call(this),this.type="MeshBasicMaterial",this.color=new ci(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=te,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(e)}function ur(e,t){wi.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new Ui,this.material=void 0!==t?t:new cr({color:16777215*Math.random()}),this.drawMode=yt,this.updateMorphTargets()}function hr(e,t,i,r){var n,o,a=new ci(0),s=0,l=null,c=0;function u(e,i){t.buffers.color.setClear(e.r,e.g,e.b,i,r)}return{getClearColor:function(){return a},setClearColor:function(e,t){a.set(e),u(a,s=void 0!==t?t:1)},getClearAlpha:function(){return s},setClearAlpha:function(e){u(a,s=e)},render:function(t,r,h,p){var d=r.background;if(null===d?(u(a,s),l=null,c=0):d&&d.isColor&&(u(d,1),p=!0,l=null,c=0),(e.autoClear||p)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),d&&(d.isCubeTexture||d.isWebGLRenderTargetCube)){void 0===o&&((o=new ur(new zi(1,1,1),new ar({type:"BackgroundCubeMaterial",uniforms:ii(pi.cube.uniforms),vertexShader:pi.cube.vertexShader,fragmentShader:pi.cube.fragmentShader,side:_,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),o.geometry.removeAttribute("uv"),o.onBeforeRender=function(e,t,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.tCube.value}}),i.update(o));var f=d.isWebGLRenderTargetCube?d.texture:d;o.material.uniforms.tCube.value=f,o.material.uniforms.tFlip.value=d.isWebGLRenderTargetCube?1:-1,f.colorMatrix?o.material.uniforms.colorMatrix.value.copy(f.colorMatrix):o.material.uniforms.colorMatrix.value.identity(),l===d&&c===f.version||(o.material.needsUpdate=!0,l=d,c=f.version),t.unshift(o,o.geometry,o.material,0,0,null)}else d&&d.isTexture&&(void 0===n&&((n=new ur(new Wi(2,2),new ar({type:"BackgroundMaterial",uniforms:ii(pi.background.uniforms),vertexShader:pi.background.vertexShader,fragmentShader:pi.background.fragmentShader,side:b,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),Object.defineProperty(n.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(n)),n.material.uniforms.t2D.value=d,!0===d.matrixAutoUpdate&&d.updateMatrix(),n.material.uniforms.uvTransform.value.copy(d.matrix),l===d&&c===d.version||(n.material.needsUpdate=!0,l=d,c=d.version),t.unshift(n,n.geometry,n.material,0,0,null))}}}function pr(e,t,i,r){var n;this.setMode=function(e){n=e},this.render=function(t,r){e.drawArrays(n,t,r),i.update(r,n)},this.renderInstances=function(o,a,s){var l;if(r.isWebGL2)l=e;else if(null===(l=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[r.isWebGL2?"drawArraysInstanced":"drawArraysInstancedANGLE"](n,a,s,o.maxInstancedCount),i.update(s,n,o.maxInstancedCount)}}function dr(e,t,i){var r;function n(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var o="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext,a=void 0!==i.precision?i.precision:"highp",s=n(a);s!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",s,"instead."),a=s);var l=!0===i.logarithmicDepthBuffer,c=e.getParameter(34930),u=e.getParameter(35660),h=e.getParameter(3379),p=e.getParameter(34076),d=e.getParameter(34921),f=e.getParameter(36347),m=e.getParameter(36348),g=e.getParameter(36349),v=u>0,y=o||!!t.get("OES_texture_float");return{isWebGL2:o,getMaxAnisotropy:function(){if(void 0!==r)return r;var i=t.get("EXT_texture_filter_anisotropic");return r=null!==i?e.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:n,precision:a,logarithmicDepthBuffer:l,maxTextures:c,maxVertexTextures:u,maxTextureSize:h,maxCubemapSize:p,maxAttributes:d,maxVertexUniforms:f,maxVaryings:m,maxFragmentUniforms:g,vertexTextures:v,floatFragmentTextures:y,floatVertexTextures:v&&y,maxSamples:o?e.getParameter(36183):0}}function fr(){var e=this,t=null,i=0,r=!1,n=!1,o=new $t,a=new Dt,s={value:null,needsUpdate:!1};function l(){s.value!==t&&(s.value=t,s.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function c(t,i,r,n){var l=null!==t?t.length:0,c=null;if(0!==l){if(c=s.value,!0!==n||null===c){var u=r+4*l,h=i.matrixWorldInverse;a.getNormalMatrix(h),(null===c||c.length<u)&&(c=new Float32Array(u));for(var p=0,d=r;p!==l;++p,d+=4)o.copy(t[p]).applyMatrix4(h,a),o.normal.toArray(c,d),c[d+3]=o.constant}s.value=c,s.needsUpdate=!0}return e.numPlanes=l,c}this.uniform=s,this.numPlanes=0,this.numIntersection=0,this.init=function(e,n,o){var a=0!==e.length||n||0!==i||r;return r=n,t=c(e,o,0),i=e.length,a},this.beginShadows=function(){n=!0,c(null)},this.endShadows=function(){n=!1,l()},this.setState=function(e,o,a,u,h,p){if(!r||null===e||0===e.length||n&&!a)n?c(null):l();else{var d=n?0:i,f=4*d,m=h.clippingState||null;s.value=m,m=c(e,u,f,p);for(var g=0;g!==f;++g)m[g]=t[g];h.clippingState=m,this.numIntersection=o?this.numPlanes:0,this.numPlanes+=d}}}function mr(e){var t={};return{get:function(i){if(void 0!==t[i])return t[i];var r;switch(i){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(i)}return null===r&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),t[i]=r,r}}}function gr(e,t,i){var r={},n={};function o(e){var a=e.target,s=r[a.id];for(var l in null!==s.index&&t.remove(s.index),s.attributes)t.remove(s.attributes[l]);a.removeEventListener("dispose",o),delete r[a.id];var c=n[s.id];c&&(t.remove(c),delete n[s.id]),i.memory.geometries--}return{get:function(e,t){var n=r[t.id];return n||(t.addEventListener("dispose",o),t.isBufferGeometry?n=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new Ui).setFromObject(e)),n=t._bufferGeometry),r[t.id]=n,i.memory.geometries++,n)},update:function(e){var i=e.index,r=e.attributes;for(var n in null!==i&&t.update(i,34963),r)t.update(r[n],34962);var o=e.morphAttributes;for(var n in o)for(var a=o[n],s=0,l=a.length;s<l;s++)t.update(a[s],34962)},getWireframeAttribute:function(e){var i=n[e.id];if(i)return i;var r,o=[],a=e.index,s=e.attributes;if(null!==a)for(var l=0,c=(r=a.array).length;l<c;l+=3){var u=r[l+0],h=r[l+1],p=r[l+2];o.push(u,h,h,p,p,u)}else for(l=0,c=(r=s.position.array).length/3-1;l<c;l+=3){u=l+0,h=l+1,p=l+2;o.push(u,h,h,p,p,u)}return i=new(Ii(o)>65535?ji:ki)(o,1),t.update(i,34963),n[e.id]=i,i}}}function vr(e,t,i,r){var n,o,a;this.setMode=function(e){n=e},this.setIndex=function(e){o=e.type,a=e.bytesPerElement},this.render=function(t,r){e.drawElements(n,r,o,t*a),i.update(r,n)},this.renderInstances=function(s,l,c){var u;if(r.isWebGL2)u=e;else if(null===(u=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[r.isWebGL2?"drawElementsInstanced":"drawElementsInstancedANGLE"](n,c,o,l*a,s.maxInstancedCount),i.update(c,n,s.maxInstancedCount)}}function yr(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,i,r){switch(r=r||1,t.calls++,i){case 4:t.triangles+=r*(e/3);break;case 5:case 6:t.triangles+=r*(e-2);break;case 1:t.lines+=r*(e/2);break;case 3:t.lines+=r*(e-1);break;case 2:t.lines+=r*e;break;case 0:t.points+=r*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}function br(e,t){return Math.abs(t[1])-Math.abs(e[1])}function _r(e){var t={},i=new Float32Array(8);return{update:function(r,n,o,a){var s=r.morphTargetInfluences,l=s.length,c=t[n.id];if(void 0===c){c=[];for(var u=0;u<l;u++)c[u]=[u,0];t[n.id]=c}var h=o.morphTargets&&n.morphAttributes.position,p=o.morphNormals&&n.morphAttributes.normal;for(u=0;u<l;u++){0!==(d=c[u])[1]&&(h&&n.removeAttribute("morphTarget"+u),p&&n.removeAttribute("morphNormal"+u))}for(u=0;u<l;u++){(d=c[u])[0]=u,d[1]=s[u]}for(c.sort(br),u=0;u<8;u++){var d;if(d=c[u]){var f=d[0],m=d[1];if(m){h&&n.addAttribute("morphTarget"+u,h[f]),p&&n.addAttribute("morphNormal"+u,p[f]),i[u]=m;continue}}i[u]=0}a.getUniforms().setValue(e,"morphTargetInfluences",i)}}}function xr(e,t){var i={};return{update:function(r){var n=t.render.frame,o=r.geometry,a=e.get(r,o);return i[a.id]!==n&&(o.isGeometry&&a.updateFromObject(r),e.update(a),i[a.id]=n),a},dispose:function(){i={}}}}function Er(e,t,i,r,n,o,a,s,l,c){e=void 0!==e?e:[],t=void 0!==t?t:ue,Wt.call(this,e,t,i,r,n,o,a,s,l,c),this.flipY=!1}function wr(e,t,i,r){Wt.call(this,null),this.image={data:e,width:t,height:i,depth:r},this.magFilter=_e,this.minFilter=_e,this.generateMipmaps=!1,this.flipY=!1}or.prototype=Object.assign(Object.create(t.prototype),{constructor:or,isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){if(void 0!==e)for(var t in e){var i=e[t];if(void 0!==i)if("shading"!==t){var r=this[t];void 0!==r?r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===i;else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(e){var t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});var i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(e){var t=[];for(var i in e){var r=e[i];delete r.metadata,t.push(r)}return t}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearCoat&&(i.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(i.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,i.reflectivity=this.reflectivity,void 0!==this.combine&&(i.combine=this.combine),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(i.size=this.size),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==M&&(i.blending=this.blending),!0===this.flatShading&&(i.flatShading=this.flatShading),this.side!==b&&(i.side=this.side),this.vertexColors!==E&&(i.vertexColors=this.vertexColors),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(i.morphTargets=!0),!0===this.skinning&&(i.skinning=!0),!1===this.visible&&(i.visible=!1),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),t){var n=r(e.textures),o=r(e.images);n.length>0&&(i.textures=n),o.length>0&&(i.images=o)}return i},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.lights=e.lights,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.userData=JSON.parse(JSON.stringify(e.userData)),this.clipShadows=e.clipShadows,this.clipIntersection=e.clipIntersection;var t=e.clippingPlanes,i=null;if(null!==t){var r=t.length;i=new Array(r);for(var n=0;n!==r;++n)i[n]=t[n].clone()}return this.clippingPlanes=i,this.shadowSide=e.shadowSide,this.colorMapping=e.colorMapping,this.baseQuaternion=e.baseQuaternion,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),ar.prototype=Object.create(or.prototype),ar.prototype.constructor=ar,ar.prototype.isShaderMaterial=!0,ar.prototype.copy=function(e){return or.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=ii(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},ar.prototype.toJSON=function(e){var t=or.prototype.toJSON.call(this,e);for(var i in t.uniforms={},this.uniforms){var r=this.uniforms[i].value;r&&r.isTexture?t.uniforms[i]={type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?t.uniforms[i]={type:"c",value:r.getHex()}:r&&r.isVector2?t.uniforms[i]={type:"v2",value:r.toArray()}:r&&r.isVector3?t.uniforms[i]={type:"v3",value:r.toArray()}:r&&r.isVector4?t.uniforms[i]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?t.uniforms[i]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?t.uniforms[i]={type:"m4",value:r.toArray()}:t.uniforms[i]={value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;var n={};for(var o in this.extensions)!0===this.extensions[o]&&(n[o]=!0);return Object.keys(n).length>0&&(t.extensions=n),t},Object.assign(sr.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new Ft),t.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(){var e=new Ft;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new Ft),t.subVectors(e,this.origin);var i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(){var e=new Ft;return function(t){var i=e.subVectors(t,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(t):(e.copy(this.direction).multiplyScalar(i).add(this.origin),e.distanceToSquared(t))}}(),distanceSqToSegment:(Xi=new Ft,Yi=new Ft,Qi=new Ft,function(e,t,i,r){Xi.copy(e).add(t).multiplyScalar(.5),Yi.copy(t).sub(e).normalize(),Qi.copy(this.origin).sub(Xi);var n,o,a,s,l=.5*e.distanceTo(t),c=-this.direction.dot(Yi),u=Qi.dot(this.direction),h=-Qi.dot(Yi),p=Qi.lengthSq(),d=Math.abs(1-c*c);if(d>0)if(o=c*u-h,s=l*d,(n=c*h-u)>=0)if(o>=-s)if(o<=s){var f=1/d;a=(n*=f)*(n+c*(o*=f)+2*u)+o*(c*n+o+2*h)+p}else o=l,a=-(n=Math.max(0,-(c*o+u)))*n+o*(o+2*h)+p;else o=-l,a=-(n=Math.max(0,-(c*o+u)))*n+o*(o+2*h)+p;else o<=-s?a=-(n=Math.max(0,-(-c*l+u)))*n+(o=n>0?-l:Math.min(Math.max(-l,-h),l))*(o+2*h)+p:o<=s?(n=0,a=(o=Math.min(Math.max(-l,-h),l))*(o+2*h)+p):a=-(n=Math.max(0,-(c*l+u)))*n+(o=n>0?l:Math.min(Math.max(-l,-h),l))*(o+2*h)+p;else o=c>0?-l:l,a=-(n=Math.max(0,-(c*o+u)))*n+o*(o+2*h)+p;return i&&i.copy(this.direction).multiplyScalar(n).add(this.origin),r&&r.copy(Yi).multiplyScalar(o).add(Xi),a}),intersectSphere:function(){var e=new Ft;return function(t,i){e.subVectors(t.center,this.origin);var r=e.dot(this.direction),n=e.dot(e)-r*r,o=t.radius*t.radius;if(n>o)return null;var a=Math.sqrt(o-n),s=r-a,l=r+a;return s<0&&l<0?null:s<0?this.at(l,i):this.at(s,i)}}(),intersectsSphere:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null},intersectPlane:function(e,t){var i=this.distanceToPlane(e);return null===i?null:this.at(i,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0},intersectBox:function(e,t){var i,r,n,o,a,s,l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(i=(e.min.x-h.x)*l,r=(e.max.x-h.x)*l):(i=(e.max.x-h.x)*l,r=(e.min.x-h.x)*l),c>=0?(n=(e.min.y-h.y)*c,o=(e.max.y-h.y)*c):(n=(e.max.y-h.y)*c,o=(e.min.y-h.y)*c),i>o||n>r?null:((n>i||i!=i)&&(i=n),(o<r||r!=r)&&(r=o),u>=0?(a=(e.min.z-h.z)*u,s=(e.max.z-h.z)*u):(a=(e.max.z-h.z)*u,s=(e.min.z-h.z)*u),i>s||a>r?null:((a>i||i!=i)&&(i=a),(s<r||r!=r)&&(r=s),r<0?null:this.at(i>=0?i:r,t)))},intersectsBox:(Gi=new Ft,function(e){return null!==this.intersectBox(e,Gi)}),intersectTriangle:function(){var e=new Ft,t=new Ft,i=new Ft,r=new Ft;return function(n,o,a,s,l){t.subVectors(o,n),i.subVectors(a,n),r.crossVectors(t,i);var c,u=this.direction.dot(r);if(u>0){if(s)return null;c=1}else{if(!(u<0))return null;c=-1,u=-u}e.subVectors(this.origin,n);var h=c*this.direction.dot(i.crossVectors(e,i));if(h<0)return null;var p=c*this.direction.dot(t.cross(e));if(p<0)return null;if(h+p>u)return null;var d=-c*e.dot(r);return d<0?null:this.at(d/u,l)}}(),applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}),Object.assign(lr,{getNormal:(Ji=new Ft,function(e,t,i,r){void 0===r&&(console.warn("THREE.Triangle: .getNormal() target is now required"),r=new Ft),r.subVectors(i,t),Ji.subVectors(e,t),r.cross(Ji);var n=r.lengthSq();return n>0?r.multiplyScalar(1/Math.sqrt(n)):r.set(0,0,0)}),getBarycoord:function(){var e=new Ft,t=new Ft,i=new Ft;return function(r,n,o,a,s){e.subVectors(a,n),t.subVectors(o,n),i.subVectors(r,n);var l=e.dot(e),c=e.dot(t),u=e.dot(i),h=t.dot(t),p=t.dot(i),d=l*h-c*c;if(void 0===s&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),s=new Ft),0===d)return s.set(-2,-1,-1);var f=1/d,m=(h*u-c*p)*f,g=(l*p-c*u)*f;return s.set(1-m-g,g,m)}}(),containsPoint:function(){var e=new Ft;return function(t,i,r,n){return lr.getBarycoord(t,i,r,n,e),e.x>=0&&e.y>=0&&e.x+e.y<=1}}(),getUV:(Zi=new Ft,function(e,t,i,r,n,o,a,s){return this.getBarycoord(e,t,i,r,Zi),s.set(0,0),s.addScaledVector(n,Zi.x),s.addScaledVector(o,Zi.y),s.addScaledVector(a,Zi.z),s})}),Object.assign(lr.prototype,{set:function(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this},setFromPointsAndIndices:function(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},getArea:function(){var e=new Ft,t=new Ft;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),getMidpoint:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new Ft),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(e){return lr.getNormal(this.a,this.b,this.c,e)},getPlane:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new Ft),e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(e,t){return lr.getBarycoord(e,this.a,this.b,this.c,t)},containsPoint:function(e){return lr.containsPoint(e,this.a,this.b,this.c)},getUV:function(e,t,i,r,n){return lr.getUV(e,this.a,this.b,this.c,t,i,r,n)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:(Ki=new Ft,$i=new Ft,er=new Ft,tr=new Ft,ir=new Ft,rr=new Ft,function(e,t){void 0===t&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new Ft);var i,r,n=this.a,o=this.b,a=this.c;Ki.subVectors(o,n),$i.subVectors(a,n),tr.subVectors(e,n);var s=Ki.dot(tr),l=$i.dot(tr);if(s<=0&&l<=0)return t.copy(n);ir.subVectors(e,o);var c=Ki.dot(ir),u=$i.dot(ir);if(c>=0&&u<=c)return t.copy(o);var h=s*u-c*l;if(h<=0&&s>=0&&c<=0)return i=s/(s-c),t.copy(n).addScaledVector(Ki,i);rr.subVectors(e,a);var p=Ki.dot(rr),d=$i.dot(rr);if(d>=0&&p<=d)return t.copy(a);var f=p*l-s*d;if(f<=0&&l>=0&&d<=0)return r=l/(l-d),t.copy(n).addScaledVector($i,r);var m=c*d-p*u;if(m<=0&&u-c>=0&&p-d>=0)return er.subVectors(a,o),r=(u-c)/(u-c+(p-d)),t.copy(o).addScaledVector(er,r);var g=1/(m+f+h);return i=f*g,r=h*g,t.copy(n).addScaledVector(Ki,i).addScaledVector($i,r)}),equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}),cr.prototype=Object.create(or.prototype),cr.prototype.constructor=cr,cr.prototype.isMeshBasicMaterial=!0,cr.prototype.copy=function(e){return or.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this},ur.prototype=Object.assign(Object.create(wi.prototype),{constructor:ur,isMesh:!0,setDrawMode:function(e){this.drawMode=e},copy:function(e){return wi.prototype.copy.call(this,e),this.drawMode=e.drawMode,void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this},updateMorphTargets:function(){var e,t,i,r=this.geometry;if(r.isBufferGeometry){var n=r.morphAttributes,o=Object.keys(n);if(o.length>0){var a=n[o[0]];if(void 0!==a)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=a.length;e<t;e++)i=a[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}else{var s=r.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(){var e=new Ht,t=new sr,i=new Kt,r=new Ft,n=new Ft,o=new Ft,a=new Ft,s=new Ft,l=new Ft,c=new kt,u=new kt,h=new kt,p=new Ft,d=new Ft;function f(e,t,i,r,n,o,a,s){if(null===(t.side===_?r.intersectTriangle(a,o,n,!0,s):r.intersectTriangle(n,o,a,t.side!==x,s)))return null;d.copy(s),d.applyMatrix4(e.matrixWorld);var l=i.ray.origin.distanceTo(d);return l<i.near||l>i.far?null:{distance:l,point:d.clone(),object:e}}function m(e,t,i,a,s,l,d,m,g){r.fromBufferAttribute(s,d),n.fromBufferAttribute(s,m),o.fromBufferAttribute(s,g);var v=f(e,t,i,a,r,n,o,p);if(v){l&&(c.fromBufferAttribute(l,d),u.fromBufferAttribute(l,m),h.fromBufferAttribute(l,g),v.uv=lr.getUV(p,r,n,o,c,u,h,new kt));var y=new mi(d,m,g);lr.getNormal(r,n,o,y.normal),v.face=y}return v}return function(d,g){var v,y=this.geometry,b=this.material,_=this.matrixWorld;if(void 0!==b&&(null===y.boundingSphere&&y.computeBoundingSphere(),i.copy(y.boundingSphere),i.applyMatrix4(_),!1!==d.ray.intersectsSphere(i)&&(e.getInverse(_),t.copy(d.ray).applyMatrix4(e),null===y.boundingBox||!1!==t.intersectsBox(y.boundingBox))))if(y.isBufferGeometry){var x,E,w,T,S,M,R,P,A,C=y.index,O=y.attributes.position,L=y.attributes.uv,k=y.groups,H=y.drawRange;if(null!==C)if(Array.isArray(b))for(T=0,M=k.length;T<M;T++)for(A=b[(P=k[T]).materialIndex],S=Math.max(P.start,H.start),R=Math.min(P.start+P.count,H.start+H.count);S<R;S+=3)x=C.getX(S),E=C.getX(S+1),w=C.getX(S+2),(v=m(this,A,d,t,O,L,x,E,w))&&(v.faceIndex=Math.floor(S/3),v.face.materialIndex=P.materialIndex,g.push(v));else for(T=Math.max(0,H.start),M=Math.min(C.count,H.start+H.count);T<M;T+=3)x=C.getX(T),E=C.getX(T+1),w=C.getX(T+2),(v=m(this,b,d,t,O,L,x,E,w))&&(v.faceIndex=Math.floor(T/3),g.push(v));else if(void 0!==O)if(Array.isArray(b))for(T=0,M=k.length;T<M;T++)for(A=b[(P=k[T]).materialIndex],S=Math.max(P.start,H.start),R=Math.min(P.start+P.count,H.start+H.count);S<R;S+=3)(v=m(this,A,d,t,O,L,x=S,E=S+1,w=S+2))&&(v.faceIndex=Math.floor(S/3),v.face.materialIndex=P.materialIndex,g.push(v));else for(T=Math.max(0,H.start),M=Math.min(O.count,H.start+H.count);T<M;T+=3)(v=m(this,b,d,t,O,L,x=T,E=T+1,w=T+2))&&(v.faceIndex=Math.floor(T/3),g.push(v))}else if(y.isGeometry){var j,F,D,B,I=Array.isArray(b),N=y.vertices,U=y.faces,V=y.faceVertexUvs[0];V.length>0&&(B=V);for(var z=0,q=U.length;z<q;z++){var W=U[z],G=I?b[W.materialIndex]:b;if(void 0!==G){if(j=N[W.a],F=N[W.b],D=N[W.c],!0===G.morphTargets){var X=y.morphTargets,Y=this.morphTargetInfluences;r.set(0,0,0),n.set(0,0,0),o.set(0,0,0);for(var Q=0,Z=X.length;Q<Z;Q++){var J=Y[Q];if(0!==J){var K=X[Q].vertices;r.addScaledVector(a.subVectors(K[W.a],j),J),n.addScaledVector(s.subVectors(K[W.b],F),J),o.addScaledVector(l.subVectors(K[W.c],D),J)}}r.add(j),n.add(F),o.add(D),j=r,F=n,D=o}if(v=f(this,G,d,t,j,F,D,p)){if(B&&B[z]){var $=B[z];c.copy($[0]),u.copy($[1]),h.copy($[2]),v.uv=lr.getUV(p,j,F,D,c,u,h,new kt)}v.face=W,v.faceIndex=z,g.push(v)}}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Er.prototype=Object.create(Wt.prototype),Er.prototype.constructor=Er,Er.prototype.isCubeTexture=!0,Object.defineProperty(Er.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}}),wr.prototype=Object.create(Wt.prototype),wr.prototype.constructor=wr,wr.prototype.isDataTexture3D=!0;var Tr=new Wt,Sr=new wr,Mr=new Er;function Rr(){this.seq=[],this.map={}}var Pr=[],Ar=[],Cr=new Float32Array(16),Or=new Float32Array(9),Lr=new Float32Array(4);function kr(e,t,i){var r=e[0];if(r<=0||r>0)return e;var n=t*i,o=Pr[n];if(void 0===o&&(o=new Float32Array(n),Pr[n]=o),0!==t){r.toArray(o,0);for(var a=1,s=0;a!==t;++a)s+=i,e[a].toArray(o,s)}return o}function Hr(e,t){if(e.length!==t.length)return!1;for(var i=0,r=e.length;i<r;i++)if(e[i]!==t[i])return!1;return!0}function jr(e,t){for(var i=0,r=t.length;i<r;i++)e[i]=t[i]}function Fr(e,t){var i=Ar[t];void 0===i&&(i=new Int32Array(t),Ar[t]=i);for(var r=0;r!==t;++r)i[r]=e.allocTextureUnit();return i}function Dr(e,t){var i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function Br(e,t){var i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function Ir(e,t){var i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Hr(i,t))return;e.uniform2fv(this.addr,t),jr(i,t)}}function Nr(e,t){var i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(void 0!==t.r)i[0]===t.r&&i[1]===t.g&&i[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(Hr(i,t))return;e.uniform3fv(this.addr,t),jr(i,t)}}function Ur(e,t){var i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z&&i[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Hr(i,t))return;e.uniform4fv(this.addr,t),jr(i,t)}}function Vr(e,t){var i=this.cache,r=t.elements;if(void 0===r){if(Hr(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),jr(i,t)}else{if(Hr(i,r))return;Lr.set(r),e.uniformMatrix2fv(this.addr,!1,Lr),jr(i,r)}}function zr(e,t){var i=this.cache,r=t.elements;if(void 0===r){if(Hr(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),jr(i,t)}else{if(Hr(i,r))return;Or.set(r),e.uniformMatrix3fv(this.addr,!1,Or),jr(i,r)}}function qr(e,t){var i=this.cache,r=t.elements;if(void 0===r){if(Hr(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),jr(i,t)}else{if(Hr(i,r))return;Cr.set(r),e.uniformMatrix4fv(this.addr,!1,Cr),jr(i,r)}}function Wr(e,t,i){var r=this.cache,n=i.allocTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture2D(t||Tr,n)}function Gr(e,t,i){var r=this.cache,n=i.allocTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture3D(t||Sr,n)}function Xr(e,t,i){var r=this.cache,n=i.allocTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTextureCube(t||Mr,n)}function Yr(e,t){var i=this.cache;Hr(i,t)||(e.uniform2iv(this.addr,t),jr(i,t))}function Qr(e,t){var i=this.cache;Hr(i,t)||(e.uniform3iv(this.addr,t),jr(i,t))}function Zr(e,t){var i=this.cache;Hr(i,t)||(e.uniform4iv(this.addr,t),jr(i,t))}function Jr(e,t){var i=this.cache;Hr(i,t)||(e.uniform1fv(this.addr,t),jr(i,t))}function Kr(e,t){var i=this.cache;Hr(i,t)||(e.uniform1iv(this.addr,t),jr(i,t))}function $r(e,t){var i=this.cache,r=kr(t,this.size,2);Hr(i,r)||(e.uniform2fv(this.addr,r),this.updateCache(r))}function en(e,t){var i=this.cache,r=kr(t,this.size,3);Hr(i,r)||(e.uniform3fv(this.addr,r),this.updateCache(r))}function tn(e,t){var i=this.cache,r=kr(t,this.size,4);Hr(i,r)||(e.uniform4fv(this.addr,r),this.updateCache(r))}function rn(e,t){var i=this.cache,r=kr(t,this.size,4);Hr(i,r)||(e.uniformMatrix2fv(this.addr,!1,r),this.updateCache(r))}function nn(e,t){var i=this.cache,r=kr(t,this.size,9);Hr(i,r)||(e.uniformMatrix3fv(this.addr,!1,r),this.updateCache(r))}function on(e,t){var i=this.cache,r=kr(t,this.size,16);Hr(i,r)||(e.uniformMatrix4fv(this.addr,!1,r),this.updateCache(r))}function an(e,t,i){var r=this.cache,n=t.length,o=Fr(i,n);!1===Hr(r,o)&&(e.uniform1iv(this.addr,o),jr(r,o));for(var a=0;a!==n;++a)i.setTexture2D(t[a]||Tr,o[a])}function sn(e,t,i){var r=this.cache,n=t.length,o=Fr(i,n);!1===Hr(r,o)&&(e.uniform1iv(this.addr,o),jr(r,o));for(var a=0;a!==n;++a)i.setTextureCube(t[a]||Mr,o[a])}function ln(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=function(e){switch(e){case 5126:return Dr;case 35664:return Ir;case 35665:return Nr;case 35666:return Ur;case 35674:return Vr;case 35675:return zr;case 35676:return qr;case 35678:case 36198:return Wr;case 35679:return Gr;case 35680:return Xr;case 5124:case 35670:return Br;case 35667:case 35671:return Yr;case 35668:case 35672:return Qr;case 35669:case 35673:return Zr}}(t.type)}function cn(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return Jr;case 35664:return $r;case 35665:return en;case 35666:return tn;case 35674:return rn;case 35675:return nn;case 35676:return on;case 35678:return an;case 35680:return sn;case 5124:case 35670:return Kr;case 35667:case 35671:return Yr;case 35668:case 35672:return Qr;case 35669:case 35673:return Zr}}(t.type)}function un(e){this.id=e,Rr.call(this)}cn.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),jr(t,e)},un.prototype.setValue=function(e,t,i){for(var r=this.seq,n=0,o=r.length;n!==o;++n){var a=r[n];a.setValue(e,t[a.id],i)}};var hn=/([\w\d_]+)(\])?(\[|\.)?/g;function pn(e,t){e.seq.push(t),e.map[t.id]=t}function dn(e,t,i){var r=e.name,n=r.length;for(hn.lastIndex=0;;){var o=hn.exec(r),a=hn.lastIndex,s=o[1],l="]"===o[2],c=o[3];if(l&&(s|=0),void 0===c||"["===c&&a+2===n){pn(i,void 0===c?new ln(s,e,t):new cn(s,e,t));break}var u=i.map[s];void 0===u&&pn(i,u=new un(s)),i=u}}function fn(e,t,i){Rr.call(this),this.renderer=i;for(var r=e.getProgramParameter(t,35718),n=0;n<r;++n){var o=e.getActiveUniform(t,n);dn(o,e.getUniformLocation(t,o.name),this)}}function mn(e,t,i){var r=e.createShader(t);return e.shaderSource(r,i),e.compileShader(r),!1===e.getShaderParameter(r,35713)&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==e.getShaderInfoLog(r)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",35633===t?"vertex":"fragment",e.getShaderInfoLog(r),function(e){for(var t=e.split("\n"),i=0;i<t.length;i++)t[i]=i+1+": "+t[i];return t.join("\n")}(i)),r}fn.prototype.setValue=function(e,t,i){var r=this.map[t];void 0!==r&&r.setValue(e,i,this.renderer)},fn.prototype.setOptional=function(e,t,i){var r=t[i];void 0!==r&&this.setValue(e,i,r)},fn.upload=function(e,t,i,r){for(var n=0,o=t.length;n!==o;++n){var a=t[n],s=i[a.id];!1!==s.needsUpdate&&a.setValue(e,s.value,r)}},fn.seqWithValue=function(e,t){for(var i=[],r=0,n=e.length;r!==n;++r){var o=e[r];o.id in t&&i.push(o)}return i};var gn=0;function vn(e){switch(e){case xt:return["Linear","( value )"];case Et:return["sRGB","( value )"];case Tt:return["RGBE","( value )"];case St:return["RGBM","( value, 7.0 )"];case Mt:return["RGBM","( value, 16.0 )"];case Rt:return["RGBD","( value, 256.0 )"];case wt:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+e)}}function yn(e,t){var i=vn(t);return"vec4 "+e+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function bn(e,t){var i;switch(t){case oe:i="Linear";break;case ae:i="Reinhard";break;case se:i="Uncharted2";break;case le:i="OptimizedCineon";break;case ce:i="ACESFilmic";break;default:throw new Error("unsupported toneMapping: "+t)}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function _n(e){return""!==e}function xn(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights)}function En(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}function wn(e){return e.replace(/^[ \t]*#include +<([\w\d.\/]+)>/gm,function(e,t){var i=ti[t];if(void 0===i)throw new Error("Can not resolve #include <"+t+">");return wn(i)})}function Tn(e){return e.replace(/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function(e,t,i,r){for(var n="",o=parseInt(t);o<parseInt(i);o++)n+=r.replace(/\[ i \]/g,"[ "+o+" ]");return n})}function Sn(e,t,i,r,n,o,a){var s=e.context,l=r.defines,c=n.vertexShader,u=n.fragmentShader,h="SHADOWMAP_TYPE_BASIC";o.shadowMapType===v?h="SHADOWMAP_TYPE_PCF":o.shadowMapType===y&&(h="SHADOWMAP_TYPE_PCF_SOFT");var p="ENVMAP_TYPE_CUBE",d="ENVMAP_MODE_REFLECTION",f="ENVMAP_BLENDING_MULTIPLY";if(o.envMap){switch(r.envMap.mapping){case ue:case he:p="ENVMAP_TYPE_CUBE";break;case me:case ge:p="ENVMAP_TYPE_CUBE_UV";break;case pe:case de:p="ENVMAP_TYPE_EQUIREC";break;case fe:p="ENVMAP_TYPE_SPHERE"}switch(r.envMap.mapping){case he:case de:d="ENVMAP_MODE_REFRACTION"}switch(r.combine){case te:f="ENVMAP_BLENDING_MULTIPLY";break;case ie:f="ENVMAP_BLENDING_MIX";break;case re:f="ENVMAP_BLENDING_ADD"}}var m,g,b,_,x,E=e.gammaFactor>0?e.gammaFactor:1,w=a.isWebGL2?"":function(e,t,i){return[(e=e||{}).derivatives||t.envMapCubeUV||t.bumpMap||t.normalMap&&!t.objectSpaceNormalMap||t.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(e.fragDepth||t.logarithmicDepthBuffer)&&i.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",e.drawBuffers&&i.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(e.shaderTextureLOD||t.envMap)&&i.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(_n).join("\n")}(r.extensions,o,t),T=function(e){var t=[];for(var i in e){var r=e[i];!1!==r&&t.push("#define "+i+" "+r)}return t.join("\n")}(l),S=s.createProgram();if(r.isRawShaderMaterial?((m=[T].filter(_n).join("\n")).length>0&&(m+="\n"),(g=[w,T].filter(_n).join("\n")).length>0&&(g+="\n")):(m=["precision "+o.precision+" float;","precision "+o.precision+" int;","#define SHADER_NAME "+n.name,T,o.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+E,"#define MAX_BONES "+o.maxBones,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+d:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.normalMap&&o.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",o.displacementMap&&o.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.vertexColors?"#define USE_COLOR":"",o.flatShading?"#define FLAT_SHADED":"",o.skinning?"#define USE_SKINNING":"",o.useVertexTexture?"#define BONE_TEXTURE":"",o.morphTargets?"#define USE_MORPHTARGETS":"",o.morphNormals&&!1===o.flatShading?"#define USE_MORPHNORMALS":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+h:"",o.sizeAttenuation?"#define USE_SIZEATTENUATION":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.logarithmicDepthBuffer&&(a.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(_n).join("\n"),g=[w,"precision "+o.precision+" float;","precision "+o.precision+" int;","#define SHADER_NAME "+n.name,T,o.alphaTest?"#define ALPHATEST "+o.alphaTest+(o.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+E,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.matcap?"#define USE_MATCAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+p:"",o.envMap?"#define "+d:"",o.envMap?"#define "+f:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.normalMap&&o.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.vertexColors?"#define USE_COLOR":"",o.gradientMap?"#define USE_GRADIENTMAP":"",o.flatShading?"#define FLAT_SHADED":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+h:"",o.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",o.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.logarithmicDepthBuffer&&(a.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"",o.envMap&&(a.isWebGL2||t.get("EXT_shader_texture_lod"))?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",o.toneMapping!==ne?"#define TONE_MAPPING":"",o.toneMapping!==ne?ti.tonemapping_pars_fragment:"",o.toneMapping!==ne?bn("toneMapping",o.toneMapping):"",o.dithering?"#define DITHERING":"",o.outputEncoding||o.mapEncoding||o.matcapEncoding||o.envMapEncoding||o.emissiveMapEncoding?ti.encodings_pars_fragment:"",o.mapEncoding?yn("mapTexelToLinear",o.mapEncoding):"",o.matcapEncoding?yn("matcapTexelToLinear",o.matcapEncoding):"",o.envMapEncoding?yn("envMapTexelToLinear",o.envMapEncoding):"",o.emissiveMapEncoding?yn("emissiveMapTexelToLinear",o.emissiveMapEncoding):"",o.outputEncoding?(b="linearToOutputTexel",_=o.outputEncoding,x=vn(_),"vec4 "+b+"( vec4 value ) { return LinearTo"+x[0]+x[1]+"; }"):"",o.depthPacking?"#define DEPTH_PACKING "+r.depthPacking:"",o.useColorMapping?"#define COLOR_MAPPING":"",o.useBaseQuaternion?"#define BASE_QUATERNION":"","\n"].filter(_n).join("\n")),c=En(c=xn(c=wn(c),o),o),u=En(u=xn(u=wn(u),o),o),c=Tn(c),u=Tn(u),a.isWebGL2&&!r.isRawShaderMaterial){var M=!1,R=/^\s*#version\s+300\s+es\s*\n/;r.isShaderMaterial&&null!==c.match(R)&&null!==u.match(R)&&(M=!0,c=c.replace(R,""),u=u.replace(R,"")),m=["#version 300 es\n","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+m,g=["#version 300 es\n","#define varying in",M?"":"out highp vec4 pc_fragColor;",M?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+g}var P=g+u,A=mn(s,35633,m+c),C=mn(s,35632,P);s.attachShader(S,A),s.attachShader(S,C),void 0!==r.index0AttributeName?s.bindAttribLocation(S,0,r.index0AttributeName):!0===o.morphTargets&&s.bindAttribLocation(S,0,"position"),s.linkProgram(S);var O,L,k=s.getProgramInfoLog(S).trim(),H=s.getShaderInfoLog(A).trim(),j=s.getShaderInfoLog(C).trim(),F=!0,D=!0;return!1===s.getProgramParameter(S,35714)?(F=!1,console.error("THREE.WebGLProgram: shader error: ",s.getError(),"35715",s.getProgramParameter(S,35715),"gl.getProgramInfoLog",k,H,j)):""!==k?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",k):""!==H&&""!==j||(D=!1),D&&(this.diagnostics={runnable:F,material:r,programLog:k,vertexShader:{log:H,prefix:m},fragmentShader:{log:j,prefix:g}}),s.deleteShader(A),s.deleteShader(C),this.getUniforms=function(){return void 0===O&&(O=new fn(s,S,e)),O},this.getAttributes=function(){return void 0===L&&(L=function(e,t){for(var i={},r=e.getProgramParameter(t,35721),n=0;n<r;n++){var o=e.getActiveAttrib(t,n).name;i[o]=e.getAttribLocation(t,o)}return i}(s,S)),L},this.destroy=function(){s.deleteProgram(S),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),this.name=n.name,this.id=gn++,this.code=i,this.usedTimes=1,this.program=S,this.vertexShader=A,this.fragmentShader=C,this}function Mn(e,t,i){var r=[],n={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},o=["precision","supportsVertexTextures","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","useColorMapping","useBaseQuaternion"];function a(e,t){var i;return e?e.isTexture?i=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),i=e.texture.encoding):i=xt,i===xt&&t&&(i=wt),i}this.getParameters=function(t,r,o,s,l,c,u){var h=n[t.type],p=u.isSkinnedMesh?function(e){var t=e.skeleton.bones;if(i.floatVertexTextures)return 1024;var r=i.maxVertexUniforms,n=Math.floor((r-20)/4),o=Math.min(n,t.length);return o<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+o+"."),0):o}(u):0,d=i.precision;null!==t.precision&&(d=i.getMaxPrecision(t.precision))!==t.precision&&console.warn("THREE.WebGLProgram.getParameters:",t.precision,"not supported, using",d,"instead.");var f=e.getRenderTarget();return{shaderID:h,precision:d,supportsVertexTextures:i.vertexTextures,outputEncoding:a(f?f.texture:null,e.gammaOutput),map:!!t.map,mapEncoding:a(t.map,e.gammaInput),matcap:!!t.matcap,matcapEncoding:a(t.matcap,e.gammaInput),envMap:!!t.envMap,envMapMode:t.envMap&&t.envMap.mapping,envMapEncoding:a(t.envMap,e.gammaInput),envMapCubeUV:!!t.envMap&&(t.envMap.mapping===me||t.envMap.mapping===ge),lightMap:!!t.lightMap,aoMap:!!t.aoMap,emissiveMap:!!t.emissiveMap,emissiveMapEncoding:a(t.emissiveMap,e.gammaInput),bumpMap:!!t.bumpMap,normalMap:!!t.normalMap,objectSpaceNormalMap:t.normalMapType===Ot,displacementMap:!!t.displacementMap,roughnessMap:!!t.roughnessMap,metalnessMap:!!t.metalnessMap,specularMap:!!t.specularMap,alphaMap:!!t.alphaMap,gradientMap:!!t.gradientMap,combine:t.combine,vertexColors:t.vertexColors,fog:!!s,useFog:t.fog,fogExp:s&&s.isFogExp2,flatShading:t.flatShading,sizeAttenuation:t.sizeAttenuation,logarithmicDepthBuffer:i.logarithmicDepthBuffer,skinning:t.skinning&&p>0,maxBones:p,useVertexTexture:i.floatVertexTextures,morphTargets:t.morphTargets,morphNormals:t.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:r.directional.length,numPointLights:r.point.length,numSpotLights:r.spot.length,numRectAreaLights:r.rectArea.length,numHemiLights:r.hemi.length,numClippingPlanes:l,numClipIntersection:c,dithering:t.dithering,shadowMapEnabled:e.shadowMap.enabled&&u.receiveShadow&&o.length>0,shadowMapType:e.shadowMap.type,toneMapping:e.toneMapping,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:t.premultipliedAlpha,alphaTest:t.alphaTest,doubleSided:t.side===x,flipSided:t.side===_,useColorMapping:!!t.colorMapping,useBaseQuaternion:!!t.baseQuaternion,depthPacking:void 0!==t.depthPacking&&t.depthPacking}},this.getProgramCode=function(t,i){var r=[];if(i.shaderID?r.push(i.shaderID):(r.push(t.fragmentShader),r.push(t.vertexShader)),void 0!==t.defines)for(var n in t.defines)r.push(n),r.push(t.defines[n]);for(var a=0;a<o.length;a++)r.push(i[o[a]]);return r.push(t.onBeforeCompile.toString()),r.push(e.gammaOutput),r.push(e.gammaFactor),r.join()},this.acquireProgram=function(n,o,a,s){for(var l,c=0,u=r.length;c<u;c++){var h=r[c];if(h.code===s){++(l=h).usedTimes;break}}return void 0===l&&(l=new Sn(e,t,s,n,o,a,i),r.push(l)),l},this.releaseProgram=function(e){if(0==--e.usedTimes){var t=r.indexOf(e);r[t]=r[r.length-1],r.pop(),e.destroy()}},this.programs=r}function Rn(){var e=new WeakMap;return{get:function(t){var i=e.get(t);return void 0===i&&(i={},e.set(t,i)),i},remove:function(t){e.delete(t)},update:function(t,i,r){e.get(t)[i]=r},dispose:function(){e=new WeakMap}}}function Pn(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program&&t.program&&e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function An(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.material.id!==t.material.id?e.material.id-t.material.id:e.id-t.id}function Cn(){var e=[],t=0,i=[],r=[];function n(i,r,n,o,a,s){var l=e[t];return void 0===l?(l={id:i.id,object:i,geometry:r,material:n,program:n.program,groupOrder:o,renderOrder:i.renderOrder,z:a,group:s},e[t]=l):(l.id=i.id,l.object=i,l.geometry=r,l.material=n,l.program=n.program,l.groupOrder=o,l.renderOrder=i.renderOrder,l.z=a,l.group=s),t++,l}return{opaque:i,transparent:r,init:function(){t=0,i.length=0,r.length=0},push:function(e,t,o,a,s,l){var c=n(e,t,o,a,s,l);(!0===o.transparent?r:i).push(c)},unshift:function(e,t,o,a,s,l){var c=n(e,t,o,a,s,l);(!0===o.transparent?r:i).unshift(c)},sort:function(){i.length>1&&i.sort(Pn),r.length>1&&r.sort(An)}}}function On(){var e={};function t(i){var r=i.target;r.removeEventListener("dispose",t),delete e[r.id]}return{get:function(i,r){var n,o=e[i.id];return void 0===o?(n=new Cn,e[i.id]={},e[i.id][r.id]=n,i.addEventListener("dispose",t)):void 0===(n=o[r.id])&&(n=new Cn,o[r.id]=n),n},dispose:function(){e={}}}}function Ln(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var i;switch(t.type){case"DirectionalLight":i={direction:new Ft,color:new ci,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new kt};break;case"SpotLight":i={position:new Ft,direction:new Ft,color:new ci,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new kt};break;case"PointLight":i={position:new Ft,color:new ci,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new kt,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":i={direction:new Ft,skyColor:new ci,groundColor:new ci};break;case"RectAreaLight":i={color:new ci,position:new Ft,halfWidth:new Ft,halfHeight:new Ft}}return e[t.id]=i,i}}}var kn=0;function Hn(){var e=new Ln,t={id:kn++,hash:{stateID:-1,directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,shadowsLength:-1},ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},i=new Ft,r=new Ht,n=new Ht;return{setup:function(o,a,s){for(var l=0,c=0,u=0,h=0,p=0,d=0,f=0,m=0,g=s.matrixWorldInverse,v=0,y=o.length;v<y;v++){var b=o[v],_=b.color,x=b.intensity,E=b.distance,w=b.shadow&&b.shadow.map?b.shadow.map.texture:null;if(b.isAmbientLight)l+=_.r*x,c+=_.g*x,u+=_.b*x;else if(b.isDirectionalLight){if((S=e.get(b)).color.copy(b.color).multiplyScalar(b.intensity),S.direction.setFromMatrixPosition(b.matrixWorld),i.setFromMatrixPosition(b.target.matrixWorld),S.direction.sub(i),S.direction.transformDirection(g),S.shadow=b.castShadow,b.castShadow){var T=b.shadow;S.shadowBias=T.bias,S.shadowRadius=T.radius,S.shadowMapSize=T.mapSize}t.directionalShadowMap[h]=w,t.directionalShadowMatrix[h]=b.shadow.matrix,t.directional[h]=S,h++}else if(b.isSpotLight){if((S=e.get(b)).position.setFromMatrixPosition(b.matrixWorld),S.position.applyMatrix4(g),S.color.copy(_).multiplyScalar(x),S.distance=E,S.direction.setFromMatrixPosition(b.matrixWorld),i.setFromMatrixPosition(b.target.matrixWorld),S.direction.sub(i),S.direction.transformDirection(g),S.coneCos=Math.cos(b.angle),S.penumbraCos=Math.cos(b.angle*(1-b.penumbra)),S.decay=b.decay,S.shadow=b.castShadow,b.castShadow){T=b.shadow;S.shadowBias=T.bias,S.shadowRadius=T.radius,S.shadowMapSize=T.mapSize}t.spotShadowMap[d]=w,t.spotShadowMatrix[d]=b.shadow.matrix,t.spot[d]=S,d++}else if(b.isRectAreaLight){(S=e.get(b)).color.copy(_).multiplyScalar(x),S.position.setFromMatrixPosition(b.matrixWorld),S.position.applyMatrix4(g),n.identity(),r.copy(b.matrixWorld),r.premultiply(g),n.extractRotation(r),S.halfWidth.set(.5*b.width,0,0),S.halfHeight.set(0,.5*b.height,0),S.halfWidth.applyMatrix4(n),S.halfHeight.applyMatrix4(n),t.rectArea[f]=S,f++}else if(b.isPointLight){if((S=e.get(b)).position.setFromMatrixPosition(b.matrixWorld),S.position.applyMatrix4(g),S.color.copy(b.color).multiplyScalar(b.intensity),S.distance=b.distance,S.decay=b.decay,S.shadow=b.castShadow,b.castShadow){T=b.shadow;S.shadowBias=T.bias,S.shadowRadius=T.radius,S.shadowMapSize=T.mapSize,S.shadowCameraNear=T.camera.near,S.shadowCameraFar=T.camera.far}t.pointShadowMap[p]=w,t.pointShadowMatrix[p]=b.shadow.matrix,t.point[p]=S,p++}else if(b.isHemisphereLight){var S;(S=e.get(b)).direction.setFromMatrixPosition(b.matrixWorld),S.direction.transformDirection(g),S.direction.normalize(),S.skyColor.copy(b.color).multiplyScalar(x),S.groundColor.copy(b.groundColor).multiplyScalar(x),t.hemi[m]=S,m++}}t.ambient[0]=l,t.ambient[1]=c,t.ambient[2]=u,t.directional.length=h,t.spot.length=d,t.rectArea.length=f,t.point.length=p,t.hemi.length=m,t.hash.stateID=t.id,t.hash.directionalLength=h,t.hash.pointLength=p,t.hash.spotLength=d,t.hash.rectAreaLength=f,t.hash.hemiLength=m,t.hash.shadowsLength=a.length},state:t}}function jn(){var e=new Hn,t=[],i=[];return{init:function(){t.length=0,i.length=0},state:{lightsArray:t,shadowsArray:i,lights:e},setupLights:function(r){e.setup(t,i,r)},pushLight:function(e){t.push(e)},pushShadow:function(e){i.push(e)}}}function Fn(){var e={};function t(i){var r=i.target;r.removeEventListener("dispose",t),delete e[r.id]}return{get:function(i,r){var n;return void 0===e[i.id]?(n=new jn,e[i.id]={},e[i.id][r.id]=n,i.addEventListener("dispose",t)):void 0===e[i.id][r.id]?(n=new jn,e[i.id][r.id]=n):n=e[i.id][r.id],n},dispose:function(){e={}}}}function Dn(e){or.call(this),this.type="MeshDepthMaterial",this.depthPacking=Pt,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(e)}function Bn(e){or.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Ft,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.lights=!1,this.setValues(e)}function In(e,t,i){for(var r=new ei,n=new Ht,o=new kt,a=new kt(i,i),s=new Ft,l=new Ft,c=1,u=2,h=1+(c|u),p=new Array(h),d=new Array(h),f={},m={0:_,1:b,2:x},g=[new Ft(1,0,0),new Ft(-1,0,0),new Ft(0,0,1),new Ft(0,0,-1),new Ft(0,1,0),new Ft(0,-1,0)],y=[new Ft(0,1,0),new Ft(0,1,0),new Ft(0,1,0),new Ft(0,1,0),new Ft(0,0,1),new Ft(0,0,-1)],E=[new Gt,new Gt,new Gt,new Gt,new Gt,new Gt],w=0;w!==h;++w){var T=0!=(w&c),M=0!=(w&u),R=new Dn({depthPacking:At,morphTargets:T,skinning:M});p[w]=R;var P=new Bn({morphTargets:T,skinning:M});d[w]=P}var A=this;function C(t,i,r,n,o,a){var s=t.geometry,l=null,h=p,g=t.customDepthMaterial;if(r&&(h=d,g=t.customDistanceMaterial),g)l=g;else{var v=!1;i.morphTargets&&(s&&s.isBufferGeometry?v=s.morphAttributes&&s.morphAttributes.position&&s.morphAttributes.position.length>0:s&&s.isGeometry&&(v=s.morphTargets&&s.morphTargets.length>0)),t.isSkinnedMesh&&!1===i.skinning&&console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t);var y=t.isSkinnedMesh&&i.skinning,b=0;v&&(b|=c),y&&(b|=u),l=h[b]}if(e.localClippingEnabled&&!0===i.clipShadows&&0!==i.clippingPlanes.length){var _=l.uuid,x=i.uuid,E=f[_];void 0===E&&(E={},f[_]=E);var w=E[x];void 0===w&&(w=l.clone(),E[x]=w),l=w}return l.visible=i.visible,l.wireframe=i.wireframe,l.side=null!=i.shadowSide?i.shadowSide:m[i.side],l.clipShadows=i.clipShadows,l.clippingPlanes=i.clippingPlanes,l.clipIntersection=i.clipIntersection,l.wireframeLinewidth=i.wireframeLinewidth,l.linewidth=i.linewidth,r&&l.isMeshDistanceMaterial&&(l.referencePosition.copy(n),l.nearDistance=o,l.farDistance=a),l}function O(i,n,o,a){if(!1!==i.visible){if(i.layers.test(n.layers)&&(i.isMesh||i.isLine||i.isPoints)&&i.castShadow&&(!i.frustumCulled||r.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,i.matrixWorld);var s=t.update(i),c=i.material;if(Array.isArray(c))for(var u=s.groups,h=0,p=u.length;h<p;h++){var d=u[h],f=c[d.materialIndex];if(f&&f.visible){var m=C(i,f,a,l,o.near,o.far);e.renderBufferDirect(o,null,s,m,i,d)}}else if(c.visible){m=C(i,c,a,l,o.near,o.far);e.renderBufferDirect(o,null,s,m,i,null)}}for(var g=i.children,v=0,y=g.length;v<y;v++)O(g[v],n,o,a)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=v,this.render=function(t,i,c){if(!1!==A.enabled&&(!1!==A.autoUpdate||!1!==A.needsUpdate)&&0!==t.length){var u,h=e.state;h.setBlending(S),h.buffers.color.setClear(1,1,1,1),h.buffers.depth.setTest(!0),h.setScissorTest(!1);for(var p=0,d=t.length;p<d;p++){var f=t[p],m=f.shadow,v=f&&f.isPointLight;if(void 0!==m){var b=m.camera;if(o.copy(m.mapSize),o.min(a),v){var _=o.x,x=o.y;E[0].set(2*_,x,_,x),E[1].set(0,x,_,x),E[2].set(3*_,x,_,x),E[3].set(_,x,_,x),E[4].set(3*_,0,_,x),E[5].set(_,0,_,x),o.x*=4,o.y*=2}if(null===m.map){var w={minFilter:_e,magFilter:_e,format:Ne};m.map=new Xt(o.x,o.y,w),m.map.texture.name=f.name+".shadowMap",b.updateProjectionMatrix()}m.isSpotLightShadow&&m.update(f);var T=m.map,M=m.matrix;l.setFromMatrixPosition(f.matrixWorld),b.position.copy(l),v?(u=6,M.makeTranslation(-l.x,-l.y,-l.z)):(u=1,s.setFromMatrixPosition(f.target.matrixWorld),b.lookAt(s),b.updateMatrixWorld(),M.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),M.multiply(b.projectionMatrix),M.multiply(b.matrixWorldInverse)),e.setRenderTarget(T),e.clear();for(var R=0;R<u;R++){if(v){s.copy(b.position),s.add(g[R]),b.up.copy(y[R]),b.lookAt(s),b.updateMatrixWorld();var P=E[R];h.viewport(P)}n.multiplyMatrices(b.projectionMatrix,b.matrixWorldInverse),r.setFromMatrix(n),O(i,c,b,v)}}else console.warn("THREE.WebGLShadowMap:",f,"has no shadow.")}A.needsUpdate=!1}}}function Nn(e,t,i,r){var n=new function(){var t=!1,i=new Gt,r=null,n=new Gt(0,0,0,0);return{setMask:function(i){r===i||t||(e.colorMask(i,i,i,i),r=i)},setLocked:function(e){t=e},setClear:function(t,r,o,a,s){!0===s&&(t*=a,r*=a,o*=a),i.set(t,r,o,a),!1===n.equals(i)&&(e.clearColor(t,r,o,a),n.copy(i))},reset:function(){t=!1,r=null,n.set(-1,0,0,0)}}},o=new function(){var t=!1,i=null,r=null,n=null;return{setTest:function(e){e?oe(2929):ae(2929)},setMask:function(r){i===r||t||(e.depthMask(r),i=r)},setFunc:function(t){if(r!==t){if(t)switch(t){case X:e.depthFunc(512);break;case Y:e.depthFunc(519);break;case Q:e.depthFunc(513);break;case Z:e.depthFunc(515);break;case J:e.depthFunc(514);break;case K:e.depthFunc(518);break;case $:e.depthFunc(516);break;case ee:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);r=t}},setLocked:function(e){t=e},setClear:function(t){n!==t&&(e.clearDepth(t),n=t)},reset:function(){t=!1,i=null,r=null,n=null}}},a=new function(){var t=!1,i=null,r=null,n=null,o=null,a=null,s=null,l=null,c=null;return{setTest:function(e){e?oe(2960):ae(2960)},setMask:function(r){i===r||t||(e.stencilMask(r),i=r)},setFunc:function(t,i,a){r===t&&n===i&&o===a||(e.stencilFunc(t,i,a),r=t,n=i,o=a)},setOp:function(t,i,r){a===t&&s===i&&l===r||(e.stencilOp(t,i,r),a=t,s=i,l=r)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,i=null,r=null,n=null,o=null,a=null,s=null,l=null,c=null}}},s=e.getParameter(34921),l=new Uint8Array(s),c=new Uint8Array(s),u=new Uint8Array(s),h={},p=null,d=null,v=null,y=null,b=null,E=null,w=null,T=null,L=null,k=null,H=!1,j=null,F=null,D=null,B=null,I=null,N=e.getParameter(35661),U=!1,V=0,z=e.getParameter(7938);-1!==z.indexOf("WebGL")?(V=parseFloat(/^WebGL\ ([0-9])/.exec(z)[1]),U=V>=1):-1!==z.indexOf("OpenGL ES")&&(V=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(z)[1]),U=V>=2);var q=null,W={},G=new Gt,te=new Gt;function ie(t,i,r){var n=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(var a=0;a<r;a++)e.texImage2D(i+a,0,6408,1,1,0,6408,5121,n);return o}var re={};function ne(i,n){(l[i]=1,0===c[i]&&(e.enableVertexAttribArray(i),c[i]=1),u[i]!==n)&&((r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](i,n),u[i]=n)}function oe(t){!0!==h[t]&&(e.enable(t),h[t]=!0)}function ae(t){!1!==h[t]&&(e.disable(t),h[t]=!1)}function se(t,r,n,o,a,s,l,c){if(t!==S){if(v||(oe(3042),v=!0),t===C)a=a||r,s=s||n,l=l||o,r===b&&a===T||(e.blendEquationSeparate(i.convert(r),i.convert(a)),b=r,T=a),n===E&&o===w&&s===L&&l===k||(e.blendFuncSeparate(i.convert(n),i.convert(o),i.convert(s),i.convert(l)),E=n,w=o,L=s,k=l),y=t,H=null;else if(t!==y||c!==H){if(b===O&&T===O||(e.blendEquation(32774),b=O,T=O),c)switch(t){case M:e.blendFuncSeparate(1,771,1,771);break;case R:e.blendFunc(1,1);break;case P:e.blendFuncSeparate(0,0,769,771);break;case A:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case M:e.blendFuncSeparate(770,771,1,771);break;case R:e.blendFunc(770,1);break;case P:e.blendFunc(0,769);break;case A:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}E=null,w=null,L=null,k=null,y=t,H=c}}else v&&(ae(3042),v=!1)}function le(t){j!==t&&(t?e.frontFace(2304):e.frontFace(2305),j=t)}function ce(t){t!==f?(oe(2884),t!==F&&(t===m?e.cullFace(1029):t===g?e.cullFace(1028):e.cullFace(1032))):ae(2884),F=t}function ue(t,i,r){t?(oe(32823),B===i&&I===r||(e.polygonOffset(i,r),B=i,I=r)):ae(32823)}function he(t){void 0===t&&(t=33984+N-1),q!==t&&(e.activeTexture(t),q=t)}return re[3553]=ie(3553,3553,1),re[34067]=ie(34067,34069,6),n.setClear(0,0,0,1),o.setClear(1),a.setClear(0),oe(2929),o.setFunc(Z),le(!1),ce(m),oe(2884),se(S),{buffers:{color:n,depth:o,stencil:a},initAttributes:function(){for(var e=0,t=l.length;e<t;e++)l[e]=0},enableAttribute:function(e){ne(e,0)},enableAttributeAndDivisor:ne,disableUnusedAttributes:function(){for(var t=0,i=c.length;t!==i;++t)c[t]!==l[t]&&(e.disableVertexAttribArray(t),c[t]=0)},enable:oe,disable:ae,getCompressedTextureFormats:function(){if(null===p&&(p=[],t.get("WEBGL_compressed_texture_pvrtc")||t.get("WEBGL_compressed_texture_s3tc")||t.get("WEBGL_compressed_texture_etc1")||t.get("WEBGL_compressed_texture_astc")))for(var i=e.getParameter(34467),r=0;r<i.length;r++)p.push(i[r]);return p},useProgram:function(t){return d!==t&&(e.useProgram(t),d=t,!0)},setBlending:se,setMaterial:function(e,t){e.side===x?ae(2884):oe(2884);var i=e.side===_;t&&(i=!i),le(i),e.blending===M&&!1===e.transparent?se(S):se(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),o.setFunc(e.depthFunc),o.setTest(e.depthTest),o.setMask(e.depthWrite),n.setMask(e.colorWrite),ue(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)},setFlipSided:le,setCullFace:ce,setLineWidth:function(t){t!==D&&(U&&e.lineWidth(t),D=t)},setPolygonOffset:ue,setScissorTest:function(e){e?oe(3089):ae(3089)},activeTexture:he,bindTexture:function(t,i){null===q&&he();var r=W[q];void 0===r&&(r={type:void 0,texture:void 0},W[q]=r),r.type===t&&r.texture===i||(e.bindTexture(t,i||re[t]),r.type=t,r.texture=i)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===G.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),G.copy(t))},viewport:function(t){!1===te.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),te.copy(t))},reset:function(){for(var t=0;t<c.length;t++)1===c[t]&&(e.disableVertexAttribArray(t),c[t]=0);h={},p=null,q=null,W={},d=null,y=null,j=null,F=null,n.reset(),o.reset(),a.reset()}}}function Un(e,t,i,r,n,o,a){var s,l={};function c(e,t,i,r){var n=1;if((e.width>r||e.height>r)&&(n=r/Math.max(e.width,e.height)),n<1||!0===t){if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageBitmap){void 0===s&&(s=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"));var o=i?document.createElementNS("http://www.w3.org/1999/xhtml","canvas"):s,a=t?Lt.floorPowerOfTwo:Math.floor;return o.width=a(n*e.width),o.height=a(n*e.height),o.getContext("2d").drawImage(e,0,0,o.width,o.height),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+o.width+"x"+o.height+")."),o}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function u(e){return Lt.isPowerOfTwo(e.width)&&Lt.isPowerOfTwo(e.height)}function h(e,t){return e.generateMipmaps&&t&&e.minFilter!==_e&&e.minFilter!==we}function p(t,i,n,o){e.generateMipmap(t),r.get(i).__maxMipLevel=Math.log(Math.max(n,o))*Math.LOG2E}function d(i,r){if(!n.isWebGL2)return i;var o=i;return 6403===i&&(5126===r&&(o=33326),5131===r&&(o=33325),5121===r&&(o=33321)),6407===i&&(5126===r&&(o=34837),5131===r&&(o=34843),5121===r&&(o=32849)),6408===i&&(5126===r&&(o=34836),5131===r&&(o=34842),5121===r&&(o=32856)),6402===i&&(5123===r&&(o=33189),5125===r&&(o=e.DEPTH_COMPONENT24),5126===r&&(o=36012)),34041===i&&(34042===r&&(o=e.DEPTH24_STENCIL8),r===e.FLOAT_32_UNSIGNED_INT_24_8_REV&&(o=e.DEPTH32F_STENCIL8)),33325===o||33326===o||34842===o||34836===o?t.get("EXT_color_buffer_float"):34843!==o&&34837!==o||console.warn("THREE.WebGLRenderer: Floating point textures with RGB format not supported. Please use RGBA instead."),o}function f(e){return e===_e||e===xe||e===Ee?9728:9729}function m(t){var i=t.target;i.removeEventListener("dispose",m),function(t){var i=r.get(t);if(t.image&&i.__image__webglTextureCube)e.deleteTexture(i.__image__webglTextureCube);else{if(void 0===i.__webglInit)return;e.deleteTexture(i.__webglTexture)}r.remove(t)}(i),i.isVideoTexture&&delete l[i.id],a.memory.textures--}function g(t){var i=t.target;i.removeEventListener("dispose",g),function(t){var i=r.get(t),n=r.get(t.texture);if(!t)return;void 0!==n.__webglTexture&&e.deleteTexture(n.__webglTexture);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLRenderTargetCube)for(var o=0;o<6;o++)e.deleteFramebuffer(i.__webglFramebuffer[o]),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer[o]);else e.deleteFramebuffer(i.__webglFramebuffer),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer);t.isWebGLMultisampleRenderTarget&&(i.__webglMultisampledFramebuffer&&e.deleteFramebuffer(i.__webglSamplingbuffer),i.__webglColorRenderbuffer&&e.deleteRenderbuffer(i.__webglColorRenderbuffer));r.remove(t.texture),r.remove(t)}(i),a.memory.textures--}function v(e,t){var n=r.get(e);if(e.isVideoTexture&&function(e){var t=e.id,i=a.render.frame;l[t]!==i&&(l[t]=i,e.update())}(e),e.version>0&&n.__version!==e.version){var o=e.image;if(void 0===o)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==o.complete)return void b(n,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}i.activeTexture(33984+t),i.bindTexture(3553,n.__webglTexture)}function y(i,a,s){var l;if(s?(e.texParameteri(i,10242,o.convert(a.wrapS)),e.texParameteri(i,10243,o.convert(a.wrapT)),e.texParameteri(i,10240,o.convert(a.magFilter)),e.texParameteri(i,10241,o.convert(a.minFilter))):(e.texParameteri(i,10242,33071),e.texParameteri(i,10243,33071),a.wrapS===ye&&a.wrapT===ye||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(i,10240,f(a.magFilter)),e.texParameteri(i,10241,f(a.minFilter)),a.minFilter!==_e&&a.minFilter!==we&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),l=t.get("EXT_texture_filter_anisotropic")){if(a.type===Le&&null===t.get("OES_texture_float_linear"))return;if(a.type===ke&&null===(n.isWebGL2||t.get("OES_texture_half_float_linear")))return;(a.anisotropy>1||r.get(a).__currentAnisotropy)&&(e.texParameterf(i,l.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,n.getMaxAnisotropy())),r.get(a).__currentAnisotropy=a.anisotropy)}}function b(t,r,s){var l;l=r.isDataTexture3D?32879:3553,void 0===t.__webglInit&&(t.__webglInit=!0,r.addEventListener("dispose",m),t.__webglTexture=e.createTexture(),a.memory.textures++),i.activeTexture(33984+s),i.bindTexture(l,t.__webglTexture),e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment);var f=function(e){return!n.isWebGL2&&(e.wrapS!==ye||e.wrapT!==ye||e.minFilter!==_e&&e.minFilter!==we)}(r)&&!1===u(r.image),g=c(r.image,f,!1,n.maxTextureSize),v=u(g)||n.isWebGL2,b=o.convert(r.format),_=o.convert(r.type),x=d(b,_);y(l,r,v);var E,w=r.mipmaps;if(r.isDepthTexture){if(!n.isWebGL2){if(x=6402,r.type===Le){if(!n.isWebGL2)throw new Error("Float Depth Texture only supported in WebGL2.0");x=36012}else n.isWebGL2&&(x=33189);r.format===qe&&6402===x&&r.type!==Ae&&r.type!==Oe&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=Ae,_=o.convert(r.type)),r.format===We&&(x=34041,r.type!==De&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=De,_=o.convert(r.type)))}i.texImage2D(3553,0,x,g.width,g.height,0,b,_,null)}else if(r.isDataTexture)if(w.length>0&&v){for(var T=0,S=w.length;T<S;T++)E=w[T],i.texImage2D(3553,T,x,E.width,E.height,0,b,_,E.data);r.generateMipmaps=!1,t.__maxMipLevel=w.length-1}else i.texImage2D(3553,0,x,g.width,g.height,0,b,_,g.data),t.__maxMipLevel=0;else if(r.isCompressedTexture){for(T=0,S=w.length;T<S;T++)E=w[T],r.format!==Ne&&r.format!==Ie?i.getCompressedTextureFormats().indexOf(b)>-1?i.compressedTexImage2D(3553,T,x,E.width,E.height,0,E.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):i.texImage2D(3553,T,x,E.width,E.height,0,b,_,E.data);t.__maxMipLevel=w.length-1}else if(r.isDataTexture3D)i.texImage3D(32879,0,x,g.width,g.height,g.depth,0,b,_,g.data),t.__maxMipLevel=0;else if(w.length>0&&v){for(T=0,S=w.length;T<S;T++)E=w[T],i.texImage2D(3553,T,x,b,_,E);r.generateMipmaps=!1,t.__maxMipLevel=w.length-1}else i.texImage2D(3553,0,x,b,_,g),t.__maxMipLevel=0;h(r,v)&&p(3553,r,g.width,g.height),t.__version=r.version,r.onUpdate&&r.onUpdate(r)}function _(t,n,a,s){var l=o.convert(n.texture.format),c=o.convert(n.texture.type),u=d(l,c);i.texImage2D(s,0,u,n.width,n.height,0,l,c,null),e.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,a,s,r.get(n.texture).__webglTexture,0),e.bindFramebuffer(36160,null)}function x(t,i,r){if(e.bindRenderbuffer(36161,t),i.depthBuffer&&!i.stencilBuffer){if(r){var n=w(i);e.renderbufferStorageMultisample(36161,n,33189,i.width,i.height)}else e.renderbufferStorage(36161,33189,i.width,i.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(i.depthBuffer&&i.stencilBuffer){if(r){n=w(i);e.renderbufferStorageMultisample(36161,n,e.DEPTH24_STENCIL8,i.width,i.height)}else e.renderbufferStorage(36161,34041,i.width,i.height);e.framebufferRenderbuffer(36160,33306,36161,t)}else{var a=d(o.convert(i.texture.format),o.convert(i.texture.type));if(r){n=w(i);e.renderbufferStorageMultisample(36161,n,a,i.width,i.height)}else e.renderbufferStorage(36161,a,i.width,i.height)}e.bindRenderbuffer(36161,null)}function E(t){var i=r.get(t),n=!0===t.isWebGLRenderTargetCube;if(t.depthTexture){if(n)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,i){if(i&&i.isWebGLRenderTargetCube)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,t),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),v(i.depthTexture,0);var n=r.get(i.depthTexture).__webglTexture;if(i.depthTexture.format===qe)e.framebufferTexture2D(36160,36096,3553,n,0);else{if(i.depthTexture.format!==We)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,n,0)}}(i.__webglFramebuffer,t)}else if(n){i.__webglDepthbuffer=[];for(var o=0;o<6;o++)e.bindFramebuffer(36160,i.__webglFramebuffer[o]),i.__webglDepthbuffer[o]=e.createRenderbuffer(),x(i.__webglDepthbuffer[o],t)}else e.bindFramebuffer(36160,i.__webglFramebuffer),i.__webglDepthbuffer=e.createRenderbuffer(),x(i.__webglDepthbuffer,t);e.bindFramebuffer(36160,null)}function w(e){return n.isWebGL2&&e.isWebGLMultisampleRenderTarget?Math.min(n.maxSamples,e.samples):0}this.setTexture2D=v,this.setTexture3D=function(e,t){var n=r.get(e);e.version>0&&n.__version!==e.version?b(n,e,t):(i.activeTexture(33984+t),i.bindTexture(32879,n.__webglTexture))},this.setTextureCube=function(t,s){var l=r.get(t);if(6===t.image.length)if(t.version>0&&l.__version!==t.version){l.__image__webglTextureCube||(t.addEventListener("dispose",m),l.__image__webglTextureCube=e.createTexture(),a.memory.textures++),i.activeTexture(33984+s),i.bindTexture(34067,l.__image__webglTextureCube),e.pixelStorei(37440,t.flipY);for(var f=t&&t.isCompressedTexture,g=t.image[0]&&t.image[0].isDataTexture,v=[],b=0;b<6;b++)v[b]=f||g?g?t.image[b].image:t.image[b]:c(t.image[b],!1,!0,n.maxCubemapSize);var _=v[0],x=u(_)||n.isWebGL2,E=o.convert(t.format),w=o.convert(t.type),T=d(E,w);y(34067,t,x);for(b=0;b<6;b++)if(f)for(var S,M=v[b].mipmaps,R=0,P=M.length;R<P;R++)S=M[R],t.format!==Ne&&t.format!==Ie?i.getCompressedTextureFormats().indexOf(E)>-1?i.compressedTexImage2D(34069+b,R,T,S.width,S.height,0,S.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):i.texImage2D(34069+b,R,T,S.width,S.height,0,E,w,S.data);else g?i.texImage2D(34069+b,0,T,v[b].width,v[b].height,0,E,w,v[b].data):i.texImage2D(34069+b,0,T,E,w,v[b]);l.__maxMipLevel=f?M.length-1:0,h(t,x)&&p(34067,t,_.width,_.height),l.__version=t.version,t.onUpdate&&t.onUpdate(t)}else i.activeTexture(33984+s),i.bindTexture(34067,l.__image__webglTextureCube)},this.setTextureCubeDynamic=function(e,t){i.activeTexture(33984+t),i.bindTexture(34067,r.get(e).__webglTexture)},this.setupRenderTarget=function(t){var s=r.get(t),l=r.get(t.texture);t.addEventListener("dispose",g),l.__webglTexture=e.createTexture(),a.memory.textures++;var c=!0===t.isWebGLRenderTargetCube,f=!0===t.isWebGLMultisampleRenderTarget,m=u(t)||n.isWebGL2;if(c){s.__webglFramebuffer=[];for(var v=0;v<6;v++)s.__webglFramebuffer[v]=e.createFramebuffer()}else if(s.__webglFramebuffer=e.createFramebuffer(),f)if(n.isWebGL2){s.__webglMultisampledFramebuffer=e.createFramebuffer(),s.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,s.__webglColorRenderbuffer);var b=d(o.convert(t.texture.format),o.convert(t.texture.type)),T=w(t);e.renderbufferStorageMultisample(36161,T,b,t.width,t.height),e.bindFramebuffer(36160,s.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,s.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),t.depthBuffer&&(s.__webglDepthRenderbuffer=e.createRenderbuffer(),x(s.__webglDepthRenderbuffer,t,!0)),e.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(c){i.bindTexture(34067,l.__webglTexture),y(34067,t.texture,m);for(v=0;v<6;v++)_(s.__webglFramebuffer[v],t,36064,34069+v);h(t.texture,m)&&p(34067,t.texture,t.width,t.height),i.bindTexture(34067,null)}else i.bindTexture(3553,l.__webglTexture),y(3553,t.texture,m),_(s.__webglFramebuffer,t,36064,3553),h(t.texture,m)&&p(3553,t.texture,t.width,t.height),i.bindTexture(3553,null);t.depthBuffer&&E(t)},this.updateRenderTargetMipmap=function(e){var t=e.texture;if(h(t,u(e)||n.isWebGL2)){var o=e.isWebGLRenderTargetCube?34067:3553,a=r.get(t).__webglTexture;i.bindTexture(o,a),p(o,t,e.width,e.height),i.bindTexture(o,null)}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(n.isWebGL2){var i=r.get(t);e.bindFramebuffer(36008,i.__webglMultisampledFramebuffer),e.bindFramebuffer(36009,i.__webglFramebuffer);var o=t.width,a=t.height,s=16384;t.depthBuffer&&(s|=256),t.stencilBuffer&&(s|=1024),e.blitFramebuffer(0,0,o,a,0,0,o,a,s,9728)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")}}function Vn(e,t,i){return{convert:function(e){var r;if(e===ve)return 10497;if(e===ye)return 33071;if(e===be)return 33648;if(e===_e)return 9728;if(e===xe)return 9984;if(e===Ee)return 9986;if(e===we)return 9729;if(e===Te)return 9985;if(e===Se)return 9987;if(e===Me)return 5121;if(e===He)return 32819;if(e===je)return 32820;if(e===Fe)return 33635;if(e===Re)return 5120;if(e===Pe)return 5122;if(e===Ae)return 5123;if(e===Ce)return 5124;if(e===Oe)return 5125;if(e===Le)return 5126;if(e===ke){if(i.isWebGL2)return 5131;if(null!==(r=t.get("OES_texture_half_float")))return r.HALF_FLOAT_OES}if(e===Be)return 6406;if(e===Ie)return 6407;if(e===Ne)return 6408;if(e===Ue)return 6409;if(e===Ve)return 6410;if(e===qe)return 6402;if(e===We)return 34041;if(e===Ge)return 6403;if(e===O)return 32774;if(e===L)return 32778;if(e===k)return 32779;if(e===F)return 0;if(e===D)return 1;if(e===B)return 768;if(e===I)return 769;if(e===N)return 770;if(e===U)return 771;if(e===V)return 772;if(e===z)return 773;if(e===q)return 774;if(e===W)return 775;if(e===G)return 776;if((e===Xe||e===Ye||e===Qe||e===Ze)&&null!==(r=t.get("WEBGL_compressed_texture_s3tc"))){if(e===Xe)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===Ye)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===Qe)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===Ze)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((e===Je||e===Ke||e===$e||e===et)&&null!==(r=t.get("WEBGL_compressed_texture_pvrtc"))){if(e===Je)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===Ke)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===$e)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===et)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===tt&&null!==(r=t.get("WEBGL_compressed_texture_etc1")))return r.COMPRESSED_RGB_ETC1_WEBGL;if((e===it||e===rt||e===nt||e===ot||e===at||e===st||e===lt||e===ct||e===ut||e===ht||e===pt||e===dt||e===ft||e===mt)&&null!==(r=t.get("WEBGL_compressed_texture_astc")))return e;if(e===H||e===j){if(i.isWebGL2){if(e===H)return 32775;if(e===j)return 32776}if(null!==(r=t.get("EXT_blend_minmax"))){if(e===H)return r.MIN_EXT;if(e===j)return r.MAX_EXT}}if(e===De){if(i.isWebGL2)return 34042;if(null!==(r=t.get("WEBGL_depth_texture")))return r.UNSIGNED_INT_24_8_WEBGL}return 0}}}function zn(){wi.call(this),this.type="Group"}function qn(){wi.call(this),this.type="Camera",this.matrixWorldInverse=new Ht,this.projectionMatrix=new Ht,this.projectionMatrixInverse=new Ht}function Wn(e,t,i,r){qn.call(this),this.type="PerspectiveCamera",this.fov=void 0!==e?e:50,this.zoom=1,this.near=void 0!==i?i:.1,this.far=void 0!==r?r:2e3,this.focus=10,this.aspect=void 0!==t?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function Gn(e){Wn.call(this),this.cameras=e||[]}Dn.prototype=Object.create(or.prototype),Dn.prototype.constructor=Dn,Dn.prototype.isMeshDepthMaterial=!0,Dn.prototype.copy=function(e){return or.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},Bn.prototype=Object.create(or.prototype),Bn.prototype.constructor=Bn,Bn.prototype.isMeshDistanceMaterial=!0,Bn.prototype.copy=function(e){return or.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this},zn.prototype=Object.assign(Object.create(wi.prototype),{constructor:zn,isGroup:!0}),qn.prototype=Object.assign(Object.create(wi.prototype),{constructor:qn,isCamera:!0,copy:function(e,t){return wi.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new Ft),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){wi.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),Wn.prototype=Object.assign(Object.create(qn.prototype),{constructor:Wn,isPerspectiveCamera:!0,copy:function(e,t){return qn.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*Lt.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*Lt.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*Lt.RAD2DEG*Math.atan(Math.tan(.5*Lt.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,i,r,n,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*Lt.DEG2RAD*this.fov)/this.zoom,i=2*t,r=this.aspect*i,n=-.5*r,o=this.view;if(null!==this.view&&this.view.enabled){var a=o.fullWidth,s=o.fullHeight;n+=o.offsetX*r/a,t-=o.offsetY*i/s,r*=o.width/a,i*=o.height/s}var l=this.filmOffset;0!==l&&(n+=e*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+r,t,t-i,e,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=wi.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}),Gn.prototype=Object.assign(Object.create(Wn.prototype),{constructor:Gn,isArrayCamera:!0});var Xn,Yn,Qn,Zn,Jn,Kn,$n=new Ft,eo=new Ft;function to(e,t,i){$n.setFromMatrixPosition(t.matrixWorld),eo.setFromMatrixPosition(i.matrixWorld);var r=$n.distanceTo(eo),n=t.projectionMatrix.elements,o=i.projectionMatrix.elements,a=n[14]/(n[10]-1),s=n[14]/(n[10]+1),l=(n[9]+1)/n[5],c=(n[9]-1)/n[5],u=(n[8]-1)/n[0],h=(o[8]+1)/o[0],p=a*u,d=a*h,f=r/(-u+h),m=f*-u;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.getInverse(e.matrixWorld);var g=a+f,v=s+f,y=p-m,b=d+(r-m),_=l*s/v*g,x=c*s/v*g;e.projectionMatrix.makePerspective(y,b,_,x,g,v)}function io(e){var t=this,i=null,r=null,n=null,o=[],a=new Ht,s=new Ht,l=1,c="stage";"undefined"!=typeof window&&"VRFrameData"in window&&(r=new window.VRFrameData,window.addEventListener("vrdisplaypresentchange",b,!1));var u=new Ht,h=new jt,p=new Ft,d=new Wn;d.bounds=new Gt(0,0,.5,1),d.layers.enable(1);var f=new Wn;f.bounds=new Gt(.5,0,.5,1),f.layers.enable(2);var m,g,v=new Gn([d,f]);function y(){return null!==i&&!0===i.isPresenting}function b(){if(y()){var r=i.getEyeParameters("left"),n=r.renderWidth*l,o=r.renderHeight*l;g=e.getPixelRatio(),m=e.getSize(),e.setDrawingBufferSize(2*n,o,1),E.start()}else t.enabled&&e.setDrawingBufferSize(m.width,m.height,g),E.stop()}v.layers.enable(1),v.layers.enable(2);var _=[];function x(e){for(var t=navigator.getGamepads&&navigator.getGamepads(),i=0,r=0,n=t.length;i<n;i++){var o=t[i];if(o&&("Daydream Controller"===o.id||"Gear VR Controller"===o.id||"Oculus Go Controller"===o.id||"OpenVR Gamepad"===o.id||o.id.startsWith("Oculus Touch")||o.id.startsWith("Spatial Controller"))){if(r===e)return o;r++}}}this.enabled=!1,this.getController=function(e){var t=o[e];return void 0===t&&((t=new zn).matrixAutoUpdate=!1,t.visible=!1,o[e]=t),t},this.getDevice=function(){return i},this.setDevice=function(e){void 0!==e&&(i=e),E.setContext(e)},this.setFramebufferScaleFactor=function(e){l=e},this.setFrameOfReferenceType=function(e){c=e},this.setPoseTarget=function(e){void 0!==e&&(n=e)},this.getCamera=function(e){var t="stage"===c?1.6:0;if(null===i)return e.position.set(0,t,0),e;if(i.depthNear=e.near,i.depthFar=e.far,i.getFrameData(r),"stage"===c){var l=i.stageParameters;l?a.fromArray(l.sittingToStandingTransform):a.makeTranslation(0,t,0)}var m=r.pose,g=null!==n?n:e;if(g.matrix.copy(a),g.matrix.decompose(g.position,g.quaternion,g.scale),null!==m.orientation&&(h.fromArray(m.orientation),g.quaternion.multiply(h)),null!==m.position&&(h.setFromRotationMatrix(a),p.fromArray(m.position),p.applyQuaternion(h),g.position.add(p)),g.updateMatrixWorld(),!1===i.isPresenting)return e;d.near=e.near,f.near=e.near,d.far=e.far,f.far=e.far,d.matrixWorldInverse.fromArray(r.leftViewMatrix),f.matrixWorldInverse.fromArray(r.rightViewMatrix),s.getInverse(a),"stage"===c&&(d.matrixWorldInverse.multiply(s),f.matrixWorldInverse.multiply(s));var y=g.parent;null!==y&&(u.getInverse(y.matrixWorld),d.matrixWorldInverse.multiply(u),f.matrixWorldInverse.multiply(u)),d.matrixWorld.getInverse(d.matrixWorldInverse),f.matrixWorld.getInverse(f.matrixWorldInverse),d.projectionMatrix.fromArray(r.leftProjectionMatrix),f.projectionMatrix.fromArray(r.rightProjectionMatrix),to(v,d,f);var b=i.getLayers();if(b.length){var E=b[0];null!==E.leftBounds&&4===E.leftBounds.length&&d.bounds.fromArray(E.leftBounds),null!==E.rightBounds&&4===E.rightBounds.length&&f.bounds.fromArray(E.rightBounds)}return function(){for(var e=0;e<o.length;e++){var t=o[e],i=x(e);if(void 0!==i&&void 0!==i.pose){if(null===i.pose)return;var r=i.pose;!1===r.hasPosition&&t.position.set(.2,-.6,-.05),null!==r.position&&t.position.fromArray(r.position),null!==r.orientation&&t.quaternion.fromArray(r.orientation),t.matrix.compose(t.position,t.quaternion,t.scale),t.matrix.premultiply(a),t.matrix.decompose(t.position,t.quaternion,t.scale),t.matrixWorldNeedsUpdate=!0,t.visible=!0;var n="Daydream Controller"===i.id?0:1;_[e]!==i.buttons[n].pressed&&(_[e]=i.buttons[n].pressed,!0===_[e]?t.dispatchEvent({type:"selectstart"}):(t.dispatchEvent({type:"selectend"}),t.dispatchEvent({type:"select"})))}else t.visible=!1}}(),v},this.getStandingMatrix=function(){return a},this.isPresenting=y;var E=new di;this.setAnimationLoop=function(e){E.setAnimationLoop(e)},this.submitFrame=function(){y()&&i.submitFrame()},this.dispose=function(){"undefined"!=typeof window&&window.removeEventListener("vrdisplaypresentchange",b)}}function ro(e){var t=e.context,i=null,r=null,n=1,o=null,a="stage",s=null,l=[],c=[];function u(){return null!==r&&null!==o}var h=new Wn;h.layers.enable(1),h.viewport=new Gt;var p=new Wn;p.layers.enable(2),p.viewport=new Gt;var d=new Gn([h,p]);function f(e){var t=l[c.indexOf(e.inputSource)];t&&t.dispatchEvent({type:e.type})}function m(){e.setFramebuffer(null),y.stop()}function g(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.getInverse(e.matrixWorld)}d.layers.enable(1),d.layers.enable(2),this.enabled=!1,this.getController=function(e){var t=l[e];return void 0===t&&((t=new zn).matrixAutoUpdate=!1,t.visible=!1,l[e]=t),t},this.getDevice=function(){return i},this.setDevice=function(e){void 0!==e&&(i=e),e instanceof XRDevice&&t.setCompatibleXRDevice(e)},this.setFramebufferScaleFactor=function(e){n=e},this.setFrameOfReferenceType=function(e){a=e},this.setSession=function(i){null!==(r=i)&&(r.addEventListener("select",f),r.addEventListener("selectstart",f),r.addEventListener("selectend",f),r.addEventListener("end",m),r.baseLayer=new XRWebGLLayer(r,t,{framebufferScaleFactor:n}),r.requestFrameOfReference(a).then(function(t){o=t,e.setFramebuffer(r.baseLayer.framebuffer),y.setContext(r),y.start()}),c=r.getInputSources(),r.addEventListener("inputsourceschange",function(){c=r.getInputSources(),console.log(c);for(var e=0;e<l.length;e++){l[e].userData.inputSource=c[e]}}))},this.getCamera=function(e){if(u()){var t=e.parent,i=d.cameras;g(d,t);for(var r=0;r<i.length;r++)g(i[r],t);e.matrixWorld.copy(d.matrixWorld);for(var n=e.children,o=(r=0,n.length);r<o;r++)n[r].updateMatrixWorld(!0);return to(d,h,p),d}return e},this.isPresenting=u;var v=null;var y=new di;y.setAnimationLoop(function(e,t){if(null!==(s=t.getDevicePose(o)))for(var i=r.baseLayer,n=t.views,a=0;a<n.length;a++){var u=n[a],h=i.getViewport(u),p=s.getViewMatrix(u),f=d.cameras[a];f.matrix.fromArray(p).getInverse(f.matrix),f.projectionMatrix.fromArray(u.projectionMatrix),f.viewport.set(h.x,h.y,h.width,h.height),0===a&&d.matrix.copy(f.matrix)}for(a=0;a<l.length;a++){var m=l[a],g=c[a];if(g){var y=t.getInputPose(g,o);if(null!==y){"targetRay"in y?m.matrix.elements=y.targetRay.transformMatrix:"pointerMatrix"in y&&(m.matrix.elements=y.pointerMatrix),m.matrix.decompose(m.position,m.rotation,m.scale),m.visible=!0;continue}}m.visible=!1}v&&v(e)}),this.setAnimationLoop=function(e){v=e},this.dispose=function(){},this.getStandingMatrix=function(){return console.warn("THREE.WebXRManager: getStandingMatrix() is no longer needed."),new THREE.Matrix4},this.submitFrame=function(){}}function no(){var e=new Map;this.$mode=0;var t=this;this.setMode=function(e){t.$mode=e},this.getMode=function(){return t.$mode},this.addStrategy=function(t,i){e.set(t,i)},this.getStrategy=function(){return e.get(t.$mode)},this.hasStrategy=function(t){return e.has(t)}}function oo(e){var t=void 0!==(e=e||{}).canvas?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),i=void 0!==e.context?e.context:null,r=void 0!==e.alpha&&e.alpha,n=void 0===e.depth||e.depth,o=void 0===e.stencil||e.stencil,a=void 0!==e.antialias&&e.antialias,s=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,c=void 0!==e.powerPreference?e.powerPreference:"default",u=null,h=null;this.domElement=t,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=oe,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var p,d,f,m,g,v,y,b,x,E,w,T,S,M,R,P,A,C,O=this,L=!1,k=null,H=null,j=null,F=-1,D={geometry:null,program:null,wireframe:!1},B=null,I=null,N=new Gt,U=new Gt,V=null,z=0,q=t.width,W=t.height,G=1,X=new Gt(0,0,q,W),Y=new Gt(0,0,q,W),Q=!1,Z=new ei,J=new fr,K=!1,$=!1,ee=new Ht,te=new Ft;function ie(){return null===H?G:1}try{var re={alpha:r,depth:n,stencil:o,antialias:a,premultipliedAlpha:s,preserveDrawingBuffer:l,powerPreference:c};if(t.addEventListener("webglcontextlost",ce,!1),t.addEventListener("webglcontextrestored",ue,!1),null===(p=i||t.getContext("webgl",re)||t.getContext("experimental-webgl",re)))throw null!==t.getContext("webgl")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");void 0===p.getShaderPrecisionFormat&&(p.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){console.error("THREE.WebGLRenderer: "+e.message)}function ne(){d=new mr(p),(f=new dr(p,d,e)).isWebGL2||(d.get("WEBGL_depth_texture"),d.get("OES_texture_float"),d.get("OES_texture_half_float"),d.get("OES_texture_half_float_linear"),d.get("OES_standard_derivatives"),d.get("OES_element_index_uint"),d.get("ANGLE_instanced_arrays")),d.get("OES_texture_float_linear"),C=new Vn(p,d,f),(m=new Nn(p,d,C,f)).scissor(U.copy(Y).multiplyScalar(G)),m.viewport(N.copy(X).multiplyScalar(G)),g=new yr(p),v=new Rn,y=new Un(p,d,m,v,f,C,g),b=new fi(p),x=new gr(p,b,g),E=new xr(x,g),R=new _r(p),w=new Mn(O,d,f),T=new On,S=new Fn,M=new hr(O,m,E,s),P=new pr(p,d,g,f),A=new vr(p,d,g,f),g.programs=w.programs,O.context=p,O.capabilities=f,O.extensions=d,O.properties=v,O.renderLists=T,O.state=m,O.info=g}ne();var ae=null;"undefined"!=typeof navigator&&(ae="xr"in navigator?new ro(O):new io(O)),this.vr=ae;var se=new In(O,E,f.maxTextureSize);this.shadowMap=se;var le=new no;function ce(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),L=!0}function ue(){console.log("THREE.WebGLRenderer: Context Restored."),L=!1,ne()}function he(e){var t=e.target;t.removeEventListener("dispose",he),function(e){pe(e),v.remove(e)}(t)}function pe(e){var t=v.get(e).program;e.program=void 0,void 0!==t&&w.releaseProgram(t)}this.materialManager=le,this.getContext=function(){return p},this.getContextAttributes=function(){return p.getContextAttributes()},this.forceContextLoss=function(){var e=d.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=d.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return G},this.setPixelRatio=function(e){void 0!==e&&(G=e,this.setSize(q,W,!1))},this.getSize=function(){return{width:q,height:W}},this.setSize=function(e,i,r){ae.isPresenting()?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(q=e,W=i,t.width=e*G,t.height=i*G,!1!==r&&(t.style.width=e+"px",t.style.height=i+"px"),this.setViewport(0,0,e,i))},this.getDrawingBufferSize=function(){return{width:q*G,height:W*G}},this.setDrawingBufferSize=function(e,i,r){q=e,W=i,G=r,t.width=e*r,t.height=i*r,this.setViewport(0,0,e,i)},this.getCurrentViewport=function(){return N},this.setViewport=function(e,t,i,r){X.set(e,W-t-r,i,r),m.viewport(N.copy(X).multiplyScalar(G))},this.setScissor=function(e,t,i,r){Y.set(e,W-t-r,i,r),m.scissor(U.copy(Y).multiplyScalar(G))},this.setScissorTest=function(e){m.setScissorTest(Q=e)},this.getClearColor=function(){return M.getClearColor()},this.setClearColor=function(){M.setClearColor.apply(M,arguments)},this.getClearAlpha=function(){return M.getClearAlpha()},this.setClearAlpha=function(){M.setClearAlpha.apply(M,arguments)},this.clear=function(e,t,i){var r=0;(void 0===e||e)&&(r|=16384),(void 0===t||t)&&(r|=256),(void 0===i||i)&&(r|=1024),p.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",ce,!1),t.removeEventListener("webglcontextrestored",ue,!1),T.dispose(),S.dispose(),v.dispose(),E.dispose(),ae.dispose(),me.stop()},this.renderBufferImmediate=function(e,t){m.initAttributes();var i=v.get(e);e.hasPositions&&!i.position&&(i.position=p.createBuffer()),e.hasNormals&&!i.normal&&(i.normal=p.createBuffer()),e.hasUvs&&!i.uv&&(i.uv=p.createBuffer()),e.hasColors&&!i.color&&(i.color=p.createBuffer());var r=t.getAttributes();e.hasPositions&&(p.bindBuffer(34962,i.position),p.bufferData(34962,e.positionArray,35048),m.enableAttribute(r.position),p.vertexAttribPointer(r.position,3,5126,!1,0,0)),e.hasNormals&&(p.bindBuffer(34962,i.normal),p.bufferData(34962,e.normalArray,35048),m.enableAttribute(r.normal),p.vertexAttribPointer(r.normal,3,5126,!1,0,0)),e.hasUvs&&(p.bindBuffer(34962,i.uv),p.bufferData(34962,e.uvArray,35048),m.enableAttribute(r.uv),p.vertexAttribPointer(r.uv,2,5126,!1,0,0)),e.hasColors&&(p.bindBuffer(34962,i.color),p.bufferData(34962,e.colorArray,35048),m.enableAttribute(r.color),p.vertexAttribPointer(r.color,3,5126,!1,0,0)),m.disableUnusedAttributes(),p.drawArrays(4,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,i,r,n,o){var a=n.isMesh&&n.normalMatrix.determinant()<0;m.setMaterial(r,a);var s=be(e,t,r,n),l=!1;D.geometry===i.id&&D.program===s.id&&D.wireframe===(!0===r.wireframe)||(D.geometry=i.id,D.program=s.id,D.wireframe=!0===r.wireframe,l=!0),n.morphTargetInfluences&&(R.update(n,i,r,s),l=!0);var c,u=i.index,h=i.attributes.position,g=1;!0===r.wireframe&&(u=x.getWireframeAttribute(i),g=2);var v=P;null!==u&&(c=b.get(u),(v=A).setIndex(c)),l&&(!function(e,t,i){if(i&&i.isInstancedBufferGeometry&!f.isWebGL2&&null===d.get("ANGLE_instanced_arrays"))return void console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");m.initAttributes();var r=i.attributes,n=t.getAttributes(),o=e.defaultAttributeValues;for(var a in n){var s=n[a];if(s>=0){var l=r[a];if(void 0!==l){var c=l.normalized,u=l.itemSize,h=b.get(l);if(void 0===h)continue;var g=h.buffer,v=h.type,y=h.bytesPerElement;if(l.isInterleavedBufferAttribute){var _=l.data,x=_.stride,E=l.offset;_&&_.isInstancedInterleavedBuffer?(m.enableAttributeAndDivisor(s,_.meshPerAttribute),void 0===i.maxInstancedCount&&(i.maxInstancedCount=_.meshPerAttribute*_.count)):m.enableAttribute(s),p.bindBuffer(34962,g),p.vertexAttribPointer(s,u,v,c,x*y,E*y)}else l.isInstancedBufferAttribute?(m.enableAttributeAndDivisor(s,l.meshPerAttribute),void 0===i.maxInstancedCount&&(i.maxInstancedCount=l.meshPerAttribute*l.count)):m.enableAttribute(s),p.bindBuffer(34962,g),p.vertexAttribPointer(s,u,v,c,0,0)}else if(void 0!==o){var w=o[a];if(void 0!==w)switch(w.length){case 2:p.vertexAttrib2fv(s,w);break;case 3:p.vertexAttrib3fv(s,w);break;case 4:p.vertexAttrib4fv(s,w);break;default:p.vertexAttrib1fv(s,w)}}}}m.disableUnusedAttributes()}(r,s,i),null!==u&&p.bindBuffer(34963,c.buffer));var y=1/0;null!==u?y=u.count:void 0!==h&&(y=h.count);var _=i.drawRange.start*g,E=i.drawRange.count*g,w=null!==o?o.start*g:0,T=null!==o?o.count*g:1/0,S=Math.max(_,w),M=Math.min(y,_+E,w+T)-1,C=Math.max(0,M-S+1);if(0!==C){if(n.isMesh)if(!0===r.wireframe)m.setLineWidth(r.wireframeLinewidth*ie()),v.setMode(1);else switch(n.drawMode){case yt:v.setMode(4);break;case bt:v.setMode(5);break;case _t:v.setMode(6)}else if(n.isLine){var O=r.linewidth;void 0===O&&(O=1),m.setLineWidth(O*ie()),n.isLineSegments?v.setMode(1):n.isLineLoop?v.setMode(2):v.setMode(3)}else n.isPoints?v.setMode(0):n.isSprite&&v.setMode(4);i&&i.isInstancedBufferGeometry?i.maxInstancedCount>0&&v.renderInstances(i,S,C):v.render(S,C)}},this.compile=function(e,t){(h=S.get(e,t)).init(),e.traverse(function(e){e.isLight&&(h.pushLight(e),e.castShadow&&h.pushShadow(e))}),h.setupLights(t),e.traverse(function(t){if(t.material)if(Array.isArray(t.material))for(var i=0;i<t.material.length;i++)ye(t.material[i],e.fog,t);else ye(t.material,e.fog,t)})};var de=null;var fe,me=new di;function ge(e,t,i,r){for(var n=0,o=e.length;n<o;n++){var a=e[n],s=a.object,l=a.geometry,c=void 0===r?a.material:r,u=a.group;if(i.isArrayCamera){I=i;for(var p=i.cameras,d=0,f=p.length;d<f;d++){var g=p[d];if(s.layers.test(g.layers)){if("viewport"in g)m.viewport(N.copy(g.viewport));else{var v=g.bounds,y=v.x*q,b=v.y*W,_=v.z*q,x=v.w*W;m.viewport(N.set(y,b,_,x).multiplyScalar(G))}h.setupLights(g),ve(s,t,g,l,c,u)}}}else I=null,ve(s,t,i,l,c,u)}}function ve(e,t,i,r,n,o){var a;a=e.onBeforeRender(O,t,i,r,n,o);var s=e.onBeforeUpdateModelViewMatrix;if(!s||null!==s.call(e,O,t,i,r,a,o)){if(0!==le.$mode){var l=le.getStrategy();l&&(a=l.call(e,this,t,i,r,n,o))}if(null!==a){if(a&&(n=a),h=S.get(t,I||i),e.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){m.setMaterial(n);var c=be(i,t.fog,n,e);D.geometry=null,D.program=null,D.wireframe=!1,function(e,t){e.render(function(e){O.renderBufferImmediate(e,t)})}(e,c)}else O.renderBufferDirect(i,t.fog,r,n,e,o);var u=e.onAfterUpdateModelViewMatrix;u&&null===u.call(e,O,t,i,r,a,o)||(e.onAfterRender(O,t,i,r,n,o),h=S.get(t,I||i))}}}function ye(e,t,i){var r=v.get(e),n=h.state.lights,o=h.state.shadowsArray,a=r.lightsHash,s=n.state.hash,l=w.getParameters(e,n.state,o,t,J.numPlanes,J.numIntersection,i),c=w.getProgramCode(e,l),u=r.program,p=!0;if(void 0===u)e.addEventListener("dispose",he);else if(u.code!==c)pe(e);else if(a.stateID!==s.stateID||a.directionalLength!==s.directionalLength||a.pointLength!==s.pointLength||a.spotLength!==s.spotLength||a.rectAreaLength!==s.rectAreaLength||a.hemiLength!==s.hemiLength||a.shadowsLength!==s.shadowsLength)a.stateID=s.stateID,a.directionalLength=s.directionalLength,a.pointLength=s.pointLength,a.spotLength=s.spotLength,a.rectAreaLength=s.rectAreaLength,a.hemiLength=s.hemiLength,a.shadowsLength=s.shadowsLength,p=!1;else{if(void 0!==l.shaderID)return;p=!1}if(p){if(l.shaderID){var d=pi[l.shaderID];r.shader={name:e.type,uniforms:ii(d.uniforms),vertexShader:d.vertexShader,fragmentShader:d.fragmentShader}}else r.shader={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};e.onBeforeCompile(r.shader,O),c=w.getProgramCode(e,l),u=w.acquireProgram(e,r.shader,l,c),r.program=u,e.program=u}var f=u.getAttributes();if(e.morphTargets){e.numSupportedMorphTargets=0;for(var m=0;m<O.maxMorphTargets;m++)f["morphTarget"+m]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;for(m=0;m<O.maxMorphNormals;m++)f["morphNormal"+m]>=0&&e.numSupportedMorphNormals++}var g=r.shader.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(r.numClippingPlanes=J.numPlanes,r.numIntersection=J.numIntersection,g.clippingPlanes=J.uniform),r.fog=t,void 0===a&&(r.lightsHash=a={}),a.stateID=s.stateID,a.directionalLength=s.directionalLength,a.pointLength=s.pointLength,a.spotLength=s.spotLength,a.rectAreaLength=s.rectAreaLength,a.hemiLength=s.hemiLength,a.shadowsLength=s.shadowsLength,e.lights&&(g.ambientLightColor.value=n.state.ambient,g.directionalLights.value=n.state.directional,g.spotLights.value=n.state.spot,g.rectAreaLights.value=n.state.rectArea,g.pointLights.value=n.state.point,g.hemisphereLights.value=n.state.hemi,g.directionalShadowMap.value=n.state.directionalShadowMap,g.directionalShadowMatrix.value=n.state.directionalShadowMatrix,g.spotShadowMap.value=n.state.spotShadowMap,g.spotShadowMatrix.value=n.state.spotShadowMatrix,g.pointShadowMap.value=n.state.pointShadowMap,g.pointShadowMatrix.value=n.state.pointShadowMatrix);var y=r.program.getUniforms(),b=fn.seqWithValue(y.seq,g);r.uniformsList=b}function be(e,t,i,r){z=0;var n=v.get(i),o=h.state.lights,a=n.lightsHash,s=o.state.hash;if(K&&($||e!==B)){var l=e===B&&i.id===F;J.setState(i.clippingPlanes,i.clipIntersection,i.clipShadows,e,n,l)}!1===i.needsUpdate&&(void 0===n.program?i.needsUpdate=!0:i.fog&&n.fog!==t?i.needsUpdate=!0:(!i.lights||a.stateID===s.stateID&&a.directionalLength===s.directionalLength&&a.pointLength===s.pointLength&&a.spotLength===s.spotLength&&a.rectAreaLength===s.rectAreaLength&&a.hemiLength===s.hemiLength&&a.shadowsLength===s.shadowsLength)&&(void 0===n.numClippingPlanes||n.numClippingPlanes===J.numPlanes&&n.numIntersection===J.numIntersection)||(i.needsUpdate=!0)),i.needsUpdate&&(ye(i,t,r),i.needsUpdate=!1);var c,u,d=!1,g=!1,y=!1,b=n.program,x=b.getUniforms(),E=n.shader.uniforms;if(m.useProgram(b.program)&&(d=!0,g=!0,y=!0),i.id!==F&&(F=i.id,g=!0),d||B!==e){if(x.setValue(p,"projectionMatrix",e.projectionMatrix),f.logarithmicDepthBuffer&&x.setValue(p,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),B!==e&&(B=e,g=!0,y=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshStandardMaterial||i.envMap){var w=x.map.cameraPosition;void 0!==w&&w.setValue(p,te.setFromMatrixPosition(e.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.skinning)&&x.setValue(p,"viewMatrix",e.matrixWorldInverse)}if(i.skinning){x.setOptional(p,r,"bindMatrix"),x.setOptional(p,r,"bindMatrixInverse");var T=r.skeleton;if(T){var S=T.bones,M=r.bindMatrixInverse.clone();if(M.elements[12]=0,M.elements[13]=0,M.elements[14]=0,x.setValue(p,"localBindMatrixInverse",M),f.floatVertexTextures){if(void 0===T.boneTexture){var R=Math.sqrt(4*S.length);R=Lt.ceilPowerOfTwo(R),R=Math.max(R,4);var P=new Float32Array(R*R*4);P.set(T.boneMatrices);var A=new Zt(P,R,R,Ne,Le);A.needsUpdate=!0,T.boneMatrices=P,T.boneTexture=A,T.boneTextureSize=R}x.setValue(p,"boneTexture",T.boneTexture),x.setValue(p,"boneTextureSize",T.boneTextureSize)}else x.setOptional(p,T,"boneMatrices")}}return g&&(x.setValue(p,"toneMappingExposure",O.toneMappingExposure),x.setValue(p,"toneMappingWhitePoint",O.toneMappingWhitePoint),i.lights&&(u=y,(c=E).ambientLightColor.needsUpdate=u,c.directionalLights.needsUpdate=u,c.pointLights.needsUpdate=u,c.spotLights.needsUpdate=u,c.rectAreaLights.needsUpdate=u,c.hemisphereLights.needsUpdate=u),t&&i.fog&&function(e,t){e.fogColor.value=t.color,t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)}(E,t),i.isMeshBasicMaterial?_e(E,i):i.isMeshLambertMaterial?(_e(E,i),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(E,i)):i.isMeshPhongMaterial?(_e(E,i),i.isMeshToonMaterial?function(e,t){xe(e,t),t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(E,i):xe(E,i)):i.isMeshStandardMaterial?(_e(E,i),i.isMeshPhysicalMaterial?function(e,t){Ee(e,t),e.reflectivity.value=t.reflectivity,e.clearCoat.value=t.clearCoat,e.clearCoatRoughness.value=t.clearCoatRoughness}(E,i):Ee(E,i)):i.isMeshMatcapMaterial?(_e(E,i),function(e,t){t.matcap&&(e.matcap.value=t.matcap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===_&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===_&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(E,i)):i.isMeshDepthMaterial?(_e(E,i),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(E,i)):i.isMeshDistanceMaterial?(_e(E,i),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(E,i)):i.isMeshNormalMaterial?(_e(E,i),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===_&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===_&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(E,i)):i.isLineBasicMaterial?(function(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}(E,i),i.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(E,i)):i.isPointsMaterial?function(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity,e.size.value=t.size*G,e.scale.value=.5*W,e.map.value=t.map,null!==t.map&&(!0===t.map.matrixAutoUpdate&&t.map.updateMatrix(),e.uvTransform.value.copy(t.map.matrix))}(E,i):i.isSpriteMaterial?function(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity,e.rotation.value=t.rotation,e.map.value=t.map,null!==t.map&&(!0===t.map.matrixAutoUpdate&&t.map.updateMatrix(),e.uvTransform.value.copy(t.map.matrix))}(E,i):i.isShadowMaterial&&(E.color.value=i.color,E.opacity.value=i.opacity),void 0!==E.ltc_1&&(E.ltc_1.value=hi.LTC_1),void 0!==E.ltc_2&&(E.ltc_2.value=hi.LTC_2),fn.upload(p,n.uniformsList,E,O),i.colorMapping&&x.setValue(p,"colorMapping",i.colorMapping),i.baseQuaternion&&x.setValue(p,"baseQuaternion",i.baseQuaternion)),x.setValue(p,"baseId",i.baseId),i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(fn.upload(p,n.uniformsList,E,O),i.uniformsNeedUpdate=!1),i.isSpriteMaterial&&x.setValue(p,"center",r.center),x.setValue(p,"modelViewMatrix",r.modelViewMatrix),x.setValue(p,"normalMatrix",r.normalMatrix),x.setValue(p,"modelMatrix",r.matrixWorld),b}function _e(e,t){var i;e.opacity.value=t.opacity,t.color&&(e.diffuse.value=t.color),t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.specularMap&&(e.specularMap.value=t.specularMap),t.envMap&&(e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap.isCubeTexture?-1:1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.maxMipLevel.value=v.get(t.envMap).__maxMipLevel),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity),t.map?i=t.map:t.specularMap?i=t.specularMap:t.displacementMap?i=t.displacementMap:t.normalMap?i=t.normalMap:t.bumpMap?i=t.bumpMap:t.roughnessMap?i=t.roughnessMap:t.metalnessMap?i=t.metalnessMap:t.alphaMap?i=t.alphaMap:t.emissiveMap&&(i=t.emissiveMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix)),t.alphaMap&&(!0===t.alphaMap.matrixAutoUpdate&&t.alphaMap.updateMatrix(),e.uvTransform1.value.copy(t.alphaMap.matrix)),t.alphaMap1&&(!0===t.alphaMap1.matrixAutoUpdate&&t.alphaMap1.updateMatrix(),e.uvTransform1.value.copy(t.alphaMap1.matrix)),t.emissiveMap&&(!0===t.emissiveMap.matrixAutoUpdate&&t.emissiveMap.updateMatrix(),e.uvTransform2.value.copy(t.emissiveMap.matrix))}function xe(e,t){e.specular.value=t.specular,e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===_&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===_&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function Ee(e,t){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===_&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===_&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}me.setAnimationLoop(function(e){ae.isPresenting()||de&&de(e)}),"undefined"!=typeof window&&me.setContext(window),this.setAnimationLoop=function(e){de=e,ae.setAnimationLoop(e),me.start()},this.render=function(e,t,i,r){if(t&&t.isCamera){if(!L){D.geometry=null,D.program=null,D.wireframe=!1,F=-1,B=null,!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),ae.enabled&&(t=ae.getCamera(t)),(h=S.get(e,t)).init(),e.onBeforeRender(O,e,t,i),ee.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),Z.setFromMatrix(ee),$=this.localClippingEnabled,K=J.init(this.clippingPlanes,$,t),(u=T.get(e,t)).init(),function e(t,i,r,n){if(!1===t.visible)return;var o=t.layers.test(i.layers);if(o)if(t.isGroup)r=t.renderOrder;else if(t.isLight)h.pushLight(t),t.castShadow&&h.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||Z.intersectsSprite(t)){n&&te.setFromMatrixPosition(t.matrixWorld).applyMatrix4(ee);var a=E.update(t),s=t.material;u.push(t,a,s,r,te.z,null)}}else if(t.isImmediateRenderObject)n&&te.setFromMatrixPosition(t.matrixWorld).applyMatrix4(ee),u.push(t,null,t.material,r,te.z,null);else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.update(t),!t.frustumCulled||Z.intersectsObject(t))){n&&te.setFromMatrixPosition(t.matrixWorld).applyMatrix4(ee);a=E.update(t),s=t.material;if(Array.isArray(s))for(var l=a.groups,c=0,p=l.length;c<p;c++){var d=l[c],f=s[d.materialIndex];f&&f.visible&&u.push(t,a,f,r,te.z,d)}else s.visible&&u.push(t,a,s,r,te.z,null)}var m=t.children;for(c=0,p=m.length;c<p;c++)e(m[c],i,r,n)}(e,t,0,O.sortObjects),!0===O.sortObjects&&u.sort(),K&&J.beginShadows();var n=h.state.shadowsArray;se.render(n,e,t),h.setupLights(t),K&&J.endShadows(),this.info.autoReset&&this.info.reset(),void 0===i&&(i=null),this.setRenderTarget(i),M.render(u,e,t,r);var o=u.opaque,a=u.transparent;if(e.overrideMaterial){var s=e.overrideMaterial;o.length&&ge(o,e,t,s),a.length&&ge(a,e,t,s)}else o.length&&ge(o,e,t),a.length&&ge(a,e,t);i&&(y.updateRenderTargetMipmap(i),y.updateMultisampleRenderTarget(i)),m.buffers.depth.setTest(!0),m.buffers.depth.setMask(!0),m.buffers.color.setMask(!0),m.setPolygonOffset(!1),e.onAfterRender(O,e,t),ae.enabled&&ae.submitFrame(),u=null,h=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.allocTextureUnit=function(){var e=z;return e>=f.maxTextures&&console.warn("THREE.WebGLRenderer: Trying to use "+e+" texture units while this GPU supports only "+f.maxTextures),z+=1,e},this.setTexture2D=(fe=!1,function(e,t){e&&e.isWebGLRenderTarget&&(fe||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),fe=!0),e=e.texture),y.setTexture2D(e,t)}),this.setTexture3D=function(e,t){y.setTexture3D(e,t)},this.setTexture=function(){var e=!1;return function(t,i){e||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),e=!0),y.setTexture2D(t,i)}}(),this.setTextureCube=function(){var e=!1;return function(t,i){t&&t.isWebGLRenderTargetCube&&(e||(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),e=!0),t=t.texture),t&&t.isCubeTexture||Array.isArray(t.image)&&6===t.image.length?y.setTextureCube(t,i):y.setTextureCubeDynamic(t,i)}}(),this.setFramebuffer=function(e){k=e},this.getRenderTarget=function(){return H},this.setRenderTarget=function(e){H=e,e&&void 0===v.get(e).__webglFramebuffer&&y.setupRenderTarget(e);var t=k,i=!1;if(e){var r=v.get(e).__webglFramebuffer;e.isWebGLRenderTargetCube?(t=r[e.activeCubeFace],i=!0):t=e.isWebGLMultisampleRenderTarget?v.get(e).__webglMultisampledFramebuffer:r,N.copy(e.viewport),U.copy(e.scissor),V=e.scissorTest}else N.copy(X).multiplyScalar(G),U.copy(Y).multiplyScalar(G),V=Q;if(j!==t&&(p.bindFramebuffer(36160,t),j=t),m.viewport(N),m.scissor(U),m.setScissorTest(V),i){var n=v.get(e.texture);p.framebufferTexture2D(36160,36064,34069+e.activeCubeFace,n.__webglTexture,e.activeMipMapLevel)}},this.readRenderTargetPixels=function(e,t,i,r,n,o){if(e&&e.isWebGLRenderTarget){var a=v.get(e).__webglFramebuffer;if(a){var s=!1;a!==j&&(p.bindFramebuffer(36160,a),s=!0);try{var l=e.texture,c=l.format,u=l.type;if(c!==Ne&&C.convert(c)!==p.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(u===Me||C.convert(u)===p.getParameter(35738)||u===Le&&(f.isWebGL2||d.get("OES_texture_float")||d.get("WEBGL_color_buffer_float"))||u===ke&&(f.isWebGL2?d.get("EXT_color_buffer_float"):d.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===p.checkFramebufferStatus(36160)?t>=0&&t<=e.width-r&&i>=0&&i<=e.height-n&&p.readPixels(t,i,r,n,C.convert(c),C.convert(u),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{s&&p.bindFramebuffer(36160,j)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t,i){var r=t.image.width,n=t.image.height,o=C.convert(t.format);this.setTexture2D(t,0),p.copyTexImage2D(3553,i||0,o,e.x,e.y,r,n,0)},this.copyTextureToTexture=function(e,t,i,r){var n=t.image.width,o=t.image.height,a=C.convert(i.format),s=C.convert(i.type);this.setTexture2D(i,0),t.isDataTexture?p.texSubImage2D(3553,r||0,e.x,e.y,n,o,a,s,t.image.data):p.texSubImage2D(3553,r||0,e.x,e.y,a,s,t.image)}}function ao(e,t){this.name="",this.color=new ci(e),this.density=void 0!==t?t:25e-5}function so(e,t,i){this.name="",this.color=new ci(e),this.near=void 0!==t?t:1,this.far=void 0!==i?i:1e3}function lo(){wi.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0}function co(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function uo(e,t,i,r){this.data=e,this.itemSize=t,this.offset=i,this.normalized=!0===r}function ho(e){or.call(this),this.type="SpriteMaterial",this.color=new ci(16777215),this.map=null,this.rotation=0,this.sizeAttenuation=!0,this.lights=!1,this.transparent=!0,this.setValues(e)}function po(e){if(wi.call(this),this.type="Sprite",void 0===Xn){Xn=new Ui;var t=new co(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);Xn.setIndex([0,1,2,0,2,3]),Xn.addAttribute("position",new uo(t,3,0,!1)),Xn.addAttribute("uv",new uo(t,2,3,!1))}this.geometry=Xn,this.material=void 0!==e?e:new ho,this.center=new kt(.5,.5)}function fo(){wi.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function mo(e,t){e&&e.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),ur.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Ht,this.bindMatrixInverse=new Ht}function go(e,t){if(e=e||[],this.bones=e.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var i=0,r=this.bones.length;i<r;i++)this.boneInverses.push(new Ht)}}function vo(){wi.call(this),this.type="Bone"}function yo(e){or.call(this),this.type="LineBasicMaterial",this.color=new ci(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.lights=!1,this.setValues(e)}function bo(e,t,i){1===i&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),wi.call(this),this.type="Line",this.geometry=void 0!==e?e:new Ui,this.material=void 0!==t?t:new yo({color:16777215*Math.random()})}function _o(e,t){bo.call(this,e,t),this.type="LineSegments"}function xo(e,t){bo.call(this,e,t),this.type="LineLoop"}function Eo(e){or.call(this),this.type="PointsMaterial",this.color=new ci(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.lights=!1,this.setValues(e)}function wo(e,t){wi.call(this),this.type="Points",this.geometry=void 0!==e?e:new Ui,this.material=void 0!==t?t:new Eo({color:16777215*Math.random()})}function To(e,t,i,r,n,o,a,s,l){Wt.call(this,e,t,i,r,n,o,a,s,l),this.format=void 0!==a?a:Ie,this.minFilter=void 0!==o?o:we,this.magFilter=void 0!==n?n:we,this.generateMipmaps=!1}function So(e,t,i,r,n,o,a,s,l,c,u,h){Wt.call(this,null,o,a,s,l,c,r,n,u,h),this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function Mo(e,t,i,r,n,o,a,s,l){Wt.call(this,e,t,i,r,n,o,a,s,l),this.needsUpdate=!0}function Ro(e,t,i,r,n,o,a,s,l,c){if((c=void 0!==c?c:qe)!==qe&&c!==We)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&c===qe&&(i=Ae),void 0===i&&c===We&&(i=De),Wt.call(this,null,r,n,o,a,s,c,i,l),this.image={width:e,height:t},this.magFilter=void 0!==a?a:_e,this.minFilter=void 0!==s?s:_e,this.flipY=!1,this.generateMipmaps=!1}function Po(e){Ui.call(this),this.type="WireframeGeometry";var t,i,r,n,o,a,s,l,c,u,h=[],p=[0,0],d={},f=["a","b","c"];if(e&&e.isGeometry){var m=e.faces;for(t=0,r=m.length;t<r;t++){var g=m[t];for(i=0;i<3;i++)s=g[f[i]],l=g[f[(i+1)%3]],p[0]=Math.min(s,l),p[1]=Math.max(s,l),void 0===d[c=p[0]+","+p[1]]&&(d[c]={index1:p[0],index2:p[1]})}for(c in d)a=d[c],u=e.vertices[a.index1],h.push(u.x,u.y,u.z),u=e.vertices[a.index2],h.push(u.x,u.y,u.z)}else if(e&&e.isBufferGeometry){var v,y,b,_,x,E,w;if(u=new Ft,null!==e.index){for(v=e.attributes.position,y=e.index,0===(b=e.groups).length&&(b=[{start:0,count:y.count,materialIndex:0}]),n=0,o=b.length;n<o;++n)for(t=x=(_=b[n]).start,r=x+_.count;t<r;t+=3)for(i=0;i<3;i++)s=y.getX(t+i),l=y.getX(t+(i+1)%3),p[0]=Math.min(s,l),p[1]=Math.max(s,l),void 0===d[c=p[0]+","+p[1]]&&(d[c]={index1:p[0],index2:p[1]});for(c in d)a=d[c],u.fromBufferAttribute(v,a.index1),h.push(u.x,u.y,u.z),u.fromBufferAttribute(v,a.index2),h.push(u.x,u.y,u.z)}else for(t=0,r=(v=e.attributes.position).count/3;t<r;t++)for(i=0;i<3;i++)E=3*t+i,u.fromBufferAttribute(v,E),h.push(u.x,u.y,u.z),w=3*t+(i+1)%3,u.fromBufferAttribute(v,w),h.push(u.x,u.y,u.z)}this.addAttribute("position",new Fi(h,3))}function Ao(e,t,i){Ri.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:i},this.fromBufferGeometry(new Co(e,t,i)),this.mergeVertices()}function Co(e,t,i){Ui.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:i};var r,n,o=[],a=[],s=[],l=[],c=new Ft,u=new Ft,h=new Ft,p=new Ft,d=new Ft;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");var f=t+1;for(r=0;r<=i;r++){var m=r/i;for(n=0;n<=t;n++){var g=n/t;e(g,m,u),a.push(u.x,u.y,u.z),g-1e-5>=0?(e(g-1e-5,m,h),p.subVectors(u,h)):(e(g+1e-5,m,h),p.subVectors(h,u)),m-1e-5>=0?(e(g,m-1e-5,h),d.subVectors(u,h)):(e(g,m+1e-5,h),d.subVectors(h,u)),c.crossVectors(p,d).normalize(),s.push(c.x,c.y,c.z),l.push(g,m)}}for(r=0;r<i;r++)for(n=0;n<t;n++){var v=r*f+n,y=r*f+n+1,b=(r+1)*f+n+1,_=(r+1)*f+n;o.push(v,y,_),o.push(y,b,_)}this.setIndex(o),this.addAttribute("position",new Fi(a,3)),this.addAttribute("normal",new Fi(s,3)),this.addAttribute("uv",new Fi(l,2))}function Oo(e,t,i,r){Ri.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:r},this.fromBufferGeometry(new Lo(e,t,i,r)),this.mergeVertices()}function Lo(e,t,i,r){Ui.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:r},i=i||1;var n=[],o=[];function a(e,t,i,r){var n,o,a=Math.pow(2,r),l=[];for(n=0;n<=a;n++){l[n]=[];var c=e.clone().lerp(i,n/a),u=t.clone().lerp(i,n/a),h=a-n;for(o=0;o<=h;o++)l[n][o]=0===o&&n===a?c:c.clone().lerp(u,o/h)}for(n=0;n<a;n++)for(o=0;o<2*(a-n)-1;o++){var p=Math.floor(o/2);o%2==0?(s(l[n][p+1]),s(l[n+1][p]),s(l[n][p])):(s(l[n][p+1]),s(l[n+1][p+1]),s(l[n+1][p]))}}function s(e){n.push(e.x,e.y,e.z)}function l(t,i){var r=3*t;i.x=e[r+0],i.y=e[r+1],i.z=e[r+2]}function c(e,t,i,r){r<0&&1===e.x&&(o[t]=e.x-1),0===i.x&&0===i.z&&(o[t]=r/2/Math.PI+.5)}function u(e){return Math.atan2(e.z,-e.x)}function h(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}!function(e){for(var i=new Ft,r=new Ft,n=new Ft,o=0;o<t.length;o+=3)l(t[o+0],i),l(t[o+1],r),l(t[o+2],n),a(i,r,n,e)}(r=r||0),function(e){for(var t=new Ft,i=0;i<n.length;i+=3)t.x=n[i+0],t.y=n[i+1],t.z=n[i+2],t.normalize().multiplyScalar(e),n[i+0]=t.x,n[i+1]=t.y,n[i+2]=t.z}(i),function(){for(var e=new Ft,t=0;t<n.length;t+=3){e.x=n[t+0],e.y=n[t+1],e.z=n[t+2];var i=u(e)/2/Math.PI+.5,r=h(e)/Math.PI+.5;o.push(i,1-r)}(function(){for(var e=new Ft,t=new Ft,i=new Ft,r=new Ft,a=new kt,s=new kt,l=new kt,h=0,p=0;h<n.length;h+=9,p+=6){e.set(n[h+0],n[h+1],n[h+2]),t.set(n[h+3],n[h+4],n[h+5]),i.set(n[h+6],n[h+7],n[h+8]),a.set(o[p+0],o[p+1]),s.set(o[p+2],o[p+3]),l.set(o[p+4],o[p+5]),r.copy(e).add(t).add(i).divideScalar(3);var d=u(r);c(a,p+0,e,d),c(s,p+2,t,d),c(l,p+4,i,d)}})(),function(){for(var e=0;e<o.length;e+=6){var t=o[e+0],i=o[e+2],r=o[e+4],n=Math.max(t,i,r),a=Math.min(t,i,r);n>.9&&a<.1&&(t<.2&&(o[e+0]+=1),i<.2&&(o[e+2]+=1),r<.2&&(o[e+4]+=1))}}()}(),this.addAttribute("position",new Fi(n,3)),this.addAttribute("normal",new Fi(n.slice(),3)),this.addAttribute("uv",new Fi(o,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}function ko(e,t){Ri.call(this),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Ho(e,t)),this.mergeVertices()}function Ho(e,t){Lo.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}function jo(e,t){Ri.call(this),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Fo(e,t)),this.mergeVertices()}function Fo(e,t){Lo.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Do(e,t){Ri.call(this),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Bo(e,t)),this.mergeVertices()}function Bo(e,t){var i=(1+Math.sqrt(5))/2,r=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1];Lo.call(this,r,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Io(e,t){Ri.call(this),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new No(e,t)),this.mergeVertices()}function No(e,t){var i=(1+Math.sqrt(5))/2,r=1/i,n=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-i,0,-r,i,0,r,-i,0,r,i,-r,-i,0,-r,i,0,r,-i,0,r,i,0,-i,0,-r,i,0,-r,-i,0,r,i,0,r];Lo.call(this,n,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Uo(e,t,i,r,n,o){Ri.call(this),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:r,closed:n},void 0!==o&&console.warn("THREE.TubeGeometry: taper has been removed.");var a=new Vo(e,t,i,r,n);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals,this.fromBufferGeometry(a),this.mergeVertices()}function Vo(e,t,i,r,n){Ui.call(this),this.type="TubeBufferGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:r,closed:n},t=t||64,i=i||1,r=r||8,n=n||!1;var o=e.computeFrenetFrames(t,n);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;var a,s,l=new Ft,c=new Ft,u=new kt,h=new Ft,p=[],d=[],f=[],m=[];function g(n){h=e.getPointAt(n/t,h);var a=o.normals[n],u=o.binormals[n];for(s=0;s<=r;s++){var f=s/r*Math.PI*2,m=Math.sin(f),g=-Math.cos(f);c.x=g*a.x+m*u.x,c.y=g*a.y+m*u.y,c.z=g*a.z+m*u.z,c.normalize(),d.push(c.x,c.y,c.z),l.x=h.x+i*c.x,l.y=h.y+i*c.y,l.z=h.z+i*c.z,p.push(l.x,l.y,l.z)}}!function(){for(a=0;a<t;a++)g(a);g(!1===n?t:0),function(){for(a=0;a<=t;a++)for(s=0;s<=r;s++)u.x=a/t,u.y=s/r,f.push(u.x,u.y)}(),function(){for(s=1;s<=t;s++)for(a=1;a<=r;a++){var e=(r+1)*(s-1)+(a-1),i=(r+1)*s+(a-1),n=(r+1)*s+a,o=(r+1)*(s-1)+a;m.push(e,i,o),m.push(i,n,o)}}()}(),this.setIndex(m),this.addAttribute("position",new Fi(p,3)),this.addAttribute("normal",new Fi(d,3)),this.addAttribute("uv",new Fi(f,2))}function zo(e,t,i,r,n,o,a){Ri.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:r,p:n,q:o},void 0!==a&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new qo(e,t,i,r,n,o)),this.mergeVertices()}function qo(e,t,i,r,n,o){Ui.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:r,p:n,q:o},e=e||1,t=t||.4,i=Math.floor(i)||64,r=Math.floor(r)||8,n=n||2,o=o||3;var a,s,l=[],c=[],u=[],h=[],p=new Ft,d=new Ft,f=new Ft,m=new Ft,g=new Ft,v=new Ft,y=new Ft;for(a=0;a<=i;++a){var b=a/i*n*Math.PI*2;for(R(b,n,o,e,f),R(b+.01,n,o,e,m),v.subVectors(m,f),y.addVectors(m,f),g.crossVectors(v,y),y.crossVectors(g,v),g.normalize(),y.normalize(),s=0;s<=r;++s){var _=s/r*Math.PI*2,x=-t*Math.cos(_),E=t*Math.sin(_);p.x=f.x+(x*y.x+E*g.x),p.y=f.y+(x*y.y+E*g.y),p.z=f.z+(x*y.z+E*g.z),c.push(p.x,p.y,p.z),d.subVectors(p,f).normalize(),u.push(d.x,d.y,d.z),h.push(a/i),h.push(s/r)}}for(s=1;s<=i;s++)for(a=1;a<=r;a++){var w=(r+1)*(s-1)+(a-1),T=(r+1)*s+(a-1),S=(r+1)*s+a,M=(r+1)*(s-1)+a;l.push(w,T,M),l.push(T,S,M)}function R(e,t,i,r,n){var o=Math.cos(e),a=Math.sin(e),s=i/t*e,l=Math.cos(s);n.x=r*(2+l)*.5*o,n.y=r*(2+l)*a*.5,n.z=r*Math.sin(s)*.5}this.setIndex(l),this.addAttribute("position",new Fi(c,3)),this.addAttribute("normal",new Fi(u,3)),this.addAttribute("uv",new Fi(h,2))}function Wo(e,t,i,r,n){Ri.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:r,arc:n},this.fromBufferGeometry(new Go(e,t,i,r,n)),this.mergeVertices()}function Go(e,t,i,r,n){Ui.call(this),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:r,arc:n},e=e||1,t=t||.4,i=Math.floor(i)||8,r=Math.floor(r)||6,n=n||2*Math.PI;var o,a,s=[],l=[],c=[],u=[],h=new Ft,p=new Ft,d=new Ft;for(o=0;o<=i;o++)for(a=0;a<=r;a++){var f=a/r*n,m=o/i*Math.PI*2;p.x=(e+t*Math.cos(m))*Math.cos(f),p.y=(e+t*Math.cos(m))*Math.sin(f),p.z=t*Math.sin(m),l.push(p.x,p.y,p.z),h.x=e*Math.cos(f),h.y=e*Math.sin(f),d.subVectors(p,h).normalize(),c.push(d.x,d.y,d.z),u.push(a/r),u.push(o/i)}for(o=1;o<=i;o++)for(a=1;a<=r;a++){var g=(r+1)*o+a-1,v=(r+1)*(o-1)+a-1,y=(r+1)*(o-1)+a,b=(r+1)*o+a;s.push(g,v,b),s.push(v,y,b)}this.setIndex(s),this.addAttribute("position",new Fi(l,3)),this.addAttribute("normal",new Fi(c,3)),this.addAttribute("uv",new Fi(u,2))}ao.prototype.isFogExp2=!0,ao.prototype.clone=function(){return new ao(this.color,this.density)},ao.prototype.toJSON=function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}},so.prototype.isFog=!0,so.prototype.clone=function(){return new so(this.color,this.near,this.far)},so.prototype.toJSON=function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}},lo.prototype=Object.assign(Object.create(wi.prototype),{constructor:lo,isScene:!0,copy:function(e,t){return wi.prototype.copy.call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},toJSON:function(e){var t=wi.prototype.toJSON.call(this,e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(co.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(co.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");return this.count=void 0!==e?e.length/this.stride:0,this.array=e,this},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.dynamic=e.dynamic,this},copyAt:function(e,t,i){e*=this.stride,i*=t.stride;for(var r=0,n=this.stride;r<n;r++)this.array[e+r]=t.array[i+r];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(e){return this.onUploadCallback=e,this}}),Object.defineProperties(uo.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(uo.prototype,{isInterleavedBufferAttribute:!0,setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this},setXYZ:function(e,t,i,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this},setXYZW:function(e,t,i,r,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=n,this}}),ho.prototype=Object.create(or.prototype),ho.prototype.constructor=ho,ho.prototype.isSpriteMaterial=!0,ho.prototype.copy=function(e){return or.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this},po.prototype=Object.assign(Object.create(wi.prototype),{constructor:po,isSprite:!0,raycast:function(){var e=new Ft,t=new Ft,i=new Ft,r=new kt,n=new kt,o=new Ht,a=new Ft,s=new Ft,l=new Ft,c=new kt,u=new kt,h=new kt;function p(e,t,i,a,s,l){r.subVectors(e,i).addScalar(.5).multiply(a),void 0!==s?(n.x=l*r.x-s*r.y,n.y=s*r.x+l*r.y):n.copy(r),e.copy(t),e.x+=n.x,e.y+=n.y,e.applyMatrix4(o)}return function(r,n){t.setFromMatrixScale(this.matrixWorld),o.getInverse(this.modelViewMatrix).premultiply(this.matrixWorld),i.setFromMatrixPosition(this.modelViewMatrix);var d,f,m=this.material.rotation;0!==m&&(f=Math.cos(m),d=Math.sin(m));var g=this.center;p(a.set(-.5,-.5,0),i,g,t,d,f),p(s.set(.5,-.5,0),i,g,t,d,f),p(l.set(.5,.5,0),i,g,t,d,f),c.set(0,0),u.set(1,0),h.set(1,1);var v=r.ray.intersectTriangle(a,s,l,!1,e);if(null!==v||(p(s.set(-.5,.5,0),i,g,t,d,f),u.set(0,1),null!==(v=r.ray.intersectTriangle(a,l,s,!1,e)))){var y=r.ray.origin.distanceTo(e);y<r.near||y>r.far||n.push({distance:y,point:e.clone(),uv:lr.getUV(e,a,s,l,c,u,h,new kt),face:null,object:this})}}}(),clone:function(){return new this.constructor(this.material).copy(this)},copy:function(e){return wi.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this}}),fo.prototype=Object.assign(Object.create(wi.prototype),{constructor:fo,copy:function(e){wi.prototype.copy.call(this,e,!1);for(var t=e.levels,i=0,r=t.length;i<r;i++){var n=t[i];this.addLevel(n.object.clone(),n.distance)}return this},addLevel:function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var i=this.levels,r=0;r<i.length&&!(t<i[r].distance);r++);i.splice(r,0,{distance:t,object:e}),this.add(e)},getObjectForDistance:function(e){for(var t=this.levels,i=1,r=t.length;i<r&&!(e<t[i].distance);i++);return t[i-1].object},raycast:(Yn=new Ft,function(e,t){Yn.setFromMatrixPosition(this.matrixWorld);var i=e.ray.origin.distanceTo(Yn);this.getObjectForDistance(i).raycast(e,t)}),update:function(){var e=new Ft,t=new Ft;return function(i){var r=this.levels;if(r.length>1){e.setFromMatrixPosition(i.matrixWorld),t.setFromMatrixPosition(this.matrixWorld);var n=e.distanceTo(t);r[0].object.visible=!0;for(var o=1,a=r.length;o<a&&n>=r[o].distance;o++)r[o-1].object.visible=!1,r[o].object.visible=!0;for(;o<a;o++)r[o].object.visible=!1}}}(),toJSON:function(e){var t=wi.prototype.toJSON.call(this,e);t.object.levels=[];for(var i=this.levels,r=0,n=i.length;r<n;r++){var o=i[r];t.object.levels.push({object:o.object.uuid,distance:o.distance})}return t}}),mo.prototype=Object.assign(Object.create(ur.prototype),{constructor:mo,isSkinnedMesh:!0,bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var e=new Gt,t=this.geometry.attributes.skinWeight,i=0,r=t.count;i<r;i++){e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.w=t.getW(i);var n=1/e.manhattanLength();n!==1/0?e.multiplyScalar(n):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){ur.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Object.assign(go.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var i=new Ht;this.bones[e]&&i.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(i)}},pose:function(){var e,t,i;for(t=0,i=this.bones.length;t<i;t++)(e=this.bones[t])&&e.matrixWorld.getInverse(this.boneInverses[t]);for(t=0,i=this.bones.length;t<i;t++)(e=this.bones[t])&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},update:(Qn=new Ht,Zn=new Ht,function(e){var t=this.bones,i=this.boneInverses,r=this.boneMatrices,n=this.boneTexture,o=new THREE.Vector3;e.getWorldPosition(o);for(var a=0,s=t.length;a<s;a++){var l=t[a]?t[a].matrixWorld:Zn;Qn.multiplyMatrices(l,i[a]);var c=Qn.elements;c[12]-=o.x,c[13]-=o.y,c[14]-=o.z,Qn.toArray(r,16*a)}void 0!==n&&(n.needsUpdate=!0)}),clone:function(){return new go(this.bones,this.boneInverses)},getBoneByName:function(e){for(var t=0,i=this.bones.length;t<i;t++){var r=this.bones[t];if(r.name===e)return r}}}),vo.prototype=Object.assign(Object.create(wi.prototype),{constructor:vo,isBone:!0}),yo.prototype=Object.create(or.prototype),yo.prototype.constructor=yo,yo.prototype.isLineBasicMaterial=!0,yo.prototype.copy=function(e){return or.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this},bo.prototype=Object.assign(Object.create(wi.prototype),{constructor:bo,isLine:!0,computeLineDistances:(Jn=new Ft,Kn=new Ft,function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,i=[0],r=1,n=t.count;r<n;r++)Jn.fromBufferAttribute(t,r-1),Kn.fromBufferAttribute(t,r),i[r]=i[r-1],i[r]+=Jn.distanceTo(Kn);e.addAttribute("lineDistance",new Fi(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){var o=e.vertices;for((i=e.lineDistances)[0]=0,r=1,n=o.length;r<n;r++)i[r]=i[r-1],i[r]+=o[r-1].distanceTo(o[r])}return this}),raycast:function(){var e=new Ht,t=new sr,i=new Kt;return function(r,n){var o=r.linePrecision,a=this.geometry,s=this.matrixWorld;if(null===a.boundingSphere&&a.computeBoundingSphere(),i.copy(a.boundingSphere),i.applyMatrix4(s),i.radius+=o,!1!==r.ray.intersectsSphere(i)){e.getInverse(s),t.copy(r.ray).applyMatrix4(e);var l=o/((this.scale.x+this.scale.y+this.scale.z)/3),c=l*l,u=new Ft,h=new Ft,p=new Ft,d=new Ft,f=this&&this.isLineSegments?2:1;if(a.isBufferGeometry){var m=a.index,g=a.attributes.position.array;if(null!==m)for(var v=m.array,y=0,b=v.length-1;y<b;y+=f){var _=v[y],x=v[y+1];if(u.fromArray(g,3*_),h.fromArray(g,3*x),!(t.distanceSqToSegment(u,h,d,p)>c))d.applyMatrix4(this.matrixWorld),(T=r.ray.origin.distanceTo(d))<r.near||T>r.far||n.push({distance:T,point:p.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}else for(y=0,b=g.length/3-1;y<b;y+=f){if(u.fromArray(g,3*y),h.fromArray(g,3*y+3),!(t.distanceSqToSegment(u,h,d,p)>c))d.applyMatrix4(this.matrixWorld),(T=r.ray.origin.distanceTo(d))<r.near||T>r.far||n.push({distance:T,point:p.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}}else if(a.isGeometry){var E=a.vertices,w=E.length;for(y=0;y<w-1;y+=f){var T;if(!(t.distanceSqToSegment(E[y],E[y+1],d,p)>c))d.applyMatrix4(this.matrixWorld),(T=r.ray.origin.distanceTo(d))<r.near||T>r.far||n.push({distance:T,point:p.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}}}}}(),copy:function(e){return wi.prototype.copy.call(this,e),this.geometry.copy(e.geometry),this.material.copy(e.material),this},clone:function(){return(new this.constructor).copy(this)}}),_o.prototype=Object.assign(Object.create(bo.prototype),{constructor:_o,isLineSegments:!0,computeLineDistances:function(){var e=new Ft,t=new Ft;return function(){var i=this.geometry;if(i.isBufferGeometry)if(null===i.index){for(var r=i.attributes.position,n=[],o=0,a=r.count;o<a;o+=2)e.fromBufferAttribute(r,o),t.fromBufferAttribute(r,o+1),n[o]=0===o?0:n[o-1],n[o+1]=n[o]+e.distanceTo(t);i.addAttribute("lineDistance",new Fi(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(i.isGeometry){var s=i.vertices;for(n=i.lineDistances,o=0,a=s.length;o<a;o+=2)e.copy(s[o]),t.copy(s[o+1]),n[o]=0===o?0:n[o-1],n[o+1]=n[o]+e.distanceTo(t)}return this}}()}),xo.prototype=Object.assign(Object.create(bo.prototype),{constructor:xo,isLineLoop:!0}),Eo.prototype=Object.create(or.prototype),Eo.prototype.constructor=Eo,Eo.prototype.isPointsMaterial=!0,Eo.prototype.copy=function(e){return or.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this},wo.prototype=Object.assign(Object.create(wi.prototype),{constructor:wo,isPoints:!0,raycast:function(){var e=new Ht,t=new sr,i=new Kt;return function(r,n){var o=this,a=this.geometry,s=this.matrixWorld,l=r.params.Points.threshold;if(null===a.boundingSphere&&a.computeBoundingSphere(),i.copy(a.boundingSphere),i.applyMatrix4(s),i.radius+=l,!1!==r.ray.intersectsSphere(i)){e.getInverse(s),t.copy(r.ray).applyMatrix4(e);var c=l/((this.scale.x+this.scale.y+this.scale.z)/3),u=c*c,h=new Ft,p=new Ft;if(a.isBufferGeometry){var d=a.index,f=a.attributes.position.array;if(null!==d)for(var m=d.array,g=0,v=m.length;g<v;g++){var y=m[g];h.fromArray(f,3*y),x(h,y)}else{g=0;for(var b=f.length/3;g<b;g++)h.fromArray(f,3*g),x(h,g)}}else{var _=a.vertices;for(g=0,b=_.length;g<b;g++)x(_[g],g)}}function x(e,i){var a=t.distanceSqToPoint(e);if(a<u){t.closestPointToPoint(e,p),p.applyMatrix4(s);var l=r.ray.origin.distanceTo(p);if(l<r.near||l>r.far)return;n.push({distance:l,distanceToRay:Math.sqrt(a),point:p.clone(),index:i,face:null,object:o})}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),To.prototype=Object.assign(Object.create(Wt.prototype),{constructor:To,isVideoTexture:!0,update:function(){var e=this.image;e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),So.prototype=Object.create(Wt.prototype),So.prototype.constructor=So,So.prototype.isCompressedTexture=!0,Mo.prototype=Object.create(Wt.prototype),Mo.prototype.constructor=Mo,Mo.prototype.isCanvasTexture=!0,Ro.prototype=Object.create(Wt.prototype),Ro.prototype.constructor=Ro,Ro.prototype.isDepthTexture=!0,Po.prototype=Object.create(Ui.prototype),Po.prototype.constructor=Po,Ao.prototype=Object.create(Ri.prototype),Ao.prototype.constructor=Ao,Co.prototype=Object.create(Ui.prototype),Co.prototype.constructor=Co,Oo.prototype=Object.create(Ri.prototype),Oo.prototype.constructor=Oo,Lo.prototype=Object.create(Ui.prototype),Lo.prototype.constructor=Lo,ko.prototype=Object.create(Ri.prototype),ko.prototype.constructor=ko,Ho.prototype=Object.create(Lo.prototype),Ho.prototype.constructor=Ho,jo.prototype=Object.create(Ri.prototype),jo.prototype.constructor=jo,Fo.prototype=Object.create(Lo.prototype),Fo.prototype.constructor=Fo,Do.prototype=Object.create(Ri.prototype),Do.prototype.constructor=Do,Bo.prototype=Object.create(Lo.prototype),Bo.prototype.constructor=Bo,Io.prototype=Object.create(Ri.prototype),Io.prototype.constructor=Io,No.prototype=Object.create(Lo.prototype),No.prototype.constructor=No,Uo.prototype=Object.create(Ri.prototype),Uo.prototype.constructor=Uo,Vo.prototype=Object.create(Ui.prototype),Vo.prototype.constructor=Vo,zo.prototype=Object.create(Ri.prototype),zo.prototype.constructor=zo,qo.prototype=Object.create(Ui.prototype),qo.prototype.constructor=qo,Wo.prototype=Object.create(Ri.prototype),Wo.prototype.constructor=Wo,Go.prototype=Object.create(Ui.prototype),Go.prototype.constructor=Go;var Xo=function(e,t,i){i=i||2;var r,n,o,a,s,l,c,u=t&&t.length,h=u?t[0]*i:e.length,p=Yo(e,0,h,i,!0),d=[];if(!p)return d;if(u&&(p=function(e,t,i,r){var n,o,a,s,l,c=[];for(n=0,o=t.length;n<o;n++)a=t[n]*r,s=n<o-1?t[n+1]*r:e.length,(l=Yo(e,a,s,r,!1))===l.next&&(l.steiner=!0),c.push(na(l));for(c.sort(ta),n=0;n<c.length;n++)ia(c[n],i),i=Qo(i,i.next);return i}(e,t,p,i)),e.length>80*i){r=o=e[0],n=a=e[1];for(var f=i;f<h;f+=i)(s=e[f])<r&&(r=s),(l=e[f+1])<n&&(n=l),s>o&&(o=s),l>a&&(a=l);c=0!==(c=Math.max(o-r,a-n))?1/c:0}return Zo(p,d,i,r,n,c),d};function Yo(e,t,i,r,n){var o,a;if(n===function(e,t,i,r){for(var n=0,o=t,a=i-r;o<i;o+=r)n+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return n}(e,t,i,r)>0)for(o=t;o<i;o+=r)a=pa(o,e[o],e[o+1],a);else for(o=i-r;o>=t;o-=r)a=pa(o,e[o],e[o+1],a);return a&&la(a,a.next)&&(da(a),a=a.next),a}function Qo(e,t){if(!e)return e;t||(t=e);var i,r=e;do{if(i=!1,r.steiner||!la(r,r.next)&&0!==sa(r.prev,r,r.next))r=r.next;else{if(da(r),(r=t=r.prev)===r.next)break;i=!0}}while(i||r!==t);return t}function Zo(e,t,i,r,n,o,a){if(e){!a&&o&&function(e,t,i,r){var n=e;do{null===n.z&&(n.z=ra(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,function(e){var t,i,r,n,o,a,s,l,c=1;do{for(i=e,e=null,o=null,a=0;i;){for(a++,r=i,s=0,t=0;t<c&&(s++,r=r.nextZ);t++);for(l=c;s>0||l>0&&r;)0!==s&&(0===l||!r||i.z<=r.z)?(n=i,i=i.nextZ,s--):(n=r,r=r.nextZ,l--),o?o.nextZ=n:e=n,n.prevZ=o,o=n;i=r}o.nextZ=null,c*=2}while(a>1)}(n)}(e,r,n,o);for(var s,l,c=e;e.prev!==e.next;)if(s=e.prev,l=e.next,o?Ko(e,r,n,o):Jo(e))t.push(s.i/i),t.push(e.i/i),t.push(l.i/i),da(e),e=l.next,c=l.next;else if((e=l)===c){a?1===a?Zo(e=$o(e,t,i),t,i,r,n,o,2):2===a&&ea(e,t,i,r,n,o):Zo(Qo(e),t,i,r,n,o,1);break}}}function Jo(e){var t=e.prev,i=e,r=e.next;if(sa(t,i,r)>=0)return!1;for(var n=e.next.next;n!==e.prev;){if(oa(t.x,t.y,i.x,i.y,r.x,r.y,n.x,n.y)&&sa(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function Ko(e,t,i,r){var n=e.prev,o=e,a=e.next;if(sa(n,o,a)>=0)return!1;for(var s=n.x<o.x?n.x<a.x?n.x:a.x:o.x<a.x?o.x:a.x,l=n.y<o.y?n.y<a.y?n.y:a.y:o.y<a.y?o.y:a.y,c=n.x>o.x?n.x>a.x?n.x:a.x:o.x>a.x?o.x:a.x,u=n.y>o.y?n.y>a.y?n.y:a.y:o.y>a.y?o.y:a.y,h=ra(s,l,t,i,r),p=ra(c,u,t,i,r),d=e.nextZ;d&&d.z<=p;){if(d!==e.prev&&d!==e.next&&oa(n.x,n.y,o.x,o.y,a.x,a.y,d.x,d.y)&&sa(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(d=e.prevZ;d&&d.z>=h;){if(d!==e.prev&&d!==e.next&&oa(n.x,n.y,o.x,o.y,a.x,a.y,d.x,d.y)&&sa(d.prev,d,d.next)>=0)return!1;d=d.prevZ}return!0}function $o(e,t,i){var r=e;do{var n=r.prev,o=r.next.next;!la(n,o)&&ca(n,r,r.next,o)&&ua(n,o)&&ua(o,n)&&(t.push(n.i/i),t.push(r.i/i),t.push(o.i/i),da(r),da(r.next),r=e=o),r=r.next}while(r!==e);return r}function ea(e,t,i,r,n,o){var a=e;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&aa(a,s)){var l=ha(a,s);return a=Qo(a,a.next),l=Qo(l,l.next),Zo(a,t,i,r,n,o),void Zo(l,t,i,r,n,o)}s=s.next}a=a.next}while(a!==e)}function ta(e,t){return e.x-t.x}function ia(e,t){if(t=function(e,t){var i,r=t,n=e.x,o=e.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=n&&s>a){if(a=s,s===n){if(o===r.y)return r;if(o===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!i)return null;if(n===a)return i.prev;var l,c=i,u=i.x,h=i.y,p=1/0;r=i.next;for(;r!==c;)n>=r.x&&r.x>=u&&n!==r.x&&oa(o<h?n:a,o,u,h,o<h?a:n,o,r.x,r.y)&&((l=Math.abs(o-r.y)/(n-r.x))<p||l===p&&r.x>i.x)&&ua(r,e)&&(i=r,p=l),r=r.next;return i}(e,t)){var i=ha(t,e);Qo(i,i.next)}}function ra(e,t,i,r,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function na(e){var t=e,i=e;do{t.x<i.x&&(i=t),t=t.next}while(t!==e);return i}function oa(e,t,i,r,n,o,a,s){return(n-a)*(t-s)-(e-a)*(o-s)>=0&&(e-a)*(r-s)-(i-a)*(t-s)>=0&&(i-a)*(o-s)-(n-a)*(r-s)>=0}function aa(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&ca(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&ua(e,t)&&ua(t,e)&&function(e,t){var i=e,r=!1,n=(e.x+t.x)/2,o=(e.y+t.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==e);return r}(e,t)}function sa(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function la(e,t){return e.x===t.x&&e.y===t.y}function ca(e,t,i,r){return!!(la(e,t)&&la(i,r)||la(e,r)&&la(i,t))||sa(e,t,i)>0!=sa(e,t,r)>0&&sa(i,r,e)>0!=sa(i,r,t)>0}function ua(e,t){return sa(e.prev,e,e.next)<0?sa(e,t,e.next)>=0&&sa(e,e.prev,t)>=0:sa(e,t,e.prev)<0||sa(e,e.next,t)<0}function ha(e,t){var i=new fa(e.i,e.x,e.y),r=new fa(t.i,t.x,t.y),n=e.next,o=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,o.next=r,r.prev=o,r}function pa(e,t,i,r){var n=new fa(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function da(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function fa(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var ma={area:function(e){for(var t=e.length,i=0,r=t-1,n=0;n<t;r=n++)i+=e[r].x*e[n].y-e[n].x*e[r].y;return.5*i},isClockWise:function(e){return ma.area(e)<0},triangulateShape:function(e,t){var i=[],r=[],n=[];ga(e),va(i,e);var o=e.length;t.forEach(ga);for(var a=0;a<t.length;a++)r.push(o),o+=t[a].length,va(i,t[a]);var s=Xo(i,r);for(a=0;a<s.length;a+=3)n.push(s.slice(a,a+3));return n}};function ga(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function va(e,t){for(var i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}function ya(e,t){Ri.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new ba(e,t)),this.mergeVertices()}function ba(e,t){Ui.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];for(var i=this,r=[],n=[],o=0,a=e.length;o<a;o++){s(e[o])}function s(e){var o=[],a=void 0!==t.curveSegments?t.curveSegments:12,s=void 0!==t.steps?t.steps:1,l=void 0!==t.depth?t.depth:100,c=void 0===t.bevelEnabled||t.bevelEnabled,u=void 0!==t.bevelThickness?t.bevelThickness:6,h=void 0!==t.bevelSize?t.bevelSize:u-2,p=void 0!==t.bevelSegments?t.bevelSegments:3,d=t.extrudePath,f=void 0!==t.UVGenerator?t.UVGenerator:_a;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=t.amount);var m,g,v,y,b,_,x,E,w=!1;d&&(m=d.getSpacedPoints(s),w=!0,c=!1,g=d.computeFrenetFrames(s,!1),v=new Ft,y=new Ft,b=new Ft),c||(p=0,u=0,h=0);var T=e.extractPoints(a),S=T.shape,M=T.holes;if(!ma.isClockWise(S))for(S=S.reverse(),x=0,E=M.length;x<E;x++)_=M[x],ma.isClockWise(_)&&(M[x]=_.reverse());var R=ma.triangulateShape(S,M),P=S;for(x=0,E=M.length;x<E;x++)_=M[x],S=S.concat(_);function A(e,t,i){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(i).add(e)}var C,O,L,k,H,j,F=S.length,D=R.length;function B(e,t,i){var r,n,o,a=e.x-t.x,s=e.y-t.y,l=i.x-e.x,c=i.y-e.y,u=a*a+s*s,h=a*c-s*l;if(Math.abs(h)>Number.EPSILON){var p=Math.sqrt(u),d=Math.sqrt(l*l+c*c),f=t.x-s/p,m=t.y+a/p,g=((i.x-c/d-f)*c-(i.y+l/d-m)*l)/(a*c-s*l),v=(r=f+a*g-e.x)*r+(n=m+s*g-e.y)*n;if(v<=2)return new kt(r,n);o=Math.sqrt(v/2)}else{var y=!1;a>Number.EPSILON?l>Number.EPSILON&&(y=!0):a<-Number.EPSILON?l<-Number.EPSILON&&(y=!0):Math.sign(s)===Math.sign(c)&&(y=!0),y?(r=-s,n=a,o=Math.sqrt(u)):(r=a,n=s,o=Math.sqrt(u/2))}return new kt(r/o,n/o)}for(var I=[],N=0,U=P.length,V=U-1,z=N+1;N<U;N++,V++,z++)V===U&&(V=0),z===U&&(z=0),I[N]=B(P[N],P[V],P[z]);var q,W,G=[],X=I.concat();for(x=0,E=M.length;x<E;x++){for(_=M[x],q=[],N=0,V=(U=_.length)-1,z=N+1;N<U;N++,V++,z++)V===U&&(V=0),z===U&&(z=0),q[N]=B(_[N],_[V],_[z]);G.push(q),X=X.concat(q)}for(C=0;C<p;C++){for(L=C/p,k=u*Math.cos(L*Math.PI/2),O=h*Math.sin(L*Math.PI/2),N=0,U=P.length;N<U;N++)Q((H=A(P[N],I[N],O)).x,H.y,-k);for(x=0,E=M.length;x<E;x++)for(_=M[x],q=G[x],N=0,U=_.length;N<U;N++)Q((H=A(_[N],q[N],O)).x,H.y,-k)}for(O=h,N=0;N<F;N++)H=c?A(S[N],X[N],O):S[N],w?(y.copy(g.normals[0]).multiplyScalar(H.x),v.copy(g.binormals[0]).multiplyScalar(H.y),b.copy(m[0]).add(y).add(v),Q(b.x,b.y,b.z)):Q(H.x,H.y,0);for(W=1;W<=s;W++)for(N=0;N<F;N++)H=c?A(S[N],X[N],O):S[N],w?(y.copy(g.normals[W]).multiplyScalar(H.x),v.copy(g.binormals[W]).multiplyScalar(H.y),b.copy(m[W]).add(y).add(v),Q(b.x,b.y,b.z)):Q(H.x,H.y,l/s*W);for(C=p-1;C>=0;C--){for(L=C/p,k=u*Math.cos(L*Math.PI/2),O=h*Math.sin(L*Math.PI/2),N=0,U=P.length;N<U;N++)Q((H=A(P[N],I[N],O)).x,H.y,l+k);for(x=0,E=M.length;x<E;x++)for(_=M[x],q=G[x],N=0,U=_.length;N<U;N++)H=A(_[N],q[N],O),w?Q(H.x,H.y+m[s-1].y,m[s-1].x+k):Q(H.x,H.y,l+k)}function Y(e,t){var i,r;for(N=e.length;--N>=0;){i=N,(r=N-1)<0&&(r=e.length-1);var n=0,o=s+2*p;for(n=0;n<o;n++){var a=F*n,l=F*(n+1);J(t+i+a,t+r+a,t+r+l,t+i+l)}}}function Q(e,t,i){o.push(e),o.push(t),o.push(i)}function Z(e,t,n){K(e),K(t),K(n);var o=r.length/3,a=f.generateTopUV(i,r,o-3,o-2,o-1);$(a[0]),$(a[1]),$(a[2])}function J(e,t,n,o){K(e),K(t),K(o),K(t),K(n),K(o);var a=r.length/3,s=f.generateSideWallUV(i,r,a-6,a-3,a-2,a-1);$(s[0]),$(s[1]),$(s[3]),$(s[1]),$(s[2]),$(s[3])}function K(e){r.push(o[3*e+0]),r.push(o[3*e+1]),r.push(o[3*e+2])}function $(e){n.push(e.x),n.push(e.y)}!function(){var e=r.length/3;if(c){var t=0,n=F*t;for(N=0;N<D;N++)Z((j=R[N])[2]+n,j[1]+n,j[0]+n);for(n=F*(t=s+2*p),N=0;N<D;N++)Z((j=R[N])[0]+n,j[1]+n,j[2]+n)}else{for(N=0;N<D;N++)Z((j=R[N])[2],j[1],j[0]);for(N=0;N<D;N++)Z((j=R[N])[0]+F*s,j[1]+F*s,j[2]+F*s)}i.addGroup(e,r.length/3-e,0)}(),function(){var e=r.length/3,t=0;for(Y(P,t),t+=P.length,x=0,E=M.length;x<E;x++)Y(_=M[x],t),t+=_.length;i.addGroup(e,r.length/3-e,1)}()}this.addAttribute("position",new Fi(r,3)),this.addAttribute("uv",new Fi(n,2)),this.computeVertexNormals()}ya.prototype=Object.create(Ri.prototype),ya.prototype.constructor=ya,ya.prototype.toJSON=function(){var e=Ri.prototype.toJSON.call(this);return xa(this.parameters.shapes,this.parameters.options,e)},ba.prototype=Object.create(Ui.prototype),ba.prototype.constructor=ba,ba.prototype.toJSON=function(){var e=Ui.prototype.toJSON.call(this);return xa(this.parameters.shapes,this.parameters.options,e)};var _a={generateTopUV:function(e,t,i,r,n){var o=t[3*i],a=t[3*i+1],s=t[3*r],l=t[3*r+1],c=t[3*n],u=t[3*n+1];return[new kt(o,a),new kt(s,l),new kt(c,u)]},generateSideWallUV:function(e,t,i,r,n,o){var a=t[3*i],s=t[3*i+1],l=t[3*i+2],c=t[3*r],u=t[3*r+1],h=t[3*r+2],p=t[3*n],d=t[3*n+1],f=t[3*n+2],m=t[3*o],g=t[3*o+1],v=t[3*o+2];return Math.abs(s-u)<.01?[new kt(a,1-l),new kt(c,1-h),new kt(p,1-f),new kt(m,1-v)]:[new kt(s,1-l),new kt(u,1-h),new kt(d,1-f),new kt(g,1-v)]}};function xa(e,t,i){if(i.shapes=[],Array.isArray(e))for(var r=0,n=e.length;r<n;r++){var o=e[r];i.shapes.push(o.uuid)}else i.shapes.push(e.uuid);return void 0!==t.extrudePath&&(i.options.extrudePath=t.extrudePath.toJSON()),i}function Ea(e,t){Ri.call(this),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new wa(e,t)),this.mergeVertices()}function wa(e,t){var i=(t=t||{}).font;if(!i||!i.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new Ri;var r=i.generateShapes(e,t.size);t.depth=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),ba.call(this,r,t),this.type="TextBufferGeometry"}function Ta(e,t,i,r,n,o,a){Ri.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:n,thetaStart:o,thetaLength:a},this.fromBufferGeometry(new Sa(e,t,i,r,n,o,a)),this.mergeVertices()}function Sa(e,t,i,r,n,o,a){Ui.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:n,thetaStart:o,thetaLength:a},e=e||1,t=Math.max(3,Math.floor(t)||8),i=Math.max(2,Math.floor(i)||6),r=void 0!==r?r:0,n=void 0!==n?n:2*Math.PI;var s,l,c=(o=void 0!==o?o:0)+(a=void 0!==a?a:Math.PI),u=0,h=[],p=new Ft,d=new Ft,f=[],m=[],g=[],v=[];for(l=0;l<=i;l++){var y=[],b=l/i;for(s=0;s<=t;s++){var _=s/t;p.x=-e*Math.cos(r+_*n)*Math.sin(o+b*a),p.y=e*Math.cos(o+b*a),p.z=e*Math.sin(r+_*n)*Math.sin(o+b*a),m.push(p.x,p.y,p.z),d.set(p.x,p.y,p.z).normalize(),g.push(d.x,d.y,d.z),v.push(_,1-b),y.push(u++)}h.push(y)}for(l=0;l<i;l++)for(s=0;s<t;s++){var x=h[l][s+1],E=h[l][s],w=h[l+1][s],T=h[l+1][s+1];(0!==l||o>0)&&f.push(x,E,T),(l!==i-1||c<Math.PI)&&f.push(E,w,T)}this.setIndex(f),this.addAttribute("position",new Fi(m,3)),this.addAttribute("normal",new Fi(g,3)),this.addAttribute("uv",new Fi(v,2))}function Ma(e,t,i,r,n,o){Ri.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:r,thetaStart:n,thetaLength:o},this.fromBufferGeometry(new Ra(e,t,i,r,n,o)),this.mergeVertices()}function Ra(e,t,i,r,n,o){Ui.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:r,thetaStart:n,thetaLength:o},e=e||.5,t=t||1,n=void 0!==n?n:0,o=void 0!==o?o:2*Math.PI,i=void 0!==i?Math.max(3,i):8;var a,s,l,c=[],u=[],h=[],p=[],d=e,f=(t-e)/(r=void 0!==r?Math.max(1,r):1),m=new Ft,g=new kt;for(s=0;s<=r;s++){for(l=0;l<=i;l++)a=n+l/i*o,m.x=d*Math.cos(a),m.y=d*Math.sin(a),u.push(m.x,m.y,m.z),h.push(0,0,1),g.x=(m.x/t+1)/2,g.y=(m.y/t+1)/2,p.push(g.x,g.y);d+=f}for(s=0;s<r;s++){var v=s*(i+1);for(l=0;l<i;l++){var y=a=l+v,b=a+i+1,_=a+i+2,x=a+1;c.push(y,b,x),c.push(b,_,x)}}this.setIndex(c),this.addAttribute("position",new Fi(u,3)),this.addAttribute("normal",new Fi(h,3)),this.addAttribute("uv",new Fi(p,2))}function Pa(e,t,i,r){Ri.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:r},this.fromBufferGeometry(new Aa(e,t,i,r)),this.mergeVertices()}function Aa(e,t,i,r){Ui.call(this),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:r},t=Math.floor(t)||12,i=i||0,r=r||2*Math.PI,r=Lt.clamp(r,0,2*Math.PI);var n,o,a,s=[],l=[],c=[],u=1/t,h=new Ft,p=new kt;for(o=0;o<=t;o++){var d=i+o*u*r,f=Math.sin(d),m=Math.cos(d);for(a=0;a<=e.length-1;a++)h.x=e[a].x*f,h.y=e[a].y,h.z=e[a].x*m,l.push(h.x,h.y,h.z),p.x=o/t,p.y=a/(e.length-1),c.push(p.x,p.y)}for(o=0;o<t;o++)for(a=0;a<e.length-1;a++){var g=n=a+o*e.length,v=n+e.length,y=n+e.length+1,b=n+1;s.push(g,v,b),s.push(v,y,b)}if(this.setIndex(s),this.addAttribute("position",new Fi(l,3)),this.addAttribute("uv",new Fi(c,2)),this.computeVertexNormals(),r===2*Math.PI){var _=this.attributes.normal.array,x=new Ft,E=new Ft,w=new Ft;for(n=t*e.length*3,o=0,a=0;o<e.length;o++,a+=3)x.x=_[a+0],x.y=_[a+1],x.z=_[a+2],E.x=_[n+a+0],E.y=_[n+a+1],E.z=_[n+a+2],w.addVectors(x,E).normalize(),_[a+0]=_[n+a+0]=w.x,_[a+1]=_[n+a+1]=w.y,_[a+2]=_[n+a+2]=w.z}}function Ca(e,t){Ri.call(this),this.type="ShapeGeometry","object"==typeof t&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new Oa(e,t)),this.mergeVertices()}function Oa(e,t){Ui.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t},t=t||12;var i=[],r=[],n=[],o=[],a=0,s=0;if(!1===Array.isArray(e))c(e);else for(var l=0;l<e.length;l++)c(e[l]),this.addGroup(a,s,l),a+=s,s=0;function c(e){var a,l,c,u=r.length/3,h=e.extractPoints(t),p=h.shape,d=h.holes;for(!1===ma.isClockWise(p)&&(p=p.reverse()),a=0,l=d.length;a<l;a++)c=d[a],!0===ma.isClockWise(c)&&(d[a]=c.reverse());var f=ma.triangulateShape(p,d);for(a=0,l=d.length;a<l;a++)c=d[a],p=p.concat(c);for(a=0,l=p.length;a<l;a++){var m=p[a];r.push(m.x,m.y,0),n.push(0,0,1),o.push(m.x,m.y)}for(a=0,l=f.length;a<l;a++){var g=f[a],v=g[0]+u,y=g[1]+u,b=g[2]+u;i.push(v,y,b),s+=3}}this.setIndex(i),this.addAttribute("position",new Fi(r,3)),this.addAttribute("normal",new Fi(n,3)),this.addAttribute("uv",new Fi(o,2))}function La(e,t){if(t.shapes=[],Array.isArray(e))for(var i=0,r=e.length;i<r;i++){var n=e[i];t.shapes.push(n.uuid)}else t.shapes.push(e.uuid);return t}function ka(e,t){Ui.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=void 0!==t?t:1;var i,r,n,o,a=[],s=Math.cos(Lt.DEG2RAD*t),l=[0,0],c={},u=["a","b","c"];e.isBufferGeometry?(o=new Ri).fromBufferGeometry(e):o=e.clone(),o.mergeVertices(),o.computeFaceNormals();for(var h=o.vertices,p=o.faces,d=0,f=p.length;d<f;d++)for(var m=p[d],g=0;g<3;g++)i=m[u[g]],r=m[u[(g+1)%3]],l[0]=Math.min(i,r),l[1]=Math.max(i,r),void 0===c[n=l[0]+","+l[1]]?c[n]={index1:l[0],index2:l[1],face1:d,face2:void 0}:c[n].face2=d;for(n in c){var v=c[n];if(void 0===v.face2||p[v.face1].normal.dot(p[v.face2].normal)<=s){var y=h[v.index1];a.push(y.x,y.y,y.z),y=h[v.index2],a.push(y.x,y.y,y.z)}}this.addAttribute("position",new Fi(a,3))}function Ha(e,t,i,r,n,o,a,s){Ri.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:n,openEnded:o,thetaStart:a,thetaLength:s},this.fromBufferGeometry(new ja(e,t,i,r,n,o,a,s)),this.mergeVertices()}function ja(e,t,i,r,n,o,a,s){Ui.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:n,openEnded:o,thetaStart:a,thetaLength:s};var l=this;e=void 0!==e?e:1,t=void 0!==t?t:1,i=i||1,r=Math.floor(r)||8,n=Math.floor(n)||1,o=void 0!==o&&o,a=void 0!==a?a:0,s=void 0!==s?s:2*Math.PI;var c=[],u=[],h=[],p=[],d=0,f=[],m=i/2,g=0;function v(i){var n,o,f,v=new kt,y=new Ft,b=0,_=!0===i?e:t,x=!0===i?1:-1;for(o=d,n=1;n<=r;n++)u.push(0,m*x,0),h.push(0,x,0),p.push(.5,.5),d++;for(f=d,n=0;n<=r;n++){var E=n/r*s+a,w=Math.cos(E),T=Math.sin(E);y.x=_*T,y.y=m*x,y.z=_*w,u.push(y.x,y.y,y.z),h.push(0,x,0),v.x=.5*w+.5,v.y=.5*T*x+.5,p.push(v.x,v.y),d++}for(n=0;n<r;n++){var S=o+n,M=f+n;!0===i?c.push(M,M+1,S):c.push(M+1,M,S),b+=3}l.addGroup(g,b,!0===i?1:2),g+=b}!function(){var o,v,y=new Ft,b=new Ft,_=0,x=(t-e)/i;for(v=0;v<=n;v++){var E=[],w=v/n,T=w*(t-e)+e;for(o=0;o<=r;o++){var S=o/r,M=S*s+a,R=Math.sin(M),P=Math.cos(M);b.x=T*R,b.y=-w*i+m,b.z=T*P,u.push(b.x,b.y,b.z),y.set(R,x,P).normalize(),h.push(y.x,y.y,y.z),p.push(S,1-w),E.push(d++)}f.push(E)}for(o=0;o<r;o++)for(v=0;v<n;v++){var A=f[v][o],C=f[v+1][o],O=f[v+1][o+1],L=f[v][o+1];c.push(A,C,L),c.push(C,O,L),_+=6}l.addGroup(g,_,0),g+=_}(),!1===o&&(e>0&&v(!0),t>0&&v(!1)),this.setIndex(c),this.addAttribute("position",new Fi(u,3)),this.addAttribute("normal",new Fi(h,3)),this.addAttribute("uv",new Fi(p,2))}function Fa(e,t,i,r,n,o,a){Ha.call(this,0,e,t,i,r,n,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:r,openEnded:n,thetaStart:o,thetaLength:a}}function Da(e,t,i,r,n,o,a){ja.call(this,0,e,t,i,r,n,o,a),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:r,openEnded:n,thetaStart:o,thetaLength:a}}function Ba(e,t,i,r){Ri.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:r},this.fromBufferGeometry(new Ia(e,t,i,r)),this.mergeVertices()}function Ia(e,t,i,r){Ui.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:r},e=e||1,t=void 0!==t?Math.max(3,t):8,i=void 0!==i?i:0,r=void 0!==r?r:2*Math.PI;var n,o,a=[],s=[],l=[],c=[],u=new Ft,h=new kt;for(s.push(0,0,0),l.push(0,0,1),c.push(.5,.5),o=0,n=3;o<=t;o++,n+=3){var p=i+o/t*r;u.x=e*Math.cos(p),u.y=e*Math.sin(p),s.push(u.x,u.y,u.z),l.push(0,0,1),h.x=(s[n]/e+1)/2,h.y=(s[n+1]/e+1)/2,c.push(h.x,h.y)}for(n=1;n<=t;n++)a.push(n,n+1,0);this.setIndex(a),this.addAttribute("position",new Fi(s,3)),this.addAttribute("normal",new Fi(l,3)),this.addAttribute("uv",new Fi(c,2))}Ea.prototype=Object.create(Ri.prototype),Ea.prototype.constructor=Ea,wa.prototype=Object.create(ba.prototype),wa.prototype.constructor=wa,Ta.prototype=Object.create(Ri.prototype),Ta.prototype.constructor=Ta,Sa.prototype=Object.create(Ui.prototype),Sa.prototype.constructor=Sa,Ma.prototype=Object.create(Ri.prototype),Ma.prototype.constructor=Ma,Ra.prototype=Object.create(Ui.prototype),Ra.prototype.constructor=Ra,Pa.prototype=Object.create(Ri.prototype),Pa.prototype.constructor=Pa,Aa.prototype=Object.create(Ui.prototype),Aa.prototype.constructor=Aa,Ca.prototype=Object.create(Ri.prototype),Ca.prototype.constructor=Ca,Ca.prototype.toJSON=function(){var e=Ri.prototype.toJSON.call(this);return La(this.parameters.shapes,e)},Oa.prototype=Object.create(Ui.prototype),Oa.prototype.constructor=Oa,Oa.prototype.toJSON=function(){var e=Ui.prototype.toJSON.call(this);return La(this.parameters.shapes,e)},ka.prototype=Object.create(Ui.prototype),ka.prototype.constructor=ka,Ha.prototype=Object.create(Ri.prototype),Ha.prototype.constructor=Ha,ja.prototype=Object.create(Ui.prototype),ja.prototype.constructor=ja,Fa.prototype=Object.create(Ha.prototype),Fa.prototype.constructor=Fa,Da.prototype=Object.create(ja.prototype),Da.prototype.constructor=Da,Ba.prototype=Object.create(Ri.prototype),Ba.prototype.constructor=Ba,Ia.prototype=Object.create(Ui.prototype),Ia.prototype.constructor=Ia;var Na=Object.freeze({WireframeGeometry:Po,ParametricGeometry:Ao,ParametricBufferGeometry:Co,TetrahedronGeometry:ko,TetrahedronBufferGeometry:Ho,OctahedronGeometry:jo,OctahedronBufferGeometry:Fo,IcosahedronGeometry:Do,IcosahedronBufferGeometry:Bo,DodecahedronGeometry:Io,DodecahedronBufferGeometry:No,PolyhedronGeometry:Oo,PolyhedronBufferGeometry:Lo,TubeGeometry:Uo,TubeBufferGeometry:Vo,TorusKnotGeometry:zo,TorusKnotBufferGeometry:qo,TorusGeometry:Wo,TorusBufferGeometry:Go,TextGeometry:Ea,TextBufferGeometry:wa,SphereGeometry:Ta,SphereBufferGeometry:Sa,RingGeometry:Ma,RingBufferGeometry:Ra,PlaneGeometry:qi,PlaneBufferGeometry:Wi,LatheGeometry:Pa,LatheBufferGeometry:Aa,ShapeGeometry:Ca,ShapeBufferGeometry:Oa,ExtrudeGeometry:ya,ExtrudeBufferGeometry:ba,EdgesGeometry:ka,ConeGeometry:Fa,ConeBufferGeometry:Da,CylinderGeometry:Ha,CylinderBufferGeometry:ja,CircleGeometry:Ba,CircleBufferGeometry:Ia,BoxGeometry:Vi,BoxBufferGeometry:zi});function Ua(e){or.call(this),this.type="ShadowMaterial",this.color=new ci(0),this.transparent=!0,this.setValues(e)}function Va(e){ar.call(this,e),this.type="RawShaderMaterial"}function za(e){or.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new ci(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ci(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ct,this.normalScale=new kt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function qa(e){za.call(this),this.defines={PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearCoat=0,this.clearCoatRoughness=0,this.setValues(e)}function Wa(e){or.call(this),this.type="MeshPhongMaterial",this.color=new ci(16777215),this.specular=new ci(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ci(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ct,this.normalScale=new kt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=te,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Ga(e){Wa.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(e)}function Xa(e){or.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ct,this.normalScale=new kt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Ya(e){or.call(this),this.type="MeshLambertMaterial",this.color=new ci(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ci(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=te,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Qa(e){or.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new ci(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ct,this.normalScale=new kt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.lights=!1,this.setValues(e)}function Za(e){yo.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}Ua.prototype=Object.create(or.prototype),Ua.prototype.constructor=Ua,Ua.prototype.isShadowMaterial=!0,Ua.prototype.copy=function(e){return or.prototype.copy.call(this,e),this.color.copy(e.color),this},Va.prototype=Object.create(ar.prototype),Va.prototype.constructor=Va,Va.prototype.isRawShaderMaterial=!0,za.prototype=Object.create(or.prototype),za.prototype.constructor=za,za.prototype.isMeshStandardMaterial=!0,za.prototype.copy=function(e){return or.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},qa.prototype=Object.create(za.prototype),qa.prototype.constructor=qa,qa.prototype.isMeshPhysicalMaterial=!0,qa.prototype.copy=function(e){return za.prototype.copy.call(this,e),this.defines={PHYSICAL:""},this.reflectivity=e.reflectivity,this.clearCoat=e.clearCoat,this.clearCoatRoughness=e.clearCoatRoughness,this},Wa.prototype=Object.create(or.prototype),Wa.prototype.constructor=Wa,Wa.prototype.isMeshPhongMaterial=!0,Wa.prototype.copy=function(e){return or.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Ga.prototype=Object.create(Wa.prototype),Ga.prototype.constructor=Ga,Ga.prototype.isMeshToonMaterial=!0,Ga.prototype.copy=function(e){return Wa.prototype.copy.call(this,e),this.gradientMap=e.gradientMap,this},Xa.prototype=Object.create(or.prototype),Xa.prototype.constructor=Xa,Xa.prototype.isMeshNormalMaterial=!0,Xa.prototype.copy=function(e){return or.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Ya.prototype=Object.create(or.prototype),Ya.prototype.constructor=Ya,Ya.prototype.isMeshLambertMaterial=!0,Ya.prototype.copy=function(e){return or.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Qa.prototype=Object.create(or.prototype),Qa.prototype.constructor=Qa,Qa.prototype.isMeshMatcapMaterial=!0,Qa.prototype.copy=function(e){return or.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Za.prototype=Object.create(yo.prototype),Za.prototype.constructor=Za,Za.prototype.isLineDashedMaterial=!0,Za.prototype.copy=function(e){return yo.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var Ja=Object.freeze({ShadowMaterial:Ua,SpriteMaterial:ho,RawShaderMaterial:Va,ShaderMaterial:ar,PointsMaterial:Eo,MeshPhysicalMaterial:qa,MeshStandardMaterial:za,MeshPhongMaterial:Wa,MeshToonMaterial:Ga,MeshNormalMaterial:Xa,MeshLambertMaterial:Ya,MeshDepthMaterial:Dn,MeshDistanceMaterial:Bn,MeshBasicMaterial:cr,MeshMatcapMaterial:Qa,LineDashedMaterial:Za,LineBasicMaterial:yo,Material:or}),Ka={arraySlice:function(e,t,i){return Ka.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==i?i:e.length)):e.slice(t,i)},convertArray:function(e,t,i){return!e||!i&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,i=new Array(t),r=0;r!==t;++r)i[r]=r;return i.sort(function(t,i){return e[t]-e[i]}),i},sortedArray:function(e,t,i){for(var r=e.length,n=new e.constructor(r),o=0,a=0;a!==r;++o)for(var s=i[o]*t,l=0;l!==t;++l)n[a++]=e[s+l];return n},flattenJSON:function(e,t,i,r){for(var n=1,o=e[0];void 0!==o&&void 0===o[r];)o=e[n++];if(void 0!==o){var a=o[r];if(void 0!==a)if(Array.isArray(a))do{void 0!==(a=o[r])&&(t.push(o.time),i.push.apply(i,a)),o=e[n++]}while(void 0!==o);else if(void 0!==a.toArray)do{void 0!==(a=o[r])&&(t.push(o.time),a.toArray(i,i.length)),o=e[n++]}while(void 0!==o);else do{void 0!==(a=o[r])&&(t.push(o.time),i.push(a)),o=e[n++]}while(void 0!==o)}}};function $a(e,t,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(i),this.sampleValues=t,this.valueSize=i}function es(e,t,i,r){$a.call(this,e,t,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function ts(e,t,i,r){$a.call(this,e,t,i,r)}function is(e,t,i,r){$a.call(this,e,t,i,r)}function rs(e,t,i,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Ka.convertArray(t,this.TimeBufferType),this.values=Ka.convertArray(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}function ns(e,t,i){rs.call(this,e,t,i)}function os(e,t,i,r){rs.call(this,e,t,i,r)}function as(e,t,i,r){rs.call(this,e,t,i,r)}function ss(e,t,i,r){$a.call(this,e,t,i,r)}function ls(e,t,i,r){rs.call(this,e,t,i,r)}function cs(e,t,i,r){rs.call(this,e,t,i,r)}function us(e,t,i,r){rs.call(this,e,t,i,r)}function hs(e,t,i){this.name=e,this.tracks=i,this.duration=void 0!==t?t:-1,this.uuid=Lt.generateUUID(),this.duration<0&&this.resetDuration()}function ps(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return as;case"vector":case"vector2":case"vector3":case"vector4":return us;case"color":return os;case"quaternion":return ls;case"bool":case"boolean":return ns;case"string":return cs}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){var i=[],r=[];Ka.flattenJSON(e.keys,i,r,"value"),e.times=i,e.values=r}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}Object.assign($a.prototype,{evaluate:function(e){var t=this.parameterPositions,i=this._cachedIndex,r=t[i],n=t[i-1];e:{t:{var o;i:{r:if(!(e<r)){for(var a=i+2;;){if(void 0===r){if(e<n)break r;return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,e,n)}if(i===a)break;if(n=r,e<(r=t[++i]))break t}o=t.length;break i}if(e>=n)break e;var s=t[1];e<s&&(i=2,n=s);for(a=i-2;;){if(void 0===n)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(i===a)break;if(r=n,e>=(n=t[--i-1]))break t}o=i,i=0}for(;i<o;){var l=i+o>>>1;e<t[l]?o=l:i=l+1}if(r=t[i],void 0===(n=t[i-1]))return this._cachedIndex=0,this.beforeStart_(0,e,r);if(void 0===r)return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,n,e)}this._cachedIndex=i,this.intervalChanged_(i,n,r)}return this.interpolate_(i,n,e,r)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,n=e*r,o=0;o!==r;++o)t[o]=i[n+o];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign($a.prototype,{beforeStart_:$a.prototype.copySampleValue_,afterEnd_:$a.prototype.copySampleValue_}),es.prototype=Object.assign(Object.create($a.prototype),{constructor:es,DefaultSettings_:{endingStart:vt,endingEnd:vt},intervalChanged_:function(e,t,i){var r=this.parameterPositions,n=e-2,o=e+1,a=r[n],s=r[o];if(void 0===a)switch(this.getSettings_().endingStart){case 2401:n=e,a=2*t-i;break;case 2402:a=t+r[n=r.length-2]-r[n+1];break;default:n=e,a=i}if(void 0===s)switch(this.getSettings_().endingEnd){case 2401:o=e,s=2*i-t;break;case 2402:o=1,s=i+r[1]-r[0];break;default:o=e-1,s=t}var l=.5*(i-t),c=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(s-i),this._offsetPrev=n*c,this._offsetNext=o*c},interpolate_:function(e,t,i,r){for(var n=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=s-a,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,p=this._weightNext,d=(i-t)/(r-t),f=d*d,m=f*d,g=-h*m+2*h*f-h*d,v=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*d+1,y=(-1-p)*m+(1.5+p)*f+.5*d,b=p*m-p*f,_=0;_!==a;++_)n[_]=g*o[c+_]+v*o[l+_]+y*o[s+_]+b*o[u+_];return n}}),ts.prototype=Object.assign(Object.create($a.prototype),{constructor:ts,interpolate_:function(e,t,i,r){for(var n=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=s-a,c=(i-t)/(r-t),u=1-c,h=0;h!==a;++h)n[h]=o[l+h]*u+o[s+h]*c;return n}}),is.prototype=Object.assign(Object.create($a.prototype),{constructor:is,interpolate_:function(e){return this.copySampleValue_(e-1)}}),Object.assign(rs,{toJSON:function(e){var t,i=e.constructor;if(void 0!==i.toJSON)t=i.toJSON(e);else{t={name:e.name,times:Ka.convertArray(e.times,Array),values:Ka.convertArray(e.values,Array)};var r=e.getInterpolation();r!==e.DefaultInterpolation&&(t.interpolation=r)}return t.type=e.ValueTypeName,t}}),Object.assign(rs.prototype,{constructor:rs,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(e){return new is(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new ts(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new es(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case 2300:t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(i);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e)for(var t=this.times,i=0,r=t.length;i!==r;++i)t[i]+=e;return this},scale:function(e){if(1!==e)for(var t=this.times,i=0,r=t.length;i!==r;++i)t[i]*=e;return this},trim:function(e,t){for(var i=this.times,r=i.length,n=0,o=r-1;n!==r&&i[n]<e;)++n;for(;-1!==o&&i[o]>t;)--o;if(++o,0!==n||o!==r){n>=o&&(n=(o=Math.max(o,1))-1);var a=this.getValueSize();this.times=Ka.arraySlice(i,n,o),this.values=Ka.arraySlice(this.values,n*a,o*a)}return this},validate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var i=this.times,r=this.values,n=i.length;0===n&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var o=null,a=0;a!==n;a++){var s=i[a];if("number"==typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,s),e=!1;break}if(null!==o&&o>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,s,o),e=!1;break}o=s}if(void 0!==r&&Ka.isTypedArray(r)){a=0;for(var l=r.length;a!==l;++a){var c=r[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),e=!1;break}}}return e},optimize:function(){for(var e=this.times,t=this.values,i=this.getValueSize(),r=2302===this.getInterpolation(),n=1,o=e.length-1,a=1;a<o;++a){var s=!1,l=e[a];if(l!==e[a+1]&&(1!==a||l!==l[0]))if(r)s=!0;else for(var c=a*i,u=c-i,h=c+i,p=0;p!==i;++p){var d=t[c+p];if(d!==t[u+p]||d!==t[h+p]){s=!0;break}}if(s){if(a!==n){e[n]=e[a];var f=a*i,m=n*i;for(p=0;p!==i;++p)t[m+p]=t[f+p]}++n}}if(o>0){e[n]=e[o];for(f=o*i,m=n*i,p=0;p!==i;++p)t[m+p]=t[f+p];++n}return n!==e.length&&(this.times=Ka.arraySlice(e,0,n),this.values=Ka.arraySlice(t,0,n*i)),this},clone:function(){var e=Ka.arraySlice(this.times,0),t=Ka.arraySlice(this.values,0),i=new(0,this.constructor)(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}}),ns.prototype=Object.assign(Object.create(rs.prototype),{constructor:ns,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),os.prototype=Object.assign(Object.create(rs.prototype),{constructor:os,ValueTypeName:"color"}),as.prototype=Object.assign(Object.create(rs.prototype),{constructor:as,ValueTypeName:"number"}),ss.prototype=Object.assign(Object.create($a.prototype),{constructor:ss,interpolate_:function(e,t,i,r){for(var n=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=(i-t)/(r-t),c=s+a;s!==c;s+=4)jt.slerpFlat(n,0,o,s-a,o,s,l);return n}}),ls.prototype=Object.assign(Object.create(rs.prototype),{constructor:ls,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(e){return new ss(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),cs.prototype=Object.assign(Object.create(rs.prototype),{constructor:cs,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),us.prototype=Object.assign(Object.create(rs.prototype),{constructor:us,ValueTypeName:"vector"}),Object.assign(hs,{parse:function(e){for(var t=[],i=e.tracks,r=1/(e.fps||1),n=0,o=i.length;n!==o;++n)t.push(ps(i[n]).scale(r));return new hs(e.name,e.duration,t)},toJSON:function(e){for(var t=[],i=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid},n=0,o=i.length;n!==o;++n)t.push(rs.toJSON(i[n]));return r},CreateFromMorphTargetSequence:function(e,t,i,r){for(var n=t.length,o=[],a=0;a<n;a++){var s=[],l=[];s.push((a+n-1)%n,a,(a+1)%n),l.push(0,1,0);var c=Ka.getKeyframeOrder(s);s=Ka.sortedArray(s,1,c),l=Ka.sortedArray(l,1,c),r||0!==s[0]||(s.push(n),l.push(l[0])),o.push(new as(".morphTargetInfluences["+t[a].name+"]",s,l).scale(1/i))}return new hs(e,-1,o)},findByName:function(e,t){var i=e;if(!Array.isArray(e)){var r=e;i=r.geometry&&r.geometry.animations||r.animations}for(var n=0;n<i.length;n++)if(i[n].name===t)return i[n];return null},CreateClipsFromMorphTargetSequences:function(e,t,i){for(var r={},n=/^([\w-]*?)([\d]+)$/,o=0,a=e.length;o<a;o++){var s=e[o],l=s.name.match(n);if(l&&l.length>1){var c=r[h=l[1]];c||(r[h]=c=[]),c.push(s)}}var u=[];for(var h in r)u.push(hs.CreateFromMorphTargetSequence(h,r[h],t,i));return u},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var i=function(e,t,i,r,n){if(0!==i.length){var o=[],a=[];Ka.flattenJSON(i,o,a,r),0!==o.length&&n.push(new e(t,o,a))}},r=[],n=e.name||"default",o=e.length||-1,a=e.fps||30,s=e.hierarchy||[],l=0;l<s.length;l++){var c=s[l].keys;if(c&&0!==c.length)if(c[0].morphTargets){for(var u={},h=0;h<c.length;h++)if(c[h].morphTargets)for(var p=0;p<c[h].morphTargets.length;p++)u[c[h].morphTargets[p]]=-1;for(var d in u){var f=[],m=[];for(p=0;p!==c[h].morphTargets.length;++p){var g=c[h];f.push(g.time),m.push(g.morphTarget===d?1:0)}r.push(new as(".morphTargetInfluence["+d+"]",f,m))}o=u.length*(a||1)}else{var v=".bones["+t[l].name+"]";i(us,v+".position",c,"pos",r),i(ls,v+".quaternion",c,"rot",r),i(us,v+".scale",c,"scl",r)}}return 0===r.length?null:new hs(n,o,r)}}),Object.assign(hs.prototype,{resetDuration:function(){for(var e=0,t=0,i=this.tracks.length;t!==i;++t){var r=this.tracks[t];e=Math.max(e,r.times[r.times.length-1])}return this.duration=e,this},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this},clone:function(){for(var e=[],t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new hs(this.name,this.duration,e)}});var ds={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};function fs(e,t,i){var r=this,n=!1,o=0,a=0,s=void 0;this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(e){a++,!1===n&&void 0!==r.onStart&&r.onStart(e,o,a),n=!0},this.itemEnd=function(e){o++,void 0!==r.onProgress&&r.onProgress(e,o,a),o===a&&(n=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return s?s(e):e},this.setURLModifier=function(e){return s=e,this}}var ms=new fs,gs={};function vs(e){this.manager=void 0!==e?e:ms}function ys(e){this.manager=void 0!==e?e:ms}function bs(e){this.manager=void 0!==e?e:ms,this._parser=null}function _s(e){this.manager=void 0!==e?e:ms,this._parser=null}function xs(e){this.manager=void 0!==e?e:ms}function Es(e){this.manager=void 0!==e?e:ms}function ws(e){this.manager=void 0!==e?e:ms}function Ts(){this.type="Curve",this.arcLengthDivisions=200}function Ss(e,t,i,r,n,o,a,s){Ts.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=i||1,this.yRadius=r||1,this.aStartAngle=n||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=a||!1,this.aRotation=s||0}function Ms(e,t,i,r,n,o){Ss.call(this,e,t,i,i,r,n,o),this.type="ArcCurve"}function Rs(){var e=0,t=0,i=0,r=0;function n(n,o,a,s){e=n,t=a,i=-3*n+3*o-2*a-s,r=2*n-2*o+a+s}return{initCatmullRom:function(e,t,i,r,o){n(t,i,o*(i-e),o*(r-t))},initNonuniformCatmullRom:function(e,t,i,r,o,a,s){var l=(t-e)/o-(i-e)/(o+a)+(i-t)/a,c=(i-t)/a-(r-t)/(a+s)+(r-i)/s;n(t,i,l*=a,c*=a)},calc:function(n){var o=n*n;return e+t*n+i*o+r*(o*n)}}}Object.assign(vs.prototype,{load:function(e,t,i,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var n=this,o=ds.get(e);if(void 0!==o)return n.manager.itemStart(e),setTimeout(function(){t&&t(o),n.manager.itemEnd(e)},0),o;if(void 0===gs[e]){var a=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(a){var s=a[1],l=!!a[2],c=a[3];c=decodeURIComponent(c),l&&(c=atob(c));try{var u,h=(this.responseType||"").toLowerCase();switch(h){case"arraybuffer":case"blob":for(var p=new Uint8Array(c.length),d=0;d<c.length;d++)p[d]=c.charCodeAt(d);u="blob"===h?new Blob([p.buffer],{type:s}):p.buffer;break;case"document":var f=new DOMParser;u=f.parseFromString(c,s);break;case"json":u=JSON.parse(c);break;default:u=c}setTimeout(function(){t&&t(u),n.manager.itemEnd(e)},0)}catch(t){setTimeout(function(){r&&r(t),n.manager.itemError(e),n.manager.itemEnd(e)},0)}}else{gs[e]=[],gs[e].push({onLoad:t,onProgress:i,onError:r});var m=new XMLHttpRequest;for(var g in m.open("GET",e,!0),m.addEventListener("load",function(t){var i=this.response;ds.add(e,i);var r=gs[e];if(delete gs[e],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received.");for(var o=0,a=r.length;o<a;o++){(s=r[o]).onLoad&&s.onLoad(i)}n.manager.itemEnd(e)}else{for(o=0,a=r.length;o<a;o++){var s;(s=r[o]).onError&&s.onError(t)}n.manager.itemError(e),n.manager.itemEnd(e)}},!1),m.addEventListener("progress",function(t){for(var i=gs[e],r=0,n=i.length;r<n;r++){var o=i[r];o.onProgress&&o.onProgress(t)}},!1),m.addEventListener("error",function(t){var i=gs[e];delete gs[e];for(var r=0,o=i.length;r<o;r++){var a=i[r];a.onError&&a.onError(t)}n.manager.itemError(e),n.manager.itemEnd(e)},!1),m.addEventListener("abort",function(t){var i=gs[e];delete gs[e];for(var r=0,o=i.length;r<o;r++){var a=i[r];a.onError&&a.onError(t)}n.manager.itemError(e),n.manager.itemEnd(e)},!1),void 0!==this.responseType&&(m.responseType=this.responseType),void 0!==this.withCredentials&&(m.withCredentials=this.withCredentials),m.overrideMimeType&&m.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)m.setRequestHeader(g,this.requestHeader[g]);m.send(null)}return n.manager.itemStart(e),m}gs[e].push({onLoad:t,onProgress:i,onError:r})},setPath:function(e){return this.path=e,this},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}}),Object.assign(ys.prototype,{load:function(e,t,i,r){var n=this,o=new vs(n.manager);o.setPath(n.path),o.load(e,function(e){t(n.parse(JSON.parse(e)))},i,r)},parse:function(e,t){for(var i=[],r=0;r<e.length;r++){var n=hs.parse(e[r]);i.push(n)}t(i)},setPath:function(e){return this.path=e,this}}),Object.assign(bs.prototype,{load:function(e,t,i,r){var n=this,o=[],a=new So;a.image=o;var s=new vs(this.manager);function l(l){s.load(e[l],function(e){var i=n._parser(e,!0);o[l]={width:i.width,height:i.height,format:i.format,mipmaps:i.mipmaps},6===(c+=1)&&(1===i.mipmapCount&&(a.minFilter=we),a.format=i.format,a.needsUpdate=!0,t&&t(a))},i,r)}if(s.setPath(this.path),s.setResponseType("arraybuffer"),Array.isArray(e))for(var c=0,u=0,h=e.length;u<h;++u)l(u);else s.load(e,function(e){var i=n._parser(e,!0);if(i.isCubemap)for(var r=i.mipmaps.length/i.mipmapCount,s=0;s<r;s++){o[s]={mipmaps:[]};for(var l=0;l<i.mipmapCount;l++)o[s].mipmaps.push(i.mipmaps[s*i.mipmapCount+l]),o[s].format=i.format,o[s].width=i.width,o[s].height=i.height}else a.image.width=i.width,a.image.height=i.height,a.mipmaps=i.mipmaps;1===i.mipmapCount&&(a.minFilter=we),a.format=i.format,a.needsUpdate=!0,t&&t(a)},i,r);return a},setPath:function(e){return this.path=e,this}}),Object.assign(_s.prototype,{load:function(e,t,i,r){var n=this,o=new Zt,a=new vs(this.manager);return a.setResponseType("arraybuffer"),a.setPath(this.path),a.load(e,function(e){var i=n._parser(e);i&&(void 0!==i.image?o.image=i.image:void 0!==i.data&&(o.image.width=i.width,o.image.height=i.height,o.image.data=i.data),o.wrapS=void 0!==i.wrapS?i.wrapS:ye,o.wrapT=void 0!==i.wrapT?i.wrapT:ye,o.magFilter=void 0!==i.magFilter?i.magFilter:we,o.minFilter=void 0!==i.minFilter?i.minFilter:Se,o.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,void 0!==i.format&&(o.format=i.format),void 0!==i.type&&(o.type=i.type),void 0!==i.mipmaps&&(o.mipmaps=i.mipmaps),1===i.mipmapCount&&(o.minFilter=we),o.needsUpdate=!0,t&&t(o,i))},i,r),o},setPath:function(e){return this.path=e,this}}),Object.assign(xs.prototype,{crossOrigin:"anonymous",load:function(e,t,i,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var n=this,o=ds.get(e);if(void 0!==o)return n.manager.itemStart(e),setTimeout(function(){t&&t(o),n.manager.itemEnd(e)},0),o;var a=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){a.removeEventListener("load",s,!1),a.removeEventListener("error",l,!1),ds.add(e,this),t&&t(this),n.manager.itemEnd(e)}function l(t){a.removeEventListener("load",s,!1),a.removeEventListener("error",l,!1),r&&r(t),n.manager.itemError(e),n.manager.itemEnd(e)}return a.addEventListener("load",s,!1),a.addEventListener("error",l,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),n.manager.itemStart(e),a.src=e,a},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(Es.prototype,{crossOrigin:"anonymous",load:function(e,t,i,r){var n=new Er,o=new xs(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);var a=0;function s(i){o.load(e[i],function(e){n.images[i]=e,6===++a&&(n.needsUpdate=!0,t&&t(n))},void 0,r)}for(var l=0;l<e.length;++l)s(l);return n},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(ws.prototype,{crossOrigin:"anonymous",load:function(e,t,i,r){var n=new Wt,o=new xs(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(i){n.image=i;var r=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);n.format=r?Ie:Ne,n.needsUpdate=!0,void 0!==t&&t(n)},i,r),n},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(Ts.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){var i=this.getUtoTmapping(e);return this.getPoint(i,t)},getPoints:function(e){void 0===e&&(e=5);for(var t=[],i=0;i<=e;i++)t.push(this.getPoint(i/e));return t},getSpacedPoints:function(e){void 0===e&&(e=5);for(var t=[],i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,i,r=[],n=this.getPoint(0),o=0;for(r.push(0),i=1;i<=e;i++)o+=(t=this.getPoint(i/e)).distanceTo(n),r.push(o),n=t;return this.cacheArcLengths=r,r},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var i,r=this.getLengths(),n=0,o=r.length;i=t||e*r[o-1];for(var a,s=0,l=o-1;s<=l;)if((a=r[n=Math.floor(s+(l-s)/2)]-i)<0)s=n+1;else{if(!(a>0)){l=n;break}l=n-1}if(r[n=l]===i)return n/(o-1);var c=r[n];return(n+(i-c)/(r[n+1]-c))/(o-1)},getTangent:function(e){var t=e-1e-4,i=e+1e-4;t<0&&(t=0),i>1&&(i=1);var r=this.getPoint(t);return this.getPoint(i).clone().sub(r).normalize()},getTangentAt:function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},computeFrenetFrames:function(e,t){var i,r,n,o=new Ft,a=[],s=[],l=[],c=new Ft,u=new Ht;for(i=0;i<=e;i++)r=i/e,a[i]=this.getTangentAt(r),a[i].normalize();s[0]=new Ft,l[0]=new Ft;var h=Number.MAX_VALUE,p=Math.abs(a[0].x),d=Math.abs(a[0].y),f=Math.abs(a[0].z);for(p<=h&&(h=p,o.set(1,0,0)),d<=h&&(h=d,o.set(0,1,0)),f<=h&&o.set(0,0,1),c.crossVectors(a[0],o).normalize(),s[0].crossVectors(a[0],c),l[0].crossVectors(a[0],s[0]),i=1;i<=e;i++)s[i]=s[i-1].clone(),l[i]=l[i-1].clone(),c.crossVectors(a[i-1],a[i]),c.length()>Number.EPSILON&&(c.normalize(),n=Math.acos(Lt.clamp(a[i-1].dot(a[i]),-1,1)),s[i].applyMatrix4(u.makeRotationAxis(c,n))),l[i].crossVectors(a[i],s[i]);if(!0===t)for(n=Math.acos(Lt.clamp(s[0].dot(s[e]),-1,1)),n/=e,a[0].dot(c.crossVectors(s[0],s[e]))>0&&(n=-n),i=1;i<=e;i++)s[i].applyMatrix4(u.makeRotationAxis(a[i],n*i)),l[i].crossVectors(a[i],s[i]);return{tangents:a,normals:s,binormals:l}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),Ss.prototype=Object.create(Ts.prototype),Ss.prototype.constructor=Ss,Ss.prototype.isEllipseCurve=!0,Ss.prototype.getPoint=function(e,t){for(var i=t||new kt,r=2*Math.PI,n=this.aEndAngle-this.aStartAngle,o=Math.abs(n)<Number.EPSILON;n<0;)n+=r;for(;n>r;)n-=r;n<Number.EPSILON&&(n=o?0:r),!0!==this.aClockwise||o||(n===r?n=-r:n-=r);var a=this.aStartAngle+e*n,s=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){var c=Math.cos(this.aRotation),u=Math.sin(this.aRotation),h=s-this.aX,p=l-this.aY;s=h*c-p*u+this.aX,l=h*u+p*c+this.aY}return i.set(s,l)},Ss.prototype.copy=function(e){return Ts.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},Ss.prototype.toJSON=function(){var e=Ts.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},Ss.prototype.fromJSON=function(e){return Ts.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},Ms.prototype=Object.create(Ss.prototype),Ms.prototype.constructor=Ms,Ms.prototype.isArcCurve=!0;var Ps=new Ft,As=new Rs,Cs=new Rs,Os=new Rs;function Ls(e,t,i,r){Ts.call(this),this.type="CatmullRomCurve3",this.points=e||[],this.closed=t||!1,this.curveType=i||"centripetal",this.tension=r||.5}function ks(e,t,i,r,n){var o=.5*(r-t),a=.5*(n-i),s=e*e;return(2*i-2*r+o+a)*(e*s)+(-3*i+3*r-2*o-a)*s+o*e+i}function Hs(e,t,i,r){return function(e,t){var i=1-e;return i*i*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,i)+function(e,t){return e*e*t}(e,r)}function js(e,t,i,r,n){return function(e,t){var i=1-e;return i*i*i*t}(e,t)+function(e,t){var i=1-e;return 3*i*i*e*t}(e,i)+function(e,t){return 3*(1-e)*e*e*t}(e,r)+function(e,t){return e*e*e*t}(e,n)}function Fs(e,t,i,r){Ts.call(this),this.type="CubicBezierCurve",this.v0=e||new kt,this.v1=t||new kt,this.v2=i||new kt,this.v3=r||new kt}function Ds(e,t,i,r){Ts.call(this),this.type="CubicBezierCurve3",this.v0=e||new Ft,this.v1=t||new Ft,this.v2=i||new Ft,this.v3=r||new Ft}function Bs(e,t){Ts.call(this),this.type="LineCurve",this.v1=e||new kt,this.v2=t||new kt}function Is(e,t){Ts.call(this),this.type="LineCurve3",this.v1=e||new Ft,this.v2=t||new Ft}function Ns(e,t,i){Ts.call(this),this.type="QuadraticBezierCurve",this.v0=e||new kt,this.v1=t||new kt,this.v2=i||new kt}function Us(e,t,i){Ts.call(this),this.type="QuadraticBezierCurve3",this.v0=e||new Ft,this.v1=t||new Ft,this.v2=i||new Ft}function Vs(e){Ts.call(this),this.type="SplineCurve",this.points=e||[]}Ls.prototype=Object.create(Ts.prototype),Ls.prototype.constructor=Ls,Ls.prototype.isCatmullRomCurve3=!0,Ls.prototype.getPoint=function(e,t){var i,r,n,o,a=t||new Ft,s=this.points,l=s.length,c=(l-(this.closed?0:1))*e,u=Math.floor(c),h=c-u;if(this.closed?u+=u>0?0:(Math.floor(Math.abs(u)/l)+1)*l:0===h&&u===l-1&&(u=l-2,h=1),this.closed||u>0?i=s[(u-1)%l]:(Ps.subVectors(s[0],s[1]).add(s[0]),i=Ps),r=s[u%l],n=s[(u+1)%l],this.closed||u+2<l?o=s[(u+2)%l]:(Ps.subVectors(s[l-1],s[l-2]).add(s[l-1]),o=Ps),"centripetal"===this.curveType||"chordal"===this.curveType){var p="chordal"===this.curveType?.5:.25,d=Math.pow(i.distanceToSquared(r),p),f=Math.pow(r.distanceToSquared(n),p),m=Math.pow(n.distanceToSquared(o),p);f<1e-4&&(f=1),d<1e-4&&(d=f),m<1e-4&&(m=f),As.initNonuniformCatmullRom(i.x,r.x,n.x,o.x,d,f,m),Cs.initNonuniformCatmullRom(i.y,r.y,n.y,o.y,d,f,m),Os.initNonuniformCatmullRom(i.z,r.z,n.z,o.z,d,f,m)}else"catmullrom"===this.curveType&&(As.initCatmullRom(i.x,r.x,n.x,o.x,this.tension),Cs.initCatmullRom(i.y,r.y,n.y,o.y,this.tension),Os.initCatmullRom(i.z,r.z,n.z,o.z,this.tension));return a.set(As.calc(h),Cs.calc(h),Os.calc(h)),a},Ls.prototype.copy=function(e){Ts.prototype.copy.call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},Ls.prototype.toJSON=function(){var e=Ts.prototype.toJSON.call(this);e.points=[];for(var t=0,i=this.points.length;t<i;t++){var r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},Ls.prototype.fromJSON=function(e){Ts.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push((new Ft).fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},Fs.prototype=Object.create(Ts.prototype),Fs.prototype.constructor=Fs,Fs.prototype.isCubicBezierCurve=!0,Fs.prototype.getPoint=function(e,t){var i=t||new kt,r=this.v0,n=this.v1,o=this.v2,a=this.v3;return i.set(js(e,r.x,n.x,o.x,a.x),js(e,r.y,n.y,o.y,a.y)),i},Fs.prototype.copy=function(e){return Ts.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Fs.prototype.toJSON=function(){var e=Ts.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Fs.prototype.fromJSON=function(e){return Ts.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},Ds.prototype=Object.create(Ts.prototype),Ds.prototype.constructor=Ds,Ds.prototype.isCubicBezierCurve3=!0,Ds.prototype.getPoint=function(e,t){var i=t||new Ft,r=this.v0,n=this.v1,o=this.v2,a=this.v3;return i.set(js(e,r.x,n.x,o.x,a.x),js(e,r.y,n.y,o.y,a.y),js(e,r.z,n.z,o.z,a.z)),i},Ds.prototype.copy=function(e){return Ts.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Ds.prototype.toJSON=function(){var e=Ts.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Ds.prototype.fromJSON=function(e){return Ts.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},Bs.prototype=Object.create(Ts.prototype),Bs.prototype.constructor=Bs,Bs.prototype.isLineCurve=!0,Bs.prototype.getPoint=function(e,t){var i=t||new kt;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i},Bs.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Bs.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},Bs.prototype.copy=function(e){return Ts.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Bs.prototype.toJSON=function(){var e=Ts.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Bs.prototype.fromJSON=function(e){return Ts.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Is.prototype=Object.create(Ts.prototype),Is.prototype.constructor=Is,Is.prototype.isLineCurve3=!0,Is.prototype.getPoint=function(e,t){var i=t||new Ft;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i},Is.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Is.prototype.copy=function(e){return Ts.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Is.prototype.toJSON=function(){var e=Ts.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Is.prototype.fromJSON=function(e){return Ts.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Ns.prototype=Object.create(Ts.prototype),Ns.prototype.constructor=Ns,Ns.prototype.isQuadraticBezierCurve=!0,Ns.prototype.getPoint=function(e,t){var i=t||new kt,r=this.v0,n=this.v1,o=this.v2;return i.set(Hs(e,r.x,n.x,o.x),Hs(e,r.y,n.y,o.y)),i},Ns.prototype.copy=function(e){return Ts.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Ns.prototype.toJSON=function(){var e=Ts.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Ns.prototype.fromJSON=function(e){return Ts.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Us.prototype=Object.create(Ts.prototype),Us.prototype.constructor=Us,Us.prototype.isQuadraticBezierCurve3=!0,Us.prototype.getPoint=function(e,t){var i=t||new Ft,r=this.v0,n=this.v1,o=this.v2;return i.set(Hs(e,r.x,n.x,o.x),Hs(e,r.y,n.y,o.y),Hs(e,r.z,n.z,o.z)),i},Us.prototype.copy=function(e){return Ts.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Us.prototype.toJSON=function(){var e=Ts.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Us.prototype.fromJSON=function(e){return Ts.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Vs.prototype=Object.create(Ts.prototype),Vs.prototype.constructor=Vs,Vs.prototype.isSplineCurve=!0,Vs.prototype.getPoint=function(e,t){var i=t||new kt,r=this.points,n=(r.length-1)*e,o=Math.floor(n),a=n-o,s=r[0===o?o:o-1],l=r[o],c=r[o>r.length-2?r.length-1:o+1],u=r[o>r.length-3?r.length-1:o+2];return i.set(ks(a,s.x,l.x,c.x,u.x),ks(a,s.y,l.y,c.y,u.y)),i},Vs.prototype.copy=function(e){Ts.prototype.copy.call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push(r.clone())}return this},Vs.prototype.toJSON=function(){var e=Ts.prototype.toJSON.call(this);e.points=[];for(var t=0,i=this.points.length;t<i;t++){var r=this.points[t];e.points.push(r.toArray())}return e},Vs.prototype.fromJSON=function(e){Ts.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push((new kt).fromArray(r))}return this};var zs=Object.freeze({ArcCurve:Ms,CatmullRomCurve3:Ls,CubicBezierCurve:Fs,CubicBezierCurve3:Ds,EllipseCurve:Ss,LineCurve:Bs,LineCurve3:Is,QuadraticBezierCurve:Ns,QuadraticBezierCurve3:Us,SplineCurve:Vs});function qs(){Ts.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function Ws(e){qs.call(this),this.type="Path",this.currentPoint=new kt,e&&this.setFromPoints(e)}function Gs(e){Ws.call(this,e),this.uuid=Lt.generateUUID(),this.type="Shape",this.holes=[]}function Xs(e,t){wi.call(this),this.type="Light",this.color=new ci(e),this.intensity=void 0!==t?t:1,this.receiveShadow=void 0}function Ys(e,t,i){Xs.call(this,e,i),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(wi.DefaultUp),this.updateMatrix(),this.groundColor=new ci(t)}function Qs(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new kt(512,512),this.map=null,this.matrix=new Ht}function Zs(){Qs.call(this,new Wn(50,1,.5,500))}function Js(e,t,i,r,n,o){Xs.call(this,e,t),this.type="SpotLight",this.position.copy(wi.DefaultUp),this.updateMatrix(),this.target=new wi,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==i?i:0,this.angle=void 0!==r?r:Math.PI/3,this.penumbra=void 0!==n?n:0,this.decay=void 0!==o?o:1,this.shadow=new Zs}function Ks(e,t,i,r){Xs.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==i?i:0,this.decay=void 0!==r?r:1,this.shadow=new Qs(new Wn(90,1,.5,500))}function $s(e,t,i,r,n,o){qn.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==e?e:-1,this.right=void 0!==t?t:1,this.top=void 0!==i?i:1,this.bottom=void 0!==r?r:-1,this.near=void 0!==n?n:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()}function el(){Qs.call(this,new $s(-5,5,5,-5,.5,500))}function tl(e,t){Xs.call(this,e,t),this.type="DirectionalLight",this.position.copy(wi.DefaultUp),this.updateMatrix(),this.target=new wi,this.shadow=new el}function il(e,t){Xs.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}function rl(e,t,i,r){Xs.call(this,e,t),this.type="RectAreaLight",this.width=void 0!==i?i:10,this.height=void 0!==r?r:10}function nl(e){this.manager=void 0!==e?e:ms,this.textures={}}qs.prototype=Object.assign(Object.create(Ts.prototype),{constructor:qs,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Bs(t,e))},getPoint:function(e){for(var t=e*this.getLength(),i=this.getCurveLengths(),r=0;r<i.length;){if(i[r]>=t){var n=i[r]-t,o=this.curves[r],a=o.getLength(),s=0===a?0:1-n/a;return o.getPointAt(s)}r++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,i=0,r=this.curves.length;i<r;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e},getSpacedPoints:function(e){void 0===e&&(e=40);for(var t=[],i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;for(var t,i=[],r=0,n=this.curves;r<n.length;r++)for(var o=n[r],a=o&&o.isEllipseCurve?2*e:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?e*o.points.length:e,s=o.getPoints(a),l=0;l<s.length;l++){var c=s[l];t&&t.equals(c)||(i.push(c),t=c)}return this.autoClose&&i.length>1&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i},copy:function(e){Ts.prototype.copy.call(this,e),this.curves=[];for(var t=0,i=e.curves.length;t<i;t++){var r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){var e=Ts.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,i=this.curves.length;t<i;t++){var r=this.curves[t];e.curves.push(r.toJSON())}return e},fromJSON:function(e){Ts.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,i=e.curves.length;t<i;t++){var r=e.curves[t];this.curves.push((new zs[r.type]).fromJSON(r))}return this}}),Ws.prototype=Object.assign(Object.create(qs.prototype),{constructor:Ws,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y)},moveTo:function(e,t){this.currentPoint.set(e,t)},lineTo:function(e,t){var i=new Bs(this.currentPoint.clone(),new kt(e,t));this.curves.push(i),this.currentPoint.set(e,t)},quadraticCurveTo:function(e,t,i,r){var n=new Ns(this.currentPoint.clone(),new kt(e,t),new kt(i,r));this.curves.push(n),this.currentPoint.set(i,r)},bezierCurveTo:function(e,t,i,r,n,o){var a=new Fs(this.currentPoint.clone(),new kt(e,t),new kt(i,r),new kt(n,o));this.curves.push(a),this.currentPoint.set(n,o)},splineThru:function(e){var t=new Vs([this.currentPoint.clone()].concat(e));this.curves.push(t),this.currentPoint.copy(e[e.length-1])},arc:function(e,t,i,r,n,o){var a=this.currentPoint.x,s=this.currentPoint.y;this.absarc(e+a,t+s,i,r,n,o)},absarc:function(e,t,i,r,n,o){this.absellipse(e,t,i,i,r,n,o)},ellipse:function(e,t,i,r,n,o,a,s){var l=this.currentPoint.x,c=this.currentPoint.y;this.absellipse(e+l,t+c,i,r,n,o,a,s)},absellipse:function(e,t,i,r,n,o,a,s){var l=new Ss(e,t,i,r,n,o,a,s);if(this.curves.length>0){var c=l.getPoint(0);c.equals(this.currentPoint)||this.lineTo(c.x,c.y)}this.curves.push(l);var u=l.getPoint(1);this.currentPoint.copy(u)},copy:function(e){return qs.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){var e=qs.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return qs.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),Gs.prototype=Object.assign(Object.create(Ws.prototype),{constructor:Gs,getPointsHoles:function(e){for(var t=[],i=0,r=this.holes.length;i<r;i++)t[i]=this.holes[i].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){Ws.prototype.copy.call(this,e),this.holes=[];for(var t=0,i=e.holes.length;t<i;t++){var r=e.holes[t];this.holes.push(r.clone())}return this},toJSON:function(){var e=Ws.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,i=this.holes.length;t<i;t++){var r=this.holes[t];e.holes.push(r.toJSON())}return e},fromJSON:function(e){Ws.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,i=e.holes.length;t<i;t++){var r=e.holes[t];this.holes.push((new Ws).fromJSON(r))}return this}}),Xs.prototype=Object.assign(Object.create(wi.prototype),{constructor:Xs,isLight:!0,copy:function(e){return wi.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){var t=wi.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),Ys.prototype=Object.assign(Object.create(Xs.prototype),{constructor:Ys,isHemisphereLight:!0,copy:function(e){return Xs.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(Qs.prototype,{copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),Zs.prototype=Object.assign(Object.create(Qs.prototype),{constructor:Zs,isSpotLightShadow:!0,update:function(e){var t=this.camera,i=2*Lt.RAD2DEG*e.angle,r=this.mapSize.width/this.mapSize.height,n=e.distance||t.far;i===t.fov&&r===t.aspect&&n===t.far||(t.fov=i,t.aspect=r,t.far=n,t.updateProjectionMatrix())}}),Js.prototype=Object.assign(Object.create(Xs.prototype),{constructor:Js,isSpotLight:!0,copy:function(e){return Xs.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),Ks.prototype=Object.assign(Object.create(Xs.prototype),{constructor:Ks,isPointLight:!0,copy:function(e){return Xs.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),$s.prototype=Object.assign(Object.create(qn.prototype),{constructor:$s,isOrthographicCamera:!0,copy:function(e,t){return qn.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,i,r,n,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2,n=i-e,o=i+e,a=r+t,s=r-t;if(null!==this.view&&this.view.enabled){var l=this.zoom/(this.view.width/this.view.fullWidth),c=this.zoom/(this.view.height/this.view.fullHeight),u=(this.right-this.left)/this.view.width,h=(this.top-this.bottom)/this.view.height;o=(n+=u*(this.view.offsetX/l))+u*(this.view.width/l),s=(a-=h*(this.view.offsetY/c))-h*(this.view.height/c)}this.projectionMatrix.makeOrthographic(n,o,a,s,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=wi.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),el.prototype=Object.assign(Object.create(Qs.prototype),{constructor:el}),tl.prototype=Object.assign(Object.create(Xs.prototype),{constructor:tl,isDirectionalLight:!0,copy:function(e){return Xs.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),il.prototype=Object.assign(Object.create(Xs.prototype),{constructor:il,isAmbientLight:!0}),rl.prototype=Object.assign(Object.create(Xs.prototype),{constructor:rl,isRectAreaLight:!0,copy:function(e){return Xs.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){var t=Xs.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}}),Object.assign(nl.prototype,{load:function(e,t,i,r){var n=this,o=new vs(n.manager);o.setPath(n.path),o.load(e,function(e){t(n.parse(JSON.parse(e)))},i,r)},parse:function(e){var t=this.textures;function i(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}var r=new Ja[e.type];if(void 0!==e.uuid&&(r.uuid=e.uuid),void 0!==e.name&&(r.name=e.name),void 0!==e.color&&r.color.setHex(e.color),void 0!==e.roughness&&(r.roughness=e.roughness),void 0!==e.metalness&&(r.metalness=e.metalness),void 0!==e.emissive&&r.emissive.setHex(e.emissive),void 0!==e.specular&&r.specular.setHex(e.specular),void 0!==e.shininess&&(r.shininess=e.shininess),void 0!==e.clearCoat&&(r.clearCoat=e.clearCoat),void 0!==e.clearCoatRoughness&&(r.clearCoatRoughness=e.clearCoatRoughness),void 0!==e.vertexColors&&(r.vertexColors=e.vertexColors),void 0!==e.fog&&(r.fog=e.fog),void 0!==e.flatShading&&(r.flatShading=e.flatShading),void 0!==e.blending&&(r.blending=e.blending),void 0!==e.combine&&(r.combine=e.combine),void 0!==e.side&&(r.side=e.side),void 0!==e.opacity&&(r.opacity=e.opacity),void 0!==e.transparent&&(r.transparent=e.transparent),void 0!==e.alphaTest&&(r.alphaTest=e.alphaTest),void 0!==e.depthTest&&(r.depthTest=e.depthTest),void 0!==e.depthWrite&&(r.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(r.colorWrite=e.colorWrite),void 0!==e.wireframe&&(r.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(r.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(r.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(r.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(r.rotation=e.rotation),1!==e.linewidth&&(r.linewidth=e.linewidth),void 0!==e.dashSize&&(r.dashSize=e.dashSize),void 0!==e.gapSize&&(r.gapSize=e.gapSize),void 0!==e.scale&&(r.scale=e.scale),void 0!==e.polygonOffset&&(r.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(r.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(r.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(r.skinning=e.skinning),void 0!==e.morphTargets&&(r.morphTargets=e.morphTargets),void 0!==e.dithering&&(r.dithering=e.dithering),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.uniforms)for(var n in e.uniforms){var o=e.uniforms[n];switch(r.uniforms[n]={},o.type){case"t":r.uniforms[n].value=i(o.value);break;case"c":r.uniforms[n].value=(new ci).setHex(o.value);break;case"v2":r.uniforms[n].value=(new kt).fromArray(o.value);break;case"v3":r.uniforms[n].value=(new Ft).fromArray(o.value);break;case"v4":r.uniforms[n].value=(new Gt).fromArray(o.value);break;case"m3":r.uniforms[n].value=(new Dt).fromArray(o.value);case"m4":r.uniforms[n].value=(new Ht).fromArray(o.value);break;default:r.uniforms[n].value=o.value}}if(void 0!==e.defines&&(r.defines=e.defines),void 0!==e.vertexShader&&(r.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(r.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(var a in e.extensions)r.extensions[a]=e.extensions[a];if(void 0!==e.shading&&(r.flatShading=1===e.shading),void 0!==e.size&&(r.size=e.size),void 0!==e.sizeAttenuation&&(r.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(r.map=i(e.map)),void 0!==e.alphaMap&&(r.alphaMap=i(e.alphaMap),r.transparent=!0),void 0!==e.bumpMap&&(r.bumpMap=i(e.bumpMap)),void 0!==e.bumpScale&&(r.bumpScale=e.bumpScale),void 0!==e.normalMap&&(r.normalMap=i(e.normalMap)),void 0!==e.normalMapType&&(r.normalMapType=e.normalMapType),void 0!==e.normalScale){var s=e.normalScale;!1===Array.isArray(s)&&(s=[s,s]),r.normalScale=(new kt).fromArray(s)}return void 0!==e.displacementMap&&(r.displacementMap=i(e.displacementMap)),void 0!==e.displacementScale&&(r.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(r.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(r.roughnessMap=i(e.roughnessMap)),void 0!==e.metalnessMap&&(r.metalnessMap=i(e.metalnessMap)),void 0!==e.emissiveMap&&(r.emissiveMap=i(e.emissiveMap)),void 0!==e.emissiveIntensity&&(r.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(r.specularMap=i(e.specularMap)),void 0!==e.envMap&&(r.envMap=i(e.envMap)),void 0!==e.envMapIntensity&&(r.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(r.reflectivity=e.reflectivity),void 0!==e.lightMap&&(r.lightMap=i(e.lightMap)),void 0!==e.lightMapIntensity&&(r.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(r.aoMap=i(e.aoMap)),void 0!==e.aoMapIntensity&&(r.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(r.gradientMap=i(e.gradientMap)),r},setPath:function(e){return this.path=e,this},setTextures:function(e){return this.textures=e,this}});var ol={decodeText:function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",i=0,r=e.length;i<r;i++)t+=String.fromCharCode(e[i]);return decodeURIComponent(escape(t))},extractUrlBase:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}};function al(e){this.manager=void 0!==e?e:ms}Object.assign(al.prototype,{load:function(e,t,i,r){var n=this,o=new vs(n.manager);o.setPath(n.path),o.load(e,function(e){t(n.parse(JSON.parse(e)))},i,r)},parse:function(e){var t=new Ui,i=e.data.index;if(void 0!==i){var r=new sl[i.type](i.array);t.setIndex(new Pi(r,1))}var n=e.data.attributes;for(var o in n){var a=n[o];r=new sl[a.type](a.array);t.addAttribute(o,new Pi(r,a.itemSize,a.normalized))}var s=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==s)for(var l=0,c=s.length;l!==c;++l){var u=s[l];t.addGroup(u.start,u.count,u.materialIndex)}var h=e.data.boundingSphere;if(void 0!==h){var p=new Ft;void 0!==h.center&&p.fromArray(h.center),t.boundingSphere=new Kt(p,h.radius)}return e.name&&(t.name=e.name),e.userData&&(t.userData=e.userData),t},setPath:function(e){return this.path=e,this}});var sl={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function ll(e){this.manager=void 0!==e?e:ms,this.resourcePath=""}Object.assign(ll.prototype,{crossOrigin:"anonymous",load:function(e,t,i,r){var n=this,o=void 0===this.path?ol.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;var a=new vs(n.manager);a.setPath(this.path),a.load(e,function(i){var o=null;try{o=JSON.parse(i)}catch(t){return void 0!==r&&r(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}var a=o.metadata;void 0!==a&&void 0!==a.type&&"geometry"!==a.type.toLowerCase()?n.parse(o,t):console.error("THREE.ObjectLoader: Can't load "+e)},i,r)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(e,t){var i=this.parseShape(e.shapes),r=this.parseGeometries(e.geometries,i),n=this.parseImages(e.images,function(){void 0!==t&&t(s)}),o=this.parseTextures(e.textures,n),a=this.parseMaterials(e.materials,o),s=this.parseObject(e.object,r,a);return e.animations&&(s.animations=this.parseAnimations(e.animations)),void 0!==e.images&&0!==e.images.length||void 0!==t&&t(s),s},parseShape:function(e){var t={};if(void 0!==e)for(var i=0,r=e.length;i<r;i++){var n=(new Gs).fromJSON(e[i]);t[n.uuid]=n}return t},parseGeometries:function(e,t){var i={};if(void 0!==e)for(var r=new al,n=0,o=e.length;n<o;n++){var a,s=e[n];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":a=new Na[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":a=new Na[s.type](s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":a=new Na[s.type](s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":a=new Na[s.type](s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":a=new Na[s.type](s.radius,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":a=new Na[s.type](s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":a=new Na[s.type](s.radius,s.detail);break;case"RingGeometry":case"RingBufferGeometry":a=new Na[s.type](s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":a=new Na[s.type](s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":a=new Na[s.type](s.radius,s.tube,s.tubularSegments,s.radialSegments,s.p,s.q);break;case"LatheGeometry":case"LatheBufferGeometry":a=new Na[s.type](s.points,s.segments,s.phiStart,s.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":a=new Na[s.type](s.vertices,s.indices,s.radius,s.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var l=[],c=0,u=s.shapes.length;c<u;c++){var h=t[s.shapes[c]];l.push(h)}a=new Na[s.type](l,s.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(l=[],c=0,u=s.shapes.length;c<u;c++){h=t[s.shapes[c]];l.push(h)}var p=s.options.extrudePath;void 0!==p&&(s.options.extrudePath=(new zs[p.type]).fromJSON(p)),a=new Na[s.type](l,s.options);break;case"BufferGeometry":a=r.parse(s);break;case"Geometry":if("THREE"in window&&"LegacyJSONLoader"in THREE)a=(new THREE.LegacyJSONLoader).parse(s,this.resourcePath).geometry;else console.error('THREE.ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type "Geometry".');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+s.type+'"');continue}a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),!0===a.isBufferGeometry&&void 0!==s.userData&&(a.userData=s.userData),i[s.uuid]=a}return i},parseMaterials:function(e,t){var i={},r={};if(void 0!==e){var n=new nl;n.setTextures(t);for(var o=0,a=e.length;o<a;o++){var s=e[o];if("MultiMaterial"===s.type){for(var l=[],c=0;c<s.materials.length;c++){var u=s.materials[c];void 0===i[u.uuid]&&(i[u.uuid]=n.parse(u)),l.push(i[u.uuid])}r[s.uuid]=l}else void 0===i[s.uuid]&&(i[s.uuid]=n.parse(s)),r[s.uuid]=i[s.uuid]}}return r},parseAnimations:function(e){for(var t=[],i=0;i<e.length;i++){var r=e[i],n=hs.parse(r);void 0!==r.uuid&&(n.uuid=r.uuid),t.push(n)}return t},parseImages:function(e,t){var i=this,r={};function n(e){return i.manager.itemStart(e),o.load(e,function(){i.manager.itemEnd(e)},void 0,function(){i.manager.itemError(e),i.manager.itemEnd(e)})}if(void 0!==e&&e.length>0){var o=new xs(new fs(t));o.setCrossOrigin(this.crossOrigin);for(var a=0,s=e.length;a<s;a++){var l=e[a],c=l.url;if(Array.isArray(c)){r[l.uuid]=[];for(var u=0,h=c.length;u<h;u++){var p=c[u],d=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(p)?p:i.resourcePath+p;r[l.uuid].push(n(d))}}else{d=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l.url)?l.url:i.resourcePath+l.url;r[l.uuid]=n(d)}}}return r},parseTextures:function(e,t){function i(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var r={};if(void 0!==e)for(var n=0,o=e.length;n<o;n++){var a,s=e[n];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===t[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image),(a=Array.isArray(t[s.image])?new Er(t[s.image]):new Wt(t[s.image])).needsUpdate=!0,a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),void 0!==s.mapping&&(a.mapping=i(s.mapping,ul)),void 0!==s.offset&&a.offset.fromArray(s.offset),void 0!==s.repeat&&a.repeat.fromArray(s.repeat),void 0!==s.center&&a.center.fromArray(s.center),void 0!==s.rotation&&(a.rotation=s.rotation),void 0!==s.wrap&&(a.wrapS=i(s.wrap[0],hl),a.wrapT=i(s.wrap[1],hl)),void 0!==s.format&&(a.format=s.format),void 0!==s.type&&(a.type=s.type),void 0!==s.encoding&&(a.encoding=s.encoding),void 0!==s.minFilter&&(a.minFilter=i(s.minFilter,pl)),void 0!==s.magFilter&&(a.magFilter=i(s.magFilter,pl)),void 0!==s.anisotropy&&(a.anisotropy=s.anisotropy),void 0!==s.flipY&&(a.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(a.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(a.unpackAlignment=s.unpackAlignment),r[s.uuid]=a}return r},parseObject:function(e,t,i){var r;function n(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function o(e){if(void 0!==e){if(Array.isArray(e)){for(var t=[],r=0,n=e.length;r<n;r++){var o=e[r];void 0===i[o]&&console.warn("THREE.ObjectLoader: Undefined material",o),t.push(i[o])}return t}return void 0===i[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),i[e]}}switch(e.type){case"Scene":r=new lo,void 0!==e.background&&Number.isInteger(e.background)&&(r.background=new ci(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?r.fog=new so(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(r.fog=new ao(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":r=new Wn(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(r.focus=e.focus),void 0!==e.zoom&&(r.zoom=e.zoom),void 0!==e.filmGauge&&(r.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(r.filmOffset=e.filmOffset),void 0!==e.view&&(r.view=Object.assign({},e.view));break;case"OrthographicCamera":r=new $s(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(r.zoom=e.zoom),void 0!==e.view&&(r.view=Object.assign({},e.view));break;case"AmbientLight":r=new il(e.color,e.intensity);break;case"DirectionalLight":r=new tl(e.color,e.intensity);break;case"PointLight":r=new Ks(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":r=new rl(e.color,e.intensity,e.width,e.height);break;case"SpotLight":r=new Js(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":r=new Ys(e.color,e.groundColor,e.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var a=n(e.geometry),s=o(e.material);r=a.bones&&a.bones.length>0?new mo(a,s):new ur(a,s),void 0!==e.drawMode&&r.setDrawMode(e.drawMode);break;case"LOD":r=new fo;break;case"Line":r=new bo(n(e.geometry),o(e.material),e.mode);break;case"LineLoop":r=new xo(n(e.geometry),o(e.material));break;case"LineSegments":r=new _o(n(e.geometry),o(e.material));break;case"PointCloud":case"Points":r=new wo(n(e.geometry),o(e.material));break;case"Sprite":r=new po(o(e.material));break;case"Group":r=new zn;break;default:r=new wi}if(r.uuid=e.uuid,void 0!==e.name&&(r.name=e.name),void 0!==e.matrix?(r.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(r.matrixAutoUpdate=e.matrixAutoUpdate),r.matrixAutoUpdate&&r.matrix.decompose(r.position,r.quaternion,r.scale)):(void 0!==e.position&&r.position.fromArray(e.position),void 0!==e.rotation&&r.rotation.fromArray(e.rotation),void 0!==e.quaternion&&r.quaternion.fromArray(e.quaternion),void 0!==e.scale&&r.scale.fromArray(e.scale)),void 0!==e.castShadow&&(r.castShadow=e.castShadow),void 0!==e.receiveShadow&&(r.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(r.shadow.bias=e.shadow.bias),void 0!==e.shadow.radius&&(r.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&r.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(r.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.frustumCulled&&(r.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(r.renderOrder=e.renderOrder),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.layers&&(r.layers.mask=e.layers),void 0!==e.children)for(var l=e.children,c=0;c<l.length;c++)r.add(this.parseObject(l[c],t,i));if("LOD"===e.type)for(var u=e.levels,h=0;h<u.length;h++){var p=u[h],d=r.getObjectByProperty("uuid",p.object);void 0!==d&&r.addLevel(d,p.distance)}return r}});var cl,ul={UVMapping:300,CubeReflectionMapping:ue,CubeRefractionMapping:he,EquirectangularReflectionMapping:pe,EquirectangularRefractionMapping:de,SphericalReflectionMapping:fe,CubeUVReflectionMapping:me,CubeUVRefractionMapping:ge},hl={RepeatWrapping:ve,ClampToEdgeWrapping:ye,MirroredRepeatWrapping:be},pl={NearestFilter:_e,NearestMipMapNearestFilter:xe,NearestMipMapLinearFilter:Ee,LinearFilter:we,LinearMipMapNearestFilter:Te,LinearMipMapLinearFilter:Se};function dl(e){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.manager=void 0!==e?e:ms,this.options=void 0}function fl(){this.type="ShapePath",this.color=new ci,this.subPaths=[],this.currentPath=null}function ml(e){this.type="Font",this.data=e}function gl(e,t,i,r,n){var o=n.glyphs[e]||n.glyphs["?"];if(o){var a,s,l,c,u,h,p,d,f=new fl;if(o.o)for(var m=o._cachedOutline||(o._cachedOutline=o.o.split(" ")),g=0,v=m.length;g<v;){switch(m[g++]){case"m":a=m[g++]*t+i,s=m[g++]*t+r,f.moveTo(a,s);break;case"l":a=m[g++]*t+i,s=m[g++]*t+r,f.lineTo(a,s);break;case"q":l=m[g++]*t+i,c=m[g++]*t+r,u=m[g++]*t+i,h=m[g++]*t+r,f.quadraticCurveTo(u,h,l,c);break;case"b":l=m[g++]*t+i,c=m[g++]*t+r,u=m[g++]*t+i,h=m[g++]*t+r,p=m[g++]*t+i,d=m[g++]*t+r,f.bezierCurveTo(u,h,p,d,l,c)}}return{offsetX:o.ha*t,path:f}}}function vl(e){this.manager=void 0!==e?e:ms}function yl(){}dl.prototype={constructor:dl,setOptions:function(e){return this.options=e,this},load:function(e,t,i,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var n=this,o=ds.get(e);if(void 0!==o)return n.manager.itemStart(e),setTimeout(function(){t&&t(o),n.manager.itemEnd(e)},0),o;fetch(e).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e,n.options)}).then(function(i){ds.add(e,i),t&&t(i),n.manager.itemEnd(e)}).catch(function(t){r&&r(t),n.manager.itemError(e),n.manager.itemEnd(e)})},setCrossOrigin:function(){return this},setPath:function(e){return this.path=e,this}},Object.assign(fl.prototype,{moveTo:function(e,t){this.currentPath=new Ws,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t)},lineTo:function(e,t){this.currentPath.lineTo(e,t)},quadraticCurveTo:function(e,t,i,r){this.currentPath.quadraticCurveTo(e,t,i,r)},bezierCurveTo:function(e,t,i,r,n,o){this.currentPath.bezierCurveTo(e,t,i,r,n,o)},splineThru:function(e){this.currentPath.splineThru(e)},toShapes:function(e,t){function i(e){for(var t=[],i=0,r=e.length;i<r;i++){var n=e[i],o=new Gs;o.curves=n.curves,t.push(o)}return t}function r(e,t){for(var i=t.length,r=!1,n=i-1,o=0;o<i;n=o++){var a=t[n],s=t[o],l=s.x-a.x,c=s.y-a.y;if(Math.abs(c)>Number.EPSILON){if(c<0&&(a=t[o],l=-l,s=t[n],c=-c),e.y<a.y||e.y>s.y)continue;if(e.y===a.y){if(e.x===a.x)return!0}else{var u=c*(e.x-a.x)-l*(e.y-a.y);if(0===u)return!0;if(u<0)continue;r=!r}}else{if(e.y!==a.y)continue;if(s.x<=e.x&&e.x<=a.x||a.x<=e.x&&e.x<=s.x)return!0}}return r}var n=ma.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===t)return i(o);var a,s,l,c=[];if(1===o.length)return s=o[0],(l=new Gs).curves=s.curves,c.push(l),c;var u=!n(o[0].getPoints());u=e?!u:u;var h,p,d=[],f=[],m=[],g=0;f[g]=void 0,m[g]=[];for(var v=0,y=o.length;v<y;v++)a=n(h=(s=o[v]).getPoints()),(a=e?!a:a)?(!u&&f[g]&&g++,f[g]={s:new Gs,p:h},f[g].s.curves=s.curves,u&&g++,m[g]=[]):m[g].push({h:s,p:h[0]});if(!f[0])return i(o);if(f.length>1){for(var b=!1,_=[],x=0,E=f.length;x<E;x++)d[x]=[];for(x=0,E=f.length;x<E;x++)for(var w=m[x],T=0;T<w.length;T++){for(var S=w[T],M=!0,R=0;R<f.length;R++)r(S.p,f[R].p)&&(x!==R&&_.push({froms:x,tos:R,hole:T}),M?(M=!1,d[R].push(S)):b=!0);M&&d[x].push(S)}_.length>0&&(b||(m=d))}v=0;for(var P=f.length;v<P;v++){l=f[v].s,c.push(l);for(var A=0,C=(p=m[v]).length;A<C;A++)l.holes.push(p[A].h)}return c}}),Object.assign(ml.prototype,{isFont:!0,generateShapes:function(e,t){void 0===t&&(t=100);for(var i=[],r=function(e,t,i){for(var r=Array.from?Array.from(e):String(e).split(""),n=t/i.resolution,o=(i.boundingBox.yMax-i.boundingBox.yMin+i.underlineThickness)*n,a=[],s=0,l=0,c=0;c<r.length;c++){var u=r[c];if("\n"===u)s=0,l-=o;else{var h=gl(u,n,s,l,i);s+=h.offsetX,a.push(h.path)}}return a}(e,t,this.data),n=0,o=r.length;n<o;n++)Array.prototype.push.apply(i,r[n].toShapes());return i}}),Object.assign(vl.prototype,{load:function(e,t,i,r){var n=this,o=new vs(this.manager);o.setPath(this.path),o.load(e,function(e){var i;try{i=JSON.parse(e)}catch(t){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),i=JSON.parse(e.substring(65,e.length-2))}var r=n.parse(i);t&&t(r)},i,r)},parse:function(e){return new ml(e)},setPath:function(e){return this.path=e,this}}),yl.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=this.handlers,i=0,r=t.length;i<r;i+=2){var n=t[i],o=t[i+1];if(n.test(e))return o}return null}},Object.assign(yl.prototype,{crossOrigin:"anonymous",onLoadStart:function(){},onLoadProgress:function(){},onLoadComplete:function(){},initMaterials:function(e,t,i){for(var r=[],n=0;n<e.length;++n)r[n]=this.createMaterial(e[n],t,i);return r},createMaterial:function(){var e={NoBlending:S,NormalBlending:M,AdditiveBlending:R,SubtractiveBlending:P,MultiplyBlending:A,CustomBlending:C},t=new ci,i=new ws,r=new nl;return function(n,o,a){var s={};function l(e,t,r,n,l){var c,u=o+e,h=yl.Handlers.get(u);null!==h?c=h.load(u):(i.setCrossOrigin(a),c=i.load(u)),void 0!==t&&(c.repeat.fromArray(t),1!==t[0]&&(c.wrapS=ve),1!==t[1]&&(c.wrapT=ve)),void 0!==r&&c.offset.fromArray(r),void 0!==n&&("repeat"===n[0]&&(c.wrapS=ve),"mirror"===n[0]&&(c.wrapS=be),"repeat"===n[1]&&(c.wrapT=ve),"mirror"===n[1]&&(c.wrapT=be)),void 0!==l&&(c.anisotropy=l);var p=Lt.generateUUID();return s[p]=c,p}var c={uuid:Lt.generateUUID(),type:"MeshLambertMaterial"};for(var u in n){var h=n[u];switch(u){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":c.name=h;break;case"blending":c.blending=e[h];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.Loader.createMaterial:",u,"is no longer supported.");break;case"colorDiffuse":c.color=t.fromArray(h).getHex();break;case"colorSpecular":c.specular=t.fromArray(h).getHex();break;case"colorEmissive":c.emissive=t.fromArray(h).getHex();break;case"specularCoef":c.shininess=h;break;case"shading":"basic"===h.toLowerCase()&&(c.type="MeshBasicMaterial"),"phong"===h.toLowerCase()&&(c.type="MeshPhongMaterial"),"standard"===h.toLowerCase()&&(c.type="MeshStandardMaterial");break;case"mapDiffuse":c.map=l(h,n.mapDiffuseRepeat,n.mapDiffuseOffset,n.mapDiffuseWrap,n.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":c.emissiveMap=l(h,n.mapEmissiveRepeat,n.mapEmissiveOffset,n.mapEmissiveWrap,n.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":c.lightMap=l(h,n.mapLightRepeat,n.mapLightOffset,n.mapLightWrap,n.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":c.aoMap=l(h,n.mapAORepeat,n.mapAOOffset,n.mapAOWrap,n.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":c.bumpMap=l(h,n.mapBumpRepeat,n.mapBumpOffset,n.mapBumpWrap,n.mapBumpAnisotropy);break;case"mapBumpScale":c.bumpScale=h;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":c.normalMap=l(h,n.mapNormalRepeat,n.mapNormalOffset,n.mapNormalWrap,n.mapNormalAnisotropy);break;case"mapNormalFactor":c.normalScale=h;break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":c.specularMap=l(h,n.mapSpecularRepeat,n.mapSpecularOffset,n.mapSpecularWrap,n.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":c.metalnessMap=l(h,n.mapMetalnessRepeat,n.mapMetalnessOffset,n.mapMetalnessWrap,n.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":c.roughnessMap=l(h,n.mapRoughnessRepeat,n.mapRoughnessOffset,n.mapRoughnessWrap,n.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":c.alphaMap=l(h,n.mapAlphaRepeat,n.mapAlphaOffset,n.mapAlphaWrap,n.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":c.side=_;break;case"doubleSided":c.side=x;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity"),c.opacity=h;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":c[u]=h;break;case"vertexColors":!0===h&&(c.vertexColors=T),"face"===h&&(c.vertexColors=w);break;default:console.error("THREE.Loader.createMaterial: Unsupported",u,h)}}return"MeshBasicMaterial"===c.type&&delete c.emissive,"MeshPhongMaterial"!==c.type&&delete c.specular,c.opacity<1&&(c.transparent=!0),r.setTextures(s),r.parse(c)}}()});var bl,_l,xl,El,wl,Tl,Sl,Ml,Rl,Pl,Al={getContext:function(){return void 0===cl&&(cl=new(window.AudioContext||window.webkitAudioContext)),cl},setContext:function(e){cl=e}};function Cl(e){this.manager=void 0!==e?e:ms}function Ol(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Wn,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Wn,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}function Ll(e,t,i,r){wi.call(this),this.type="CubeCamera";var n=new Wn(90,1,e,t);n.up.set(0,-1,0),n.lookAt(new Ft(1,0,0)),this.add(n);var o=new Wn(90,1,e,t);o.up.set(0,-1,0),o.lookAt(new Ft(-1,0,0)),this.add(o);var a=new Wn(90,1,e,t);a.up.set(0,0,1),a.lookAt(new Ft(0,1,0)),this.add(a);var s=new Wn(90,1,e,t);s.up.set(0,0,-1),s.lookAt(new Ft(0,-1,0)),this.add(s);var l=new Wn(90,1,e,t);l.up.set(0,-1,0),l.lookAt(new Ft(0,0,1)),this.add(l);var c=new Wn(90,1,e,t);c.up.set(0,-1,0),c.lookAt(new Ft(0,0,-1)),this.add(c),r=r||{format:Ie,magFilter:we,minFilter:we},this.renderTarget=new Qt(i,i,r),this.renderTarget.texture.name="CubeCamera",this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();var i=e.getRenderTarget(),r=this.renderTarget,u=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,r.activeCubeFace=0,e.render(t,n,r),r.activeCubeFace=1,e.render(t,o,r),r.activeCubeFace=2,e.render(t,a,r),r.activeCubeFace=3,e.render(t,s,r),r.activeCubeFace=4,e.render(t,l,r),r.texture.generateMipmaps=u,r.activeCubeFace=5,e.render(t,c,r),e.setRenderTarget(i)},this.clear=function(e,t,i,r){for(var n=e.getRenderTarget(),o=this.renderTarget,a=0;a<6;a++)o.activeCubeFace=a,e.setRenderTarget(o),e.clear(t,i,r);e.setRenderTarget(n)}}function kl(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}function Hl(){wi.call(this),this.type="AudioListener",this.context=Al.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0}function jl(e){wi.call(this),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.startTime=0,this.offset=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]}function Fl(e){jl.call(this,e),this.panner=this.context.createPanner(),this.panner.connect(this.gain)}function Dl(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=void 0!==t?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}function Bl(e,t,i){this.binding=e,this.valueSize=i;var r,n=Float64Array;switch(t){case"quaternion":r=this._slerp;break;case"string":case"bool":n=Array,r=this._select;break;default:r=this._lerp}this.buffer=new n(4*i),this._mixBufferRegion=r,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}Object.assign(Cl.prototype,{load:function(e,t,i,r){var n=new vs(this.manager);n.setResponseType("arraybuffer"),n.setPath(this.path),n.load(e,function(e){var i=e.slice(0);Al.getContext().decodeAudioData(i,function(e){t(e)})},i,r)},setPath:function(e){return this.path=e,this}}),Object.assign(Ol.prototype,{update:(Rl=new Ht,Pl=new Ht,function(e){if(bl!==this||_l!==e.focus||xl!==e.fov||El!==e.aspect*this.aspect||wl!==e.near||Tl!==e.far||Sl!==e.zoom||Ml!==this.eyeSep){bl=this,_l=e.focus,xl=e.fov,El=e.aspect*this.aspect,wl=e.near,Tl=e.far,Sl=e.zoom;var t,i,r=e.projectionMatrix.clone(),n=(Ml=this.eyeSep/2)*wl/_l,o=wl*Math.tan(Lt.DEG2RAD*xl*.5)/Sl;Pl.elements[12]=-Ml,Rl.elements[12]=Ml,t=-o*El+n,i=o*El+n,r.elements[0]=2*wl/(i-t),r.elements[8]=(i+t)/(i-t),this.cameraL.projectionMatrix.copy(r),t=-o*El-n,i=o*El-n,r.elements[0]=2*wl/(i-t),r.elements[8]=(i+t)/(i-t),this.cameraR.projectionMatrix.copy(r)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Pl),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(Rl)})}),Ll.prototype=Object.create(wi.prototype),Ll.prototype.constructor=Ll,Object.assign(kl.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}),Hl.prototype=Object.assign(Object.create(wi.prototype),{constructor:Hl,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this},updateMatrixWorld:function(){var e=new Ft,t=new jt,i=new Ft,r=new Ft,n=new kl;return function(o){wi.prototype.updateMatrixWorld.call(this,o);var a=this.context.listener,s=this.up;if(this.timeDelta=n.getDelta(),this.matrixWorld.decompose(e,t,i),r.set(0,0,-1).applyQuaternion(t),a.positionX){var l=this.context.currentTime+this.timeDelta;a.positionX.linearRampToValueAtTime(e.x,l),a.positionY.linearRampToValueAtTime(e.y,l),a.positionZ.linearRampToValueAtTime(e.z,l),a.forwardX.linearRampToValueAtTime(r.x,l),a.forwardY.linearRampToValueAtTime(r.y,l),a.forwardZ.linearRampToValueAtTime(r.z,l),a.upX.linearRampToValueAtTime(s.x,l),a.upY.linearRampToValueAtTime(s.y,l),a.upZ.linearRampToValueAtTime(s.z,l)}else a.setPosition(e.x,e.y,e.z),a.setOrientation(r.x,r.y,r.z,s.x,s.y,s.z)}}()}),jl.prototype=Object.assign(Object.create(wi.prototype),{constructor:jl,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setMediaElementSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(){if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){var e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.onended=this.onEnded.bind(this),this.startTime=this.context.currentTime,e.start(this.startTime,this.offset),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this.source.stop(),this.source.onended=null,this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.source.onended=null,this.offset=0,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e||(e=[]),!0===this.isPlaying?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},setDetune:function(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}),Fl.prototype=Object.assign(Object.create(jl.prototype),{constructor:Fl,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){return this.panner.refDistance=e,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){return this.panner.rolloffFactor=e,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){return this.panner.distanceModel=e,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){return this.panner.maxDistance=e,this},setDirectionalCone:function(e,t,i){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=i,this},updateMatrixWorld:function(){var e=new Ft,t=new jt,i=new Ft,r=new Ft;return function(n){if(wi.prototype.updateMatrixWorld.call(this,n),!1!==this.isPlaying){this.matrixWorld.decompose(e,t,i),r.set(0,0,1).applyQuaternion(t);var o=this.panner;if(o.positionX){var a=this.context.currentTime+this.listener.timeDelta;o.positionX.linearRampToValueAtTime(e.x,a),o.positionY.linearRampToValueAtTime(e.y,a),o.positionZ.linearRampToValueAtTime(e.z,a),o.orientationX.linearRampToValueAtTime(r.x,a),o.orientationY.linearRampToValueAtTime(r.y,a),o.orientationZ.linearRampToValueAtTime(r.z,a)}else o.setPosition(e.x,e.y,e.z),o.setOrientation(r.x,r.y,r.z)}}}()}),Object.assign(Dl.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var e=0,t=this.getFrequencyData(),i=0;i<t.length;i++)e+=t[i];return e/t.length}}),Object.assign(Bl.prototype,{accumulate:function(e,t){var i=this.buffer,r=this.valueSize,n=e*r+r,o=this.cumulativeWeight;if(0===o){for(var a=0;a!==r;++a)i[n+a]=i[a];o=t}else{var s=t/(o+=t);this._mixBufferRegion(i,n,0,s,r)}this.cumulativeWeight=o},apply:function(e){var t=this.valueSize,i=this.buffer,r=e*t+t,n=this.cumulativeWeight,o=this.binding;if(this.cumulativeWeight=0,n<1){var a=3*t;this._mixBufferRegion(i,r,a,1-n,t)}for(var s=t,l=t+t;s!==l;++s)if(i[s]!==i[s+t]){o.setValue(i,r);break}},saveOriginalState:function(){var e=this.binding,t=this.buffer,i=this.valueSize,r=3*i;e.getValue(t,r);for(var n=i,o=r;n!==o;++n)t[n]=t[r+n%i];this.cumulativeWeight=0},restoreOriginalState:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_select:function(e,t,i,r,n){if(r>=.5)for(var o=0;o!==n;++o)e[t+o]=e[i+o]},_slerp:function(e,t,i,r){jt.slerpFlat(e,t,e,t,e,i,r)},_lerp:function(e,t,i,r,n){for(var o=1-r,a=0;a!==n;++a){var s=t+a;e[s]=e[s]*o+e[i+a]*r}}});var Il,Nl,Ul,Vl,zl,ql,Wl,Gl,Xl,Yl,Ql,Zl,Jl,Kl,$l;function ec(e,t,i){var r=i||tc.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}function tc(e,t,i){this.path=t,this.parsedPath=i||tc.parseTrackName(t),this.node=tc.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function ic(){this.uuid=Lt.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,i=arguments.length;t!==i;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var r=this;this.stats={objects:{get total(){return r._objects.length},get inUse(){return this.total-r.nCachedObjects_}},get bindingsPerObject(){return r._bindings.length}}}function rc(e,t,i){this._mixer=e,this._clip=t,this._localRoot=i||null;for(var r=t.tracks,n=r.length,o=new Array(n),a={endingStart:vt,endingEnd:vt},s=0;s!==n;++s){var l=r[s].createInterpolant(null);o[s]=l,l.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(n),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=gt,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function nc(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function oc(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}function ac(){Ui.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function sc(e,t,i){co.call(this,e,t),this.meshPerAttribute=i||1}function lc(e,t,i,r){"number"==typeof i&&(r=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),Pi.call(this,e,t,i),this.meshPerAttribute=r||1}function cc(e,t,i,r){this.ray=new sr(e,t),this.near=i||0,this.far=r||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function uc(e,t){return e.distance-t.distance}function hc(e,t,i,r){if(!1!==e.visible&&(e.raycast(t,i),!0===r))for(var n=e.children,o=0,a=n.length;o<a;o++)hc(n[o],t,i,!0)}function pc(e,t,i){return this.radius=void 0!==e?e:1,this.phi=void 0!==t?t:0,this.theta=void 0!==i?i:0,this}function dc(e,t,i){return this.radius=void 0!==e?e:1,this.theta=void 0!==t?t:0,this.y=void 0!==i?i:0,this}function fc(e,t){this.min=void 0!==e?e:new kt(1/0,1/0),this.max=void 0!==t?t:new kt(-1/0,-1/0)}function mc(e,t){this.start=void 0!==e?e:new Ft,this.end=void 0!==t?t:new Ft}function gc(e){wi.call(this),this.material=e,this.render=function(){}}function vc(e,t,i,r){this.object=e,this.size=void 0!==t?t:1;var n=void 0!==i?i:16711680,o=void 0!==r?r:1,a=0,s=this.object.geometry;s&&s.isGeometry?a=3*s.faces.length:s&&s.isBufferGeometry&&(a=s.attributes.normal.count);var l=new Ui,c=new Fi(2*a*3,3);l.addAttribute("position",c),_o.call(this,l,new yo({color:n,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function yc(e,t){wi.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;for(var i=new Ui,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],n=0,o=1;n<32;n++,o++){var a=n/32*Math.PI*2,s=o/32*Math.PI*2;r.push(Math.cos(a),Math.sin(a),1,Math.cos(s),Math.sin(s),1)}i.addAttribute("position",new Fi(r,3));var l=new yo({fog:!1});this.cone=new _o(i,l),this.add(this.cone),this.update()}function bc(e){for(var t=function e(t){var i=[];t&&t.isBone&&i.push(t);for(var r=0;r<t.children.length;r++)i.push.apply(i,e(t.children[r]));return i}(e),i=new Ui,r=[],n=[],o=new ci(0,0,1),a=new ci(0,1,0),s=0;s<t.length;s++){var l=t[s];l.parent&&l.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),n.push(o.r,o.g,o.b),n.push(a.r,a.g,a.b))}i.addAttribute("position",new Fi(r,3)),i.addAttribute("color",new Fi(n,3));var c=new yo({vertexColors:T,depthTest:!1,depthWrite:!1,transparent:!0});_o.call(this,i,c),this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}function _c(e,t,i){this.light=e,this.light.updateMatrixWorld(),this.color=i;var r=new Sa(t,4,2),n=new cr({wireframe:!0,fog:!1});ur.call(this,r,n),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function xc(e,t){this.type="RectAreaLightHelper",this.light=e,this.color=t;var i=new Ui;i.addAttribute("position",new Fi([1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),i.computeBoundingSphere();var r=new yo({fog:!1});bo.call(this,i,r);var n=new Ui;n.addAttribute("position",new Fi([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),n.computeBoundingSphere(),this.add(new ur(n,new cr({side:_,fog:!1}))),this.update()}function Ec(e,t,i){wi.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i;var r=new Fo(t);r.rotateY(.5*Math.PI),this.material=new cr({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=T);var n=r.getAttribute("position"),o=new Float32Array(3*n.count);r.addAttribute("color",new Pi(o,3)),this.add(new ur(r,this.material)),this.update()}function wc(e,t,i,r){e=e||10,t=t||10,i=new ci(void 0!==i?i:4473924),r=new ci(void 0!==r?r:8947848);for(var n=t/2,o=e/t,a=e/2,s=[],l=[],c=0,u=0,h=-a;c<=t;c++,h+=o){s.push(-a,0,h,a,0,h),s.push(h,0,-a,h,0,a);var p=c===n?i:r;p.toArray(l,u),u+=3,p.toArray(l,u),u+=3,p.toArray(l,u),u+=3,p.toArray(l,u),u+=3}var d=new Ui;d.addAttribute("position",new Fi(s,3)),d.addAttribute("color",new Fi(l,3));var f=new yo({vertexColors:T});_o.call(this,d,f)}function Tc(e,t,i,r,n,o){e=e||10,t=t||16,i=i||8,r=r||64,n=new ci(void 0!==n?n:4473924),o=new ci(void 0!==o?o:8947848);var a,s,l,c,u,h,p,d=[],f=[];for(c=0;c<=t;c++)l=c/t*(2*Math.PI),a=Math.sin(l)*e,s=Math.cos(l)*e,d.push(0,0,0),d.push(a,0,s),p=1&c?n:o,f.push(p.r,p.g,p.b),f.push(p.r,p.g,p.b);for(c=0;c<=i;c++)for(p=1&c?n:o,h=e-e/i*c,u=0;u<r;u++)l=u/r*(2*Math.PI),a=Math.sin(l)*h,s=Math.cos(l)*h,d.push(a,0,s),f.push(p.r,p.g,p.b),l=(u+1)/r*(2*Math.PI),a=Math.sin(l)*h,s=Math.cos(l)*h,d.push(a,0,s),f.push(p.r,p.g,p.b);var m=new Ui;m.addAttribute("position",new Fi(d,3)),m.addAttribute("color",new Fi(f,3));var g=new yo({vertexColors:T});_o.call(this,m,g)}function Sc(e,t,i,r){this.object=e,this.size=void 0!==t?t:1;var n=void 0!==i?i:16776960,o=void 0!==r?r:1,a=0,s=this.object.geometry;s&&s.isGeometry?a=s.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");var l=new Ui,c=new Fi(2*a*3,3);l.addAttribute("position",c),_o.call(this,l,new yo({color:n,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function Mc(e,t,i){wi.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,void 0===t&&(t=1);var r=new Ui;r.addAttribute("position",new Fi([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));var n=new yo({fog:!1});this.lightPlane=new bo(r,n),this.add(this.lightPlane),(r=new Ui).addAttribute("position",new Fi([0,0,0,0,0,1],3)),this.targetLine=new bo(r,n),this.add(this.targetLine),this.update()}function Rc(e){var t=new Ui,i=new yo({color:16777215,vertexColors:w}),r=[],n=[],o={},a=new ci(16755200),s=new ci(16711680),l=new ci(43775),c=new ci(16777215),u=new ci(3355443);function h(e,t,i){p(e,i),p(t,i)}function p(e,t){r.push(0,0,0),n.push(t.r,t.g,t.b),void 0===o[e]&&(o[e]=[]),o[e].push(r.length/3-1)}h("n1","n2",a),h("n2","n4",a),h("n4","n3",a),h("n3","n1",a),h("f1","f2",a),h("f2","f4",a),h("f4","f3",a),h("f3","f1",a),h("n1","f1",a),h("n2","f2",a),h("n3","f3",a),h("n4","f4",a),h("p","n1",s),h("p","n2",s),h("p","n3",s),h("p","n4",s),h("u1","u2",l),h("u2","u3",l),h("u3","u1",l),h("c","t",c),h("p","c",u),h("cn1","cn2",u),h("cn3","cn4",u),h("cf1","cf2",u),h("cf3","cf4",u),t.addAttribute("position",new Fi(r,3)),t.addAttribute("color",new Fi(n,3)),_o.call(this,t,i),this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}function Pc(e,t){this.object=e,void 0===t&&(t=16776960);var i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),n=new Ui;n.setIndex(new Pi(i,1)),n.addAttribute("position",new Pi(r,3)),_o.call(this,n,new yo({color:t})),this.matrixAutoUpdate=!1,this.update()}function Ac(e,t){this.type="Box3Helper",this.box=e;var i=void 0!==t?t:16776960,r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Ui;n.setIndex(new Pi(r,1)),n.addAttribute("position",new Fi([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),_o.call(this,n,new yo({color:i})),this.geometry.computeBoundingSphere()}function Cc(e,t,i){this.type="PlaneHelper",this.plane=e,this.size=void 0===t?1:t;var r=void 0!==i?i:16776960,n=new Ui;n.addAttribute("position",new Fi([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),n.computeBoundingSphere(),bo.call(this,n,new yo({color:r}));var o=new Ui;o.addAttribute("position",new Fi([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),o.computeBoundingSphere(),this.add(new ur(o,new cr({color:r,opacity:.2,transparent:!0,depthWrite:!1})))}function Oc(e,t,i,r,n,o){wi.call(this),void 0===e&&(e=new Ft(0,0,1)),void 0===t&&(t=new Ft(0,0,0)),void 0===i&&(i=1),void 0===r&&(r=16776960),void 0===n&&(n=.2*i),void 0===o&&(o=.2*n),void 0===Zl&&((Zl=new Ui).addAttribute("position",new Fi([0,0,0,0,1,0],3)),(Jl=new ja(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(t),this.line=new bo(Zl,new yo({color:r})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new ur(Jl,new cr({color:r})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i,n,o)}function Lc(e){var t=[0,0,0,e=e||1,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=new Ui;i.addAttribute("position",new Fi(t,3)),i.addAttribute("color",new Fi([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var r=new yo({vertexColors:T});_o.call(this,i,r)}Object.assign(ec.prototype,{getValue:function(e,t){this.bind();var i=this._targetGroup.nCachedObjects_,r=this._bindings[i];void 0!==r&&r.getValue(e,t)},setValue:function(e,t){for(var i=this._bindings,r=this._targetGroup.nCachedObjects_,n=i.length;r!==n;++r)i[r].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}),Object.assign(tc,{Composite:ec,create:function(e,t,i){return e&&e.isAnimationObjectGroup?new tc.Composite(e,t,i):new tc(e,t,i)},sanitizeNodeName:(Xl=new RegExp("[\\[\\]\\.:\\/]","g"),function(e){return e.replace(/\s/g,"_").replace(Xl,"")}),parseTrackName:(Il="[^\\[\\]\\.:\\/]",Nl="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",Ul=/((?:WC+[\/:])*)/.source.replace("WC",Il),Vl=/(WCOD+)?/.source.replace("WCOD",Nl),zl=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Il),ql=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Il),Wl=new RegExp("^"+Ul+Vl+zl+ql+"$"),Gl=["material","materials","bones"],function(e){var t=Wl.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){var n=i.nodeName.substring(r+1);-1!==Gl.indexOf(n)&&(i.nodeName=i.nodeName.substring(0,r),i.objectName=n)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}),findNode:function(e,t){if(!t||""===t||"root"===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var i=e.skeleton.getBoneByName(t);if(void 0!==i)return i}if(e.children){var r=function(e){for(var i=0;i<e.length;i++){var n=e[i];if(n.name===t||n.uuid===t)return n;var o=r(n.children);if(o)return o}return null},n=r(e.children);if(n)return n}return null}}),Object.assign(tc.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){for(var i=this.resolvedProperty,r=0,n=i.length;r!==n;++r)e[t++]=i[r]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){for(var i=this.resolvedProperty,r=0,n=i.length;r!==n;++r)i[r]=e[t++]},function(e,t){for(var i=this.resolvedProperty,r=0,n=i.length;r!==n;++r)i[r]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){for(var i=this.resolvedProperty,r=0,n=i.length;r!==n;++r)i[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,i=t.objectName,r=t.propertyName,n=t.propertyIndex;if(e||(e=tc.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(i){var o=t.objectIndex;switch(i){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(var a=0;a<e.length;a++)if(e[a].name===o){o=a;break}break;default:if(void 0===e[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[i]}if(void 0!==o){if(void 0===e[o])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[o]}}var s=e[r];if(void 0!==s){var l=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?l=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate);var c=this.BindingType.Direct;if(void 0!==n){if("morphTargetInfluences"===r){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(a=0;a<this.node.geometry.morphAttributes.position.length;a++)if(e.geometry.morphAttributes.position[a].name===n){n=a;break}}else{if(!e.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(a=0;a<this.node.geometry.morphTargets.length;a++)if(e.geometry.morphTargets[a].name===n){n=a;break}}}c=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=n}else void 0!==s.fromArray&&void 0!==s.toArray?(c=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(c=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=r;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][l]}else{var u=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+u+"."+r+" but it wasn't found.",e)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(tc.prototype,{_getValue_unbound:tc.prototype.getValue,_setValue_unbound:tc.prototype.setValue}),Object.assign(ic.prototype,{isAnimationObjectGroup:!0,add:function(){for(var e=this._objects,t=e.length,i=this.nCachedObjects_,r=this._indicesByUUID,n=this._paths,o=this._parsedPaths,a=this._bindings,s=a.length,l=void 0,c=0,u=arguments.length;c!==u;++c){var h=arguments[c],p=h.uuid,d=r[p];if(void 0===d){d=t++,r[p]=d,e.push(h);for(var f=0,m=s;f!==m;++f)a[f].push(new tc(h,n[f],o[f]))}else if(d<i){l=e[d];var g=--i,v=e[g];r[v.uuid]=d,e[d]=v,r[p]=g,e[g]=h;for(f=0,m=s;f!==m;++f){var y=a[f],b=y[g],_=y[d];y[d]=b,void 0===_&&(_=new tc(h,n[f],o[f])),y[g]=_}}else e[d]!==l&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=i},remove:function(){for(var e=this._objects,t=this.nCachedObjects_,i=this._indicesByUUID,r=this._bindings,n=r.length,o=0,a=arguments.length;o!==a;++o){var s=arguments[o],l=s.uuid,c=i[l];if(void 0!==c&&c>=t){var u=t++,h=e[u];i[h.uuid]=c,e[c]=h,i[l]=u,e[u]=s;for(var p=0,d=n;p!==d;++p){var f=r[p],m=f[u],g=f[c];f[c]=m,f[u]=g}}}this.nCachedObjects_=t},uncache:function(){for(var e=this._objects,t=e.length,i=this.nCachedObjects_,r=this._indicesByUUID,n=this._bindings,o=n.length,a=0,s=arguments.length;a!==s;++a){var l=arguments[a],c=l.uuid,u=r[c];if(void 0!==u)if(delete r[c],u<i){var h=--i,p=e[h],d=e[y=--t];r[p.uuid]=u,e[u]=p,r[d.uuid]=h,e[h]=d,e.pop();for(var f=0,m=o;f!==m;++f){var g=(b=n[f])[h],v=b[y];b[u]=g,b[h]=v,b.pop()}}else{var y;r[(d=e[y=--t]).uuid]=u,e[u]=d,e.pop();for(f=0,m=o;f!==m;++f){var b;(b=n[f])[u]=b[y],b.pop()}}}this.nCachedObjects_=i},subscribe_:function(e,t){var i=this._bindingsIndicesByPath,r=i[e],n=this._bindings;if(void 0!==r)return n[r];var o=this._paths,a=this._parsedPaths,s=this._objects,l=s.length,c=this.nCachedObjects_,u=new Array(l);r=n.length,i[e]=r,o.push(e),a.push(t),n.push(u);for(var h=c,p=s.length;h!==p;++h){var d=s[h];u[h]=new tc(d,e,t)}return u},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,i=t[e];if(void 0!==i){var r=this._paths,n=this._parsedPaths,o=this._bindings,a=o.length-1,s=o[a];t[e[a]]=i,o[i]=s,o.pop(),n[i]=n[a],n.pop(),r[i]=r[a],r.pop()}}}),Object.assign(rc.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){var r=this._clip.duration,n=e._clip.duration,o=n/r,a=r/n;e.warp(1,o,t),this.warp(a,1,t)}return this},crossFadeTo:function(e,t,i){return e.crossFadeFrom(this,t,i)},stopFading:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,i){var r=this._mixer,n=r.time,o=this._timeScaleInterpolant,a=this.timeScale;null===o&&(o=r._lendControlInterpolant(),this._timeScaleInterpolant=o);var s=o.parameterPositions,l=o.sampleValues;return s[0]=n,s[1]=n+i,l[0]=e/a,l[1]=t/a,this},stopWarping:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(e,t,i,r){if(this.enabled){var n=this._startTime;if(null!==n){var o=(e-n)*i;if(o<0||0===i)return;this._startTime=null,t=i*o}t*=this._updateTimeScale(e);var a=this._updateTime(t),s=this._updateWeight(e);if(s>0)for(var l=this._interpolants,c=this._propertyBindings,u=0,h=l.length;u!==h;++u)l[u].evaluate(a),c[u].accumulate(r,s)}else this._updateWeight(e)},_updateWeight:function(e){var t=0;if(this.enabled){t=this.weight;var i=this._weightInterpolant;if(null!==i){var r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=t,t},_updateTimeScale:function(e){var t=0;if(!this.paused){t=this.timeScale;var i=this._timeScaleInterpolant;if(null!==i)t*=i.evaluate(e)[0],e>i.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}return this._effectiveTimeScale=t,t},_updateTime:function(e){var t=this.time+e,i=this._clip.duration,r=this.loop,n=this._loopCount,o=2202===r;if(0===e)return-1===n?t:o&&1==(1&n)?i-t:t;if(2200===r){-1===n&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(t>=i)t=i;else{if(!(t<0))break e;t=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===n&&(e>=0?(n=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),t>=i||t<0){var a=Math.floor(t/i);t-=i*a,n+=Math.abs(a);var s=this.repetitions-n;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,t=e>0?i:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){var l=e<0;this._setEndings(l,!l,o)}else this._setEndings(!1,!1,o);this._loopCount=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}if(o&&1==(1&n))return this.time=t,i-t}return this.time=t,t},_setEndings:function(e,t,i){var r=this._interpolantSettings;i?(r.endingStart=2401,r.endingEnd=2401):(r.endingStart=e?this.zeroSlopeAtStart?2401:vt:2402,r.endingEnd=t?this.zeroSlopeAtEnd?2401:vt:2402)},_scheduleFading:function(e,t,i){var r=this._mixer,n=r.time,o=this._weightInterpolant;null===o&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);var a=o.parameterPositions,s=o.sampleValues;return a[0]=n,s[0]=t,a[1]=n+e,s[1]=i,this}}),nc.prototype=Object.assign(Object.create(t.prototype),{constructor:nc,_bindAction:function(e,t){var i=e._localRoot||this._root,r=e._clip.tracks,n=r.length,o=e._propertyBindings,a=e._interpolants,s=i.uuid,l=this._bindingsByRootAndName,c=l[s];void 0===c&&(c={},l[s]=c);for(var u=0;u!==n;++u){var h=r[u],p=h.name,d=c[p];if(void 0!==d)o[u]=d;else{if(void 0!==(d=o[u])){null===d._cacheIndex&&(++d.referenceCount,this._addInactiveBinding(d,s,p));continue}var f=t&&t._propertyBindings[u].binding.parsedPath;++(d=new Bl(tc.create(i,p,f),h.ValueTypeName,h.getValueSize())).referenceCount,this._addInactiveBinding(d,s,p),o[u]=d}a[u].resultBuffer=d.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,i=e._clip.uuid,r=this._actionsByClip[i];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,i,t)}for(var n=e._propertyBindings,o=0,a=n.length;o!==a;++o){var s=n[o];0==s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,i=0,r=t.length;i!==r;++i){var n=t[i];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(e,t,i){var r=this._actions,n=this._actionsByClip,o=n[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,n[t]=o;else{var a=o.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=r.length,r.push(e),o.actionByRoot[i]=e},_removeInactiveAction:function(e){var t=this._actions,i=t[t.length-1],r=e._cacheIndex;i._cacheIndex=r,t[r]=i,t.pop(),e._cacheIndex=null;var n=e._clip.uuid,o=this._actionsByClip,a=o[n],s=a.knownActions,l=s[s.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,s[c]=l,s.pop(),e._byClipCacheIndex=null,delete a.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete o[n],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=e._propertyBindings,i=0,r=t.length;i!==r;++i){var n=t[i];0==--n.referenceCount&&this._removeInactiveBinding(n)}},_lendAction:function(e){var t=this._actions,i=e._cacheIndex,r=this._nActiveActions++,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n},_takeBackAction:function(e){var t=this._actions,i=e._cacheIndex,r=--this._nActiveActions,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n},_addInactiveBinding:function(e,t,i){var r=this._bindingsByRootAndName,n=r[t],o=this._bindings;void 0===n&&(n={},r[t]=n),n[i]=e,e._cacheIndex=o.length,o.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,i=e.binding,r=i.rootNode.uuid,n=i.path,o=this._bindingsByRootAndName,a=o[r],s=t[t.length-1],l=e._cacheIndex;s._cacheIndex=l,t[l]=s,t.pop(),delete a[n];e:{for(var c in a)break e;delete o[r]}},_lendBinding:function(e){var t=this._bindings,i=e._cacheIndex,r=this._nActiveBindings++,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n},_takeBackBinding:function(e){var t=this._bindings,i=e._cacheIndex,r=--this._nActiveBindings,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,i=e[t];return void 0===i&&((i=new ts(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t,e[t]=i),i},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,i=e.__cacheIndex,r=--this._nActiveControlInterpolants,n=t[r];e.__cacheIndex=r,t[r]=e,n.__cacheIndex=i,t[i]=n},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t){var i=t||this._root,r=i.uuid,n="string"==typeof e?hs.findByName(i,e):e,o=null!==n?n.uuid:e,a=this._actionsByClip[o],s=null;if(void 0!==a){var l=a.actionByRoot[r];if(void 0!==l)return l;s=a.knownActions[0],null===n&&(n=s._clip)}if(null===n)return null;var c=new rc(this,n,t);return this._bindAction(c,s),this._addInactiveAction(c,o,r),c},existingAction:function(e,t){var i=t||this._root,r=i.uuid,n="string"==typeof e?hs.findByName(i,e):e,o=n?n.uuid:e,a=this._actionsByClip[o];return void 0!==a&&a.actionByRoot[r]||null},stopAllAction:function(){var e=this._actions,t=this._nActiveActions,i=this._bindings,r=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var n=0;n!==t;++n)e[n].reset();for(n=0;n!==r;++n)i[n].useCount=0;return this},update:function(e){e*=this.timeScale;for(var t=this._actions,i=this._nActiveActions,r=this.time+=e,n=Math.sign(e),o=this._accuIndex^=1,a=0;a!==i;++a){t[a]._update(r,e,n,o)}var s=this._bindings,l=this._nActiveBindings;for(a=0;a!==l;++a)s[a].apply(o);return this},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,i=e.uuid,r=this._actionsByClip,n=r[i];if(void 0!==n){for(var o=n.knownActions,a=0,s=o.length;a!==s;++a){var l=o[a];this._deactivateAction(l);var c=l._cacheIndex,u=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,u._cacheIndex=c,t[c]=u,t.pop(),this._removeInactiveBindingsForAction(l)}delete r[i]}},uncacheRoot:function(e){var t=e.uuid,i=this._actionsByClip;for(var r in i){var n=i[r].actionByRoot[t];void 0!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}var o=this._bindingsByRootAndName[t];if(void 0!==o)for(var a in o){var s=o[a];s.restoreOriginalState(),this._removeInactiveBinding(s)}},uncacheAction:function(e,t){var i=this.existingAction(e,t);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}}),oc.prototype.clone=function(){return new oc(void 0===this.value.clone?this.value:this.value.clone())},ac.prototype=Object.assign(Object.create(Ui.prototype),{constructor:ac,isInstancedBufferGeometry:!0,copy:function(e){return Ui.prototype.copy.call(this,e),this.maxInstancedCount=e.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)}}),sc.prototype=Object.assign(Object.create(co.prototype),{constructor:sc,isInstancedInterleavedBuffer:!0,copy:function(e){return co.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),lc.prototype=Object.assign(Object.create(Pi.prototype),{constructor:lc,isInstancedBufferAttribute:!0,copy:function(e){return Pi.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Object.assign(cc.prototype,{linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize()):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,t,i){var r=i||[];return hc(e,this,r,t),r.sort(uc),r},intersectObjects:function(e,t,i){var r=i||[];if(!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),r;for(var n=0,o=e.length;n<o;n++)hc(e[n],this,r,t);return r.sort(uc),r}}),Object.assign(pc.prototype,{set:function(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(Lt.clamp(t/this.radius,-1,1))),this}}),Object.assign(dc.prototype,{set:function(e,t,i){return this.radius=e,this.theta=t,this.y=i,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,i){return this.radius=Math.sqrt(e*e+i*i),this.theta=Math.atan2(e,i),this.y=t,this}}),Object.assign(fc.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new kt;return function(t,i){var r=e.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new kt),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new kt),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new kt),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new kt),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new kt;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),Object.assign(mc.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function(e){return void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new Ft),e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new Ft),e.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){return void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new Ft),this.delta(t).multiplyScalar(e).add(this.start)},closestPointToPointParameter:(Yl=new Ft,Ql=new Ft,function(e,t){Yl.subVectors(e,this.start),Ql.subVectors(this.end,this.start);var i=Ql.dot(Ql),r=Ql.dot(Yl)/i;return t&&(r=Lt.clamp(r,0,1)),r}),closestPointToPoint:function(e,t,i){var r=this.closestPointToPointParameter(e,t);return void 0===i&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),i=new Ft),this.delta(i).multiplyScalar(r).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}),gc.prototype=Object.create(wi.prototype),gc.prototype.constructor=gc,gc.prototype.isImmediateRenderObject=!0,vc.prototype=Object.create(_o.prototype),vc.prototype.constructor=vc,vc.prototype.update=function(){var e=new Ft,t=new Ft,i=new Dt;return function(){var r=["a","b","c"];this.object.updateMatrixWorld(!0),i.getNormalMatrix(this.object.matrixWorld);var n=this.object.matrixWorld,o=this.geometry.attributes.position,a=this.object.geometry;if(a&&a.isGeometry)for(var s=a.vertices,l=a.faces,c=0,u=0,h=l.length;u<h;u++)for(var p=l[u],d=0,f=p.vertexNormals.length;d<f;d++){var m=s[p[r[d]]],g=p.vertexNormals[d];e.copy(m).applyMatrix4(n),t.copy(g).applyMatrix3(i).normalize().multiplyScalar(this.size).add(e),o.setXYZ(c,e.x,e.y,e.z),c+=1,o.setXYZ(c,t.x,t.y,t.z),c+=1}else if(a&&a.isBufferGeometry){var v=a.attributes.position,y=a.attributes.normal;for(c=0,d=0,f=v.count;d<f;d++)e.set(v.getX(d),v.getY(d),v.getZ(d)).applyMatrix4(n),t.set(y.getX(d),y.getY(d),y.getZ(d)),t.applyMatrix3(i).normalize().multiplyScalar(this.size).add(e),o.setXYZ(c,e.x,e.y,e.z),c+=1,o.setXYZ(c,t.x,t.y,t.z),c+=1}o.needsUpdate=!0}}(),yc.prototype=Object.create(wi.prototype),yc.prototype.constructor=yc,yc.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},yc.prototype.update=function(){var e=new Ft;return function(){this.light.updateMatrixWorld();var t=this.light.distance?this.light.distance:1e3,i=t*Math.tan(this.light.angle);this.cone.scale.set(i,i,t),e.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(e),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}(),bc.prototype=Object.create(_o.prototype),bc.prototype.constructor=bc,bc.prototype.updateMatrixWorld=function(){var e=new Ft,t=new Ht,i=new Ht;return function(r){var n=this.bones,o=this.geometry,a=o.getAttribute("position");i.getInverse(this.root.matrixWorld);for(var s=0,l=0;s<n.length;s++){var c=n[s];c.parent&&c.parent.isBone&&(t.multiplyMatrices(i,c.matrixWorld),e.setFromMatrixPosition(t),a.setXYZ(l,e.x,e.y,e.z),t.multiplyMatrices(i,c.parent.matrixWorld),e.setFromMatrixPosition(t),a.setXYZ(l+1,e.x,e.y,e.z),l+=2)}o.getAttribute("position").needsUpdate=!0,wi.prototype.updateMatrixWorld.call(this,r)}}(),_c.prototype=Object.create(ur.prototype),_c.prototype.constructor=_c,_c.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},_c.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)},xc.prototype=Object.create(bo.prototype),xc.prototype.constructor=xc,xc.prototype.update=function(){if(this.scale.set(.5*this.light.width,.5*this.light.height,1),void 0!==this.color)this.material.color.set(this.color),this.children[0].material.color.set(this.color);else{this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);var e=this.material.color,t=Math.max(e.r,e.g,e.b);t>1&&e.multiplyScalar(1/t),this.children[0].material.color.copy(this.material.color)}},xc.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()},Ec.prototype=Object.create(wi.prototype),Ec.prototype.constructor=Ec,Ec.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},Ec.prototype.update=function(){var e=new Ft,t=new ci,i=new ci;return function(){var r=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var n=r.geometry.getAttribute("color");t.copy(this.light.color),i.copy(this.light.groundColor);for(var o=0,a=n.count;o<a;o++){var s=o<a/2?t:i;n.setXYZ(o,s.r,s.g,s.b)}n.needsUpdate=!0}r.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate())}}(),wc.prototype=Object.create(_o.prototype),wc.prototype.constructor=wc,Tc.prototype=Object.create(_o.prototype),Tc.prototype.constructor=Tc,Sc.prototype=Object.create(_o.prototype),Sc.prototype.constructor=Sc,Sc.prototype.update=function(){var e=new Ft,t=new Ft,i=new Dt;return function(){this.object.updateMatrixWorld(!0),i.getNormalMatrix(this.object.matrixWorld);for(var r=this.object.matrixWorld,n=this.geometry.attributes.position,o=this.object.geometry,a=o.vertices,s=o.faces,l=0,c=0,u=s.length;c<u;c++){var h=s[c],p=h.normal;e.copy(a[h.a]).add(a[h.b]).add(a[h.c]).divideScalar(3).applyMatrix4(r),t.copy(p).applyMatrix3(i).normalize().multiplyScalar(this.size).add(e),n.setXYZ(l,e.x,e.y,e.z),l+=1,n.setXYZ(l,t.x,t.y,t.z),l+=1}n.needsUpdate=!0}}(),Mc.prototype=Object.create(wi.prototype),Mc.prototype.constructor=Mc,Mc.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},Mc.prototype.update=function(){var e=new Ft,t=new Ft,i=new Ft;return function(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),i.subVectors(t,e),this.lightPlane.lookAt(t),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(t),this.targetLine.scale.z=i.length()}}(),Rc.prototype=Object.create(_o.prototype),Rc.prototype.constructor=Rc,Rc.prototype.update=function(){var e,t,i=new Ft,r=new qn;function n(n,o,a,s){i.set(o,a,s).unproject(r);var l=t[n];if(void 0!==l)for(var c=e.getAttribute("position"),u=0,h=l.length;u<h;u++)c.setXYZ(l[u],i.x,i.y,i.z)}return function(){e=this.geometry,t=this.pointMap;r.projectionMatrix.copy(this.camera.projectionMatrix),n("c",0,0,-1),n("t",0,0,1),n("n1",-1,-1,-1),n("n2",1,-1,-1),n("n3",-1,1,-1),n("n4",1,1,-1),n("f1",-1,-1,1),n("f2",1,-1,1),n("f3",-1,1,1),n("f4",1,1,1),n("u1",.7,1.1,-1),n("u2",-.7,1.1,-1),n("u3",0,2,-1),n("cf1",-1,0,1),n("cf2",1,0,1),n("cf3",0,-1,1),n("cf4",0,1,1),n("cn1",-1,0,-1),n("cn2",1,0,-1),n("cn3",0,-1,-1),n("cn4",0,1,-1),e.getAttribute("position").needsUpdate=!0}}(),Pc.prototype=Object.create(_o.prototype),Pc.prototype.constructor=Pc,Pc.prototype.update=function(){var e=new Jt;return function(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&e.setFromObject(this.object),!e.isEmpty()){var i=e.min,r=e.max,n=this.geometry.attributes.position,o=n.array;o[0]=r.x,o[1]=r.y,o[2]=r.z,o[3]=i.x,o[4]=r.y,o[5]=r.z,o[6]=i.x,o[7]=i.y,o[8]=r.z,o[9]=r.x,o[10]=i.y,o[11]=r.z,o[12]=r.x,o[13]=r.y,o[14]=i.z,o[15]=i.x,o[16]=r.y,o[17]=i.z,o[18]=i.x,o[19]=i.y,o[20]=i.z,o[21]=r.x,o[22]=i.y,o[23]=i.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}(),Pc.prototype.setFromObject=function(e){return this.object=e,this.update(),this},Pc.prototype.copy=function(e){return _o.prototype.copy.call(this,e),this.object=e.object,this},Pc.prototype.clone=function(){return(new this.constructor).copy(this)},Ac.prototype=Object.create(_o.prototype),Ac.prototype.constructor=Ac,Ac.prototype.updateMatrixWorld=function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),wi.prototype.updateMatrixWorld.call(this,e))},Cc.prototype=Object.create(bo.prototype),Cc.prototype.constructor=Cc,Cc.prototype.updateMatrixWorld=function(e){var t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?_:b,this.lookAt(this.plane.normal),wi.prototype.updateMatrixWorld.call(this,e)},Oc.prototype=Object.create(wi.prototype),Oc.prototype.constructor=Oc,Oc.prototype.setDirection=($l=new Ft,function(e){e.y>.99999?this.quaternion.set(0,0,0,1):e.y<-.99999?this.quaternion.set(1,0,0,0):($l.set(e.z,0,-e.x).normalize(),Kl=Math.acos(e.y),this.quaternion.setFromAxisAngle($l,Kl))}),Oc.prototype.setLength=function(e,t,i){void 0===t&&(t=.2*e),void 0===i&&(i=.2*t),this.line.scale.set(1,Math.max(0,e-t),1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()},Oc.prototype.setColor=function(e){this.line.material.color.copy(e),this.cone.material.color.copy(e)},Oc.prototype.copy=function(e){return wi.prototype.copy.call(this,e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this},Oc.prototype.clone=function(){return(new this.constructor).copy(this)},Lc.prototype=Object.create(_o.prototype),Lc.prototype.constructor=Lc;function kc(e){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Ls.call(this,e),this.type="catmullrom",this.closed=!0}function Hc(e){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Ls.call(this,e),this.type="catmullrom"}function jc(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),Ls.call(this,e),this.type="catmullrom"}Ts.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Ts.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Object.assign(qs.prototype,{createPointsGeometry:function(e){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var t=new Ri,i=0,r=e.length;i<r;i++){var n=e[i];t.vertices.push(new Ft(n.x,n.y,n.z||0))}return t}}),Object.assign(Ws.prototype,{fromPoints:function(e){console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),kc.prototype=Object.create(Ls.prototype),Hc.prototype=Object.create(Ls.prototype),jc.prototype=Object.create(Ls.prototype),Object.assign(jc.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),wc.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},bc.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(yl.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),ol.extractUrlBase(e)}}),Object.assign(ll.prototype,{setTexturePath:function(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}),Object.assign(fc.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(Jt.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),mc.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Object.assign(Lt,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),Lt.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),Lt.ceilPowerOfTwo(e)}}),Object.assign(Dt.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(Ht.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){var e;return function(){return void 0===e&&(e=new Ft),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),e.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,i,r,n,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,r,i,n,o)}}),$t.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},jt.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Object.assign(sr.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(lr.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}}),Object.assign(lr,{barycoordFromPoint:function(e,t,i,r,n){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),lr.getBarycoord(e,t,i,r,n)},normal:function(e,t,i,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),lr.getNormal(e,t,i,r)}}),Object.assign(Gs.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new ya(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Ca(this,e)}}),Object.assign(kt.prototype,{fromAttribute:function(e,t,i){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Ft.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,i){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Gt.prototype,{fromAttribute:function(e,t,i){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Ri.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}}),Object.assign(wi.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")}}),Object.defineProperties(wi.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.defineProperties(fo.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(go.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),mo.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(Ts.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),Wn.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(Xs.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(Pi.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")}}),Object.assign(Ui.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addDrawCall:function(e,t,i){void 0!==i&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}}),Object.defineProperties(Ui.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.assign(ba.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties(oc.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(or.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new ci}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}}}),Object.defineProperties(Wa.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(ar.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(oo.prototype,{clearTarget:function(e,t,i,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,i,r)},animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")}}),Object.defineProperties(oo.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(In.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Xt.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.defineProperties(io.prototype,{standing:{set:function(){console.warn("THREE.WebVRManager: .standing has been removed.")}},userHeight:{set:function(){console.warn("THREE.WebVRManager: .userHeight has been removed.")}}}),jl.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this;return(new Cl).load(e,function(e){t.setBuffer(e)}),this},Dl.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Ll.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)};var Fc={merge:function(e,t,i){var r;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),t.isMesh&&(t.matrixAutoUpdate&&t.updateMatrix(),r=t.matrix,t=t.geometry),e.merge(t,r,i)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}};zt.crossOrigin=void 0,zt.loadTexture=function(e,t,i,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var n=new ws;n.setCrossOrigin(this.crossOrigin);var o=n.load(e,i,void 0,r);return t&&(o.mapping=t),o},zt.loadTextureCube=function(e,t,i,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var n=new Es;n.setCrossOrigin(this.crossOrigin);var o=n.load(e,i,void 0,r);return t&&(o.mapping=t),o},zt.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},zt.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};var Dc={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")}};e.WebGLMultisampleRenderTarget=Yt,e.WebGLRenderTargetCube=Qt,e.WebGLRenderTarget=Xt,e.WebGLRenderer=oo,e.ShaderLib=pi,e.UniformsLib=hi,e.UniformsUtils=si,e.ShaderChunk=ti,e.FogExp2=ao,e.Fog=so,e.Scene=lo,e.Sprite=po,e.LOD=fo,e.SkinnedMesh=mo,e.Skeleton=go,e.Bone=vo,e.Mesh=ur,e.LineSegments=_o,e.LineLoop=xo,e.Line=bo,e.Points=wo,e.Group=zn,e.VideoTexture=To,e.DataTexture=Zt,e.DataTexture3D=wr,e.CompressedTexture=So,e.CubeTexture=Er,e.CanvasTexture=Mo,e.DepthTexture=Ro,e.Texture=Wt,e.AnimationLoader=ys,e.CompressedTextureLoader=bs,e.DataTextureLoader=_s,e.CubeTextureLoader=Es,e.TextureLoader=ws,e.ObjectLoader=ll,e.MaterialLoader=nl,e.BufferGeometryLoader=al,e.DefaultLoadingManager=ms,e.LoadingManager=fs,e.ImageLoader=xs,e.ImageBitmapLoader=dl,e.FontLoader=vl,e.FileLoader=vs,e.Loader=yl,e.LoaderUtils=ol,e.Cache=ds,e.AudioLoader=Cl,e.SpotLightShadow=Zs,e.SpotLight=Js,e.PointLight=Ks,e.RectAreaLight=rl,e.HemisphereLight=Ys,e.DirectionalLightShadow=el,e.DirectionalLight=tl,e.AmbientLight=il,e.LightShadow=Qs,e.Light=Xs,e.StereoCamera=Ol,e.PerspectiveCamera=Wn,e.OrthographicCamera=$s,e.CubeCamera=Ll,e.ArrayCamera=Gn,e.Camera=qn,e.AudioListener=Hl,e.PositionalAudio=Fl,e.AudioContext=Al,e.AudioAnalyser=Dl,e.Audio=jl,e.VectorKeyframeTrack=us,e.StringKeyframeTrack=cs,e.QuaternionKeyframeTrack=ls,e.NumberKeyframeTrack=as,e.ColorKeyframeTrack=os,e.BooleanKeyframeTrack=ns,e.PropertyMixer=Bl,e.PropertyBinding=tc,e.KeyframeTrack=rs,e.AnimationUtils=Ka,e.AnimationObjectGroup=ic,e.AnimationMixer=nc,e.AnimationClip=hs,e.Uniform=oc,e.InstancedBufferGeometry=ac,e.BufferGeometry=Ui,e.Geometry=Ri,e.InterleavedBufferAttribute=uo,e.InstancedInterleavedBuffer=sc,e.InterleavedBuffer=co,e.InstancedBufferAttribute=lc,e.Face3=mi,e.Object3D=wi,e.Raycaster=cc,e.Layers=vi,e.EventDispatcher=t,e.Clock=kl,e.QuaternionLinearInterpolant=ss,e.LinearInterpolant=ts,e.DiscreteInterpolant=is,e.CubicInterpolant=es,e.Interpolant=$a,e.Triangle=lr,e.Math=Lt,e.Spherical=pc,e.Cylindrical=dc,e.Plane=$t,e.Frustum=ei,e.Sphere=Kt,e.Ray=sr,e.Matrix4=Ht,e.Matrix3=Dt,e.Box3=Jt,e.Box2=fc,e.Line3=mc,e.Euler=gi,e.Vector4=Gt,e.Vector3=Ft,e.Vector2=kt,e.Quaternion=jt,e.Color=ci,e.ImmediateRenderObject=gc,e.VertexNormalsHelper=vc,e.SpotLightHelper=yc,e.SkeletonHelper=bc,e.PointLightHelper=_c,e.RectAreaLightHelper=xc,e.HemisphereLightHelper=Ec,e.GridHelper=wc,e.PolarGridHelper=Tc,e.FaceNormalsHelper=Sc,e.DirectionalLightHelper=Mc,e.CameraHelper=Rc,e.BoxHelper=Pc,e.Box3Helper=Ac,e.PlaneHelper=Cc,e.ArrowHelper=Oc,e.AxesHelper=Lc,e.Shape=Gs,e.Path=Ws,e.ShapePath=fl,e.Font=ml,e.CurvePath=qs,e.Curve=Ts,e.ImageUtils=zt,e.ShapeUtils=ma,e.WebGLUtils=Vn,e.WireframeGeometry=Po,e.ParametricGeometry=Ao,e.ParametricBufferGeometry=Co,e.TetrahedronGeometry=ko,e.TetrahedronBufferGeometry=Ho,e.OctahedronGeometry=jo,e.OctahedronBufferGeometry=Fo,e.IcosahedronGeometry=Do,e.IcosahedronBufferGeometry=Bo,e.DodecahedronGeometry=Io,e.DodecahedronBufferGeometry=No,e.PolyhedronGeometry=Oo,e.PolyhedronBufferGeometry=Lo,e.TubeGeometry=Uo,e.TubeBufferGeometry=Vo,e.TorusKnotGeometry=zo,e.TorusKnotBufferGeometry=qo,e.TorusGeometry=Wo,e.TorusBufferGeometry=Go,e.TextGeometry=Ea,e.TextBufferGeometry=wa,e.SphereGeometry=Ta,e.SphereBufferGeometry=Sa,e.RingGeometry=Ma,e.RingBufferGeometry=Ra,e.PlaneGeometry=qi,e.PlaneBufferGeometry=Wi,e.LatheGeometry=Pa,e.LatheBufferGeometry=Aa,e.ShapeGeometry=Ca,e.ShapeBufferGeometry=Oa,e.ExtrudeGeometry=ya,e.ExtrudeBufferGeometry=ba,e.EdgesGeometry=ka,e.ConeGeometry=Fa,e.ConeBufferGeometry=Da,e.CylinderGeometry=Ha,e.CylinderBufferGeometry=ja,e.CircleGeometry=Ba,e.CircleBufferGeometry=Ia,e.BoxGeometry=Vi,e.BoxBufferGeometry=zi,e.ShadowMaterial=Ua,e.SpriteMaterial=ho,e.RawShaderMaterial=Va,e.ShaderMaterial=ar,e.PointsMaterial=Eo,e.MeshPhysicalMaterial=qa,e.MeshStandardMaterial=za,e.MeshPhongMaterial=Wa,e.MeshToonMaterial=Ga,e.MeshNormalMaterial=Xa,e.MeshLambertMaterial=Ya,e.MeshDepthMaterial=Dn,e.MeshDistanceMaterial=Bn,e.MeshBasicMaterial=cr,e.MeshMatcapMaterial=Qa,e.LineDashedMaterial=Za,e.LineBasicMaterial=yo,e.Material=or,e.Float64BufferAttribute=Di,e.Float32BufferAttribute=Fi,e.Uint32BufferAttribute=ji,e.Int32BufferAttribute=Hi,e.Uint16BufferAttribute=ki,e.Int16BufferAttribute=Li,e.Uint8ClampedBufferAttribute=Oi,e.Uint8BufferAttribute=Ci,e.Int8BufferAttribute=Ai,e.BufferAttribute=Pi,e.ArcCurve=Ms,e.CatmullRomCurve3=Ls,e.CubicBezierCurve=Fs,e.CubicBezierCurve3=Ds,e.EllipseCurve=Ss,e.LineCurve=Bs,e.LineCurve3=Is,e.QuadraticBezierCurve=Ns,e.QuadraticBezierCurve3=Us,e.SplineCurve=Vs,e.REVISION="101",e.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2},e.CullFaceNone=f,e.CullFaceBack=m,e.CullFaceFront=g,e.CullFaceFrontBack=3,e.FrontFaceDirectionCW=0,e.FrontFaceDirectionCCW=1,e.BasicShadowMap=0,e.PCFShadowMap=v,e.PCFSoftShadowMap=y,e.FrontSide=b,e.BackSide=_,e.DoubleSide=x,e.FlatShading=1,e.SmoothShading=2,e.NoColors=E,e.FaceColors=w,e.VertexColors=T,e.NoBlending=S,e.NormalBlending=M,e.AdditiveBlending=R,e.SubtractiveBlending=P,e.MultiplyBlending=A,e.CustomBlending=C,e.AddEquation=O,e.SubtractEquation=L,e.ReverseSubtractEquation=k,e.MinEquation=H,e.MaxEquation=j,e.ZeroFactor=F,e.OneFactor=D,e.SrcColorFactor=B,e.OneMinusSrcColorFactor=I,e.SrcAlphaFactor=N,e.OneMinusSrcAlphaFactor=U,e.DstAlphaFactor=V,e.OneMinusDstAlphaFactor=z,e.DstColorFactor=q,e.OneMinusDstColorFactor=W,e.SrcAlphaSaturateFactor=G,e.NeverDepth=X,e.AlwaysDepth=Y,e.LessDepth=Q,e.LessEqualDepth=Z,e.EqualDepth=J,e.GreaterEqualDepth=K,e.GreaterDepth=$,e.NotEqualDepth=ee,e.MultiplyOperation=te,e.MixOperation=ie,e.AddOperation=re,e.NoToneMapping=ne,e.LinearToneMapping=oe,e.ReinhardToneMapping=ae,e.Uncharted2ToneMapping=se,e.CineonToneMapping=le,e.ACESFilmicToneMapping=ce,e.UVMapping=300,e.CubeReflectionMapping=ue,e.CubeRefractionMapping=he,e.EquirectangularReflectionMapping=pe,e.EquirectangularRefractionMapping=de,e.SphericalReflectionMapping=fe,e.CubeUVReflectionMapping=me,e.CubeUVRefractionMapping=ge,e.RepeatWrapping=ve,e.ClampToEdgeWrapping=ye,e.MirroredRepeatWrapping=be,e.NearestFilter=_e,e.NearestMipMapNearestFilter=xe,e.NearestMipMapLinearFilter=Ee,e.LinearFilter=we,e.LinearMipMapNearestFilter=Te,e.LinearMipMapLinearFilter=Se,e.UnsignedByteType=Me,e.ByteType=Re,e.ShortType=Pe,e.UnsignedShortType=Ae,e.IntType=Ce,e.UnsignedIntType=Oe,e.FloatType=Le,e.HalfFloatType=ke,e.UnsignedShort4444Type=He,e.UnsignedShort5551Type=je,e.UnsignedShort565Type=Fe,e.UnsignedInt248Type=De,e.AlphaFormat=Be,e.RGBFormat=Ie,e.RGBAFormat=Ne,e.LuminanceFormat=Ue,e.LuminanceAlphaFormat=Ve,e.RGBEFormat=ze,e.DepthFormat=qe,e.DepthStencilFormat=We,e.RedFormat=Ge,e.RGB_S3TC_DXT1_Format=Xe,e.RGBA_S3TC_DXT1_Format=Ye,e.RGBA_S3TC_DXT3_Format=Qe,e.RGBA_S3TC_DXT5_Format=Ze,e.RGB_PVRTC_4BPPV1_Format=Je,e.RGB_PVRTC_2BPPV1_Format=Ke,e.RGBA_PVRTC_4BPPV1_Format=$e,e.RGBA_PVRTC_2BPPV1_Format=et,e.RGB_ETC1_Format=tt,e.RGBA_ASTC_4x4_Format=it,e.RGBA_ASTC_5x4_Format=rt,e.RGBA_ASTC_5x5_Format=nt,e.RGBA_ASTC_6x5_Format=ot,e.RGBA_ASTC_6x6_Format=at,e.RGBA_ASTC_8x5_Format=st,e.RGBA_ASTC_8x6_Format=lt,e.RGBA_ASTC_8x8_Format=ct,e.RGBA_ASTC_10x5_Format=ut,e.RGBA_ASTC_10x6_Format=ht,e.RGBA_ASTC_10x8_Format=pt,e.RGBA_ASTC_10x10_Format=dt,e.RGBA_ASTC_12x10_Format=ft,e.RGBA_ASTC_12x12_Format=mt,e.LoopOnce=2200,e.LoopRepeat=gt,e.LoopPingPong=2202,e.InterpolateDiscrete=2300,e.InterpolateLinear=2301,e.InterpolateSmooth=2302,e.ZeroCurvatureEnding=vt,e.ZeroSlopeEnding=2401,e.WrapAroundEnding=2402,e.TrianglesDrawMode=yt,e.TriangleStripDrawMode=bt,e.TriangleFanDrawMode=_t,e.LinearEncoding=xt,e.sRGBEncoding=Et,e.GammaEncoding=wt,e.RGBEEncoding=Tt,e.LogLuvEncoding=3003,e.RGBM7Encoding=St,e.RGBM16Encoding=Mt,e.RGBDEncoding=Rt,e.BasicDepthPacking=Pt,e.RGBADepthPacking=At,e.TangentSpaceNormalMap=Ct,e.ObjectSpaceNormalMap=Ot,e.CubeGeometry=Vi,e.Face4=function(e,t,i,r,n,o,a){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new mi(e,t,i,n,o,a)},e.LineStrip=0,e.LinePieces=1,e.MeshFaceMaterial=function(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e},e.MultiMaterial=function(e){return void 0===e&&(e=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e},e.PointCloud=function(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new wo(e,t)},e.Particle=function(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new po(e)},e.ParticleSystem=function(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new wo(e,t)},e.PointCloudMaterial=function(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new Eo(e)},e.ParticleBasicMaterial=function(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new Eo(e)},e.ParticleSystemMaterial=function(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new Eo(e)},e.Vertex=function(e,t,i){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new Ft(e,t,i)},e.DynamicBufferAttribute=function(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."),new Pi(e,t).setDynamic(!0)},e.Int8Attribute=function(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new Ai(e,t)},e.Uint8Attribute=function(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new Ci(e,t)},e.Uint8ClampedAttribute=function(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Oi(e,t)},e.Int16Attribute=function(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Li(e,t)},e.Uint16Attribute=function(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new ki(e,t)},e.Int32Attribute=function(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Hi(e,t)},e.Uint32Attribute=function(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new ji(e,t)},e.Float32Attribute=function(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new Fi(e,t)},e.Float64Attribute=function(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Di(e,t)},e.ClosedSplineCurve3=kc,e.SplineCurve3=Hc,e.Spline=jc,e.AxisHelper=function(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new Lc(e)},e.BoundingBoxHelper=function(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new Pc(e,t)},e.EdgesHelper=function(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new _o(new ka(e.geometry),new yo({color:void 0!==t?t:16777215}))},e.WireframeHelper=function(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new _o(new Po(e.geometry),new yo({color:void 0!==t?t:16777215}))},e.XHRLoader=function(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new vs(e)},e.BinaryTextureLoader=function(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new _s(e)},e.GeometryUtils=Fc,e.Projector=function(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}},e.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been removed")},e.JSONLoader=function(){console.error("THREE.JSONLoader has been removed.")},e.SceneUtils=Dc,e.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/js/objects/Lensflare.js")},Object.defineProperty(e,"__esModule",{value:!0})}),THREE.CombinedCamera=function(e,t,i,r,n,o,a){THREE.Camera.call(this),this.fov=i,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2,this.cameraO=new THREE.OrthographicCamera(e/-2,e/2,t/2,t/-2,o,a),this.cameraP=new THREE.PerspectiveCamera(i,e/t,r,n),this.zoom=1,this.view=null,this.matrixTween=null,this.toPerspective()},THREE.CombinedCamera.prototype=Object.create(THREE.Camera.prototype),THREE.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near,this.far=this.cameraP.far,this.cameraP.updateProjectionMatrix(),this.projectionMatrix=this.cameraP.projectionMatrix,this.inPerspectiveMode=!0,this.inOrthographicMode=!1},THREE.CombinedCamera.prototype.toOrthographic=function(){this.fov;var e=this.cameraP.aspect,t=(this.cameraP.near,this.cameraP.far,this.orthoSize.z),i=this.orthoSize.depth,r=i*t*e/2,n=i*t/2;n/=this.zoom,r/=this.zoom,this.cameraO.left=-r,this.cameraO.right=r,this.cameraO.top=n,this.cameraO.bottom=-n,this.cameraO.updateProjectionMatrix(),this.near=this.cameraO.near,this.far=this.cameraO.far,this.projectionMatrix=this.cameraO.projectionMatrix,this.inPerspectiveMode=!1,this.inOrthographicMode=!0},THREE.CombinedCamera.prototype.setSize=function(e,t){this.cameraP.aspect=e/t,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2,this.updateProjectionMatrix()},THREE.CombinedCamera.prototype.setFov=function(e){this.fov=e,this.inPerspectiveMode?(this.cameraP.fov=this.fov,this.toPerspective()):this.toOrthographic()},THREE.CombinedCamera.prototype.setViewOffset=function(e,t,i,r,n,o){this.cameraP.setViewOffset(e,t,i,r,n,o),this.cameraO.setViewOffset(e,t,i,r,n,o)},THREE.CombinedCamera.prototype.clearViewOffset=function(){this.cameraP.clearViewOffset(),this.cameraO.clearViewOffset()},THREE.CombinedCamera.prototype.updateProjectionMatrix=function(){this.inPerspectiveMode?this.toPerspective():(this.toPerspective(),this.toOrthographic())},THREE.CombinedCamera.prototype.setLens=function(e,t,i,r){void 0===t&&(t=24);var n=0;if(i){var o=parseInt("42EF",16);n=parseInt(r||"nahoanehc")&o}else n=2*THREE.Math.radToDeg(Math.atan(t/(2*e)));return this.setFov(n),n},THREE.CombinedCamera.prototype.setZoom=function(e){this.zoom=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},THREE.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0,this.rotation.y=Math.PI,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0,this.rotation.y=-Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0,this.rotation.y=Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CSS3DObject=function(e){THREE.Object3D.call(this),this.element=e,this.element.style.position="absolute",this.addEventListener("removed",function(){null!==this.element.parentNode&&this.element.parentNode.removeChild(this.element)})},THREE.CSS3DObject.prototype=Object.create(THREE.Object3D.prototype),THREE.CSS3DObject.prototype.constructor=THREE.CSS3DObject,THREE.CSS3DSprite=function(e){THREE.CSS3DObject.call(this,e)},THREE.CSS3DSprite.prototype=Object.create(THREE.CSS3DObject.prototype),THREE.CSS3DSprite.prototype.constructor=THREE.CSS3DSprite,THREE.CSS3DRenderer=function(e){var t,i,r,n,o=(e=e||{}).autoFixCamera,a=new THREE.Matrix4,s=new THREE.Matrix4,l=new THREE.Matrix4,c={camera:{fov:0,style:""},objects:{}},u=document.createElement("div");u.style.overflow="hidden",this.domElement=u;var h=document.createElement("div");h.style.WebkitTransformStyle="preserve-3d",h.style.MozTransformStyle="preserve-3d",h.style.transformStyle="preserve-3d",u.appendChild(h);var p=/Trident/i.test(navigator.userAgent);function d(e){return Math.abs(e)<1e-10?0:e}function f(e){var t=e.elements;return"matrix3d("+d(t[0])+","+d(-t[1])+","+d(t[2])+","+d(t[3])+","+d(t[4])+","+d(-t[5])+","+d(t[6])+","+d(t[7])+","+d(t[8])+","+d(-t[9])+","+d(t[10])+","+d(t[11])+","+d(t[12])+","+d(-t[13])+","+d(t[14])+","+d(t[15])+")"}function m(e,t){var i=e.elements,o="matrix3d("+d(i[0])+","+d(i[1])+","+d(i[2])+","+d(i[3])+","+d(-i[4])+","+d(-i[5])+","+d(-i[6])+","+d(-i[7])+","+d(i[8])+","+d(i[9])+","+d(i[10])+","+d(i[11])+","+d(i[12])+","+d(i[13])+","+d(i[14])+","+d(i[15])+")";return p?"translate(-50%,-50%)translate("+r+"px,"+n+"px)"+t+o:"translate(-50%,-50%)"+o}function g(e,t){s.copy(e),s.premultiply(t.matrixWorldInverse);var i=(e=s).elements,o="matrix3d("+d(i[0])+","+d(i[1])+","+d(i[2])+","+d(i[3])+","+d(-i[4])+","+d(-i[5])+","+d(-i[6])+","+d(-i[7])+","+d(i[8])+","+d(i[9])+","+d(i[10])+","+d(i[11])+","+d(i[12])+","+d(i[13])+","+d(i[14])+","+d(i[15])+")";return p?"translate(-50%,-50%)translate("+r+"px,"+n+"px)"+cameraCSSMatrix+o:"translate(-50%,-50%)"+o}this.setClearColor=function(){},this.getSize=function(){return{width:t,height:i}},this.setSize=function(e,o){r=(t=e)/2,n=(i=o)/2,u.style.width=e+"px",u.style.height=o+"px",h.style.width=e+"px",h.style.height=o+"px"};var v,y,b=(v=new THREE.Vector3,y=new THREE.Vector3,function(e,t){return v.setFromMatrixPosition(e.matrixWorld),y.setFromMatrixPosition(t.matrixWorld),v.distanceToSquared(y)});this.render=function(e,t){var s;s=t.isOrthoLerping||t.isOrthographicCamera?.5/Math.tan(THREE.Math.degToRad(.5*t.getEffectiveFOV()))*i:t.projectionMatrix.elements[5]*n,c.camera.fov!==s&&(u.style.WebkitPerspective=s+"px",u.style.MozPerspective=s+"px",u.style.perspective=s+"px",c.camera.fov=s),e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld();var d="translateZ("+s+"px)";!t.isPerspectiveLerping&&t.isOrthographicCamera&&(d+="scale("+t.zoom+")");var v=(d+=f(o?l:t.matrixWorldInverse))+"translate("+r+"px,"+n+"px)";c.camera.style===v||p||(h.style.WebkitTransform=v,h.style.MozTransform=v,h.style.transform=v,c.camera.style=v),function e(t,i,r){if(t instanceof THREE.CSS3DObject){var n;t instanceof THREE.CSS3DSprite?(a.copy(i.matrixWorldInverse),a.transpose(),a.copyPosition(t.matrixWorld),a.scale(t.scale),a.elements[3]=0,a.elements[7]=0,a.elements[11]=0,a.elements[15]=1,n=o?g(a,i):m(a,r)):n=o?g(t.matrixWorld,i):m(t.matrixWorld,r);var s=t.element,l=c.objects[t.id]&&c.objects[t.id].style;void 0!==l&&l===n||(s.style.WebkitTransform=n,s.style.MozTransform=n,s.style.transform=n,c.objects[t.id]={style:n},p&&(c.objects[t.id].distanceToCameraSquared=b(i,t))),s.parentNode!==h&&h.appendChild(s)}for(var u=0,d=t.children.length;u<d;u++)e(t.children[u],i,r)}(e,t,d),p&&function(e){var t=Object.keys(c.objects).sort(function(e,t){return c.objects[e].distanceToCameraSquared-c.objects[t].distanceToCameraSquared}),i=t.length;e.traverse(function(e){var r=t.indexOf(e.id+"");-1!==r&&(e.element.style.zIndex=i-r)})}(e)}},THREE.DeviceOrientationControls=function(e){var t=this;this.object=e,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation={},this.screenOrientation=0,this.alphaOffset=0;var i,r,n,o,a=function(e){t.deviceOrientation=e},s=function(){t.screenOrientation=window.orientation||0},l=(i=new THREE.Vector3(0,0,1),r=new THREE.Euler,n=new THREE.Quaternion,o=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),function(e,t,a,s,l){r.set(a,t,-s,"YXZ"),e.setFromEuler(r),e.multiply(o),e.multiply(n.setFromAxisAngle(i,-l))});this.connect=function(){s(),window.addEventListener("orientationchange",s,!1),window.addEventListener("deviceorientation",a,!1),t.enabled=!0},this.disconnect=function(){window.removeEventListener("orientationchange",s,!1),window.removeEventListener("deviceorientation",a,!1),t.enabled=!1},this.update=function(){if(!1!==t.enabled){var e=t.deviceOrientation;if(e){var i=e.alpha?THREE.Math.degToRad(e.alpha)+t.alphaOffset:0,r=e.beta?THREE.Math.degToRad(e.beta):0,n=e.gamma?THREE.Math.degToRad(e.gamma):0,o=t.screenOrientation?THREE.Math.degToRad(t.screenOrientation):0;l(t.object.quaternion,i,r,n,o)}}},this.dispose=function(){t.disconnect()},this.connect()},THREE.EarthOrbitControls=function(e,t){var i;this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this._leftInteractive=!0,this.minDistance=500,this.maxDistance=11079114.2,this.minZoom=0,this.maxZoom=1/0,this.maxPitchAngle=82,this.minPolarAngle=0,this.maxPolarAngle=Math.PI/2,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.88,this.dampingZoomFactor=.5,this.enableZoom=!0,this.zoomSpeed=1,this.zoomFactor=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.mousePanSpeed=1,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.standardRadius=10216133.731679259,this.targetMaxOffset=6e7,this.panStander=this.maxDistance-6378e3,this.isDispatchEvent=!0,this.getPolarAngle=function(){return u.phi},this.getAzimuthalAngle=function(){return u.theta},this.getRotationSpherePhi=function(){return h.phi},this.getSphericalRadius=function(){return u.radius},this.saveState=function(){r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=function(){r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(o),r.update(),c=l.NONE},this.goHome=function(){R=!0,r.object.up.set(0,1,0),r.object.position.set(4890109.86328125,9295980.46875,13943610.3515625),u.radius,h.phi=-.01,h.theta=Math.PI/2,h.radius=u.radius-6378e3,r.update()},this.setState=function(e){var t=r._getIntersectPoint();r.target.copy(t);var i=r.target,n=r.object.position,o=(new THREE.Vector3).subVectors(i,n),a=(new THREE.Vector3).crossVectors(n,o),s=(new THREE.Vector3).crossVectors(o,a);s=s.normalize(),r.object.up.copy(s),r.object.lookAt(i.x,i.y,i.z)},this.correctUp=function(e){var t=e.time||3e3,i=e.callback,n=r.target,o=r.object.position,a=new THREE.Vector3;a.copy(r.object.up),a.normalize();var s=new THREE.Vector3;s.copy(o),s.normalize();var l=null;requestAnimationFrame(function e(o){l||(l=o);var c=o-l,u=a.lerp(s,c/t);r.object.up=u,r.object.lookAt(n),c/t<1?requestAnimationFrame(e):(i&&i(),console.log("end-correct"))})},this._getIntersectPoint=function(){var e=new THREE.Vector3,t=[];if(this.object.getWorldDirection(e),e.normalize(),L.set(this.object.position,e),O.set(this.object.position,e),t3djs.buffer.nodeBuffer.get("tiles-root")&&(t=L.intersectObjects(t3djs.buffer.nodeBuffer.get("tiles-root").children,!0)),t.length>0)return t[0].point;var i=new THREE.Vector3;return O.intersectSphere(k,i),i},this._getIntersectPointByMouse=function(e,t){var i=[],r=new THREE.Vector3;this.object.getWorldDirection(r),r.normalize(),O.set(this.object.position,r),L.setFromCamera(new THREE.Vector2(e,t),this.object),t3djs.buffer.nodeBuffer.get("tiles-root")&&(i=L.intersectObjects(t3djs.buffer.nodeBuffer.get("tiles-root").children,!0));var n=new THREE.Vector3;return O.intersectSphere(k,n),i.length>0?i[0].point:this._getIntersectPoint()},this._getIntersectQuaternion=function(e,t){(new THREE.Vector3).copy(e);var i=new THREE.Vector3;i.copy(e),i.normalize();var r=new THREE.Quaternion;r.setFromUnitVectors(new THREE.Vector3(0,1,0),i);var n=new THREE.Quaternion;return n.setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI/2+t),r.multiply(n),r.normalize(),r},this._correctCube=function(){var e=this._getIntersectPoint();F.position.copy(e),d.setFromVector3(e),d.radius=6378e3;var t=this._getIntersectQuaternion(e,d.theta);F.rotation.set(0,0,0),F.applyQuaternion(t),F.updateMatrixWorld(!0)},this._correctSphericalRotation=function(e){var t=new THREE.Vector3;if(t.copy(e),F.worldToLocal(t),h.setFromVector3(t),0!=r.target.length()){var i=r.object.position.distanceTo(this._getIntersectPoint());h.radius=i}h.phi=-h.phi,h.theta=Math.PI+h.theta,!1},this._getAngle=function(){if(0!=r.target.length()){var e=new THREE.Vector3;e.copy(r.target),e.normalize();var t=new THREE.Vector3(0,6378e3,0);t.sub(this.object.position),t.normalize();var i=new THREE.Vector3;this.object.getWorldDirection(i),i.projectOnPlane(e),t.projectOnPlane(e);var n=t.angleTo(i);return i.cross(t),i.sub(e),i.length()<=1&&(n*=-1),n}},this.update=(i=new THREE.Vector3,function(){var e=r.object.position;if(i.copy(e),u.setFromVector3(i),d.setFromVector3(r.target),d.radius=6378e3,!D&&r.app&&(r.app.scene.add(F),F.visible=!1,D=!0,!0),R){if(r.dispatchEvent(o),r.enableDamping||(R=!1),I.multiply(B),e.applyQuaternion(I),r.object.updateMatrixWorld(!0),0!=r.target.length())(n=new THREE.Vector3).copy(e),n.normalize(),r.object.up.copy(n),r.target.applyQuaternion(I);else{var t=this._getIntersectPoint();t.y+=100,r.target.copy(t)}r.object.lookAt(r.target)}else if(P){r.dispatchEvent(o),P=!1;var n,a=this._getIntersectPoint();(n=new THREE.Vector3).copy(F.position),n.normalize();var s=new THREE.Vector3;s.setFromSpherical(h),s.applyMatrix4(F.matrixWorld),r.object.up.copy(n),r.object.position.copy(s),r.target.copy(a),r.object.lookAt(r.target)}else if(A||C){r.dispatchEvent(o);var l=r.object.position.distanceTo(this._getIntersectPoint());if(l>r.maxDistance&&C||l<r.minDistance&&A)h.radius=l,f=1;else{var c;c=A?this._getIntersectPointByMouse(N.x,N.y):this._getIntersectPointByMouse(0,0);var g=new THREE.Vector3;g.copy(r.object.position),g.sub(c),g.normalize();var v=u.radius*f-u.radius;h.radius+=v;var y=new THREE.Vector3;y.setFromSpherical(h),g.multiplyScalar(v),r.object.position.add(g),this._correctCube(),y.applyMatrix4(F.matrixWorld),r.object.position.copy(y),r.object.up.copy(r.object.position),r.target.copy(F.position),r.object.lookAt(r.target)}r.enableDamping||(A=!1,C=!1)}r.object.lookAt(r.target),this._correctCube(),this._correctSphericalRotation(e);var b=r.object.position.distanceTo(this._getIntersectPoint());return r.rotateSpeed=b/3e7,r.zoomSpeed=h.radius/4e6*this.zoomFactor,r.mousePanSpeed=1,!0===r.enableDamping?R?(p.x*=1-r.dampingFactor,p.y*=1-r.dampingFactor,V(p.x),z(p.y),(P||A||C||p.x>-1e-10&&p.x<1e-10||p.y>-1e-10&&p.y<1e-10)&&(R=!1,p.set(0,0))):A?(f+=(1-f)*r.dampingZoomFactor)>.99999999&&(f=1,A=!1):C&&(f-=(f-1)*r.dampingZoomFactor)<1.0000001&&(f=1,C=!1):(p.set(0,0),f=1,R=!1,P=!1),m.set(0,0,0),!1}),this.dispose=function(){r._leftInteractive?(r.domElement.removeEventListener("contextmenu",oe,!1),r.domElement.removeEventListener("mousedown",J,!1)):(r.domElement.removeEventListener("mousedown",oe,!1),r.domElement.removeEventListener("contextmenu",J,!1)),r.domElement.removeEventListener("wheel",ee,!1),r.domElement.removeEventListener("touchstart",ie,!1),r.domElement.removeEventListener("touchend",ne,!1),r.domElement.removeEventListener("touchmove",re,!1),document.removeEventListener("mousemove",K,!1),document.removeEventListener("mouseup",$,!1),window.removeEventListener("keydown",te,!1)};var r=this,n={type:"wheel"},o={type:"change"},a={type:"start"},s={type:"end"},l={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},c=l.NONE,u=new THREE.Spherical,h=new THREE.Spherical;h.theta=Math.PI/2,h.phi=-.01,h.radius=this.panStander;var p=new THREE.Vector2,d=(new THREE.Spherical,new THREE.Spherical);d.radius=6378e3;new THREE.Spherical,new THREE.Cylindrical,new THREE.Cylindrical;var f=1,m=new THREE.Vector3,g=new THREE.Vector2,v=new THREE.Vector2,y=new THREE.Vector2,b=new THREE.Vector2,_=new THREE.Vector2,x=new THREE.Vector2,E=new THREE.Vector2,w=new THREE.Vector2,T=new THREE.Vector2,S=new THREE.Vector2,M=new THREE.Vector2,R=(new THREE.Vector3,new THREE.Vector3,!1),P=!1,A=!1,C=!1,O=new THREE.Ray,L=new THREE.Raycaster,k=new THREE.Sphere(new THREE.Vector3(0,0,0),6378e3),H=new THREE.BoxGeometry(1e3,1e3,1e3),j=new THREE.MeshBasicMaterial({color:65280}),F=new THREE.Mesh(H,j),D=!1,B=new THREE.Quaternion,I=new THREE.Quaternion,N={};function U(){return Math.pow(.95,r.zoomSpeed)}function V(e){var t=new THREE.Vector3(0,6378e4,0);t.unproject(r.object),t.normalize(),p.x=e,e*=1-Math.sin(h.phi),I.setFromAxisAngle(t,-e)}function z(e){var t=new THREE.Vector3(6378e3,0,0);t.unproject(r.object),t.normalize(),p.y=e,B.setFromAxisAngle(t,-e)}var q=function(e){h.phi>-.001||(h.theta-=e,h.theta>2*Math.PI&&(h.theta=h.theta-2*Math.PI),h.theta<0&&(h.theta=2*Math.PI+h.theta))},W=function(e){P=!0,h.phi+=e,h.phi>=-.01&&(h.phi=-.01),h.phi<-r.maxPitchAngle*Math.PI/180&&(h.phi=-r.maxPitchAngle*Math.PI/180)},G=function(){new THREE.Vector3;return function(e,t){var i=r.domElement===document?r.domElement.body:r.domElement;r.object.isPerspectiveCamera?(q(2*Math.PI*e/i.clientWidth*r.mousePanSpeed),W(2*Math.PI*t/i.clientHeight*r.mousePanSpeed)):r.object.isOrthographicCamera?(q(e*(r.object.right-r.object.left)/r.object.zoom/i.clientWidth,r.object.matrix),W(t*(r.object.top-r.object.bottom)/r.object.zoom/i.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)}}();function X(e){C=!0,r.object.isPerspectiveCamera?f/=e:r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom*e)),r.object.updateProjectionMatrix(),!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function Y(e){A=!0,r.object.isPerspectiveCamera?f*=e:r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/e)),r.object.updateProjectionMatrix(),!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function Q(e){b.set(e.touches[0].pageX,e.touches[0].pageY)}function Z(e){_.set(e.touches[0].pageX,e.touches[0].pageY),x.subVectors(_,b),G(x.x,x.y),b.copy(_),r.update()}function J(e){if(!1!==r.enabled){switch(e.preventDefault(),e.button){case r.mouseButtons.ORBIT:if(!1===r.enableRotate)return;!function(e){g.set(e.clientX,e.clientY)}(e),c=l.ROTATE;break;case r.mouseButtons.ZOOM:if(!1===r.enableZoom)return;!function(e){E.set(e.clientX,e.clientY)}(e),c=l.DOLLY;break;case r.mouseButtons.PAN:if(!1===r.enablePan)return;!function(e){b.set(e.clientX,e.clientY)}(e),c=l.PAN}c!==l.NONE&&(document.addEventListener("mousemove",K,!1),document.addEventListener("mouseup",$,!1),r.dispatchEvent(a))}}function K(e){if(!1!==r.enabled)switch(e.preventDefault(),c){case l.ROTATE:if(!1===r.enableRotate)return;!function(e){R=!0,v.set(e.clientX,e.clientY),y.subVectors(v,g);var t=r.domElement===document?r.domElement.body:r.domElement;V(2*Math.PI*y.x/t.clientWidth*r.rotateSpeed),z(2*Math.PI*y.y/t.clientHeight*r.rotateSpeed),g.copy(v),r.update()}(e);break;case l.DOLLY:if(!1===r.enableZoom)return;!function(e){w.set(e.clientX,e.clientY),T.subVectors(w,E),T.y>0?X(U()):T.y<0&&Y(U()),E.copy(w),r.update()}(e);break;case l.PAN:if(!1===r.enablePan)return;!function(e){_.set(e.clientX,e.clientY),x.subVectors(_,b),G(x.x,x.y),b.copy(_),r.update()}(e)}}function $(e){if(!1===r.enabled)return document.removeEventListener("mousemove",K,!1),void document.removeEventListener("mouseup",$,!1);document.removeEventListener("mousemove",K,!1),document.removeEventListener("mouseup",$,!1),r.dispatchEvent(s),c=l.NONE}function ee(e){!1===r.enabled||!1===r.enableZoom||c!==l.NONE&&c!==l.ROTATE||(e.preventDefault(),e.stopPropagation(),function(e){N.x=e.clientX/window.innerWidth*2-1,N.y=-e.clientY/window.innerHeight*2+1,e.deltaY<0?(Y(U()),r.dispatchEvent(n)):e.deltaY>0&&(X(U()),r.dispatchEvent(n)),r.update()}(e),r.dispatchEvent(a),r.dispatchEvent(s))}function te(e){!1!==r.enabled&&!1!==r.enableKeys&&!1!==r.enablePan&&function(e){switch(e.keyCode){case r.keys.UP:G(0,r.keyPanSpeed),r.update();break;case r.keys.BOTTOM:G(0,-r.keyPanSpeed),r.update();break;case r.keys.LEFT:G(r.keyPanSpeed,0),r.update();break;case r.keys.RIGHT:G(-r.keyPanSpeed,0),r.update()}}(e)}function ie(e){if(!1!==r.enabled){switch(e.touches.length){case 1:if(!1===r.enableRotate)return;!function(e){g.set(e.touches[0].pageX,e.touches[0].pageY)}(e),c=l.TOUCH_ROTATE;break;case 3:if(!1===r.enableZoom)return;Q(e),c=l.TOUCH_PAN;break;case 2:if(S.set(e.touches[0].pageX,e.touches[0].pageY),M.set(e.touches[1].pageX,e.touches[1].pageY),!1===r.enablePan)return;Q(e),function(e){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+i*i);E.set(0,r)}(e),c=l.TOUCH_PAN;break;default:c=l.NONE}c!==l.NONE&&r.dispatchEvent(a)}}function re(e){if(!1!==r.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===r.enableRotate)return;if(c!==l.TOUCH_ROTATE)return;!function(e){R=!0,v.set(e.touches[0].pageX,e.touches[0].pageY),y.subVectors(v,g);var t=r.domElement===document?r.domElement.body:r.domElement;V(2*Math.PI*y.x/t.clientWidth*r.rotateSpeed),z(2*Math.PI*y.y/t.clientHeight*r.rotateSpeed),g.copy(v),r.update()}(e);break;case 3:if(!1===r.enableZoom)return;if(c!==l.TOUCH_PAN)return;Z(e);break;case 2:var t=new THREE.Vector2(e.touches[0].pageX,e.touches[0].pageY),i=new THREE.Vector2(e.touches[1].pageX,e.touches[1].pageY),n=t.sub(S).normalize(),o=i.sub(M).normalize();if(n.dot(o)>0){if(c=l.TOUCH_PAN,!1===r.enablePan)return;Z(e)}else{if(c=l.TOUCH_DOLLY,!1===r.enableZoom)return;!function(e){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+i*i);w.set(0,n),T.subVectors(w,E),T.y>0?Y(U()):T.y<0&&X(U()),E.copy(w),r.update()}(e)}break;default:c=l.NONE}}function ne(e){!1!==r.enabled&&(r.dispatchEvent(s),c=l.NONE)}function oe(e){!1!==r.enabled&&e.preventDefault()}r.rotate=function(e,t){switch(t=(t=t||1e3)/180*Math.PI,e){case"up":this.pan(0,t);break;case"down":this.pan(0,-t);break;case"left":this.pan(t,0);break;case"right":this.pan(-t,0)}},r.move=function(e,t){e=e/180*Math.PI,e*=this.rotateSpeed,t=t/180*Math.PI,t*=this.rotateSpeed,I.set(0,0,0,1),B.set(0,0,0,1),R=!0,V(e),z(t)},r.zoom=function(e,t){switch(t=t||.95,t=Math.pow(t,r.zoomSpeed),e){case"in":Y(t);break;case"out":X(t)}},r.earthRotate=function(e,t){switch(t=(t=t||10)/180*Math.PI,t*=this.rotateSpeed,I.set(0,0,0,1),B.set(0,0,0,1),R=!0,e){case"right":V(-t);break;case"left":V(t);break;case"up":z(t);break;case"down":z(-t)}},r._leftInteractive?(r.domElement.addEventListener("contextmenu",oe,!1),r.domElement.addEventListener("mousedown",J,!1)):(r.domElement.addEventListener("mousedown",oe,!1),r.domElement.addEventListener("contextmenu",J,!1)),r.domElement.addEventListener("wheel",ee,!1),r.domElement.addEventListener("touchstart",ie,!1),r.domElement.addEventListener("touchend",ne,!1),r.domElement.addEventListener("touchmove",re,!1),window.addEventListener("keydown",te,!1),r.setLeftInteractive=function(e){r.mouseButtons=e?{ORBIT:0,ZOOM:1,PAN:2}:{ORBIT:2,ZOOM:1,PAN:0},r._leftInteractive=e},this.update(),r.pan=G,r.panDelta=x},THREE.EarthOrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.EarthOrbitControls.prototype.constructor=THREE.EarthOrbitControls,Object.defineProperties(THREE.EarthOrbitControls.prototype,{leftInteractive:{get:function(){return this._leftInteractive},set:function(e){this.setLeftInteractive(e)}},center:{get:function(){return console.warn("THREE.EarthOrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.EarthOrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.EarthOrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.EarthOrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.EarthOrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.EarthOrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.EarthOrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.EarthOrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.EarthOrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.EarthOrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("THREE.EarthOrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.EarthOrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("THREE.EarthOrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}}),THREE.EarthOrbitControls.prototype.setLookAt=function(e){this.object.lookAt(new THREE.Vector3(e[0],e[1],e[2]))},THREE.FirstPersonControls=function(e,t){function i(e){e.preventDefault()}this.object=e,this.target=new THREE.Vector3(0,0,0),this.domElement=void 0!==t?t:document,this.enabled=!0,this.movementSpeed=5,this.lookSpeed=.1,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!0,this.verticalMin=1,this.verticalMax=2,this.autoSpeedFactor=0,this.mouseX=0,this.mouseY=0,this.lat=0,this.lon=0,this.phi=0,this.theta=0,this.moveJump=!1,this.mouseRightDown=!1,this.surfaceFloor=null,this.birdsEye=1.8,this.timeLeft=6,this.raycaster=new THREE.Raycaster,this.originPos=[-2,18.7,25],this.dropDistance=-123,this.raycaster.ray.direction.set(0,-1,0),this.initEnabled=!0,this.accelerate=2.5,this.peopleHeight=1.7,this.smooth=.1,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.mouseDragOn=!1,this.viewHalfX=0,this.viewHalfY=0,this.domElement!==document&&this.domElement.setAttribute("tabindex",-1),this.handleResize=function(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)},this.onMouseDown=function(e){if(this.domElement!==document&&this.domElement.focus(),e.preventDefault(),e.stopPropagation(),this.activeLook)switch(e.button){case 2:this.mouseRightDown=!0}this.mouseDragOn=!0},this.onMouseUp=function(e){if(e.preventDefault(),e.stopPropagation(),this.activeLook)switch(e.button){case 2:this.mouseRightDown=!1}this.mouseDragOn=!1},this.onMouseMove=function(e){this.domElement===document?(this.mouseX=e.pageX-this.viewHalfX,this.mouseY=e.pageY-this.viewHalfY):(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY)},this.onKeyDown=function(e){switch(e.keyCode){case 16:this.speedUp=!0;break;case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0}},this.onKeyUp=function(e){switch(e.keyCode){case 16:this.speedUp=!1;break;case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}},this.resetToOrigin=function(){this.initEnabled=!0},this.update=function(e){if(!1!==this.enabled&&null!=this.surfaceFloor){if(this.heightSpeed){var t=THREE.Math.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=e*(t*this.heightCoef)}else this.autoSpeedFactor=0;if(this.mouseRightDown||this.initEnabled){this.initEnabled&&(this.object.position.set(this.originPos[0],this.originPos[1],this.originPos[2]),this.initEnabled=!1);var i=e*this.lookSpeed;this.activeLook||(i=0);var r=1;this.constrainVertical&&(r=Math.PI/(this.verticalMax-this.verticalMin)),this.lon+=this.mouseX*i,this.lookVertical&&(this.lat-=this.mouseY*i*r),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=THREE.Math.degToRad(90-this.lat),this.theta=THREE.Math.degToRad(this.lon),this.constrainVertical&&(this.phi=THREE.Math.mapLinear(this.phi,0,Math.PI,this.verticalMin,this.verticalMax))}this.object.position.y<this.dropDistance&&this.object.position.set(this.originPos[0],this.originPos[1],this.originPos[2]);var n=1;n=this.speedUp?e*this.movementSpeed*this.accelerate:e*this.movementSpeed,(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(n+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(n),this.moveLeft&&this.object.translateX(-n),this.moveRight&&this.object.translateX(n),this.raycaster.ray.origin.copy(this.object.position),this.raycaster.ray.origin.y+=this.birdsEye;var o=this.raycaster.intersectObject(this.surfaceFloor,!0);if(o.length<1)(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(n+this.autoSpeedFactor+this.smooth),this.moveBackward&&this.object.translateZ(-n-this.smooth),this.moveLeft&&this.object.translateX(n+this.smooth),this.moveRight&&this.object.translateX(-n-this.smooth);else{var a=o[0].distance-this.birdsEye;this.object.position.y=this.peopleHeight+this.object.position.y-a}var s=this.target,l=this.object.position;s.x=l.x+100*Math.sin(this.phi)*Math.cos(this.theta),s.y=l.y+100*Math.cos(this.phi),s.z=l.z+100*Math.sin(this.phi)*Math.sin(this.theta),this.object.lookAt(s)}},this.dispose=function(){this.domElement.removeEventListener("contextmenu",i,!1),this.domElement.removeEventListener("mousedown",n,!1),this.domElement.removeEventListener("mousemove",r,!1),this.domElement.removeEventListener("mouseup",o,!1),window.removeEventListener("keydown",a,!1),window.removeEventListener("keyup",s,!1)};var r=l(this,this.onMouseMove),n=l(this,this.onMouseDown),o=l(this,this.onMouseUp),a=l(this,this.onKeyDown),s=l(this,this.onKeyUp);function l(e,t){return function(){t.apply(e,arguments)}}this.domElement.addEventListener("contextmenu",i,!1),this.domElement.addEventListener("mousemove",r,!1),this.domElement.addEventListener("mousedown",n,!1),this.domElement.addEventListener("mouseup",o,!1),window.addEventListener("keydown",a,!1),window.addEventListener("keyup",s,!1),this.handleResize()},THREE.FreeControls=function(e){this.object=e,this.object.rotation.setRotationOrder("YXZ"),this.movementSpeed=.25,this.rotateSpeed=.25,this.enableMovementDamping=!0,this.movementDampingFactor=.25,this.enableRotateDamping=!0,this.rotateDampingFactor=.25,this.enableFly=!0,this.enableKeyRotate=!1,this.getMoveDirection=function(e){e=e||new THREE.Vector3;var r=t.set(1,0,0).applyQuaternion(this.object.quaternion);return this.enableFly?(t.set(1,0,0).applyQuaternion(this.object.quaternion).multiplyScalar(u.x),e.add(t),t.set(0,1,0).applyQuaternion(this.object.quaternion).multiplyScalar(u.y),e.add(t),t.set(0,0,1).applyQuaternion(this.object.quaternion).multiplyScalar(u.z),e.add(t)):(i.copy(r).multiplyScalar(u.x),e.add(i),i.copy(r).cross(this.object.up).normalize().multiplyScalar(u.z),e.add(i)),e},this.update=function(e){var d=(e=e||.0166)*this.movementSpeed/.0166*(1===h.run?2:1);u.add(l),c.add(s);var f=t.set(1,0,0).applyQuaternion(this.object.quaternion);return this.enableFly?(t.set(1,0,0).applyQuaternion(this.object.quaternion).multiplyScalar(u.x*d),this.object.position.add(t),t.set(0,1,0).applyQuaternion(this.object.quaternion).multiplyScalar(u.y*d),this.object.position.add(t),t.set(0,0,1).applyQuaternion(this.object.quaternion).multiplyScalar(u.z*d),this.object.position.add(t)):(i.copy(f).multiplyScalar(u.x*d),this.object.position.add(i),i.copy(f).cross(this.object.up).normalize().multiplyScalar(u.z*d),this.object.position.add(i)),this.object.up.equals(p)?(this.object.rotation.x+=e*c.x/.0166,this.object.rotation.y+=e*c.y/.0166,this.object.rotation.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,this.object.rotation.x))):(r.setFromAxisAngle(this.object.up,e*c.y/.0166),this.object.quaternion.premultiply(r),r.setFromAxisAngle(f,e*c.x/.0166),this.object.quaternion.premultiply(r)),this.enableMovementDamping?u.multiplyScalar(1-this.movementDampingFactor):u.set(0,0,0),this.enableRotateDamping?c.multiplyScalar(1-this.rotateDampingFactor):c.set(0,0),this.enableKeyRotate||s.set(0,0),(n.distanceToSquared(this.object.position)>a||8*(1-o.dot(this.object.quaternion))>a)&&(n.copy(this.object.position),o.copy(this.object.quaternion),!0)};var t=new THREE.Vector3,i=new THREE.Vector3,r=new THREE.Quaternion,n=new THREE.Vector3,o=new THREE.Quaternion,a=1e-6,s=new THREE.Vector2,l=new THREE.Vector3,c=new THREE.Vector2,u=new THREE.Vector3,h={up:0,down:0,left:0,right:0,forward:0,back:0,run:0},p=(new THREE.Vector3(1,0,0),new THREE.Vector3(0,1,0)),d=this;this.updateMovementVector=function(){d.enableKeyRotate?s.y=-2*Math.PI*.005*(-h.left+h.right)*d.rotateSpeed:l.x=-h.left+h.right,l.y=-h.down+h.up,l.z=-h.forward+h.back},this.rotateDelta=s,this.moveDelta=l,this.moveState=h},THREE.FreeMouseControls=function(e,t){THREE.FreeControls.call(this,e),this.domElement=void 0!==t?t:document,t&&this.domElement.setAttribute("tabindex",-1);var i=new THREE.Vector2,r=new THREE.Vector2,n=this.rotateDelta,o=(this.moveDelta,0),a=this.moveState,s=this;function l(){var e=s.domElement===document?s.domElement.body:s.domElement,t=n.x,i=n.y;n.x=2*Math.PI*i/e.clientHeight,n.y=2*Math.PI*t/e.clientWidth}var c=this.updateMovementVector;function u(e){i.set(e.clientX,e.clientY),o=1}function h(e){0!=o&&(s.enableKeyRotate||(r.set(e.clientX,e.clientY),n.subVectors(r,i).multiplyScalar(-s.rotateSpeed),l(),i.copy(r)))}function p(e){o=0,n.set(0,0)}function d(e){switch(e.keyCode){case 87:a.forward=1;break;case 83:a.back=1;break;case 65:a.left=1;break;case 68:a.right=1;break;case 82:a.up=1;break;case 70:a.down=1;break;case 69:a.up=1;break;case 81:a.down=1;break;case 16:a.run=1}c()}function f(e){switch(e.keyCode){case 87:a.forward=0;break;case 83:a.back=0;break;case 65:a.left=0;break;case 68:a.right=0;break;case 82:a.up=0;break;case 70:a.down=0;break;case 69:a.up=0;break;case 81:a.down=0;break;case 16:a.run=0}c()}this.domElement.addEventListener("mousemove",h,!1),this.domElement.addEventListener("mousedown",u,!1),this.domElement.addEventListener("mouseup",p,!1),window.addEventListener("keydown",d,!1),window.addEventListener("keyup",f,!1),c(),l(),this.dispose=function(){this.domElement.removeEventListener("mousemove",h,!1),this.domElement.removeEventListener("mousedown",u,!1),this.domElement.removeEventListener("mouseup",p,!1),window.removeEventListener("keydown",d,!1),window.removeEventListener("keyup",f,!1)}},THREE.OBJLoader=function(){var e=/^[og]\s*(.+)?/,t=/^mtllib /,i=/^usemtl /;function r(){var e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);var i=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(e,t){var i=this._finalize(!1);i&&(i.inherited||i.groupCount<=0)&&this.materials.splice(i.index,1);var r={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==i?i.smooth:this.smooth,groupStart:void 0!==i?i.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){var t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(r),r},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(var i=this.materials.length-1;i>=0;i--)this.materials[i].groupCount<=0&&this.materials.splice(i,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},i&&i.name&&"function"==typeof i.clone){var r=i.clone(0);r.inherited=!0,this.object.materials.push(r)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){var i=parseInt(e,10);return 3*(i>=0?i-1:i+t/3)},parseNormalIndex:function(e,t){var i=parseInt(e,10);return 3*(i>=0?i-1:i+t/3)},parseUVIndex:function(e,t){var i=parseInt(e,10);return 2*(i>=0?i-1:i+t/2)},addVertex:function(e,t,i){var r=this.vertices,n=this.object.geometry.vertices;n.push(r[e+0],r[e+1],r[e+2]),n.push(r[t+0],r[t+1],r[t+2]),n.push(r[i+0],r[i+1],r[i+2])},addVertexPoint:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,i){var r=this.normals,n=this.object.geometry.normals;n.push(r[e+0],r[e+1],r[e+2]),n.push(r[t+0],r[t+1],r[t+2]),n.push(r[i+0],r[i+1],r[i+2])},addColor:function(e,t,i){var r=this.colors,n=this.object.geometry.colors;n.push(r[e+0],r[e+1],r[e+2]),n.push(r[t+0],r[t+1],r[t+2]),n.push(r[i+0],r[i+1],r[i+2])},addUV:function(e,t,i){var r=this.uvs,n=this.object.geometry.uvs;n.push(r[e+0],r[e+1]),n.push(r[t+0],r[t+1]),n.push(r[i+0],r[i+1])},addUVLine:function(e){var t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,i,r,n,o,a,s,l){var c=this.vertices.length,u=this.parseVertexIndex(e,c),h=this.parseVertexIndex(t,c),p=this.parseVertexIndex(i,c);if(this.addVertex(u,h,p),void 0!==r&&""!==r){var d=this.uvs.length;u=this.parseUVIndex(r,d),h=this.parseUVIndex(n,d),p=this.parseUVIndex(o,d),this.addUV(u,h,p)}if(void 0!==a&&""!==a){var f=this.normals.length;u=this.parseNormalIndex(a,f),h=a===s?u:this.parseNormalIndex(s,f),p=a===l?u:this.parseNormalIndex(l,f),this.addNormal(u,h,p)}this.colors.length>0&&this.addColor(u,h,p)},addPointGeometry:function(e){this.object.geometry.type="Points";for(var t=this.vertices.length,i=0,r=e.length;i<r;i++)this.addVertexPoint(this.parseVertexIndex(e[i],t))},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var i=this.vertices.length,r=this.uvs.length,n=0,o=e.length;n<o;n++)this.addVertexLine(this.parseVertexIndex(e[n],i));var a=0;for(o=t.length;a<o;a++)this.addUVLine(this.parseUVIndex(t[a],r))}};return e.startObject("",!1),e}function n(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.materials=null}return n.prototype={constructor:n,load:function(e,t,i,r){var n=this,o=new THREE.FileLoader(n.manager);o.setPath(this.path),o.load(e,function(e){t(n.parse(e))},i,r)},setPath:function(e){return this.path=e,this},setMaterials:function(e){return this.materials=e,this},parse:function(n){console.time("OBJLoader");var o=new r;-1!==n.indexOf("\r\n")&&(n=n.replace(/\r\n/g,"\n")),-1!==n.indexOf("\\\n")&&(n=n.replace(/\\\n/g,""));for(var a=n.split("\n"),s="",l="",c=[],u="function"==typeof"".trimLeft,h=0,p=a.length;h<p;h++)if(s=a[h],0!==(s=u?s.trimLeft():s.trim()).length&&"#"!==(l=s.charAt(0)))if("v"===l){var d=s.split(/\s+/);switch(d[0]){case"v":o.vertices.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3])),8===d.length&&o.colors.push(parseFloat(d[4]),parseFloat(d[5]),parseFloat(d[6]));break;case"vn":o.normals.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3]));break;case"vt":o.uvs.push(parseFloat(d[1]),parseFloat(d[2]))}}else if("f"===l){for(var f=s.substr(1).trim().split(/\s+/),m=[],g=0,v=f.length;g<v;g++){var y=f[g];if(y.length>0){var b=y.split("/");m.push(b)}}var _=m[0];for(g=1,v=m.length-1;g<v;g++){var x=m[g],E=m[g+1];o.addFace(_[0],x[0],E[0],_[1],x[1],E[1],_[2],x[2],E[2])}}else if("l"===l){var w=s.substring(1).trim().split(" "),T=[],S=[];if(-1===s.indexOf("/"))T=w;else for(var M=0,R=w.length;M<R;M++){var P=w[M].split("/");""!==P[0]&&T.push(P[0]),""!==P[1]&&S.push(P[1])}o.addLineGeometry(T,S)}else if("p"===l){var A=s.substr(1).trim().split(" ");o.addPointGeometry(A)}else if(null!==(c=e.exec(s))){var C=(" "+c[0].substr(1).trim()).substr(1);o.startObject(C)}else if(i.test(s))o.object.startMaterial(s.substring(7).trim(),o.materialLibraries);else if(t.test(s))o.materialLibraries.push(s.substring(7).trim());else{if("s"!==l){if("\0"===s)continue;throw new Error('THREE.OBJLoader: Unexpected line: "'+s+'"')}if((c=s.split(" ")).length>1){var O=c[1].trim().toLowerCase();o.object.smooth="0"!==O&&"off"!==O}else o.object.smooth=!0;(W=o.object.currentMaterial())&&(W.smooth=o.object.smooth)}o.finalize();var L=new THREE.Group;L.materialLibraries=[].concat(o.materialLibraries);for(h=0,p=o.objects.length;h<p;h++){var k=o.objects[h],H=k.geometry,j=k.materials,F="Line"===H.type,D="Points"===H.type,B=!1;if(0!==H.vertices.length){var I=new THREE.BufferGeometry;I.addAttribute("position",new THREE.Float32BufferAttribute(H.vertices,3)),H.normals.length>0?I.addAttribute("normal",new THREE.Float32BufferAttribute(H.normals,3)):I.computeVertexNormals(),H.colors.length>0&&(B=!0,I.addAttribute("color",new THREE.Float32BufferAttribute(H.colors,3))),H.uvs.length>0&&I.addAttribute("uv",new THREE.Float32BufferAttribute(H.uvs,2));for(var N,U=[],V=0,z=j.length;V<z;V++){var q=j[V],W=void 0;if(null!==this.materials)if(W=this.materials.create(q.name),!F||!W||W instanceof THREE.LineBasicMaterial){if(D&&W&&!(W instanceof THREE.PointsMaterial)){var G=new THREE.PointsMaterial({size:10,sizeAttenuation:!1});X.copy(W),W=G}}else{var X=new THREE.LineBasicMaterial;X.copy(W),X.lights=!1,W=X}W||((W=F?new THREE.LineBasicMaterial:D?new THREE.PointsMaterial({size:1,sizeAttenuation:!1}):new THREE.MeshPhongMaterial).name=q.name),W.flatShading=!q.smooth,W.vertexColors=B?THREE.VertexColors:THREE.NoColors,U.push(W)}if(U.length>1){for(V=0,z=j.length;V<z;V++){q=j[V];I.addGroup(q.groupStart,q.groupCount,V)}N=F?new THREE.LineSegments(I,U):D?new THREE.Points(I,U):new THREE.Mesh(I,U)}else N=F?new THREE.LineSegments(I,U[0]):D?new THREE.Points(I,U[0]):new THREE.Mesh(I,U[0]);N.name=k.name,L.add(N)}}return console.timeEnd("OBJLoader"),L}},n}(),THREE.OrbitControls=function(e,t){var i,r,n,o,a;this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoLeftRotate=!1,this.autoUpRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:THREE.MOUSE.LEFT,MIDDLE:THREE.MOUSE.MIDDLE,RIGHT:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._getIntersectPoint=function(){return new THREE.Vector3},this.move=function(e,t){I(e,t)},this.getPolarAngle=function(){return v.phi},this.getAzimuthalAngle=function(){return v.theta},this.saveState=function(){s.target0.copy(s.target),s.position0.copy(s.object.position),s.zoom0=s.object.zoom},this.reset=function(){s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.zoom=s.zoom0,s.object.updateProjectionMatrix(),s.dispatchEvent(u),s.update(),m=f.NONE},this.update=(i=new THREE.Vector3,r=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),n=r.clone().inverse(),o=new THREE.Vector3,a=new THREE.Quaternion,function(){var e=s.object.position;return i.copy(e).sub(s.target),i.applyQuaternion(r),v.setFromVector3(i),s.autoRotate&&m===f.NONE&&(s.autoLeftRotate?H(L()):s.autoUpRotate&&j(L())),v.theta+=y.theta,v.phi+=y.phi,v.theta=Math.max(s.minAzimuthAngle,Math.min(s.maxAzimuthAngle,v.theta)),v.phi=Math.max(s.minPolarAngle,Math.min(s.maxPolarAngle,v.phi)),v.makeSafe(),v.radius*=b,v.radius=Math.max(s.minDistance,Math.min(s.maxDistance,v.radius)),s.target.add(_),i.setFromSpherical(v),i.applyQuaternion(n),e.copy(s.target).add(i),s.object.lookAt(s.target),!0===s.enableDamping?(y.theta*=1-s.dampingFactor,y.phi*=1-s.dampingFactor,_.multiplyScalar(1-s.dampingFactor)):(y.set(0,0,0),_.set(0,0,0)),b=1,!!(x||o.distanceToSquared(s.object.position)>g||8*(1-a.dot(s.object.quaternion))>g)&&(s.dispatchEvent(u),o.copy(s.object.position),a.copy(s.object.quaternion),x=!1,!0)}),this.dispose=function(){s.domElement.removeEventListener("contextmenu",K,!1),s.domElement.removeEventListener("mousedown",z,!1),s.domElement.removeEventListener("wheel",G,!1),s.domElement.removeEventListener("touchstart",Q,!1),s.domElement.removeEventListener("touchend",J,!1),s.domElement.removeEventListener("touchmove",Z,!1),s.domElement.removeEventListener("mousemove",Y,!1),document.removeEventListener("mousemove",q,!1),document.removeEventListener("mouseup",W,!1),window.removeEventListener("keydown",X,!1)};var s=this,l={type:"mousemoveevent"},c={type:"wheel",delta:0},u={type:"change"},h={type:"start"},p={type:"end"},d={type:"mousedownpanevent"},f={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY_PAN:4},m=f.NONE,g=1e-6,v=new THREE.Spherical,y=new THREE.Spherical,b=1,_=new THREE.Vector3,x=!1,E=new THREE.Vector2,w=new THREE.Vector2,T=new THREE.Vector2,S=new THREE.Vector2,M=new THREE.Vector2,R=new THREE.Vector2,P=new THREE.Vector2,A=new THREE.Vector2,C=new THREE.Vector2,O=null;function L(){return 2*Math.PI/60/60*s.autoRotateSpeed}function k(){return Math.pow(.95,s.zoomSpeed)}function H(e){y.theta-=e}function j(e){y.phi-=e}var F,D=(F=new THREE.Vector3,function(e,t){F.setFromMatrixColumn(t,0),F.multiplyScalar(-e),_.add(F)}),B=function(){var e=new THREE.Vector3;return function(t,i){!0===s.screenSpacePanning?e.setFromMatrixColumn(i,1):(e.setFromMatrixColumn(i,0),e.crossVectors(s.object.up,e)),e.multiplyScalar(t),_.add(e)}}(),I=function(){var e=new THREE.Vector3;return function(t,i){var r=s.domElement===document?s.domElement.body:s.domElement;if(s.object.isPerspectiveCamera){var n=s.object.position;e.copy(n).sub(s.target);var o=e.length();o*=Math.tan(s.object.fov/2*Math.PI/180),D(2*t*o/r.clientHeight,s.object.matrix),B(2*i*o/r.clientHeight,s.object.matrix)}else s.object.isOrthographicCamera?(D(t*(s.object.right-s.object.left)/s.object.zoom/r.clientWidth,s.object.matrix),B(i*(s.object.top-s.object.bottom)/s.object.zoom/r.clientHeight,s.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),s.enablePan=!1)}}();function N(e){s.object.isPerspectiveCamera?b/=e:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom*e)),s.object.updateProjectionMatrix(),x=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function U(e){s.object.isPerspectiveCamera?b*=e:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom/e)),s.object.updateProjectionMatrix(),x=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function V(e){S.set(e.clientX,e.clientY),s.dispatchEvent(d)}function z(e){if(!1!==s.enabled){switch(e.preventDefault(),e.button){case s.mouseButtons.LEFT:if(e.ctrlKey||e.metaKey){if(!1===s.enablePan)return;V(e),m=f.PAN}else{if(!1===s.enableRotate)return;!function(e){E.set(e.clientX,e.clientY)}(e),m=f.ROTATE}break;case s.mouseButtons.MIDDLE:if(!1===s.enableZoom)return;!function(e){P.set(e.clientX,e.clientY)}(e),m=f.DOLLY;break;case s.mouseButtons.RIGHT:if(!1===s.enablePan)return;V(e),m=f.PAN}m!==f.NONE&&(document.addEventListener("mousemove",q,!1),document.addEventListener("mouseup",W,!1),s.dispatchEvent(h))}}function q(e){if(!1!==s.enabled)switch(e.preventDefault(),m){case f.ROTATE:if(!1===s.enableRotate)return;!function(e){w.set(e.clientX,e.clientY),T.subVectors(w,E).multiplyScalar(s.rotateSpeed);var t=s.domElement===document?s.domElement.body:s.domElement;H(2*Math.PI*T.x/t.clientHeight),j(2*Math.PI*T.y/t.clientHeight),E.copy(w),s.update()}(e);break;case f.DOLLY:if(!1===s.enableZoom)return;!function(e){A.set(e.clientX,e.clientY),C.subVectors(A,P),C.y>0?N(k()):C.y<0&&U(k()),P.copy(A),s.update()}(e);break;case f.PAN:if(!1===s.enablePan)return;!function(e){M.set(e.clientX,e.clientY),R.subVectors(M,S).multiplyScalar(s.panSpeed),I(R.x,R.y),S.copy(M),s.update()}(e)}}function W(e){!1!==s.enabled&&(document.removeEventListener("mousemove",q,!1),document.removeEventListener("mouseup",W,!1),s.dispatchEvent(p),m=f.NONE)}function G(e){!1===s.enabled||!1===s.enableZoom||m!==f.NONE&&m!==f.ROTATE||(e.preventDefault(),e.stopPropagation(),function(e){e.deltaY<0?U(k()):e.deltaY>0&&N(k()),c.delta=e.deltaY,s.dispatchEvent(c),s.update()}(e))}function X(e){!1!==s.enabled&&!1!==s.enableKeys&&!1!==s.enablePan&&function(e){switch(e.keyCode){case s.keys.UP:I(0,s.keyPanSpeed),s.update();break;case s.keys.BOTTOM:I(0,-s.keyPanSpeed),s.update();break;case s.keys.LEFT:I(s.keyPanSpeed,0),s.update();break;case s.keys.RIGHT:I(-s.keyPanSpeed,0),s.update()}}(e)}function Y(e){var t=!1;if(O){var i=O.distanceTo({x:e.x,y:e.y});0!==e.buttons&&i>=2&&(t=!0)}else O=new THREE.Vector2;O.set(e.x,e.y),t&&s.dispatchEvent(l)}function Q(e){if(!1!==s.enabled){switch(e.preventDefault(),e.touches.length){case 1:if(!1===s.enableRotate)return;!function(e){E.set(e.touches[0].pageX,e.touches[0].pageY)}(e),m=f.TOUCH_ROTATE;break;case 2:if(!1===s.enableZoom&&!1===s.enablePan)return;!function(e){if(s.enableZoom){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+i*i);P.set(0,r)}if(s.enablePan){var n=.5*(e.touches[0].pageX+e.touches[1].pageX),o=.5*(e.touches[0].pageY+e.touches[1].pageY);S.set(n,o)}}(e),m=f.TOUCH_DOLLY_PAN;break;default:m=f.NONE}m!==f.NONE&&s.dispatchEvent(h)}}function Z(e){if(!1!==s.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===s.enableRotate)return;if(m!==f.TOUCH_ROTATE)return;!function(e){w.set(e.touches[0].pageX,e.touches[0].pageY),T.subVectors(w,E).multiplyScalar(s.rotateSpeed);var t=s.domElement===document?s.domElement.body:s.domElement;H(2*Math.PI*T.x/t.clientHeight),j(2*Math.PI*T.y/t.clientHeight),E.copy(w),s.update()}(e);break;case 2:if(!1===s.enableZoom&&!1===s.enablePan)return;if(m!==f.TOUCH_DOLLY_PAN)return;!function(e){if(s.enableZoom){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+i*i);A.set(0,r),C.set(0,Math.pow(A.y/P.y,s.zoomSpeed)),N(C.y),P.copy(A)}if(s.enablePan){var n=.5*(e.touches[0].pageX+e.touches[1].pageX),o=.5*(e.touches[0].pageY+e.touches[1].pageY);M.set(n,o),R.subVectors(M,S).multiplyScalar(s.panSpeed),I(R.x,R.y),S.copy(M)}s.update()}(e);break;default:m=f.NONE}}function J(e){!1!==s.enabled&&(s.dispatchEvent(p),m=f.NONE)}function K(e){!1!==s.enabled&&e.preventDefault()}s.domElement.addEventListener("contextmenu",K,!1),s.domElement.addEventListener("mousedown",z,!1),s.domElement.addEventListener("wheel",G,!1),s.domElement.addEventListener("touchstart",Q,!1),s.domElement.addEventListener("touchend",J,!1),s.domElement.addEventListener("touchmove",Z,!1),s.domElement.addEventListener("mousemove",Y,!1),window.addEventListener("keydown",X,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}}),THREE.Reflector=function(e,t){THREE.Mesh.call(this,e),this.type="Reflector";var i=this,r=void 0!==(t=t||{}).color?new THREE.Color(t.color):new THREE.Color(8355711),n=t.textureWidth||512,o=t.textureHeight||512,a=t.clipBias||0,s=t.shader||THREE.Reflector.ReflectorShader,l=void 0!==t.recursion?t.recursion:0,c=new THREE.Plane,u=new THREE.Vector3,h=new THREE.Vector3,p=new THREE.Vector3,d=new THREE.Matrix4,f=new THREE.Vector3(0,0,-1),m=new THREE.Vector4,g=new THREE.Vector4,v=new THREE.Vector3,y=new THREE.Vector3,b=new THREE.Vector4,_=new THREE.Matrix4,x=new THREE.PerspectiveCamera,E={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1},w=new THREE.WebGLRenderTarget(n,o,E);THREE.Math.isPowerOfTwo(n)&&THREE.Math.isPowerOfTwo(o)||(w.texture.generateMipmaps=!1);var T=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(s.uniforms),fragmentShader:s.fragmentShader,vertexShader:s.vertexShader});T.uniforms.tDiffuse.value=w.texture,T.uniforms.color.value=r,T.uniforms.textureMatrix.value=_,this.material=T,this.renderOrder=-1/0,this.addBeforeRenderFunction("THREE.Reflector",function(e,t,r){if("recursion"in r.userData){if(r.userData.recursion===l)return;r.userData.recursion++}if(h.setFromMatrixPosition(i.matrixWorld),p.setFromMatrixPosition(r.matrixWorld),d.extractRotation(i.matrixWorld),u.set(0,0,1),u.applyMatrix4(d),v.subVectors(h,p),!(v.dot(u)>0)){v.reflect(u).negate(),v.add(h),d.extractRotation(r.matrixWorld),f.set(0,0,-1),f.applyMatrix4(d),f.add(p),y.subVectors(h,f),y.reflect(u).negate(),y.add(h),x.position.copy(v),x.up.set(0,1,0),x.up.applyMatrix4(d),x.up.reflect(u),x.lookAt(y),x.far=r.far,x.updateMatrixWorld(),x.projectionMatrix.copy(r.getProjectionMatrixAlways?r.getProjectionMatrixAlways():r.projectionMatrix),x.userData.recursion=0,_.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),_.multiply(x.projectionMatrix),_.multiply(x.matrixWorldInverse),_.multiply(i.matrixWorld),c.setFromNormalAndCoplanarPoint(u,h),c.applyMatrix4(x.matrixWorldInverse),m.set(c.normal.x,c.normal.y,c.normal.z,c.constant);var n=x.projectionMatrix;b.x=(Math.sign(m.x)+n.elements[8])/n.elements[0],b.y=(Math.sign(m.y)+n.elements[9])/n.elements[5],b.z=-1,b.w=(1+n.elements[10])/n.elements[14],m.multiplyScalar(2/m.dot(b)),n.elements[2]=m.x,n.elements[6]=m.y,n.elements[10]=m.z+1-a,n.elements[14]=m.w,i.visible=!1;var o=e.getRenderTarget(),s=e.vr.enabled,E=e.shadowMap.autoUpdate;e.vr.enabled=!1,e.shadowMap.autoUpdate=!1,e.render(t,x,w,!0),e.vr.enabled=s,e.shadowMap.autoUpdate=E,e.setRenderTarget(o);var T=r.bounds;if(void 0!==T){var S=e.getSize(),M=e.getPixelRatio();g.x=T.x*S.width*M,g.y=T.y*S.height*M,g.z=T.z*S.width*M,g.w=T.w*S.height*M,e.state.viewport(g)}i.visible=!0}}),this.getRenderTarget=function(){return w}},THREE.Reflector.prototype=Object.create(THREE.Mesh.prototype),THREE.Reflector.prototype.constructor=THREE.Reflector,THREE.Reflector.ReflectorShader={uniforms:{color:{type:"c",value:null},tDiffuse:{type:"t",value:null},textureMatrix:{type:"m4",value:null}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 vUv;","void main() {","\tvUv = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","\tvec4 base = texture2DProj( tDiffuse, vUv );","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n")},THREE.ReflectorRTT=function(e,t){THREE.Reflector.call(this,e,t),this.geometry.setDrawRange(0,0)},THREE.ReflectorRTT.prototype=Object.create(THREE.Reflector.prototype),THREE.Refractor=function(e,t){THREE.Mesh.call(this,e),this.type="Refractor";var i=this,r=void 0!==(t=t||{}).color?new THREE.Color(t.color):new THREE.Color(8355711),n=t.textureWidth||512,o=t.textureHeight||512,a=t.clipBias||0,s=t.shader||THREE.Refractor.RefractorShader,l=new THREE.PerspectiveCamera;l.matrixAutoUpdate=!1,l.userData.refractor=!0;var c=new THREE.Plane,u=new THREE.Matrix4,h={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1},p=new THREE.WebGLRenderTarget(n,o,h);THREE.Math.isPowerOfTwo(n)&&THREE.Math.isPowerOfTwo(o)||(p.texture.generateMipmaps=!1),this.material=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(s.uniforms),vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,transparent:!0}),this.material.uniforms.color.value=r,this.material.uniforms.tDiffuse.value=p.texture,this.material.uniforms.textureMatrix.value=u;var d,f,m,g,v,y,b,_,x=(d=new THREE.Vector3,f=new THREE.Vector3,m=new THREE.Matrix4,g=new THREE.Vector3,v=new THREE.Vector3,function(e){return d.setFromMatrixPosition(i.matrixWorld),f.setFromMatrixPosition(e.matrixWorld),g.subVectors(d,f),m.extractRotation(i.matrixWorld),v.set(0,0,1),v.applyMatrix4(m),g.dot(v)<0}),E=function(){var e=new THREE.Vector3,t=new THREE.Vector3,r=new THREE.Quaternion,n=new THREE.Vector3;return function(){i.matrixWorld.decompose(t,r,n),e.set(0,0,1).applyQuaternion(r).normalize(),e.negate(),c.setFromNormalAndCoplanarPoint(e,t)}}(),w=(y=new THREE.Plane,b=new THREE.Vector4,_=new THREE.Vector4,function(e){l.matrixWorld.copy(e.matrixWorld),l.matrixWorldInverse.getInverse(l.matrixWorld),l.projectionMatrix.copy(e.getProjectionMatrixAlways?e.getProjectionMatrixAlways():e.projectionMatrix),l.far=e.far,y.copy(c),y.applyMatrix4(l.matrixWorldInverse),b.set(y.normal.x,y.normal.y,y.normal.z,y.constant);var t=l.projectionMatrix;_.x=(Math.sign(b.x)+t.elements[8])/t.elements[0],_.y=(Math.sign(b.y)+t.elements[9])/t.elements[5],_.z=-1,_.w=(1+t.elements[10])/t.elements[14],b.multiplyScalar(2/b.dot(_)),t.elements[2]=b.x,t.elements[6]=b.y,t.elements[10]=b.z+1-a,t.elements[14]=b.w});var T,S=(T=new THREE.Vector4,function(e,t,r){i.visible=!1;var n=e.getRenderTarget(),o=e.vr.enabled,a=e.shadowMap.autoUpdate;e.vr.enabled=!1,e.shadowMap.autoUpdate=!1,e.render(t,l,p,!0),e.vr.enabled=o,e.shadowMap.autoUpdate=a,e.setRenderTarget(n);var s=r.bounds;if(void 0!==s){var c=e.getSize(),u=e.getPixelRatio();T.x=s.x*c.width*u,T.y=s.y*c.height*u,T.z=s.z*c.width*u,T.w=s.w*c.height*u,e.state.viewport(T)}i.visible=!0});this.onBeforeRender=function(e,t,r){!0!==r.userData.refractor&&!0!=!x(r)&&(E(),function(e){u.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),u.multiply(e.projectionMatrix),u.multiply(e.matrixWorldInverse),u.multiply(i.matrixWorld)}(r),w(r),S(e,t,r))},this.getRenderTarget=function(){return p}},THREE.Refractor.prototype=Object.create(THREE.Mesh.prototype),THREE.Refractor.prototype.constructor=THREE.Refractor,THREE.Refractor.RefractorShader={uniforms:{color:{type:"c",value:null},tDiffuse:{type:"t",value:null},textureMatrix:{type:"m4",value:null}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 vUv;","void main() {","\tvUv = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","\tvec4 base = texture2DProj( tDiffuse, vUv );","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n")},THREE.SceneUtils={createMultiMaterialObject:function(e,t){for(var i=new THREE.Group,r=0,n=t.length;r<n;r++)i.add(new THREE.Mesh(e,t[r]));return i},detach:function(e,t,i){e.applyMatrix(t.matrixWorld),t.remove(e),i.add(e)},attach:function(e,t,i){e.applyMatrix((new THREE.Matrix4).getInverse(i.matrixWorld)),t.remove(e),i.add(e)}},THREE.SimplifyModifier=function(){},function(){var e=new THREE.Vector3,t=new THREE.Vector3;function i(e,t){var i=e.indexOf(t);i>-1&&e.splice(i,1)}function r(e,t){var i=t.position.distanceTo(e.position),r=0,n=[],o=(e.faces,e.faces.length);for(u=0;u<o;u++)(h=e.faces[u]).hasVertex(t)&&n.push(h);for(u=0;u<o;u++){var a=1;h=e.faces[u];for(var s=0;s<n.length;s++){p=n[s];var l=h.normal.dot(p.normal);a=Math.min(a,(1.001-l)/2)}r=Math.max(r,a)}n.length<2&&(r=1),e.isBorder()&&n.length>1&&(r=1);for(var c=0,u=0;u<o;u++){var h=e.faces[u];for(s=0;s<n.length;s++){var p=n[s];if(h.uvAt(e).equals(p.uvAt(e)))break}s==n.length&&c++}return c&&(r=1),i*r+0}function n(e){if(0===e.neighbors.length)return e.collapseNeighbor=null,void(e.collapseCost=-.01);e.collapseCost=1e5,e.collapseNeighbor=null;for(var t=0;t<e.neighbors.length;t++){var i=r(e,e.neighbors[t]);e.collapseNeighbor||(e.collapseNeighbor=e.neighbors[t],e.collapseCost=i,e.minCost=i,e.totalCost=0,e.costCount=0),e.costCount++,e.totalCost+=i,i<e.minCost&&(e.collapseNeighbor=e.neighbors[t],e.minCost=i)}e.collapseCost=e.totalCost/e.costCount}function o(e,t){for(console.assert(0===e.faces.length);e.neighbors.length;){i(e.neighbors.pop().neighbors,e)}i(t,e)}function a(e,t){i(t,e),e.v1&&i(e.v1.faces,e),e.v2&&i(e.v2.faces,e),e.v3&&i(e.v3.faces,e);for(var r,n,o=[this.v1,this.v2,this.v3],a=0;a<3;a++)n=o[(a+1)%3],(r=o[a])&&n&&(r.removeIfNonNeighbor(n),n.removeIfNonNeighbor(r))}function s(e,t,i,r){if(r){var s=[];for(u=0;u<i.neighbors.length;u++)s.push(i.neighbors[u]);for(var l=[],c=i.faces.length,u=0;u<c;u++){(h=i.faces[u]).hasVertex(r)&&l.push(h)}for(u=0;u<c;u++){var h;if(!(h=i.faces[u]).hasVertex(r))for(var p=0;p<l.length;p++){var d=l[p];if(h.uvAt(i).equals(d.uvAt(i))){h.setUV(i,d.uvAt(r));break}l.length}}for(u=i.faces.length-1;u>=0;u--)i.faces[u].hasVertex(r)&&a(i.faces[u],t);for(u=i.faces.length-1;u>=0;u--)i.faces[u].replaceVertex(i,r);for(o(i,e),u=0;u<s.length;u++)n(s[u])}else o(i,e)}function l(e){for(var t=e[0],i=0;i<e.length;i++)e[i].collapseCost<t.collapseCost&&(t=e[i]);return t}function c(e,t,i,r,n,o,a,s,l){this.a=r,this.b=n,this.c=o,this.v1=e,this.v2=t,this.v3=i,this.uv1=a,this.uv2=s,this.uv3=l,this.normal=new THREE.Vector3,this.computeNormal(),e.faces.push(this),e.addUniqueNeighbor(t),e.addUniqueNeighbor(i),t.faces.push(this),t.addUniqueNeighbor(e),t.addUniqueNeighbor(i),i.faces.push(this),i.addUniqueNeighbor(e),i.addUniqueNeighbor(t)}function u(e,t){this.position=e,this.id=t,this.faces=[],this.neighbors=[],this.collapseCost=0,this.collapseNeighbor=null}c.prototype.computeNormal=function(){var i=this.v1.position,r=this.v2.position,n=this.v3.position;e.subVectors(n,r),t.subVectors(i,r),e.cross(t).normalize(),this.normal.copy(e)},c.prototype.hasVertex=function(e){return e===this.v1||e===this.v2||e===this.v3},c.prototype.replaceVertex=function(e,t){e===this.v1?this.v1=t:e===this.v2?this.v2=t:e===this.v3&&(this.v3=t),i(e.faces,this),t.faces.push(this),e.removeIfNonNeighbor(this.v1),this.v1.removeIfNonNeighbor(e),e.removeIfNonNeighbor(this.v2),this.v2.removeIfNonNeighbor(e),e.removeIfNonNeighbor(this.v3),this.v3.removeIfNonNeighbor(e),this.v1.addUniqueNeighbor(this.v2),this.v1.addUniqueNeighbor(this.v3),this.v2.addUniqueNeighbor(this.v1),this.v2.addUniqueNeighbor(this.v3),this.v3.addUniqueNeighbor(this.v1),this.v3.addUniqueNeighbor(this.v2),this.computeNormal()},c.prototype.uvAt=function(e){var t=[this.v1,this.v2,this.v3].reduce(function(t,i,r){return!t.length&&e.position.equals(i)&&t.push(r),t},[])[0];return[this.uv1,this.uv2,this.uv3][t]},c.prototype.setUV=function(e,t){var i=[this.v1,this.v2,this.v3].reduce(function(t,i,r){return!t.length&&e.position.equals(i)&&t.push(r),t},[])[0];[this.uv1,this.uv2,this.uv3][i]=t},u.prototype.addUniqueNeighbor=function(e){var t,i;t=this.neighbors,i=e,-1===t.indexOf(i)&&t.push(i)},u.prototype.removeIfNonNeighbor=function(e){var t=this.neighbors,i=this.faces,r=t.indexOf(e);if(-1!==r){for(var n=0;n<i.length;n++)if(i[n].hasVertex(e))return;t.splice(r,1)}},u.prototype.isBorder=function(){for(var e=this.neighbors.length,t=0;t<e;t++){for(var i=0,r=this.faces.length,n=0;n<r;n++)this.faces[n].hasVertex(this.neighbors[t])&&i++;if(1===i)return!0}return!1},THREE.SimplifyModifier.prototype.modify=function(e,t){e instanceof THREE.BufferGeometry&&!e.vertices&&!e.faces&&(console.log("converting BufferGeometry to Geometry"),e=(new THREE.Geometry).fromBufferGeometry(e)),e.mergeVertices();var i,r,o=e.vertices,a=e.faces,h=e.faceVertexUvs[0],p=(new THREE.Geometry,new Array(o.length)),d=new Array(a.length);new Array(h.length);for(i=0,r=o.length;i<r;i++)p[i]=new u(o[i],i);for(i=0,r=a.length;i<r;i++)b=a[i],h[i],d[i]=new c(p[b.a],p[b.b],p[b.c],b.a,b.b,b.c,h[i][0],h[i][1],h[i][2]);for(i=0,r=p.length;i<r;i++)n(p[i]);new Array(p.length),new Array(p.length);for(var f,m=t;m--;){if(!(f=l(p))){console.log("no next vertex");break}s(p,d,f,f.collapseNeighbor)}var g=new THREE.Geometry;for(i=0;i<p.length;i++){var v=p[i];g.vertices.push(v.position)}for(i=0;i<d.length;i++){var y=d[i],b=new THREE.Face3(p.indexOf(y.v1),p.indexOf(y.v2),p.indexOf(y.v3),y.normal);g.faces.push(b),g.faceVertexUvs[0].push([y.uv1,y.uv2,y.uv3])}return g}}(),THREE.Sky=function(){var e=THREE.Sky.SkyShader,t=new THREE.ShaderMaterial({fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:THREE.UniformsUtils.clone(e.uniforms),side:THREE.BackSide});THREE.Mesh.call(this,new THREE.BoxBufferGeometry(1,1,1),t)},THREE.Sky.prototype=Object.assign(Object.create(THREE.Mesh.prototype),{constructor:THREE.Sky,isSky:!0}),THREE.Sky.SkyShader={uniforms:{luminance:{value:1},turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new THREE.Vector3}},vertexShader:["uniform vec3 sunPosition;","uniform float rayleigh;","uniform float turbidity;","uniform float mieCoefficient;","varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );","const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );","const float v = 4.0;","const vec3 K = vec3( 0.686, 0.678, 0.666 );","const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );","const float cutoffAngle = 1.6110731556870734;","const float steepness = 1.5;","const float EE = 1000.0;","float sunIntensity( float zenithAngleCos ) {","\tzenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );","\treturn EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );","}","vec3 totalMie( float T ) {","\tfloat c = ( 0.2 * T ) * 10E-18;","\treturn 0.434 * c * MieConst;","}","void main() {","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvWorldPosition = worldPosition.xyz;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\tgl_Position.z = gl_Position.w;","\tvSunDirection = normalize( sunPosition );","\tvSunE = sunIntensity( dot( vSunDirection, up ) );","\tvSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );","\tfloat rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );","\tvBetaR = totalRayleigh * rayleighCoefficient;","\tvBetaM = totalMie( turbidity ) * mieCoefficient;","}"].join("\n"),fragmentShader:["varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","uniform float luminance;","uniform float mieDirectionalG;","const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003;","const float N = 2.545E25;","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","const float THREE_OVER_SIXTEENPI = 0.05968310365946075;","const float ONE_OVER_FOURPI = 0.07957747154594767;","float rayleighPhase( float cosTheta ) {","\treturn THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );","}","float hgPhase( float cosTheta, float g ) {","\tfloat g2 = pow( g, 2.0 );","\tfloat inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );","\treturn ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );","}","const float A = 0.15;","const float B = 0.50;","const float C = 0.10;","const float D = 0.20;","const float E = 0.02;","const float F = 0.30;","const float whiteScale = 1.0748724675633854;","vec3 Uncharted2Tonemap( vec3 x ) {","\treturn ( ( x * ( A * x + C * B ) + D * E ) / ( x * ( A * x + B ) + D * F ) ) - E / F;","}","void main() {","\tfloat zenithAngle = acos( max( 0.0, dot( up, normalize( vWorldPosition - cameraPos ) ) ) );","\tfloat inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );","\tfloat sR = rayleighZenithLength * inverse;","\tfloat sM = mieZenithLength * inverse;","\tvec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );","\tfloat cosTheta = dot( normalize( vWorldPosition - cameraPos ), vSunDirection );","\tfloat rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );","\tvec3 betaRTheta = vBetaR * rPhase;","\tfloat mPhase = hgPhase( cosTheta, mieDirectionalG );","\tvec3 betaMTheta = vBetaM * mPhase;","\tvec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );","\tLin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );","\tvec3 direction = normalize( vWorldPosition - cameraPos );","\tfloat theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]","\tfloat phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]","\tvec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );","\tvec3 L0 = vec3( 0.1 ) * Fex;","\tfloat sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );","\tL0 += ( vSunE * 19000.0 * Fex ) * sundisk;","\tvec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );","\tvec3 curr = Uncharted2Tonemap( ( log2( 2.0 / pow( luminance, 4.0 ) ) ) * texColor );","\tvec3 color = curr * whiteScale;","\tvec3 retColor = pow( color, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );","\tgl_FragColor = vec4( retColor, 1.0 );","}"].join("\n")},THREE.SubdivisionModifier=function(e){this.subdivisions=void 0===e?1:e},THREE.SubdivisionModifier.prototype.modify=function(e){for(var t=this.subdivisions;t-- >0;)this.smooth(e);e.computeFaceNormals(),e.computeVertexNormals()},function(){var e=["a","b","c"];function t(e,t,i){return i[Math.min(e,t)+"_"+Math.max(e,t)]}function i(e,t,i,r,n,o){var a,s=Math.min(e,t),l=Math.max(e,t),c=s+"_"+l;c in r?a=r[c]:(a={a:i[s],b:i[l],newEdge:null,faces:[]},r[c]=a);a.faces.push(n),o[e].edges.push(a),o[t].edges.push(a)}function r(e,t,i,r,n){e.push(new THREE.Face3(t,i,r,void 0,void 0,n))}function n(e,t){return Math.abs(t-e)/2+Math.min(e,t)}function o(e,t,i,r){e.push([t.clone(),i.clone(),r.clone()])}THREE.SubdivisionModifier.prototype.smooth=function(a){var s,l,c,u,h,p,d,f,m,g,v,y,b,_,x=new THREE.Vector3,E=[];s=a.vertices,l=a.faces;var w,T,S,M,R,P,A,C,O,L,k,H,j,F,D=void 0!==(c=a.faceVertexUvs[0])&&c.length>0;for(d in function(e,t,r,n){var o,a,s;for(o=0,a=e.length;o<a;o++)r[o]={edges:[]};for(o=0,a=t.length;o<a;o++)i((s=t[o]).a,s.b,e,n,s,r),i(s.b,s.c,e,n,s,r),i(s.c,s.a,e,n,s,r)}(s,l,v=new Array(s.length),y={}),b=[],y){for(T=y[d],S=new THREE.Vector3,R=3/8,P=1/8,2!=(A=T.faces.length)&&(R=.5,P=0),S.addVectors(T.a,T.b).multiplyScalar(R),x.set(0,0,0),m=0;m<A;m++){for(M=T.faces[m],g=0;g<3&&((w=s[M[e[g]]])===T.a||w===T.b);g++);x.add(w)}x.multiplyScalar(P),S.add(x),T.newEdge=b.length,b.push(S)}for(_=[],d=0,f=s.length;d<f;d++){for(j=s[d],3==(p=(H=v[d].edges).length)?C=3/16:p>3&&(C=3/(8*p)),O=1-p*C,L=C,p<=2&&2==p&&(O=.75,L=1/8),F=j.clone().multiplyScalar(O),x.set(0,0,0),m=0;m<p;m++)w=(k=H[m]).a!==j?k.a:k.b,x.add(w);x.multiplyScalar(L),F.add(x),_.push(F)}u=_.concat(b);var B,I,N,U,V,z,q,W=_.length;h=[];var G=new THREE.Vector2,X=new THREE.Vector2,Y=new THREE.Vector2;for(d=0,f=l.length;d<f;d++)r(h,B=t((M=l[d]).a,M.b,y).newEdge+W,I=t(M.b,M.c,y).newEdge+W,N=t(M.c,M.a,y).newEdge+W,M.materialIndex),r(h,M.a,B,N,M.materialIndex),r(h,M.b,I,B,M.materialIndex),r(h,M.c,N,I,M.materialIndex),D&&(V=(U=c[d])[0],z=U[1],q=U[2],G.set(n(V.x,z.x),n(V.y,z.y)),X.set(n(z.x,q.x),n(z.y,q.y)),Y.set(n(V.x,q.x),n(V.y,q.y)),o(E,G,X,Y),o(E,V,G,Y),o(E,z,X,G),o(E,q,Y,X));a.vertices=u,a.faces=h,D&&(a.faceVertexUvs[0]=E)}}();var THREEx=THREEx||{};THREEx.HtmlMixer=THREEx.HtmlMixer||{},THREEx.HtmlMixer.Context=function(e,t,i){var r=[];this.update=function(){r.forEach(function(e){e()})};this.cssFactor=1e3;var n=new THREE.CSS3DRenderer({autoFixCamera:!0});this.rendererCss=n,this.rendererWebgl=e;var o=new THREE.PerspectiveCamera(i.fov,i.aspect,1e3*i.near,1e3*i.far);this.cssCamera=o,r.push(function(){o.quaternion.copy(i.quaternion),o.position.copy(i.position).multiplyScalar(1e3)});var a=new THREE.Scene;this.cssScene=a,this.autoUpdateObjects=!0,r.push(function(){!0===this.autoUpdateObjects&&a.traverse(function(e){if(e instanceof THREE.Scene!=!0){var t=e.userData.mixerPlane;void 0!==t&&t.update()}})}.bind(this)),r.push(function(e,t){a.children.length&&n.render(a,o)})},THREEx.HtmlMixer.Plane=function(e,t,i){(i=i||{}).elementW=void 0!==i.elementW?i.elementW:768,i.planeW=void 0!==i.planeW?i.planeW:1,i.planeH=void 0!==i.planeH?i.planeH:.75,i.object3d=void 0!==i.object3d?i.object3d:null,this.domElement=t;var r=[];this.update=function(){r.forEach(function(e){e()})};var n=i.planeW,o=i.planeH;if(null===i.object3d)var a=new THREE.MeshBasicMaterial({opacity:0,color:new THREE.Color("black"),blending:THREE.NoBlending,side:THREE.DoubleSide}),s=new THREE.PlaneGeometry(1,1),l=new THREE.Mesh(s,a);else l=i.object3d;this.object3d=l;var c=o/n,u=i.elementW,h=u*c;function p(){t.style.width=u+"px",t.style.height=h+"px"}this.setDomElement=function(e){var i=t;i.parentNode&&i.parentNode.removeChild(i),this.domElement=t=e,d.element=t,p()},p();var d=new THREE.CSS3DObject(t);this.cssObject=d,d.scale.set(n,o,1),d.userData.mixerPlane=this,l.addEventListener("added",function(t){e.cssScene.add(d)}),l.addEventListener("removed",function(t){e.cssScene.remove(d)}),r.push(function(){l.updateMatrixWorld();var t=l.matrixWorld,i=new THREE.Vector3,r=new THREE.Vector3,n=new THREE.Quaternion;t.decompose(i,n,r),d.quaternion.copy(n),d.position.copy(i).multiplyScalar(e.cssFactor);var o=e.cssFactor/1e3,a=l.geometry.parameters,s=e.cssFactor/(u/(a.width*r.x)),c=e.cssFactor/(h/(a.height*r.y));d.scale.set(s*o,c*o,1)})},THREE.TransformControls=function(e,t){THREE.Object3D.call(this),t=void 0!==t?t:document,this.visible=!1;var i=new THREE.TransformControlsGizmo;this._gizmo=i,this.add(i);var r=new THREE.TransformControlsPlane;this._plane=r,this.add(r);var n=this;F("camera",e),F("object",void 0),F("enabled",!0),F("axis",null),F("mode","translate"),F("translationSnap",null),F("rotationSnap",null),F("space","world"),F("size",1),F("dragging",!1),F("showX",!0),F("showY",!0),F("showZ",!0);var o={type:"change"},a={type:"mouseDown"},s={type:"mouseUp",mode:n.mode},l={type:"objectChange"},c=new THREE.Raycaster,u=new THREE.Vector3,h=new THREE.Vector3,p=new THREE.Quaternion,d={X:new THREE.Vector3(1,0,0),Y:new THREE.Vector3(0,1,0),Z:new THREE.Vector3(0,0,1)},f=new THREE.Quaternion,m=new THREE.Vector3,g=new THREE.Vector3,v=new THREE.Vector3,y=new THREE.Vector3,b=0,_=new THREE.Vector3,x=new THREE.Quaternion,E=new THREE.Vector3,w=new THREE.Vector3,T=new THREE.Quaternion,S=new THREE.Vector3,M=new THREE.Vector3,R=new THREE.Quaternion,P=new THREE.Vector3,A=new THREE.Vector3,C=new THREE.Quaternion,O=new THREE.Vector3,L=new THREE.Vector3,k=new THREE.Vector3,H=new THREE.Quaternion,j=new THREE.Vector3;function F(e,t){var a=t;Object.defineProperty(n,e,{get:function(){return void 0!==a?a:t},set:function(t){a!==t&&(a=t,r[e]=t,i[e]=t,n.dispatchEvent({type:e+"-changed",value:t}),n.dispatchEvent(o))}}),n[e]=t,r[e]=t,i[e]=t}function D(e){var i=e.changedTouches?e.changedTouches[0]:e,r=t.getBoundingClientRect();return{x:(i.clientX-r.left)/r.width*2-1,y:-(i.clientY-r.top)/r.height*2+1,button:e.button}}function B(e){e.preventDefault()}function I(e){n.enabled&&n.pointerHover(D(e))}function N(e){n.enabled&&(e.preventDefault(),document.addEventListener("mousemove",U,!1),n.pointerHover(D(e)),n.pointerDown(D(e)))}function U(e){n.enabled&&(e.preventDefault(),n.pointerMove(D(e)))}function V(e){n.enabled&&(e.preventDefault(),document.removeEventListener("mousemove",U,!1),n.pointerUp(D(e)))}F("parentQuaternion",T),F("worldPosition",A),F("worldPositionStart",M),F("worldQuaternion",C),F("worldQuaternionStart",R),F("cameraPosition",_),F("cameraQuaternion",x),F("pointStart",g),F("pointEnd",v),F("rotationAxis",y),F("rotationAngle",b),F("eye",L),t.addEventListener("mousedown",N,!1),t.addEventListener("touchstart",N,!1),t.addEventListener("mousemove",I,!1),t.addEventListener("touchmove",I,!1),t.addEventListener("touchmove",U,!1),document.addEventListener("mouseup",V,!1),t.addEventListener("touchend",V,!1),t.addEventListener("touchcancel",V,!1),t.addEventListener("touchleave",V,!1),t.addEventListener("contextmenu",B,!1),this.dispose=function(){t.removeEventListener("mousedown",N),t.removeEventListener("touchstart",N),t.removeEventListener("mousemove",I),t.removeEventListener("touchmove",I),t.removeEventListener("touchmove",U),document.removeEventListener("mouseup",V),t.removeEventListener("touchend",V),t.removeEventListener("touchcancel",V),t.removeEventListener("touchleave",V),t.removeEventListener("contextmenu",B)},this.attach=function(e){this.object=e,this.visible=!0},this.detach=function(){this.object=void 0,this.visible=!1,this.axis=null},this.updateMatrixWorld=function(){void 0!==this.object&&(this.object.updateMatrixWorld(),this.object.parent.matrixWorld.decompose(w,T,S),this.object.matrixWorld.decompose(A,C,O)),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(_,x,E),this.camera.isPerspectiveCamera?L.copy(_).sub(A).normalize():this.camera.isOrthographicCamera&&L.copy(_).normalize(),THREE.Object3D.prototype.updateMatrixWorld.call(this)},this.pointerHover=function(e){if(void 0!==this.object&&!0!==this.dragging&&(void 0===e.button||0===e.button)){c.setFromCamera(e,this.camera);var t=c.intersectObjects(i.picker[this.mode].children,!0)[0]||!1;this.axis=t?t.object.name:null}},this.pointerDown=function(e){if(!(void 0===this.object||!0===this.dragging||void 0!==e.button&&0!==e.button||0!==e.button&&void 0!==e.button||null===this.axis)){c.setFromCamera(e,this.camera);var t=c.intersectObjects([r],!0)[0]||!1;if(t){var i=this.space;if("scale"===this.mode?i="local":"E"!==this.axis&&"XYZE"!==this.axis&&"XYZ"!==this.axis||(i="world"),"local"===i&&"rotate"===this.mode){var n=this.rotationSnap;"X"===this.axis&&n&&(this.object.rotation.x=Math.round(this.object.rotation.x/n)*n),"Y"===this.axis&&n&&(this.object.rotation.y=Math.round(this.object.rotation.y/n)*n),"Z"===this.axis&&n&&(this.object.rotation.z=Math.round(this.object.rotation.z/n)*n)}this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),k.copy(this.object.position),H.copy(this.object.quaternion),j.copy(this.object.scale),this.object.matrixWorld.decompose(M,R,P),g.copy(t.point).sub(M),"local"===i&&g.applyQuaternion(R.clone().inverse())}this.dragging=!0,a.mode=this.mode,this.dispatchEvent(a)}},this.pointerMove=function(e){var t=this.axis,i=this.mode,n=this.object,a=this.space;if("scale"===i?a="local":"E"!==t&&"XYZE"!==t&&"XYZ"!==t||(a="world"),void 0!==n&&null!==t&&!1!==this.dragging&&(void 0===e.button||0===e.button)){c.setFromCamera(e,this.camera);var s=c.intersectObjects([r],!0)[0]||!1;if(!1!==s){if(v.copy(s.point).sub(M),"local"===a&&v.applyQuaternion(R.clone().inverse()),"translate"===i)-1===t.search("X")&&(v.x=g.x),-1===t.search("Y")&&(v.y=g.y),-1===t.search("Z")&&(v.z=g.z),"local"===a?n.position.copy(v).sub(g).applyQuaternion(H):n.position.copy(v).sub(g),n.position.add(k),this.translationSnap&&("local"===a&&(n.position.applyQuaternion(p.copy(H).inverse()),-1!==t.search("X")&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.position.applyQuaternion(H)),"world"===a&&(n.parent&&n.position.add(u.setFromMatrixPosition(n.parent.matrixWorld)),-1!==t.search("X")&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.parent&&n.position.sub(u.setFromMatrixPosition(n.parent.matrixWorld))));else if("scale"===i){if(-1!==t.search("XYZ")){var _=v.length()/g.length();v.dot(g)<0&&(_*=-1),u.set(_,_,_)}else u.copy(v).divide(g),-1===t.search("X")&&(u.x=1),-1===t.search("Y")&&(u.y=1),-1===t.search("Z")&&(u.z=1);n.scale.copy(j).multiply(u)}else if("rotate"===i){var x=20/A.distanceTo(u.setFromMatrixPosition(this.camera.matrixWorld)),E="local"===this.space?C:f,w=d[t];"E"===t?(u.copy(v).cross(g),y.copy(L),b=v.angleTo(g)*(u.dot(L)<0?1:-1)):"XYZE"===t?(u.copy(v).sub(g).cross(L).normalize(),y.copy(u),b=v.sub(g).dot(u.cross(L))*x):"X"!==t&&"Y"!==t&&"Z"!==t||(m.copy(w).applyQuaternion(E),y.copy(w),u=w.clone(),h=v.clone().sub(g),"local"===a&&(u.applyQuaternion(E),h.applyQuaternion(R)),b=h.dot(u.cross(L).normalize())*x),this.rotationSnap&&(b=Math.round(b/this.rotationSnap)*this.rotationSnap),this.rotationAngle=b,"local"===a?(n.quaternion.copy(H),n.quaternion.multiply(p.setFromAxisAngle(y,b))):(n.quaternion.copy(p.setFromAxisAngle(y,b)),n.quaternion.multiply(H))}this.dispatchEvent(o),this.dispatchEvent(l)}}},this.pointerUp=function(e){void 0!==e.button&&0!==e.button||(this.dragging&&null!==this.axis&&(s.mode=this.mode,this.dispatchEvent(s)),this.dragging=!1,void 0===e.button&&(this.axis=null))},this.getMode=function(){return n.mode},this.setMode=function(e){n.mode=e},this.setTranslationSnap=function(e){n.translationSnap=e},this.setRotationSnap=function(e){n.rotationSnap=e},this.setSize=function(e){n.size=e},this.setSpace=function(e){n.space=e},this.update=function(){console.warn("THREE.TransformControls: update function has been depricated.")}},THREE.TransformControls.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.TransformControls,isTransformControls:!0}),THREE.TransformControlsGizmo=function(){"use strict";THREE.Object3D.call(this),this.type="TransformControlsGizmo";var e=new THREE.MeshBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,side:THREE.DoubleSide,fog:!1}),t=new THREE.LineBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1}),i=e.clone();i.opacity=.15;var r=e.clone();r.opacity=.33;var n=e.clone();n.color.set(16711680);var o=e.clone();o.color.set(65280);var a=e.clone();a.color.set(255);var s=e.clone();s.opacity=.25;var l=s.clone();l.color.set(16776960);var c=s.clone();c.color.set(65535);var u=s.clone();u.color.set(16711935),e.clone().color.set(16776960);var h=t.clone();h.color.set(16711680);var p=t.clone();p.color.set(65280);var d=t.clone();d.color.set(255);var f=t.clone();f.color.set(65535);var m=t.clone();m.color.set(16711935);var g=t.clone();g.color.set(16776960);var v=t.clone();v.color.set(7895160);var y=g.clone();y.opacity=.25;var b=new THREE.CylinderBufferGeometry(0,.05,.2,12,1,!1),_=new THREE.BoxBufferGeometry(.125,.125,.125),x=new THREE.BufferGeometry;x.addAttribute("position",new THREE.Float32BufferAttribute([0,0,0,1,0,0],3));var E,w=function(e,t){for(var i=new THREE.BufferGeometry,r=[],n=0;n<=64*t;++n)r.push(0,Math.cos(n/32*Math.PI)*e,Math.sin(n/32*Math.PI)*e);return i.addAttribute("position",new THREE.Float32BufferAttribute(r,3)),i},T={X:[[new THREE.Mesh(b,n),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new THREE.Mesh(b,n),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new THREE.Line(x,h)]],Y:[[new THREE.Mesh(b,o),[0,1,0],null,null,"fwd"],[new THREE.Mesh(b,o),[0,1,0],[Math.PI,0,0],null,"bwd"],[new THREE.Line(x,p),null,[0,0,Math.PI/2]]],Z:[[new THREE.Mesh(b,a),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new THREE.Mesh(b,a),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new THREE.Line(x,d),null,[0,-Math.PI/2,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.1,0),s),[0,0,0],[0,0,0]]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.295,.295),l),[.15,.15,0]],[new THREE.Line(x,g),[.18,.3,0],null,[.125,1,1]],[new THREE.Line(x,g),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.295,.295),c),[0,.15,.15],[0,Math.PI/2,0]],[new THREE.Line(x,f),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new THREE.Line(x,f),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.295,.295),u),[.15,0,.15],[-Math.PI/2,0,0]],[new THREE.Line(x,m),[.18,0,.3],null,[.125,1,1]],[new THREE.Line(x,m),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},S={X:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),i),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),i),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),i),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.2,0),i)]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),i),[.2,.2,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),i),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),i),[.2,0,.2],[-Math.PI/2,0,0]]]},M={START:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.01,2),r),null,null,null,"helper"]],END:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.01,2),r),null,null,null,"helper"]],DELTA:[[new THREE.Line((E=new THREE.BufferGeometry,E.addAttribute("position",new THREE.Float32BufferAttribute([0,0,0,1,1,1],3)),E),r),null,null,null,"helper"]],X:[[new THREE.Line(x,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new THREE.Line(x,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new THREE.Line(x,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},R={X:[[new THREE.Line(w(1,.5),h)],[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.04,0),n),[0,0,.99],null,[1,3,1]]],Y:[[new THREE.Line(w(1,.5),p),null,[0,0,-Math.PI/2]],[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.04,0),o),[0,0,.99],null,[3,1,1]]],Z:[[new THREE.Line(w(1,.5),d),null,[0,Math.PI/2,0]],[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.04,0),a),[.99,0,0],null,[1,3,1]]],E:[[new THREE.Line(w(1.25,1),y),null,[0,Math.PI/2,0]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new THREE.Line(w(1,1),v),null,[0,Math.PI/2,0]]]},P={AXIS:[[new THREE.Line(x,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},A={X:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.1,4,24),i),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.1,4,24),i),[0,0,0],[Math.PI/2,0,0]]],Z:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.1,4,24),i),[0,0,0],[0,0,-Math.PI/2]]],E:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1.25,.1,2,24),i)]],XYZE:[[new THREE.Mesh(new THREE.SphereBufferGeometry(.7,10,8),i)]]},C={X:[[new THREE.Mesh(_,n),[.8,0,0],[0,0,-Math.PI/2]],[new THREE.Line(x,h),null,null,[.8,1,1]]],Y:[[new THREE.Mesh(_,o),[0,.8,0]],[new THREE.Line(x,p),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new THREE.Mesh(_,a),[0,0,.8],[Math.PI/2,0,0]],[new THREE.Line(x,d),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new THREE.Mesh(_,l),[.85,.85,0],null,[2,2,.2]],[new THREE.Line(x,g),[.855,.98,0],null,[.125,1,1]],[new THREE.Line(x,g),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new THREE.Mesh(_,c),[0,.85,.85],null,[.2,2,2]],[new THREE.Line(x,f),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new THREE.Line(x,f),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new THREE.Mesh(_,u),[.85,0,.85],null,[2,.2,2]],[new THREE.Line(x,m),[.855,0,.98],null,[.125,1,1]],[new THREE.Line(x,m),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.125,.125,.125),s),[1.1,0,0]]],XYZY:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.125,.125,.125),s),[0,1.1,0]]],XYZZ:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.125,.125,.125),s),[0,0,1.1]]]},O={X:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,.8,4,1,!1),i),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,.8,4,1,!1),i),[0,.5,0]]],Z:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,.8,4,1,!1),i),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new THREE.Mesh(_,i),[.85,.85,0],null,[3,3,.2]]],YZ:[[new THREE.Mesh(_,i),[0,.85,.85],null,[.2,3,3]]],XZ:[[new THREE.Mesh(_,i),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.2,.2,.2),i),[1.1,0,0]]],XYZY:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.2,.2,.2),i),[0,1.1,0]]],XYZZ:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.2,.2,.2),i),[0,0,1.1]]]},L={X:[[new THREE.Line(x,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new THREE.Line(x,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new THREE.Line(x,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},k=function(e){var t=new THREE.Object3D;for(var i in e)for(var r=e[i].length;r--;){var n=e[i][r][0].clone(),o=e[i][r][1],a=e[i][r][2],s=e[i][r][3],l=e[i][r][4];n.name=i,n.tag=l,o&&n.position.set(o[0],o[1],o[2]),a&&n.rotation.set(a[0],a[1],a[2]),s&&n.scale.set(s[0],s[1],s[2]),n.updateMatrix();var c=n.geometry.clone();c.applyMatrix(n.matrix),n.geometry=c,n.position.set(0,0,0),n.rotation.set(0,0,0),n.scale.set(1,1,1),t.add(n)}return t},H=new THREE.Vector3(0,0,0),j=new THREE.Euler,F=new THREE.Vector3(0,1,0),D=new THREE.Vector3(0,0,0),B=new THREE.Matrix4,I=new THREE.Quaternion,N=new THREE.Quaternion,U=new THREE.Quaternion,V=new THREE.Vector3(1,0,0),z=new THREE.Vector3(0,1,0),q=new THREE.Vector3(0,0,1);this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=k(T)),this.add(this.gizmo.rotate=k(R)),this.add(this.gizmo.scale=k(C)),this.add(this.picker.translate=k(S)),this.add(this.picker.rotate=k(A)),this.add(this.picker.scale=k(O)),this.add(this.helper.translate=k(M)),this.add(this.helper.rotate=k(P)),this.add(this.helper.scale=k(L)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1,this.updateMatrixWorld=function(){var e=this.space;"scale"===this.mode&&(e="local");var t="local"===e?this.worldQuaternion:U;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;var i=[];i=(i=(i=i.concat(this.picker[this.mode].children)).concat(this.gizmo[this.mode].children)).concat(this.helper[this.mode].children);for(var r=0;r<i.length;r++){var n=i[r];n.visible=!0,n.rotation.set(0,0,0),n.position.copy(this.worldPosition);var o=this.worldPosition.distanceTo(this.cameraPosition);if(n.scale.set(1,1,1).multiplyScalar(o*this.size/7),"helper"!==n.tag){if(n.quaternion.copy(t),"translate"===this.mode||"scale"===this.mode){"X"!==n.name&&"XYZX"!==n.name||Math.abs(F.copy(V).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"Y"!==n.name&&"XYZY"!==n.name||Math.abs(F.copy(z).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"Z"!==n.name&&"XYZZ"!==n.name||Math.abs(F.copy(q).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"XY"===n.name&&Math.abs(F.copy(q).applyQuaternion(t).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"YZ"===n.name&&Math.abs(F.copy(V).applyQuaternion(t).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"XZ"===n.name&&Math.abs(F.copy(z).applyQuaternion(t).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),-1!==n.name.search("X")&&(F.copy(V).applyQuaternion(t).dot(this.eye)<-.4?"fwd"===n.tag?n.visible=!1:n.scale.x*=-1:"bwd"===n.tag&&(n.visible=!1)),-1!==n.name.search("Y")&&(F.copy(z).applyQuaternion(t).dot(this.eye)<-.4?"fwd"===n.tag?n.visible=!1:n.scale.y*=-1:"bwd"===n.tag&&(n.visible=!1)),-1!==n.name.search("Z")&&(F.copy(q).applyQuaternion(t).dot(this.eye)<-.4?"fwd"===n.tag?n.visible=!1:n.scale.z*=-1:"bwd"===n.tag&&(n.visible=!1))}else"rotate"===this.mode&&(N.copy(t),F.copy(this.eye).applyQuaternion(I.copy(t).inverse()),-1!==n.name.search("E")&&n.quaternion.setFromRotationMatrix(B.lookAt(this.eye,D,z)),"X"===n.name&&(I.setFromAxisAngle(V,Math.atan2(-F.y,F.z)),I.multiplyQuaternions(N,I),n.quaternion.copy(I)),"Y"===n.name&&(I.setFromAxisAngle(z,Math.atan2(F.x,F.z)),I.multiplyQuaternions(N,I),n.quaternion.copy(I)),"Z"===n.name&&(I.setFromAxisAngle(q,Math.atan2(F.y,F.x)),I.multiplyQuaternions(N,I),n.quaternion.copy(I)));n.visible=n.visible&&(-1===n.name.indexOf("X")||this.showX),n.visible=n.visible&&(-1===n.name.indexOf("Y")||this.showY),n.visible=n.visible&&(-1===n.name.indexOf("Z")||this.showZ),n.visible=n.visible&&(-1===n.name.indexOf("E")||this.showX&&this.showY&&this.showZ),n.material._opacity=n.material._opacity||n.material.opacity,n.material._color=n.material._color||n.material.color.clone(),n.material.color.copy(n.material._color),n.material.opacity=n.material._opacity,this.enabled?this.axis&&(n.name===this.axis?(n.material.opacity=1,n.material.color.lerp(new THREE.Color(1,1,1),.5)):this.axis.split("").some(function(e){return n.name===e})?(n.material.opacity=1,n.material.color.lerp(new THREE.Color(1,1,1),.5)):(n.material.opacity*=.25,n.material.color.lerp(new THREE.Color(1,1,1),.5))):(n.material.opacity*=.5,n.material.color.lerp(new THREE.Color(1,1,1),.5))}else n.visible=!1,"AXIS"===n.name?(n.position.copy(this.worldPositionStart),n.visible=!!this.axis,"X"===this.axis&&(I.setFromEuler(j.set(0,0,0)),n.quaternion.copy(t).multiply(I),Math.abs(F.copy(V).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),"Y"===this.axis&&(I.setFromEuler(j.set(0,0,Math.PI/2)),n.quaternion.copy(t).multiply(I),Math.abs(F.copy(z).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),"Z"===this.axis&&(I.setFromEuler(j.set(0,Math.PI/2,0)),n.quaternion.copy(t).multiply(I),Math.abs(F.copy(q).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),"XYZE"===this.axis&&(I.setFromEuler(j.set(0,Math.PI/2,0)),F.copy(this.rotationAxis),n.quaternion.setFromRotationMatrix(B.lookAt(D,F,z)),n.quaternion.multiply(I),n.visible=this.dragging),"E"===this.axis&&(n.visible=!1)):"START"===n.name?(n.position.copy(this.worldPositionStart),n.visible=this.dragging):"END"===n.name?(n.position.copy(this.worldPosition),n.visible=this.dragging):"DELTA"===n.name?(n.position.copy(this.worldPositionStart),n.quaternion.copy(this.worldQuaternionStart),H.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),H.applyQuaternion(this.worldQuaternionStart.clone().inverse()),n.scale.copy(H),n.visible=this.dragging):(n.quaternion.copy(t),this.dragging?n.position.copy(this.worldPositionStart):n.position.copy(this.worldPosition),this.axis&&(n.visible=-1!==this.axis.search(n.name)))}THREE.Object3D.prototype.updateMatrixWorld.call(this)}},THREE.TransformControlsGizmo.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.TransformControlsGizmo,isTransformControlsGizmo:!0}),THREE.TransformControlsPlane=function(){"use strict";THREE.Mesh.call(this,new THREE.PlaneBufferGeometry(1e5,1e5,2,2),new THREE.MeshBasicMaterial({visible:!1,wireframe:!0,side:THREE.DoubleSide,transparent:!0,opacity:.1})),this.type="TransformControlsPlane";var e=new THREE.Vector3(1,0,0),t=new THREE.Vector3(0,1,0),i=new THREE.Vector3(0,0,1),r=new THREE.Vector3,n=new THREE.Vector3,o=new THREE.Vector3,a=new THREE.Matrix4,s=new THREE.Quaternion;this.updateMatrixWorld=function(){var l=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(l="local"),e.set(1,0,0).applyQuaternion("local"===l?this.worldQuaternion:s),t.set(0,1,0).applyQuaternion("local"===l?this.worldQuaternion:s),i.set(0,0,1).applyQuaternion("local"===l?this.worldQuaternion:s),o.copy(t),this.mode){case"translate":case"scale":switch(this.axis){case"X":o.copy(this.eye).cross(e),n.copy(e).cross(o);break;case"Y":o.copy(this.eye).cross(t),n.copy(t).cross(o);break;case"Z":o.copy(this.eye).cross(i),n.copy(i).cross(o);break;case"XY":n.copy(i);break;case"YZ":n.copy(e);break;case"XZ":o.copy(i),n.copy(t);break;case"XYZ":case"E":n.set(0,0,0)}break;case"rotate":default:n.set(0,0,0)}0===n.length()?this.quaternion.copy(this.cameraQuaternion):(a.lookAt(r.set(0,0,0),n,o),this.quaternion.setFromRotationMatrix(a)),THREE.Object3D.prototype.updateMatrixWorld.call(this)}},THREE.TransformControlsPlane.prototype=Object.assign(Object.create(THREE.Mesh.prototype),{constructor:THREE.TransformControlsPlane,isTransformControlsPlane:!0}),THREE.Water=function(e,t){THREE.Mesh.call(this,e),this.type="Water";var i=this,r=void 0!==(t=t||{}).color?new THREE.Color(t.color):new THREE.Color(16777215),n=t.textureWidth||512,o=t.textureHeight||512,a=t.clipBias||0,s=t.flowDirection||new THREE.Vector2(1,0),l=t.flowSpeed||.03,c=t.reflectivity||.02,u=t.scale||1,h=t.shader||THREE.Water.WaterShader,p=new THREE.TextureLoader,d=t.flowMap||void 0,f=t.normalMap0||p.load("textures/water/Water_1_M_Normal.jpg"),m=t.normalMap1||p.load("textures/water/Water_2_M_Normal.jpg"),g=.15,v=.5*g,y=new THREE.Matrix4,b=new THREE.Clock;if(void 0!==THREE.Reflector)if(void 0!==THREE.Refractor){var _=new THREE.Reflector(e,{textureWidth:n,textureHeight:o,clipBias:a}),x=new THREE.Refractor(e,{textureWidth:n,textureHeight:o,clipBias:a});_.matrixAutoUpdate=!1,x.matrixAutoUpdate=!1,this.material=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,h.uniforms]),vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,transparent:!0,fog:!0}),void 0!==d?(this.material.defines.USE_FLOWMAP="",this.material.uniforms.tFlowMap={type:"t",value:d}):this.material.uniforms.flowDirection={type:"v2",value:s},f.wrapS=f.wrapT=THREE.RepeatWrapping,m.wrapS=m.wrapT=THREE.RepeatWrapping,this.material.uniforms.tReflectionMap.value=_.getRenderTarget().texture,this.material.uniforms.tRefractionMap.value=x.getRenderTarget().texture,this.material.uniforms.tNormalMap0.value=f,this.material.uniforms.tNormalMap1.value=m,this.material.uniforms.color.value=r,this.material.uniforms.reflectivity.value=c,this.material.uniforms.textureMatrix.value=y,this.material.uniforms.config.value.x=0,this.material.uniforms.config.value.y=v,this.material.uniforms.config.value.z=v,this.material.uniforms.config.value.w=u,this.addBeforeRenderFunction("THREE.Water",function(e,t,r){var n,o;!function(e){y.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),y.multiply(e.getProjectionMatrixAlways?e.getProjectionMatrixAlways():e.projectionMatrix),y.multiply(e.matrixWorldInverse),y.multiply(i.matrixWorld)}(r),n=b.getDelta(),(o=i.material.uniforms.config).value.x+=l*n,o.value.y=o.value.x+v,o.value.x>=g?(o.value.x=0,o.value.y=v):o.value.y>=g&&(o.value.y=o.value.y-g),i.visible=!1,_.matrixWorld.copy(i.matrixWorld),x.matrixWorld.copy(i.matrixWorld),_.onBeforeRender(e,t,r),x.onBeforeRender(e,t,r),i.visible=!0})}else console.error("THREE.Water: Required component THREE.Refractor not found.");else console.error("THREE.Water: Required component THREE.Reflector not found.")},THREE.Water.prototype=Object.create(THREE.Mesh.prototype),THREE.Water.prototype.constructor=THREE.Water,THREE.Water.WaterShader={uniforms:{color:{type:"c",value:null},reflectivity:{type:"f",value:0},tReflectionMap:{type:"t",value:null},tRefractionMap:{type:"t",value:null},tNormalMap0:{type:"t",value:null},tNormalMap1:{type:"t",value:null},textureMatrix:{type:"m4",value:null},config:{type:"v4",value:new THREE.Vector4}},vertexShader:["#include <fog_pars_vertex>","uniform mat4 textureMatrix;","varying vec4 vCoord;","varying vec2 vUv;","varying vec3 vToEye;","void main() {","\tvUv = uv;","\tvCoord = textureMatrix * vec4( position, 1.0 );","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvToEye = cameraPosition - worldPosition.xyz;","\tvec4 mvPosition =  viewMatrix * worldPosition;","\tgl_Position = projectionMatrix * mvPosition;","\t#include <fog_vertex>","}"].join("\n"),fragmentShader:["#include <fog_pars_fragment>","uniform sampler2D tReflectionMap;","uniform sampler2D tRefractionMap;","uniform sampler2D tNormalMap0;","uniform sampler2D tNormalMap1;","#ifdef USE_FLOWMAP","\tuniform sampler2D tFlowMap;","#else","\tuniform vec2 flowDirection;","#endif","uniform vec3 color;","uniform float reflectivity;","uniform vec4 config;","varying vec4 vCoord;","varying vec2 vUv;","varying vec3 vToEye;","void main() {","\tfloat flowMapOffset0 = config.x;","\tfloat flowMapOffset1 = config.y;","\tfloat halfCycle = config.z;","\tfloat scale = config.w;","\tvec3 toEye = normalize( vToEye );","\tvec2 flow;","\t#ifdef USE_FLOWMAP","\t\tflow = texture2D( tFlowMap, vUv ).rg * 2.0 - 1.0;","\t#else","\t\tflow = flowDirection;","\t#endif","\tflow.x *= - 1.0;","\tvec4 normalColor0 = texture2D( tNormalMap0, ( vUv * scale ) + flow * flowMapOffset0 );","\tvec4 normalColor1 = texture2D( tNormalMap1, ( vUv * scale ) + flow * flowMapOffset1 );","\tfloat flowLerp = abs( halfCycle - flowMapOffset0 ) / halfCycle;","\tvec4 normalColor = mix( normalColor0, normalColor1, flowLerp );","\tvec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );","\tfloat theta = max( dot( toEye, normal ), 0.0 );","\tfloat reflectance = reflectivity + ( 1.0 - reflectivity ) * pow( ( 1.0 - theta ), 5.0 );","\tvec3 coord = vCoord.xyz / vCoord.w;","\tvec2 uv = coord.xy + coord.z * normal.xz * 0.05;","\tvec4 reflectColor = texture2D( tReflectionMap, vec2( 1.0 - uv.x, uv.y ) );","\tvec4 refractColor = texture2D( tRefractionMap, uv );","\tgl_FragColor = vec4( color, 1.0 ) * mix( refractColor, reflectColor, reflectance );","\t#include <tonemapping_fragment>","\t#include <encodings_fragment>","\t#include <fog_fragment>","}"].join("\n")},function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.combine={})}(this,function(e){"use strict";var t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function i(e,t){return e(t={exports:{}},t.exports),t.exports}var r=i(function(e){var t=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=t)}),n=i(function(e){var t=e.exports={version:"2.6.5"};"number"==typeof __e&&(__e=t)}),o=function(e){return"object"==typeof e?null!==e:"function"==typeof e},a=function(e){if(!o(e))throw TypeError(e+" is not an object!");return e},s=function(e){try{return!!e()}catch(e){return!0}},l=!s(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),c=r.document,u=o(c)&&o(c.createElement),h=function(e){return u?c.createElement(e):{}},p=!l&&!s(function(){return 7!=Object.defineProperty(h("div"),"a",{get:function(){return 7}}).a}),d=function(e,t){if(!o(e))return e;var i,r;if(t&&"function"==typeof(i=e.toString)&&!o(r=i.call(e)))return r;if("function"==typeof(i=e.valueOf)&&!o(r=i.call(e)))return r;if(!t&&"function"==typeof(i=e.toString)&&!o(r=i.call(e)))return r;throw TypeError("Can't convert object to primitive value")},f=Object.defineProperty,m={f:l?Object.defineProperty:function(e,t,i){if(a(e),t=d(t,!0),a(i),p)try{return f(e,t,i)}catch(e){}if("get"in i||"set"in i)throw TypeError("Accessors not supported!");return"value"in i&&(e[t]=i.value),e}},g=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},v=l?function(e,t,i){return m.f(e,t,g(1,i))}:function(e,t,i){return e[t]=i,e},y={}.hasOwnProperty,b=function(e,t){return y.call(e,t)},_=0,x=Math.random(),E=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++_+x).toString(36))},w=i(function(e){var t=r["__core-js_shared__"]||(r["__core-js_shared__"]={});(e.exports=function(e,i){return t[e]||(t[e]=void 0!==i?i:{})})("versions",[]).push({version:n.version,mode:"global",copyright:" 2019 Denis Pushkarev (zloirock.ru)"})}),T=w("native-function-to-string",Function.toString),S=i(function(e){var t=E("src"),i=(""+T).split("toString");n.inspectSource=function(e){return T.call(e)},(e.exports=function(e,n,o,a){var s="function"==typeof o;s&&(b(o,"name")||v(o,"name",n)),e[n]!==o&&(s&&(b(o,t)||v(o,t,e[n]?""+e[n]:i.join(String(n)))),e===r?e[n]=o:a?e[n]?e[n]=o:v(e,n,o):(delete e[n],v(e,n,o)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[t]||T.call(this)})}),M=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e},R=function(e,t,i){if(M(e),void 0===t)return e;switch(i){case 1:return function(i){return e.call(t,i)};case 2:return function(i,r){return e.call(t,i,r)};case 3:return function(i,r,n){return e.call(t,i,r,n)}}return function(){return e.apply(t,arguments)}},P=function(e,t,i){var o,a,s,l,c=e&P.F,u=e&P.G,h=e&P.S,p=e&P.P,d=e&P.B,f=u?r:h?r[t]||(r[t]={}):(r[t]||{}).prototype,m=u?n:n[t]||(n[t]={}),g=m.prototype||(m.prototype={});for(o in u&&(i=t),i)s=((a=!c&&f&&void 0!==f[o])?f:i)[o],l=d&&a?R(s,r):p&&"function"==typeof s?R(Function.call,s):s,f&&S(f,o,s,e&P.U),m[o]!=s&&v(m,o,l),p&&g[o]!=s&&(g[o]=s)};r.core=n,P.F=1,P.G=2,P.S=4,P.P=8,P.B=16,P.W=32,P.U=64,P.R=128;for(var A,C=P,O=E("typed_array"),L=E("view"),k=!(!r.ArrayBuffer||!r.DataView),H=k,j=0,F="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");j<9;)(A=r[F[j++]])?(v(A.prototype,O,!0),v(A.prototype,L,!0)):H=!1;var D={ABV:k,CONSTR:H,TYPED:O,VIEW:L},B=function(e,t,i){for(var r in t)S(e,r,t[r],i);return e},I=function(e,t,i,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(i+": incorrect invocation!");return e},N=Math.ceil,U=Math.floor,V=function(e){return isNaN(e=+e)?0:(e>0?U:N)(e)},z=Math.min,q=function(e){return e>0?z(V(e),9007199254740991):0},W=function(e){if(void 0===e)return 0;var t=V(e),i=q(t);if(t!==i)throw RangeError("Wrong length!");return i},G={}.toString,X=function(e){return G.call(e).slice(8,-1)},Y=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==X(e)?e.split(""):Object(e)},Q=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e},Z=function(e){return Y(Q(e))},J=Math.max,K=Math.min,$=function(e,t){return(e=V(e))<0?J(e+t,0):K(e,t)},ee=function(e){return function(t,i,r){var n,o=Z(t),a=q(o.length),s=$(r,a);if(e&&i!=i){for(;a>s;)if((n=o[s++])!=n)return!0}else for(;a>s;s++)if((e||s in o)&&o[s]===i)return e||s||0;return!e&&-1}},te=w("keys"),ie=function(e){return te[e]||(te[e]=E(e))},re=ee(!1),ne=ie("IE_PROTO"),oe=function(e,t){var i,r=Z(e),n=0,o=[];for(i in r)i!=ne&&b(r,i)&&o.push(i);for(;t.length>n;)b(r,i=t[n++])&&(~re(o,i)||o.push(i));return o},ae="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),se=ae.concat("length","prototype"),le={f:Object.getOwnPropertyNames||function(e){return oe(e,se)}},ce=function(e){return Object(Q(e))},ue=function(e){for(var t=ce(this),i=q(t.length),r=arguments.length,n=$(r>1?arguments[1]:void 0,i),o=r>2?arguments[2]:void 0,a=void 0===o?i:$(o,i);a>n;)t[n++]=e;return t},he=i(function(e){var t=w("wks"),i=r.Symbol,n="function"==typeof i;(e.exports=function(e){return t[e]||(t[e]=n&&i[e]||(n?i:E)("Symbol."+e))}).store=t}),pe=m.f,de=he("toStringTag"),fe=function(e,t,i){e&&!b(e=i?e:e.prototype,de)&&pe(e,de,{configurable:!0,value:t})},me=i(function(e,t){var i=le.f,n=m.f,o="prototype",a="Wrong index!",c=r.ArrayBuffer,u=r.DataView,h=r.Math,p=r.RangeError,d=r.Infinity,f=c,g=h.abs,y=h.pow,b=h.floor,_=h.log,x=h.LN2,E=l?"_b":"buffer",w=l?"_l":"byteLength",T=l?"_o":"byteOffset";function S(e,t,i){var r,n,o,a=new Array(i),s=8*i-t-1,l=(1<<s)-1,c=l>>1,u=23===t?y(2,-24)-y(2,-77):0,h=0,p=e<0||0===e&&1/e<0?1:0;for((e=g(e))!=e||e===d?(n=e!=e?1:0,r=l):(r=b(_(e)/x),e*(o=y(2,-r))<1&&(r--,o*=2),(e+=r+c>=1?u/o:u*y(2,1-c))*o>=2&&(r++,o/=2),r+c>=l?(n=0,r=l):r+c>=1?(n=(e*o-1)*y(2,t),r+=c):(n=e*y(2,c-1)*y(2,t),r=0));t>=8;a[h++]=255&n,n/=256,t-=8);for(r=r<<t|n,s+=t;s>0;a[h++]=255&r,r/=256,s-=8);return a[--h]|=128*p,a}function M(e,t,i){var r,n=8*i-t-1,o=(1<<n)-1,a=o>>1,s=n-7,l=i-1,c=e[l--],u=127&c;for(c>>=7;s>0;u=256*u+e[l],l--,s-=8);for(r=u&(1<<-s)-1,u>>=-s,s+=t;s>0;r=256*r+e[l],l--,s-=8);if(0===u)u=1-a;else{if(u===o)return r?NaN:c?-d:d;r+=y(2,t),u-=a}return(c?-1:1)*r*y(2,u-t)}function R(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]}function P(e){return[255&e]}function A(e){return[255&e,e>>8&255]}function C(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]}function O(e){return S(e,52,8)}function L(e){return S(e,23,4)}function k(e,t,i){n(e[o],t,{get:function(){return this[i]}})}function H(e,t,i,r){var n=W(+i);if(n+t>e[w])throw p(a);var o=e[E]._b,s=n+e[T],l=o.slice(s,s+t);return r?l:l.reverse()}function j(e,t,i,r,n,o){var s=W(+i);if(s+t>e[w])throw p(a);for(var l=e[E]._b,c=s+e[T],u=r(+n),h=0;h<t;h++)l[c+h]=u[o?h:t-h-1]}if(D.ABV){if(!s(function(){c(1)})||!s(function(){new c(-1)})||s(function(){return new c,new c(1.5),new c(NaN),"ArrayBuffer"!=c.name})){for(var F,N=(c=function(e){return I(this,c),new f(W(e))})[o]=f[o],U=i(f),z=0;U.length>z;)(F=U[z++])in c||v(c,F,f[F]);N.constructor=c}var G=new u(new c(2)),X=u[o].setInt8;G.setInt8(0,2147483648),G.setInt8(1,2147483649),!G.getInt8(0)&&G.getInt8(1)||B(u[o],{setInt8:function(e,t){X.call(this,e,t<<24>>24)},setUint8:function(e,t){X.call(this,e,t<<24>>24)}},!0)}else c=function(e){I(this,c,"ArrayBuffer");var t=W(e);this._b=ue.call(new Array(t),0),this[w]=t},u=function(e,t,i){I(this,u,"DataView"),I(e,c,"DataView");var r=e[w],n=V(t);if(n<0||n>r)throw p("Wrong offset!");if(n+(i=void 0===i?r-n:q(i))>r)throw p("Wrong length!");this[E]=e,this[T]=n,this[w]=i},l&&(k(c,"byteLength","_l"),k(u,"buffer","_b"),k(u,"byteLength","_l"),k(u,"byteOffset","_o")),B(u[o],{getInt8:function(e){return H(this,1,e)[0]<<24>>24},getUint8:function(e){return H(this,1,e)[0]},getInt16:function(e){var t=H(this,2,e,arguments[1]);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=H(this,2,e,arguments[1]);return t[1]<<8|t[0]},getInt32:function(e){return R(H(this,4,e,arguments[1]))},getUint32:function(e){return R(H(this,4,e,arguments[1]))>>>0},getFloat32:function(e){return M(H(this,4,e,arguments[1]),23,4)},getFloat64:function(e){return M(H(this,8,e,arguments[1]),52,8)},setInt8:function(e,t){j(this,1,e,P,t)},setUint8:function(e,t){j(this,1,e,P,t)},setInt16:function(e,t){j(this,2,e,A,t,arguments[2])},setUint16:function(e,t){j(this,2,e,A,t,arguments[2])},setInt32:function(e,t){j(this,4,e,C,t,arguments[2])},setUint32:function(e,t){j(this,4,e,C,t,arguments[2])},setFloat32:function(e,t){j(this,4,e,L,t,arguments[2])},setFloat64:function(e,t){j(this,8,e,O,t,arguments[2])}});fe(c,"ArrayBuffer"),fe(u,"DataView"),v(u[o],D.VIEW,!0),t.ArrayBuffer=c,t.DataView=u}),ge=he("species"),ve=function(e,t){var i,r=a(e).constructor;return void 0===r||null==(i=a(r)[ge])?t:M(i)},ye=he("species"),be=function(e){var t=r[e];l&&t&&!t[ye]&&m.f(t,ye,{configurable:!0,get:function(){return this}})},_e=r.ArrayBuffer,xe=me.ArrayBuffer,Ee=me.DataView,we=D.ABV&&_e.isView,Te=xe.prototype.slice,Se=D.VIEW;C(C.G+C.W+C.F*(_e!==xe),{ArrayBuffer:xe}),C(C.S+C.F*!D.CONSTR,"ArrayBuffer",{isView:function(e){return we&&we(e)||o(e)&&Se in e}}),C(C.P+C.U+C.F*s(function(){return!new xe(2).slice(1,void 0).byteLength}),"ArrayBuffer",{slice:function(e,t){if(void 0!==Te&&void 0===t)return Te.call(a(this),e);for(var i=a(this).byteLength,r=$(e,i),n=$(void 0===t?i:t,i),o=new(ve(this,xe))(q(n-r)),s=new Ee(this),l=new Ee(o),c=0;r<n;)l.setUint8(c++,s.getUint8(r++));return o}}),be("ArrayBuffer");var Me=he("toStringTag"),Re="Arguments"==X(function(){return arguments}()),Pe=function(e){var t,i,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(i=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),Me))?i:Re?X(t):"Object"==(r=X(t))&&"function"==typeof t.callee?"Arguments":r},Ae={},Ce=he("iterator"),Oe=Array.prototype,Le=function(e){return void 0!==e&&(Ae.Array===e||Oe[Ce]===e)},ke=Object.keys||function(e){return oe(e,ae)},He=l?Object.defineProperties:function(e,t){a(e);for(var i,r=ke(t),n=r.length,o=0;n>o;)m.f(e,i=r[o++],t[i]);return e},je=r.document,Fe=je&&je.documentElement,De=ie("IE_PROTO"),Be=function(){},Ie=function(){var e,t=h("iframe"),i=ae.length;for(t.style.display="none",Fe.appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),Ie=e.F;i--;)delete Ie.prototype[ae[i]];return Ie()},Ne=Object.create||function(e,t){var i;return null!==e?(Be.prototype=a(e),i=new Be,Be.prototype=null,i[De]=e):i=Ie(),void 0===t?i:He(i,t)},Ue=ie("IE_PROTO"),Ve=Object.prototype,ze=Object.getPrototypeOf||function(e){return e=ce(e),b(e,Ue)?e[Ue]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?Ve:null},qe=he("iterator"),We=n.getIteratorMethod=function(e){if(null!=e)return e[qe]||e["@@iterator"]||Ae[Pe(e)]},Ge=Array.isArray||function(e){return"Array"==X(e)},Xe=he("species"),Ye=function(e,t){return new(function(e){var t;return Ge(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!Ge(t.prototype)||(t=void 0),o(t)&&null===(t=t[Xe])&&(t=void 0)),void 0===t?Array:t}(e))(t)},Qe=function(e,t){var i=1==e,r=2==e,n=3==e,o=4==e,a=6==e,s=5==e||a,l=t||Ye;return function(t,c,u){for(var h,p,d=ce(t),f=Y(d),m=R(c,u,3),g=q(f.length),v=0,y=i?l(t,g):r?l(t,0):void 0;g>v;v++)if((s||v in f)&&(p=m(h=f[v],v,d),e))if(i)y[v]=p;else if(p)switch(e){case 3:return!0;case 5:return h;case 6:return v;case 2:y.push(h)}else if(o)return!1;return a?-1:n||o?o:y}},Ze=he("unscopables"),Je=Array.prototype;null==Je[Ze]&&v(Je,Ze,{});var Ke=function(e){Je[Ze][e]=!0},$e=function(e,t){return{value:t,done:!!e}},et={};v(et,he("iterator"),function(){return this});var tt=function(e,t,i){e.prototype=Ne(et,{next:g(1,i)}),fe(e,t+" Iterator")},it=he("iterator"),rt=!([].keys&&"next"in[].keys()),nt=function(){return this},ot=function(e,t,i,r,n,o,a){tt(i,t,r);var s,l,c,u=function(e){if(!rt&&e in f)return f[e];switch(e){case"keys":case"values":return function(){return new i(this,e)}}return function(){return new i(this,e)}},h=t+" Iterator",p="values"==n,d=!1,f=e.prototype,m=f[it]||f["@@iterator"]||n&&f[n],g=m||u(n),y=n?p?u("entries"):g:void 0,b="Array"==t&&f.entries||m;if(b&&(c=ze(b.call(new e)))!==Object.prototype&&c.next&&(fe(c,h,!0),"function"!=typeof c[it]&&v(c,it,nt)),p&&m&&"values"!==m.name&&(d=!0,g=function(){return m.call(this)}),(rt||d||!f[it])&&v(f,it,g),Ae[t]=g,Ae[h]=nt,n)if(s={values:p?g:u("values"),keys:o?g:u("keys"),entries:y},a)for(l in s)l in f||S(f,l,s[l]);else C(C.P+C.F*(rt||d),t,s);return s},at=ot(Array,"Array",function(e,t){this._t=Z(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,i=this._i++;return!e||i>=e.length?(this._t=void 0,$e(1)):$e(0,"keys"==t?i:"values"==t?e[i]:[i,e[i]])},"values");Ae.Arguments=Ae.Array,Ke("keys"),Ke("values"),Ke("entries");var st=he("iterator"),lt=!1;try{var ct=[7][st]();ct.return=function(){lt=!0},Array.from(ct,function(){throw 2})}catch(e){}var ut=function(e,t){if(!t&&!lt)return!1;var i=!1;try{var r=[7],n=r[st]();n.next=function(){return{done:i=!0}},r[st]=function(){return n},e(r)}catch(e){}return i},ht=[].copyWithin||function(e,t){var i=ce(this),r=q(i.length),n=$(e,r),o=$(t,r),a=arguments.length>2?arguments[2]:void 0,s=Math.min((void 0===a?r:$(a,r))-o,r-n),l=1;for(o<n&&n<o+s&&(l=-1,o+=s-1,n+=s-1);s-- >0;)o in i?i[n]=i[o]:delete i[n],n+=l,o+=l;return i},pt={f:{}.propertyIsEnumerable},dt=Object.getOwnPropertyDescriptor,ft={f:l?dt:function(e,t){if(e=Z(e),t=d(t,!0),p)try{return dt(e,t)}catch(e){}if(b(e,t))return g(!pt.f.call(e,t),e[t])}},mt=i(function(e){if(l){var t=r,i=s,n=C,a=D,c=me,u=R,h=I,p=g,f=v,y=B,_=V,x=q,w=W,T=$,S=d,M=b,P=Pe,A=o,O=ce,L=Le,k=Ne,H=ze,j=le.f,F=We,N=E,U=he,z=Qe,G=ee,X=ve,Y=at,Q=Ae,Z=ut,J=be,K=ue,te=ht,ie=m,re=ft,ne=ie.f,oe=re.f,ae=t.RangeError,se=t.TypeError,pe=t.Uint8Array,de=Array.prototype,fe=c.ArrayBuffer,ge=c.DataView,ye=z(0),_e=z(2),xe=z(3),Ee=z(4),we=z(5),Te=z(6),Se=G(!0),Me=G(!1),Re=Y.values,Ce=Y.keys,Oe=Y.entries,ke=de.lastIndexOf,He=de.reduce,je=de.reduceRight,Fe=de.join,De=de.sort,Be=de.slice,Ie=de.toString,Ue=de.toLocaleString,Ve=U("iterator"),qe=U("toStringTag"),Ge=N("typed_constructor"),Xe=N("def_constructor"),Ye=a.CONSTR,Ze=a.TYPED,Je=a.VIEW,Ke=z(1,function(e,t){return rt(X(e,e[Xe]),t)}),$e=i(function(){return 1===new pe(new Uint16Array([1]).buffer)[0]}),et=!!pe&&!!pe.prototype.set&&i(function(){new pe(1).set({})}),tt=function(e,t){var i=_(e);if(i<0||i%t)throw ae("Wrong offset!");return i},it=function(e){if(A(e)&&Ze in e)return e;throw se(e+" is not a typed array!")},rt=function(e,t){if(!(A(e)&&Ge in e))throw se("It is not a typed array constructor!");return new e(t)},nt=function(e,t){return ot(X(e,e[Xe]),t)},ot=function(e,t){for(var i=0,r=t.length,n=rt(e,r);r>i;)n[i]=t[i++];return n},st=function(e,t,i){ne(e,t,{get:function(){return this._d[i]}})},lt=function(e){var t,i,r,n,o,a,s=O(e),l=arguments.length,c=l>1?arguments[1]:void 0,h=void 0!==c,p=F(s);if(null!=p&&!L(p)){for(a=p.call(s),r=[],t=0;!(o=a.next()).done;t++)r.push(o.value);s=r}for(h&&l>2&&(c=u(c,arguments[2],2)),t=0,i=x(s.length),n=rt(this,i);i>t;t++)n[t]=h?c(s[t],t):s[t];return n},ct=function(){for(var e=0,t=arguments.length,i=rt(this,t);t>e;)i[e]=arguments[e++];return i},pt=!!pe&&i(function(){Ue.call(new pe(1))}),dt=function(){return Ue.apply(pt?Be.call(it(this)):it(this),arguments)},mt={copyWithin:function(e,t){return te.call(it(this),e,t,arguments.length>2?arguments[2]:void 0)},every:function(e){return Ee(it(this),e,arguments.length>1?arguments[1]:void 0)},fill:function(e){return K.apply(it(this),arguments)},filter:function(e){return nt(this,_e(it(this),e,arguments.length>1?arguments[1]:void 0))},find:function(e){return we(it(this),e,arguments.length>1?arguments[1]:void 0)},findIndex:function(e){return Te(it(this),e,arguments.length>1?arguments[1]:void 0)},forEach:function(e){ye(it(this),e,arguments.length>1?arguments[1]:void 0)},indexOf:function(e){return Me(it(this),e,arguments.length>1?arguments[1]:void 0)},includes:function(e){return Se(it(this),e,arguments.length>1?arguments[1]:void 0)},join:function(e){return Fe.apply(it(this),arguments)},lastIndexOf:function(e){return ke.apply(it(this),arguments)},map:function(e){return Ke(it(this),e,arguments.length>1?arguments[1]:void 0)},reduce:function(e){return He.apply(it(this),arguments)},reduceRight:function(e){return je.apply(it(this),arguments)},reverse:function(){for(var e,t=it(this).length,i=Math.floor(t/2),r=0;r<i;)e=this[r],this[r++]=this[--t],this[t]=e;return this},some:function(e){return xe(it(this),e,arguments.length>1?arguments[1]:void 0)},sort:function(e){return De.call(it(this),e)},subarray:function(e,t){var i=it(this),r=i.length,n=T(e,r);return new(X(i,i[Xe]))(i.buffer,i.byteOffset+n*i.BYTES_PER_ELEMENT,x((void 0===t?r:T(t,r))-n))}},gt=function(e,t){return nt(this,Be.call(it(this),e,t))},vt=function(e){it(this);var t=tt(arguments[1],1),i=this.length,r=O(e),n=x(r.length),o=0;if(n+t>i)throw ae("Wrong length!");for(;o<n;)this[t+o]=r[o++]},yt={entries:function(){return Oe.call(it(this))},keys:function(){return Ce.call(it(this))},values:function(){return Re.call(it(this))}},bt=function(e,t){return A(e)&&e[Ze]&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)},_t=function(e,t){return bt(e,t=S(t,!0))?p(2,e[t]):oe(e,t)},xt=function(e,t,i){return!(bt(e,t=S(t,!0))&&A(i)&&M(i,"value"))||M(i,"get")||M(i,"set")||i.configurable||M(i,"writable")&&!i.writable||M(i,"enumerable")&&!i.enumerable?ne(e,t,i):(e[t]=i.value,e)};Ye||(re.f=_t,ie.f=xt),n(n.S+n.F*!Ye,"Object",{getOwnPropertyDescriptor:_t,defineProperty:xt}),i(function(){Ie.call({})})&&(Ie=Ue=function(){return Fe.call(this)});var Et=y({},mt);y(Et,yt),f(Et,Ve,yt.values),y(Et,{slice:gt,set:vt,constructor:function(){},toString:Ie,toLocaleString:dt}),st(Et,"buffer","b"),st(Et,"byteOffset","o"),st(Et,"byteLength","l"),st(Et,"length","e"),ne(Et,qe,{get:function(){return this[Ze]}}),e.exports=function(e,r,o,s){var l=e+((s=!!s)?"Clamped":"")+"Array",c="get"+e,u="set"+e,p=t[l],d=p||{},m=p&&H(p),g=!p||!a.ABV,v={},y=p&&p.prototype,b=function(e,t){ne(e,t,{get:function(){return function(e,t){var i=e._d;return i.v[c](t*r+i.o,$e)}(this,t)},set:function(e){return function(e,t,i){var n=e._d;s&&(i=(i=Math.round(i))<0?0:i>255?255:255&i),n.v[u](t*r+n.o,i,$e)}(this,t,e)},enumerable:!0})};g?(p=o(function(e,t,i,n){h(e,p,l,"_d");var o,a,s,c,u=0,d=0;if(A(t)){if(!(t instanceof fe||"ArrayBuffer"==(c=P(t))||"SharedArrayBuffer"==c))return Ze in t?ot(p,t):lt.call(p,t);o=t,d=tt(i,r);var m=t.byteLength;if(void 0===n){if(m%r)throw ae("Wrong length!");if((a=m-d)<0)throw ae("Wrong length!")}else if((a=x(n)*r)+d>m)throw ae("Wrong length!");s=a/r}else s=w(t),o=new fe(a=s*r);for(f(e,"_d",{b:o,o:d,l:a,e:s,v:new ge(o)});u<s;)b(e,u++)}),y=p.prototype=k(Et),f(y,"constructor",p)):i(function(){p(1)})&&i(function(){new p(-1)})&&Z(function(e){new p,new p(null),new p(1.5),new p(e)},!0)||(p=o(function(e,t,i,n){var o;return h(e,p,l),A(t)?t instanceof fe||"ArrayBuffer"==(o=P(t))||"SharedArrayBuffer"==o?void 0!==n?new d(t,tt(i,r),n):void 0!==i?new d(t,tt(i,r)):new d(t):Ze in t?ot(p,t):lt.call(p,t):new d(w(t))}),ye(m!==Function.prototype?j(d).concat(j(m)):j(d),function(e){e in p||f(p,e,d[e])}),p.prototype=y,y.constructor=p);var _=y[Ve],E=!!_&&("values"==_.name||null==_.name),T=yt.values;f(p,Ge,!0),f(y,Ze,l),f(y,Je,!0),f(y,Xe,p),(s?new p(1)[qe]==l:qe in y)||ne(y,qe,{get:function(){return l}}),v[l]=p,n(n.G+n.W+n.F*(p!=d),v),n(n.S,l,{BYTES_PER_ELEMENT:r}),n(n.S+n.F*i(function(){d.of.call(p,1)}),l,{from:lt,of:ct}),"BYTES_PER_ELEMENT"in y||f(y,"BYTES_PER_ELEMENT",r),n(n.P,l,mt),J(l),n(n.P+n.F*et,l,{set:vt}),n(n.P+n.F*!E,l,yt),y.toString!=Ie&&(y.toString=Ie),n(n.P+n.F*i(function(){new p(1).slice()}),l,{slice:gt}),n(n.P+n.F*(i(function(){return[1,2].toLocaleString()!=new p([1,2]).toLocaleString()})||!i(function(){y.toLocaleString.call([1,2])})),l,{toLocaleString:dt}),Q[l]=E?_:T,E||f(y,Ve,T)}}else e.exports=function(){}});mt("Int8",1,function(e){return function(t,i,r){return e(this,t,i,r)}}),mt("Uint8",1,function(e){return function(t,i,r){return e(this,t,i,r)}}),mt("Uint8",1,function(e){return function(t,i,r){return e(this,t,i,r)}},!0),mt("Int16",2,function(e){return function(t,i,r){return e(this,t,i,r)}}),mt("Uint16",2,function(e){return function(t,i,r){return e(this,t,i,r)}}),mt("Int32",4,function(e){return function(t,i,r){return e(this,t,i,r)}}),mt("Uint32",4,function(e){return function(t,i,r){return e(this,t,i,r)}}),mt("Float32",4,function(e){return function(t,i,r){return e(this,t,i,r)}}),mt("Float64",8,function(e){return function(t,i,r){return e(this,t,i,r)}});var gt=function(e,t,i,r){try{return r?t(a(i)[0],i[1]):t(i)}catch(t){var n=e.return;throw void 0!==n&&a(n.call(e)),t}},vt=i(function(e){var t={},i={},r=e.exports=function(e,r,n,o,s){var l,c,u,h,p=s?function(){return e}:We(e),d=R(n,o,r?2:1),f=0;if("function"!=typeof p)throw TypeError(e+" is not iterable!");if(Le(p)){for(l=q(e.length);l>f;f++)if((h=r?d(a(c=e[f])[0],c[1]):d(e[f]))===t||h===i)return h}else for(u=p.call(e);!(c=u.next()).done;)if((h=gt(u,d,c.value,r))===t||h===i)return h};r.BREAK=t,r.RETURN=i}),yt=i(function(e){var t=E("meta"),i=m.f,r=0,n=Object.isExtensible||function(){return!0},a=!s(function(){return n(Object.preventExtensions({}))}),l=function(e){i(e,t,{value:{i:"O"+ ++r,w:{}}})},c=e.exports={KEY:t,NEED:!1,fastKey:function(e,i){if(!o(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!b(e,t)){if(!n(e))return"F";if(!i)return"E";l(e)}return e[t].i},getWeak:function(e,i){if(!b(e,t)){if(!n(e))return!0;if(!i)return!1;l(e)}return e[t].w},onFreeze:function(e){return a&&c.NEED&&n(e)&&!b(e,t)&&l(e),e}}}),bt=function(e,t){if(!o(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e},_t=m.f,xt=yt.fastKey,Et=l?"_s":"size",wt=function(e,t){var i,r=xt(t);if("F"!==r)return e._i[r];for(i=e._f;i;i=i.n)if(i.k==t)return i},Tt={getConstructor:function(e,t,i,r){var n=e(function(e,o){I(e,n,t,"_i"),e._t=t,e._i=Ne(null),e._f=void 0,e._l=void 0,e[Et]=0,null!=o&&vt(o,i,e[r],e)});return B(n.prototype,{clear:function(){for(var e=bt(this,t),i=e._i,r=e._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete i[r.i];e._f=e._l=void 0,e[Et]=0},delete:function(e){var i=bt(this,t),r=wt(i,e);if(r){var n=r.n,o=r.p;delete i._i[r.i],r.r=!0,o&&(o.n=n),n&&(n.p=o),i._f==r&&(i._f=n),i._l==r&&(i._l=o),i[Et]--}return!!r},forEach:function(e){bt(this,t);for(var i,r=R(e,arguments.length>1?arguments[1]:void 0,3);i=i?i.n:this._f;)for(r(i.v,i.k,this);i&&i.r;)i=i.p},has:function(e){return!!wt(bt(this,t),e)}}),l&&_t(n.prototype,"size",{get:function(){return bt(this,t)[Et]}}),n},def:function(e,t,i){var r,n,o=wt(e,t);return o?o.v=i:(e._l=o={i:n=xt(t,!0),k:t,v:i,p:r=e._l,n:void 0,r:!1},e._f||(e._f=o),r&&(r.n=o),e[Et]++,"F"!==n&&(e._i[n]=o)),e},getEntry:wt,setStrong:function(e,t,i){ot(e,t,function(e,i){this._t=bt(e,t),this._k=i,this._l=void 0},function(){for(var e=this._k,t=this._l;t&&t.r;)t=t.p;return this._t&&(this._l=t=t?t.n:this._t._f)?$e(0,"keys"==e?t.k:"values"==e?t.v:[t.k,t.v]):(this._t=void 0,$e(1))},i?"entries":"values",!i,!0),be(t)}},St=function(e,t){if(a(e),!o(t)&&null!==t)throw TypeError(t+": can't set as prototype!")},Mt={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,i){try{(i=R(Function.call,ft.f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,r){return St(e,r),t?e.__proto__=r:i(e,r),e}}({},!1):void 0),check:St},Rt=Mt.set,Pt=function(e,t,i,n,a,l){var c=r[e],u=c,h=a?"set":"add",p=u&&u.prototype,d={},f=function(e){var t=p[e];S(p,e,"delete"==e?function(e){return!(l&&!o(e))&&t.call(this,0===e?0:e)}:"has"==e?function(e){return!(l&&!o(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return l&&!o(e)?void 0:t.call(this,0===e?0:e)}:"add"==e?function(e){return t.call(this,0===e?0:e),this}:function(e,i){return t.call(this,0===e?0:e,i),this})};if("function"==typeof u&&(l||p.forEach&&!s(function(){(new u).entries().next()}))){var m=new u,g=m[h](l?{}:-0,1)!=m,v=s(function(){m.has(1)}),y=ut(function(e){new u(e)}),b=!l&&s(function(){for(var e=new u,t=5;t--;)e[h](t,t);return!e.has(-0)});y||((u=t(function(t,i){I(t,u,e);var r=function(e,t,i){var r,n=t.constructor;return n!==i&&"function"==typeof n&&(r=n.prototype)!==i.prototype&&o(r)&&Rt&&Rt(e,r),e}(new c,t,u);return null!=i&&vt(i,a,r[h],r),r})).prototype=p,p.constructor=u),(v||b)&&(f("delete"),f("has"),a&&f("get")),(b||g)&&f(h),l&&p.clear&&delete p.clear}else u=n.getConstructor(t,e,a,h),B(u.prototype,i),yt.NEED=!0;return fe(u,e),d[e]=u,C(C.G+C.W+C.F*(u!=c),d),l||n.setStrong(u,e,a),u},At=(Pt("Map",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{get:function(e){var t=Tt.getEntry(bt(this,"Map"),e);return t&&t.v},set:function(e,t){return Tt.def(bt(this,"Map"),0===e?0:e,t)}},Tt,!0),Pt("Set",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{add:function(e){return Tt.def(bt(this,"Set"),e=0===e?0:e,e)}},Tt),{f:Object.getOwnPropertySymbols}),Ct=Object.assign,Ot=!Ct||s(function(){var e={},t={},i=Symbol(),r="abcdefghijklmnopqrst";return e[i]=7,r.split("").forEach(function(e){t[e]=e}),7!=Ct({},e)[i]||Object.keys(Ct({},t)).join("")!=r})?function(e,t){for(var i=ce(e),r=arguments.length,n=1,o=At.f,a=pt.f;r>n;)for(var s,l=Y(arguments[n++]),c=o?ke(l).concat(o(l)):ke(l),u=c.length,h=0;u>h;)a.call(l,s=c[h++])&&(i[s]=l[s]);return i}:Ct,Lt=yt.getWeak,kt=Qe(5),Ht=Qe(6),jt=0,Ft=function(e){return e._l||(e._l=new Dt)},Dt=function(){this.a=[]},Bt=function(e,t){return kt(e.a,function(e){return e[0]===t})};Dt.prototype={get:function(e){var t=Bt(this,e);if(t)return t[1]},has:function(e){return!!Bt(this,e)},set:function(e,t){var i=Bt(this,e);i?i[1]=t:this.a.push([e,t])},delete:function(e){var t=Ht(this.a,function(t){return t[0]===e});return~t&&this.a.splice(t,1),!!~t}};var It={getConstructor:function(e,t,i,r){var n=e(function(e,o){I(e,n,t,"_i"),e._t=t,e._i=jt++,e._l=void 0,null!=o&&vt(o,i,e[r],e)});return B(n.prototype,{delete:function(e){if(!o(e))return!1;var i=Lt(e);return!0===i?Ft(bt(this,t)).delete(e):i&&b(i,this._i)&&delete i[this._i]},has:function(e){if(!o(e))return!1;var i=Lt(e);return!0===i?Ft(bt(this,t)).has(e):i&&b(i,this._i)}}),n},def:function(e,t,i){var r=Lt(a(t),!0);return!0===r?Ft(e).set(t,i):r[e._i]=i,e},ufstore:Ft};i(function(e){var t,i=Qe(0),n=bt,a=!r.ActiveXObject&&"ActiveXObject"in r,s=yt.getWeak,l=Object.isExtensible,c=It.ufstore,u=function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},h={get:function(e){if(o(e)){var t=s(e);return!0===t?c(bt(this,"WeakMap")).get(e):t?t[this._i]:void 0}},set:function(e,t){return It.def(bt(this,"WeakMap"),e,t)}},p=e.exports=Pt("WeakMap",u,h,It,!0,!0);n&&a&&(t=It.getConstructor(u,"WeakMap"),Ot(t.prototype,h),yt.NEED=!0,i(["delete","has","get","set"],function(e){var i=p.prototype,r=i[e];S(i,e,function(i,n){if(o(i)&&!l(i)){this._f||(this._f=new t);var a=this._f[e](i,n);return"set"==e?this:a}return r.call(this,i,n)})}))});Pt("WeakSet",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{add:function(e){return It.def(bt(this,"WeakSet"),e,!0)}},It,!1,!0);var Nt=(r.Reflect||{}).apply,Ut=Function.apply;C(C.S+C.F*!s(function(){Nt(function(){})}),"Reflect",{apply:function(e,t,i){var r=M(e),n=a(i);return Nt?Nt(r,t,n):Ut.call(r,t,n)}});var Vt=function(e,t,i){var r=void 0===i;switch(t.length){case 0:return r?e():e.call(i);case 1:return r?e(t[0]):e.call(i,t[0]);case 2:return r?e(t[0],t[1]):e.call(i,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(i,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(i,t[0],t[1],t[2],t[3])}return e.apply(i,t)},zt=[].slice,qt={},Wt=function(e,t,i){if(!(t in qt)){for(var r=[],n=0;n<t;n++)r[n]="a["+n+"]";qt[t]=Function("F,a","return new F("+r.join(",")+")")}return qt[t](e,i)},Gt=Function.bind||function(e){var t=M(this),i=zt.call(arguments,1),r=function(){var n=i.concat(zt.call(arguments));return this instanceof r?Wt(t,n.length,n):Vt(t,n,e)};return o(t.prototype)&&(r.prototype=t.prototype),r},Xt=(r.Reflect||{}).construct,Yt=s(function(){function e(){}return!(Xt(function(){},[],e)instanceof e)}),Qt=!s(function(){Xt(function(){})});C(C.S+C.F*(Yt||Qt),"Reflect",{construct:function(e,t){M(e),a(t);var i=arguments.length<3?e:M(arguments[2]);if(Qt&&!Yt)return Xt(e,t,i);if(e==i){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var r=[null];return r.push.apply(r,t),new(Gt.apply(e,r))}var n=i.prototype,s=Ne(o(n)?n:Object.prototype),l=Function.apply.call(e,s,t);return o(l)?l:s}}),C(C.S+C.F*s(function(){Reflect.defineProperty(m.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function(e,t,i){a(e),t=d(t,!0),a(i);try{return m.f(e,t,i),!0}catch(e){return!1}}});var Zt=ft.f;C(C.S,"Reflect",{deleteProperty:function(e,t){var i=Zt(a(e),t);return!(i&&!i.configurable)&&delete e[t]}}),C(C.S,"Reflect",{get:function e(t,i){var r,n,s=arguments.length<3?t:arguments[2];return a(t)===s?t[i]:(r=ft.f(t,i))?b(r,"value")?r.value:void 0!==r.get?r.get.call(s):void 0:o(n=ze(t))?e(n,i,s):void 0}}),C(C.S,"Reflect",{getOwnPropertyDescriptor:function(e,t){return ft.f(a(e),t)}}),C(C.S,"Reflect",{getPrototypeOf:function(e){return ze(a(e))}}),C(C.S,"Reflect",{has:function(e,t){return t in e}});var Jt=Object.isExtensible;C(C.S,"Reflect",{isExtensible:function(e){return a(e),!Jt||Jt(e)}});var Kt=r.Reflect,$t=Kt&&Kt.ownKeys||function(e){var t=le.f(a(e)),i=At.f;return i?t.concat(i(e)):t};C(C.S,"Reflect",{ownKeys:$t});var ei=Object.preventExtensions;C(C.S,"Reflect",{preventExtensions:function(e){a(e);try{return ei&&ei(e),!0}catch(e){return!1}}}),C(C.S,"Reflect",{set:function e(t,i,r){var n,s,l=arguments.length<4?t:arguments[3],c=ft.f(a(t),i);if(!c){if(o(s=ze(t)))return e(s,i,r,l);c=g(0)}if(b(c,"value")){if(!1===c.writable||!o(l))return!1;if(n=ft.f(l,i)){if(n.get||n.set||!1===n.writable)return!1;n.value=r,m.f(l,i,n)}else m.f(l,i,g(0,r));return!0}return void 0!==c.set&&(c.set.call(l,r),!0)}}),Mt&&C(C.S,"Reflect",{setPrototypeOf:function(e,t){Mt.check(e,t);try{return Mt.set(e,t),!0}catch(e){return!1}}});var ti,ii,ri,ni=r.process,oi=r.setImmediate,ai=r.clearImmediate,si=r.MessageChannel,li=r.Dispatch,ci=0,ui={},hi=function(){var e=+this;if(ui.hasOwnProperty(e)){var t=ui[e];delete ui[e],t()}},pi=function(e){hi.call(e.data)};oi&&ai||(oi=function(e){for(var t=[],i=1;arguments.length>i;)t.push(arguments[i++]);return ui[++ci]=function(){Vt("function"==typeof e?e:Function(e),t)},ti(ci),ci},ai=function(e){delete ui[e]},"process"==X(ni)?ti=function(e){ni.nextTick(R(hi,e,1))}:li&&li.now?ti=function(e){li.now(R(hi,e,1))}:si?(ri=(ii=new si).port2,ii.port1.onmessage=pi,ti=R(ri.postMessage,ri,1)):r.addEventListener&&"function"==typeof postMessage&&!r.importScripts?(ti=function(e){r.postMessage(e+"","*")},r.addEventListener("message",pi,!1)):ti="onreadystatechange"in h("script")?function(e){Fe.appendChild(h("script")).onreadystatechange=function(){Fe.removeChild(this),hi.call(e)}}:function(e){setTimeout(R(hi,e,1),0)});var di={set:oi,clear:ai},fi=di.set,mi=r.MutationObserver||r.WebKitMutationObserver,gi=r.process,vi=r.Promise,yi="process"==X(gi);function bi(e){var t,i;this.promise=new e(function(e,r){if(void 0!==t||void 0!==i)throw TypeError("Bad Promise constructor");t=e,i=r}),this.resolve=M(t),this.reject=M(i)}var _i,xi,Ei,wi,Ti={f:function(e){return new bi(e)}},Si=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}},Mi=r.navigator,Ri=Mi&&Mi.userAgent||"",Pi=di.set,Ai=function(){var e,t,i,n=function(){var r,n;for(yi&&(r=gi.domain)&&r.exit();e;){n=e.fn,e=e.next;try{n()}catch(r){throw e?i():t=void 0,r}}t=void 0,r&&r.enter()};if(yi)i=function(){gi.nextTick(n)};else if(!mi||r.navigator&&r.navigator.standalone)if(vi&&vi.resolve){var o=vi.resolve(void 0);i=function(){o.then(n)}}else i=function(){fi.call(r,n)};else{var a=!0,s=document.createTextNode("");new mi(n).observe(s,{characterData:!0}),i=function(){s.data=a=!a}}return function(r){var n={fn:r,next:void 0};t&&(t.next=n),e||(e=n,i()),t=n}}(),Ci=r.TypeError,Oi=r.process,Li=Oi&&Oi.versions,ki=Li&&Li.v8||"",Hi=r.Promise,ji="process"==Pe(Oi),Fi=function(){},Di=xi=Ti.f,Bi=!!function(){try{var e=Hi.resolve(1),t=(e.constructor={})[he("species")]=function(e){e(Fi,Fi)};return(ji||"function"==typeof PromiseRejectionEvent)&&e.then(Fi)instanceof t&&0!==ki.indexOf("6.6")&&-1===Ri.indexOf("Chrome/66")}catch(e){}}(),Ii=function(e){var t;return!(!o(e)||"function"!=typeof(t=e.then))&&t},Ni=function(e,t){if(!e._n){e._n=!0;var i=e._c;Ai(function(){for(var r=e._v,n=1==e._s,o=0,a=function(t){var i,o,a,s=n?t.ok:t.fail,l=t.resolve,c=t.reject,u=t.domain;try{s?(n||(2==e._h&&zi(e),e._h=1),!0===s?i=r:(u&&u.enter(),i=s(r),u&&(u.exit(),a=!0)),i===t.promise?c(Ci("Promise-chain cycle")):(o=Ii(i))?o.call(i,l,c):l(i)):c(r)}catch(e){u&&!a&&u.exit(),c(e)}};i.length>o;)a(i[o++]);e._c=[],e._n=!1,t&&!e._h&&Ui(e)})}},Ui=function(e){Pi.call(r,function(){var t,i,n,o=e._v,a=Vi(e);if(a&&(t=Si(function(){ji?Oi.emit("unhandledRejection",o,e):(i=r.onunhandledrejection)?i({promise:e,reason:o}):(n=r.console)&&n.error&&n.error("Unhandled promise rejection",o)}),e._h=ji||Vi(e)?2:1),e._a=void 0,a&&t.e)throw t.v})},Vi=function(e){return 1!==e._h&&0===(e._a||e._c).length},zi=function(e){Pi.call(r,function(){var t;ji?Oi.emit("rejectionHandled",e):(t=r.onrejectionhandled)&&t({promise:e,reason:e._v})})},qi=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),Ni(t,!0))},Wi=function(e){var t,i=this;if(!i._d){i._d=!0,i=i._w||i;try{if(i===e)throw Ci("Promise can't be resolved itself");(t=Ii(e))?Ai(function(){var r={_w:i,_d:!1};try{t.call(e,R(Wi,r,1),R(qi,r,1))}catch(e){qi.call(r,e)}}):(i._v=e,i._s=1,Ni(i,!1))}catch(e){qi.call({_w:i,_d:!1},e)}}};Bi||(Hi=function(e){I(this,Hi,"Promise","_h"),M(e),_i.call(this);try{e(R(Wi,this,1),R(qi,this,1))}catch(e){qi.call(this,e)}},(_i=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=B(Hi.prototype,{then:function(e,t){var i=Di(ve(this,Hi));return i.ok="function"!=typeof e||e,i.fail="function"==typeof t&&t,i.domain=ji?Oi.domain:void 0,this._c.push(i),this._a&&this._a.push(i),this._s&&Ni(this,!1),i.promise},catch:function(e){return this.then(void 0,e)}}),Ei=function(){var e=new _i;this.promise=e,this.resolve=R(Wi,e,1),this.reject=R(qi,e,1)},Ti.f=Di=function(e){return e===Hi||e===wi?new Ei(e):xi(e)}),C(C.G+C.W+C.F*!Bi,{Promise:Hi}),fe(Hi,"Promise"),be("Promise"),wi=n.Promise,C(C.S+C.F*!Bi,"Promise",{reject:function(e){var t=Di(this);return(0,t.reject)(e),t.promise}}),C(C.S+C.F*!Bi,"Promise",{resolve:function(e){return function(e,t){if(a(e),o(t)&&t.constructor===e)return t;var i=Ti.f(e);return(0,i.resolve)(t),i.promise}(this,e)}}),C(C.S+C.F*!(Bi&&ut(function(e){Hi.all(e).catch(Fi)})),"Promise",{all:function(e){var t=this,i=Di(t),r=i.resolve,n=i.reject,o=Si(function(){var i=[],o=0,a=1;vt(e,!1,function(e){var s=o++,l=!1;i.push(void 0),a++,t.resolve(e).then(function(e){l||(l=!0,i[s]=e,--a||r(i))},n)}),--a||r(i)});return o.e&&n(o.v),i.promise},race:function(e){var t=this,i=Di(t),r=i.reject,n=Si(function(){vt(e,!1,function(e){t.resolve(e).then(i.resolve,r)})});return n.e&&r(n.v),i.promise}});var Gi={f:he},Xi=m.f,Yi=function(e){var t=n.Symbol||(n.Symbol=r.Symbol||{});"_"==e.charAt(0)||e in t||Xi(t,e,{value:Gi.f(e)})},Qi=le.f,Zi={}.toString,Ji="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Ki={f:function(e){return Ji&&"[object Window]"==Zi.call(e)?function(e){try{return Qi(e)}catch(e){return Ji.slice()}}(e):Qi(Z(e))}},$i=yt.KEY,er=ft.f,tr=m.f,ir=Ki.f,rr=r.Symbol,nr=r.JSON,or=nr&&nr.stringify,ar=he("_hidden"),sr=he("toPrimitive"),lr={}.propertyIsEnumerable,cr=w("symbol-registry"),ur=w("symbols"),hr=w("op-symbols"),pr=Object.prototype,dr="function"==typeof rr,fr=r.QObject,mr=!fr||!fr.prototype||!fr.prototype.findChild,gr=l&&s(function(){return 7!=Ne(tr({},"a",{get:function(){return tr(this,"a",{value:7}).a}})).a})?function(e,t,i){var r=er(pr,t);r&&delete pr[t],tr(e,t,i),r&&e!==pr&&tr(pr,t,r)}:tr,vr=function(e){var t=ur[e]=Ne(rr.prototype);return t._k=e,t},yr=dr&&"symbol"==typeof rr.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof rr},br=function(e,t,i){return e===pr&&br(hr,t,i),a(e),t=d(t,!0),a(i),b(ur,t)?(i.enumerable?(b(e,ar)&&e[ar][t]&&(e[ar][t]=!1),i=Ne(i,{enumerable:g(0,!1)})):(b(e,ar)||tr(e,ar,g(1,{})),e[ar][t]=!0),gr(e,t,i)):tr(e,t,i)},_r=function(e,t){a(e);for(var i,r=function(e){var t=ke(e),i=At.f;if(i)for(var r,n=i(e),o=pt.f,a=0;n.length>a;)o.call(e,r=n[a++])&&t.push(r);return t}(t=Z(t)),n=0,o=r.length;o>n;)br(e,i=r[n++],t[i]);return e},xr=function(e){var t=lr.call(this,e=d(e,!0));return!(this===pr&&b(ur,e)&&!b(hr,e))&&(!(t||!b(this,e)||!b(ur,e)||b(this,ar)&&this[ar][e])||t)},Er=function(e,t){if(e=Z(e),t=d(t,!0),e!==pr||!b(ur,t)||b(hr,t)){var i=er(e,t);return!i||!b(ur,t)||b(e,ar)&&e[ar][t]||(i.enumerable=!0),i}},wr=function(e){for(var t,i=ir(Z(e)),r=[],n=0;i.length>n;)b(ur,t=i[n++])||t==ar||t==$i||r.push(t);return r},Tr=function(e){for(var t,i=e===pr,r=ir(i?hr:Z(e)),n=[],o=0;r.length>o;)!b(ur,t=r[o++])||i&&!b(pr,t)||n.push(ur[t]);return n};dr||(S((rr=function(){if(this instanceof rr)throw TypeError("Symbol is not a constructor!");var e=E(arguments.length>0?arguments[0]:void 0),t=function(i){this===pr&&t.call(hr,i),b(this,ar)&&b(this[ar],e)&&(this[ar][e]=!1),gr(this,e,g(1,i))};return l&&mr&&gr(pr,e,{configurable:!0,set:t}),vr(e)}).prototype,"toString",function(){return this._k}),ft.f=Er,m.f=br,le.f=Ki.f=wr,pt.f=xr,At.f=Tr,l&&S(pr,"propertyIsEnumerable",xr,!0),Gi.f=function(e){return vr(he(e))}),C(C.G+C.W+C.F*!dr,{Symbol:rr});for(var Sr="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),Mr=0;Sr.length>Mr;)he(Sr[Mr++]);for(var Rr=ke(he.store),Pr=0;Rr.length>Pr;)Yi(Rr[Pr++]);C(C.S+C.F*!dr,"Symbol",{for:function(e){return b(cr,e+="")?cr[e]:cr[e]=rr(e)},keyFor:function(e){if(!yr(e))throw TypeError(e+" is not a symbol!");for(var t in cr)if(cr[t]===e)return t},useSetter:function(){mr=!0},useSimple:function(){mr=!1}}),C(C.S+C.F*!dr,"Object",{create:function(e,t){return void 0===t?Ne(e):_r(Ne(e),t)},defineProperty:br,defineProperties:_r,getOwnPropertyDescriptor:Er,getOwnPropertyNames:wr,getOwnPropertySymbols:Tr}),nr&&C(C.S+C.F*(!dr||s(function(){var e=rr();return"[null]"!=or([e])||"{}"!=or({a:e})||"{}"!=or(Object(e))})),"JSON",{stringify:function(e){for(var t,i,r=[e],n=1;arguments.length>n;)r.push(arguments[n++]);if(i=t=r[1],(o(t)||void 0!==e)&&!yr(e))return Ge(t)||(t=function(e,t){if("function"==typeof i&&(t=i.call(this,e,t)),!yr(t))return t}),r[1]=t,or.apply(nr,r)}}),rr.prototype[sr]||v(rr.prototype,sr,rr.prototype.valueOf),fe(rr,"Symbol"),fe(Math,"Math",!0),fe(r.JSON,"JSON",!0);var Ar=function(e,t){var i=(n.Object||{})[e]||Object[e],r={};r[e]=t(i),C(C.S+C.F*s(function(){i(1)}),"Object",r)},Cr=yt.onFreeze;Ar("freeze",function(e){return function(t){return e&&o(t)?e(Cr(t)):t}});var Or=yt.onFreeze;Ar("seal",function(e){return function(t){return e&&o(t)?e(Or(t)):t}});var Lr=yt.onFreeze;Ar("preventExtensions",function(e){return function(t){return e&&o(t)?e(Lr(t)):t}}),Ar("isFrozen",function(e){return function(t){return!o(t)||!!e&&e(t)}}),Ar("isSealed",function(e){return function(t){return!o(t)||!!e&&e(t)}}),Ar("isExtensible",function(e){return function(t){return!!o(t)&&(!e||e(t))}});var kr=ft.f;Ar("getOwnPropertyDescriptor",function(){return function(e,t){return kr(Z(e),t)}}),Ar("getPrototypeOf",function(){return function(e){return ze(ce(e))}}),Ar("keys",function(){return function(e){return ke(ce(e))}}),Ar("getOwnPropertyNames",function(){return Ki.f}),C(C.S+C.F,"Object",{assign:Ot});var Hr=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t};C(C.S,"Object",{is:Hr}),C(C.S,"Object",{setPrototypeOf:Mt.set});var jr=m.f,Fr=Function.prototype,Dr=/^\s*function ([^ (]*)/;"name"in Fr||l&&jr(Fr,"name",{configurable:!0,get:function(){try{return(""+this).match(Dr)[1]}catch(e){return""}}}),C(C.S,"String",{raw:function(e){for(var t=Z(e.raw),i=q(t.length),r=arguments.length,n=[],o=0;i>o;)n.push(String(t[o++])),o<r&&n.push(String(arguments[o]));return n.join("")}});var Br=String.fromCharCode,Ir=String.fromCodePoint;C(C.S+C.F*(!!Ir&&1!=Ir.length),"String",{fromCodePoint:function(e){for(var t,i=[],r=arguments.length,n=0;r>n;){if(t=+arguments[n++],$(t,1114111)!==t)throw RangeError(t+" is not a valid code point");i.push(t<65536?Br(t):Br(55296+((t-=65536)>>10),t%1024+56320))}return i.join("")}});var Nr=function(e){return function(t,i){var r,n,o=String(Q(t)),a=V(i),s=o.length;return a<0||a>=s?e?"":void 0:(r=o.charCodeAt(a))<55296||r>56319||a+1===s||(n=o.charCodeAt(a+1))<56320||n>57343?e?o.charAt(a):r:e?o.slice(a,a+2):n-56320+(r-55296<<10)+65536}},Ur=Nr(!1);C(C.P,"String",{codePointAt:function(e){return Ur(this,e)}});var Vr=function(e){var t=String(Q(this)),i="",r=V(e);if(r<0||r==1/0)throw RangeError("Count can't be negative");for(;r>0;(r>>>=1)&&(t+=t))1&r&&(i+=t);return i};C(C.P,"String",{repeat:Vr});var zr=he("match"),qr=function(e){var t;return o(e)&&(void 0!==(t=e[zr])?!!t:"RegExp"==X(e))},Wr=function(e,t,i){if(qr(t))throw TypeError("String#"+i+" doesn't accept regex!");return String(Q(e))},Gr=he("match"),Xr=function(e){var t=/./;try{"/./"[e](t)}catch(i){try{return t[Gr]=!1,!"/./"[e](t)}catch(e){}}return!0},Yr="".startsWith;C(C.P+C.F*Xr("startsWith"),"String",{startsWith:function(e){var t=Wr(this,e,"startsWith"),i=q(Math.min(arguments.length>1?arguments[1]:void 0,t.length)),r=String(e);return Yr?Yr.call(t,r,i):t.slice(i,i+r.length)===r}});var Qr="".endsWith;C(C.P+C.F*Xr("endsWith"),"String",{endsWith:function(e){var t=Wr(this,e,"endsWith"),i=arguments.length>1?arguments[1]:void 0,r=q(t.length),n=void 0===i?r:Math.min(q(i),r),o=String(e);return Qr?Qr.call(t,o,n):t.slice(n-o.length,n)===o}});C(C.P+C.F*Xr("includes"),"String",{includes:function(e){return!!~Wr(this,e,"includes").indexOf(e,arguments.length>1?arguments[1]:void 0)}});var Zr=function(){var e=a(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t};l&&"g"!=/./g.flags&&m.f(RegExp.prototype,"flags",{configurable:!0,get:Zr});var Jr,Kr,$r=Nr(!0),en=function(e,t,i){return t+(i?$r(e,t).length:1)},tn=RegExp.prototype.exec,rn=function(e,t){var i=e.exec;if("function"==typeof i){var r=i.call(e,t);if("object"!=typeof r)throw new TypeError("RegExp exec method returned something other than an Object or null");return r}if("RegExp"!==Pe(e))throw new TypeError("RegExp#exec called on incompatible receiver");return tn.call(e,t)},nn=RegExp.prototype.exec,on=String.prototype.replace,an=nn,sn=(Jr=/a/,Kr=/b*/g,nn.call(Jr,"a"),nn.call(Kr,"a"),0!==Jr.lastIndex||0!==Kr.lastIndex),ln=void 0!==/()??/.exec("")[1];(sn||ln)&&(an=function(e){var t,i,r,n,o=this;return ln&&(i=new RegExp("^"+o.source+"$(?!\\s)",Zr.call(o))),sn&&(t=o.lastIndex),r=nn.call(o,e),sn&&r&&(o.lastIndex=o.global?r.index+r[0].length:t),ln&&r&&r.length>1&&on.call(r[0],i,function(){for(n=1;n<arguments.length-2;n++)void 0===arguments[n]&&(r[n]=void 0)}),r});var cn=an;C({target:"RegExp",proto:!0,forced:cn!==/./.exec},{exec:cn});var un=he("species"),hn=!s(function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}),pn=function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var i="ab".split(e);return 2===i.length&&"a"===i[0]&&"b"===i[1]}(),dn=function(e,t,i){var r=he(e),n=!s(function(){var t={};return t[r]=function(){return 7},7!=""[e](t)}),o=n?!s(function(){var t=!1,i=/a/;return i.exec=function(){return t=!0,null},"split"===e&&(i.constructor={},i.constructor[un]=function(){return i}),i[r](""),!t}):void 0;if(!n||!o||"replace"===e&&!hn||"split"===e&&!pn){var a=/./[r],l=i(Q,r,""[e],function(e,t,i,r,o){return t.exec===cn?n&&!o?{done:!0,value:a.call(t,i,r)}:{done:!0,value:e.call(i,t,r)}:{done:!1}}),c=l[0],u=l[1];S(String.prototype,e,c),v(RegExp.prototype,r,2==t?function(e,t){return u.call(e,this,t)}:function(e){return u.call(e,this)})}};dn("match",1,function(e,t,i,r){return[function(i){var r=e(this),n=null==i?void 0:i[t];return void 0!==n?n.call(i,r):new RegExp(i)[t](String(r))},function(e){var t=r(i,e,this);if(t.done)return t.value;var n=a(e),o=String(this);if(!n.global)return rn(n,o);var s=n.unicode;n.lastIndex=0;for(var l,c=[],u=0;null!==(l=rn(n,o));){var h=String(l[0]);c[u]=h,""===h&&(n.lastIndex=en(o,q(n.lastIndex),s)),u++}return 0===u?null:c}]});var fn=Math.max,mn=Math.min,gn=Math.floor,vn=/\$([$&`']|\d\d?|<[^>]*>)/g,yn=/\$([$&`']|\d\d?)/g;dn("replace",2,function(e,t,i,r){return[function(r,n){var o=e(this),a=null==r?void 0:r[t];return void 0!==a?a.call(r,o,n):i.call(String(o),r,n)},function(e,t){var o=r(i,e,this,t);if(o.done)return o.value;var s=a(e),l=String(this),c="function"==typeof t;c||(t=String(t));var u=s.global;if(u){var h=s.unicode;s.lastIndex=0}for(var p=[];;){var d=rn(s,l);if(null===d)break;if(p.push(d),!u)break;""===String(d[0])&&(s.lastIndex=en(l,q(s.lastIndex),h))}for(var f,m="",g=0,v=0;v<p.length;v++){d=p[v];for(var y=String(d[0]),b=fn(mn(V(d.index),l.length),0),_=[],x=1;x<d.length;x++)_.push(void 0===(f=d[x])?f:String(f));var E=d.groups;if(c){var w=[y].concat(_,b,l);void 0!==E&&w.push(E);var T=String(t.apply(void 0,w))}else T=n(y,l,b,_,E,t);b>=g&&(m+=l.slice(g,b)+T,g=b+y.length)}return m+l.slice(g)}];function n(e,t,r,n,o,a){var s=r+e.length,l=n.length,c=yn;return void 0!==o&&(o=ce(o),c=vn),i.call(a,c,function(i,a){var c;switch(a.charAt(0)){case"$":return"$";case"&":return e;case"`":return t.slice(0,r);case"'":return t.slice(s);case"<":c=o[a.slice(1,-1)];break;default:var u=+a;if(0===u)return i;if(u>l){var h=gn(u/10);return 0===h?i:h<=l?void 0===n[h-1]?a.charAt(1):n[h-1]+a.charAt(1):i}c=n[u-1]}return void 0===c?"":c})}});var bn=Math.min,_n=[].push,xn=!s(function(){RegExp(4294967295,"y")});dn("split",2,function(e,t,i,r){var n;return n="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,t){var r=String(this);if(void 0===e&&0===t)return[];if(!qr(e))return i.call(r,e,t);for(var n,o,a,s=[],l=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),c=0,u=void 0===t?4294967295:t>>>0,h=new RegExp(e.source,l+"g");(n=cn.call(h,r))&&!((o=h.lastIndex)>c&&(s.push(r.slice(c,n.index)),n.length>1&&n.index<r.length&&_n.apply(s,n.slice(1)),a=n[0].length,c=o,s.length>=u));)h.lastIndex===n.index&&h.lastIndex++;return c===r.length?!a&&h.test("")||s.push(""):s.push(r.slice(c)),s.length>u?s.slice(0,u):s}:"0".split(void 0,0).length?function(e,t){return void 0===e&&0===t?[]:i.call(this,e,t)}:i,[function(i,r){var o=e(this),a=null==i?void 0:i[t];return void 0!==a?a.call(i,o,r):n.call(String(o),i,r)},function(e,t){var o=r(n,e,this,t,n!==i);if(o.done)return o.value;var s=a(e),l=String(this),c=ve(s,RegExp),u=s.unicode,h=(s.ignoreCase?"i":"")+(s.multiline?"m":"")+(s.unicode?"u":"")+(xn?"y":"g"),p=new c(xn?s:"^(?:"+s.source+")",h),d=void 0===t?4294967295:t>>>0;if(0===d)return[];if(0===l.length)return null===rn(p,l)?[l]:[];for(var f=0,m=0,g=[];m<l.length;){p.lastIndex=xn?m:0;var v,y=rn(p,xn?l:l.slice(m));if(null===y||(v=bn(q(p.lastIndex+(xn?0:m)),l.length))===f)m=en(l,m,u);else{if(g.push(l.slice(f,m)),g.length===d)return g;for(var b=1;b<=y.length-1;b++)if(g.push(y[b]),g.length===d)return g;m=f=v}}return g.push(l.slice(f)),g}]}),dn("search",1,function(e,t,i,r){return[function(i){var r=e(this),n=null==i?void 0:i[t];return void 0!==n?n.call(i,r):new RegExp(i)[t](String(r))},function(e){var t=r(i,e,this);if(t.done)return t.value;var n=a(e),o=String(this),s=n.lastIndex;Hr(s,0)||(n.lastIndex=0);var l=rn(n,o);return Hr(n.lastIndex,s)||(n.lastIndex=s),null===l?-1:l.index}]});var En=function(e,t,i){t in e?m.f(e,t,g(0,i)):e[t]=i};C(C.S+C.F*!ut(function(e){Array.from(e)}),"Array",{from:function(e){var t,i,r,n,o=ce(e),a="function"==typeof this?this:Array,s=arguments.length,l=s>1?arguments[1]:void 0,c=void 0!==l,u=0,h=We(o);if(c&&(l=R(l,s>2?arguments[2]:void 0,2)),null==h||a==Array&&Le(h))for(i=new a(t=q(o.length));t>u;u++)En(i,u,c?l(o[u],u):o[u]);else for(n=h.call(o),i=new a;!(r=n.next()).done;u++)En(i,u,c?gt(n,l,[r.value,u],!0):r.value);return i.length=u,i}}),C(C.S+C.F*s(function(){function e(){}return!(Array.of.call(e)instanceof e)}),"Array",{of:function(){for(var e=0,t=arguments.length,i=new("function"==typeof this?this:Array)(t);t>e;)En(i,e,arguments[e++]);return i.length=t,i}}),C(C.P,"Array",{copyWithin:ht}),Ke("copyWithin");var wn=Qe(5),Tn=!0;"find"in[]&&Array(1).find(function(){Tn=!1}),C(C.P+C.F*Tn,"Array",{find:function(e){return wn(this,e,arguments.length>1?arguments[1]:void 0)}}),Ke("find");var Sn=Qe(6),Mn=!0;"findIndex"in[]&&Array(1).findIndex(function(){Mn=!1}),C(C.P+C.F*Mn,"Array",{findIndex:function(e){return Sn(this,e,arguments.length>1?arguments[1]:void 0)}}),Ke("findIndex"),C(C.P,"Array",{fill:ue}),Ke("fill");var Rn=r.isFinite;C(C.S,"Number",{isFinite:function(e){return"number"==typeof e&&Rn(e)}});var Pn=Math.floor,An=function(e){return!o(e)&&isFinite(e)&&Pn(e)===e};C(C.S,"Number",{isInteger:An});var Cn=Math.abs;C(C.S,"Number",{isSafeInteger:function(e){return An(e)&&Cn(e)<=9007199254740991}}),C(C.S,"Number",{isNaN:function(e){return e!=e}}),C(C.S,"Number",{EPSILON:Math.pow(2,-52)}),C(C.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991}),C(C.S,"Number",{MAX_SAFE_INTEGER:9007199254740991});var On=Math.log1p||function(e){return(e=+e)>-1e-8&&e<1e-8?e-e*e/2:Math.log(1+e)},Ln=Math.sqrt,kn=Math.acosh;C(C.S+C.F*!(kn&&710==Math.floor(kn(Number.MAX_VALUE))&&kn(1/0)==1/0),"Math",{acosh:function(e){return(e=+e)<1?NaN:e>94906265.62425156?Math.log(e)+Math.LN2:On(e-1+Ln(e-1)*Ln(e+1))}});var Hn=Math.asinh;C(C.S+C.F*!(Hn&&1/Hn(0)>0),"Math",{asinh:function e(t){return isFinite(t=+t)&&0!=t?t<0?-e(-t):Math.log(t+Math.sqrt(t*t+1)):t}});var jn=Math.atanh;C(C.S+C.F*!(jn&&1/jn(-0)<0),"Math",{atanh:function(e){return 0==(e=+e)?e:Math.log((1+e)/(1-e))/2}});var Fn=Math.sign||function(e){return 0==(e=+e)||e!=e?e:e<0?-1:1};C(C.S,"Math",{cbrt:function(e){return Fn(e=+e)*Math.pow(Math.abs(e),1/3)}}),C(C.S,"Math",{clz32:function(e){return(e>>>=0)?31-Math.floor(Math.log(e+.5)*Math.LOG2E):32}});var Dn=Math.exp;C(C.S,"Math",{cosh:function(e){return(Dn(e=+e)+Dn(-e))/2}});var Bn=Math.expm1,In=!Bn||Bn(10)>22025.465794806718||Bn(10)<22025.465794806718||-2e-17!=Bn(-2e-17)?function(e){return 0==(e=+e)?e:e>-1e-6&&e<1e-6?e+e*e/2:Math.exp(e)-1}:Bn;C(C.S+C.F*(In!=Math.expm1),"Math",{expm1:In});var Nn=Math.pow,Un=Nn(2,-52),Vn=Nn(2,-23),zn=Nn(2,127)*(2-Vn),qn=Nn(2,-126),Wn=Math.fround||function(e){var t,i,r=Math.abs(e),n=Fn(e);return r<qn?n*(r/qn/Vn+1/Un-1/Un)*qn*Vn:(i=(t=(1+Vn/Un)*r)-(t-r))>zn||i!=i?n*(1/0):n*i};C(C.S,"Math",{fround:Wn});var Gn=Math.abs;C(C.S,"Math",{hypot:function(e,t){for(var i,r,n=0,o=0,a=arguments.length,s=0;o<a;)s<(i=Gn(arguments[o++]))?(n=n*(r=s/i)*r+1,s=i):n+=i>0?(r=i/s)*r:i;return s===1/0?1/0:s*Math.sqrt(n)}});var Xn=Math.imul;C(C.S+C.F*s(function(){return-5!=Xn(4294967295,5)||2!=Xn.length}),"Math",{imul:function(e,t){var i=+e,r=+t,n=65535&i,o=65535&r;return 0|n*o+((65535&i>>>16)*o+n*(65535&r>>>16)<<16>>>0)}}),C(C.S,"Math",{log1p:On}),C(C.S,"Math",{log10:function(e){return Math.log(e)*Math.LOG10E}}),C(C.S,"Math",{log2:function(e){return Math.log(e)/Math.LN2}}),C(C.S,"Math",{sign:Fn});var Yn=Math.exp;C(C.S+C.F*s(function(){return-2e-17!=!Math.sinh(-2e-17)}),"Math",{sinh:function(e){return Math.abs(e=+e)<1?(In(e)-In(-e))/2:(Yn(e-1)-Yn(-e-1))*(Math.E/2)}});var Qn=Math.exp;C(C.S,"Math",{tanh:function(e){var t=In(e=+e),i=In(-e);return t==1/0?1:i==1/0?-1:(t-i)/(Qn(e)+Qn(-e))}}),C(C.S,"Math",{trunc:function(e){return(e>0?Math.floor:Math.ceil)(e)}});var Zn=ee(!0);C(C.P,"Array",{includes:function(e){return Zn(this,e,arguments.length>1?arguments[1]:void 0)}}),Ke("includes");var Jn=pt.f,Kn=function(e){return function(t){for(var i,r=Z(t),n=ke(r),o=n.length,a=0,s=[];o>a;)Jn.call(r,i=n[a++])&&s.push(e?[i,r[i]]:r[i]);return s}},$n=Kn(!1);C(C.S,"Object",{values:function(e){return $n(e)}});var eo=Kn(!0);C(C.S,"Object",{entries:function(e){return eo(e)}}),C(C.S,"Object",{getOwnPropertyDescriptors:function(e){for(var t,i,r=Z(e),n=ft.f,o=$t(r),a={},s=0;o.length>s;)void 0!==(i=n(r,t=o[s++]))&&En(a,t,i);return a}});var to=function(e,t,i,r){var n=String(Q(e)),o=n.length,a=void 0===i?" ":String(i),s=q(t);if(s<=o||""==a)return n;var l=s-o,c=Vr.call(a,Math.ceil(l/a.length));return c.length>l&&(c=c.slice(0,l)),r?c+n:n+c},io=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(Ri);C(C.P+C.F*io,"String",{padStart:function(e){return to(this,e,arguments.length>1?arguments[1]:void 0,!0)}});var ro=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(Ri);C(C.P+C.F*ro,"String",{padEnd:function(e){return to(this,e,arguments.length>1?arguments[1]:void 0,!1)}});var no=[].slice,oo=/MSIE .\./.test(Ri),ao=function(e){return function(t,i){var r=arguments.length>2,n=!!r&&no.call(arguments,2);return e(r?function(){("function"==typeof t?t:Function(t)).apply(this,n)}:t,i)}};C(C.G+C.B+C.F*oo,{setTimeout:ao(r.setTimeout),setInterval:ao(r.setInterval)}),C(C.G+C.B,{setImmediate:di.set,clearImmediate:di.clear});for(var so=he("iterator"),lo=he("toStringTag"),co=Ae.Array,uo={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},ho=ke(uo),po=0;po<ho.length;po++){var fo,mo=ho[po],go=uo[mo],vo=r[mo],yo=vo&&vo.prototype;if(yo&&(yo[so]||v(yo,so,co),yo[lo]||v(yo,lo,mo),Ae[mo]=co,go))for(fo in at)yo[fo]||S(yo,fo,at[fo],!0)}i(function(e){!function(t){var i,r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag",c=t.regeneratorRuntime;if(c)e.exports=c;else{(c=t.regeneratorRuntime=e.exports).wrap=b;var u="suspendedStart",h="suspendedYield",p="executing",d="completed",f={},m={};m[a]=function(){return this};var g=Object.getPrototypeOf,v=g&&g(g(C([])));v&&v!==r&&n.call(v,a)&&(m=v);var y=w.prototype=x.prototype=Object.create(m);E.prototype=y.constructor=w,w.constructor=E,w[l]=E.displayName="GeneratorFunction",c.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===E||"GeneratorFunction"===(t.displayName||t.name))},c.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,l in e||(e[l]="GeneratorFunction")),e.prototype=Object.create(y),e},c.awrap=function(e){return{__await:e}},T(S.prototype),S.prototype[s]=function(){return this},c.AsyncIterator=S,c.async=function(e,t,i,r){var n=new S(b(e,t,i,r));return c.isGeneratorFunction(t)?n:n.next().then(function(e){return e.done?e.value:n.next()})},T(y),y[l]="Generator",y[a]=function(){return this},y.toString=function(){return"[object Generator]"},c.keys=function(e){var t=[];for(var i in e)t.push(i);return t.reverse(),function i(){for(;t.length;){var r=t.pop();if(r in e)return i.value=r,i.done=!1,i}return i.done=!0,i}},c.values=C,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=i,this.done=!1,this.delegate=null,this.method="next",this.arg=i,this.tryEntries.forEach(P),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=i)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,n){return s.type="throw",s.arg=e,t.next=r,n&&(t.method="next",t.arg=i),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var l=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(l&&c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,f):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),P(i),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var r=i.completion;if("throw"===r.type){var n=r.arg;P(i)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:C(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=i),f}}}function b(e,t,i,r){var n=t&&t.prototype instanceof x?t:x,o=Object.create(n.prototype),a=new A(r||[]);return o._invoke=function(e,t,i){var r=u;return function(n,o){if(r===p)throw new Error("Generator is already running");if(r===d){if("throw"===n)throw o;return O()}for(i.method=n,i.arg=o;;){var a=i.delegate;if(a){var s=M(a,i);if(s){if(s===f)continue;return s}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(r===u)throw r=d,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r=p;var l=_(e,t,i);if("normal"===l.type){if(r=i.done?d:h,l.arg===f)continue;return{value:l.arg,done:i.done}}"throw"===l.type&&(r=d,i.method="throw",i.arg=l.arg)}}}(e,i,a),o}function _(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(e){return{type:"throw",arg:e}}}function x(){}function E(){}function w(){}function T(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function S(e){function i(t,r,o,a){var s=_(e[t],e,r);if("throw"!==s.type){var l=s.arg,c=l.value;return c&&"object"==typeof c&&n.call(c,"__await")?Promise.resolve(c.__await).then(function(e){i("next",e,o,a)},function(e){i("throw",e,o,a)}):Promise.resolve(c).then(function(e){l.value=e,o(l)},a)}a(s.arg)}var r;"object"==typeof t.process&&t.process.domain&&(i=t.process.domain.bind(i)),this._invoke=function(e,t){function n(){return new Promise(function(r,n){i(e,t,r,n)})}return r=r?r.then(n,n):n()}}function M(e,t){var r=e.iterator[t.method];if(r===i){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=i,M(e,t),"throw"===t.method))return f;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var n=_(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,f;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=i),t.delegate=null,f):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,f)}function R(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(R,this),this.reset(!0)}function C(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=i,t.done=!0,t};return o.next=o}}return{next:O}}function O(){return{value:i,done:!0}}}("object"==typeof t?t:"object"==typeof window?window:"object"==typeof self?self:t)});var bo=i(function(e){!function(t){var i,r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag",c=t.regeneratorRuntime;if(c)e.exports=c;else{(c=t.regeneratorRuntime=e.exports).wrap=b;var u="suspendedStart",h="suspendedYield",p="executing",d="completed",f={},m={};m[a]=function(){return this};var g=Object.getPrototypeOf,v=g&&g(g(C([])));v&&v!==r&&n.call(v,a)&&(m=v);var y=w.prototype=x.prototype=Object.create(m);E.prototype=y.constructor=w,w.constructor=E,w[l]=E.displayName="GeneratorFunction",c.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===E||"GeneratorFunction"===(t.displayName||t.name))},c.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,l in e||(e[l]="GeneratorFunction")),e.prototype=Object.create(y),e},c.awrap=function(e){return{__await:e}},T(S.prototype),S.prototype[s]=function(){return this},c.AsyncIterator=S,c.async=function(e,t,i,r){var n=new S(b(e,t,i,r));return c.isGeneratorFunction(t)?n:n.next().then(function(e){return e.done?e.value:n.next()})},T(y),y[l]="Generator",y[a]=function(){return this},y.toString=function(){return"[object Generator]"},c.keys=function(e){var t=[];for(var i in e)t.push(i);return t.reverse(),function i(){for(;t.length;){var r=t.pop();if(r in e)return i.value=r,i.done=!1,i}return i.done=!0,i}},c.values=C,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=i,this.done=!1,this.delegate=null,this.method="next",this.arg=i,this.tryEntries.forEach(P),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=i)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,n){return s.type="throw",s.arg=e,t.next=r,n&&(t.method="next",t.arg=i),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var l=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(l&&c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,f):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),P(i),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var r=i.completion;if("throw"===r.type){var n=r.arg;P(i)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:C(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=i),f}}}function b(e,t,i,r){var n=t&&t.prototype instanceof x?t:x,o=Object.create(n.prototype),a=new A(r||[]);return o._invoke=function(e,t,i){var r=u;return function(n,o){if(r===p)throw new Error("Generator is already running");if(r===d){if("throw"===n)throw o;return O()}for(i.method=n,i.arg=o;;){var a=i.delegate;if(a){var s=M(a,i);if(s){if(s===f)continue;return s}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(r===u)throw r=d,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r=p;var l=_(e,t,i);if("normal"===l.type){if(r=i.done?d:h,l.arg===f)continue;return{value:l.arg,done:i.done}}"throw"===l.type&&(r=d,i.method="throw",i.arg=l.arg)}}}(e,i,a),o}function _(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(e){return{type:"throw",arg:e}}}function x(){}function E(){}function w(){}function T(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function S(e){var t;this._invoke=function(i,r){function o(){return new Promise(function(t,o){!function t(i,r,o,a){var s=_(e[i],e,r);if("throw"!==s.type){var l=s.arg,c=l.value;return c&&"object"==typeof c&&n.call(c,"__await")?Promise.resolve(c.__await).then(function(e){t("next",e,o,a)},function(e){t("throw",e,o,a)}):Promise.resolve(c).then(function(e){l.value=e,o(l)},a)}a(s.arg)}(i,r,t,o)})}return t=t?t.then(o,o):o()}}function M(e,t){var r=e.iterator[t.method];if(r===i){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=i,M(e,t),"throw"===t.method))return f;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var n=_(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,f;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=i),t.delegate=null,f):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,f)}function R(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(R,this),this.reset(!0)}function C(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=i,t.done=!0,t};return o.next=o}}return{next:O}}function O(){return{value:i,done:!0}}}(function(){return this}()||Function("return this")())}),_o=function(){return this}()||Function("return this")(),xo=_o.regeneratorRuntime&&Object.getOwnPropertyNames(_o).indexOf("regeneratorRuntime")>=0,Eo=xo&&_o.regeneratorRuntime;_o.regeneratorRuntime=void 0;var wo=bo;if(xo)_o.regeneratorRuntime=Eo;else try{delete _o.regeneratorRuntime}catch(e){_o.regeneratorRuntime=void 0}var To=wo,So="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Mo=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Ro=function e(t,i,r,n){Mo(this,e),this.positionArray=t.geometry.getAttribute("position").array.slice();var o=t.geometry.getAttribute("normal");o?this.normalArray=o.array.slice():console.warn("not has normal");var a=t.geometry.getAttribute("uv");a&&(this.uvArray=a.array);var s=t.geometry.getAttribute("uv2");s&&(this.uv2Array=s.array);var l=t.geometry.getAttribute("uv3");l&&(this.uv3Array=l.array);var c=t.geometry.getAttribute("color");c&&(this.colorArray=c.array),this.indexArray=t.geometry.index.array,this.material=t.material;for(var u=this.positionArray,h=this.normalArray,p=0;p<u.length;){for(var d=n.length-1;d>-1;d--){var f=i[d],m=r[d],g=n[d];u[p]*=f.x,u[p+1]*=f.y,u[p+2]*=f.z;var v=new THREE.Vector3(u[p],u[p+1],u[p+2]);if((v=v.applyQuaternion(m)).x+=g.x,v.y+=g.y,v.z+=g.z,u[p]=v.x,u[p+1]=v.y,u[p+2]=v.z,h){var y=new THREE.Vector3(h[p],h[p+1],h[p+2]);y=y.applyQuaternion(m),h[p]=y.x,h[p+1]=y.y,h[p+2]=y.z}}p+=3}this.vertexCount=this.positionArray.length/3,this.indexCount=this.indexArray.length,this.groups=t.geometry.groups},Po=function(){function e(t){Mo(this,e),this.bundeObj=t,this.materialMap=new Map,this.combineBundleMeshs=[]}return e.prototype.combine=function(){this._combine(this.bundeObj,[],[],[])},e.prototype._combine=function(e,t,i,r){if(t.push(e.scale),r.push(e.position),i.push(e.quaternion),e instanceof THREE.Mesh){var n=new Ro(e,t,i,r);this.combineBundleMeshs.push(n),void 0===this.materialMap.get(n.material)&&this.materialMap.set(n.material,[]),this.materialMap.get(n.material).push(n)}if(0!=e.children.length)for(var o=0;o<e.children.length;o++){var a=i.slice(),s=t.slice(),l=r.slice();this._combine(e.children[o],s,a,l)}},e}(),Ao=function e(){Mo(this,e),this.positions=[],this.scales=[],this.quaternions=[]},Co=function(){function e(){Mo(this,e)}return e.equalVectorZero=function(e){return 0===e.x&&0===e.y&&0===e.z},e.clone=function(e){var t=e.clone(),i={};e.traverse(function(e){e.isSkinnedMesh&&(i[e.name]=e)});var r={},n={};t.traverse(function(e){e.isBone&&(r[e.name]=e),e.isSkinnedMesh&&(n[e.name]=e)});var o=!1;for(var a in i){o=!0;for(var s=i[a].skeleton,l=n[a],c=[],u=0;u<s.bones.length;++u){var h=r[s.bones[u].name];c.push(h)}l.bind(new THREE.Skeleton(c,s.boneInverses),l.matrixWorld)}return t.hasSkin=!!o,t},e.cloneJSObject=function(t){if(null===t||"object"!==(void 0===t?"undefined":So(t)))return t;if(t instanceof Date)return(i=new Date).setTime(t.getTime()),i;if(t instanceof Array|t instanceof Object){var i=t instanceof Array?[]:{};for(var r in t)t.hasOwnProperty(r)&&(i[r]=e.cloneJSObject(t[r]));return i}throw new Error("Unable to clone obj! Its type isn't supported.")},e}(),Oo=function(){function e(t){Mo(this,e),this.vertexCount=0,this.indexCount=0,this.material=t,this.bundeMeshs=[],this.transformations=[],this.maxCount=6e4,this.combineMesh=null}return e.prototype.cloneGroups=function(e){for(var t=[],i=0;i<e.length;i++){var r=e[i];t.push(Co.cloneJSObject(r))}return t},e.prototype.isExceed=function(e){return this.vertexCount+e>this.maxCount},e.prototype.add=function(e,t){if(this.isExceed(e.vertexCount))return console.error("combine exceed vertex count "),!1;this.vertexCount+=e.vertexCount,this.indexCount+=e.indexCount,this.bundeMeshs.push(e),this.transformations.push(t)},e.prototype.build=function(){for(var e=this.bundeMeshs,t=this.indexCount,i=this.vertexCount,r=[],n=new Float32Array(3*i),o=new Float32Array(3*i),a=new Float32Array(2*i),s=new Float32Array(4*i),l=new Float32Array(2*i),c=new Uint16Array(t),u=0,h=0,p=0,d=0,f=0,m=new THREE.BufferGeometry,g=0,v=0;v<e.length;v++){var y=e[v],b=this.transformations[v],_=b.positions,x=b.scales,E=b.quaternions,w=y.indexArray;if(y.groups.length>0){var T=this.cloneGroups(y.groups);T.forEach(function(e){e.start+=g}),r=r.concat(T)}g+=w.length;for(var S=0;S<w.length;S++)c[S+d]=u/3+w[S];d+=w.length;var M=y.positionArray;for(S=0;S<M.length;){for(var R=new THREE.Vector3(M[S],M[S+1],M[S+2]),P=_.length-1;P>-1;P--){var A=_[P],C=x[P],O=E[P];R.x*=C.x,R.y*=C.y,R.z*=C.z,(R=R.applyQuaternion(O)).x+=A.x,R.y+=A.y,R.z+=A.z}n[S+u]=R.x,n[S+u+1]=R.y,n[S+u+2]=R.z,S+=3}u+=M.length;var L=y.normalArray;for(S=0;S<L.length;S++)o[S+h]=L[S];h+=L.length;var k=y.uvArray;if(k)for(S=0;S<k.length;S++)a[S+p]=k[S];var H=y.uv2Array;if(H)for(S=0;S<H.length;S++)l[S+p]=H[S];k&&(p+=k.length);var j=y.colorArray;if(j){for(S=0;S<j.length;S++)s[S+f]=j[S];f+=j.length}}m.addAttribute("position",new THREE.BufferAttribute(n,3)),m.addAttribute("normal",new THREE.BufferAttribute(o,3)),m.addAttribute("uv",new THREE.BufferAttribute(a,2)),0!==l.length&&m.addAttribute("uv2",new THREE.BufferAttribute(l,2)),0!==s.length&&m.addAttribute("color",new THREE.BufferAttribute(s,4)),m.setIndex(new THREE.BufferAttribute(c,1)),m.groups=r;var F=new THREE.Mesh(m,this.material);F.name="combine",this.combineMesh=F},e}(),Lo=function(){function e(){Mo(this,e),this.combineBundleObjectMap={},this.processorMap=new Map,this.packageMaterialMap=new Map,this.processors=[],this.defaultKey="default",this.loadSpeed=.1,this.combineMeshs=[]}return e.prototype.generateUUID=function(){var e,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=new Array(36),r=0;return function(){for(var n=0;n<36;n++)8===n||13===n||18===n||23===n?i[n]="-":14===n?i[n]="4":(r<=2&&(r=33554432+16777216*Math.random()|0),e=15&r,r>>=4,i[n]=t[19===n?3&e|8:e]);return i.join("")}()},e.prototype.combineModel=function(e,t){if(!this.combineBundleObjectMap[e]){var i=t.position.clone(),r=t.scale.clone(),n=t.quaternion.clone();t.position.set(0,0,0),t.scale.set(1,1,1),t.quaternion.set(0,0,0,1);var o=new Po(t);this.combineBundleObjectMap[e]=o,o.combine(),t.position.set(i.x,i.y,i.z),t.scale.set(r.x,r.y,r.z),t.quaternion.set(n.x,n.y,n.z,n.w)}},e.prototype._nestingLoopYield=function(e,t,i){var r=this,n=e.next();if(n.done)return t&&t(),n.value;var o=n.value;n.done;o instanceof Promise?o.then(function(n){return r._nestingLoopYield(e,t,i)}).catch(function(e){i(e)}):this._nestingLoopYield(e,t,i)},e.prototype.delayBuild=function(e){var t=To.mark(r),i=this;function r(r){var n,o,a,s,l,c,u,h,p;return To.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=i.loadSpeed,o=10,a=r.keys(),s=Array.isArray(a),l=0,a=s?a:a[Symbol.iterator]();case 3:if(!s){t.next=9;break}if(!(l>=a.length)){t.next=6;break}return t.abrupt("break",24);case 6:c=a[l++],t.next=13;break;case 9:if(!(l=a.next()).done){t.next=12;break}return t.abrupt("break",24);case 12:c=l.value;case 13:u=c,h=r.get(u),p=0;case 16:if(!(p<h.length)){t.next=22;break}return t.next=19,new Promise(function(t,r){var a=performance.now();h[p].build();var s=h[p].combineMesh;e&&e(s),i.combineMeshs.push(s),performance.now()-a>n?setTimeout(function(){t()},o):t()});case 19:p++,t.next=16;break;case 22:t.next=3;break;case 24:case"end":return t.stop()}},t,this)}return new Promise(function(e,t){var n=r(i.processorMap);n?i._nestingLoopYield(n,function(){e()},function(e){t(e)}):e()})},e.prototype.build=function(){var e=this.processorMap.keys(),t=Array.isArray(e),i=0;for(e=t?e:e[Symbol.iterator]();;){var r;if(t){if(i>=e.length)break;r=e[i++]}else{if((i=e.next()).done)break;r=i.value}for(var n=r,o=this.processorMap.get(n),a=0;a<o.length;a++)o[a].build(),this.combineMeshs.push(o[a].combineMesh)}},e.prototype.addModel=function(e,t){var i=null,r=this.defaultKey;t&&(t.modelLibID&&(i=t.modelLibID),t.packageKey&&(r=t.packageKey)),i||(i=this.generateUUID()),this.combineModel(i,e);var n=this.packageMaterialMap.get(r);n||(n=new Map,this.packageMaterialMap.set(r,n));var o=this.processorMap.get(r);o||(this.processorMap.set(r,[]),o=this.processorMap.get(r));var a=new Ao;a.positions=[e.position],a.scales=[e.scale],a.quaternions=[e.quaternion],this.combineBundleObjectMap[i].materialMap.forEach(function(e,t,i){for(var r=e,s=t,l=0;l<r.length;l++){var c=r[l],u=n.get(s);u&&!u.isExceed(c.vertexCount)||(u=new Oo(s),n.set(s,u),o.push(u)),u.add(c,a)}})},e}();e.Processor=Lo,Object.defineProperty(e,"__esModule",{value:!0})}),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).EarCut=e()}}(function(){return function e(t,i,r){function n(a,s){if(!i[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var u=i[a]={exports:{}};t[a][0].call(u.exports,function(e){return n(t[a][1][e]||e)},u,u.exports,e,t,i,r)}return i[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)n(r[a]);return n}({1:[function(e,t,i){"use strict";function r(e,t,i){i=i||2;var r,s,l,c,u,d,m,g=t&&t.length,v=g?t[0]*i:e.length,y=n(e,0,v,i,!0),b=[];if(!y||y.next===y.prev)return b;if(g&&(y=function(e,t,i,r){var a,s,l,c,u,d=[];for(a=0,s=t.length;a<s;a++)l=t[a]*r,c=a<s-1?t[a+1]*r:e.length,(u=n(e,l,c,r,!1))===u.next&&(u.steiner=!0),d.push(f(u));for(d.sort(h),a=0;a<d.length;a++)p(d[a],i),i=o(i,i.next);return i}(e,t,y,i)),e.length>80*i){r=l=e[0],s=c=e[1];for(var _=i;_<v;_+=i)(u=e[_])<r&&(r=u),(d=e[_+1])<s&&(s=d),u>l&&(l=u),d>c&&(c=d);m=0!==(m=Math.max(l-r,c-s))?1/m:0}return a(y,b,i,r,s,m),b}function n(e,t,i,r,n){var o,a;if(n===S(e,t,i,r)>0)for(o=t;o<i;o+=r)a=E(o,e[o],e[o+1],a);else for(o=i-r;o>=t;o-=r)a=E(o,e[o],e[o+1],a);return a&&y(a,a.next)&&(w(a),a=a.next),a}function o(e,t){if(!e)return e;t||(t=e);var i,r=e;do{if(i=!1,r.steiner||!y(r,r.next)&&0!==v(r.prev,r,r.next))r=r.next;else{if(w(r),(r=t=r.prev)===r.next)break;i=!0}}while(i||r!==t);return t}function a(e,t,i,r,n,h,p){if(e){!p&&h&&function(e,t,i,r){var n=e;do{null===n.z&&(n.z=d(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,function(e){var t,i,r,n,o,a,s,l,c=1;do{for(i=e,e=null,o=null,a=0;i;){for(a++,r=i,s=0,t=0;t<c&&(s++,r=r.nextZ);t++);for(l=c;s>0||l>0&&r;)0!==s&&(0===l||!r||i.z<=r.z)?(n=i,i=i.nextZ,s--):(n=r,r=r.nextZ,l--),o?o.nextZ=n:e=n,n.prevZ=o,o=n;i=r}o.nextZ=null,c*=2}while(a>1)}(n)}(e,r,n,h);for(var f,m,g=e;e.prev!==e.next;)if(f=e.prev,m=e.next,h?l(e,r,n,h):s(e))t.push(f.i/i),t.push(e.i/i),t.push(m.i/i),w(e),e=m.next,g=m.next;else if((e=m)===g){p?1===p?a(e=c(e,t,i),t,i,r,n,h,2):2===p&&u(e,t,i,r,n,h):a(o(e),t,i,r,n,h,1);break}}}function s(e){var t=e.prev,i=e,r=e.next;if(v(t,i,r)>=0)return!1;for(var n=e.next.next;n!==e.prev;){if(m(t.x,t.y,i.x,i.y,r.x,r.y,n.x,n.y)&&v(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function l(e,t,i,r){var n=e.prev,o=e,a=e.next;if(v(n,o,a)>=0)return!1;for(var s=n.x<o.x?n.x<a.x?n.x:a.x:o.x<a.x?o.x:a.x,l=n.y<o.y?n.y<a.y?n.y:a.y:o.y<a.y?o.y:a.y,c=n.x>o.x?n.x>a.x?n.x:a.x:o.x>a.x?o.x:a.x,u=n.y>o.y?n.y>a.y?n.y:a.y:o.y>a.y?o.y:a.y,h=d(s,l,t,i,r),p=d(c,u,t,i,r),f=e.prevZ,g=e.nextZ;f&&f.z>=h&&g&&g.z<=p;){if(f!==e.prev&&f!==e.next&&m(n.x,n.y,o.x,o.y,a.x,a.y,f.x,f.y)&&v(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,g!==e.prev&&g!==e.next&&m(n.x,n.y,o.x,o.y,a.x,a.y,g.x,g.y)&&v(g.prev,g,g.next)>=0)return!1;g=g.nextZ}for(;f&&f.z>=h;){if(f!==e.prev&&f!==e.next&&m(n.x,n.y,o.x,o.y,a.x,a.y,f.x,f.y)&&v(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;g&&g.z<=p;){if(g!==e.prev&&g!==e.next&&m(n.x,n.y,o.x,o.y,a.x,a.y,g.x,g.y)&&v(g.prev,g,g.next)>=0)return!1;g=g.nextZ}return!0}function c(e,t,i){var r=e;do{var n=r.prev,o=r.next.next;!y(n,o)&&b(n,r,r.next,o)&&_(n,o)&&_(o,n)&&(t.push(n.i/i),t.push(r.i/i),t.push(o.i/i),w(r),w(r.next),r=e=o),r=r.next}while(r!==e);return r}function u(e,t,i,r,n,s){var l=e;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&g(l,c)){var u=x(l,c);return l=o(l,l.next),u=o(u,u.next),a(l,t,i,r,n,s),void a(u,t,i,r,n,s)}c=c.next}l=l.next}while(l!==e)}function h(e,t){return e.x-t.x}function p(e,t){if(t=function(e,t){var i,r=t,n=e.x,o=e.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=n&&s>a){if(a=s,s===n){if(o===r.y)return r;if(o===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!i)return null;if(n===a)return i.prev;var l,c=i,u=i.x,h=i.y,p=1/0;r=i.next;for(;r!==c;)n>=r.x&&r.x>=u&&n!==r.x&&m(o<h?n:a,o,u,h,o<h?a:n,o,r.x,r.y)&&((l=Math.abs(o-r.y)/(n-r.x))<p||l===p&&r.x>i.x)&&_(r,e)&&(i=r,p=l),r=r.next;return i}(e,t)){var i=x(t,e);o(i,i.next)}}function d(e,t,i,r,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function f(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function m(e,t,i,r,n,o,a,s){return(n-a)*(t-s)-(e-a)*(o-s)>=0&&(e-a)*(r-s)-(i-a)*(t-s)>=0&&(i-a)*(o-s)-(n-a)*(r-s)>=0}function g(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&b(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&_(e,t)&&_(t,e)&&function(e,t){var i=e,r=!1,n=(e.x+t.x)/2,o=(e.y+t.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==e);return r}(e,t)}function v(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function y(e,t){return e.x===t.x&&e.y===t.y}function b(e,t,i,r){return!!(y(e,i)&&y(t,r)||y(e,r)&&y(i,t))||v(e,t,i)>0!=v(e,t,r)>0&&v(i,r,e)>0!=v(i,r,t)>0}function _(e,t){return v(e.prev,e,e.next)<0?v(e,t,e.next)>=0&&v(e,e.prev,t)>=0:v(e,t,e.prev)<0||v(e,e.next,t)<0}function x(e,t){var i=new T(e.i,e.x,e.y),r=new T(t.i,t.x,t.y),n=e.next,o=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,o.next=r,r.prev=o,r}function E(e,t,i,r){var n=new T(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function w(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function T(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function S(e,t,i,r){for(var n=0,o=t,a=i-r;o<i;o+=r)n+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return n}t.exports=r,t.exports.default=r,r.deviation=function(e,t,i,r){var n=t&&t.length,o=n?t[0]*i:e.length,a=Math.abs(S(e,0,o,i));if(n)for(var s=0,l=t.length;s<l;s++){var c=t[s]*i,u=s<l-1?t[s+1]*i:e.length;a-=Math.abs(S(e,c,u,i))}var h=0;for(s=0;s<r.length;s+=3){var p=r[s]*i,d=r[s+1]*i,f=r[s+2]*i;h+=Math.abs((e[p]-e[f])*(e[d+1]-e[p+1])-(e[p]-e[d])*(e[f+1]-e[p+1]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},r.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},r=0,n=0;n<e.length;n++){for(var o=0;o<e[n].length;o++)for(var a=0;a<t;a++)i.vertices.push(e[n][o][a]);n>0&&(r+=e[n-1].length,i.holes.push(r))}return i}},{}]},{},[1])(1)});var Graph=function(e){var t=function(e){var t,i=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&i.push(t);return i},i=function(e,t){return parseFloat(e)-parseFloat(t)},r=function(e,r,n,o){o=o||1/0;var a,s={},l={0:[r]},c={},u=function(e,t){var i=""+e;l[i]||(l[i]=[]),l[i].push(t)};for(s[r]=0;l&&(a=t(l)).length;){a.sort(i);var h=a[0],p=l[h],d=p.shift(),f=parseFloat(h),m=e[d]||{};for(var g in p.length||delete l[h],m)if(Object.prototype.hasOwnProperty.call(m,g)){var v=m[g]+f,y=s[g];(void 0===y||y>v)&&(s[g]=v,u(v,g),c[g]=d)}}return void 0===s[n]?null:c},n=function(e,t){for(var i=[],r=t;void 0!==r;)i.push(r),r=e[r];return i.reverse(),i},o=function(e,t){for(var i,o,a,s=t.shift(),l=[];t.length;){if(i=t.shift(),!(o=r(e,s,i)))return null;if(a=n(o,i),!t.length)return l.concat(a);l.push.apply(l,a.slice(0,-1)),s=i}},a=function(e,t){try{return Array.prototype.slice.call(e,t)}catch(o){for(var i=[],r=t||0,n=e.length;r<n;++r)i.push(e[r]);return i}},s=function(e){this.map=e};return s.prototype.findShortestPath=function(e,t){return"[object Array]"===Object.prototype.toString.call(e)?o(this.map,e):2===arguments.length?o(this.map,[e,t]):o(this.map,a(arguments))},s.findShortestPath=function(e,t,i){return"[object Array]"===Object.prototype.toString.call(t)?o(e,t):3===arguments.length?o(e,[t,i]):o(e,a(arguments,1))},s}();THREE.IFCLoader=function(){function e(e,t){this.campus=e,this.manager=void 0!==t?t:THREE.DefaultLoadingManager,this.eventManager=new THREE.EventDispatcher}function t(){return{geometryBuffer:(t={},{get:function(e){return t[e]},delete:function(e){return delete t[e]},add:function(e,i){t[e]=i},getAll:function(){return t},deleteAll:function(){t={}}}),materialBuffer:function(){var e={};return{get:function(t){return e[t]},delete:function(t){return delete e[t]},add:function(t,i){e[t]=i},getAll:function(){return e},deleteAll:function(){e={}}}}(),meshBuffer:function(){var e={};return{get:function(t){return e[t]},delete:function(t){return delete e[t]},add:function(t,i){e[t]=i},getAll:function(){return e},deleteAll:function(){e={}}}}(),instancedBuffer:(e={},{get:function(t){var i=[];for(var r in e)-1!==r.indexOf(t+":")&&i.push(e[r]);return i},getLength:function(){var t=0;for(var i in e)t+=e[i].length;return t},add:function(t,i){e[t]instanceof Array?e[t].push(i):(e[t]=[],e[t].push(i))},remove:function(t){delete e[t]},removeAll:function(){e={}},getAll:function(){return e}})};var e,t}function i(e,i,r,n,o,a){this.json=e||{},this.extensions=o||{},this.options=a||{},this.type=i,this.recursion=r,this.campus=n,this.app=n.app,this.cache=new t,this.nodeInfo={},this.materialInfo={},this.buffer={},this.gData={},this.url=a.url,this.levels=0,this.datas=57,this.loadingLevels=0,this.loadingDatas=0,this.fileLoader=new THREE.FileLoader(this.options.manager),this.eventManager=this.options.eventManager}e.prototype={constructor:e,crossOrigin:"anonymous",type:"",load:function(e,t,i,r){this.url=e;var n,o=this;n=void 0!==this.resourcePath?this.resourcePath:void 0!==this.path?this.path:THREE.LoaderUtils.extractUrlBase(e),n+="index.json",o.manager.itemStart(e);var a=function(t){r?r(t):console.error(t),o.manager.itemError(e),o.manager.itemEnd(e)},s=new THREE.FileLoader(o.manager);s.setPath(this.path),s.load(n,function(i){try{o.parse(i,n,o.type,o.recursion,o.campus,function(i){t(i),o.manager.itemEnd(e)},a)}catch(e){a(e)}},void 0,a),o.eventManager.addEventListener("progress",function(e){i(e.progress)})},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},setType:function(e){return this.type=e,this},setRecursion:function(e){this.recursion=e},setResourcePath:function(e){return this.resourcePath=e,this},parse:function(e,t,r,n,o,a,s){var l;l=e;var c=new i(JSON.parse(l),r,n,o,{},{url:this.url||"",crossOrigin:this.crossOrigin,manager:this.manager,eventManager:this.eventManager});this.parser=c,c.parse(a,s)}},i.prototype.parse=function(e,t){this.pendingRoom=[];var i=this,r=i.fileLoader,n=(this.app,[]);n.push(new Promise(function(e,t){r.load(i.url+"node.json",function(t){i.nodeInfo=JSON.parse(t),i.loadingDatas+=5,i.eventManager.dispatchEvent({type:"progress",progress:.5*i.loadingDatas/i.datas}),e(t)})})),n.push(new Promise(function(e,t){r.load(i.url+"gdata.json",function(t){i.gData=JSON.parse(t),i.loadingDatas++,i.eventManager.dispatchEvent({type:"progress",progress:.5*i.loadingDatas/i.datas}),e(t)})})),n.push(new Promise(function(e,t){r.load(i.url+"material.json",function(t){i.materialInfo=JSON.parse(t),i.loadingDatas++,i.eventManager.dispatchEvent({type:"progress",progress:.5*i.loadingDatas/i.datas}),e(t)})})),n.push(new Promise(function(e,t){r.load(i.url+"buffer.json",function(t){i.buffer=JSON.parse(t),i.loadingDatas+=50,i.eventManager.dispatchEvent({type:"progress",progress:.5*i.loadingDatas/i.datas}),e(t)})})),Promise.all(n).then(function(){setTimeout(function(){i.parseSite(i.campus,!0),Promise.all(i.pendingRoom).then(function(){e(i.campus)})},10)})},i.prototype.parseSite=function(e,t){var i=this.app,r=this.json,n=a("ground",r.i,this.nodeInfo,this.gData,this.buffer,this.materialInfo,this.cache);if(n){var o=i.objectManager.create({type:"Thing",name:"Thing",parent:e});o.name=r.n,o.bimData=r,o.node.name=r.n,o.node.add(n)}t&&this.parseBuilding(e,this.json,t)},i.prototype.parseBuilding=function(e,t,i){var r=t.c,n=this.app;for(var o in r){var s=n.objectManager.create({type:"Building",name:o,parent:e}),l=a("Facade",o,this.nodeInfo,this.gData,this.buffer,this.materialInfo,this.cache);if(l){var c=n.objectManager.create({type:"Facade",name:"Facade",parent:s});c.name=r[o].n,c.bimData=r[o],c.node.name=r[o].n,c.node.add(l)}i&&this.parseBuildingstorey(s,r[o],i)}},i.prototype.parseBuildingstorey=function(e,t,i){var r=this.app,n=t.c;this.levels=Object.keys(n).length;for(var o in n){var a=r.objectManager.create({type:"Floor",name:o,parent:e});i&&this.pendingRoom.push(this.parseRoom(a,n[o],o))}},i.prototype.parseRoom=function(e,t,i){var r=this,o=t.c,s=new THREE.Group;return e.wallNode=s,new Promise(function(t,s){setTimeout(function(){var s=[];for(var l in o){var c=a(n(o[l]),l,r.nodeInfo,r.gData,r.buffer,r.materialInfo,r.cache,i,o[l]);s.push(c)}var u=s;r.loadingLevels++,function(e,t,i){for(var r={},n={},o=0,a=e.length;o<a;o++){var s=e[o];if("Wall"===(l=s._thingType))r[s.material.uuid]||(r[s.material.uuid]=[]),(h=s.geometry.clone()).applyMatrix(s.matrix),r[s.material.uuid].push(h),n[s.material.uuid]=s.material;else if(l){var l,c=i.objectManager.create({type:l,name:o,parent:t});c.name=s.name,c.bimData=s.bimData,(l=c.node).name=s.name,l.add(s)}}for(var u in r){var h=THREE.MergeBufferGeometryUtils.mergeBufferGeometries(r[u]);s=new THREE.Mesh(h,n[u]);t.node.add(s)}}(u,e,r.app),r.eventManager.dispatchEvent({type:"progress",progress:.5+.5*r.loadingLevels/r.levels}),t(u)},0)})};var r={IfcSite:"Campus",IfcBuilding:"Building",IfcBuildingStorey:"Floor",IfcWall:"Wall",IfcBuildingElementProxy:"Thing",IfcRamp:"Thing",IfcStair:"Stair",IfcDoor:"Door",IfcSlab:"Thing",IfcWallStandardCase:"Wall",IfcCurtainWall:"Wall",IfcWindow:"Wall"};function n(e){for(var t in r)if(-1!==e.t.indexOf(t))return r[t];return"Wall"}var o=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,color:new THREE.Color(1,1,1)});function a(e,t,i,r,n,a,l,c,u){var h,p=l.instancedBuffer;if(i[t]){var d=i[t];if(d.g){if((h=function(e,t,i,r,n){var a,l,c=n.materialBuffer,u=n.geometryBuffer,h=u.get(e.g),p=t[e.g],d=[];if(e.m)for(var f=0;f<e.m.length;f++)d.push(s(e.m[f],r,c));if(p){var m=p.c;if(m&&(a=m),!h){var g=p.ii,v=p.iv,y=p.in;(h=new THREE.BufferGeometry).addAttribute("position",new THREE.Float32BufferAttribute(i[v],3)),h.addAttribute("normal",new THREE.Float32BufferAttribute(i[y],3)),h.setIndex(new THREE.Uint32BufferAttribute(i[g],1)),u.add(e.g,h)}if(d.length)l=d[d.length-1];else{a||(a={x:1,y:1,z:1,w:1});var b=function(e){return"default_"+e.x+"_"+e.y+"_"+e.z+"_"+e.w}(a);(l=c.get(b))||((l=o.clone()).color=new THREE.Color(a.x,a.y,a.z),a.w<1&&(l.opacity=a.w,l.transparent=!0),c.add(b,l))}return new THREE.Mesh(h,l)}}(d,r,n,a,l)).name=d.n,h._thingType=e,h.bimData=u,d.tf){var f=d.tf,m=new THREE.Matrix4;f[12]/=1e3,f[13]/=1e3,f[14]/=1e3,m.fromArray(f),h.applyMatrix(m)}if(void 0!==c)return p.add(c+":"+e+":"+d.g,h),h}}else console.log(t+"node");return h}function s(e,t,i){var r=i.get(e);if(!r){var n=t[e];if(!n)return void console.log(e+"");var o=n.type||"MeshPhongMaterial",a=n.parameters;r=new THREE[o]({color:new THREE.Color(a.color[0],a.color[1],a.color[2]),side:a.side,opacity:1-a.transparency,shininess:a.shininess,transparent:!0}),i.add(e,r)}return r}return e}(),THREE.MergeBufferGeometryUtils={computeTangents:function(e){var t=e.index,i=e.attributes;if(null!==t&&void 0!==i.position&&void 0!==i.normal&&void 0!==i.uv){var r=t.array,n=i.position.array,o=i.normal.array,a=i.uv.array,s=n.length/3;void 0===i.tangent&&e.addAttribute("tangent",new THREE.BufferAttribute(new Float32Array(4*s),4));for(var l=i.tangent.array,c=[],u=[],h=0;h<s;h++)c[h]=new THREE.Vector3,u[h]=new THREE.Vector3;var p=new THREE.Vector3,d=new THREE.Vector3,f=new THREE.Vector3,m=new THREE.Vector2,g=new THREE.Vector2,v=new THREE.Vector2,y=new THREE.Vector3,b=new THREE.Vector3,_=e.groups;0===_.length&&(_=[{start:0,count:r.length}]);for(var x=0,E=_.length;x<E;++x)for(var w=k=(L=_[x]).start,T=k+L.count;w<T;w+=3)H(r[w+0],r[w+1],r[w+2]);var S,M,R,P=new THREE.Vector3,A=new THREE.Vector3,C=new THREE.Vector3,O=new THREE.Vector3;for(x=0,E=_.length;x<E;++x){var L,k;for(w=k=(L=_[x]).start,T=k+L.count;w<T;w+=3)j(r[w+0]),j(r[w+1]),j(r[w+2])}}else console.warn("THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");function H(e,t,i){p.fromArray(n,3*e),d.fromArray(n,3*t),f.fromArray(n,3*i),m.fromArray(a,2*e),g.fromArray(a,2*t),v.fromArray(a,2*i);var r=d.x-p.x,o=f.x-p.x,s=d.y-p.y,l=f.y-p.y,h=d.z-p.z,_=f.z-p.z,x=g.x-m.x,E=v.x-m.x,w=g.y-m.y,T=v.y-m.y,S=1/(x*T-E*w);y.set((T*r-w*o)*S,(T*s-w*l)*S,(T*h-w*_)*S),b.set((x*o-E*r)*S,(x*l-E*s)*S,(x*_-E*h)*S),c[e].add(y),c[t].add(y),c[i].add(y),u[e].add(b),u[t].add(b),u[i].add(b)}function j(e){C.fromArray(o,3*e),O.copy(C),M=c[e],P.copy(M),P.sub(C.multiplyScalar(C.dot(M))).normalize(),A.crossVectors(O,M),R=A.dot(u[e]),S=R<0?-1:1,l[4*e]=P.x,l[4*e+1]=P.y,l[4*e+2]=P.z,l[4*e+3]=S}},mergeBufferGeometries:function(e){for(var t=null!==e[0].index,i=new Set(Object.keys(e[0].attributes)),r=new Set(Object.keys(e[0].morphAttributes)),n={},o={},a=new THREE.BufferGeometry,s=0;s<e.length;++s){var l=e[s];if(t!==(null!==l.index))return null;for(var c in l.attributes){if(!i.has(c))return null;void 0===n[c]&&(n[c]=[]),n[c].push(l.attributes[c])}for(var c in l.morphAttributes){if(!r.has(c))return null;void 0===o[c]&&(o[c]=[]),o[c].push(l.morphAttributes[c])}void 0!==l.userData&&(a.userData=a.userData||{},a.userData.mergedUserData=a.userData.mergedUserData||[],a.userData.mergedUserData.push(l.userData))}if(t){var u=0,h=[];for(s=0;s<e.length;++s){var p=e[s].index;if(u>0){p=p.clone();for(var d=0;d<p.count;++d)p.setX(d,p.getX(d)+u)}h.push(p),u+=e[s].attributes.position.count}var f=this.mergeBufferAttributes(h);if(!f)return null;a.index=f}for(var c in n){var m=this.mergeBufferAttributes(n[c]);if(!m)return null;a.addAttribute(c,m)}for(var c in o){var g=o[c][0].length;if(0===g)break;a.morphAttributes=a.morphAttributes||{},a.morphAttributes[c]=[];for(s=0;s<g;++s){var v=[];for(d=0;d<o[c].length;++d)v.push(o[c][d][s]);var y=this.mergeBufferAttributes(v);if(!y)return null;a.morphAttributes[c].push(y)}}return a},mergeBufferAttributes:function(e){for(var t,i,r,n=0,o=0;o<e.length;++o){var a=e[o];if(a.isInterleavedBufferAttribute)return null;if(void 0===t&&(t=a.array.constructor),t!==a.array.constructor)return null;if(void 0===i&&(i=a.itemSize),i!==a.itemSize)return null;if(void 0===r&&(r=a.normalized),r!==a.normalized)return null;n+=a.array.length}for(var s=new t(n),l=0,c=0;c<e.length;++c)s.set(e[c].array,l),l+=e[c].array.length;return new THREE.BufferAttribute(s,i,r)}};var MSPE={distributions:{BOX:1,SPHERE:2,DISC:3},valueOverLifetimeLength:4};function SimpleHeatmap(e){this._canvas="string"==typeof e?document.getElementById(e):e,void 0===this._canvas&&(this._canvas=document.createElement("canvas"),this._canvas.width=128,this._canvas.height=128),this._ctx=this._canvas.getContext("2d"),this._max=1,this._min=0,this._dataDirty=!0,this._data=[],this._transformedData=[],this._canvasWidth=this._areaWidth=this._canvas.width,this._canvasHeight=this._areaHeight=this._canvas.height,this._alpha=!1,this._grad={};var t=this._createCanvas();t.width=1,t.height=256,this._gradCtx=t.getContext("2d"),this._gradCache={},this._gradData=null,this._r=0,this._radius=0,this._blur=0,this._circle=this._createCanvas(),this._cirCtx=this._circle.getContext("2d")}"function"==typeof define&&define.amd?define("spe",MSPE):"undefined"!=typeof exports&&"undefined"!=typeof module&&(module.exports=MSPE),MSPE.shaderChunks={defines:[].join("\n"),uniforms:["uniform sampler2D tex;"].join("\n"),attributes:["attribute vec3 mcol0;","attribute vec3 mcol1;","attribute vec3 mcol2;","attribute vec3 mcol3;","attribute vec4 color;"].join("\n"),varyings:["varying vec2 vUv;","varying vec4 varyColor;"].join("\n")},MSPE.shaders={vertex:[MSPE.shaderChunks.uniforms,MSPE.shaderChunks.attributes,MSPE.shaderChunks.varyings,"void main()","{","\tmat4 matrix = mat4(","\t\tvec4( mcol0, 0 ),","\t\tvec4( mcol1, 0 ),","\t\tvec4( mcol2, 0 ),","\t\tvec4( mcol3, 1 )","\t);","\tvaryColor = color;","\tvec3 positionEye = ( modelViewMatrix * matrix * vec4( position, 1.0 ) ).xyz;","   vUv = vec2( uv.x, uv.y );","\tgl_Position = projectionMatrix * vec4( positionEye, 1.0 );","}"].join("\n"),fragment:[MSPE.shaderChunks.uniforms,MSPE.shaderChunks.varyings,"void main() {","    gl_FragColor = varyColor * texture2D(tex, vUv);",THREE.ShaderChunk.fog_fragment,"}"].join("\n")},MSPE.utils={types:{BOOLEAN:"boolean",STRING:"string",NUMBER:"number",OBJECT:"object"},ensureTypedArg:function(e,t,i){"use strict";return typeof e===t?e:i},ensureArrayTypedArg:function(e,t,i){"use strict";if(Array.isArray(e)){for(var r=e.length-1;r>=0;--r)if(typeof e[r]!==t)return i;return e}return this.ensureTypedArg(e,t,i)},ensureInstanceOf:function(e,t,i){"use strict";return void 0!==t&&e instanceof t?e:i},ensureArrayInstanceOf:function(e,t,i){"use strict";if(Array.isArray(e)){for(var r=e.length-1;r>=0;--r)if(void 0!==t&&e[r]instanceof t==!1)return i;return e}return this.ensureInstanceOf(e,t,i)},ensureValueOverLifetimeCompliance:function(e,t,i){"use strict";t=t||3,i=i||3,!1===Array.isArray(e._value)&&(e._value=[e._value]),!1===Array.isArray(e._spread)&&(e._spread=[e._spread]);var r=this.clamp(e._value.length,t,i),n=this.clamp(e._spread.length,t,i),o=Math.max(r,n);e._value.length!==o&&(e._value=this.interpolateArray(e._value,o)),e._spread.length!==o&&(e._spread=this.interpolateArray(e._spread,o))},interpolateArray:function(e,t){"use strict";for(var i=e.length,r=["function"==typeof e[0].clone?e[0].clone():e[0]],n=(i-1)/(t-1),o=1;o<t-1;++o){var a=o*n,s=Math.floor(a),l=Math.ceil(a),c=a-s;r[o]=this.lerpTypeAgnostic(e[s],e[l],c)}return r.push("function"==typeof e[i-1].clone?e[i-1].clone():e[i-1]),r},clamp:function(e,t,i){"use strict";return Math.max(t,Math.min(e,i))},zeroToEpsilon:function(e,t){"use strict";var i=e;return i=t?1e-5*Math.random()*10:1e-5,e<0&&e>-1e-5&&(i=-i),i},lerpTypeAgnostic:function(e,t,i){"use strict";var r,n=this.types;return typeof e==n.NUMBER&&typeof t==n.NUMBER?e+(t-e)*i:e instanceof THREE.Vector2&&t instanceof THREE.Vector2||typeof e.x==n.NUMBER&&typeof e.y==n.NUMBER&&null==e.z&&null==e.z&&typeof t.x==n.NUMBER&&typeof t.y==n.NUMBER&&null==t.z&&null==t.z?(e instanceof THREE.Vector2?r=e.clone():((r={}).x=e.x,r.y=e.y),r.x=this.lerp(e.x,t.x,i),r.y=this.lerp(e.y,t.y,i),r):e instanceof THREE.Vector3&&t instanceof THREE.Vector3||typeof e.x==n.NUMBER&&typeof e.y==n.NUMBER&&typeof e.z==n.NUMBER&&null==e.w&&null==e.w&&typeof t.x==n.NUMBER&&typeof t.y==n.NUMBER&&typeof t.z==n.NUMBER&&null==t.w&&null==t.w?(e instanceof THREE.Vector3?r=e.clone():((r={}).x=e.x,r.y=e.y,r.z=e.z),r.x=this.lerp(e.x,t.x,i),r.y=this.lerp(e.y,t.y,i),r.z=this.lerp(e.z,t.z,i),r):e instanceof THREE.Vector4&&t instanceof THREE.Vector4||typeof e.x==n.NUMBER&&typeof e.y==n.NUMBER&&typeof e.z==n.NUMBER&&typeof e.w==n.NUMBER&&typeof t.x==n.NUMBER&&typeof t.y==n.NUMBER&&typeof t.z==n.NUMBER&&typeof t.w==n.NUMBER?(e instanceof THREE.Vector4?r=e.clone():((r={}).x=e.x,r.y=e.y,r.z=e.z,r.w=e.w),r.x=this.lerp(e.x,t.x,i),r.y=this.lerp(e.y,t.y,i),r.z=this.lerp(e.z,t.z,i),r.w=this.lerp(e.w,t.w,i),r):e instanceof THREE.Color&&t instanceof THREE.Color||typeof e.r==n.NUMBER&&typeof e.g==n.NUMBER&&typeof e.b==n.NUMBER&&typeof t.r==n.NUMBER&&typeof t.g==n.NUMBER&&typeof t.b==n.NUMBER?(e instanceof THREE.Color?r=e.clone():((r={}).r=e.r,r.g=e.g,r.b=e.b),r.r=this.lerp(e.r,t.r,i),r.g=this.lerp(e.g,t.g,i),r.b=this.lerp(e.b,t.b,i),r):void console.warn("Invalid argument types, or argument types do not match:",e,t)},lerp:function(e,t,i){"use strict";return e+(t-e)*i},roundToNearestMultiple:function(e,t){"use strict";var i;return 0===t?e:0===(i=Math.abs(e)%t)?e:e<0?-(Math.abs(e)-i):e+t-i},arrayValuesAreEqual:function(e){"use strict";for(var t=0;t<e.length-1;++t)if(e[t]!==e[t+1])return!1;return!0},randomFloat:function(e,t){"use strict";return e+t*(Math.random()-.5)},randomVector3:function(e,t,i,r,n){"use strict";var o=i.x+(Math.random()*r.x-.5*r.x),a=i.y+(Math.random()*r.y-.5*r.y),s=i.z+(Math.random()*r.z-.5*r.z);n&&(o=.5*-n.x+this.roundToNearestMultiple(o,n.x),a=.5*-n.y+this.roundToNearestMultiple(a,n.y),s=.5*-n.z+this.roundToNearestMultiple(s,n.z)),e.typedArray.setVec3Components(t,o,a,s)},getRandomVector3:function(e,t,i){"use strict";var r=e.x+(Math.random()*t.x-.5*t.x),n=e.y+(Math.random()*t.y-.5*t.y),o=e.z+(Math.random()*t.z-.5*t.z);return i&&(r=.5*-i.x+this.roundToNearestMultiple(r,i.x),n=.5*-i.y+this.roundToNearestMultiple(n,i.y),o=.5*-i.z+this.roundToNearestMultiple(o,i.z)),new THREE.Vector3(r,n,o)},randomColor:function(e,t,i,r){"use strict";var n=i.r+Math.random()*r.x,o=i.g+Math.random()*r.y,a=i.b+Math.random()*r.z;n=this.clamp(n,0,1),o=this.clamp(o,0,1),a=this.clamp(a,0,1),e.typedArray.setVec3Components(t,n,o,a)},randomColorAsHex:function(){"use strict";var e=new THREE.Color;return function(t,i,r,n){for(var o=r.length,a=[],s=0;s<o;++s){var l=n[s];e.copy(r[s]),e.r+=Math.random()*l.x-.5*l.x,e.g+=Math.random()*l.y-.5*l.y,e.b+=Math.random()*l.z-.5*l.z,e.r=this.clamp(e.r,0,1),e.g=this.clamp(e.g,0,1),e.b=this.clamp(e.b,0,1),a.push(e.getHex())}t.typedArray.setVec4Components(i,a[0],a[1],a[2],a[3])}}(),getRandomColor:function(e,t){"use strict";for(var i=e.length,r=[],n=0;n<i;++n){var o=t[n],a=new THREE.Color;a.copy(e[n]),a.r+=Math.random()*o.x-.5*o.x,a.g+=Math.random()*o.y-.5*o.y,a.b+=Math.random()*o.z-.5*o.z,a.r=this.clamp(a.r,0,1),a.g=this.clamp(a.g,0,1),a.b=this.clamp(a.b,0,1),r.push(a)}return r},randomVector3OnSphere:function(e,t,i,r,n,o,a,s){"use strict";var l=2*Math.random()-1,c=6.2832*Math.random(),u=Math.sqrt(1-l*l),h=this.randomFloat(r,n),p=0,d=0,f=0;a&&(h=Math.round(h/a)*a),p=u*Math.cos(c)*h,d=u*Math.sin(c)*h,f=l*h,p*=o.x,d*=o.y,f*=o.z,p+=i.x,d+=i.y,f+=i.z,e.typedArray.setVec3Components(t,p,d,f)},getRandomVector3OnSphere:function(e,t,i,r,n,o){"use strict";var a=2*Math.random()-1,s=6.2832*Math.random(),l=Math.sqrt(1-a*a),c=this.randomFloat(t,i),u=0,h=0,p=0;return n&&(c=Math.round(c/n)*n),u=l*Math.cos(s)*c,h=l*Math.sin(s)*c,p=a*c,u*=r.x,h*=r.y,p*=r.z,u+=e.x,h+=e.y,p+=e.z,new THREE.Vector3(u,h,p)},seededRandom:function(e){var t=1e4*Math.sin(e);return t-(0|t)},randomVector3OnDisc:function(e,t,i,r,n,o,a){"use strict";var s=6.2832*Math.random(),l=Math.abs(this.randomFloat(r,n)),c=0,u=0,h=0;a&&(l=Math.round(l/a)*a),c=Math.cos(s)*l,u=Math.sin(s)*l,c*=o.x,u*=o.y,c+=i.x,u+=i.y,h+=i.z,e.typedArray.setVec3Components(t,c,u,h)},getRandomVector3OnDisc:function(e,t,i,r,n){"use strict";var o=6.2832*Math.random(),a=Math.abs(this.randomFloat(t,i)),s=0,l=0,c=0;return n&&(a=Math.round(a/n)*n),s=Math.cos(o)*a,l=Math.sin(o)*a,s*=r.x,l*=r.y,s+=e.x,l+=e.y,c+=e.z,new THREE.Vector3(s,l,c)},randomDirectionVector3OnSphere:function(){"use strict";var e=new THREE.Vector3;return function(t,i,r,n,o,a,s,l){e.copy(a),e.x-=r,e.y-=n,e.z-=o,e.normalize().multiplyScalar(-this.randomFloat(s,l)),t.typedArray.setVec3Components(i,e.x,e.y,e.z)}}(),getRandomDirectionVector3OnSphere:function(e,t,i){"use strict";var r=new THREE.Vector3;return r.copy(e),r.x-=this.randomFloat(0,1),r.y-=this.randomFloat(0,1),r.z-=this.randomFloat(0,1),r.normalize().multiplyScalar(-this.randomFloat(t,i)),r},getDirectionVector3OnSphere:function(e,t,i,r,n,o){"use strict";var a=new THREE.Vector3;a.copy(e),a.normalize().multiplyScalar(this.randomFloat(i,r));var s=this.getRandomVector3(n,o);return a.add(s),a},randomDirectionVector3OnDisc:function(){"use strict";var e=new THREE.Vector3;return function(t,i,r,n,o,a,s,l){e.copy(a),e.x-=r,e.y-=n,e.z-=o,e.normalize().multiplyScalar(-this.randomFloat(s,l)),t.typedArray.setVec3Components(i,e.x,e.y,0)}}(),getPackedRotationAxis:function(){"use strict";var e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Color,r=new THREE.Vector3(1,1,1);return function(n,o){return e.copy(n).normalize(),t.copy(o).normalize(),e.x+=.5*-o.x+Math.random()*o.x,e.y+=.5*-o.y+Math.random()*o.y,e.z+=.5*-o.z+Math.random()*o.z,e.normalize().add(r).multiplyScalar(.5),i.setRGB(e.x,e.y,e.z),i.getHex()}}(),getRotationAxis:function(){"use strict";var e=new THREE.Vector3,t=new THREE.Vector3,i=(new THREE.Color,new THREE.Vector3(1,1,1));return function(r,n){return e.copy(r).normalize(),t.copy(n).normalize(),e.x+=.5*-n.x+Math.random()*n.x,e.y+=.5*-n.y+Math.random()*n.y,e.z+=.5*-n.z+Math.random()*n.z,e.normalize().add(i).multiplyScalar(.5),e}}(),setMatrix:function(){var e=new THREE.Quaternion;return function(t,i,r,n){e.setFromEuler(i,!1),n.compose(t,e,r)}}(),clock:function(){var e=new THREE.Clock;return function(){return e}}()},MSPE.Group=function(e){"use strict";var t=MSPE.utils,i=t.types;if((e=t.ensureTypedArg(e,i.OBJECT,{})).texture=t.ensureTypedArg(e.texture,i.OBJECT,{}),this.uuid=THREE.Math.generateUUID(),this.fixedTimeStep=t.ensureTypedArg(e.fixedTimeStep,i.NUMBER,.016),this.texture=t.ensureInstanceOf(e.texture.value,THREE.Texture,null),this.hasPerspective=t.ensureTypedArg(e.hasPerspective,i.BOOLEAN,!0),this.colorize=t.ensureTypedArg(e.colorize,i.BOOLEAN,!0),this.maxParticleCount=t.ensureTypedArg(e.maxParticleCount,i.NUMBER,1e3),this.vec4Quaternion=t.ensureInstanceOf(e.vec4Quaternion,THREE.Vector4,new THREE.Vector4(0,0,0,1)),this.vec4Quaternion=this.vec4Quaternion.normalize(),null==e.bufferGeometry||null==e.bufferGeometry||!(e.bufferGeometry instanceof THREE.BufferGeometry))return console.error("[MSPE.js] : [MSPE.Group] : error options.bufferGeometry!"),null;this.instancedBufferGeometry=null,this.mesh=null,this.materialList=[],this.geometryList=[],this.bufferGeometry=e.bufferGeometry,this.bufferGeometry=this.bufferGeometry.toNonIndexed(),this.bufferGeometry.computeBoundingBox(),this.geometryList.push(this.bufferGeometry),this.instancedBufferGeometry=new THREE.InstancedBufferGeometry,this.geometryList.push(this.instancedBufferGeometry);var r=this.bufferGeometry.attributes.position.clone();if(this.instancedBufferGeometry.addAttribute("position",r),null!=this.bufferGeometry.attributes.uv&&null!=this.bufferGeometry.attributes.uv){var n=this.bufferGeometry.attributes.uv.clone();this.instancedBufferGeometry.addAttribute("uv",n)}this.instanceBuffer=new THREE.InstancedInterleavedBuffer(new Float32Array(16*this.maxParticleCount),16,1).setDynamic(!0),this.mcol0=new THREE.InterleavedBufferAttribute(this.instanceBuffer,3,0),this.mcol1=new THREE.InterleavedBufferAttribute(this.instanceBuffer,3,3),this.mcol2=new THREE.InterleavedBufferAttribute(this.instanceBuffer,3,6),this.mcol3=new THREE.InterleavedBufferAttribute(this.instanceBuffer,3,9),this.colors=new THREE.InterleavedBufferAttribute(this.instanceBuffer,4,12);!function(){var e=new THREE.Vector3(0,0,0),t=new THREE.Euler(0,0,0),i=new THREE.Quaternion,r=new THREE.Vector3(1,1,1)}();for(var o=new THREE.Matrix4,a=o.elements,s=0,l=this.mcol0.count;s<l;s++){var c=new THREE.Vector3(0,0,0),u=new THREE.Euler(0,0,0),h=new THREE.Vector3(0,0,0);t.setMatrix(c,u,h,o),this.mcol0.setXYZ(s,a[0],a[1],a[2]),this.mcol1.setXYZ(s,a[4],a[5],a[6]),this.mcol2.setXYZ(s,a[8],a[9],a[10]),this.mcol3.setXYZ(s,a[12],a[13],a[14]),this.colors.setXYZW(s,1,1,1,1)}this.instancedBufferGeometry.addAttribute("mcol0",this.mcol0),this.instancedBufferGeometry.addAttribute("mcol1",this.mcol1),this.instancedBufferGeometry.addAttribute("mcol2",this.mcol2),this.instancedBufferGeometry.addAttribute("mcol3",this.mcol3),this.instancedBufferGeometry.addAttribute("color",this.colors),this.blending=t.ensureTypedArg(e.blending,i.NUMBER,THREE.AdditiveBlending),this.transparent=t.ensureTypedArg(e.transparent,i.BOOLEAN,!0),this.alphaTest=parseFloat(t.ensureTypedArg(e.alphaTest,i.NUMBER,0)),this.depthWrite=t.ensureTypedArg(e.depthWrite,i.BOOLEAN,!1),this.depthTest=t.ensureTypedArg(e.depthTest,i.BOOLEAN,!0),this.fog=t.ensureTypedArg(e.fog,i.BOOLEAN,!0),this.scale=t.ensureTypedArg(e.scale,i.NUMBER,300),this.emitters=[],this.emitterIDs=[],this.particleCount=0,this.uniforms={tex:{type:"t",value:this.texture}},this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:MSPE.shaders.vertex,fragmentShader:MSPE.shaders.fragment,blending:this.blending,transparent:this.transparent,alphaTest:this.alphaTest,depthWrite:this.depthWrite,depthTest:this.depthTest,fog:this.fog}),this.materialList.push(this.material),this.mesh=new THREE.Mesh(this.instancedBufferGeometry,this.material),this.bEnableTrail=t.ensureTypedArg(e.bEnableTrail,i.BOOLEAN,!1),this.bEnableTrail&&(this.textureTrail=t.ensureInstanceOf(e.textureTrail,THREE.Texture,null),null!=this.textureTrail&&null!=this.textureTrail||(console.error("[MSPE.js] : [MSPE.Group] : error options.textureTrail!"),this.textureTrail=this.texture),this.fTrailLife=parseFloat(t.ensureTypedArg(e.fTrailLife,i.NUMBER,1)),this.fTrailWidthStart=parseFloat(t.ensureTypedArg(e.fTrailWidthStart,i.NUMBER,1)),this.fTrailWidthEnd=parseFloat(t.ensureTypedArg(e.fTrailWidthEnd,i.NUMBER,1)))},MSPE.Group.constructor=MSPE.Group,MSPE.Group.prototype._updateDefines=function(){},MSPE.Group.prototype.addEmitter=function(e){"use strict";if(e instanceof MSPE.Emitter!=!1)if(this.emitterIDs.indexOf(e.uuid)>-1)console.error("[MSPE.js] : [MSPE.Group] : [addEmitter] : Emitter already exists in this group. Will not add again.");else{if(null===e.group){var t,i=this.particleCount;return t=Math.min(i+e.particleCount,this.maxParticleCount),this.particleCount=t,e.particleCount=t-i,e.activationStart=i,e.activationEnd=e.activationStart+e.particleCount,e._calculatePPSValue(e.maxAge._value+e.maxAge._spread),e.attach(this),this.emitters.push(e),this.emitterIDs.push(e.uuid),this.material.needsUpdate=!0,this.instanceBuffer.needsUpdate=!0,this}console.error("[MSPE.js] : [MSPE.Group] : [addEmitter] : Emitter already belongs to another group. Will not add to requested group.")}else console.error("[MSPE.js] : [MSPE.Group] : [addEmitter] : emitter argument must be instance of MSPE.Emitter;")},MSPE.Group.prototype.removeEmitter=function(e){"use strict";var t=this.emitterIDs.indexOf(e.uuid);e instanceof MSPE.Emitter!=!1?-1!==t?(this.emitters[t].dispose(),this.emitters.splice(t,1),this.emitterIDs.splice(t,1),this.particleCount-=e.particleCount,this.material.needsUpdate=!0,this.instanceBuffer.needsUpdate=!0,e.group=null):console.error("[MSPE.js] : [MSPE.Group] : [removeEmitter] : Emitter does not exist in this group. Will not remove."):console.error("[MSPE.js] : [MSPE.Group] : [removeEmitter] : emitter argument must be instance of MSPE.Emitter;")},MSPE.Group.prototype.tick=function(e,t){"use strict";var i=this.emitters,r=i.length,n=e||this.fixedTimeStep;if(0!==r){for(var o=0;o<r;++o)i[o].tick(n,t);this.instanceBuffer.needsUpdate=!0}},MSPE.Group.prototype.dispose=function(){"use strict";return this.materialList.forEach(function(e){e.dispose()}),this.geometryList.forEach(function(e){e.dispose()}),this.materialList=[],this.geometryList=[],this},MSPE.Emitter=function(e){"use strict";var t=MSPE.utils,i=t.types,r=MSPE.valueOverLifetimeLength;for(var n in(e=t.ensureTypedArg(e,i.OBJECT,{})).position=t.ensureTypedArg(e.position,i.OBJECT,{}),e.velocity=t.ensureTypedArg(e.velocity,i.OBJECT,{}),e.acceleration=t.ensureTypedArg(e.acceleration,i.OBJECT,{}),e.radius=t.ensureTypedArg(e.radius,i.OBJECT,{}),e.drag=t.ensureTypedArg(e.drag,i.OBJECT,{}),e.rotation=t.ensureTypedArg(e.rotation,i.OBJECT,{}),e.color=t.ensureTypedArg(e.color,i.OBJECT,{}),e.opacity=t.ensureTypedArg(e.opacity,i.OBJECT,{}),e.size=t.ensureTypedArg(e.size,i.OBJECT,{}),e.angle=t.ensureTypedArg(e.angle,i.OBJECT,{}),e.wiggle=t.ensureTypedArg(e.wiggle,i.OBJECT,{}),e.maxAge=t.ensureTypedArg(e.maxAge,i.OBJECT,{}),this.uuid=THREE.Math.generateUUID(),this.type=t.ensureTypedArg(e.type,i.NUMBER,SPE.distributions.BOX),this.position={_value:t.ensureInstanceOf(e.position.value,THREE.Vector3,new THREE.Vector3),_spread:t.ensureInstanceOf(e.position.spread,THREE.Vector3,new THREE.Vector3),_spreadClamp:t.ensureInstanceOf(e.position.spreadClamp,THREE.Vector3,new THREE.Vector3),_distribution:t.ensureTypedArg(e.position.distribution,i.NUMBER,this.type),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1),_radius:t.ensureTypedArg(e.position.radius,i.NUMBER,10),_radiusScale:t.ensureInstanceOf(e.position.radiusScale,THREE.Vector3,new THREE.Vector3(1,1,1)),_distributionClamp:t.ensureTypedArg(e.position.distributionClamp,i.NUMBER,0)},this.velocity={_value:t.ensureInstanceOf(e.velocity.value,THREE.Vector3,new THREE.Vector3),_spread:t.ensureInstanceOf(e.velocity.spread,THREE.Vector3,new THREE.Vector3),_spreadClamp:t.ensureInstanceOf(e.velocity.spreadClamp,THREE.Vector3,new THREE.Vector3),_distribution:t.ensureTypedArg(e.velocity.distribution,i.NUMBER,this.type),_randomise:t.ensureTypedArg(e.velocity.randomise,i.BOOLEAN,!1),_radius:t.ensureTypedArg(e.velocity.radius,i.NUMBER,10),_radiusScale:t.ensureInstanceOf(e.velocity.radiusScale,THREE.Vector3,new THREE.Vector3(1,1,1)),_distributionClamp:t.ensureTypedArg(e.velocity.distributionClamp,i.NUMBER,0)},this.acceleration={_value:t.ensureInstanceOf(e.acceleration.value,THREE.Vector3,new THREE.Vector3),_spread:t.ensureInstanceOf(e.acceleration.spread,THREE.Vector3,new THREE.Vector3),_spreadClamp:t.ensureInstanceOf(e.acceleration.spreadClamp,THREE.Vector3,new THREE.Vector3),_distribution:t.ensureTypedArg(e.acceleration.distribution,i.NUMBER,this.type),_randomise:t.ensureTypedArg(e.acceleration.randomise,i.BOOLEAN,!1),_radius:t.ensureTypedArg(e.acceleration.radius,i.NUMBER,10),_radiusScale:t.ensureInstanceOf(e.acceleration.radiusScale,THREE.Vector3,new THREE.Vector3(1,1,1)),_distributionClamp:t.ensureTypedArg(e.acceleration.distributionClamp,i.NUMBER,0)},this.drag={_value:t.ensureTypedArg(e.drag.value,i.NUMBER,0),_spread:t.ensureTypedArg(e.drag.spread,i.NUMBER,0),_randomise:t.ensureTypedArg(e.drag.randomise,i.BOOLEAN,!1)},this.wiggle={_value:t.ensureTypedArg(e.wiggle.value,i.NUMBER,0),_spread:t.ensureTypedArg(e.wiggle.spread,i.NUMBER,0)},this.rotation={_axis:t.ensureInstanceOf(e.rotation.axis,THREE.Vector3,new THREE.Vector3(0,1,0)),_axisSpread:t.ensureInstanceOf(e.rotation.axisSpread,THREE.Vector3,new THREE.Vector3),_angle:t.ensureTypedArg(e.rotation.angle,i.NUMBER,0),_angleSpread:t.ensureTypedArg(e.rotation.angleSpread,i.NUMBER,0),_static:t.ensureTypedArg(e.rotation.static,i.BOOLEAN,!1),_center:t.ensureInstanceOf(e.rotation.center,THREE.Vector3,this.position._value.clone()),_randomise:t.ensureTypedArg(e.rotation.randomise,i.BOOLEAN,!1)},this.maxAge={_value:t.ensureTypedArg(e.maxAge.value,i.NUMBER,2),_spread:t.ensureTypedArg(e.maxAge.spread,i.NUMBER,0)},this.color={_value:t.ensureArrayInstanceOf(e.color.value,THREE.Color,new THREE.Color),_spread:t.ensureArrayInstanceOf(e.color.spread,THREE.Vector3,new THREE.Vector3),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.opacity={_value:t.ensureArrayTypedArg(e.opacity.value,i.NUMBER,1),_spread:t.ensureArrayTypedArg(e.opacity.spread,i.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.size={_value:t.ensureArrayTypedArg(e.size.value,i.NUMBER,1),_spread:t.ensureArrayTypedArg(e.size.spread,i.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.angle={_value:t.ensureArrayTypedArg(e.angle.value,i.NUMBER,0),_spread:t.ensureArrayTypedArg(e.angle.spread,i.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.SHOULD_DRAG_PARTICLES=!!Math.max(this.drag._value,this.drag._spread),this.SHOULD_WIGGLE_PARTICLES=!!Math.max(this.wiggle._value,this.wiggle._spread),this.SHOULD_ROTATE_PARTICLES=!!Math.max(this.rotation._angle,this.rotation._angleSpread),this.SHOULD_COLORIZE_PARTICLES=!0,this.SHOULD_SIZE_PARTICLES=!0,this.SHOULD_ANGLE_PARTICLES=!0,this.particleCount=t.ensureTypedArg(e.particleCount,i.NUMBER,100),this.objPool=new MSPE.BufferAttributeObjPool({iCount:this.particleCount}),this.duration=t.ensureTypedArg(e.duration,i.NUMBER,null),this.isStatic=t.ensureTypedArg(e.isStatic,i.BOOLEAN,!1),this.isLookAtCamera=t.ensureTypedArg(e.isLookAtCamera,i.BOOLEAN,!1),this.isLookAtCameraOnlyY=t.ensureTypedArg(e.isLookAtCameraOnlyY,i.BOOLEAN,!1),this.activeMultiplier=t.ensureTypedArg(e.activeMultiplier,i.NUMBER,1),this.direction=t.ensureTypedArg(e.direction,i.NUMBER,1),this.alive=t.ensureTypedArg(e.alive,i.BOOLEAN,!0),this.particlesPerSecond=0,this.age=0,this.activationStart=t.ensureTypedArg(e.activationStart,i.NUMBER,0),this.activationEnd=this.activationStart+this.particleCount,this._calculatePPSValue(this.maxAge._value+this.maxAge._spread),this.arrayParticles=new Array,this.group=null,this.bInitSpeed=!1,this.bInitSpeedAcc=!1,this.resetFlags={position:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)||t.ensureTypedArg(e.radius.randomise,i.BOOLEAN,!1),velocity:t.ensureTypedArg(e.velocity.randomise,i.BOOLEAN,!1),acceleration:t.ensureTypedArg(e.acceleration.randomise,i.BOOLEAN,!1)||t.ensureTypedArg(e.drag.randomise,i.BOOLEAN,!1),rotation:t.ensureTypedArg(e.rotation.randomise,i.BOOLEAN,!1),rotationCenter:t.ensureTypedArg(e.rotation.randomise,i.BOOLEAN,!1),size:t.ensureTypedArg(e.size.randomise,i.BOOLEAN,!1),color:t.ensureTypedArg(e.color.randomise,i.BOOLEAN,!1),opacity:t.ensureTypedArg(e.opacity.randomise,i.BOOLEAN,!1),angle:t.ensureTypedArg(e.angle.randomise,i.BOOLEAN,!1)},this.updateFlags={},this.updateCounts={},this.updateMap={maxAge:"params",position:"position",velocity:"velocity",acceleration:"acceleration",drag:"acceleration",wiggle:"params",rotation:"rotation",size:"size",color:"color",opacity:"opacity",angle:"angle"},this.updateMap)this.updateMap.hasOwnProperty(n)&&(this.updateCounts[this.updateMap[n]]=0,this.updateFlags[this.updateMap[n]]=!1,this._createGetterSetters(this[n],n));t.ensureValueOverLifetimeCompliance(this.color,r,r),t.ensureValueOverLifetimeCompliance(this.opacity,r,r),t.ensureValueOverLifetimeCompliance(this.size,r,r),t.ensureValueOverLifetimeCompliance(this.angle,r,r)},MSPE.Emitter.constructor=MSPE.Emitter,MSPE.Emitter.prototype._createGetterSetters=function(e,t){"use strict";var i=this;for(var r in e)if(e.hasOwnProperty(r)){var n=r.replace("_","");Object.defineProperty(e,n,{get:function(e){return function(){return this[e]}}(r),set:function(e){return function(r){var n=i.updateMap[t],o=this[e],a=MSPE.valueOverLifetimeLength;"_rotationCenter"===e?(i.updateFlags.rotationCenter=!0,i.updateCounts.rotationCenter=0):"_randomise"===e?i.resetFlags[n]=r:(i.updateFlags[n]=!0,i.updateCounts[n]=0),this[e]=r,Array.isArray(o)&&MSPE.utils.ensureValueOverLifetimeCompliance(i[t],a,a)}}(r)})}},MSPE.Emitter.prototype.attach=function(e){this.group=e},MSPE.Emitter.prototype._calculatePPSValue=function(e){"use strict";var t=this.particleCount;this.duration?this.particlesPerSecond=t/(e<this.duration?e:this.duration):this.particlesPerSecond=t/e},MSPE.Emitter.prototype._activateParticles=function(e,t){"use strict";this.direction;for(var i=0;i<e;++i){var r=new MSPE.Particle({emitter:this});null!=r&&null!=r&&this.arrayParticles.push(r)}},MSPE.Emitter.prototype.tick=function(e,t){"use strict";if(!this.isStatic)if(!1!==this.alive)if(null!==this.duration&&this.age>this.duration){for(var i=0,r=this.arrayParticles.length;i<r;++i)this.arrayParticles[i].tick(e,t),this.arrayParticles[i].alive||(this.arrayParticles[i].dispose(),this.arrayParticles.splice(i,1),r=this.arrayParticles.length,i--);this.arrayParticles.length<=0&&(this.alive=!1,this.age=0)}else{if(this.activationIndex=this.arrayParticles.length,this.activationIndex<this.particleCount){var n=this.activationIndex,o=this.particlesPerSecond*this.activeMultiplier*e,a=1===this.particleCount?n:0|n,s=Math.min(a+o,this.activationEnd)-a;s=Math.min(this.particleCount-this.activationIndex,s),this._activateParticles(s)}for(i=0,r=this.arrayParticles.length;i<r;++i)this.arrayParticles[i].tick(e,t),this.arrayParticles[i].alive||(this.arrayParticles[i].dispose(),this.arrayParticles.splice(i,1),r=this.arrayParticles.length,i--);this.age+=e}else this.age=0},MSPE.Emitter.prototype.dispose=function(){"use strict";for(var e=0,t=this.arrayParticles.length;e<t;++e)this.arrayParticles[e].dispose();this.particlesPerSecond=0,this.activationIndex=0,this.activeParticleCount=0,this.group=null,this.age=0,this.objPool.dispose()},MSPE.Particle=function(e){"use strict";var t=MSPE.utils,i=t.types;if(null!=(e=t.ensureTypedArg(e,i.OBJECT,{})).emitter&&null!=e.emitter&&e.emitter instanceof MSPE.Emitter){if(this.emitter=e.emitter,this.position={_value:e.emitter.position.value,_spread:e.emitter.position.spread,_spreadClamp:e.emitter.position.spreadClamp,_distribution:e.emitter.position.distribution,_randomise:e.emitter.position.randomise,_radius:e.emitter.position.radius,_radiusScale:e.emitter.position.radiusScale,_distributionClamp:e.emitter.position.distributionClamp},this.velocity={_value:e.emitter.velocity.value,_spread:e.emitter.velocity.spread,_spreadClamp:e.emitter.velocity.spreadClamp,_distribution:e.emitter.velocity.distribution,_randomise:e.emitter.velocity.randomise,_radius:e.emitter.velocity.radius,_radiusScale:e.emitter.velocity.radiusScale,_distributionClamp:e.emitter.velocity.distributionClamp},this.acceleration={_value:e.emitter.acceleration.value,_spread:e.emitter.acceleration.spread,_spreadClamp:e.emitter.acceleration.spreadClamp,_distribution:e.emitter.acceleration.distribution,_randomise:e.emitter.acceleration.randomise,_radius:e.emitter.acceleration.radius,_radiusScale:e.emitter.acceleration.radiusScale,_distributionClamp:e.emitter.acceleration.distributionClamp},this.drag={_value:e.emitter.drag.value,_spread:e.emitter.drag.spread,_randomise:e.emitter.position.randomise},this.wiggle={_value:e.emitter.wiggle.value,_spread:e.emitter.wiggle.spread},this.rotation={_axis:e.emitter.rotation.axis,_axisSpread:e.emitter.rotation.axisSpread,_angle:e.emitter.rotation.angle,_angleSpread:e.emitter.rotation.angleSpread,_static:e.emitter.rotation.static,_center:e.emitter.rotation.center,_randomise:e.emitter.position.randomise},this.maxAge={_value:e.emitter.maxAge.value,_spread:e.emitter.maxAge.spread},this.color={_value:e.emitter.color.value,_spread:e.emitter.color.spread,_randomise:e.emitter.position.randomise},this.opacity={_value:e.emitter.opacity.value,_spread:e.emitter.opacity.spread,_randomise:e.emitter.position.randomise},this.size={_value:e.emitter.size.value,_spread:e.emitter.size.spread,_randomise:e.emitter.position.randomise},this.angle={_value:e.emitter.angle.value,_spread:e.emitter.angle.spread,_randomise:e.emitter.position.randomise},this.alive=e.emitter.alive,this.age=0,this.vec3RealPosition=this._assignPositionValue(),this.vec3RealVelocity=this._assignVelocityValue(),this.vec3RealAcceleration=this._assignAccelerationValue(),this.arrayRealColor=this._assignColorValue(),this.arrayRealOpacity=this._assignOpacityAbsLifetimeValue(),this.arrayRealSize=this._assignSizeAbsLifetimeValue(),this.arrayRealAngle=this._assignAngleValue(),this.fRealDrag=t.clamp(t.randomFloat(this.drag._value,this.drag._spread),0,1),this.fRealWiggle=t.randomFloat(this.wiggle._value,this.wiggle._spread),this.fRealMaxAge=MSPE.utils.randomFloat(this.maxAge._value,this.maxAge._spread),this.vec3RealRotationAxis=MSPE.utils.getRotationAxis(this.rotation._axis,this.rotation._axisSpread),this.fRealRotationAngle=MSPE.utils.randomFloat(this.rotation._angle,this.rotation._angleSpread),this.uuidTrial="",this.obj=this.emitter.objPool.takeAnObj(),null==this.obj||null==this.obj)return this.alive=!1,this.dispose(),null;for(var r in this.matrix=new THREE.Matrix4,this.matrixElements=this.matrix.elements,this.vec3Position=new THREE.Vector3(0,0,0),this.vec3Rotation=new THREE.Euler(0,0,0),this.vec3Scale=new THREE.Vector3(.1,.1,.1),this.obj.setUse(!0),this.iBufferIndex=this.obj.iIndex+this.emitter.activationStart,this.updateFlags={},this.updateCounts={},this.updateMap={maxAge:"params",position:"position",velocity:"velocity",acceleration:"acceleration",drag:"acceleration",wiggle:"params",rotation:"rotation",size:"size",color:"color",opacity:"opacity",angle:"angle"},this.updateMap)this.updateMap.hasOwnProperty(r)&&(this.updateCounts[this.updateMap[r]]=0,this.updateFlags[this.updateMap[r]]=!1,this._createGetterSetters(this[r],r));return this.emitter.group.bEnableTrail&&(this.trailRenderHelper=new TrailRenderHelper,this.trailRenderHelper.onTriggerMeshInited=this.onTriggerMeshInited,this.trailRenderHelper.init({fTimeLong:this.emitter.group.fTrailLife,fTimeStart:MSPE.utils.clock().getElapsedTime(),iStep:0,fWidthStart:this.emitter.group.fTrailWidthStart,fWidthEnd:this.emitter.group.fTrailWidthEnd,shaderColor:new THREE.Vector4(1,1,1,1),shaderTexture:this.emitter.group.textureTrail,shaderTexMode:"Stretch",shaderBlending:this.emitter.group.blending,shaderTransparent:this.emitter.group.transparent,shaderAlphaTest:this.emitter.group.alphaTest,shaderDepthWrite:this.emitter.group.depthWrite,shaderDepthTest:this.emitter.group.depthTest},function(){}),this.uuidTrial=this.trailRenderHelper.attach(function(e){})),this}console.error("[MSPE.js] : [MSPE.Particle] : error options.emitter;")},MSPE.Particle.constructor=MSPE.Particle,MSPE.Particle.prototype.onTriggerMeshInited=function(e){this.meshTrial=e},MSPE.Particle.prototype._createGetterSetters=function(e,t){"use strict";var i=this;for(var r in e)if(e.hasOwnProperty(r)){var n=r.replace("_","");Object.defineProperty(e,n,{get:function(e){return function(){return this[e]}}(r),set:function(e){return function(r){var n=i.updateMap[t],o=this[e],a=MSPE.valueOverLifetimeLength;"_rotationCenter"===e?(i.updateFlags.rotationCenter=!0,i.updateCounts.rotationCenter=0):"_randomise"===e?i.resetFlags[n]=r:(i.updateFlags[n]=!0,i.updateCounts[n]=0),this[e]=r,Array.isArray(o)&&MSPE.utils.ensureValueOverLifetimeCompliance(i[t],a,a)}}(r)})}},MSPE.Particle.prototype.tick=function(e,t){"use strict";if(!this.emitter.isStatic){if(!1!==this.emitter.alive&&!1!==this.alive)return null!==this.emitter.duration&&this.age>this.emitter.duration?(this.alive=!1,void(this.age=0)):(this.age+=e,this.running(t),this.age>this.fRealMaxAge?(this.alive=!1,void(this.age=0)):void 0);this.age=0}},MSPE.Particle.prototype._assignPositionValue=function(){"use strict";var e=MSPE.distributions,t=MSPE.utils,i=this.position,r=i._value,n=i._spread,o=this.emitter.type,a=new THREE.Vector3(0,0,0);switch(o){case e.BOX:a=t.getRandomVector3(r,n,i._spreadClamp);break;case e.SPHERE:a=t.getRandomVector3OnSphere(r,i._radius,i._spread.x,i._radiusScale,i._spreadClamp.x,i._distributionClamp||this.particleCount);break;case e.DISC:a=t.getRandomVector3OnDisc(r,i._radius,i._spread.x,i._radiusScale,i._spreadClamp.x)}return a},MSPE.Particle.prototype._assignVelocityValue=function(){"use strict";var e=this.emitter.group.vec4Quaternion.clone();e=e.normalize();var t=MSPE.distributions,i=MSPE.utils,r=this.velocity,n=r._value,o=r._spread,a=this.emitter.type;this.emitter.bInitSpeed||(n=n.applyQuaternion(e),o=o.applyQuaternion(e),this.emitter.bInitSpeed=!0);var s=new THREE.Vector3(0,0,0);switch(a){case t.BOX:s=i.getRandomVector3(n,o);break;case t.SPHERE:s=i.getRandomDirectionVector3OnSphere(this.emitter.position.value,n.x,o.x);break;case t.DISC:s=i.getRandomVector3OnDisc(n,r._radius,r._spread.x,r._radiusScale,r._spreadClamp.x)}return s},MSPE.Particle.prototype._assignAccelerationValue=function(){"use strict";var e=this.emitter.group.vec4Quaternion.clone();e=e.normalize();var t=MSPE.distributions,i=MSPE.utils,r=this.acceleration,n=r._value,o=r._spread,a=this.emitter.type;this.emitter.bInitSpeedAcc||(n=n.applyQuaternion(e),o=o.applyQuaternion(e),this.emitter.bInitSpeedAcc=!0);var s=new THREE.Vector3(0,0,0);switch(a){case t.BOX:s=i.getRandomVector3(n,o);break;case t.SPHERE:s=i.getDirectionVector3OnSphere(this.vec3RealVelocity,this.emitter.position.value,this.emitter.velocity.value.y,this.emitter.velocity.spread.y,n,o);break;case t.DISC:s=i.getRandomVector3OnDisc(n,r._radius,r._spread.x,r._radiusScale,r._spreadClamp.x)}return s},MSPE.Particle.prototype._assignColorValue=function(){"use strict";return MSPE.utils.getRandomColor(this.color._value,this.color._spread)},MSPE.Particle.prototype._assignOpacityAbsLifetimeValue=function(){"use strict";var e,t,i=this.opacity,r=MSPE.utils;return t=new Array,r.arrayValuesAreEqual(i._value)&&r.arrayValuesAreEqual(i._spread)?(e=Math.abs(r.randomFloat(i._value[0],i._spread[0])),t.push(e),t.push(e),t.push(e),t.push(e)):(e=Math.abs(r.randomFloat(i._value[0],i._spread[0])),t.push(e),e=Math.abs(r.randomFloat(i._value[1],i._spread[1])),t.push(e),e=Math.abs(r.randomFloat(i._value[2],i._spread[2])),t.push(e),e=Math.abs(r.randomFloat(i._value[3],i._spread[3])),t.push(e)),t},MSPE.Particle.prototype._assignSizeAbsLifetimeValue=function(){"use strict";var e,t,i=this.size,r=MSPE.utils;return t=new Array,r.arrayValuesAreEqual(i._value)&&r.arrayValuesAreEqual(i._spread)?(e=Math.abs(r.randomFloat(i._value[0],i._spread[0])),t.push(e),t.push(e),t.push(e),t.push(e)):(e=Math.abs(r.randomFloat(i._value[0],i._spread[0])),t.push(e),e=Math.abs(r.randomFloat(i._value[1],i._spread[1])),t.push(e),e=Math.abs(r.randomFloat(i._value[2],i._spread[2])),t.push(e),e=Math.abs(r.randomFloat(i._value[3],i._spread[3])),t.push(e)),t},MSPE.Particle.prototype._assignAngleValue=function(){"use strict";var e,t=new Array,i=this.angle,r=MSPE.utils;return r.arrayValuesAreEqual(i._value)&&r.arrayValuesAreEqual(i._spread)?(e=r.randomFloat(i._value[0],i._spread[0]),t.push(e),t.push(e),t.push(e),t.push(e)):(e=r.randomFloat(i._value[0],i._spread[0]),t.push(e),e=r.randomFloat(i._value[1],i._spread[1]),t.push(e),e=r.randomFloat(i._value[2],i._spread[2]),t.push(e),e=r.randomFloat(i._value[3],i._spread[3]),t.push(e)),t},MSPE.Particle.prototype.getRotationMatrix=function(e,t){e=e.normalize();var i=Math.sin(t),r=Math.cos(t),n=1-r;return(new THREE.Matrix4).set(n*e.x*e.x+r,n*e.x*e.y-e.z*i,n*e.z*e.x+e.y*i,0,n*e.x*e.y+e.z*i,n*e.y*e.y+r,n*e.y*e.z-e.x*i,0,n*e.z*e.x-e.y*i,n*e.y*e.z+e.x*i,n*e.z*e.z+r,0,0,0,0,1)},MSPE.Particle.prototype.when_gt=function(e,t){return Math.max(Math.sign(e-t),0)},MSPE.Particle.prototype.when_lt=function(e,t){return Math.min(Math.max(1-Math.sign(e-t),0),1)},MSPE.Particle.prototype.when_eq=function(e,t){return 1-Math.abs(Math.sign(e-t))},MSPE.Particle.prototype.when_ge=function(e,t){return 1-this.when_lt(e,t)},MSPE.Particle.prototype.when_le=function(e,t){return 1-this.when_gt(e,t)},MSPE.Particle.prototype.and=function(e,t){return e*t},MSPE.Particle.prototype.or=function(e,t){return Math.min(e+t,1)},MSPE.Particle.prototype.getFloatOverLifetime=function(e,t){var i=0,r=e*(MSPE.valueOverLifetimeLength-1),n=0;i+=t[0]*this.when_eq(r,0);for(var o=0;o<MSPE.valueOverLifetimeLength-1;++o)n=o,i+=this.and(this.when_gt(r,n),this.when_le(r,n+1))*MSPE.utils.lerp(t[o],t[o+1],r-n);return i},MSPE.Particle.prototype.getColorOverLifetime=function(e,t,i,r,n){var o=new THREE.Vector3(0,0,0),a=new Array;a.push(t.r),a.push(i.r),a.push(r.r),a.push(n.r);var s=new Array;s.push(t.g),s.push(i.g),s.push(r.g),s.push(n.g);var l=new Array;return l.push(t.b),l.push(i.b),l.push(r.b),l.push(n.b),o.x=this.getFloatOverLifetime(e,a),o.y=this.getFloatOverLifetime(e,s),o.z=this.getFloatOverLifetime(e,l),o},MSPE.Particle.prototype.getRotation=function(e,t){if(0==this.fRealRotationAngle)return e;var i,r,n=new THREE.Vector3(this.vec3RealRotationAxis.x,this.vec3RealRotationAxis.y,this.vec3RealRotationAxis.z),o=new THREE.Vector3(this.rotation._center.x,this.rotation._center.y,this.rotation._center.z),a=0;a+=this.when_eq(this.rotation._static?0:1,0)*this.fRealRotationAngle,a+=this.when_gt(this.rotation._static?0:1,0)*MSPE.utils.lerp(0,this.fRealRotationAngle,t),i=o.sub(e),r=this.getRotationMatrix(n,a);var s=new THREE.Vector4(i.x,i.y,i.z,0);s.applyMatrix4(r);var l=new THREE.Vector3(s.x,s.y,s.z);return o.sub(l)},MSPE.Particle.prototype.running=function(e){var t=this.age,i=this.age/this.fRealMaxAge,r=new THREE.Vector3(this.vec3RealPosition.x,this.vec3RealPosition.y,this.vec3RealPosition.z),n=new THREE.Vector3(this.vec3RealVelocity.x,this.vec3RealVelocity.y,this.vec3RealVelocity.z),o=new THREE.Vector3(this.vec3RealAcceleration.x,this.vec3RealAcceleration.y,this.vec3RealAcceleration.z);if(this.emitter.SHOULD_DRAG_PARTICLES){var a=1-.5*i*this.fRealDrag;o=o.multiplyScalar(a)}var s=new THREE.Vector3;s.copy(n),s.multiplyScalar(t);var l=new THREE.Vector3;l.copy(o),l.multiplyScalar(t*t*.5);var c=new THREE.Vector3;if(c.copy(r),c.add(s.add(l)),this.emitter.SHOULD_WIGGLE_PARTICLES){var u=i*this.fRealWiggle*Math.PI,h=Math.sin(u),p=Math.cos(u);c.x+=h,c.y+=p,c.z+=h}if(this.emitter.SHOULD_ROTATE_PARTICLES&&(c=this.getRotation(c,i)),this.vec3Position=c,this.emitter.SHOULD_SIZE_PARTICLES){var d=this.getFloatOverLifetime(i,this.arrayRealSize);this.vec3Scale=new THREE.Vector3(d,d,d)}if(this.emitter.isLookAtCamera||this.emitter.isLookAtCameraOnlyY){if(this.emitter.isLookAtCamera)f=(f=new THREE.Euler).setFromQuaternion(e.quaternion),this.vec3Rotation=f;else if(this.emitter.isLookAtCameraOnlyY){var f;f=(f=new THREE.Euler).setFromQuaternion(e.quaternion),this.vec3Rotation=new THREE.Euler(0,f.z,0,"XYZ")}}else if(this.emitter.SHOULD_ANGLE_PARTICLES){var m=this.getFloatOverLifetime(i,this.arrayRealAngle);this.vec3Rotation=new THREE.Euler(m,m,m)}if(this.emitter.group.bEnableTrail){var g=MSPE.utils.clock().getElapsedTime();this.trailRenderHelper.tick({uuid:this.uuidTrial,timeNow:g,position:this.vec3Position,rotation:this.vec3Rotation})}if(MSPE.utils.setMatrix(this.vec3Position,this.vec3Rotation,this.vec3Scale,this.matrix),this.emitter.group.mcol0.setXYZ(this.iBufferIndex,this.matrixElements[0],this.matrixElements[1],this.matrixElements[2]),this.emitter.group.mcol1.setXYZ(this.iBufferIndex,this.matrixElements[4],this.matrixElements[5],this.matrixElements[6]),this.emitter.group.mcol2.setXYZ(this.iBufferIndex,this.matrixElements[8],this.matrixElements[9],this.matrixElements[10]),this.emitter.group.mcol3.setXYZ(this.iBufferIndex,this.matrixElements[12],this.matrixElements[13],this.matrixElements[14]),this.emitter.SHOULD_COLORIZE_PARTICLES){var v=this.getColorOverLifetime(i,this.arrayRealColor[0],this.arrayRealColor[1],this.arrayRealColor[2],this.arrayRealColor[3]),y=this.getFloatOverLifetime(i,this.arrayRealOpacity);this.emitter.group.bEnableTrail&&null!=this.trailRenderHelper&&null!=this.trailRenderHelper&&this.trailRenderHelper.updateColor({r:v.x,g:v.y,b:v.z,a:y}),this.emitter.group.colors.setXYZW(this.iBufferIndex,v.x,v.y,v.z,y)}},MSPE.Particle.prototype.dispose=function(){"use strict";this.emitter.group.bEnableTrail&&(this.trailRenderHelper.detach(this.uuidTrial),this.trailRenderHelper.dispose(),this.meshTrial&&this.meshTrial.parent&&this.meshTrial.parent.remove(this.meshTrial)),null!=this.obj&&null!=this.obj&&this.obj.setUse(!1)},MSPE.BufferAttributeObjPool=function(e){"use strict";var t=MSPE.utils,i=t.types;if(null!=(e=t.ensureTypedArg(e,i.OBJECT,{})).iCount&&null!=e.iCount&&"number"==typeof e.iCount){this.iCount=e.iCount,this.objPool=new Array;for(var r=0;r<this.iCount;r++){var n=new MSPE.BufferAttributeObj({iIndex:r});this.objPool.push(n)}}else console.error("[MSPE] : [BufferAttributeObjPool] : error options.iCount;")},MSPE.BufferAttributeObjPool.constructor=MSPE.BufferAttributeObjPool,MSPE.BufferAttributeObjPool.prototype.setUse=function(e,t){"use strict";null!=e&&null!=e&&"number"==typeof e?e+1>this.objPool.length?console.error("[MSPE] : [BufferAttributeObjPool] : [setUse] : error iIndex; iIndex = "+e+"; while this.objPool.length = "+this.objPool.length):null!=t&&null!=t&&"boolean"==typeof t?this.objPool[e].setUse(t):console.error("[MSPE] : [BufferAttributeObjPool] : [setUse] : error bU;"):console.error("[MSPE] : [BufferAttributeObjPool] : [setUse] : error iIndex;")},MSPE.BufferAttributeObjPool.prototype.getUse=function(e){"use strict";if(null!=e&&null!=e&&"number"==typeof e){if(!(e+1>this.objPool.length))return this.objPool[e].getUse();console.error("[MSPE] : [BufferAttributeObjPool] : [getUse] : error iIndex; iIndex = "+e+"; while this.objPool.length = "+this.objPool.length)}else console.error("[MSPE] : [BufferAttributeObjPool] : [getUse] : error iIndex;")},MSPE.BufferAttributeObjPool.prototype.takeAnObj=function(){"use strict";for(var e=0,t=this.objPool.length;e<t;e++)if(!this.objPool[e].getUse())return this.objPool[e];return null},MSPE.BufferAttributeObjPool.prototype.reset=function(){"use strict";for(var e=0,t=this.objPool.length;e<t;e++)this.objPool[e].setUse(!1)},MSPE.BufferAttributeObjPool.prototype.dispose=function(){"use strict";for(var e=0,t=this.objPool.length;e<t;e++)this.objPool[e].dispose()},MSPE.BufferAttributeObj=function(e){"use strict";var t=MSPE.utils,i=t.types;null!=(e=t.ensureTypedArg(e,i.OBJECT,{})).iIndex&&null!=e.iIndex&&"number"==typeof e.iIndex?(this.iIndex=e.iIndex,this.bUsed=!1):console.error("[MSPE] : [BufferAttributeObj] : error options.iIndex;")},MSPE.BufferAttributeObj.constructor=MSPE.BufferAttributeObj,MSPE.BufferAttributeObj.prototype.setUse=function(e){"use strict";this.bUsed=e},MSPE.BufferAttributeObj.prototype.getUse=function(){"use strict";return this.bUsed},MSPE.BufferAttributeObj.prototype.dispose=function(){},function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).poly2tri=e()}}(function(){return function e(t,i,r){function n(a,s){if(!i[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var u=i[a]={exports:{}};t[a][0].call(u.exports,function(e){return n(t[a][1][e]||e)},u,u.exports,e,t,i,r)}return i[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)n(r[a]);return n}({1:[function(e,t,i){t.exports={version:"1.5.0"}},{}],2:[function(e,t,i){"use strict";var r=function(e,t){this.head_=e,this.tail_=t,this.search_node_=e};r.prototype.head=function(){return this.head_},r.prototype.setHead=function(e){this.head_=e},r.prototype.tail=function(){return this.tail_},r.prototype.setTail=function(e){this.tail_=e},r.prototype.search=function(){return this.search_node_},r.prototype.setSearch=function(e){this.search_node_=e},r.prototype.findSearchNode=function(){return this.search_node_},r.prototype.locateNode=function(e){var t=this.search_node_;if(e<t.value){for(;t=t.prev;)if(e>=t.value)return this.search_node_=t,t}else for(;t=t.next;)if(e<t.value)return this.search_node_=t.prev,t.prev;return null},r.prototype.locatePoint=function(e){var t=e.x,i=this.findSearchNode(t),r=i.point.x;if(t===r){if(e!==i.point)if(e===i.prev.point)i=i.prev;else{if(e!==i.next.point)throw new Error("poly2tri Invalid AdvancingFront.locatePoint() call");i=i.next}}else if(t<r)for(;(i=i.prev)&&e!==i.point;);else for(;(i=i.next)&&e!==i.point;);return i&&(this.search_node_=i),i},t.exports=r,t.exports.Node=function(e,t){this.point=e,this.triangle=t||null,this.next=null,this.prev=null,this.value=e.x}},{}],3:[function(e,t,i){"use strict";t.exports=function(e,t){if(!e)throw new Error(t||"Assert Failed")}},{}],4:[function(e,t,i){"use strict";var r=e("./xy"),n=function(e,t){this.x=+e||0,this.y=+t||0,this._p2t_edge_list=null};n.prototype.toString=function(){return r.toStringBase(this)},n.prototype.toJSON=function(){return{x:this.x,y:this.y}},n.prototype.clone=function(){return new n(this.x,this.y)},n.prototype.set_zero=function(){return this.x=0,this.y=0,this},n.prototype.set=function(e,t){return this.x=+e||0,this.y=+t||0,this},n.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},n.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this},n.prototype.sub=function(e){return this.x-=e.x,this.y-=e.y,this},n.prototype.mul=function(e){return this.x*=e,this.y*=e,this},n.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},n.prototype.normalize=function(){var e=this.length();return this.x/=e,this.y/=e,e},n.prototype.equals=function(e){return this.x===e.x&&this.y===e.y},n.negate=function(e){return new n(-e.x,-e.y)},n.add=function(e,t){return new n(e.x+t.x,e.y+t.y)},n.sub=function(e,t){return new n(e.x-t.x,e.y-t.y)},n.mul=function(e,t){return new n(e*t.x,e*t.y)},n.cross=function(e,t){return"number"==typeof e?"number"==typeof t?e*t:new n(-e*t.y,e*t.x):"number"==typeof t?new n(t*e.y,-t*e.x):e.x*t.y-e.y*t.x},n.toString=r.toString,n.compare=r.compare,n.cmp=r.compare,n.equals=r.equals,n.dot=function(e,t){return e.x*t.x+e.y*t.y},t.exports=n},{"./xy":11}],5:[function(e,t,i){"use strict";var r=e("./xy"),n=function(e,t){this.name="PointError",this.points=t=t||[],this.message=e||"Invalid Points!";for(var i=0;i<t.length;i++)this.message+=" "+r.toString(t[i])};(n.prototype=new Error).constructor=n,t.exports=n},{"./xy":11}],6:[function(e,t,i){(function(t){"use strict";var r=t.poly2tri;i.noConflict=function(){return t.poly2tri=r,i},i.VERSION=e("../dist/version.json").version,i.PointError=e("./pointerror"),i.Point=e("./point"),i.Triangle=e("./triangle"),i.SweepContext=e("./sweepcontext");var n=e("./sweep");i.triangulate=n.triangulate,i.sweep={Triangulate:n.triangulate}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../dist/version.json":1,"./point":4,"./pointerror":5,"./sweep":7,"./sweepcontext":8,"./triangle":9}],7:[function(e,t,i){"use strict";function r(e,t){var i=e.locateNode(t),r=function(e,t,i){var r=new b(t,i.point,i.next.point);r.markNeighbor(i.triangle),e.addToMap(r);var n=new _(t);return n.next=i.next,n.prev=i,i.next.prev=n,i.next=n,l(e,r)||e.mapTriangleToNodes(r),n}(e,t,i);return t.x<=i.point.x+E&&s(e,i),function(e,t){for(var i=t.next;i.next&&!M(i.point,i.next.point,i.prev.point);)s(e,i),i=i.next;for(i=t.prev;i.prev&&!M(i.point,i.next.point,i.prev.point);)s(e,i),i=i.prev;t.next&&t.next.next&&function(e){var t=e.point.x-e.next.next.point.x,i=e.point.y-e.next.next.point.y;return v(i>=0,"unordered y"),t>=0||Math.abs(t)<i}(t)&&function(e,t){for(T(t.point,t.next.point,t.next.next.point)===w.CCW?e.basin.left_node=t.next.next:e.basin.left_node=t.next,e.basin.bottom_node=e.basin.left_node;e.basin.bottom_node.next&&e.basin.bottom_node.point.y>=e.basin.bottom_node.next.point.y;)e.basin.bottom_node=e.basin.bottom_node.next;if(e.basin.bottom_node!==e.basin.left_node){for(e.basin.right_node=e.basin.bottom_node;e.basin.right_node.next&&e.basin.right_node.point.y<e.basin.right_node.next.point.y;)e.basin.right_node=e.basin.right_node.next;e.basin.right_node!==e.basin.bottom_node&&(e.basin.width=e.basin.right_node.point.x-e.basin.left_node.point.x,e.basin.left_highest=e.basin.left_node.point.y>e.basin.right_node.point.y,function e(t,i){if(!function(e,t){var i;return i=e.basin.left_highest?e.basin.left_node.point.y-t.point.y:e.basin.right_node.point.y-t.point.y,e.basin.width>i}(t,i)&&(s(t,i),i.prev!==t.basin.left_node||i.next!==t.basin.right_node)){if(i.prev===t.basin.left_node){if(T(i.point,i.next.point,i.next.next.point)===w.CW)return;i=i.next}else if(i.next===t.basin.right_node){if(T(i.point,i.prev.point,i.prev.prev.point)===w.CCW)return;i=i.prev}else i=i.prev.point.y<i.next.point.y?i.prev:i.next;e(t,i)}}(e,e.basin.bottom_node))}}(e,t)}(e,r),r}function n(e,t,i){e.edge_event.constrained_edge=t,e.edge_event.right=t.p.x>t.q.x,a(i.triangle,t.p,t.q)||(function(e,t,i){e.edge_event.right?function(e,t,i){for(;i.next.point.x<t.p.x;)T(t.q,i.next.point,t.p)===w.CCW?h(e,t,i):i=i.next}(e,t,i):function(e,t,i){for(;i.prev.point.x>t.p.x;)T(t.q,i.prev.point,t.p)===w.CW?d(e,t,i):i=i.prev}(e,t,i)}(e,t,i),o(e,t.p,t.q,i.triangle,t.q))}function o(e,t,i,r,n){if(!a(r,t,i)){var s=r.pointCCW(n),l=T(i,s,t);if(l===w.COLLINEAR)throw new y("poly2tri EdgeEvent: Collinear not supported!",[i,s,t]);var c=r.pointCW(n),u=T(i,c,t);if(u===w.COLLINEAR)throw new y("poly2tri EdgeEvent: Collinear not supported!",[i,c,t]);l===u?o(e,t,i,r=l===w.CW?r.neighborCCW(n):r.neighborCW(n),n):m(e,t,i,r,n)}}function a(e,t,i){var r=e.edgeIndex(t,i);if(-1!==r){e.markConstrainedEdgeByIndex(r);var n=e.getNeighbor(r);return n&&n.markConstrainedEdgeByPoints(t,i),!0}return!1}function s(e,t){var i=new b(t.prev.point,t.point,t.next.point);i.markNeighbor(t.prev.triangle),i.markNeighbor(t.triangle),e.addToMap(i),t.prev.next=t.next,t.next.prev=t.prev,l(e,i)||e.mapTriangleToNodes(i)}function l(e,t){for(var i=0;i<3;++i)if(!t.delaunay_edge[i]){var r=t.getNeighbor(i);if(r){var n=t.getPoint(i),o=r.oppositePoint(t,n),a=r.index(o);if(r.constrained_edge[a]||r.delaunay_edge[a]){t.constrained_edge[i]=r.constrained_edge[a];continue}if(c(n,t.pointCCW(n),t.pointCW(n),o)){t.delaunay_edge[i]=!0,r.delaunay_edge[a]=!0,u(t,n,r,o);var s=!l(e,t);return s&&e.mapTriangleToNodes(t),(s=!l(e,r))&&e.mapTriangleToNodes(r),t.delaunay_edge[i]=!1,r.delaunay_edge[a]=!1,!0}}}return!1}function c(e,t,i,r){var n=e.x-r.x,o=e.y-r.y,a=t.x-r.x,s=t.y-r.y,l=n*s-a*o;if(l<=0)return!1;var c=i.x-r.x,u=i.y-r.y,h=c*o-n*u;return!(h<=0)&&(n*n+o*o)*(a*u-c*s)+(a*a+s*s)*h+(c*c+u*u)*l>0}function u(e,t,i,r){var n,o,a,s,l,c,u,h,p,d,f,m;n=e.neighborCCW(t),o=e.neighborCW(t),a=i.neighborCCW(r),s=i.neighborCW(r),l=e.getConstrainedEdgeCCW(t),c=e.getConstrainedEdgeCW(t),u=i.getConstrainedEdgeCCW(r),h=i.getConstrainedEdgeCW(r),p=e.getDelaunayEdgeCCW(t),d=e.getDelaunayEdgeCW(t),f=i.getDelaunayEdgeCCW(r),m=i.getDelaunayEdgeCW(r),e.legalize(t,r),i.legalize(r,t),i.setDelaunayEdgeCCW(t,p),e.setDelaunayEdgeCW(t,d),e.setDelaunayEdgeCCW(r,f),i.setDelaunayEdgeCW(r,m),i.setConstrainedEdgeCCW(t,l),e.setConstrainedEdgeCW(t,c),e.setConstrainedEdgeCCW(r,u),i.setConstrainedEdgeCW(r,h),e.clearNeighbors(),i.clearNeighbors(),n&&i.markNeighbor(n),o&&e.markNeighbor(o),a&&e.markNeighbor(a),s&&i.markNeighbor(s),e.markNeighbor(i)}function h(e,t,i){i.point.x<t.p.x&&(T(i.point,i.next.point,i.next.next.point)===w.CCW?p(e,t,i):(function e(t,i,r){T(r.next.point,r.next.next.point,r.next.next.next.point)===w.CCW?p(t,i,r.next):T(i.q,r.next.next.point,i.p)===w.CCW&&e(t,i,r.next)}(e,t,i),h(e,t,i)))}function p(e,t,i){s(e,i.next),i.next.point!==t.p&&T(t.q,i.next.point,t.p)===w.CCW&&T(i.point,i.next.point,i.next.next.point)===w.CCW&&p(e,t,i)}function d(e,t,i){i.point.x>t.p.x&&(T(i.point,i.prev.point,i.prev.prev.point)===w.CW?f(e,t,i):(function e(t,i,r){T(r.prev.point,r.prev.prev.point,r.prev.prev.prev.point)===w.CW?f(t,i,r.prev):T(i.q,r.prev.prev.point,i.p)===w.CW&&e(t,i,r.prev)}(e,t,i),d(e,t,i)))}function f(e,t,i){s(e,i.prev),i.prev.point!==t.p&&T(t.q,i.prev.point,t.p)===w.CW&&T(i.point,i.prev.point,i.prev.prev.point)===w.CW&&f(e,t,i)}function m(e,t,i,r,n){var a=r.neighborAcross(n);v(a,"FLIP failed due to missing triangle!");var s=a.oppositePoint(r,n);if(r.getConstrainedEdgeAcross(n)){var c=r.index(n);throw new y("poly2tri Intersecting Constraints",[n,s,r.getPoint((c+1)%3),r.getPoint((c+2)%3)])}if(S(n,r.pointCCW(n),r.pointCW(n),s))if(u(r,n,a,s),e.mapTriangleToNodes(r),e.mapTriangleToNodes(a),n===i&&s===t)i===e.edge_event.constrained_edge.q&&t===e.edge_event.constrained_edge.p&&(r.markConstrainedEdgeByPoints(t,i),a.markConstrainedEdgeByPoints(t,i),l(e,r),l(e,a));else{r=function(e,t,i,r,n,o){var a;return t===w.CCW?(a=r.edgeIndex(n,o),r.delaunay_edge[a]=!0,l(e,r),r.clearDelaunayEdges(),i):(a=i.edgeIndex(n,o),i.delaunay_edge[a]=!0,l(e,i),i.clearDelaunayEdges(),r)}(e,T(i,s,t),r,a,n,s),m(e,t,i,r,n)}else(function e(t,i,r,n,o,a){var s=o.neighborAcross(a);v(s,"FLIP failed due to missing triangle");var l=s.oppositePoint(o,a);S(r,n.pointCCW(r),n.pointCW(r),l)?m(t,r,l,s,l):e(t,i,r,n,s,g(i,r,s,l))})(e,t,i,r,a,g(t,i,a,s)),o(e,t,i,r,n)}function g(e,t,i,r){var n=T(t,r,e);if(n===w.CW)return i.pointCCW(r);if(n===w.CCW)return i.pointCW(r);throw new y("poly2tri [Unsupported] nextFlipPoint: opposing point on constrained edge!",[t,r,e])}var v=e("./assert"),y=e("./pointerror"),b=e("./triangle"),_=e("./advancingfront").Node,x=e("./utils"),E=x.EPSILON,w=x.Orientation,T=x.orient2d,S=x.inScanArea,M=x.isAngleObtuse;i.triangulate=function(e){e.initTriangulation(),e.createAdvancingFront(),function(e){var t,i=e.pointCount();for(t=1;t<i;++t)for(var o=e.getPoint(t),a=r(e,o),s=o._p2t_edge_list,l=0;s&&l<s.length;++l)n(e,s[l],a)}(e),function(e){for(var t=e.front().head().next.triangle,i=e.front().head().next.point;!t.getConstrainedEdgeCW(i);)t=t.neighborCCW(i);e.meshClean(t)}(e)}},{"./advancingfront":2,"./assert":3,"./pointerror":5,"./triangle":9,"./utils":10}],8:[function(e,t,i){"use strict";var r=e("./pointerror"),n=e("./point"),o=e("./triangle"),a=e("./sweep"),s=e("./advancingfront"),l=s.Node,c=function(e,t){if(this.p=e,this.q=t,e.y>t.y)this.q=e,this.p=t;else if(e.y===t.y)if(e.x>t.x)this.q=e,this.p=t;else if(e.x===t.x)throw new r("poly2tri Invalid Edge constructor: repeated points!",[e]);this.q._p2t_edge_list||(this.q._p2t_edge_list=[]),this.q._p2t_edge_list.push(this)},u=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};u.prototype.clear=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};var h=function(){this.constrained_edge=null,this.right=!1},p=function(e,t){t=t||{},this.triangles_=[],this.map_=[],this.points_=t.cloneArrays?e.slice(0):e,this.edge_list=[],this.pmin_=this.pmax_=null,this.front_=null,this.head_=null,this.tail_=null,this.af_head_=null,this.af_middle_=null,this.af_tail_=null,this.basin=new u,this.edge_event=new h,this.initEdges(this.points_)};p.prototype.addHole=function(e){this.initEdges(e);var t,i=e.length;for(t=0;t<i;t++)this.points_.push(e[t]);return this},p.prototype.AddHole=p.prototype.addHole,p.prototype.addHoles=function(e){var t,i=e.length;for(t=0;t<i;t++)this.initEdges(e[t]);return this.points_=this.points_.concat.apply(this.points_,e),this},p.prototype.addPoint=function(e){return this.points_.push(e),this},p.prototype.AddPoint=p.prototype.addPoint,p.prototype.addPoints=function(e){return this.points_=this.points_.concat(e),this},p.prototype.triangulate=function(){return a.triangulate(this),this},p.prototype.getBoundingBox=function(){return{min:this.pmin_,max:this.pmax_}},p.prototype.getTriangles=function(){return this.triangles_},p.prototype.GetTriangles=p.prototype.getTriangles,p.prototype.front=function(){return this.front_},p.prototype.pointCount=function(){return this.points_.length},p.prototype.head=function(){return this.head_},p.prototype.setHead=function(e){this.head_=e},p.prototype.tail=function(){return this.tail_},p.prototype.setTail=function(e){this.tail_=e},p.prototype.getMap=function(){return this.map_},p.prototype.initTriangulation=function(){var e,t=this.points_[0].x,i=this.points_[0].x,r=this.points_[0].y,o=this.points_[0].y,a=this.points_.length;for(e=1;e<a;e++){var s=this.points_[e];s.x>t&&(t=s.x),s.x<i&&(i=s.x),s.y>r&&(r=s.y),s.y<o&&(o=s.y)}this.pmin_=new n(i,o),this.pmax_=new n(t,r);var l=.3*(t-i),c=.3*(r-o);this.head_=new n(t+l,o-c),this.tail_=new n(i-l,o-c),this.points_.sort(n.compare)},p.prototype.initEdges=function(e){var t,i=e.length;for(t=0;t<i;++t)this.edge_list.push(new c(e[t],e[(t+1)%i]))},p.prototype.getPoint=function(e){return this.points_[e]},p.prototype.addToMap=function(e){this.map_.push(e)},p.prototype.locateNode=function(e){return this.front_.locateNode(e.x)},p.prototype.createAdvancingFront=function(){var e,t,i,r=new o(this.points_[0],this.tail_,this.head_);this.map_.push(r),e=new l(r.getPoint(1),r),t=new l(r.getPoint(0),r),i=new l(r.getPoint(2)),this.front_=new s(e,i),e.next=t,t.next=i,t.prev=e,i.prev=t},p.prototype.removeNode=function(e){},p.prototype.mapTriangleToNodes=function(e){for(var t=0;t<3;++t)if(!e.getNeighbor(t)){var i=this.front_.locatePoint(e.pointCW(e.getPoint(t)));i&&(i.triangle=e)}},p.prototype.removeFromMap=function(e){var t,i=this.map_,r=i.length;for(t=0;t<r;t++)if(i[t]===e){i.splice(t,1);break}},p.prototype.meshClean=function(e){for(var t,i,r=[e];t=r.pop();)if(!t.isInterior())for(t.setInterior(!0),this.triangles_.push(t),i=0;i<3;i++)t.constrained_edge[i]||r.push(t.getNeighbor(i))},t.exports=p},{"./advancingfront":2,"./point":4,"./pointerror":5,"./sweep":7,"./triangle":9}],9:[function(e,t,i){"use strict";var r=function(e,t,i){this.points_=[e,t,i],this.neighbors_=[null,null,null],this.interior_=!1,this.constrained_edge=[!1,!1,!1],this.delaunay_edge=[!1,!1,!1]},n=e("./xy").toString;r.prototype.toString=function(){return"["+n(this.points_[0])+n(this.points_[1])+n(this.points_[2])+"]"},r.prototype.getPoint=function(e){return this.points_[e]},r.prototype.GetPoint=r.prototype.getPoint,r.prototype.getPoints=function(){return this.points_},r.prototype.getNeighbor=function(e){return this.neighbors_[e]},r.prototype.containsPoint=function(e){var t=this.points_;return e===t[0]||e===t[1]||e===t[2]},r.prototype.containsEdge=function(e){return this.containsPoint(e.p)&&this.containsPoint(e.q)},r.prototype.containsPoints=function(e,t){return this.containsPoint(e)&&this.containsPoint(t)},r.prototype.isInterior=function(){return this.interior_},r.prototype.setInterior=function(e){return this.interior_=e,this},r.prototype.markNeighborPointers=function(e,t,i){var r=this.points_;if(e===r[2]&&t===r[1]||e===r[1]&&t===r[2])this.neighbors_[0]=i;else if(e===r[0]&&t===r[2]||e===r[2]&&t===r[0])this.neighbors_[1]=i;else{if(!(e===r[0]&&t===r[1]||e===r[1]&&t===r[0]))throw new Error("poly2tri Invalid Triangle.markNeighborPointers() call");this.neighbors_[2]=i}},r.prototype.markNeighbor=function(e){var t=this.points_;e.containsPoints(t[1],t[2])?(this.neighbors_[0]=e,e.markNeighborPointers(t[1],t[2],this)):e.containsPoints(t[0],t[2])?(this.neighbors_[1]=e,e.markNeighborPointers(t[0],t[2],this)):e.containsPoints(t[0],t[1])&&(this.neighbors_[2]=e,e.markNeighborPointers(t[0],t[1],this))},r.prototype.clearNeighbors=function(){this.neighbors_[0]=null,this.neighbors_[1]=null,this.neighbors_[2]=null},r.prototype.clearDelaunayEdges=function(){this.delaunay_edge[0]=!1,this.delaunay_edge[1]=!1,this.delaunay_edge[2]=!1},r.prototype.pointCW=function(e){var t=this.points_;return e===t[0]?t[2]:e===t[1]?t[0]:e===t[2]?t[1]:null},r.prototype.pointCCW=function(e){var t=this.points_;return e===t[0]?t[1]:e===t[1]?t[2]:e===t[2]?t[0]:null},r.prototype.neighborCW=function(e){return e===this.points_[0]?this.neighbors_[1]:e===this.points_[1]?this.neighbors_[2]:this.neighbors_[0]},r.prototype.neighborCCW=function(e){return e===this.points_[0]?this.neighbors_[2]:e===this.points_[1]?this.neighbors_[0]:this.neighbors_[1]},r.prototype.getConstrainedEdgeCW=function(e){return e===this.points_[0]?this.constrained_edge[1]:e===this.points_[1]?this.constrained_edge[2]:this.constrained_edge[0]},r.prototype.getConstrainedEdgeCCW=function(e){return e===this.points_[0]?this.constrained_edge[2]:e===this.points_[1]?this.constrained_edge[0]:this.constrained_edge[1]},r.prototype.getConstrainedEdgeAcross=function(e){return e===this.points_[0]?this.constrained_edge[0]:e===this.points_[1]?this.constrained_edge[1]:this.constrained_edge[2]},r.prototype.setConstrainedEdgeCW=function(e,t){e===this.points_[0]?this.constrained_edge[1]=t:e===this.points_[1]?this.constrained_edge[2]=t:this.constrained_edge[0]=t},r.prototype.setConstrainedEdgeCCW=function(e,t){e===this.points_[0]?this.constrained_edge[2]=t:e===this.points_[1]?this.constrained_edge[0]=t:this.constrained_edge[1]=t},r.prototype.getDelaunayEdgeCW=function(e){return e===this.points_[0]?this.delaunay_edge[1]:e===this.points_[1]?this.delaunay_edge[2]:this.delaunay_edge[0]},r.prototype.getDelaunayEdgeCCW=function(e){return e===this.points_[0]?this.delaunay_edge[2]:e===this.points_[1]?this.delaunay_edge[0]:this.delaunay_edge[1]},r.prototype.setDelaunayEdgeCW=function(e,t){e===this.points_[0]?this.delaunay_edge[1]=t:e===this.points_[1]?this.delaunay_edge[2]=t:this.delaunay_edge[0]=t},r.prototype.setDelaunayEdgeCCW=function(e,t){e===this.points_[0]?this.delaunay_edge[2]=t:e===this.points_[1]?this.delaunay_edge[0]=t:this.delaunay_edge[1]=t},r.prototype.neighborAcross=function(e){return e===this.points_[0]?this.neighbors_[0]:e===this.points_[1]?this.neighbors_[1]:this.neighbors_[2]},r.prototype.oppositePoint=function(e,t){var i=e.pointCW(t);return this.pointCW(i)},r.prototype.legalize=function(e,t){var i=this.points_;if(e===i[0])i[1]=i[0],i[0]=i[2],i[2]=t;else if(e===i[1])i[2]=i[1],i[1]=i[0],i[0]=t;else{if(e!==i[2])throw new Error("poly2tri Invalid Triangle.legalize() call");i[0]=i[2],i[2]=i[1],i[1]=t}},r.prototype.index=function(e){var t=this.points_;if(e===t[0])return 0;if(e===t[1])return 1;if(e===t[2])return 2;throw new Error("poly2tri Invalid Triangle.index() call")},r.prototype.edgeIndex=function(e,t){var i=this.points_;if(e===i[0]){if(t===i[1])return 2;if(t===i[2])return 1}else if(e===i[1]){if(t===i[2])return 0;if(t===i[0])return 2}else if(e===i[2]){if(t===i[0])return 1;if(t===i[1])return 0}return-1},r.prototype.markConstrainedEdgeByIndex=function(e){this.constrained_edge[e]=!0},r.prototype.markConstrainedEdgeByEdge=function(e){this.markConstrainedEdgeByPoints(e.p,e.q)},r.prototype.markConstrainedEdgeByPoints=function(e,t){var i=this.points_;t===i[0]&&e===i[1]||t===i[1]&&e===i[0]?this.constrained_edge[2]=!0:t===i[0]&&e===i[2]||t===i[2]&&e===i[0]?this.constrained_edge[1]=!0:(t===i[1]&&e===i[2]||t===i[2]&&e===i[1])&&(this.constrained_edge[0]=!0)},t.exports=r},{"./xy":11}],10:[function(e,t,i){"use strict";var r=1e-12;i.EPSILON=r;var n={CW:1,CCW:-1,COLLINEAR:0};i.Orientation=n,i.orient2d=function(e,t,i){var o=(e.x-i.x)*(t.y-i.y)-(e.y-i.y)*(t.x-i.x);return o>-r&&o<r?n.COLLINEAR:o>0?n.CCW:n.CW},i.inScanArea=function(e,t,i,n){return!((e.x-t.x)*(n.y-t.y)-(n.x-t.x)*(e.y-t.y)>=-r||(e.x-i.x)*(n.y-i.y)-(n.x-i.x)*(e.y-i.y)<=r)},i.isAngleObtuse=function(e,t,i){var r=t.x-e.x,n=t.y-e.y;return r*(i.x-e.x)+n*(i.y-e.y)<0}},{}],11:[function(e,t,i){"use strict";function r(e){return"("+e.x+";"+e.y+")"}t.exports={toString:function(e){var t=e.toString();return"[object Object]"===t?r(e):t},toStringBase:r,compare:function(e,t){return e.y===t.y?e.x-t.x:e.y-t.y},equals:function(e,t){return e.x===t.x&&e.y===t.y}}},{}]},{},[6])(6)}),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).polylabel=e()}}(function(){return function e(t,i,r){function n(a,s){if(!i[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var u=i[a]={exports:{}};t[a][0].call(u.exports,function(e){var i=t[a][1][e];return n(i||e)},u,u.exports,e,t,i,r)}return i[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)n(r[a]);return n}({1:[function(e,t,i){"use strict";var r=e("tinyqueue");function n(e,t,i){var n,s,l,c;t=t||1;for(var u=0;u<e[0].length;u++){var h=e[0][u];(!u||h[0]<n)&&(n=h[0]),(!u||h[1]<s)&&(s=h[1]),(!u||h[0]>l)&&(l=h[0]),(!u||h[1]>c)&&(c=h[1])}var p=l-n,d=c-s,f=Math.min(p,d),m=f/2,g=new r(null,o);if(0===f)return[n,s];for(var v=n;v<l;v+=f)for(var y=s;y<c;y+=f)g.push(new a(v+m,y+m,m,e));var b=function(e){for(var t=0,i=0,r=0,n=e[0],o=0,s=n.length,l=s-1;o<s;l=o++){var c=n[o],u=n[l],h=c[0]*u[1]-u[0]*c[1];i+=(c[0]+u[0])*h,r+=(c[1]+u[1])*h,t+=3*h}return 0===t?new a(n[0][0],n[0][1],0,e):new a(i/t,r/t,0,e)}(e),_=new a(n+p/2,s+d/2,0,e);_.d>b.d&&(b=_);for(var x=g.length;g.length;){var E=g.pop();E.d>b.d&&(b=E,i&&console.log("found best %d after %d probes",Math.round(1e4*E.d)/1e4,x)),E.max-b.d<=t||(m=E.h/2,g.push(new a(E.x-m,E.y-m,m,e)),g.push(new a(E.x+m,E.y-m,m,e)),g.push(new a(E.x-m,E.y+m,m,e)),g.push(new a(E.x+m,E.y+m,m,e)),x+=4)}return i&&(console.log("num probes: "+x),console.log("best distance: "+b.d)),[b.x,b.y]}function o(e,t){return t.max-e.max}function a(e,t,i,r){this.x=e,this.y=t,this.h=i,this.d=function(e,t,i){for(var r=!1,n=1/0,o=0;o<i.length;o++)for(var a=i[o],l=0,c=a.length,u=c-1;l<c;u=l++){var h=a[l],p=a[u];h[1]>t!=p[1]>t&&e<(p[0]-h[0])*(t-h[1])/(p[1]-h[1])+h[0]&&(r=!r),n=Math.min(n,s(e,t,h,p))}return(r?1:-1)*Math.sqrt(n)}(e,t,r),this.max=this.d+this.h*Math.SQRT2}function s(e,t,i,r){var n=i[0],o=i[1],a=r[0]-n,s=r[1]-o;if(0!==a||0!==s){var l=((e-n)*a+(t-o)*s)/(a*a+s*s);l>1?(n=r[0],o=r[1]):l>0&&(n+=a*l,o+=s*l)}return(a=e-n)*a+(s=t-o)*s}t.exports=n,t.exports.default=n},{tinyqueue:2}],2:[function(e,t,i){"use strict";function r(e,t){if(!(this instanceof r))return new r(e,t);if(this.data=e||[],this.length=this.data.length,this.compare=t||n,this.length>0)for(var i=(this.length>>1)-1;i>=0;i--)this._down(i)}function n(e,t){return e<t?-1:e>t?1:0}t.exports=r,t.exports.default=r,r.prototype={push:function(e){this.data.push(e),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var e=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),e}},peek:function(){return this.data[0]},_up:function(e){for(var t=this.data,i=this.compare,r=t[e];e>0;){var n=e-1>>1,o=t[n];if(i(r,o)>=0)break;t[e]=o,e=n}t[e]=r},_down:function(e){for(var t=this.data,i=this.compare,r=this.length>>1,n=t[e];e<r;){var o=1+(e<<1),a=o+1,s=t[o];if(a<this.length&&i(t[a],s)<0&&(o=a,s=t[a]),i(s,n)>=0)break;t[e]=s,e=o}t[e]=n}}},{}]},{},[1])(1)}),SimpleHeatmap.prototype=Object.assign(Object.create({}),{constructor:SimpleHeatmap,defaultRadius:25,defaultGradient:{.4:"blue",.6:"cyan",.7:"lime",.8:"yellow",1:"red"},canvas:function(){return this._canvas},data:function(e){return this._data=e,this._dataDirty=!0,this},add:function(e){return this._data.push(e),this._dataDirty=!0,this},clear:function(){return this._data=[],this._dataDirty=!0,this},max:function(e){return this._max!==e&&(this._max=e,this._dataDirty=!0),this},min:function(e){return this._min!==e&&(this._min=e,this._dataDirty=!0),this},setCanvasSize:function(e,t){return this._canvasWidth===e&&this._canvasHeight===t||(this._canvasWidth=this._canvas.width=e,this._canvasHeight=this._canvas.height=t,this._dataDirty=!0),this},setAreaSize:function(e,t){return this._areaWidth===e&&this._areaHeight===t||(this._areaWidth=e,this._areaHeight=t,this._dataDirty=!0),this},alpha:function(e){return this._alpha=e,this},radius:function(e,t){if(t=void 0!==t?t:15,e===this._radius&&t===this._blur)return this;this._radius=e,this._blur=t,this._r=this._radius+this._blur;var i=this._circle,r=this._cirCtx;return i.width=i.height=2*this._r,r.shadowOffsetX=r.shadowOffsetY=2*this._r,r.shadowBlur=t,r.shadowColor="black",r.beginPath(),r.arc(-this._r,-this._r,e,0,2*Math.PI,!0),r.closePath(),r.fill(),this},gradient:function(e){var t=this._getGradientCode(this._grad),i=this._getGradientCode(e);if(t===i)return this;if(this._grad=Object.assign({},e),this._gradCache[i])return this._gradData=this._gradCache[i],this;var r=this._gradCtx.createLinearGradient(0,0,0,256);for(var n in e)r.addColorStop(+n,e[n]);return this._gradCtx.fillStyle=r,this._gradCtx.fillRect(0,0,1,256),this._gradData=this._gradCtx.getImageData(0,0,1,256).data,this._gradCache[i]=this._gradData,this},draw:function(){0===this._r&&this.radius(this.defaultRadius),this._gradData||this.gradient(this.defaultGradient),this._dataDirty&&this._transformData();var e=this._ctx;e.clearRect(0,0,this._canvasWidth,this._canvasHeight);for(var t,i=0,r=this._transformedData.length;i<r;i++)t=this._transformedData[i],e.globalAlpha=t[2],e.drawImage(this._circle,t[0]-this._r,t[1]-this._r);var n=e.getImageData(0,0,this._canvasWidth,this._canvasHeight);return this._colorize(n.data,this._gradData,this._alpha),e.putImageData(n,0,0),this},_transformData:function(){this._transformedData=[];var e=this._canvasWidth/this._areaWidth,t=this._canvasHeight/this._areaHeight,i=this;this._data.map(function(r){var n=r[0],o=r[1];n=n*e+i._canvasWidth/2,o=o*t+i._canvasHeight/2;var a=Math.min(Math.max((r[2]-i._min)/(i._max-i._min),.05),1);i._transformedData.push([n,o,a])})},_colorize:function(e,t,i){for(var r,n=0,o=e.length;n<o;n+=4)r=4*e[n+3],i&&0===r||(e[n]=t[r],e[n+1]=t[r+1],e[n+2]=t[r+2],i||(e[n+3]=255))},_getGradientCode:function(e){var t="grad:(";for(var i in e)t+=i+":"+e[i]+",";return t+=")"},_createCanvas:function(){return"undefined"!=typeof document?document.createElement("canvas"):new this._canvas.constructor}}),function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var t;try{t=window}catch(e){t=self}t.SparkMD5=e()}}(function(e){"use strict";var t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function i(e,t){var i=e[0],r=e[1],n=e[2],o=e[3];r=((r+=((n=((n+=((o=((o+=((i=((i+=(r&n|~r&o)+t[0]-680876936|0)<<7|i>>>25)+r|0)&r|~i&n)+t[1]-389564586|0)<<12|o>>>20)+i|0)&i|~o&r)+t[2]+606105819|0)<<17|n>>>15)+o|0)&o|~n&i)+t[3]-1044525330|0)<<22|r>>>10)+n|0,r=((r+=((n=((n+=((o=((o+=((i=((i+=(r&n|~r&o)+t[4]-176418897|0)<<7|i>>>25)+r|0)&r|~i&n)+t[5]+1200080426|0)<<12|o>>>20)+i|0)&i|~o&r)+t[6]-1473231341|0)<<17|n>>>15)+o|0)&o|~n&i)+t[7]-45705983|0)<<22|r>>>10)+n|0,r=((r+=((n=((n+=((o=((o+=((i=((i+=(r&n|~r&o)+t[8]+1770035416|0)<<7|i>>>25)+r|0)&r|~i&n)+t[9]-1958414417|0)<<12|o>>>20)+i|0)&i|~o&r)+t[10]-42063|0)<<17|n>>>15)+o|0)&o|~n&i)+t[11]-1990404162|0)<<22|r>>>10)+n|0,r=((r+=((n=((n+=((o=((o+=((i=((i+=(r&n|~r&o)+t[12]+1804603682|0)<<7|i>>>25)+r|0)&r|~i&n)+t[13]-40341101|0)<<12|o>>>20)+i|0)&i|~o&r)+t[14]-1502002290|0)<<17|n>>>15)+o|0)&o|~n&i)+t[15]+1236535329|0)<<22|r>>>10)+n|0,r=((r+=((n=((n+=((o=((o+=((i=((i+=(r&o|n&~o)+t[1]-165796510|0)<<5|i>>>27)+r|0)&n|r&~n)+t[6]-1069501632|0)<<9|o>>>23)+i|0)&r|i&~r)+t[11]+643717713|0)<<14|n>>>18)+o|0)&i|o&~i)+t[0]-373897302|0)<<20|r>>>12)+n|0,r=((r+=((n=((n+=((o=((o+=((i=((i+=(r&o|n&~o)+t[5]-701558691|0)<<5|i>>>27)+r|0)&n|r&~n)+t[10]+38016083|0)<<9|o>>>23)+i|0)&r|i&~r)+t[15]-660478335|0)<<14|n>>>18)+o|0)&i|o&~i)+t[4]-405537848|0)<<20|r>>>12)+n|0,r=((r+=((n=((n+=((o=((o+=((i=((i+=(r&o|n&~o)+t[9]+568446438|0)<<5|i>>>27)+r|0)&n|r&~n)+t[14]-1019803690|0)<<9|o>>>23)+i|0)&r|i&~r)+t[3]-187363961|0)<<14|n>>>18)+o|0)&i|o&~i)+t[8]+1163531501|0)<<20|r>>>12)+n|0,r=((r+=((n=((n+=((o=((o+=((i=((i+=(r&o|n&~o)+t[13]-1444681467|0)<<5|i>>>27)+r|0)&n|r&~n)+t[2]-51403784|0)<<9|o>>>23)+i|0)&r|i&~r)+t[7]+1735328473|0)<<14|n>>>18)+o|0)&i|o&~i)+t[12]-1926607734|0)<<20|r>>>12)+n|0,r=((r+=((n=((n+=((o=((o+=((i=((i+=(r^n^o)+t[5]-378558|0)<<4|i>>>28)+r|0)^r^n)+t[8]-2022574463|0)<<11|o>>>21)+i|0)^i^r)+t[11]+1839030562|0)<<16|n>>>16)+o|0)^o^i)+t[14]-35309556|0)<<23|r>>>9)+n|0,r=((r+=((n=((n+=((o=((o+=((i=((i+=(r^n^o)+t[1]-1530992060|0)<<4|i>>>28)+r|0)^r^n)+t[4]+1272893353|0)<<11|o>>>21)+i|0)^i^r)+t[7]-155497632|0)<<16|n>>>16)+o|0)^o^i)+t[10]-1094730640|0)<<23|r>>>9)+n|0,r=((r+=((n=((n+=((o=((o+=((i=((i+=(r^n^o)+t[13]+681279174|0)<<4|i>>>28)+r|0)^r^n)+t[0]-358537222|0)<<11|o>>>21)+i|0)^i^r)+t[3]-722521979|0)<<16|n>>>16)+o|0)^o^i)+t[6]+76029189|0)<<23|r>>>9)+n|0,r=((r+=((n=((n+=((o=((o+=((i=((i+=(r^n^o)+t[9]-640364487|0)<<4|i>>>28)+r|0)^r^n)+t[12]-421815835|0)<<11|o>>>21)+i|0)^i^r)+t[15]+530742520|0)<<16|n>>>16)+o|0)^o^i)+t[2]-995338651|0)<<23|r>>>9)+n|0,r=((r+=((o=((o+=(r^((i=((i+=(n^(r|~o))+t[0]-198630844|0)<<6|i>>>26)+r|0)|~n))+t[7]+1126891415|0)<<10|o>>>22)+i|0)^((n=((n+=(i^(o|~r))+t[14]-1416354905|0)<<15|n>>>17)+o|0)|~i))+t[5]-57434055|0)<<21|r>>>11)+n|0,r=((r+=((o=((o+=(r^((i=((i+=(n^(r|~o))+t[12]+1700485571|0)<<6|i>>>26)+r|0)|~n))+t[3]-1894986606|0)<<10|o>>>22)+i|0)^((n=((n+=(i^(o|~r))+t[10]-1051523|0)<<15|n>>>17)+o|0)|~i))+t[1]-2054922799|0)<<21|r>>>11)+n|0,r=((r+=((o=((o+=(r^((i=((i+=(n^(r|~o))+t[8]+1873313359|0)<<6|i>>>26)+r|0)|~n))+t[15]-30611744|0)<<10|o>>>22)+i|0)^((n=((n+=(i^(o|~r))+t[6]-1560198380|0)<<15|n>>>17)+o|0)|~i))+t[13]+1309151649|0)<<21|r>>>11)+n|0,r=((r+=((o=((o+=(r^((i=((i+=(n^(r|~o))+t[4]-145523070|0)<<6|i>>>26)+r|0)|~n))+t[11]-1120210379|0)<<10|o>>>22)+i|0)^((n=((n+=(i^(o|~r))+t[2]+718787259|0)<<15|n>>>17)+o|0)|~i))+t[9]-343485551|0)<<21|r>>>11)+n|0,e[0]=i+e[0]|0,e[1]=r+e[1]|0,e[2]=n+e[2]|0,e[3]=o+e[3]|0}function r(e){var t,i=[];for(t=0;t<64;t+=4)i[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return i}function n(e){var t,i=[];for(t=0;t<64;t+=4)i[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return i}function o(e){var t,n,o,a,s,l,c=e.length,u=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=c;t+=64)i(u,r(e.substring(t-64,t)));for(n=(e=e.substring(t-64)).length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<n;t+=1)o[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(o[t>>2]|=128<<(t%4<<3),t>55)for(i(u,o),t=0;t<16;t+=1)o[t]=0;return a=(a=8*c).toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(a[2],16),l=parseInt(a[1],16)||0,o[14]=s,o[15]=l,i(u,o),u}function a(e){var i,r="";for(i=0;i<4;i+=1)r+=t[e>>8*i+4&15]+t[e>>8*i&15];return r}function s(e){var t;for(t=0;t<e.length;t+=1)e[t]=a(e[t]);return e.join("")}function l(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function c(e){var t,i=[],r=e.length;for(t=0;t<r-1;t+=2)i.push(parseInt(e.substr(t,2),16));return String.fromCharCode.apply(String,i)}function u(){this.reset()}return"5d41402abc4b2a76b9719d911017c592"!==s(o("hello"))&&function(e,t){var i=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(i>>16)<<16|65535&i},"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function t(e,t){return(e=0|e||0)<0?Math.max(e+t,0):Math.min(e,t)}ArrayBuffer.prototype.slice=function(i,r){var n,o,a,s,l=this.byteLength,c=t(i,l),u=l;return r!==e&&(u=t(r,l)),c>u?new ArrayBuffer(0):(n=u-c,o=new ArrayBuffer(n),a=new Uint8Array(o),s=new Uint8Array(this,c,n),a.set(s),o)}}(),u.prototype.append=function(e){return this.appendBinary(l(e)),this},u.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var t,n=this._buff.length;for(t=64;t<=n;t+=64)i(this._hash,r(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},u.prototype.end=function(e){var t,i,r=this._buff,n=r.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<n;t+=1)o[t>>2]|=r.charCodeAt(t)<<(t%4<<3);return this._finish(o,n),i=s(this._hash),e&&(i=c(i)),this.reset(),i},u.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},u.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},u.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},u.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},u.prototype._finish=function(e,t){var r,n,o,a=t;if(e[a>>2]|=128<<(a%4<<3),a>55)for(i(this._hash,e),a=0;a<16;a+=1)e[a]=0;r=(r=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),n=parseInt(r[2],16),o=parseInt(r[1],16)||0,e[14]=n,e[15]=o,i(this._hash,e)},u.hash=function(e,t){return u.hashBinary(l(e),t)},u.hashBinary=function(e,t){var i=s(o(e));return t?c(i):i},u.ArrayBuffer=function(){this.reset()},u.ArrayBuffer.prototype.append=function(e){var t,r,o,a,s,l=(r=this._buff.buffer,o=e,a=!0,(s=new Uint8Array(r.byteLength+o.byteLength)).set(new Uint8Array(r)),s.set(new Uint8Array(o),r.byteLength),a?s:s.buffer),c=l.length;for(this._length+=e.byteLength,t=64;t<=c;t+=64)i(this._hash,n(l.subarray(t-64,t)));return this._buff=t-64<c?new Uint8Array(l.buffer.slice(t-64)):new Uint8Array(0),this},u.ArrayBuffer.prototype.end=function(e){var t,i,r=this._buff,n=r.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<n;t+=1)o[t>>2]|=r[t]<<(t%4<<3);return this._finish(o,n),i=s(this._hash),e&&(i=c(i)),this.reset(),i},u.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},u.ArrayBuffer.prototype.getState=function(){var e,t=u.prototype.getState.call(this);return t.buff=(e=t.buff,String.fromCharCode.apply(null,new Uint8Array(e))),t},u.ArrayBuffer.prototype.setState=function(e){return e.buff=function(e,t){var i,r=e.length,n=new ArrayBuffer(r),o=new Uint8Array(n);for(i=0;i<r;i+=1)o[i]=e.charCodeAt(i);return t?o:n}(e.buff,!0),u.prototype.setState.call(this,e)},u.ArrayBuffer.prototype.destroy=u.prototype.destroy,u.ArrayBuffer.prototype._finish=u.prototype._finish,u.ArrayBuffer.hash=function(e,t){var r=s(function(e){var t,r,o,a,s,l,c=e.length,u=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=c;t+=64)i(u,n(e.subarray(t-64,t)));for(r=(e=t-64<c?e.subarray(t-64):new Uint8Array(0)).length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<r;t+=1)o[t>>2]|=e[t]<<(t%4<<3);if(o[t>>2]|=128<<(t%4<<3),t>55)for(i(u,o),t=0;t<16;t+=1)o[t]=0;return a=(a=8*c).toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(a[2],16),l=parseInt(a[1],16)||0,o[14]=s,o[15]=l,i(u,o),u}(new Uint8Array(e)));return t?c(r):r},u});var SPE={distributions:{BOX:1,SPHERE:2,DISC:3},valueOverLifetimeLength:4};function TextEncoderLite(){}function TextDecoderLite(){}"function"==typeof define&&define.amd?define("spe",SPE):"undefined"!=typeof exports&&"undefined"!=typeof module&&(module.exports=SPE),SPE.TypedArrayHelper=function(e,t,i,r){"use strict";this.componentSize=i||1,this.size=t||1,this.TypedArrayConstructor=e||Float32Array,this.array=new e(t*this.componentSize),this.indexOffset=r||0},SPE.TypedArrayHelper.constructor=SPE.TypedArrayHelper,SPE.TypedArrayHelper.prototype.setSize=function(e,t){"use strict";var i=this.array.length;return t||(e*=this.componentSize),e<i?this.shrink(e):e>i?this.grow(e):void console.info("TypedArray is already of size:",e+".","Will not resize.")},SPE.TypedArrayHelper.prototype.shrink=function(e){"use strict";return this.array=this.array.subarray(0,e),this.size=e,this},SPE.TypedArrayHelper.prototype.grow=function(e){"use strict";var t=this.array,i=new this.TypedArrayConstructor(e);return i.set(t),this.array=i,this.size=e,this},SPE.TypedArrayHelper.prototype.splice=function(e,t){"use strict";e*=this.componentSize,t*=this.componentSize;for(var i=[],r=this.array,n=r.length,o=0;o<n;++o)(o<e||o>=t)&&i.push(r[o]);return this.setFromArray(0,i),this},SPE.TypedArrayHelper.prototype.setFromArray=function(e,t){"use strict";var i=e+t.length;return i>this.array.length?this.grow(i):i<this.array.length&&this.shrink(i),this.array.set(t,this.indexOffset+e),this},SPE.TypedArrayHelper.prototype.setVec2=function(e,t){"use strict";return this.setVec2Components(e,t.x,t.y)},SPE.TypedArrayHelper.prototype.setVec2Components=function(e,t,i){"use strict";var r=this.array,n=this.indexOffset+e*this.componentSize;return r[n]=t,r[n+1]=i,this},SPE.TypedArrayHelper.prototype.setVec3=function(e,t){"use strict";return this.setVec3Components(e,t.x,t.y,t.z)},SPE.TypedArrayHelper.prototype.setVec3Components=function(e,t,i,r){"use strict";var n=this.array,o=this.indexOffset+e*this.componentSize;return n[o]=t,n[o+1]=i,n[o+2]=r,this},SPE.TypedArrayHelper.prototype.setVec4=function(e,t){"use strict";return this.setVec4Components(e,t.x,t.y,t.z,t.w)},SPE.TypedArrayHelper.prototype.setVec4Components=function(e,t,i,r,n){"use strict";var o=this.array,a=this.indexOffset+e*this.componentSize;return o[a]=t,o[a+1]=i,o[a+2]=r,o[a+3]=n,this},SPE.TypedArrayHelper.prototype.setMat3=function(e,t){"use strict";return this.setFromArray(this.indexOffset+e*this.componentSize,t.elements)},SPE.TypedArrayHelper.prototype.setMat4=function(e,t){"use strict";return this.setFromArray(this.indexOffset+e*this.componentSize,t.elements)},SPE.TypedArrayHelper.prototype.setColor=function(e,t){"use strict";return this.setVec3Components(e,t.r,t.g,t.b)},SPE.TypedArrayHelper.prototype.setNumber=function(e,t){"use strict";return this.array[this.indexOffset+e*this.componentSize]=t,this},SPE.TypedArrayHelper.prototype.getValueAtIndex=function(e){"use strict";return this.array[this.indexOffset+e]},SPE.TypedArrayHelper.prototype.getComponentValueAtIndex=function(e){"use strict";return this.array.subarray(this.indexOffset+e*this.componentSize)},SPE.ShaderAttribute=function(e,t,i){"use strict";var r=SPE.ShaderAttribute.typeSizeMap;this.type="string"==typeof e&&r.hasOwnProperty(e)?e:"f",this.componentSize=r[this.type],this.arrayType=i||Float32Array,this.typedArray=null,this.bufferAttribute=null,this.dynamicBuffer=!!t,this.updateMin=0,this.updateMax=0},SPE.ShaderAttribute.constructor=SPE.ShaderAttribute,SPE.ShaderAttribute.typeSizeMap={f:1,v2:2,v3:3,v4:4,c:3,m3:9,m4:16},SPE.ShaderAttribute.prototype.setUpdateRange=function(e,t){"use strict";this.updateMin=Math.min(e*this.componentSize,this.updateMin*this.componentSize),this.updateMax=Math.max(t*this.componentSize,this.updateMax*this.componentSize)},SPE.ShaderAttribute.prototype.flagUpdate=function(){"use strict";var e=this.bufferAttribute,t=e.updateRange;t.offset=this.updateMin,t.count=Math.min(this.updateMax-this.updateMin+this.componentSize,this.typedArray.array.length),e.needsUpdate=!0},SPE.ShaderAttribute.prototype.resetUpdateRange=function(){"use strict";this.updateMin=0,this.updateMax=0},SPE.ShaderAttribute.prototype.resetDynamic=function(){"use strict";this.bufferAttribute.dynamic=this.dynamicBuffer},SPE.ShaderAttribute.prototype.splice=function(e,t){"use strict";this.typedArray.splice(e,t),this.forceUpdateAll()},SPE.ShaderAttribute.prototype.forceUpdateAll=function(){"use strict";this.bufferAttribute.array=this.typedArray.array,this.bufferAttribute.updateRange.offset=0,this.bufferAttribute.updateRange.count=-1,this.bufferAttribute.dynamic=!1,this.bufferAttribute.needsUpdate=!0},SPE.ShaderAttribute.prototype._ensureTypedArray=function(e){"use strict";null!==this.typedArray&&this.typedArray.size===e*this.componentSize||(null!==this.typedArray&&this.typedArray.size!==e?this.typedArray.setSize(e):null===this.typedArray&&(this.typedArray=new SPE.TypedArrayHelper(this.arrayType,e,this.componentSize)))},SPE.ShaderAttribute.prototype._createBufferAttribute=function(e){"use strict";if(this._ensureTypedArray(e),null!==this.bufferAttribute)return this.bufferAttribute.array=this.typedArray.array,parseFloat(THREE.REVISION)>=81&&(this.bufferAttribute.count=this.bufferAttribute.array.length/this.bufferAttribute.itemSize),void(this.bufferAttribute.needsUpdate=!0);this.bufferAttribute=new THREE.BufferAttribute(this.typedArray.array,this.componentSize),this.bufferAttribute.dynamic=this.dynamicBuffer},SPE.ShaderAttribute.prototype.getLength=function(){"use strict";return null===this.typedArray?0:this.typedArray.array.length},SPE.shaderChunks={defines:["#define PACKED_COLOR_SIZE 256.0","#define PACKED_COLOR_DIVISOR 255.0"].join("\n"),uniforms:["uniform float deltaTime;","uniform float runTime;","uniform sampler2D tex;","uniform vec4 textureAnimation;","uniform float scale;"].join("\n"),attributes:["attribute vec4 acceleration;","attribute vec3 velocity;","attribute vec4 rotation;","attribute vec3 rotationCenter;","attribute vec4 params;","attribute vec4 size;","attribute vec4 angle;","attribute vec4 color;","attribute vec4 opacity;","attribute vec4 trail;"].join("\n"),varyings:["varying vec4 vColor;","//#ifdef SHOULD_ROTATE_TEXTURE","    varying float vAngle;","//#endif","#ifdef SHOULD_CALCULATE_SPRITE","    varying vec4 vSpriteSheet;","#endif","#ifdef SHOULD_TRAIL_PARTICLES","    varying float fTrailSpeed;","    varying vec4 vec4Path_0;","    varying vec4 vec4Path_1;","    varying vec4 vec4Path_2;","    varying vec4 vec4Path_3;","    varying vec4 vec4Path_4;","    varying vec4 vec4Path_5;","    varying vec4 vec4Path_6;","    varying vec4 vec4Path_7;","    varying vec4 vec4Path_8;","    varying vec4 vec4Path_9;","#endif"].join("\n"),branchAvoidanceFunctions:["float when_gt(float x, float y) {","    return max(sign(x - y), 0.0);","}","float when_lt(float x, float y) {","    return min( max(1.0 - sign(x - y), 0.0), 1.0 );","}","float when_eq( float x, float y ) {","    return 1.0 - abs( sign( x - y ) );","}","float when_ge(float x, float y) {","  return 1.0 - when_lt(x, y);","}","float when_le(float x, float y) {","  return 1.0 - when_gt(x, y);","}","float and(float a, float b) {","    return a * b;","}","float or(float a, float b) {","    return min(a + b, 1.0);","}"].join("\n"),unpackColor:["vec3 unpackColor( in float hex ) {","   vec3 c = vec3( 0.0 );","   float r = mod( (hex / PACKED_COLOR_SIZE / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float g = mod( (hex / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float b = mod( hex, PACKED_COLOR_SIZE );","   c.r = r / PACKED_COLOR_DIVISOR;","   c.g = g / PACKED_COLOR_DIVISOR;","   c.b = b / PACKED_COLOR_DIVISOR;","   return c;","}"].join("\n"),unpackRotationAxis:["vec3 unpackRotationAxis( in float hex ) {","   vec3 c = vec3( 0.0 );","   float r = mod( (hex / PACKED_COLOR_SIZE / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float g = mod( (hex / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float b = mod( hex, PACKED_COLOR_SIZE );","   c.r = r / PACKED_COLOR_DIVISOR;","   c.g = g / PACKED_COLOR_DIVISOR;","   c.b = b / PACKED_COLOR_DIVISOR;","   c *= vec3( 2.0 );","   c -= vec3( 1.0 );","   return c;","}"].join("\n"),floatOverLifetime:["float getFloatOverLifetime( in float positionInTime, in vec4 attr ) {","    highp float value = 0.0;","    float deltaAge = positionInTime * float( VALUE_OVER_LIFETIME_LENGTH - 1 );","    float fIndex = 0.0;","    float shouldApplyValue = 0.0;","    value += attr[ 0 ] * when_eq( deltaAge, 0.0 );","","    for( int i = 0; i < VALUE_OVER_LIFETIME_LENGTH - 1; ++i ) {","       fIndex = float( i );","       shouldApplyValue = and( when_gt( deltaAge, fIndex ), when_le( deltaAge, fIndex + 1.0 ) );","       value += shouldApplyValue * mix( attr[ i ], attr[ i + 1 ], deltaAge - fIndex );","    }","","    return value;","}"].join("\n"),colorOverLifetime:["vec3 getColorOverLifetime( in float positionInTime, in vec3 color1, in vec3 color2, in vec3 color3, in vec3 color4 ) {","    vec3 value = vec3( 0.0 );","    value.x = getFloatOverLifetime( positionInTime, vec4( color1.x, color2.x, color3.x, color4.x ) );","    value.y = getFloatOverLifetime( positionInTime, vec4( color1.y, color2.y, color3.y, color4.y ) );","    value.z = getFloatOverLifetime( positionInTime, vec4( color1.z, color2.z, color3.z, color4.z ) );","    return value;","}"].join("\n"),paramFetchingFunctions:["float getAlive() {","   return params.x;","}","float getAge() {","   return params.y;","}","float getMaxAge() {","   return params.z;","}","float getWiggle() {","   return params.w;","}"].join("\n"),forceFetchingFunctions:["vec4 getPosition( in float age ) {","   return modelViewMatrix * vec4( position, 1.0 );","}","vec3 getVelocity( in float age ) {","   return velocity * age;","}","vec3 getAcceleration( in float age ) {","   return acceleration.xyz * age;","}"].join("\n"),rotationFunctions:["#ifdef SHOULD_ROTATE_PARTICLES","   mat4 getRotationMatrix( in vec3 axis, in float angle) {","       axis = normalize(axis);","       float s = sin(angle);","       float c = cos(angle);","       float oc = 1.0 - c;","","       return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,","                   oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,","                   oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,","                   0.0,                                0.0,                                0.0,                                1.0);","   }","","   vec3 getRotation( in vec3 pos, in float positionInTime ) {","      if( rotation.y == 0.0 ) {","           return pos;","      }","","      vec3 axis = unpackRotationAxis( rotation.x );","      vec3 center = rotationCenter;","      vec3 translated;","      mat4 rotationMatrix;","      float angle = 0.0;","      angle += when_eq( rotation.z, 0.0 ) * rotation.y;","      angle += when_gt( rotation.z, 0.0 ) * mix( 0.0, rotation.y, positionInTime );","      translated = rotationCenter - pos;","      rotationMatrix = getRotationMatrix( axis, angle );","      return center - vec3( rotationMatrix * vec4( translated, 0.0 ) );","   }","#endif"].join("\n"),rotateTexture:["    vec2 vUv = vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y );","","    #ifdef SHOULD_ROTATE_TEXTURE","       float x = gl_PointCoord.x - 0.5;","       float y = 1.0 - gl_PointCoord.y - 0.5;","       float c = cos( -vAngle );","       float s = sin( -vAngle );","       vUv = vec2( c * x + s * y + 0.5, c * y - s * x + 0.5 );","    #endif","","    #ifdef SHOULD_CALCULATE_SPRITE","        float framesX = vSpriteSheet.x;","        float framesY = vSpriteSheet.y;","        float columnNorm = vSpriteSheet.z;","        float rowNorm = vSpriteSheet.w;","        vUv.x = gl_PointCoord.x * framesX + columnNorm;","        vUv.y = 1.0 - (gl_PointCoord.y * framesY + rowNorm);","       if(vAngle != 0.0)","       {","           lowp float cos50 = cos(-vAngle);","           lowp float sin50 = sin(-vAngle);","           vec2 rotator50 = vUv;","           lowp float fWCeil = 1.0 / textureAnimation.x;","           lowp float fHCeil = 1.0 / textureAnimation.y;","           lowp float fHalfWCeil = fWCeil * 0.5;","           lowp float fHalfHCeil = fHCeil * 0.5;","           lowp float fXCenter = 0.0;","           lowp float fYCenter = 0.0;","           for(lowp float i = 0.0; i < 20.0; i+=1.0)","           {","               if(i >= textureAnimation.x) break;","               for(lowp float j = 0.0; j < 20.0; j+=1.0)","               {","                   if(j >= textureAnimation.y) break;","                   fXCenter = (i) * (fWCeil) + fHalfWCeil;","                   fYCenter = (j) * (fHCeil) + fHalfHCeil;","                   if(pow(((vUv.x - fXCenter)/(fHalfWCeil)), 2.0) + pow(((vUv.y - fYCenter)/(fHalfHCeil)), 2.0) <= 1.0)","                       rotator50 = (mat2( cos50 , -sin50 , sin50 , cos50 ) * (vUv - vec2( fXCenter,fYCenter ))) + vec2( fXCenter,fYCenter );","                   vUv = rotator50;","               }","           }","       }","      #else","       if(vAngle != 0.0)","       {","           lowp float cos50 = cos(-vAngle);","           lowp float sin50 = sin(-vAngle);","           vec2 rotator50 = vUv;","           lowp float fWCeil = 1.0 / textureAnimation.x;","           lowp float fHCeil = 1.0 / textureAnimation.y;","           lowp float fHalfWCeil = fWCeil * 0.5;","           lowp float fHalfHCeil = fHCeil * 0.5;","           lowp float fXCenter = 0.0;","           lowp float fYCenter = 0.0;","           for(lowp float i = 0.0; i < 20.0; i+=1.0)","           {","               if(i >= textureAnimation.x) break;","               for(lowp float j = 0.0; j < 20.0; j+=1.0)","               {","                   if(j >= textureAnimation.y) break;","                   fXCenter = (i) * (fWCeil) + fHalfWCeil;","                   fYCenter = (j) * (fHCeil) + fHalfHCeil;","                   if(pow(((vUv.x - fXCenter)/(fHalfWCeil)), 2.0) + pow(((vUv.y - fYCenter)/(fHalfHCeil)), 2.0) <= 1.0)","                       rotator50 = (mat2( cos50 , -sin50 , sin50 , cos50 ) * (vUv - vec2( fXCenter,fYCenter ))) + vec2( fXCenter,fYCenter );","                   vUv = rotator50;","               }","           }","       }","    #endif","","    vec4 rotatedTexture = texture2D( tex, vUv );","    #ifdef SHOULD_TRAIL_PARTICLES","\t    float fVelocityScale = fTrailSpeed;","\t    vec2 a_0 = (vec4Path_1.xy / vec4Path_1.w) * 0.5 + 0.5;","\t    vec2 b_0 = (vec4Path_0.xy / vec4Path_0.w) * 0.5 + 0.5;","\t    vec2 velocity_0 = fVelocityScale * (a_0 - b_0);","\t    vec2 a_1 = (vec4Path_2.xy / vec4Path_2.w) * 0.5 + 0.5;","\t    vec2 b_1 = (vec4Path_1.xy / vec4Path_1.w) * 0.5 + 0.5;","\t    vec2 velocity_1 = fVelocityScale * (a_1 - b_0);","\t    vec2 a_2 = (vec4Path_3.xy / vec4Path_3.w) * 0.5 + 0.5;","\t    vec2 b_2 = (vec4Path_2.xy / vec4Path_2.w) * 0.5 + 0.5;","\t    vec2 velocity_2 = fVelocityScale * (a_2 - b_0);","\t    vec2 a_3 = (vec4Path_4.xy / vec4Path_4.w) * 0.5 + 0.5;","\t    vec2 b_3 = (vec4Path_3.xy / vec4Path_3.w) * 0.5 + 0.5;","\t    vec2 velocity_3 = fVelocityScale * (a_3 - b_0);","\t    vec2 a_4 = (vec4Path_5.xy / vec4Path_5.w) * 0.5 + 0.5;","\t    vec2 b_4 = (vec4Path_4.xy / vec4Path_4.w) * 0.5 + 0.5;","\t    vec2 velocity_4 = fVelocityScale * (a_4 - b_0);","\t    vec2 a_5 = (vec4Path_6.xy / vec4Path_6.w) * 0.5 + 0.5;","\t    vec2 b_5 = (vec4Path_5.xy / vec4Path_5.w) * 0.5 + 0.5;","\t    vec2 velocity_5 = fVelocityScale * (a_5 - b_0);","\t    vec2 a_6 = (vec4Path_7.xy / vec4Path_7.w) * 0.5 + 0.5;","\t    vec2 b_6 = (vec4Path_6.xy / vec4Path_6.w) * 0.5 + 0.5;","\t    vec2 velocity_6 = fVelocityScale * (a_6 - b_0);","\t    vec2 a_7 = (vec4Path_8.xy / vec4Path_8.w) * 0.5 + 0.5;","\t    vec2 b_7 = (vec4Path_7.xy / vec4Path_7.w) * 0.5 + 0.5;","\t    vec2 velocity_7 = fVelocityScale * (a_7 - b_0);","\t    vec2 a_8 = (vec4Path_9.xy / vec4Path_9.w) * 0.5 + 0.5;","\t    vec2 b_8 = (vec4Path_8.xy / vec4Path_8.w) * 0.5 + 0.5;","\t    vec2 velocity_8 = fVelocityScale * (a_8 - b_0);","\t    vec4 oResult;","\t    oResult = texture2D(tex, vUv);","\t    vec2 offset_0 = velocity_0 * (float(1) / float(9) - 0.5);","\t    vec2 offset_1 = velocity_1 * (float(2) / float(9) - 0.5);","\t    vec2 offset_2 = velocity_2 * (float(3) / float(9) - 0.5);","\t    vec2 offset_3 = velocity_3 * (float(4) / float(9) - 0.5);","\t    vec2 offset_4 = velocity_4 * (float(5) / float(9) - 0.5);","\t    vec2 offset_5 = velocity_5 * (float(6) / float(9) - 0.5);","\t    vec2 offset_6 = velocity_6 * (float(7) / float(9) - 0.5);","\t    vec2 offset_7 = velocity_7 * (float(8) / float(9) - 0.5);","\t    vec2 offset_8 = velocity_8 * (float(9) / float(9) - 0.5);","\t    oResult += texture2D(tex, vUv + offset_0);","\t    oResult += texture2D(tex, vUv + offset_1);","\t    oResult += texture2D(tex, vUv + offset_2);","\t    oResult += texture2D(tex, vUv + offset_3);","\t    oResult += texture2D(tex, vUv + offset_4);","\t    oResult += texture2D(tex, vUv + offset_5);","\t    oResult += texture2D(tex, vUv + offset_6);","\t    oResult += texture2D(tex, vUv + offset_7);","\t    oResult += texture2D(tex, vUv + offset_8);","       rotatedTexture = oResult;","    #endif"].join("\n")},SPE.shaders={vertex:[SPE.shaderChunks.defines,SPE.shaderChunks.uniforms,SPE.shaderChunks.attributes,SPE.shaderChunks.varyings,THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_vertex,THREE.ShaderChunk.fog_pars_vertex,SPE.shaderChunks.branchAvoidanceFunctions,SPE.shaderChunks.unpackColor,SPE.shaderChunks.unpackRotationAxis,SPE.shaderChunks.floatOverLifetime,SPE.shaderChunks.colorOverLifetime,SPE.shaderChunks.paramFetchingFunctions,SPE.shaderChunks.forceFetchingFunctions,SPE.shaderChunks.rotationFunctions,"void main() {","    highp float age = getAge();","    highp float alive = getAlive();","    highp float maxAge = getMaxAge();","    highp float positionInTime = (age / maxAge);","    highp float isAlive = when_gt( alive, 0.0 );","    #ifdef SHOULD_WIGGLE_PARTICLES","        float wiggleAmount = positionInTime * getWiggle();","        float wiggleSin = isAlive * sin( wiggleAmount );","        float wiggleCos = isAlive * cos( wiggleAmount );","    #endif","    vec3 vel = getVelocity( age );","    vec3 accel = getAcceleration( age );","    vec3 force = vec3( 0.0 );","    vec3 pos = vec3( position );","    float drag = 1.0 - (positionInTime * 0.5) * acceleration.w;","    force += vel;","    force *= drag;","    force += accel * age;","    pos += force;","    #ifdef SHOULD_WIGGLE_PARTICLES","        pos.x += wiggleSin;","        pos.y += wiggleCos;","        pos.z += wiggleSin;","    #endif","    #ifdef SHOULD_ROTATE_PARTICLES","        pos = getRotation( pos, positionInTime );","    #endif","    vec4 mvPosition = modelViewMatrix * vec4( pos, 1.0 );","    #ifdef SHOULD_TRAIL_PARTICLES","    float fTimeStep = trail.x * trail.z;","    fTrailSpeed = trail.y;","    for(int i = 0; i < 10; i++)","    {","       highp float age_i = age - float(i) * fTimeStep;","       highp float positionInTime_i = (age_i / maxAge);","       #ifdef SHOULD_WIGGLE_PARTICLES","           float wiggleAmount_i = positionInTime_i * getWiggle();","           float wiggleSin_i = isAlive * sin( wiggleAmount_i );","           float wiggleCos_i = isAlive * cos( wiggleAmount_i );","       #endif","       vec3 vel_i = getVelocity( age_i );","       vec3 accel_i = getAcceleration( age_i );","       vec3 force_i = vec3( 0.0 );","       vec3 pos_i = vec3( position );","       float drag_i = 1.0 - (positionInTime_i * 0.5) * acceleration.w;","       force_i += vel_i;","       force_i *= drag_i;","       force_i += accel_i * age_i;","       pos_i += force_i;","       #ifdef SHOULD_WIGGLE_PARTICLES","           pos_i.x += wiggleSin_i;","           pos_i.y += wiggleCos_i;","           pos_i.z += wiggleSin_i;","       #endif","       #ifdef SHOULD_ROTATE_PARTICLES","           pos_i = getRotation( pos_i, positionInTime_i );","       #endif","       vec4 mvPosition_i = projectionMatrix * modelViewMatrix * vec4( pos_i, 1.0 );","       if(i == 0) vec4Path_0 = mvPosition_i;","       if(i == 1) vec4Path_1 = mvPosition_i;","       if(i == 2) vec4Path_2 = mvPosition_i;","       if(i == 3) vec4Path_3 = mvPosition_i;","       if(i == 4) vec4Path_4 = mvPosition_i;","       if(i == 5) vec4Path_5 = mvPosition_i;","       if(i == 6) vec4Path_6 = mvPosition_i;","       if(i == 7) vec4Path_7 = mvPosition_i;","       if(i == 8) vec4Path_8 = mvPosition_i;","       if(i == 9) vec4Path_9 = mvPosition_i;","    }","    #endif","    highp float pointSize = getFloatOverLifetime( positionInTime, size ) * isAlive;","    #ifdef HAS_PERSPECTIVE","        float perspective = scale / length( mvPosition.xyz );","    #else","        float perspective = 1.0;","    #endif","    float pointSizePerspective = pointSize * perspective;","    #ifdef COLORIZE","       vec3 c = isAlive * getColorOverLifetime(","           positionInTime,","           unpackColor( color.x ),","           unpackColor( color.y ),","           unpackColor( color.z ),","           unpackColor( color.w )","       );","    #else","       vec3 c = vec3(1.0);","    #endif","    float o = isAlive * getFloatOverLifetime( positionInTime, opacity );","    vColor = vec4( c, o );","    //#ifdef SHOULD_ROTATE_TEXTURE","        vAngle = isAlive * getFloatOverLifetime( positionInTime, angle );","    //#endif","    #ifdef SHOULD_CALCULATE_SPRITE","        float framesX = textureAnimation.x;","        float framesY = textureAnimation.y;","        float loopCount = textureAnimation.w;","        float totalFrames = textureAnimation.z;","        float frameNumber = mod( (positionInTime * loopCount) * totalFrames, totalFrames );","        float column = floor(mod( frameNumber, framesX ));","        float row = floor( (frameNumber - column) / framesX );","        float columnNorm = column / framesX;","        float rowNorm = row / framesY;","        vSpriteSheet.x = 1.0 / framesX;","        vSpriteSheet.y = 1.0 / framesY;","        vSpriteSheet.z = columnNorm;","        vSpriteSheet.w = rowNorm;","    #endif","    gl_PointSize = pointSizePerspective;","    gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.fog_vertex,"}"].join("\n"),fragment:[SPE.shaderChunks.uniforms,THREE.ShaderChunk.common,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,SPE.shaderChunks.varyings,SPE.shaderChunks.branchAvoidanceFunctions,"void main() {","    vec3 outgoingLight = vColor.xyz;","    ","    #ifdef ALPHATEST","       if ( vColor.w < float(ALPHATEST) ) discard;","    #endif",SPE.shaderChunks.rotateTexture,THREE.ShaderChunk.logdepthbuf_fragment,"    outgoingLight = vColor.xyz * rotatedTexture.xyz;","    gl_FragColor = vec4( outgoingLight.xyz, rotatedTexture.w * vColor.w );",THREE.ShaderChunk.fog_fragment,"}"].join("\n")},SPE.utils={types:{BOOLEAN:"boolean",STRING:"string",NUMBER:"number",OBJECT:"object"},ensureTypedArg:function(e,t,i){"use strict";return typeof e===t?e:i},ensureArrayTypedArg:function(e,t,i){"use strict";if(Array.isArray(e)){for(var r=e.length-1;r>=0;--r)if(typeof e[r]!==t)return i;return e}return this.ensureTypedArg(e,t,i)},ensureInstanceOf:function(e,t,i){"use strict";return void 0!==t&&e instanceof t?e:i},ensureArrayInstanceOf:function(e,t,i){"use strict";if(Array.isArray(e)){for(var r=e.length-1;r>=0;--r)if(void 0!==t&&e[r]instanceof t==!1)return i;return e}return this.ensureInstanceOf(e,t,i)},ensureValueOverLifetimeCompliance:function(e,t,i){"use strict";t=t||3,i=i||3,!1===Array.isArray(e._value)&&(e._value=[e._value]),!1===Array.isArray(e._spread)&&(e._spread=[e._spread]);var r=this.clamp(e._value.length,t,i),n=this.clamp(e._spread.length,t,i),o=Math.max(r,n);e._value.length!==o&&(e._value=this.interpolateArray(e._value,o)),e._spread.length!==o&&(e._spread=this.interpolateArray(e._spread,o))},interpolateArray:function(e,t){"use strict";for(var i=e.length,r=["function"==typeof e[0].clone?e[0].clone():e[0]],n=(i-1)/(t-1),o=1;o<t-1;++o){var a=o*n,s=Math.floor(a),l=Math.ceil(a),c=a-s;r[o]=this.lerpTypeAgnostic(e[s],e[l],c)}return r.push("function"==typeof e[i-1].clone?e[i-1].clone():e[i-1]),r},clamp:function(e,t,i){"use strict";return Math.max(t,Math.min(e,i))},zeroToEpsilon:function(e,t){"use strict";var i=e;return i=t?1e-5*Math.random()*10:1e-5,e<0&&e>-1e-5&&(i=-i),i},lerpTypeAgnostic:function(e,t,i){"use strict";var r,n=this.types;return typeof e==n.NUMBER&&typeof t==n.NUMBER?e+(t-e)*i:e instanceof THREE.Vector2&&t instanceof THREE.Vector2||typeof e.x==n.NUMBER&&typeof e.y==n.NUMBER&&null==e.z&&null==e.z&&typeof t.x==n.NUMBER&&typeof t.y==n.NUMBER&&null==t.z&&null==t.z?(e instanceof THREE.Vector2?r=e.clone():((r={}).x=e.x,r.y=e.y),r.x=this.lerp(e.x,t.x,i),r.y=this.lerp(e.y,t.y,i),r):e instanceof THREE.Vector3&&t instanceof THREE.Vector3||typeof e.x==n.NUMBER&&typeof e.y==n.NUMBER&&typeof e.z==n.NUMBER&&null==e.w&&null==e.w&&typeof t.x==n.NUMBER&&typeof t.y==n.NUMBER&&typeof t.z==n.NUMBER&&null==t.w&&null==t.w?(e instanceof THREE.Vector3?r=e.clone():((r={}).x=e.x,r.y=e.y,r.z=e.z),r.x=this.lerp(e.x,t.x,i),r.y=this.lerp(e.y,t.y,i),r.z=this.lerp(e.z,t.z,i),r):e instanceof THREE.Vector4&&t instanceof THREE.Vector4||typeof e.x==n.NUMBER&&typeof e.y==n.NUMBER&&typeof e.z==n.NUMBER&&typeof e.w==n.NUMBER&&typeof t.x==n.NUMBER&&typeof t.y==n.NUMBER&&typeof t.z==n.NUMBER&&typeof t.w==n.NUMBER?(e instanceof THREE.Vector4?r=e.clone():((r={}).x=e.x,r.y=e.y,r.z=e.z,r.w=e.w),r.x=this.lerp(e.x,t.x,i),r.y=this.lerp(e.y,t.y,i),r.z=this.lerp(e.z,t.z,i),r.w=this.lerp(e.w,t.w,i),r):e instanceof THREE.Color&&t instanceof THREE.Color||typeof e.r==n.NUMBER&&typeof e.g==n.NUMBER&&typeof e.b==n.NUMBER&&typeof t.r==n.NUMBER&&typeof t.g==n.NUMBER&&typeof t.b==n.NUMBER?(e instanceof THREE.Color?r=e.clone():((r={}).r=e.r,r.g=e.g,r.b=e.b),r.r=this.lerp(e.r,t.r,i),r.g=this.lerp(e.g,t.g,i),r.b=this.lerp(e.b,t.b,i),r):void console.warn("Invalid argument types, or argument types do not match:",e,t)},lerp:function(e,t,i){"use strict";return e+(t-e)*i},roundToNearestMultiple:function(e,t){"use strict";var i;return 0===t?e:0===(i=Math.abs(e)%t)?e:e<0?-(Math.abs(e)-i):e+t-i},arrayValuesAreEqual:function(e){"use strict";for(var t=0;t<e.length-1;++t)if(e[t]!==e[t+1])return!1;return!0},randomFloat:function(e,t){"use strict";return e+t*(Math.random()-.5)},randomVector3:function(e,t,i,r,n){"use strict";var o=i.x+(Math.random()*r.x-.5*r.x),a=i.y+(Math.random()*r.y-.5*r.y),s=i.z+(Math.random()*r.z-.5*r.z);n&&(o=.5*-n.x+this.roundToNearestMultiple(o,n.x),a=.5*-n.y+this.roundToNearestMultiple(a,n.y),s=.5*-n.z+this.roundToNearestMultiple(s,n.z)),e.typedArray.setVec3Components(t,o,a,s)},getRandomVector3:function(e,t,i){"use strict";var r=e.x+(Math.random()*t.x-.5*t.x),n=e.y+(Math.random()*t.y-.5*t.y),o=e.z+(Math.random()*t.z-.5*t.z);return i&&(r=.5*-i.x+this.roundToNearestMultiple(r,i.x),n=.5*-i.y+this.roundToNearestMultiple(n,i.y),o=.5*-i.z+this.roundToNearestMultiple(o,i.z)),new THREE.Vector3(r,n,o)},randomColor:function(e,t,i,r){"use strict";var n=i.r+Math.random()*r.x,o=i.g+Math.random()*r.y,a=i.b+Math.random()*r.z;n=this.clamp(n,0,1),o=this.clamp(o,0,1),a=this.clamp(a,0,1),e.typedArray.setVec3Components(t,n,o,a)},randomColorAsHex:function(){"use strict";var e=new THREE.Color;return function(t,i,r,n){for(var o=r.length,a=[],s=0;s<o;++s){var l=n[s];e.copy(r[s]),e.r+=Math.random()*l.x-.5*l.x,e.g+=Math.random()*l.y-.5*l.y,e.b+=Math.random()*l.z-.5*l.z,e.r=this.clamp(e.r,0,1),e.g=this.clamp(e.g,0,1),e.b=this.clamp(e.b,0,1),a.push(e.getHex())}t.typedArray.setVec4Components(i,a[0],a[1],a[2],a[3])}}(),randomVector3OnSphere:function(e,t,i,r,n,o,a,s){"use strict";var l=2*Math.random()-1,c=6.2832*Math.random(),u=Math.sqrt(1-l*l),h=this.randomFloat(r,n),p=0,d=0,f=0;a&&(h=Math.round(h/a)*a),p=u*Math.cos(c)*h,d=u*Math.sin(c)*h,f=l*h,p*=o.x,d*=o.y,f*=o.z,p+=i.x,d+=i.y,f+=i.z,e.typedArray.setVec3Components(t,p,d,f)},seededRandom:function(e){var t=1e4*Math.sin(e);return t-(0|t)},randomVector3OnDisc:function(e,t,i,r,n,o,a){"use strict";var s=6.2832*Math.random(),l=Math.abs(this.randomFloat(r,n)),c=0,u=0,h=0;a&&(l=Math.round(l/a)*a),c=Math.cos(s)*l,u=Math.sin(s)*l,c*=o.x,u*=o.y,c+=i.x,u+=i.y,h+=i.z,e.typedArray.setVec3Components(t,c,u,h)},randomDirectionVector3OnSphere:function(){"use strict";var e=new THREE.Vector3;return function(t,i,r,n,o,a,s,l){e.copy(a),e.x-=r,e.y-=n,e.z-=o,e.normalize().multiplyScalar(-this.randomFloat(s,l)),t.typedArray.setVec3Components(i,e.x,e.y,e.z)}}(),directionVector3OnSphere:function(){"use strict";var e=new THREE.Vector3;return function(t,i,r,n,o,a,s,l,c,u){e.copy(a),e.x-=r,e.y-=n,e.z-=o,e.normalize().multiplyScalar(-this.randomFloat(s,l));var h=this.getRandomVector3(c,u);e.add(h),t.typedArray.setVec3Components(i,e.x,e.y,e.z)}}(),randomDirectionVector3OnDisc:function(){"use strict";var e=new THREE.Vector3;return function(t,i,r,n,o,a,s,l){e.copy(a),e.x-=r,e.y-=n,e.z-=o,e.normalize().multiplyScalar(-this.randomFloat(s,l)),t.typedArray.setVec3Components(i,e.x,e.y,0)}}(),getPackedRotationAxis:function(){"use strict";var e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Color,r=new THREE.Vector3(1,1,1);return function(n,o){return e.copy(n).normalize(),t.copy(o).normalize(),e.x+=.5*-o.x+Math.random()*o.x,e.y+=.5*-o.y+Math.random()*o.y,e.z+=.5*-o.z+Math.random()*o.z,e.normalize().add(r).multiplyScalar(.5),i.setRGB(e.x,e.y,e.z),i.getHex()}}()},SPE.Group=function(e){"use strict";var t=SPE.utils,i=t.types;(e=t.ensureTypedArg(e,i.OBJECT,{})).texture=t.ensureTypedArg(e.texture,i.OBJECT,{}),this.uuid=THREE.Math.generateUUID(),this.fixedTimeStep=t.ensureTypedArg(e.fixedTimeStep,i.NUMBER,.016),null!=e.texture.frames&&null!=e.texture.frames&&(e.texture.frames.x=t.ensureTypedArg(e.texture.frames.x,i.NUMBER,1),e.texture.frames.y=t.ensureTypedArg(e.texture.frames.y,i.NUMBER,1)),this.texture=t.ensureInstanceOf(e.texture.value,THREE.Texture,null),this.textureFrames=t.ensureInstanceOf(new THREE.Vector2(e.texture.frames.x,e.texture.frames.y),THREE.Vector2,new THREE.Vector2(1,1)),this.textureFrameCount=t.ensureTypedArg(e.texture.frameCount,i.NUMBER,this.textureFrames.x*this.textureFrames.y),this.textureLoop=t.ensureTypedArg(e.texture.loop,i.NUMBER,1),this.textureFrames.max(new THREE.Vector2(1,1)),this.hasPerspective=t.ensureTypedArg(e.hasPerspective,i.BOOLEAN,!0),this.colorize=t.ensureTypedArg(e.colorize,i.BOOLEAN,!0),this.maxParticleCount=t.ensureTypedArg(e.maxParticleCount,i.NUMBER,null),this.vec4Quaternion=t.ensureInstanceOf(e.vec4Quaternion,THREE.Vector4,new THREE.Vector4(0,0,0,1)),this.vec4Quaternion=this.vec4Quaternion.normalize(),this.blending=t.ensureTypedArg(e.blending,i.NUMBER,THREE.AdditiveBlending),this.transparent=t.ensureTypedArg(e.transparent,i.BOOLEAN,!0),this.alphaTest=parseFloat(t.ensureTypedArg(e.alphaTest,i.NUMBER,0)),this.depthWrite=t.ensureTypedArg(e.depthWrite,i.BOOLEAN,!1),this.depthTest=t.ensureTypedArg(e.depthTest,i.BOOLEAN,!0),this.fog=t.ensureTypedArg(e.fog,i.BOOLEAN,!0),this.scale=t.ensureTypedArg(e.scale,i.NUMBER,300),this.emitters=[],this.emitterIDs=[],this._pool=[],this._poolCreationSettings=null,this._createNewWhenPoolEmpty=0,this._attributesNeedRefresh=!1,this._attributesNeedDynamicReset=!1,this.particleCount=0,this.uniforms={tex:{type:"t",value:this.texture},textureAnimation:{type:"v4",value:new THREE.Vector4(this.textureFrames.x,this.textureFrames.y,this.textureFrameCount,Math.max(Math.abs(this.textureLoop),1))},fogColor:{type:"c",value:null},fogNear:{type:"f",value:10},fogFar:{type:"f",value:200},fogDensity:{type:"f",value:.5},deltaTime:{type:"f",value:0},runTime:{type:"f",value:0},scale:{type:"f",value:this.scale}},this.defines={HAS_PERSPECTIVE:this.hasPerspective,COLORIZE:this.colorize,VALUE_OVER_LIFETIME_LENGTH:SPE.valueOverLifetimeLength,SHOULD_ROTATE_TEXTURE:!1,SHOULD_TRAIL_PARTICLES:!1,SHOULD_ROTATE_PARTICLES:!1,SHOULD_WIGGLE_PARTICLES:!1,SHOULD_CALCULATE_SPRITE:this.textureFrames.x>1||this.textureFrames.y>1},this.attributes={position:new SPE.ShaderAttribute("v3",!0),acceleration:new SPE.ShaderAttribute("v4",!0),velocity:new SPE.ShaderAttribute("v3",!0),rotation:new SPE.ShaderAttribute("v4",!0),rotationCenter:new SPE.ShaderAttribute("v3",!0),params:new SPE.ShaderAttribute("v4",!0),size:new SPE.ShaderAttribute("v4",!0),angle:new SPE.ShaderAttribute("v4",!0),color:new SPE.ShaderAttribute("v4",!0),opacity:new SPE.ShaderAttribute("v4",!0),trail:new SPE.ShaderAttribute("v4",!0)},this.attributeKeys=Object.keys(this.attributes),this.attributeCount=this.attributeKeys.length,this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:SPE.shaders.vertex,fragmentShader:SPE.shaders.fragment,blending:this.blending,transparent:this.transparent,alphaTest:this.alphaTest,depthWrite:this.depthWrite,depthTest:this.depthTest,defines:this.defines,fog:this.fog}),this.geometry=new THREE.BufferGeometry,this.mesh=new THREE.Points(this.geometry,this.material),null===this.maxParticleCount&&console.warn("SPE.Group: No maxParticleCount specified. Adding emitters after rendering will probably cause errors.")},SPE.Group.constructor=SPE.Group,SPE.Group.prototype._updateDefines=function(){"use strict";for(var e,t=this.emitters,i=t.length-1,r=this.defines;i>=0;--i)e=t[i],r.SHOULD_CALCULATE_SPRITE||(r.SHOULD_ROTATE_TEXTURE=r.SHOULD_ROTATE_TEXTURE||!!Math.max(Math.max.apply(null,e.angle.value),Math.max.apply(null,e.angle.spread))),r.SHOULD_ROTATE_PARTICLES=r.SHOULD_ROTATE_PARTICLES||!!Math.max(e.rotation.angle,e.rotation.angleSpread),r.SHOULD_WIGGLE_PARTICLES=r.SHOULD_WIGGLE_PARTICLES||!!Math.max(e.wiggle.value,e.wiggle.spread),r.SHOULD_TRAIL_PARTICLES=r.SHOULD_TRAIL_PARTICLES||!!Math.max(e.trail.value,e.trail.spread);this.material.needsUpdate=!0},SPE.Group.prototype._applyAttributesToGeometry=function(){"use strict";var e,t,i=this.attributes,r=this.geometry,n=r.attributes;for(var o in i)i.hasOwnProperty(o)&&(e=i[o],(t=n[o])?t.array=e.typedArray.array:r.addAttribute(o,e.bufferAttribute),e.bufferAttribute.needsUpdate=!0);this.geometry.setDrawRange(0,this.particleCount)},SPE.Group.prototype.addEmitter=function(e){"use strict";if(e instanceof SPE.Emitter!=!1)if(this.emitterIDs.indexOf(e.uuid)>-1)console.error("Emitter already exists in this group. Will not add again.");else{if(null===e.group){var t=this.attributes,i=this.particleCount,r=i+e.particleCount;for(var n in this.particleCount=r,null!==this.maxParticleCount&&this.particleCount>this.maxParticleCount&&console.warn("SPE.Group: maxParticleCount exceeded. Requesting",this.particleCount,"particles, can support only",this.maxParticleCount),e._calculatePPSValue(e.maxAge._value+e.maxAge._spread),e._setBufferUpdateRanges(this.attributeKeys),e._setAttributeOffset(i),e.group=this,e.attributes=this.attributes,t)t.hasOwnProperty(n)&&t[n]._createBufferAttribute(null!==this.maxParticleCount?this.maxParticleCount:this.particleCount);for(var o=i;o<r;++o)e._assignPositionValue(o),e._assignForceValue(o,"velocity"),e._assignAccForceValue(o,"acceleration"),e._assignAbsLifetimeValue(o,"opacity"),e._assignAbsLifetimeValue(o,"size"),e._assignAngleValue(o),e._assignRotationValue(o),e._assignParamsValue(o),e._assignColorValue(o),e._assignTrailValue(o);return this._applyAttributesToGeometry(),this.emitters.push(e),this.emitterIDs.push(e.uuid),this._updateDefines(e),this.material.needsUpdate=!0,this.geometry.needsUpdate=!0,this._attributesNeedRefresh=!0,this}console.error("Emitter already belongs to another group. Will not add to requested group.")}else console.error("`emitter` argument must be instance of SPE.Emitter. Was provided with:",e)},SPE.Group.prototype.removeEmitter=function(e){"use strict";var t=this.emitterIDs.indexOf(e.uuid);if(e instanceof SPE.Emitter!=!1)if(-1!==t){for(var i=e.attributeOffset,r=i+e.particleCount,n=this.attributes.params.typedArray,o=i;o<r;++o)n.array[4*o]=0,n.array[4*o+1]=0;for(var a in this.emitters.splice(t,1),this.emitterIDs.splice(t,1),this.attributes)this.attributes.hasOwnProperty(a)&&this.attributes[a].splice(i,r);this.particleCount-=e.particleCount,e._onRemove(),this._attributesNeedRefresh=!0}else console.error("Emitter does not exist in this group. Will not remove.");else console.error("`emitter` argument must be instance of SPE.Emitter. Was provided with:",e)},SPE.Group.prototype.getFromPool=function(){"use strict";var e=this._pool,t=this._createNewWhenPoolEmpty;if(e.length)return e.pop();if(t){var i=new SPE.Emitter(this._poolCreationSettings);return this.addEmitter(i),i}return null},SPE.Group.prototype.releaseIntoPool=function(e){"use strict";if(e instanceof SPE.Emitter!=!1)return e.reset(),this._pool.unshift(e),this;console.error("Argument is not instanceof SPE.Emitter:",e)},SPE.Group.prototype.getPool=function(){"use strict";return this._pool},SPE.Group.prototype.addPool=function(e,t,i){"use strict";var r;this._poolCreationSettings=t,this._createNewWhenPoolEmpty=!!i;for(var n=0;n<e;++n)r=Array.isArray(t)?new SPE.Emitter(t[n]):new SPE.Emitter(t),this.addEmitter(r),this.releaseIntoPool(r);return this},SPE.Group.prototype._triggerSingleEmitter=function(e){"use strict";var t=this.getFromPool(),i=this;if(null!==t)return e instanceof THREE.Vector3&&(t.position.value.copy(e),t.position.value=t.position.value),t.enable(),setTimeout(function(){t.disable(),i.releaseIntoPool(t)},1e3*Math.max(t.duration,t.maxAge.value+t.maxAge.spread)),this;console.log("SPE.Group pool ran out.")},SPE.Group.prototype.triggerPoolEmitter=function(e,t){"use strict";if("number"==typeof e&&e>1)for(var i=0;i<e;++i)this._triggerSingleEmitter(t);else this._triggerSingleEmitter(t);return this},SPE.Group.prototype._updateUniforms=function(e){"use strict";this.uniforms.runTime.value+=e,this.uniforms.deltaTime.value=e},SPE.Group.prototype._resetBufferRanges=function(){"use strict";for(var e=this.attributeKeys,t=this.attributeCount-1,i=this.attributes;t>=0;--t)i[e[t]].resetUpdateRange()},SPE.Group.prototype._updateBuffers=function(e){"use strict";for(var t,i,r,n=this.attributeKeys,o=this.attributeCount-1,a=this.attributes,s=e.bufferUpdateRanges;o>=0;--o)i=s[t=n[o]],(r=a[t]).setUpdateRange(i.min,i.max),r.flagUpdate()},SPE.Group.prototype.tick=function(e){"use strict";var t=this.emitters,i=t.length,r=e||this.fixedTimeStep,n=this.attributeKeys,o=this.attributes;if(this._updateUniforms(r),this._resetBufferRanges(),0!==i||!1!==this._attributesNeedRefresh||!1!==this._attributesNeedDynamicReset){for(var a,s=0;s<i;++s)(a=t[s]).tick(r),this._updateBuffers(a);if(!0===this._attributesNeedDynamicReset){for(s=this.attributeCount-1;s>=0;--s)o[n[s]].resetDynamic();this._attributesNeedDynamicReset=!1}if(!0===this._attributesNeedRefresh){for(s=this.attributeCount-1;s>=0;--s)o[n[s]].forceUpdateAll();this._attributesNeedRefresh=!1,this._attributesNeedDynamicReset=!0}}},SPE.Group.prototype.dispose=function(){"use strict";return this.geometry.dispose(),this.material.dispose(),this},SPE.Emitter=function(e){"use strict";var t=SPE.utils,i=t.types,r=SPE.valueOverLifetimeLength;for(var n in(e=t.ensureTypedArg(e,i.OBJECT,{})).position=t.ensureTypedArg(e.position,i.OBJECT,{}),e.velocity=t.ensureTypedArg(e.velocity,i.OBJECT,{}),e.acceleration=t.ensureTypedArg(e.acceleration,i.OBJECT,{}),e.radius=t.ensureTypedArg(e.radius,i.OBJECT,{}),e.drag=t.ensureTypedArg(e.drag,i.OBJECT,{}),e.rotation=t.ensureTypedArg(e.rotation,i.OBJECT,{}),e.color=t.ensureTypedArg(e.color,i.OBJECT,{}),e.opacity=t.ensureTypedArg(e.opacity,i.OBJECT,{}),e.size=t.ensureTypedArg(e.size,i.OBJECT,{}),e.angle=t.ensureTypedArg(e.angle,i.OBJECT,{}),e.wiggle=t.ensureTypedArg(e.wiggle,i.OBJECT,{}),e.trail=t.ensureTypedArg(e.trail,i.OBJECT,{}),e.maxAge=t.ensureTypedArg(e.maxAge,i.OBJECT,{}),e.onParticleSpawn&&console.warn("onParticleSpawn has been removed. Please set properties directly to alter values at runtime."),this.uuid=THREE.Math.generateUUID(),this.type=t.ensureTypedArg(e.type,i.NUMBER,SPE.distributions.BOX),this.position={_value:t.ensureInstanceOf(e.position.value,THREE.Vector3,new THREE.Vector3),_spread:t.ensureInstanceOf(e.position.spread,THREE.Vector3,new THREE.Vector3),_spreadClamp:t.ensureInstanceOf(e.position.spreadClamp,THREE.Vector3,new THREE.Vector3),_distribution:t.ensureTypedArg(e.position.distribution,i.NUMBER,this.type),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1),_radius:t.ensureTypedArg(e.position.radius,i.NUMBER,10),_radiusScale:t.ensureInstanceOf(e.position.radiusScale,THREE.Vector3,new THREE.Vector3(1,1,1)),_distributionClamp:t.ensureTypedArg(e.position.distributionClamp,i.NUMBER,0)},this.velocity={_value:t.ensureInstanceOf(e.velocity.value,THREE.Vector3,new THREE.Vector3),_spread:t.ensureInstanceOf(e.velocity.spread,THREE.Vector3,new THREE.Vector3),_distribution:t.ensureTypedArg(e.velocity.distribution,i.NUMBER,this.type),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.acceleration={_value:t.ensureInstanceOf(e.acceleration.value,THREE.Vector3,new THREE.Vector3),_spread:t.ensureInstanceOf(e.acceleration.spread,THREE.Vector3,new THREE.Vector3),_distribution:t.ensureTypedArg(e.acceleration.distribution,i.NUMBER,this.type),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.drag={_value:t.ensureTypedArg(e.drag.value,i.NUMBER,0),_spread:t.ensureTypedArg(e.drag.spread,i.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.wiggle={_value:t.ensureTypedArg(e.wiggle.value,i.NUMBER,0),_spread:t.ensureTypedArg(e.wiggle.spread,i.NUMBER,0)},this.rotation={_axis:t.ensureInstanceOf(e.rotation.axis,THREE.Vector3,new THREE.Vector3(0,1,0)),_axisSpread:t.ensureInstanceOf(e.rotation.axisSpread,THREE.Vector3,new THREE.Vector3),_angle:t.ensureTypedArg(e.rotation.angle,i.NUMBER,0),_angleSpread:t.ensureTypedArg(e.rotation.angleSpread,i.NUMBER,0),_static:t.ensureTypedArg(e.rotation.static,i.BOOLEAN,!1),_center:t.ensureInstanceOf(e.rotation.center,THREE.Vector3,this.position._value.clone()),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.maxAge={_value:t.ensureTypedArg(e.maxAge.value,i.NUMBER,2),_spread:t.ensureTypedArg(e.maxAge.spread,i.NUMBER,0)},this.color={_value:t.ensureArrayInstanceOf(e.color.value,THREE.Color,new THREE.Color),_spread:t.ensureArrayInstanceOf(e.color.spread,THREE.Vector3,new THREE.Vector3),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.opacity={_value:t.ensureArrayTypedArg(e.opacity.value,i.NUMBER,1),_spread:t.ensureArrayTypedArg(e.opacity.spread,i.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.size={_value:t.ensureArrayTypedArg(e.size.value,i.NUMBER,1),_spread:t.ensureArrayTypedArg(e.size.spread,i.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.angle={_value:t.ensureArrayTypedArg(e.angle.value,i.NUMBER,0),_spread:t.ensureArrayTypedArg(e.angle.spread,i.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.bInitSpeed=!1,this.bInitSpeedAcc=!1,this.particleCount=t.ensureTypedArg(e.particleCount,i.NUMBER,100),this.duration=t.ensureTypedArg(e.duration,i.NUMBER,null),this.isStatic=t.ensureTypedArg(e.isStatic,i.BOOLEAN,!1),this.activeMultiplier=t.ensureTypedArg(e.activeMultiplier,i.NUMBER,1),this.direction=t.ensureTypedArg(e.direction,i.NUMBER,1),this.trail={_value:t.ensureArrayTypedArg(e.trail.value,i.NUMBER,0),_spread:t.ensureArrayTypedArg(e.trail.spread,i.NUMBER,0),_step:t.ensureArrayTypedArg(e.trail.step,i.NUMBER,0),_stepSpread:t.ensureArrayTypedArg(e.trail.stepSpread,i.NUMBER,0),_direction:t.ensureArrayTypedArg(e.trail.direction,i.NUMBER,-1*this.direction)},this.alive=t.ensureTypedArg(e.alive,i.BOOLEAN,!0),this.particlesPerSecond=0,this.activationIndex=0,this.attributeOffset=0,this.attributeEnd=0,this.age=0,this.activeParticleCount=0,this.group=null,this.attributes=null,this.paramsArray=null,this.resetFlags={position:t.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)||t.ensureTypedArg(e.radius.randomise,i.BOOLEAN,!1),velocity:t.ensureTypedArg(e.velocity.randomise,i.BOOLEAN,!1),acceleration:t.ensureTypedArg(e.acceleration.randomise,i.BOOLEAN,!1)||t.ensureTypedArg(e.drag.randomise,i.BOOLEAN,!1),rotation:t.ensureTypedArg(e.rotation.randomise,i.BOOLEAN,!1),rotationCenter:t.ensureTypedArg(e.rotation.randomise,i.BOOLEAN,!1),size:t.ensureTypedArg(e.size.randomise,i.BOOLEAN,!1),color:t.ensureTypedArg(e.color.randomise,i.BOOLEAN,!1),opacity:t.ensureTypedArg(e.opacity.randomise,i.BOOLEAN,!1),angle:t.ensureTypedArg(e.angle.randomise,i.BOOLEAN,!1)},this.updateFlags={},this.updateCounts={},this.updateMap={maxAge:"params",position:"position",velocity:"velocity",acceleration:"acceleration",drag:"acceleration",wiggle:"params",rotation:"rotation",size:"size",color:"color",opacity:"opacity",angle:"angle",trail:"trail"},this.updateMap)this.updateMap.hasOwnProperty(n)&&(this.updateCounts[this.updateMap[n]]=0,this.updateFlags[this.updateMap[n]]=!1,this._createGetterSetters(this[n],n));this.bufferUpdateRanges={},this.attributeKeys=null,this.attributeCount=0,t.ensureValueOverLifetimeCompliance(this.color,r,r),t.ensureValueOverLifetimeCompliance(this.opacity,r,r),t.ensureValueOverLifetimeCompliance(this.size,r,r),t.ensureValueOverLifetimeCompliance(this.angle,r,r)},SPE.Emitter.constructor=SPE.Emitter,SPE.Emitter.prototype._createGetterSetters=function(e,t){"use strict";var i=this;for(var r in e)if(e.hasOwnProperty(r)){var n=r.replace("_","");Object.defineProperty(e,n,{get:function(e){return function(){return this[e]}}(r),set:function(e){return function(r){var n=i.updateMap[t],o=this[e],a=SPE.valueOverLifetimeLength;"_rotationCenter"===e?(i.updateFlags.rotationCenter=!0,i.updateCounts.rotationCenter=0):"_randomise"===e?i.resetFlags[n]=r:(i.updateFlags[n]=!0,i.updateCounts[n]=0),i.group._updateDefines(),this[e]=r,Array.isArray(o)&&SPE.utils.ensureValueOverLifetimeCompliance(i[t],a,a)}}(r)})}},SPE.Emitter.prototype._setBufferUpdateRanges=function(e){"use strict";this.attributeKeys=e,this.attributeCount=e.length;for(var t=this.attributeCount-1;t>=0;--t)this.bufferUpdateRanges[e[t]]={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY}},SPE.Emitter.prototype._calculatePPSValue=function(e){"use strict";var t=this.particleCount;this.duration?this.particlesPerSecond=t/(e<this.duration?e:this.duration):this.particlesPerSecond=t/e},SPE.Emitter.prototype._setAttributeOffset=function(e){this.attributeOffset=e,this.activationIndex=e,this.activationEnd=e+this.particleCount},SPE.Emitter.prototype._assignValue=function(e,t){"use strict";switch(e){case"position":this._assignPositionValue(t);break;case"velocity":this._assignForceValue(t,e);break;case"acceleration":this._assignAccForceValue(t,e);break;case"size":case"opacity":this._assignAbsLifetimeValue(t,e);break;case"angle":this._assignAngleValue(t);break;case"params":this._assignParamsValue(t);break;case"rotation":this._assignRotationValue(t);break;case"color":this._assignColorValue(t);break;case"trail":this._assignTrailValue(t)}},SPE.Emitter.prototype._assignPositionValue=function(e){"use strict";var t=SPE.distributions,i=SPE.utils,r=this.position,n=this.attributes.position,o=r._value,a=r._spread;switch(r._distribution){case t.BOX:i.randomVector3(n,e,o,a,r._spreadClamp);break;case t.SPHERE:i.randomVector3OnSphere(n,e,o,r._radius,r._spread.x,r._radiusScale,r._spreadClamp.x,r._distributionClamp||this.particleCount);break;case t.DISC:i.randomVector3OnDisc(n,e,o,r._radius,r._spread.x,r._radiusScale,r._spreadClamp.x)}},SPE.Emitter.prototype._assignTrailValue=function(e){"use strict";this.attributes.trail.typedArray.setVec4Components(e,this.trail._direction,SPE.utils.randomFloat(this.trail._value,this.trail._spread),SPE.utils.randomFloat(this.trail._step,this.trail._stepSpread))},SPE.Emitter.prototype._assignForceValue=function(e,t){"use strict";var i=this.group.vec4Quaternion.clone();i=i.normalize();var r,n,o,a,s,l=SPE.distributions,c=SPE.utils,u=this[t],h=u._value,p=u._spread,d=u._distribution;switch(this.bInitSpeed||(h=h.applyQuaternion(i),p=p.applyQuaternion(i),this.bInitSpeed=!0),d){case l.BOX:c.randomVector3(this.attributes[t],e,h,p);break;case l.SPHERE:n=(r=this.attributes.position.typedArray.array)[s=3*e],o=r[s+1],a=r[s+2],c.randomDirectionVector3OnSphere(this.attributes[t],e,n,o,a,this.position._value,u._value.x,u._spread.x);break;case l.DISC:n=(r=this.attributes.position.typedArray.array)[s=3*e],o=r[s+1],a=r[s+2],c.randomDirectionVector3OnDisc(this.attributes[t],e,n,o,a,this.position._value,u._value.x,u._spread.x)}if("acceleration"===t){var f=c.clamp(c.randomFloat(this.drag._value,this.drag._spread),0,2);this.attributes.acceleration.typedArray.array[4*e+3]=f}},SPE.Emitter.prototype._assignAccForceValue=function(e,t){"use strict";var i=this.group.vec4Quaternion.clone();i=i.normalize();var r,n,o,a,s,l=SPE.distributions,c=SPE.utils,u=this[t],h=this.velocity,p=u._value,d=u._spread,f=u._distribution;switch(this.bInitSpeedAcc||(p=p.applyQuaternion(i),d=d.applyQuaternion(i),this.bInitSpeedAcc=!0),f){case l.BOX:c.randomVector3(this.attributes[t],e,p,d);break;case l.SPHERE:n=(r=this.attributes.position.typedArray.array)[s=3*e],o=r[s+1],a=r[s+2],c.directionVector3OnSphere(this.attributes[t],e,n,o,a,this.position._value,h._value.y,h._spread.y,u._value,u._spread);break;case l.DISC:n=(r=this.attributes.position.typedArray.array)[s=3*e],o=r[s+1],a=r[s+2],c.randomDirectionVector3OnDisc(this.attributes[t],e,n,o,a,this.position._value,u._value.x,u._spread.x)}if("acceleration"===t){var m=c.clamp(c.randomFloat(this.drag._value,this.drag._spread),0,2);this.attributes.acceleration.typedArray.array[4*e+3]=m}},SPE.Emitter.prototype._assignAbsLifetimeValue=function(e,t){"use strict";var i,r=this.attributes[t].typedArray,n=this[t],o=SPE.utils;o.arrayValuesAreEqual(n._value)&&o.arrayValuesAreEqual(n._spread)?(i=Math.abs(o.randomFloat(n._value[0],n._spread[0])),r.setVec4Components(e,i,i,i,i)):r.setVec4Components(e,Math.abs(o.randomFloat(n._value[0],n._spread[0])),Math.abs(o.randomFloat(n._value[1],n._spread[1])),Math.abs(o.randomFloat(n._value[2],n._spread[2])),Math.abs(o.randomFloat(n._value[3],n._spread[3])))},SPE.Emitter.prototype._assignAngleValue=function(e){"use strict";var t,i=this.attributes.angle.typedArray,r=this.angle,n=SPE.utils;n.arrayValuesAreEqual(r._value)&&n.arrayValuesAreEqual(r._spread)?(t=n.randomFloat(r._value[0],r._spread[0]),i.setVec4Components(e,t,t,t,t)):i.setVec4Components(e,n.randomFloat(r._value[0],r._spread[0]),n.randomFloat(r._value[1],r._spread[1]),n.randomFloat(r._value[2],r._spread[2]),n.randomFloat(r._value[3],r._spread[3]))},SPE.Emitter.prototype._assignParamsValue=function(e){"use strict";this.attributes.params.typedArray.setVec4Components(e,this.isStatic?1:0,0,Math.abs(SPE.utils.randomFloat(this.maxAge._value,this.maxAge._spread)),SPE.utils.randomFloat(this.wiggle._value,this.wiggle._spread))},SPE.Emitter.prototype._assignRotationValue=function(e){"use strict";this.attributes.rotation.typedArray.setVec3Components(e,SPE.utils.getPackedRotationAxis(this.rotation._axis,this.rotation._axisSpread),SPE.utils.randomFloat(this.rotation._angle,this.rotation._angleSpread),this.rotation._static?0:1),this.attributes.rotationCenter.typedArray.setVec3(e,this.rotation._center)},SPE.Emitter.prototype._assignColorValue=function(e){"use strict";SPE.utils.randomColorAsHex(this.attributes.color,e,this.color._value,this.color._spread)},SPE.Emitter.prototype._resetParticle=function(e){"use strict";for(var t,i,r=this.resetFlags,n=this.updateFlags,o=this.updateCounts,a=this.attributeKeys,s=this.attributeCount-1;s>=0;--s)i=n[t=a[s]],!0!==r[t]&&!0!==i||(this._assignValue(t,e),this._updateAttributeUpdateRange(t,e),!0===i&&o[t]===this.particleCount?(n[t]=!1,o[t]=0):1==i&&++o[t])},SPE.Emitter.prototype._updateAttributeUpdateRange=function(e,t){"use strict";var i=this.bufferUpdateRanges[e];i.min=Math.min(t,i.min),i.max=Math.max(t,i.max)},SPE.Emitter.prototype._resetBufferRanges=function(){"use strict";for(var e,t=this.bufferUpdateRanges,i=this.bufferUpdateKeys,r=this.bufferUpdateCount-1;r>=0;--r)t[e=i[r]].min=Number.POSITIVE_INFINITY,t[e].max=Number.NEGATIVE_INFINITY},SPE.Emitter.prototype._onRemove=function(){"use strict";this.particlesPerSecond=0,this.attributeOffset=0,this.activationIndex=0,this.activeParticleCount=0,this.group=null,this.attributes=null,this.paramsArray=null,this.age=0},SPE.Emitter.prototype._decrementParticleCount=function(){"use strict";--this.activeParticleCount},SPE.Emitter.prototype._incrementParticleCount=function(){"use strict";++this.activeParticleCount},SPE.Emitter.prototype._checkParticleAges=function(e,t,i,r){"use strict";for(var n,o,a,s,l=t-1;l>=e;--l)0!==(s=i[n=4*l])&&(a=i[n+1],o=i[n+2],1===this.direction?(a+=r)>=o&&(a=0,s=0,this._decrementParticleCount()):(a-=r)<=0&&(a=o,s=0,this._decrementParticleCount()),i[n]=s,i[n+1]=a,this._updateAttributeUpdateRange("params",l))},SPE.Emitter.prototype._activateParticles=function(e,t,i,r){"use strict";for(var n,o,a=this.direction,s=e;s<t;++s)0!=i[n=4*s]&&1!==this.particleCount||(this._incrementParticleCount(),i[n]=1,this._resetParticle(s),o=r*(s-e),i[n+1]=-1===a?i[n+2]-o:o,this._updateAttributeUpdateRange("params",s))},SPE.Emitter.prototype.tick=function(e){"use strict";if(!this.isStatic){null===this.paramsArray&&(this.paramsArray=this.attributes.params.typedArray.array);var t=this.attributeOffset,i=t+this.particleCount,r=this.paramsArray,n=this.particlesPerSecond*this.activeMultiplier*e,o=this.activationIndex;if(this._resetBufferRanges(),this._checkParticleAges(t,i,r,e),!1!==this.alive){if(null!==this.duration&&this.age>this.duration)return this.alive=!1,void(this.age=0);var a=1===this.particleCount?o:0|o,s=Math.min(a+n,this.activationEnd),l=s-this.activationIndex|0,c=l>0?e/l:0;this._activateParticles(a,s,r,c),this.activationIndex+=n,this.activationIndex>i&&(this.activationIndex=t),this.age+=e}else this.age=0}},SPE.Emitter.prototype.reset=function(e){"use strict";if(this.age=0,this.alive=!1,!0===e){for(var t,i=this.attributeOffset,r=i+this.particleCount,n=this.paramsArray,o=this.attributes.params.bufferAttribute,a=r-1;a>=i;--a)n[t=4*a]=0,n[t+1]=0;o.updateRange.offset=0,o.updateRange.count=-1,o.needsUpdate=!0}return this},SPE.Emitter.prototype.enable=function(){"use strict";return this.alive=!0,this},SPE.Emitter.prototype.disable=function(){"use strict";return this.alive=!1,this},SPE.Emitter.prototype.remove=function(){"use strict";return null!==this.group?this.group.removeEmitter(this):console.error("Emitter does not belong to a group, cannot remove."),this},function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Stats=t()}(this,function(){var e=function(){function t(e){return n.appendChild(e.dom),e}function i(e){for(var t=0;t<n.children.length;t++)n.children[t].style.display=t===e?"block":"none";r=e}var r=0,n=document.createElement("div");n.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",n.addEventListener("click",function(e){e.preventDefault(),i(++r%n.children.length)},!1);var o=(performance||Date).now(),a=o,s=0,l=t(new e.Panel("FPS","#0ff","#002")),c=t(new e.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var u=t(new e.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:n,addPanel:t,showPanel:i,begin:function(){o=(performance||Date).now()},end:function(){s++;var e=(performance||Date).now();if(c.update(e-o,200),e>a+1e3&&(l.update(1e3*s/(e-a),100),a=e,s=0,u)){var t=performance.memory;u.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){o=this.end()},domElement:n,setMode:i}};return e.Panel=function(e,t,i){var r=1/0,n=0,o=Math.round,a=o(window.devicePixelRatio||1),s=80*a,l=48*a,c=3*a,u=2*a,h=3*a,p=15*a,d=74*a,f=30*a,m=document.createElement("canvas");m.width=s,m.height=l,m.style.cssText="width:80px;height:48px";var g=m.getContext("2d");return g.font="bold "+9*a+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=i,g.fillRect(0,0,s,l),g.fillStyle=t,g.fillText(e,c,u),g.fillRect(h,p,d,f),g.fillStyle=i,g.globalAlpha=.9,g.fillRect(h,p,d,f),{dom:m,update:function(l,v){r=Math.min(r,l),n=Math.max(n,l),g.fillStyle=i,g.globalAlpha=1,g.fillRect(0,0,s,p),g.fillStyle=t,g.fillText(o(l)+" "+e+" ("+o(r)+"-"+o(n)+")",c,u),g.drawImage(m,h+a,p,d-a,f,h,p,d-a,f),g.fillRect(h+d-a,p,a,f),g.fillStyle=i,g.globalAlpha=.9,g.fillRect(h+d-a,p,a,o((1-l/v)*f))}}},e}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.thingjs={})}(this,function(e){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e}function o(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.dracoLoader=null}function a(){var e={};return{get:function(t){return e[t]},add:function(t,i){e[t]=i},remove:function(t){delete e[t]},removeAll:function(){e={}}}}o.prototype={constructor:o,crossOrigin:"anonymous",load:function(e,t,i,r){var n,o=this;n=void 0!==this.resourcePath?this.resourcePath:void 0!==this.path?this.path:THREE.LoaderUtils.extractUrlBase(e),o.manager.itemStart(e);var a=function(t){var i=!1;r?i=r(t):console.error(t),i||o.manager.itemError(e),o.manager.itemEnd(e)},s=new THREE.FileLoader(o.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.load(e,function(i){try{o.parse(i,n,function(i){t(i),o.manager.itemEnd(e)},a)}catch(e){a(e)}},i,a)},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setDRACOLoader:function(e){return this.dracoLoader=e,this},parse:function(e,t,i,r){var n,o={};if("string"==typeof e)n=e;else if(THREE.LoaderUtils.decodeText(new Uint8Array(e,0,4))===h){try{o[s.KHR_BINARY_GLTF]=new f(e)}catch(e){return void(r&&r(e))}n=o[s.KHR_BINARY_GLTF].content}else n=THREE.LoaderUtils.decodeText(new Uint8Array(e));var a=JSON.parseX(n,this);if(a)if(void 0===a.asset||a.asset.version[0]<2)r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported. Use LegacyGLTFLoader instead."));else{if(a.extensionsUsed)for(var p=0;p<a.extensionsUsed.length;++p){var d=a.extensionsUsed[p],y=a.extensionsRequired||[];switch(d){case s.KHR_LIGHTS_PUNCTUAL:o[d]=new c(a);break;case s.KHR_MATERIALS_UNLIT:o[d]=new u(a);break;case s.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:o[d]=new v(a);break;case s.KHR_DRACO_MESH_COMPRESSION:o[d]=new m(a,this.dracoLoader);break;case s.MSFT_TEXTURE_DDS:o[s.MSFT_TEXTURE_DDS]=new l(a);break;case s.KHR_TEXTURE_TRANSFORM:o[s.KHR_TEXTURE_TRANSFORM]=new g(a);break;default:y.indexOf(d)>=0&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}var b=new W(a,o,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager});b.parse(function(e,t,r,n,a){b.getDependencies("material").then(function(s){var l={scene:e,scenes:t,cameras:r,animations:n,asset:a.asset,parser:b,userData:{},materials:s};B(o,l,a),i(l)})},r)}else r&&r(new Error("THREE.GLTFLoader: Unsupported JSON data."))}};var s={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function l(){if(!THREE.DDSLoader)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing THREE.DDSLoader");this.name=s.MSFT_TEXTURE_DDS,this.ddsLoader=new THREE.DDSLoader}function c(e){this.name=s.KHR_LIGHTS_PUNCTUAL;var t=e.extensions&&e.extensions[s.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=t.lights||[]}function u(e){this.name=s.KHR_MATERIALS_UNLIT}c.prototype.loadLight=function(e){var t,i=this.lightDefs[e],r=new THREE.Color(16777215);void 0!==i.color&&r.fromArray(i.color);var n=void 0!==i.range?i.range:0;switch(i.type){case"directional":(t=new THREE.DirectionalLight(r)).target.position.set(0,0,-1),t.add(t.target);break;case"point":(t=new THREE.PointLight(r)).distance=n;break;case"spot":(t=new THREE.SpotLight(r)).distance=n,i.spot=i.spot||{},i.spot.innerConeAngle=void 0!==i.spot.innerConeAngle?i.spot.innerConeAngle:0,i.spot.outerConeAngle=void 0!==i.spot.outerConeAngle?i.spot.outerConeAngle:Math.PI/4,t.angle=i.spot.outerConeAngle,t.penumbra=1-i.spot.innerConeAngle/i.spot.outerConeAngle,t.target.position.set(0,0,-1),t.add(t.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+i.type+'".')}return t.decay=2,void 0!==i.intensity&&(t.intensity=i.intensity),t.name=i.name||"light_"+e,Promise.resolve(t)},u.prototype.getMaterialType=function(e){return THREE.MeshBasicMaterial},u.prototype.extendParams=function(e,t,i){var r=[];e.color=new THREE.Color(1,1,1),e.opacity=1;var n=t.pbrMetallicRoughness;if(n){if(Array.isArray(n.baseColorFactor)){var o=n.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}void 0!==n.baseColorTexture&&r.push(i.assignTexture(e,"map",n.baseColorTexture))}return Promise.all(r)};var h="glTF",p=12,d={JSON:1313821514,BIN:5130562};function f(e){this.name=s.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(e,0,p);if(this.header={magic:THREE.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==h)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.");for(var i=new DataView(e,p),r=0;r<i.byteLength;){var n=i.getUint32(r,!0);r+=4;var o=i.getUint32(r,!0);if(r+=4,o===d.JSON){var a=new Uint8Array(e,p+r,n);this.content=THREE.LoaderUtils.decodeText(a)}else if(o===d.BIN){var l=p+r;this.body=e.slice(l,l+n)}r+=n}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function m(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=s.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,THREE.DRACOLoader.getDecoderModule()}function g(e){this.name=s.KHR_TEXTURE_TRANSFORM}function v(){return{name:s.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return THREE.ShaderMaterial},extendParams:function(e,t,i){var r=t.extensions[this.name],n=THREE.ShaderLib.standard,o=THREE.UniformsUtils.clone(n.uniforms),a=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),s=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),l=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),c=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),u=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","material.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),h=n.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",a).replace("#include <metalnessmap_pars_fragment>",s).replace("#include <roughnessmap_fragment>",l).replace("#include <metalnessmap_fragment>",c).replace("#include <lights_physical_fragment>",u);delete o.roughness,delete o.metalness,delete o.roughnessMap,delete o.metalnessMap,o.specular={value:(new THREE.Color).setHex(1118481)},o.glossiness={value:.5},o.specularMap={value:null},o.glossinessMap={value:null},e.vertexShader=n.vertexShader,e.fragmentShader=h,e.uniforms=o,e.defines={STANDARD:""},e.color=new THREE.Color(1,1,1),e.opacity=1;var p=[];if(Array.isArray(r.diffuseFactor)){var d=r.diffuseFactor;e.color.fromArray(d),e.opacity=d[3]}if(void 0!==r.diffuseTexture&&p.push(i.assignTexture(e,"map",r.diffuseTexture)),e.emissive=new THREE.Color(0,0,0),e.glossiness=void 0!==r.glossinessFactor?r.glossinessFactor:1,e.specular=new THREE.Color(1,1,1),Array.isArray(r.specularFactor)&&e.specular.fromArray(r.specularFactor),void 0!==r.specularGlossinessTexture){var f=r.specularGlossinessTexture;p.push(i.assignTexture(e,"glossinessMap",f)),p.push(i.assignTexture(e,"specularMap",f))}return Promise.all(p)},createMaterial:function(e){var t=new THREE.ShaderMaterial({defines:e.defines,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,fog:!0,lights:!0,opacity:e.opacity,transparent:e.transparent});return t.isGLTFSpecularGlossinessMaterial=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t.extensions.derivatives=!0,t},cloneMaterial:function(e){var t=e.clone();t.isGLTFSpecularGlossinessMaterial=!0;for(var i=this.specularGlossinessParams,r=0,n=i.length;r<n;r++)t[i[r]]=e[i[r]];return t},refreshUniforms:function(e,t,i,r,n,o){if(!0===n.isGLTFSpecularGlossinessMaterial){var a,s=n.uniforms,l=n.defines;s.opacity.value=n.opacity,s.diffuse.value.copy(n.color),s.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),s.map.value=n.map,s.specularMap.value=n.specularMap,s.alphaMap.value=n.alphaMap,s.lightMap.value=n.lightMap,s.lightMapIntensity.value=n.lightMapIntensity,s.aoMap.value=n.aoMap,s.aoMapIntensity.value=n.aoMapIntensity,n.map?a=n.map:n.specularMap?a=n.specularMap:n.displacementMap?a=n.displacementMap:n.normalMap?a=n.normalMap:n.bumpMap?a=n.bumpMap:n.glossinessMap?a=n.glossinessMap:n.alphaMap?a=n.alphaMap:n.emissiveMap&&(a=n.emissiveMap),void 0!==a&&(a.isWebGLRenderTarget&&(a=a.texture),!0===a.matrixAutoUpdate&&a.updateMatrix(),s.uvTransform.value.copy(a.matrix)),n.envMap&&(s.envMap.value=n.envMap,s.envMapIntensity.value=n.envMapIntensity,s.flipEnvMap.value=n.envMap.isCubeTexture?-1:1,s.reflectivity.value=n.reflectivity,s.refractionRatio.value=n.refractionRatio,s.maxMipLevel.value=e.properties.get(n.envMap).__maxMipLevel),s.specular.value.copy(n.specular),s.glossiness.value=n.glossiness,s.glossinessMap.value=n.glossinessMap,s.emissiveMap.value=n.emissiveMap,s.bumpMap.value=n.bumpMap,s.normalMap.value=n.normalMap,s.displacementMap.value=n.displacementMap,s.displacementScale.value=n.displacementScale,s.displacementBias.value=n.displacementBias,null!==s.glossinessMap.value&&void 0===l.USE_GLOSSINESSMAP&&(l.USE_GLOSSINESSMAP="",l.USE_ROUGHNESSMAP=""),null===s.glossinessMap.value&&void 0!==l.USE_GLOSSINESSMAP&&(delete l.USE_GLOSSINESSMAP,delete l.USE_ROUGHNESSMAP)}}}}function y(e,t,i,r){THREE.Interpolant.call(this,e,t,i,r)}m.prototype.decodePrimitive=function(e,t){var i=this.json,r=this.dracoLoader,n=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},s={},l={};for(var c in o)c in C&&(a[C[c]]=o[c]);for(c in e.attributes)if(void 0!==C[c]&&void 0!==o[c]){var u=i.accessors[e.attributes[c]],h=M[u.componentType];l[C[c]]=h,s[C[c]]=!0===u.normalized}return t.getDependency("bufferView",n).then(function(e){return new Promise(function(t){r.decodeDracoFile(e,function(e){for(var i in e.attributes){var r=e.attributes[i],n=s[i];void 0!==n&&(r.normalized=n)}t(e)},a,l)})})},g.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},y.prototype=Object.create(THREE.Interpolant.prototype),y.prototype.constructor=y,y.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,n=e*r*3+r,o=0;o!==r;o++)t[o]=i[n+o];return t},y.prototype.beforeStart_=y.prototype.copySampleValue_,y.prototype.afterEnd_=y.prototype.copySampleValue_,y.prototype.interpolate_=function(e,t,i,r){for(var n=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=2*a,l=3*a,c=r-t,u=(i-t)/c,h=u*u,p=h*u,d=e*l,f=d-l,m=-2*p+3*h,g=p-h,v=1-m,y=g-h+u,b=0;b!==a;b++){var _=o[f+b+a],x=o[f+b+s]*c,E=o[d+b+a],w=o[d+b]*c;n[b]=v*_+y*x+m*E+g*w}return n};var b=0,_=1,x=2,E=3,w=4,T=5,S=6,M=(Number,THREE.Matrix3,THREE.Matrix4,THREE.Vector2,THREE.Vector3,THREE.Vector4,THREE.Texture,{5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array}),R={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipMapNearestFilter,9985:THREE.LinearMipMapNearestFilter,9986:THREE.NearestMipMapLinearFilter,9987:THREE.LinearMipMapLinearFilter},P={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},A=(THREE.BackSide,THREE.FrontSide,THREE.NeverDepth,THREE.LessDepth,THREE.EqualDepth,THREE.LessEqualDepth,THREE.GreaterEqualDepth,THREE.NotEqualDepth,THREE.GreaterEqualDepth,THREE.AlwaysDepth,THREE.AddEquation,THREE.SubtractEquation,THREE.ReverseSubtractEquation,THREE.ZeroFactor,THREE.OneFactor,THREE.SrcColorFactor,THREE.OneMinusSrcColorFactor,THREE.SrcAlphaFactor,THREE.OneMinusSrcAlphaFactor,THREE.DstAlphaFactor,THREE.OneMinusDstAlphaFactor,THREE.DstColorFactor,THREE.OneMinusDstColorFactor,THREE.SrcAlphaSaturateFactor,{SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16}),C={POSITION:"position",NORMAL:"normal",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",TEXCOORD_2:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},O={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},L={CUBICSPLINE:THREE.InterpolateSmooth,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete},k="OPAQUE",H="MASK",j="BLEND",F={"image/png":THREE.RGBAFormat,"image/jpeg":THREE.RGBFormat};function D(e,t){return"string"!=typeof e||""===e?"":/^(https?:)?\/\//i.test(e)?e:/^data:.*,.*$/i.test(e)?e:/^blob:.*$/i.test(e)?e:t+e}function B(e,t,i){for(var r in i.extensions)void 0===e[r]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=i.extensions[r])}function I(e,i){void 0!==i.extras&&("object"===t(i.extras)?e.userData=i.extras:console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+i.extras))}function N(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var i=0,r=t.weights.length;i<r;i++)e.morphTargetInfluences[i]=t.weights[i];if(t.extras&&Array.isArray(t.extras.targetNames)){var n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(i=0,r=n.length;i<r;i++)e.morphTargetDictionary[n[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function U(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(var i in e)if(e[i]!==t[i])return!1;return!0}function V(e,t){if(e.length!==t.length)return!1;for(var i=0,r=e.length;i<r;i++)if(e[i]!==t[i])return!1;return!0}function z(e,t){for(var i=0,r=e.length;i<r;i++){var n=e[i];if(o=n.primitive,a=t,l=void 0,c=void 0,l=o.extensions?o.extensions[s.KHR_DRACO_MESH_COMPRESSION]:void 0,c=a.extensions?a.extensions[s.KHR_DRACO_MESH_COMPRESSION]:void 0,l&&c?l.bufferView===c.bufferView&&U(l.attributes,c.attributes):o.indices===a.indices&&U(o.attributes,a.attributes))return n.promise}var o,a,l,c;return null}function q(e){if(e.isInterleavedBufferAttribute){for(var t=e.count,i=e.itemSize,r=e.array.slice(0,t*i),n=0;n<t;++n)r[n]=e.getX(n),i>=2&&(r[n+1]=e.getY(n)),i>=3&&(r[n+2]=e.getZ(n)),i>=4&&(r[n+3]=e.getW(n));return new THREE.BufferAttribute(r,i,e.normalized)}return e.clone()}function W(e,t,i){this.json=e||{},this.extensions=t||{},this.options=i||{},this.cache=new a,this.primitiveCache=[],this.multiplePrimitivesCache=[],this.multiPassGeometryCache=[],this.textureLoader=new THREE.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new THREE.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer")}function G(e,t,i){var r=t.attributes,n=[];function o(t,r){return i.getDependency("accessor",t).then(function(t){e.addAttribute(r,t)})}for(var a in r){var s=C[a];s&&(s in e.attributes||n.push(o(r[a],s)))}if(void 0!==t.indices&&!e.index){var l=i.getDependency("accessor",t.indices).then(function(t){e.setIndex(t)});n.push(l)}return I(e,t),Promise.all(n).then(function(){return void 0!==t.targets?function(e,t,i){for(var r=!1,n=!1,o=0,a=t.length;o<a;o++){if(void 0!==(c=t[o]).POSITION&&(r=!0),void 0!==c.NORMAL&&(n=!0),r&&n)break}if(!r&&!n)return Promise.resolve(e);var s=[],l=[];for(o=0,a=t.length;o<a;o++){var c=t[o];if(r){var u=void 0!==c.POSITION?i.getDependency("accessor",c.POSITION).then(function(e){return q(e)}):e.attributes.position;s.push(u)}if(n){u=void 0!==c.NORMAL?i.getDependency("accessor",c.NORMAL).then(function(e){return q(e)}):e.attributes.normal;l.push(u)}}return Promise.all([Promise.all(s),Promise.all(l)]).then(function(i){for(var o=i[0],a=i[1],s=0,l=t.length;s<l;s++){var c=t[s],u="morphTarget"+s;if(r&&void 0!==c.POSITION){var h=o[s];h.name=u;for(var p=e.attributes.position,d=0,f=h.count;d<f;d++)h.setXYZ(d,h.getX(d)+p.getX(d),h.getY(d)+p.getY(d),h.getZ(d)+p.getZ(d))}if(n&&void 0!==c.NORMAL){var m=a[s];m.name=u;var g=e.attributes.normal;for(d=0,f=m.count;d<f;d++)m.setXYZ(d,m.getX(d)+g.getX(d),m.getY(d)+g.getY(d),m.getZ(d)+g.getZ(d))}}return r&&(e.morphAttributes.position=o),n&&(e.morphAttributes.normal=a),e})}(e,t.targets,i):e})}W.prototype.parse=function(e,t){var i=this.json;this.cache.removeAll(),this.markDefs(),this.getMultiDependencies(["scene","animation","camera"]).then(function(t){var r=t.scenes||[],n=r[i.scene||0],o=t.animations||[],a=t.cameras||[];e(n,r,a,o,i)}).catch(t)},W.prototype.markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[],r={},n={},o=0,a=t.length;o<a;o++)for(var s=t[o].joints,l=0,c=s.length;l<c;l++)e[s[l]].isBone=!0;for(var u=0,h=e.length;u<h;u++){var p=e[u];void 0!==p.mesh&&(void 0===r[p.mesh]&&(r[p.mesh]=n[p.mesh]=0),r[p.mesh]++,void 0!==p.skin&&(i[p.mesh].isSkinnedMesh=!0))}this.json.meshReferences=r,this.json.meshUses=n},W.prototype.getDependency=function(e,t){var i=e+":"+t,r=this.cache.get(i);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this.loadNode(t);break;case"mesh":r=this.loadMesh(t);break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this.loadBufferView(t);break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this.loadMaterial(t);break;case"texture":r=this.loadTexture(t);break;case"skin":r=this.loadSkin(t);break;case"animation":r=this.loadAnimation(t);break;case"camera":r=this.loadCamera(t);break;case"light":r=this.extensions[s.KHR_LIGHTS_PUNCTUAL].loadLight(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(i,r)}return r},W.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var i=this,r=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(r.map(function(t,r){return i.getDependency(e,r)})),this.cache.add(e,t)}return t},W.prototype.getMultiDependencies=function(e){for(var t={},i=[],r=0,n=e.length;r<n;r++){var o=e[r],a=this.getDependencies(o);a=a.then(function(e,i){t[e]=i}.bind(this,o+("mesh"===o?"es":"s"))),i.push(a)}return Promise.all(i).then(function(){return t})},W.prototype.loadBuffer=function(e){var t=this.json.buffers[e],i=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[s.KHR_BINARY_GLTF].body);var r=this.options;return new Promise(function(e,n){i.load(D(t.uri,r.path),e,void 0,function(){n(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})},W.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){var i=t.byteLength||0,r=t.byteOffset||0;return e.slice(r,r+i)})},W.prototype.loadAccessor=function(e){var t=this,i=this.json,r=this.json.accessors[e];if(void 0===r.bufferView&&void 0===r.sparse)return Promise.resolve(null);var n=[];return void 0!==r.bufferView?n.push(this.getDependency("bufferView",r.bufferView)):n.push(null),void 0!==r.sparse&&(n.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),n.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(n).then(function(e){var n,o,a=e[0],s=A[r.type],l=M[r.componentType],c=l.BYTES_PER_ELEMENT,u=c*s,h=r.byteOffset||0,p=void 0!==r.bufferView?i.bufferViews[r.bufferView].byteStride:void 0,d=!0===r.normalized;if(p&&p!==u){var f="InterleavedBuffer:"+r.bufferView+":"+r.componentType,m=t.cache.get(f);m||(n=new l(a),m=new THREE.InterleavedBuffer(n,p/c),t.cache.add(f,m)),o=new THREE.InterleavedBufferAttribute(m,s,h/c,d)}else n=null===a?new l(r.count*s):new l(a,h,r.count*s),o=new THREE.BufferAttribute(n,s,d);if(void 0!==r.sparse){var g=A.SCALAR,v=M[r.sparse.indices.componentType],y=r.sparse.indices.byteOffset||0,b=r.sparse.values.byteOffset||0,_=new v(e[1],y,r.sparse.count*g),x=new l(e[2],b,r.sparse.count*s);null!==a&&o.setArray(o.array.slice());for(var E=0,w=_.length;E<w;E++){var T=_[E];if(o.setX(T,x[E*s]),s>=2&&o.setY(T,x[E*s+1]),s>=3&&o.setZ(T,x[E*s+2]),s>=4&&o.setW(T,x[E*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return o})},W.prototype.loadTexture=function(e){var t,i=this,r=this.json,n=this.options,o=this.textureLoader,a=window.URL||window.webkitURL,l=r.textures[e],c=l.extensions||{},u=(t=c[s.MSFT_TEXTURE_DDS]?r.images[c[s.MSFT_TEXTURE_DDS].source]:r.images[l.source]).uri,h=!1;return void 0!==t.bufferView&&(u=i.getDependency("bufferView",t.bufferView).then(function(e){h=!0;var i=new Blob([e],{type:t.mimeType});return u=a.createObjectURL(i)})),Promise.resolve(u).then(function(e){var t=THREE.Loader.Handlers.get(e);return t||(t=c[s.MSFT_TEXTURE_DDS]?i.extensions[s.MSFT_TEXTURE_DDS].ddsLoader:o),new Promise(function(i,r){t.load(D(e,n.path),i,void 0,r)})}).then(function(e){!0===h&&a.revokeObjectURL(u),e.flipY=!1,void 0!==l.name&&(e.name=l.name),t.mimeType in F&&(e.format=F[t.mimeType]);var i=(r.samplers||{})[l.sampler]||{};return e.magFilter=R[i.magFilter]||THREE.LinearFilter,e.minFilter=R[i.minFilter]||THREE.LinearMipMapLinearFilter,e.wrapS=P[i.wrapS]||THREE.RepeatWrapping,e.wrapT=P[i.wrapT]||THREE.RepeatWrapping,e})},W.prototype.assignTexture=function(e,t,i){var r=this;return this.getDependency("texture",i.index).then(function(n){if(r.extensions[s.KHR_TEXTURE_TRANSFORM]){var o=void 0!==i.extensions?i.extensions[s.KHR_TEXTURE_TRANSFORM]:void 0;o&&(n=r.extensions[s.KHR_TEXTURE_TRANSFORM].extendTexture(n,o))}e[t]=n})},W.prototype.loadMaterial=function(e){var t,i=this.json,r=this.extensions,n=i.materials[e],o={},a=n.extensions||{},l=[];if(a[s.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var c=r[s.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=c.getMaterialType(n),l.push(c.extendParams(o,n,this))}else if(a[s.KHR_MATERIALS_UNLIT]){var u=r[s.KHR_MATERIALS_UNLIT];t=u.getMaterialType(n),l.push(u.extendParams(o,n,this))}else{t=THREE.MeshStandardMaterial;var h=n.pbrMetallicRoughness||{};if(o.color=new THREE.Color(1,1,1),o.opacity=1,Array.isArray(h.baseColorFactor)){var p=h.baseColorFactor;o.color.fromArray(p),o.opacity=p[3]}void 0!==h.baseColorTexture&&(l.push(this.assignTexture(o,"map",h.baseColorTexture)),1==h.baseColorTexture.texCoord&&(o.__useDiffuseUV2=!0)),o.metalness=void 0!==h.metallicFactor?h.metallicFactor:1,o.roughness=void 0!==h.roughnessFactor?h.roughnessFactor:1,void 0!==h.metallicRoughnessTexture&&(l.push(this.assignTexture(o,"metalnessMap",h.metallicRoughnessTexture)),l.push(this.assignTexture(o,"roughnessMap",h.metallicRoughnessTexture)))}!0===n.doubleSided&&(o.side=THREE.DoubleSide);var d=n.alphaMode||k;d===j?o.transparent=!0:(o.transparent=!1,d===H&&(o.alphaTest=void 0!==n.alphaCutoff?n.alphaCutoff:.5)),void 0!==n.normalTexture&&t!==THREE.MeshBasicMaterial&&(l.push(this.assignTexture(o,"normalMap",n.normalTexture)),o.normalScale=new THREE.Vector2(1,1),void 0!==n.normalTexture.scale&&o.normalScale.set(n.normalTexture.scale,n.normalTexture.scale)),void 0!==n.occlusionTexture&&t!==THREE.MeshBasicMaterial&&(l.push(this.assignTexture(o,"aoMap",n.occlusionTexture)),void 0!==n.occlusionTexture.strength&&(o.aoMapIntensity=n.occlusionTexture.strength)),void 0!==n.emissiveFactor&&t!==THREE.MeshBasicMaterial&&(o.emissive=(new THREE.Color).fromArray(n.emissiveFactor)),void 0!==n.emissiveTexture&&t!==THREE.MeshBasicMaterial&&l.push(this.assignTexture(o,"emissiveMap",n.emissiveTexture));var f=[],m=a.blend;if(m)for(var g=0;g<m.length;g++)m[g].maskTexture&&l.push(this.assignTexture(f,g,m[g].maskTexture));return Promise.all(l).then(function(){var e,i=o.__useDiffuseUV2;for(var l in i&&delete o.__useDiffuseUV2,e=t===THREE.ShaderMaterial?r[s.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(o):new t(o),void 0!==n.name&&(e.name=n.name),e.normalScale&&(e.normalScale.y=-e.normalScale.y),e.map&&(e.map.encoding=THREE.sRGBEncoding),e.emissiveMap&&(e.emissiveMap.encoding=THREE.sRGBEncoding),e.specularMap&&(e.specularMap.encoding=THREE.sRGBEncoding),I(e,n),n.extensions&&B(r,e,n),a)void 0===r[l]&&("sceneBlend"===l?(e.transparent=!0,e.blending=void 0===THREE[a[l]+"Blending"]?1:THREE[a[l]+"Blending"]):"blend"===l&&(e.__texture=f));var c=(n.pbrMetallicRoughness||{}).baseColorTexture,u=n.emissiveTexture,h=n.normalTexture;return void 0===e.userData.gltfExtensions&&(e.userData.gltfExtensions={}),c&&c.extensions&&(e.userData.gltfExtensions.baseColorTexture=c.extensions),u&&u.extensions&&(e.userData.gltfExtensions.emissiveTexture=u.extensions),h&&h.extensions&&(e.userData.gltfExtensions.normalTexture=h.extensions),i&&(e.userData.gltfExtensions.useDiffuseUV2=!0),e})},W.prototype.loadGeometries=function(e){var t,i=this,r=this.extensions,n=this.primitiveCache,o=function(e){if(e.length<2)return!1;var t=e[0],i=t.targets||[];if(void 0===t.indices)return!1;for(var r=1,n=e.length;r<n;r++){var o=e[r];if(t.mode!==o.mode)return!1;if(void 0===o.indices)return!1;if(o.extensions&&o.extensions[s.KHR_DRACO_MESH_COMPRESSION])return!1;if(!U(t.attributes,o.attributes))return!1;var a=o.targets||[];if(i.length!==a.length)return!1;for(var l=0,c=i.length;l<c;l++)if(!U(i[l],a[l]))return!1}return!0}(e);function a(e){return r[s.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,i).then(function(t){return G(t,e,i)})}o&&(t=e,e=[e[0]]);for(var l=[],c=0,u=e.length;c<u;c++){var h,p=e[c],d=z(n,p);if(d)l.push(d);else h=p.extensions&&p.extensions[s.KHR_DRACO_MESH_COMPRESSION]?a(p):G(new THREE.BufferGeometry,p,i),n.push({primitive:p,promise:h}),l.push(h)}return Promise.all(l).then(function(r){if(r.forEach(function(e){var t=e.attributes.color;if(t&&4===t.itemSize){for(var i=t.count,r=new Float32Array(i),n=0;n<i;n++)r.set([t.getW(n)],n);var o=new THREE.BufferAttribute(r,1);e.addAttribute("alphaIndex",o)}}),o){var n=r[0];if(null!==(p=function(e,t,i){for(var r=0,n=e.length;r<n;r++){var o=e[r];if(t===o.baseGeometry&&V(i,o.primitives))return o.geometry}return null}(h=i.multiPassGeometryCache,n,t)))return[p.geometry];var a=new THREE.BufferGeometry;for(var s in a.name=n.name,a.userData=n.userData,n.attributes)a.addAttribute(s,n.attributes[s]);for(var s in n.morphAttributes)a.morphAttributes[s]=n.morphAttributes[s];for(var l=[],c=0,u=t.length;c<u;c++)l.push(i.getDependency("accessor",t[c].indices));return Promise.all(l).then(function(e){for(var i=[],r=0,o=0,s=t.length;o<s;o++){for(var l=e[o],c=0,u=l.count;c<u;c++)i.push(l.array[c]);a.addGroup(r,l.count,o),r+=l.count}return a.setIndex(i),h.push({geometry:a,baseGeometry:n,primitives:t}),[a]})}if(r.length>1&&void 0!==THREE.BufferGeometryUtils){for(c=1,u=e.length;c<u;c++)if(e[0].mode!==e[c].mode)return r;var h,p;if(p=function(e,t){for(var i=0,r=e.length;i<r;i++){var n=e[i];if(V(t,n.baseGeometries))return n.geometry}return null}(h=i.multiplePrimitivesCache,r)){if(null!==p.geometry)return[p.geometry]}else{a=THREE.BufferGeometryUtils.mergeBufferGeometries(r,!0);if(h.push({geometry:a,baseGeometries:r}),null!==a)return[a]}}return r})},W.prototype.loadMesh=function(e){for(var t=this,i=this.json,r=this.extensions,n=i.meshes[e],o=n.primitives,a=[],l=0,c=o.length;l<c;l++){var u=void 0===o[l].material?new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:THREE.FrontSide}):this.getDependency("material",o[l].material);a.push(u)}return Promise.all(a).then(function(i){return t.loadGeometries(o).then(function(a){for(var l=1===a.length&&a[0].groups.length>0,c=[],u=0,h=a.length;u<h;u++){var p,d=a[u],f=o[u],m=l?i:i[u];if(f.mode===w||f.mode===T||f.mode===S||void 0===f.mode)!0===(p=!0===n.isSkinnedMesh?new THREE.SkinnedMesh(d,m):new THREE.Mesh(d,m)).isSkinnedMesh&&p.normalizeSkinWeights(),f.mode===T?p.drawMode=THREE.TriangleStripDrawMode:f.mode===S&&(p.drawMode=THREE.TriangleFanDrawMode);else if(f.mode===_)p=new THREE.LineSegments(d,m);else if(f.mode===E)p=new THREE.Line(d,m);else if(f.mode===x)p=new THREE.LineLoop(d,m);else{if(f.mode!==b)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+f.mode);p=new THREE.Points(d,m)}Object.keys(p.geometry.morphAttributes).length>0&&N(p,n),p.name=n.name||"mesh_"+e,a.length>1&&(p.name+="_"+u),I(p,n),c.push(p);for(var g=l?p.material:[p.material],v=void 0!==d.attributes.color,y=void 0!==d.attributes.alphaIndex,M=void 0===d.attributes.normal,R=!0===p.isSkinnedMesh,P=Object.keys(d.morphAttributes).length>0,A=P&&void 0!==d.morphAttributes.normal,C=0,O=g.length;C<O;C++){m=g[C];if(p.isPoints){var L="PointsMaterial:"+m.uuid,k=t.cache.get(L);k||(k=new THREE.PointsMaterial,THREE.Material.prototype.copy.call(k,m),k.color.copy(m.color),k.map=m.map,k.lights=!1,t.cache.add(L,k)),m=k}else if(p.isLine){L="LineBasicMaterial:"+m.uuid;var H=t.cache.get(L);H||(H=new THREE.LineBasicMaterial,THREE.Material.prototype.copy.call(H,m),H.color.copy(m.color),H.lights=!1,t.cache.add(L,H)),m=H}if(v||y||M||R||P){L="ClonedMaterial:"+m.uuid+":";m.isGLTFSpecularGlossinessMaterial&&(L+="specular-glossiness:"),R&&(L+="skinning:"),v&&(L+="vertex-colors:"),y&&(L+="vertex-alpha:"),M&&(L+="flat-shading:"),P&&(L+="morph-targets:"),A&&(L+="morph-normals:");var j=t.cache.get(L);j||(j=m.isGLTFSpecularGlossinessMaterial?r[s.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].cloneMaterial(m):m.clone(),R&&(j.skinning=!0),v&&(j.vertexColors=THREE.VertexColors),y&&(j.defines=j.defines||{},j.defines.USE_ALPHAINDEX=!0),M&&(j.flatShading=!0),P&&(j.morphTargets=!0),A&&(j.morphNormals=!0),t.cache.add(L,j)),m=j}g[C]=m,m.aoMap&&void 0===d.attributes.uv2&&void 0!==d.attributes.uv&&(console.log("THREE.GLTFLoader: Duplicating UVs to support aoMap."),d.addAttribute("uv2",new THREE.BufferAttribute(d.attributes.uv.array,2))),m.isGLTFSpecularGlossinessMaterial&&(p.onBeforeRender=r[s.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].refreshUniforms)}p.material=l?g:g[0]}if(1===c.length)return c[0];var F=new THREE.Group;for(u=0,h=c.length;u<h;u++)F.add(c[u]);return F})})},W.prototype.loadCamera=function(e){var t,i=this.json.cameras[e],r=i[i.type];if(r)return"perspective"===i.type?t=new THREE.PerspectiveCamera(THREE.Math.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===i.type&&(t=new THREE.OrthographicCamera(r.xmag/-2,r.xmag/2,r.ymag/2,r.ymag/-2,r.znear,r.zfar)),void 0!==i.name&&(t.name=i.name),I(t,i),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")},W.prototype.loadSkin=function(e){var t=this.json.skins[e],i={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(i):this.getDependency("accessor",t.inverseBindMatrices).then(function(e){return i.inverseBindMatrices=e,i})},W.prototype.loadAnimation=function(e){for(var t=this.json.animations[e],i=[],r=[],n=[],o=[],a=[],s=0,l=t.channels.length;s<l;s++){var c=t.channels[s],u=t.samplers[c.sampler],h=c.target,p=void 0!==h.node?h.node:h.id,d=void 0!==t.parameters?t.parameters[u.input]:u.input,f=void 0!==t.parameters?t.parameters[u.output]:u.output;i.push(this.getDependency("node",p)),r.push(this.getDependency("accessor",d)),n.push(this.getDependency("accessor",f)),o.push(u),a.push(h)}return Promise.all([Promise.all(i),Promise.all(r),Promise.all(n),Promise.all(o),Promise.all(a)]).then(function(i){for(var r=i[0],n=i[1],o=i[2],a=i[3],s=i[4],l=[],c=0,u=r.length;c<u;c++){var h=r[c],p=n[c],d=o[c],f=a[c],m=s[c];if(void 0!==h){var g;switch(h.updateMatrix(),h.matrixAutoUpdate=!0,O[m.path]){case O.weights:g=THREE.NumberKeyframeTrack;break;case O.rotation:g=THREE.QuaternionKeyframeTrack;break;case O.position:case O.scale:default:g=THREE.VectorKeyframeTrack}var v=h.name?h.name:h.uuid,b=void 0!==f.interpolation?L[f.interpolation]:THREE.InterpolateLinear,_=[];O[m.path]===O.weights?h.traverse(function(e){!0===e.isMesh&&e.morphTargetInfluences&&_.push(e.name?e.name:e.uuid)}):_.push(v);for(var x=0,E=_.length;x<E;x++){var w=new g(_[x]+"."+O[m.path],THREE.AnimationUtils.arraySlice(p.array,0),THREE.AnimationUtils.arraySlice(d.array,0),b);"CUBICSPLINE"===f.interpolation&&(w.createInterpolant=function(e){return new y(this.times,this.values,this.getValueSize()/3,e)},w.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(w)}}}var T=void 0!==t.name?t.name:"animation_"+e;return new THREE.AnimationClip(T,void 0,l)})},W.prototype.loadNode=function(e){var t=this.json,i=this.extensions,r=this,n=t.meshReferences,o=t.meshUses,a=t.nodes[e];return new Promise(function(e){!0===a.isBone?e(new THREE.Bone):void 0!==a.mesh?r.getDependency("mesh",a.mesh).then(function(t){var i;if(n[a.mesh]>1){var r=o[a.mesh]++;(i=t.clone()).name+="_instance_"+r,i.onBeforeRender=t.onBeforeRender;for(var s=0,l=i.children.length;s<l;s++)i.children[s].name+="_instance_"+r,i.children[s].onBeforeRender=t.children[s].onBeforeRender}else i=t;e(i)}):void 0!==a.camera?r.getDependency("camera",a.camera).then(e):a.extensions&&a.extensions[s.KHR_LIGHTS_PUNCTUAL]&&void 0!==a.extensions[s.KHR_LIGHTS_PUNCTUAL].light?r.getDependency("light",a.extensions[s.KHR_LIGHTS_PUNCTUAL].light).then(e):e(new THREE.Object3D)}).then(function(e){if(void 0!==a.name&&(e.name=THREE.PropertyBinding.sanitizeNodeName(a.name)),I(e,a),a.extensions&&B(i,e,a),void 0!==a.matrix){var t=new THREE.Matrix4;t.fromArray(a.matrix),e.applyMatrix(t)}else void 0!==a.translation&&e.position.fromArray(a.translation),void 0!==a.rotation&&e.quaternion.fromArray(a.rotation),void 0!==a.scale&&e.scale.fromArray(a.scale);return e})},W.prototype.loadScene=function(){function e(t,i,r,n){var o=r.nodes[t];return n.getDependency("node",t).then(function(e){return void 0===o.skin?e:n.getDependency("skin",o.skin).then(function(e){for(var i=[],r=0,o=(t=e).joints.length;r<o;r++)i.push(n.getDependency("node",t.joints[r]));return Promise.all(i)}).then(function(i){for(var r=!0===e.isGroup?e.children:[e],n=0,o=r.length;n<o;n++){for(var a=r[n],s=[],l=[],c=0,u=i.length;c<u;c++){var h=i[c];if(h){s.push(h);var p=new THREE.Matrix4;void 0!==t.inverseBindMatrices&&p.fromArray(t.inverseBindMatrices.array,16*c),l.push(p)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[c])}a.bind(new THREE.Skeleton(s,l),a.matrixWorld)}return e});var t}).then(function(t){i.add(t);var a=[];if(o.children)for(var s=o.children,l=0,c=s.length;l<c;l++){var u=s[l];a.push(e(u,t,r,n))}return Promise.all(a)})}return function(t){var i=this.json,r=this.extensions,n=this.json.scenes[t],o=new THREE.Scene;void 0!==n.name&&(o.name=n.name),I(o,n),n.extensions&&B(r,o,n);for(var a=n.nodes||[],s=[],l=0,c=a.length;l<c;l++)s.push(e(a[l],o,i,this));return Promise.all(s).then(function(){return o})}}();var X=Object.prototype.toString,Y=function(e){return function(t){return X.call(t)=="[object "+e+"]"}},Q={isType:Y,isArray:Y("Array"),isObject:Y("Object"),isString:Y("String"),isNumber:Y("Number"),isFunction:Y("Function"),isRegExp:Y("RegExp"),isUndefined:Y("Undefined"),objectKeysToLowerCase:function(e,i,r){var n,o,a,s,l,c,u,h;if(c=Q.objectKeysToLowerCase,"undefined"===(u=t(i))||null===i||0===i||!1===i)i=0;else if("object"===u){if(!(i instanceof c))throw new TypeError('Expected "deep" to be a special object')}else if(!0===i)i=1/0;else{if("number"!==u)throw new TypeError('Expected "deep" to be a boolean, number or object, got "'+u+'"');if(isNaN(i)||i<0)throw new RangeError('Expected "deep" to be a positive number, got '+i)}if(null===e||"object"!==t(e))throw new TypeError('Expected "input" to be an object');if(u=t(r),null!==r&&"undefined"!==u&&"function"!==u)throw new TypeError('Expected "filter" to be a function');if(r=r||null,s=(a=Object.keys(e)).length-1,l={},i){if("number"==typeof i)i=Object.seal(Object.create(c.prototype,{input:{value:[]},output:{value:[]},level:{value:-1,writable:!0},max:{value:i,writable:!1}}));else if(~(n=i.input.indexOf(e)))return i.output[n];for(i.level+=1,i.input.push(e),i.output.push(l),n=s+1;n--;)"object"===t(h=e[o=a[s-n]])&&h&&i.level<i.max&&(r?r(h):h.constructor===Object)&&(h=c(h,i,r)),l[o.toLowerCase()]=h;i.level-=1}else for(n=s+1;n--;)l[(o=a[s-n]).toLowerCase()]=e[o];return l}};String.prototype.removeAt=function(e){var t=this.substring(0);return e>=this.length?t:t.slice(0,e)+t.slice(e+1)},String.prototype.getPath=function(){var e=this.indexOf("\\")>=0?this.lastIndexOf("\\"):this.lastIndexOf("/");return this.substring(0,e)},String.prototype.getExtension=function(){var e=this.split(".");return e.length>1?e.pop():""},String.prototype.getFileName=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.indexOf("\\")>=0?this.lastIndexOf("\\"):this.lastIndexOf("/");if(-1===t)return e?this:this.split(".")[0];var i=this.substring(t);return 0!==i.indexOf("\\")&&0!==i.indexOf("/")||(i=i.substring(1)),e?i:i.split(".")[0]},String.prototype._trimLeft=function(e){return void 0===e&&(e="s"),this.replace(new RegExp("^["+e+"]+"),"")},String.prototype._trimRight=function(e){return void 0===e&&(e="s"),this.replace(new RegExp("["+e+"]+$"),"")},String.prototype.trimBoth=function(e){return this._trimLeft(e)._trimRight(e)},String.prototype.appendPath=function(e){return this._trimRight("/")+"/"+e._trimLeft("/")._trimRight("/")},String.prototype.replaceAll=function(e,t){if(!this.length)return"";for(var i=this.substring(0);-1!==i.indexOf(e);)i=i.replace(e,t);return i};var Z=function(){function e(t){i(this,e),this._major=0,this._minor=0,this._modified=0;var r=t.split(".");this._major=parseInt(r.length>=1?r[0]:0),this._minor=parseInt(r.length>=2?r[1]:0),this._modified=parseInt(r.length>=3?r[2]:0)}return n(e,[{key:"compare",value:function(t){return Q.isString(t)&&(t=new e(t)),this._major!=t._major?this._major>t._major?1:-1:this._minor!=t._minor?this._minor>t._minor?1:-1:this._modified!=t._modified?this._modified>t._modified?1:-1:0}},{key:"major",get:function(){return this._major}},{key:"minor",get:function(){return this._minor}},{key:"modified",get:function(){return this._modified}}]),e}(),J=function(){function e(t){i(this,e);var r=t.split(" ");this.initYear(r[0]),this.initTime(r[1])}return n(e,[{key:"initYear",value:function(e){var t=e.split("-");this._year=parseInt(t[0],10),this._month=parseInt(t[1],10),this._date=parseInt(t[2],10)}},{key:"initTime",value:function(e){var t=e.split(":");this._hours=parseInt(t[0],10),this._minutes=parseInt(t[1],10),this._seconds=parseInt(t[2],10)}},{key:"getYear",value:function(){return this._year}},{key:"getMonth",value:function(){return this._month-1}},{key:"getDate",value:function(){return this._date}},{key:"getHours",value:function(){return this._hours}},{key:"getMinutes",value:function(){return this._minutes}},{key:"getSeconds",value:function(){return this._seconds}}]),e}(),K=function(){function e(){i(this,e)}return n(e,[{key:"GLTF_decoder_1_count",value:function(e,t,i,r){return 0==e?r-t:e%2?i%2?r+t:r:r-t}},{key:"GLTF_decoder_1_offset",value:function(e,t,i,r){return 0==e?r:e%2?r-(t*=i):r}},{key:"GLTF_decoder_1_length",value:function(e,t,i,r,n){return t*=i,0==e?n-t:e%2?r%2?n+t:n:n-t}},{key:"GLTF_decoder_2_offset",value:function(e,t,i,r){return e%2?r-(t*=i):r}},{key:"GLTF_decoder_2_length",value:function(e,t,i,r,n){return t*=i,e%2?r%2?n+t:n:n-t}},{key:"GLTF_decoder_3_offset",value:function(e,t,i,r){return e%2?r-(t*=i):r}},{key:"GLTF_decoder_3_length",value:function(e,t,i,r,n){return t*=i,e%2?r%2?n+t:n:n-t}}]),e}(),$=function(){function e(t,r){i(this,e),this._decoder={},this._nameDecoder={},r?(r.data=Q.objectKeysToLowerCase(t),this._init(r.data)):this._init(t)}return n(e,[{key:"_initDecoder",value:function(e){var t=e.createtime;if(t){var i=new J(t),r=i.getSeconds();this._decoder.version=Math.floor(r/10);for(var n=e.size,o=1,a=0;a<n.length;a++){var s=n[a].toString();-1!==s.indexOf(".")&&(o+=Math.floor(s.substring(s.length-1)))}this._decoder.randomWeight=o,this._decoder.randomRanges=[i.getHours()+1,i.getDate()+1,i.getSeconds()%13+1,i.getMinutes()%13+1,o%5*(o%5)+1,e.verts%13+1,e.faces%13+1,e.nodes%13+1]}}},{key:"_decode21_name",value:function(e,t){var i=["F7WD3HNR2OPYV6AUS5TKM018ZBJL4EQXIGC9F","A0JQM9PSLXF18647URV3DNHOCY52TEZBWIGKA","B0IE6Q4S3C7OA28UHTPXDW9NYMGLF1K5VJRZB","EQ72MKL3DYNF5RU1PWBT64X9CIZVJHS8G0OAE"],r=e.charAt(0),n=i[1].indexOf(r);if(-1!==n){n++,n=Math.floor(n/2)+1;var o=(e=e.removeAt(n)).getExtension();e=e.getFileName(!1);for(var a="",s=0;s<e.length;s++){var l=e[s],c=i[(s+1+t)%4],u=c.indexOf(l);0===u?u=35:u--,a+=c[u]}return o?a+"."+o:a}}},{key:"_initResourceDecoder",value:function(e,t){var i=t.texfiles;if(i){var r=new Z(e),n=null;2==r.major&&1==r.minor&&(n=this._decode21_name);var o=Object.keys(i).length,a=t.gltffiles;if(a)for(var s=0;s<a.length;s++)a[s]=n(a[s],o);var l=t.lod;if(l){var c=Object.keys(l);for(s=0;s<c.length;s++){var u=c[s];l[n(u,o)]=l[u],delete l[u]}}this._nameDecoder.version=r,this._nameDecoder.decodeFunc=n}}},{key:"_init",value:function(e){if(e){var t=e.version;if(t)new Z(t).compare("2.0")<=0||(this._initDecoder(e),this._initResourceDecoder(t,e))}}},{key:"decode",value:function(e,t,i){var r=new K;switch(this._decoder.version){case 0:case 3:var n=this._decoder.randomWeight;if("_accessors"==t)for(var o=0;o<i.length;o++){var a=i[o];(c=e.bufferViews[a.bufferView]).factor=Math.floor(c.byteLength/a.count),c.opFactor=a.byteType,a.count=r.GLTF_decoder_1_count(o,n,a.byteType,a.count),delete a.byteType}else if("_bufferViews"==t)for(o=0;o<i.length;o++){var s=(c=i[o]).factor;c.byteOffset=r.GLTF_decoder_1_offset(o,n,s,c.byteOffset),c.byteLength=r.GLTF_decoder_1_length(o,n,s,c.opFactor,c.byteLength),delete c.factor,delete c.opFactor}break;case 1:case 4:var l=this._decoder.randomRanges;if("_accessors"==t)for(o=0;o<i.length;o++){a=i[o];(c=e.bufferViews[a.bufferView]).factor=Math.floor(c.byteLength/a.count),c.opFactor=a.byteType;n=l[Math.floor(o/2)%8]+(o+1)%7;a.count=r.GLTF_decoder_1_count(o,n,a.byteType,a.count),delete a.byteType}else if("_bufferViews"==t)for(o=0;o<i.length;o++){var c=i[o],u=l[Math.floor(o/2)%8]+(o+1)%7;s=c.factor;c.byteOffset=r.GLTF_decoder_2_offset(o,u,s,c.byteOffset),c.byteLength=r.GLTF_decoder_2_length(o,u,s,c.opFactor,c.byteLength),delete c.factor,delete c.opFactor}break;case 2:case 5:this._decoder.randomRanges3=[this._decoder.randomRanges[7],7*e.materials.length%10];var h=(e.buffers[0].byteLength-999).toString();for(o=0;o<h.length;o++){var p=10-Math.floor(h[o]);this._decoder.randomRanges3.push(p)}this._decoder.randomRanges3.push(this._decoder.randomRanges[3]);l=this._decoder.randomRanges3;if("_accessors"==t)for(o=0;o<i.length;o++){a=i[o],c=e.bufferViews[a.bufferView],n=l[Math.floor(o/2)%l.length]+Math.floor(o+1)%7;c.factor=Math.floor(c.byteLength/a.count),c.opFactor=a.byteType,a.count=r.GLTF_decoder_1_count(o,n,a.byteType,a.count),delete a.byteType}else if("_bufferViews"==t)for(o=0;o<i.length;o++){c=i[o],u=l[Math.floor(o/2)%l.length]+Math.floor(o+1)%7,s=c.factor;c.byteOffset=r.GLTF_decoder_3_offset(o,u,s,c.byteOffset),c.byteLength=r.GLTF_decoder_3_length(o,u,s,c.opFactor,c.byteLength),delete c.factor,delete c.opFactor}}var d=this._nameDecoder.decodeFunc;if(d&&("_buffers"==t||"_images"==t)){var f=e.buffers.length+e.images.length;for(o=0;o<i.length;o++){var m=d(i[o].uri,f);m&&(i[o].uri=m)}}}},{key:"decodeDracoFile",value:function(e,t,i){}}]),e}();var ee={process:function(e,t){e.traverse(function(e){!function(e,t){if(e.material&&e.material.userData&&e.material.userData.gltfExtensions){var i=e.material.userData.gltfExtensions.blend;if(i){var r,n,o,a=e.material.__texture,s=e.geometry.index.count,l=[{materialIndex:0,start:0,count:s}],c=[e.material],u=!1;for(e.material.defines&&e.material.defines.USE_ALPHAINDEX&&(u=!0),r=0;r<i.length;r++)(n=t[i[r].subMaterial].clone())&&(n.transparent=!0,u&&(n.defines=n.defines||{},n.defines.USE_ALPHAINDEX=!0),i[r].maskTexture&&(1===(o=i[r].maskTexture.texCoord||0)&&(n.defines.USE_ALPHA_UV2=""),2===o&&(n.defines.USE_ALPHA_UV3=""),i[r].maskTexture.extensions&&(n.userData.gltfExtensions.alphaTexture=i[r].maskTexture.extensions),n.alphaMap=a[r],n.needsUpdate=!0),c.push(n),l.push({materialIndex:c.length-1,start:0,count:s}));e.material=c,e.geometry.groups=l}}}(e,t),function(e){e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)}(e),function(e){e.material&&(Array.isArray(e.material)?e.material.forEach(function(e){e.map&&(e.userData.gltfExtensions.useDiffuseUV2&&(e.defines=e.defines||{},e.defines.USE_DIFFUSE_UV2=""),e.map.anisotropy=16,e.map.needsUpdate=!0)}):e.material.map&&(e.material.userData.gltfExtensions.useDiffuseUV2&&(e.material.defines=e.material.defines||{},e.material.defines.USE_DIFFUSE_UV2=""),e.material.map.anisotropy=16,e.material.map.needsUpdate=!0))}(e),function(e){e.userData&&e.userData.gltfExtensions&&e.userData.gltfExtensions.effects&&(e.technique={},e.userData.gltfExtensions.effects.bloom&&(e.technique.glow=!0,e.traverse(function(e){(e.isMesh||e.isLine||e.isSprite||e.isPoints)&&(e.technique=e.technique||{},e.technique.glow=!0)})),e.userData.gltfExtensions.effects.glowInset&&(e.technique.innerGlow=!0,e.traverse(function(e){(e.isMesh||e.isLine||e.isSprite||e.isPoints)&&(e.technique=e.technique||{},e.technique.innerGlow=!0)})),delete e.userData.effects)}(e)})}},te=function(){function e(t){i(this,e),this._manager=t,this._loader=new o(t)}return n(e,[{key:"_ProcessProgressCallback",value:function(e,t,i){var r=0;t.lengthComputable&&t.total>0?t.target.readyState>1&&(r=t.loaded/t.total):r=1,i&&1==(r*=(i.cur+1)/i.total)&&i.cur++,e({progress:r})}},{key:"_loadGLTFs",value:function(e,t,i,r,n,o,a,s,l){var c=this,u=this._loader;u.loadingIndex=r,u.setDRACOLoader(e),u.setCrossOrigin("anonymous");var h=i.gltffiles[r],p=t.appendPath(h),d=i.lod;this.load(p,function(e){if(d){var t=h.getFileName(!1),i=d[t];Q.isNumber(i)||(console.error("The '"+t+"' distance is invalid, please check name is existing in index.json"),i=1e4),n.addLevel(e.scene,i)}else n.add(e.scene);o.loadedNumber++,o.loadedNumber===o.totalNumber&&s&&s({url:p.getPath(),node:n,animations:e.animations,materials:e.materials})},function(e){a&&c._ProcessProgressCallback(a,e,o)},function(e){if(l)return l(e)})}},{key:"loadGLTFs",value:function(e,t,i,r,n,o){var a;t&&null!=i&&i(t),a=t.lod?new THREE.LOD:new THREE.Group;for(var s=t.gltffiles,l={loadedNumber:0,totalNumber:s.length,cur:0,total:s.length},c={},u=new $(t,c),h=0;h<s.length;h++)this._loadGLTFs(u,e,c.data,h,a,l,n,r,o)}},{key:"loadGLTF",value:function(e,t,i,r,n,o){t=t||{};var a,s={},l=this._loader;l.setDRACOLoader(new $(t,s)),l.setCrossOrigin("anonymous"),t=s.data,null!=i&&i(t);var c=t.gltffiles;a=c&&c.length?e.appendPath(c[0]):e.appendPath("scene.gltf");var u=this;this.load(a,function(e){null!=r&&r({url:a.getPath(),node:e.scene,animations:e.animations,materials:e.materials})},function(e){n&&u._ProcessProgressCallback(n,e)},function(e){if(o)return o(e)})}},{key:"downloadGLTF",value:function(e,t,i,r){var n=this;this.load(e,function(i){null!=t&&t({url:e,node:i.scene,animations:i.animations,materials:i.materials})},function(e){i&&n._ProcessProgressCallback(i,e)},function(e){if(r)return r(e)})}},{key:"downloadGLTFPackage",value:function(e,t,i,r,n){var o=e.appendPath("index.json"),a=this;new THREE.FileLoader(this._manager).load(o,function(o){if(o)try{var s=Q.objectKeysToLowerCase(JSON.parse(o)),l=s.gltffiles;if(l&&0!==l.length){for(var c=0;c<l.length;c++)l[c]||l.splice(c--,1);1===l.length?a.loadGLTF(e,s,t,i,r,n):a.loadGLTFs(e,s,t,i,r,n)}else a.loadGLTF(e,s,t,i,r,n)}catch(e){console.error(e),n&&n(e)}},function(){},function(o){var s=!1;n&&(s=n(o)),s||a.loadGLTF(e,null,t,i,r,n)})}},{key:"downloadJSON",value:function(e,t){(new THREE.JSONLoader).load(e,function(i,r){for(var n in r)r[n].skinning=!0;null!=t&&t({url:e,geometry:i,materials:r})})}},{key:"loadFromURL",value:function(e){var t=e.url,i=e.jsonCallback,r=e.modelCallback,n=e.progressCallback,o=e.errorCallback,a=t.getExtension();"js"==a?this.downloadJSON(t,r):"gltf"==a||"glb"==a?this.downloadGLTF(t,r,n,o):this.downloadGLTFPackage(t,i,r,n,o)}},{key:"load",value:function(e,t,i,r){this._loader.load(e,function(e){ee.process(e.scene,e.materials),t&&t(e)},i,r);var n=this;return{then:function(o,a){return n._loader.load(e,function(e){ee.process(e.scene,e.materials),t&&t(e),o(e)},i,function(e){r&&r(e),a(e)}),this}}}},{key:"setCrossOrigin",value:function(e){return this._loader.setCrossOrigin(e),this}},{key:"setPath",value:function(e){return this._loader.setPath(e),this}},{key:"setResourcePath",value:function(e){return this._loader.setResourcePath(e),this}}]),e}(),ie=function(){function e(t,r){i(this,e);var n=JSON.parse(t);this._asset=n.asset,this._scene=n.scene,this._scenes=n.scenes,this._extensionsUsed=n.extensionsUsed,this._extensions=n.extensions,this._nodes=n.nodes,this._accessors=n.accessors,this._images=n.images,this._skins=n.skins,this._meshes=n.meshes,this._textures=n.textures,this._samplers=n.samplers,this._materials=n.materials,this._cameras=n.cameras,this._animations=n.animations,this._buffers=n.buffers,this._bufferViews=n.bufferViews,this._meshReferences=n.meshReferences,this._meshUses=n.meshUses,this._init(r)}return n(e,[{key:"_init",value:function(e){var t=e.dracoLoader;if(t)for(var i=Object.keys(this),r=0;r<i.length;r++){var n=i[r],o=this[n];o&&t.decode(this,n,o)}}},{key:"asset",get:function(){return this._asset}},{key:"scene",get:function(){return this._scene}},{key:"scenes",get:function(){return this._scenes}},{key:"extensionsUsed",get:function(){return this._extensionsUsed}},{key:"extensions",get:function(){return this._extensions}},{key:"nodes",get:function(){return this._nodes}},{key:"accessors",get:function(){return this._accessors}},{key:"images",get:function(){return this._images}},{key:"skins",get:function(){return this._skins}},{key:"meshes",get:function(){return this._meshes}},{key:"textures",get:function(){return this._textures}},{key:"samplers",get:function(){return this._samplers}},{key:"materials",get:function(){return this._materials}},{key:"cameras",get:function(){return this._cameras}},{key:"animations",get:function(){return this._animations}},{key:"buffers",get:function(){return this._buffers}},{key:"bufferViews",get:function(){return this._bufferViews}},{key:"meshReferences",set:function(e){this._meshReferences=e},get:function(){return this._meshReferences}},{key:"meshUses",set:function(e){this._meshUses=e},get:function(){return this._meshUses}}]),e}();JSON.parseX=function(e,t){try{return new ie(e,t)}catch(e){return console.error(e),null}},ie.prototype.toJSON=function(){},THREE&&(THREE.GLTFLoader=te),e.GLTFLoader=te,e.JSONXLoader=ie,Object.defineProperty(e,"__esModule",{value:!0})}),function(){"use strict";var e="undefined"!=typeof require,t=this.THREE||e&&require("three");if(!t)throw new Error("MeshLine requires three.js");var i=i||t;function r(){this.positions=[],this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],this.counters=[],this.geometry=new t.BufferGeometry,this.widthCallback=null}function n(e,t,i,r,n){var o;if(e=e.subarray||e.slice?e:e.buffer,i=i.subarray||i.slice?i:i.buffer,e=t?e.subarray?e.subarray(t,n&&t+n):e.slice(t,n&&t+n):e,i.set)i.set(e,r);else for(o=0;o<e.length;o++)i[o+r]=e[o];return i}function o(e){function i(e,t){return void 0===e?t:e}t.Material.call(this),e=e||{},this.lineWidth=i(e.lineWidth,1),this.map=i(e.map,null),this.useMap=i(e.useMap,0),this.alphaMap=i(e.alphaMap,null),this.useAlphaMap=i(e.useAlphaMap,0),this.color=i(e.color,new t.Color(16777215)),this.opacity=i(e.opacity,1),this.resolution=i(e.resolution,new t.Vector2(1,1)),this.sizeAttenuation=i(e.sizeAttenuation,1),this.near=i(e.near,1),this.far=i(e.far,1),this.dashArray=i(e.dashArray,[]),this.useDash=this.dashArray!==[]?1:0,this.visibility=i(e.visibility,1),this.alphaTest=i(e.alphaTest,0),this.repeat=i(e.repeat,new t.Vector2(1,1));var r=new t.RawShaderMaterial({uniforms:{lineWidth:{type:"f",value:this.lineWidth},map:{type:"t",value:this.map},useMap:{type:"f",value:this.useMap},alphaMap:{type:"t",value:this.alphaMap},useAlphaMap:{type:"f",value:this.useAlphaMap},color:{type:"c",value:this.color},opacity:{type:"f",value:this.opacity},resolution:{type:"v2",value:this.resolution},sizeAttenuation:{type:"f",value:this.sizeAttenuation},near:{type:"f",value:this.near},far:{type:"f",value:this.far},dashArray:{type:"v2",value:new t.Vector2(this.dashArray[0],this.dashArray[1])},useDash:{type:"f",value:this.useDash},visibility:{type:"f",value:this.visibility},alphaTest:{type:"f",value:this.alphaTest},repeat:{type:"v2",value:this.repeat},uvTransform:{type:"m3",value:this.map?this.map.matrix:new t.Matrix3}},vertexShader:["precision highp float;","","attribute vec3 position;","attribute vec3 previous;","attribute vec3 next;","attribute float side;","attribute float width;","attribute vec2 uv;","attribute float counters;","","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","uniform vec2 resolution;","uniform float lineWidth;","uniform vec3 color;","uniform float opacity;","uniform float near;","uniform float far;","uniform float sizeAttenuation;","uniform mat3 uvTransform;","#ifdef USE_GPUPICKER","uniform float baseId;","varying vec4 worldId;","#endif","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","vec2 fix( vec4 i, float aspect ) {","","    vec2 res = i.xy / i.w;","    res.x *= aspect;","\t vCounters = counters;","    return res;","","}","","void main() {","","    float aspect = resolution.x / resolution.y;","\t float pixelWidthRatio = 1. / (resolution.x * projectionMatrix[0][0]);","","    vColor = vec4( color, opacity );","    //vUV = uv;","    vUV = ( uvTransform * vec3( uv, 1 ) ).xy;","","    mat4 m = projectionMatrix * modelViewMatrix;","    vec4 finalPosition = m * vec4( position, 1.0 );","    vec4 prevPos = m * vec4( previous, 1.0 );","    vec4 nextPos = m * vec4( next, 1.0 );","","    vec2 currentP = fix( finalPosition, aspect );","    vec2 prevP = fix( prevPos, aspect );","    vec2 nextP = fix( nextPos, aspect );","","\t float pixelWidth = finalPosition.w * pixelWidthRatio;","    float w = 1.8 * pixelWidth * lineWidth * width;","","    if( sizeAttenuation == 1. ) {","        w = 1.8 * lineWidth * width;","    }","","    vec2 dir;","    if( nextP == currentP ) dir = normalize( currentP - prevP );","    else if( prevP == currentP ) dir = normalize( nextP - currentP );","    else {","        vec2 dir1 = normalize( currentP - prevP );","        vec2 dir2 = normalize( nextP - currentP );","        dir = normalize( dir1 + dir2 );","","        vec2 perp = vec2( -dir1.y, dir1.x );","        vec2 miter = vec2( -dir.y, dir.x );","        //w = clamp( w / dot( miter, perp ), 0., 4. * lineWidth * width );","        w = w / max(dot( miter, perp ), 0.2);","","    }","","    //vec2 normal = ( cross( vec3( dir, 0. ), vec3( 0., 0., 1. ) ) ).xy;","    vec2 normal = vec2( -dir.y, dir.x );","    normal.x /= aspect;","    normal *= .5 * w;","","    vec4 offset = vec4( normal * side, 0.0, 1.0 );","    finalPosition.xy += offset.xy;","","    gl_Position = finalPosition;","#ifdef USE_GPUPICKER","vec3 a = fract(vec3(1.0/255.0, 1.0/(255.0*255.0), 1.0/(255.0*255.0*255.0)) * baseId);","a -= a.xxy * vec3(0.0, 1.0/255.0, 1.0/255.0);","worldId = vec4(a,1);","#endif","","}"].join("\r\n"),fragmentShader:["precision mediump float;","","uniform sampler2D map;","uniform sampler2D alphaMap;","uniform float useMap;","uniform float useAlphaMap;","uniform float useDash;","uniform vec2 dashArray;","uniform float visibility;","uniform float alphaTest;","uniform vec2 repeat;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","#ifdef USE_GPUPICKER","varying vec4 worldId;","#endif","","void main() {","","    vec4 c = vColor;","    if( useMap == 1. ) c *= texture2D( map, vUV * repeat );","    if( useAlphaMap == 1. ) c.a *= texture2D( alphaMap, vUV * repeat ).a;","\t if( c.a < alphaTest ) discard;","\t if( useDash == 1. ){","\t \t ","\t }","    gl_FragColor = c;","\t gl_FragColor.a *= step(vCounters,visibility);","\t #ifdef USE_GPUPICKER","\t \tgl_FragColor = worldId;","\t #endif","}"].join("\r\n")});return delete e.lineWidth,delete e.map,delete e.useMap,delete e.alphaMap,delete e.useAlphaMap,delete e.color,delete e.opacity,delete e.resolution,delete e.sizeAttenuation,delete e.near,delete e.far,delete e.dashArray,delete e.visibility,delete e.alphaTest,delete e.repeat,r.type="MeshLineMaterial",r.setValues(e),r}r.prototype.setGeometry=function(e,i){if(this.widthCallback=i,this.positions=[],this.counters=[],e instanceof t.Geometry)for(var r=0;r<e.vertices.length;r++){var n=e.vertices[r];i=r/e.vertices.length;this.positions.push(n.x,n.y,n.z),this.positions.push(n.x,n.y,n.z),this.counters.push(i),this.counters.push(i)}if(t.BufferGeometry,e instanceof Float32Array||e instanceof Array)for(r=0;r<e.length;r+=3){i=r/e.length;this.positions.push(e[r],e[r+1],e[r+2]),this.positions.push(e[r],e[r+1],e[r+2]),this.counters.push(i),this.counters.push(i)}this.process()},r.prototype.compareV3=function(e,t){var i=6*e,r=6*t;return this.positions[i]===this.positions[r]&&this.positions[i+1]===this.positions[r+1]&&this.positions[i+2]===this.positions[r+2]},r.prototype.copyV3=function(e){var t=6*e;return[this.positions[t],this.positions[t+1],this.positions[t+2]]},r.prototype.process=function(){var e,i,r=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[];for(var n=0;n<r;n++)this.side.push(1),this.side.push(-1);for(n=0;n<r;n++)e=this.widthCallback?this.widthCallback(n/(r-1)):1,this.width.push(e),this.width.push(e);for(n=0;n<r;n++)this.uvs.push(n/(r-1),0),this.uvs.push(n/(r-1),1);i=this.compareV3(0,r-1)?this.copyV3(r-2):this.copyV3(0),this.previous.push(i[0],i[1],i[2]),this.previous.push(i[0],i[1],i[2]);for(n=0;n<r-1;n++)i=this.copyV3(n),this.previous.push(i[0],i[1],i[2]),this.previous.push(i[0],i[1],i[2]);for(n=1;n<r;n++)i=this.copyV3(n),this.next.push(i[0],i[1],i[2]),this.next.push(i[0],i[1],i[2]);i=this.compareV3(r-1,0)?this.copyV3(1):this.copyV3(r-1),this.next.push(i[0],i[1],i[2]),this.next.push(i[0],i[1],i[2]);for(n=0;n<r-1;n++){var o=2*n;this.indices_array.push(o,o+1,o+2),this.indices_array.push(o+2,o+1,o+3)}this.attributes?(this.attributes.position.copyArray(new Float32Array(this.positions)),this.attributes.position.needsUpdate=!0,this.attributes.previous.copyArray(new Float32Array(this.previous)),this.attributes.previous.needsUpdate=!0,this.attributes.next.copyArray(new Float32Array(this.next)),this.attributes.next.needsUpdate=!0,this.attributes.side.copyArray(new Float32Array(this.side)),this.attributes.side.needsUpdate=!0,this.attributes.width.copyArray(new Float32Array(this.width)),this.attributes.width.needsUpdate=!0,this.attributes.uv.copyArray(new Float32Array(this.uvs)),this.attributes.uv.needsUpdate=!0,this.attributes.index.copyArray(new Uint16Array(this.indices_array)),this.attributes.index.needsUpdate=!0):this.attributes={position:new t.BufferAttribute(new Float32Array(this.positions),3),previous:new t.BufferAttribute(new Float32Array(this.previous),3),next:new t.BufferAttribute(new Float32Array(this.next),3),side:new t.BufferAttribute(new Float32Array(this.side),1),width:new t.BufferAttribute(new Float32Array(this.width),1),uv:new t.BufferAttribute(new Float32Array(this.uvs),2),index:new t.BufferAttribute(new Uint16Array(this.indices_array),1),counters:new t.BufferAttribute(new Float32Array(this.counters),1)},this.geometry.addAttribute("position",this.attributes.position),this.geometry.addAttribute("previous",this.attributes.previous),this.geometry.addAttribute("next",this.attributes.next),this.geometry.addAttribute("side",this.attributes.side),this.geometry.addAttribute("width",this.attributes.width),this.geometry.addAttribute("uv",this.attributes.uv),this.geometry.addAttribute("counters",this.attributes.counters),this.geometry.setIndex(this.attributes.index)},r.prototype.advance=function(e){var t=this.attributes.position.array,i=this.attributes.previous.array,r=this.attributes.next.array,o=t.length;n(t,0,i,0,o),n(t,6,t,0,o-6),t[o-6]=e.x,t[o-5]=e.y,t[o-4]=e.z,t[o-3]=e.x,t[o-2]=e.y,t[o-1]=e.z,n(t,6,r,0,o-6),r[o-6]=e.x,r[o-5]=e.y,r[o-4]=e.z,r[o-3]=e.x,r[o-2]=e.y,r[o-1]=e.z,this.attributes.position.needsUpdate=!0,this.attributes.previous.needsUpdate=!0,this.attributes.next.needsUpdate=!0},o.prototype=Object.create(t.Material.prototype),o.prototype.constructor=o,o.prototype.copy=function(e){return t.Material.prototype.copy.call(this,e),this.lineWidth=e.lineWidth,this.map=e.map,this.useMap=e.useMap,this.alphaMap=e.alphaMap,this.useAlphaMap=e.useAlphaMap,this.color.copy(e.color),this.opacity=e.opacity,this.resolution.copy(e.resolution),this.sizeAttenuation=e.sizeAttenuation,this.near=e.near,this.far=e.far,this.dashArray.copy(e.dashArray),this.useDash=e.useDash,this.visibility=e.visibility,this.alphaTest=e.alphaTest,this.repeat.copy(e.repeat),this},void 0!==i?("undefined"!=typeof module&&module.exports&&(i=module.exports={MeshLine:r,MeshLineMaterial:o}),i.MeshLine=r,i.MeshLineMaterial=o):(this.MeshLine=r,this.MeshLineMaterial=o)}.call(this),function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}},i=[].slice,r={}.hasOwnProperty;e=function(e,t){return t(),e},window.ThreeBSP=function(){function r(e,i){this.matrix=i,this.intersect=t(this.intersect,this),this.union=t(this.union,this),this.subtract=t(this.subtract,this),this.toGeometry=t(this.toGeometry,this),this.toMesh=t(this.toMesh,this),this.toTree=t(this.toTree,this),null==this.matrix&&(this.matrix=new THREE.Matrix4),this.tree=this.toTree(e)}return r.prototype.toTree=function(e){var t,i,n,o,a,s,l,c=this;if(e instanceof r.Node)return e;for(n=[],o=function(e,i){var o,a,s,l,u,h,p,d,f;for(null==(o=null!=(d=t.faceVertexUvs)?d[0][i]:void 0)&&(o=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2,new THREE.Vector2]),s=new r.Polygon,l=h=0,p=(f=["a","b","c","d"]).length;h<p;l=++h)null!=(a=e[f[l]])&&(u=t.vertices[a],(u=new r.Vertex(u.x,u.y,u.z,e.vertexNormals[0],new THREE.Vector2(o[l].x,o[l].y))).applyMatrix4(c.matrix),s.vertices.push(u));return n.push(s.calculateProperties())},i=a=0,s=(l=(t=e instanceof THREE.Geometry?e:e instanceof THREE.Mesh?(e.updateMatrix(),this.matrix=e.matrix.clone(),e.geometry):void 0).faces).length;a<s;i=++a)o(l[i],i);return new r.Node(n)},r.prototype.toMesh=function(t){var i,r,n=this;return null==t&&(t=new THREE.MeshNormalMaterial),i=this.toGeometry(),e(r=new THREE.Mesh(i,t),function(){return r.position.getPositionFromMatrix(n.matrix),r.rotation.setFromRotationMatrix(n.matrix)})},r.prototype.toGeometry=function(){var t,r,n=this;return r=(new THREE.Matrix4).getInverse(this.matrix),e(t=new THREE.Geometry,function(){var e,o,a,s,l,c,u,h,p,d,f;for(f=[],h=0,p=(d=n.tree.allPolygons()).length;h<p;h++)s=d[h],a=function(){var e,t,i,n;for(n=[],e=0,t=(i=s.vertices).length;e<t;e++)l=i[e],n.push(l.clone().applyMatrix4(r));return n}(),f.push(function(){var r,n,h;for(h=[],o=r=2,n=a.length;2<=n?r<n:r>n;o=2<=n?++r:--r)u=[a[0],a[o-1],a[o]],c=function(){var e,t,i,r,n;for(n=[],e=0,t=u.length;e<t;e++)l=u[e],n.push(new THREE.Vector2(null!=(i=l.uv)?i.x:void 0,null!=(r=l.uv)?r.y:void 0));return n}(),e=function(e,t,i){i.prototype=e.prototype;var r=new i,n=e.apply(r,t);return Object(n)===n?n:r}(THREE.Face3,i.call(function(){var e,i,r;for(r=[],e=0,i=u.length;e<i;e++)l=u[e],r.push(t.vertices.push(l)-1);return r}()).concat([s.normal.clone()]),function(){}),t.faces.push(e),h.push(t.faceVertexUvs[0].push(c));return h}());return f})},r.prototype.subtract=function(e){var t,i,n;return t=(n=[this.tree.clone(),e.tree.clone()])[1],(i=n[0]).invert().clipTo(t),t.clipTo(i).invert().clipTo(i).invert(),new r(i.build(t.allPolygons()).invert(),this.matrix)},r.prototype.union=function(e){var t,i,n;return t=(n=[this.tree.clone(),e.tree.clone()])[1],(i=n[0]).clipTo(t),t.clipTo(i).invert().clipTo(i).invert(),new r(i.build(t.allPolygons()),this.matrix)},r.prototype.intersect=function(e){var t,i,n;return i=(n=[this.tree.clone(),e.tree.clone()])[0],(t=n[1]).clipTo(i.invert()).invert().clipTo(i.clipTo(t)),new r(i.build(t.allPolygons()).invert(),this.matrix)},r}(),ThreeBSP.Vertex=function(n){function o(e,i,r,n,a){this.normal=null!=n?n:new THREE.Vector3,this.uv=null!=a?a:new THREE.Vector2,this.interpolate=t(this.interpolate,this),this.lerp=t(this.lerp,this),o.__super__.constructor.call(this,e,i,r)}return function(e,t){for(var i in t)r.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(o,THREE.Vector3),o.prototype.clone=function(){return new ThreeBSP.Vertex(this.x,this.y,this.z,this.normal.clone(),this.uv.clone())},o.prototype.lerp=function(t,i){var r=this;return e(o.__super__.lerp.apply(this,arguments),function(){return r.uv.add(t.uv.clone().sub(r.uv).multiplyScalar(i)),r.normal.lerp(t,i)})},o.prototype.interpolate=function(){var e,t;return e=1<=arguments.length?i.call(arguments,0):[],(t=this.clone()).lerp.apply(t,e)},o}(),ThreeBSP.Polygon=function(){function i(e,i,r){this.vertices=null!=e?e:[],this.normal=i,this.w=r,this.subdivide=t(this.subdivide,this),this.tessellate=t(this.tessellate,this),this.classifySide=t(this.classifySide,this),this.classifyVertex=t(this.classifyVertex,this),this.invert=t(this.invert,this),this.clone=t(this.clone,this),this.calculateProperties=t(this.calculateProperties,this),this.vertices.length&&this.calculateProperties()}return i.prototype.calculateProperties=function(){var t=this;return e(this,function(){var e,i,r,n;return e=(n=t.vertices)[0],i=n[1],r=n[2],t.normal=i.clone().sub(e).cross(r.clone().sub(e)).normalize(),t.w=t.normal.clone().dot(e)})},i.prototype.clone=function(){var e;return new ThreeBSP.Polygon(function(){var t,i,r,n;for(n=[],t=0,i=(r=this.vertices).length;t<i;t++)e=r[t],n.push(e.clone());return n}.call(this),this.normal.clone(),this.w)},i.prototype.invert=function(){var t=this;return e(this,function(){return t.normal.multiplyScalar(-1),t.w*=-1,t.vertices.reverse()})},i.prototype.classifyVertex=function(e){var t;switch(t=this.normal.dot(e)-this.w,!1){case!(t<-1e-5):return 2;case!(t>1e-5):return 1;default:return 0}},i.prototype.classifySide=function(e){var t,i,r,n,o,a,s,l=this;for(i=(a=[0,0])[0],t=a[1],r=function(e){switch(l.classifyVertex(e)){case 1:return i+=1;case 2:return t+=1}},n=0,o=(s=e.vertices).length;n<o;n++)r(s[n]);return i>0&&0===t?1:0===i&&t>0?2:i===t&&0===t?0:3},i.prototype.tessellate=function(t){var i,r,n,o,a,s,l,c,u,h,p,d,f,m,g,v;if(m={f:[],b:[],count:t.vertices.length},n=m.f,i=m.b,r=m.count,3!==this.classifySide(t))return[t];for(o=d=0,f=(g=t.vertices).length;d<f;o=++d)h=g[o],p=t.vertices[(o+1)%r],l=(v=function(){var e,t,i,r;for(r=[],e=0,t=(i=[h,p]).length;e<t;e++)u=i[e],r.push(this.classifyVertex(u));return r}.call(this))[0],c=v[1],2!==l&&n.push(h),1!==l&&i.push(h),3==(l|c)&&(s=(this.w-this.normal.dot(h))/this.normal.dot(p.clone().sub(h)),u=h.interpolate(p,s),n.push(u),i.push(u));return e(a=[],function(){if(n.length>=3&&a.push(new ThreeBSP.Polygon(n)),i.length>=3)return a.push(new ThreeBSP.Polygon(i))})},i.prototype.subdivide=function(e,t,i,r,n){var o,a,s,l,c,u;for(u=[],s=0,l=(c=this.tessellate(e)).length;s<l;s++)switch(o=c[s],a=this.classifySide(o)){case 1:u.push(r.push(o));break;case 2:u.push(n.push(o));break;case 0:this.normal.dot(o.normal)>0?u.push(t.push(o)):u.push(i.push(o));break;default:throw new Error("BUG: Polygon of classification "+a+" in subdivision")}return u},i}(),ThreeBSP.Node=function(){function i(e){this.clipTo=t(this.clipTo,this),this.clipPolygons=t(this.clipPolygons,this),this.invert=t(this.invert,this),this.allPolygons=t(this.allPolygons,this),this.isConvex=t(this.isConvex,this),this.build=t(this.build,this),this.clone=t(this.clone,this),this.polygons=[],null!=e&&e.length&&this.build(e)}return i.prototype.clone=function(){var t,i=this;return e(t=new ThreeBSP.Node,function(){var e,r,n,o;return t.divider=null!=(r=i.divider)?r.clone():void 0,t.polygons=function(){var t,i,r,n;for(n=[],t=0,i=(r=this.polygons).length;t<i;t++)e=r[t],n.push(e.clone());return n}.call(i),t.front=null!=(n=i.front)?n.clone():void 0,t.back=null!=(o=i.back)?o.clone():void 0})},i.prototype.build=function(t){var i=this;return e(this,function(){var e,n,o,a,s,l,c;for(a={front:[],back:[]},null==i.divider&&(i.divider=t[0].clone()),s=0,l=t.length;s<l;s++)e=t[s],i.divider.subdivide(e,i.polygons,i.polygons,a.front,a.back);for(o in c=[],a)r.call(a,o)&&((n=a[o]).length?(null==i[o]&&(i[o]=new ThreeBSP.Node),c.push(i[o].build(n))):c.push(void 0));return c})},i.prototype.isConvex=function(e){var t,i,r,n,o,a;for(r=0,o=e.length;r<o;r++)for(t=e[r],n=0,a=e.length;n<a;n++)if(t!==(i=e[n])&&2!==i.classifySide(t))return!1;return!0},i.prototype.allPolygons=function(){var e,t;return this.polygons.slice().concat((null!=(t=this.front)?t.allPolygons():void 0)||[]).concat((null!=(e=this.back)?e.allPolygons():void 0)||[])},i.prototype.invert=function(){var t=this;return e(this,function(){var e,i,r,n,o,a,s,l;for(i=0,n=(a=t.polygons).length;i<n;i++)a[i].invert();for(r=0,o=(s=[t.divider,t.front,t.back]).length;r<o;r++)null!=(e=s[r])&&e.invert();return l=[t.back,t.front],t.front=l[0],t.back=l[1],l})},i.prototype.clipPolygons=function(e){var t,i,r,n,o;if(!this.divider)return e.slice();for(i=[],t=[],n=0,o=e.length;n<o;n++)r=e[n],this.divider.subdivide(r,i,t,i,t);return this.front&&(i=this.front.clipPolygons(i)),this.back&&(t=this.back.clipPolygons(t)),i.concat(this.back?t:[])},i.prototype.clipTo=function(t){var i=this;return e(this,function(){var e,r;return i.polygons=t.clipPolygons(i.polygons),null!=(e=i.front)&&e.clipTo(t),null!=(r=i.back)?r.clipTo(t):void 0})},i}()}.call(this),TrailRenderHelper=function(){var e="[TrailRenderHelper.js] : ";this.fTimeLong=0,this.fTimeStart=0,this.iStep=0,this.iCount=0,this.fWidthStart=.5,this.fWidthEnd=.5,this.fWidthOffset=0,this.arrayPosHistory=new Array,this.shaderColor=null,this.shaderTexture=null,this.shaderTexMode=null,this.blending=null,this.transparent=null,this.alphaTest=null,this.depthWrite=null,this.depthTest=null,this.arrayUuid=new Array,this.arrayCfg=new Array,this.bAllStable=!1,this.bStable=!1,this.iMaxArrayPosHistoryNo=0,this.iMaxArrayPosHistoryNo_last=0,this.iCurrentIndex=0,this.iSumArrayPosHistoryCount=0,this.instanceBuffer=null,this.bufferGeometry=null,this.attributesVertices=null,this.material=null,this.mesh=null,this.vertices=null,this.indices=null,this.uvs=null,this.onTriggerMeshInited=null;var t=this,i={vertex:["precision highp float;","uniform sampler2D texture;","uniform vec4 color;","varying vec2 vUv;","varying vec4 varyColor;","void main()","{","\tvaryColor = color;","   vUv = vec2( uv.x, uv.y );","\tvec3 positionEye = ( modelViewMatrix * vec4( position, 1.0 ) ).xyz;","\tgl_Position = projectionMatrix * vec4( positionEye, 1.0 );","}"].join("\n"),fragment:["precision highp float;","uniform sampler2D texture;","varying vec2 vUv;","varying vec4 varyColor;","void main() {","    gl_FragColor = varyColor * texture2D(texture, vUv);","}"].join("\n")};this.init=function(r,n){if(null!=n&&null!=n){if(null==r||null==r||"object"!=typeof r)return console.error(e+"[init] : options == null;"),void n();if(null==r.fTimeLong||null==r.fTimeLong||"number"!=typeof r.fTimeLong)return console.error(e+"[init] : options.fTimeLong == null;"),void n();if(null==r.fTimeStart||null==r.fTimeStart||"number"!=typeof r.fTimeStart)return console.error(e+"[init] : options.fTimeStart == null;"),void n();if(null==r.iStep||null==r.iStep||"number"!=typeof r.iStep)return console.error(e+"[init] : options.iStep == null;"),void n();if(null==r.fWidthStart||null==r.fWidthStart||"number"!=typeof r.fWidthStart)return console.error(e+"[init] : options.fWidthStart == null;"),void n();if(null==r.fWidthEnd||null==r.fWidthEnd||"number"!=typeof r.fWidthEnd)return console.error(e+"[init] : options.fWidthStart == null;"),void n();null!=r.shaderColor&&null!=r.shaderColor&&r.shaderColor instanceof THREE.Vector4?t.shaderColor=new THREE.Vector4(r.shaderColor.x,r.shaderColor.y,r.shaderColor.z,r.shaderColor.w):(console.warn(e+"[init] : options.shaderColor == null; set shader color as default;"),t.shaderColor=new THREE.Vector4(.5,.5,1,1)),null!=r.shaderTexture&&null!=r.shaderTexture&&r.shaderTexture instanceof THREE.Texture?t.shaderTexture=r.shaderTexture:(console.warn(e+"[init] : options.shaderColor == null; set shader texture as default;"),t.shaderTexture=null),null==r.shaderTexMode||null==r.shaderTexMode||"string"!=typeof r.shaderTexMode?(console.warn(e+"[init] : options.shaderTexMode == null; set shader mode as default;"),t.shaderTexMode="Stretch"):t.shaderTexMode="Stretch"==r.shaderTexMode?"Stretch":"Tile",null==r.shaderBlending||null==r.shaderBlending||"number"!=typeof r.shaderBlending?(console.warn(e+"[init] : options.shaderBlending == null; set shader blending as default;"),t.blending=THREE.AdditiveBlending):t.blending=r.shaderBlending,null==r.shaderTransparent||null==r.shaderTransparent||"boolean"!=typeof r.shaderTransparent?(console.warn(e+"[init] : options.shaderTransparent == null; set shader transparent as default;"),t.transparent=!1):t.transparent=r.shaderTransparent,null==r.shaderAlphaTest||null==r.shaderAlphaTest||"number"!=typeof r.shaderAlphaTest?(console.warn(e+"[init] : options.shaderAlphaTest == null; set shader alphaTest as default;"),t.alphaTest=0):t.alphaTest=r.shaderAlphaTest,null==r.shaderDepthWrite||null==r.shaderDepthWrite||"boolean"!=typeof r.shaderDepthWrite?(console.warn(e+"[init] : options.shaderDepthWrite == null; set shader depthWrite as default;"),t.depthWrite=!0):t.depthWrite=r.shaderDepthWrite,null==r.shaderDepthTest||null==r.shaderDepthTest||"boolean"!=typeof r.shaderDepthTest?(console.warn(e+"[init] : options.shaderDepthTest == null; set shader depthTest as default;"),t.depthTest=!0):t.depthTest=r.shaderDepthTest,t.uniforms={texture:{type:"t",value:t.shaderTexture},color:{type:"v4",value:new THREE.Vector4(0,0,0,0)}},t.material=new THREE.ShaderMaterial({uniforms:t.uniforms,vertexShader:i.vertex,fragmentShader:i.fragment,blending:t.blending,transparent:t.transparent,alphaTest:t.alphaTest,depthWrite:t.depthWrite,depthTest:t.depthTest}),t.fTimeLong=r.fTimeLong,t.fTimeStart=r.fTimeStart,t.iStep=r.iStep,t.iCount=0,t.fWidthStart=r.fWidthStart,t.fWidthEnd=r.fWidthEnd,t.fWidthOffset=-t.fWidthStart+t.fWidthEnd,n()}else console.error(e+"[init] : onFinished == null;")},this.attach=function(i){if(null==i||null==i)return console.error(e+"[attach] : onFinished == null;"),null;var r=THREE.Math.generateUUID();t.arrayPosHistory[r]=new Array;return t.arrayCfg[r]={bActived:!0,bStable:!1,iMaxArrayPosHistoryNo_last:0,iMaxArrayPosHistoryNo:0,iStartIndex:0},t.arrayUuid.push(r),i(r),r},this.detach=function(i){null!=i&&null!=i&&"string"==typeof i?(t.arrayUuid.includes(i)&&delete t.arrayUuid[i],t.arrayCfg.includes(i)&&(t.iCurrentIndex-=t.arrayCfg[i].iMaxArrayPosHistoryNo,delete t.arrayCfg[i]),t.arrayPosHistory.includes(i)&&delete t.arrayPosHistory[i]):console.error(e+"[detach] : uuid == null;")},this.dispose=function(){t.instanceBuffer&&t.instanceBuffer.dispose(),t.bufferGeometry&&t.bufferGeometry.dispose(),GlobalsVariables.scene.remove(t.mesh),t.material.dispose(),t.arrayUuid.forEach(function(e){}),t.arrayCfg.forEach(function(e){}),t.arrayPosHistory.forEach(function(e){}),t.arrayUuid=[],t.arrayCfg=[],t.arrayPosHistory=[]},this.setActive=function(i,r,n){if(null!=n&&null!=n){if(null==i||null==i||"string"!=typeof i)return console.error(e+"[setActive] : uuid == null;"),void n(!1);if(!t.arrayUuid.includes(i))return console.error(e+"[setActive] : uuid do not includes;"),void n(!1);if(null==r||null==r||"boolean"!=typeof r)return console.error(e+"[setActive] : bActived == null;"),void n(!1);t.arrayCfg[i].bActived=r,n(!0)}else console.error(e+"[setActive] : onFinished == null;")},this.tick=function(e){if(t.bAllStable)for(var i=t.arrayUuid.length,r=0;r<i;r++)t.arrayCfg[t.arrayUuid[r]].bActived&&t.updateMesh(t.arrayUuid[r]);if(t.arrayCfg[e.uuid].bActived&&(t.arrayPosHistory[e.uuid].push({time:e.timeNow,pos:new THREE.Vector3(e.position.x,e.position.y,e.position.z),rot:new THREE.Vector3(e.rotation.x,e.rotation.y,e.rotation.z)}),t.checkPosHistory(e.uuid,e.timeNow)),!t.bAllStable&&!t.arrayCfg[e.uuid].bStable){i=t.arrayPosHistory[e.uuid].length;t.arrayCfg[e.uuid].iMaxArrayPosHistoryNo<=i&&(t.arrayCfg[e.uuid].iMaxArrayPosHistoryNo_last=t.arrayCfg[e.uuid].iMaxArrayPosHistoryNo,t.arrayCfg[e.uuid].iMaxArrayPosHistoryNo=i,t.arrayCfg[e.uuid].bStable||t.arrayCfg[e.uuid].iMaxArrayPosHistoryNo_last!=t.arrayCfg[e.uuid].iMaxArrayPosHistoryNo||(t.arrayCfg[e.uuid].bStable=!0,t.checkAllPosHistory()))}},this.checkPosHistory=function(e,i){for(var r=t.arrayPosHistory[e].length,n=0;n<r&&i-t.arrayPosHistory[e][n].time>t.fTimeLong;n++)t.arrayPosHistory[e].splice(n,1),r=t.arrayPosHistory[e].length,n--},this.checkAllPosHistory=function(){var e=t.arrayUuid.length,i=!0;t.iSumArrayPosHistoryCount=0;for(var r=0;r<e;r++){if(!t.arrayCfg[t.arrayUuid[r]].bStable)return void(i=!1);t.iSumArrayPosHistoryCount+=t.arrayCfg[t.arrayUuid[r]].iMaxArrayPosHistoryNo}if(i){t.bAllStable=!0;for(r=0;r<e;r++)0==r?1==e?t.initMesh(t.arrayUuid[r],"start|end"):t.initMesh(t.arrayUuid[r],"start"):r+1==e?t.initMesh(t.arrayUuid[r],"end"):t.initMesh(t.arrayUuid[r],"default")}},this.initMesh=function(e,i){if(null!=t.mesh&&GlobalsVariables.scene.remove(t.mesh),null==t.bufferGeometry&&(t.bufferGeometry=new THREE.BufferGeometry),t.arrayCfg[e].iStartIndex=t.iCurrentIndex,i.indexOf("start")>=0){var r=2*t.iSumArrayPosHistoryCount;t.iSumArrayPosHistoryCount;t.vertices=new Float32Array(3*r),t.indices=new Uint32Array(2*(t.iSumArrayPosHistoryCount-t.arrayCfg.length)*2*3),t.uvs=new Float32Array(2*r)}for(var n=new THREE.Quaternion,o=t.arrayCfg[e].iStartIndex,a=t.arrayCfg[e].iStartIndex+t.arrayCfg[e].iMaxArrayPosHistoryNo;o<a;o++){var s=t.fWidthEnd+(o-t.arrayCfg[e].iStartIndex)/t.arrayCfg[e].iMaxArrayPosHistoryNo*t.fWidthOffset,l=t.arrayPosHistory[e][o-t.arrayCfg[e].iStartIndex].pos.clone(),c=l.clone(),u=t.arrayPosHistory[e][o-t.arrayCfg[e].iStartIndex].rot.clone();u=u.normalize(),n.setFromEuler(new THREE.Euler(u.x,u.y,u.z));var h=new THREE.Vector3(s,0,0);h.applyQuaternion(n);var p=a-1-o,d=l.add(h);t.vertices[6*(t.arrayCfg[e].iStartIndex+p)+0]=d.x,t.vertices[6*(t.arrayCfg[e].iStartIndex+p)+1]=d.y,t.vertices[6*(t.arrayCfg[e].iStartIndex+p)+2]=d.z;var f=c.sub(h);t.vertices[6*(t.arrayCfg[e].iStartIndex+p)+3]=f.x,t.vertices[6*(t.arrayCfg[e].iStartIndex+p)+4]=f.y,t.vertices[6*(t.arrayCfg[e].iStartIndex+p)+5]=f.z}var m=t.arrayCfg[e].iStartIndex+t.arrayCfg[e].iMaxArrayPosHistoryNo-1;for(o=t.arrayCfg[e].iStartIndex;o<m;o++)t.indices[12*o+0]=2*o+0,t.indices[12*o+1]=2*o+1,t.indices[12*o+2]=2*o+2,t.indices[12*o+3]=2*o+2,t.indices[12*o+4]=2*o+1,t.indices[12*o+5]=2*o+3,t.indices[12*o+6]=2*o+0,t.indices[12*o+7]=2*o+2,t.indices[12*o+8]=2*o+1,t.indices[12*o+9]=2*o+2,t.indices[12*o+10]=2*o+3,t.indices[12*o+11]=2*o+1;var g=1/t.arrayCfg[e].iMaxArrayPosHistoryNo;if("Stretch"==t.shaderTexMode)for(o=t.arrayCfg[e].iStartIndex,a=t.arrayCfg[e].iStartIndex+t.arrayCfg[e].iMaxArrayPosHistoryNo;o<a;o++)t.uvs[4*o+0]=(o-t.arrayCfg[e].iStartIndex)*g,t.uvs[4*o+1]=0,t.uvs[4*o+2]=(o-t.arrayCfg[e].iStartIndex)*g,t.uvs[4*o+3]=1;else for(o=t.arrayCfg[e].iStartIndex,a=t.arrayCfg[e].iStartIndex+t.arrayCfg[e].iMaxArrayPosHistoryNo;o<a;o++)t.uvs[4*o+0]=(o-t.arrayCfg[e].iStartIndex)%2,t.uvs[4*o+1]=0,t.uvs[4*o+2]=(o-t.arrayCfg[e].iStartIndex)%2,t.uvs[4*o+3]=1;t.iCurrentIndex+=t.arrayCfg[e].iMaxArrayPosHistoryNo,i.indexOf("end")>=0&&(t.bufferGeometry.addAttribute("position",new THREE.BufferAttribute(t.vertices,3)),t.attributesVertices=this.bufferGeometry.attributes.position.array,t.bufferGeometry.addAttribute("uv",new THREE.BufferAttribute(t.uvs,2)),t.bufferGeometry.setIndex(new THREE.BufferAttribute(t.indices,1)),t.mesh=new THREE.Mesh(t.bufferGeometry,t.material),GlobalsVariables.scene.add(t.mesh),null!=t.onTriggerMeshInited&&null!=t.onTriggerMeshInited&&t.onTriggerMeshInited(t.mesh))},this.updateColor=function(e){null!=t.material&&null!=t.material&&(t.material.uniforms.color.value.x=e.r,t.material.uniforms.color.value.y=e.g,t.material.uniforms.color.value.z=e.b,t.material.uniforms.color.value.w=e.a,t.material.needsUpdate=!0)},this.updateMesh=function(e){for(var i=t.arrayPosHistory[e].length,r=new THREE.Quaternion,n=t.arrayCfg[e].iStartIndex,o=t.arrayCfg[e].iStartIndex+i;n<o;n++){var a=t.fWidthEnd+(n-t.arrayCfg[e].iStartIndex)/i*t.fWidthOffset,s=(h=t.arrayPosHistory[e][n-t.arrayCfg[e].iStartIndex].pos.clone()).clone();p=(p=t.arrayPosHistory[e][n-t.arrayCfg[e].iStartIndex].rot.clone()).normalize(),r.setFromEuler(new THREE.Euler(p.x,p.y,p.z)),(d=new THREE.Vector3(a,0,0)).applyQuaternion(r);var l=o-1-n;l=6*(t.arrayCfg[e].iStartIndex+l);var c=h.add(d);t.attributesVertices[l+0]=c.x,t.attributesVertices[l+1]=c.y,t.attributesVertices[l+2]=c.z;var u=s.sub(d);t.attributesVertices[l+3]=u.x,t.attributesVertices[l+4]=u.y,t.attributesVertices[l+5]=u.z}if(i<t.arrayCfg[e].iMaxArrayPosHistoryNo)for(n=t.arrayCfg[e].iStartIndex+i,o=t.arrayCfg[e].iStartIndex+t.arrayCfg[e].iMaxArrayPosHistoryNo;n<o;n++){var h,p,d;s=(h=t.arrayPosHistory[e][i-1].pos.clone()).clone();p=(p=t.arrayPosHistory[e][i-1].rot.clone()).normalize(),r.setFromEuler(new THREE.Euler(p.x,p.y,p.z)),(d=new THREE.Vector3(0,0,0)).applyQuaternion(r);l=6*(t.arrayCfg[e].iStartIndex+n),c=h.add(d);t.attributesVertices[l+0]=c.x,t.attributesVertices[l+1]=c.y,t.attributesVertices[l+2]=c.z;u=s.sub(d);t.attributesVertices[l+3]=u.x,t.attributesVertices[l+4]=u.y,t.attributesVertices[l+5]=u.z}t.bufferGeometry.attributes.position.needsUpdate=!0}},function(){"use strict";function e(e,t){t=t||1/0;for(var i,r=e.length,n=null,o=[],a=0;a<r;a++){if(55295<(i=e.charCodeAt(a))&&57344>i){if(!n){if(56319<i){-1<(t-=3)&&o.push(239,191,189);continue}if(a+1===r){-1<(t-=3)&&o.push(239,191,189);continue}n=i;continue}if(56320>i){-1<(t-=3)&&o.push(239,191,189),n=i;continue}i=n-55296<<10|i-56320|65536,n=null}else n&&(-1<(t-=3)&&o.push(239,191,189),n=null);if(128>i){if(0>(t-=1))break;o.push(i)}else if(2048>i){if(0>(t-=2))break;o.push(192|i>>6,128|63&i)}else if(65536>i){if(0>(t-=3))break;o.push(224|i>>12,128|63&i>>6,128|63&i)}else{if(!(2097152>i))throw new Error("Invalid code point");if(0>(t-=4))break;o.push(240|i>>18,128|63&i>>12,128|63&i>>6,128|63&i)}}return o}function t(e){try{return decodeURIComponent(e)}catch(e){return String.fromCharCode(65533)}}TextEncoderLite.prototype.encode=function(t){return"undefined"==typeof Uint8Array?e(t):new Uint8Array(e(t))},TextDecoderLite.prototype.decode=function(e){return function(e,i,r){var n="",o="";r=Math.min(e.length,r||1/0);for(var a=i=i||0;a<r;a++)127>=e[a]?(n+=t(o)+String.fromCharCode(e[a]),o=""):o+="%"+e[a].toString(16);return n+t(o)}(e,0,e.length)}}();var _Group=function(){this._tweens={},this._tweensAddedDuringUpdate={}};_Group.prototype={getAll:function(){return Object.keys(this._tweens).map(function(e){return this._tweens[e]}.bind(this))},removeAll:function(){this._tweens={}},add:function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},remove:function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},update:function(e,t){var i=Object.keys(this._tweens);if(0===i.length)return!1;for(e=void 0!==e?e:TWEEN.now();i.length>0;){this._tweensAddedDuringUpdate={};for(var r=0;r<i.length;r++){var n=this._tweens[i[r]];n&&!1===n.update(e)&&(n._isPlaying=!1,t||delete this._tweens[i[r]])}i=Object.keys(this._tweensAddedDuringUpdate)}return!0}};var TWEEN=new _Group;TWEEN.Group=_Group,TWEEN._nextId=0,TWEEN.nextId=function(){return TWEEN._nextId++},"undefined"==typeof window&&"undefined"!=typeof process?TWEEN.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?TWEEN.now=window.performance.now.bind(window.performance):void 0!==Date.now?TWEEN.now=Date.now:TWEEN.now=function(){return(new Date).getTime()},TWEEN.Tween=function(e,t){this._object=e,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._repeatDelayTime=void 0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=TWEEN.Easing.Linear.None,this._interpolationFunction=TWEEN.Interpolation.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onCompleteCallback=null,this._onStopCallback=null,this._group=t||TWEEN,this._id=TWEEN.nextId()},TWEEN.Tween.prototype={getId:function(){return this._id},isPlaying:function(){return this._isPlaying},to:function(e,t){return this._valuesEnd=e,void 0!==t&&(this._duration=t),this},start:function(e){for(var t in this._group.add(this),this._isPlaying=!0,this._onStartCallbackFired=!1,this._startTime=void 0!==e?"string"==typeof e?TWEEN.now()+parseFloat(e):e:TWEEN.now(),this._startTime+=this._delayTime,this._valuesEnd){if(this._valuesEnd[t]instanceof Array){if(0===this._valuesEnd[t].length)continue;this._valuesEnd[t]=[this._object[t]].concat(this._valuesEnd[t])}void 0!==this._object[t]&&(this._valuesStart[t]=this._object[t],this._valuesStart[t]instanceof Array==0&&(this._valuesStart[t]*=1),this._valuesStartRepeat[t]=this._valuesStart[t]||0)}return this},stop:function(){return this._isPlaying?(this._group.remove(this),this._isPlaying=!1,null!==this._onStopCallback&&this._onStopCallback(this._object),this.stopChainedTweens(),this):this},end:function(){return this.update(this._startTime+this._duration),this},stopChainedTweens:function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop()},group:function(e){return this._group=e,this},delay:function(e){return this._delayTime=e,this},repeat:function(e){return this._repeat=e,this},repeatDelay:function(e){return this._repeatDelayTime=e,this},yoyo:function(e){return this._yoyo=e,this},easing:function(e){return this._easingFunction=e,this},interpolation:function(e){return this._interpolationFunction=e,this},chain:function(){return this._chainedTweens=arguments,this},onStart:function(e){return this._onStartCallback=e,this},onUpdate:function(e){return this._onUpdateCallback=e,this},onComplete:function(e){return this._onCompleteCallback=e,this},onStop:function(e){return this._onStopCallback=e,this},update:function(e){var t,i,r;if(e<this._startTime)return!0;for(t in!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),i=(e-this._startTime)/this._duration,i=0===this._duration||i>1?1:i,r=this._easingFunction(i),this._valuesEnd)if(void 0!==this._valuesStart[t]){var n=this._valuesStart[t]||0,o=this._valuesEnd[t];o instanceof Array?this._object[t]=this._interpolationFunction(o,r):("string"==typeof o&&(o="+"===o.charAt(0)||"-"===o.charAt(0)?n+parseFloat(o):parseFloat(o)),"number"==typeof o&&(this._object[t]=n+(o-n)*r))}if(null!==this._onUpdateCallback&&this._onUpdateCallback(this._object),1===i){if(this._repeat>0){for(t in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat){if("string"==typeof this._valuesEnd[t]&&(this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(this._valuesEnd[t])),this._yoyo){var a=this._valuesStartRepeat[t];this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=a}this._valuesStart[t]=this._valuesStartRepeat[t]}return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=e+this._repeatDelayTime:this._startTime=e+this._delayTime,!0}null!==this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var s=0,l=this._chainedTweens.length;s<l;s++)this._chainedTweens[s].start(this._startTime+this._duration);return!1}return!0}},TWEEN.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1}},Back:{In:function(e){return e*e*(2.70158*e-1.70158)},Out:function(e){return--e*e*(2.70158*e+1.70158)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-TWEEN.Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*TWEEN.Easing.Bounce.In(2*e):.5*TWEEN.Easing.Bounce.Out(2*e-1)+.5}}},TWEEN.Interpolation={Linear:function(e,t){var i=e.length-1,r=i*t,n=Math.floor(r),o=TWEEN.Interpolation.Utils.Linear;return t<0?o(e[0],e[1],r):t>1?o(e[i],e[i-1],i-r):o(e[n],e[n+1>i?i:n+1],r-n)},Bezier:function(e,t){for(var i=0,r=e.length-1,n=Math.pow,o=TWEEN.Interpolation.Utils.Bernstein,a=0;a<=r;a++)i+=n(1-t,r-a)*n(t,a)*e[a]*o(r,a);return i},CatmullRom:function(e,t){var i=e.length-1,r=i*t,n=Math.floor(r),o=TWEEN.Interpolation.Utils.CatmullRom;return e[0]===e[i]?(t<0&&(n=Math.floor(r=i*(1+t))),o(e[(n-1+i)%i],e[n],e[(n+1)%i],e[(n+2)%i],r-n)):t<0?e[0]-(o(e[0],e[0],e[1],e[1],-r)-e[0]):t>1?e[i]-(o(e[i],e[i],e[i-1],e[i-1],r-i)-e[i]):o(e[n?n-1:0],e[n],e[i<n+1?i:n+1],e[i<n+2?i:n+2],r-n)},Utils:{Linear:function(e,t,i){return(t-e)*i+e},Bernstein:function(e,t){var i=TWEEN.Interpolation.Utils.Factorial;return i(e)/i(t)/i(e-t)},Factorial:function(){var e=[1];return function(t){var i=1;if(e[t])return e[t];for(var r=t;r>1;r--)i*=r;return e[t]=i,i}}(),CatmullRom:function(e,t,i,r,n){var o=.5*(i-e),a=.5*(r-t),s=n*n;return(2*t-2*i+o+a)*(n*s)+(-3*t+3*i-2*o-a)*s+o*n+t}}},function(e){"function"==typeof define&&define.amd?define([],function(){return TWEEN}):"undefined"!=typeof module&&"object"==typeof exports?module.exports=TWEEN:void 0!==e&&(e.TWEEN=TWEEN)}(this),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("babel-polyfill")):"function"==typeof define&&define.amd?define(["exports","babel-polyfill"],t):t((e=e||self).json2mesh={})}(this,function(e){"use strict";var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0},o=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},s="function"==typeof Symbol&&"symbol"===t(Symbol.iterator)?function(e){return void 0===e?"undefined":t(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":t(e)},l=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},c=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),u=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0},h=function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+(void 0===i?"undefined":t(i)));e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(e,i):e.__proto__=i)},p=function(e,i){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||"object"!==(void 0===i?"undefined":t(i))&&"function"!=typeof i?e:i},d=function e(){l(this,e),this.positionArray=null,this.normalArray=null,this.uvArray=null,this.colorArray=null,this.uv2Array=null,this.indexArray=null,this.material=null,this.resource=null},f=function e(){l(this,e)};f.wallTexture=null,f.wallEdgeTexture=null,f.floorTexture=null,f.ceilingTexture=null,f.roofTexture=null,f.wallLigthMapTexture=null,f.floorLightMapTexture=null,f.wallMaterial=null,f.wallEdgeMaterial=null,f.floorMaterial=null,f.ceilingMaterial=null,f.roofMaterial=null;var m=function(){function e(){l(this,e)}return c(e,null,[{key:"uuid",value:function(){for(var e=[],t=0;t<36;t++)e[t]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);e[14]="4",e[19]="0123456789abcdef".substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-";var i=e.join("");return i}},{key:"approximatelyNumberEqual",value:function(e,t,i){var r=1e-5;return void 0!==i&&(r=i),Math.abs(e-t)<r}},{key:"equalVectorZero",value:function(e){return 0===e.x&&0===e.y&&0===e.z}},{key:"clone",value:function(e){var t=e.clone(),i={};e.traverse(function(e){e.isSkinnedMesh&&(i[e.name]=e)});var r={},n={};t.traverse(function(e){e.isBone&&(r[e.name]=e),e.isSkinnedMesh&&(n[e.name]=e)});var o=!1;for(var a in i){o=!0;for(var s=i[a].skeleton,l=n[a],c=[],u=0;u<s.bones.length;++u){var h=r[s.bones[u].name];c.push(h)}l.bind(new THREE.Skeleton(c,s.boneInverses),l.matrixWorld)}return t.hasSkin=!!o,t}},{key:"cloneJSObject",value:function(t){if(null===t||"object"!==(void 0===t?"undefined":s(t)))return t;if(t instanceof Date)return(i=new Date).setTime(t.getTime()),i;if(t instanceof Array|t instanceof Object){var i=t instanceof Array?[]:{};for(var r in t)t.hasOwnProperty(r)&&(i[r]=e.cloneJSObject(t[r]));return i}throw new Error("Unable to clone obj! Its type isn't supported.")}}]),e}(),g=function(){function e(){l(this,e),this.id=m.uuid(),this.name=null,this.userID=null,this.resource=null,this.position=new THREE.Vector3(0,0,0),this.rotation=new THREE.Quaternion(0,0,0,1),this.scale=new THREE.Vector3(1,1,1),this._parent=null,this.properties=null,this.isShow=!0,this._mesh=null,this._isBuilded=!1,this.buildCompleteCallbacks=[],this.buildCompleteCallbackParams=[],this._boundingBox=null,this.isContainer=!1,this._childrenResources=null,this._children=null,this._isMultiResources=!1,this._resources=null,this.initCompleteCallback=null,this._delayObject=null}return c(e,[{key:"isRepeat",value:function(){}},{key:"findObjectByID",value:function(e){if(this.id===e)return this;if(this.children)for(var t=0;t<this.children.length;t++){var i=this.children[t];if(i.id===e)return i;var r=i.findObjectByID(e);if(r)return r}return null}},{key:"addToParentCollector",value:function(){}},{key:"build",value:function(){if(!this.isBuilded){if(!this.checkResourceReady())return void this.initResource(this.resource);this.createMesh(),this.processWhenBuildFinish()}}},{key:"createMesh",value:function(){}},{key:"processWhenBuildFinish",value:function(){null!==this._delayObject&&null!==this._mesh&&this._delayObject.add(this._mesh),this._isBuilded=!0,this.notifyBuildCompleteListeners(),this.initCompleteCallback&&this.initCompleteCallback(this)}},{key:"notifyBuildCompleteListeners",value:function(){for(var e=0;e<this.buildCompleteCallbacks.length;e++){(0,this.buildCompleteCallbacks[e])(this,this.buildCompleteCallbackParams[e])}}},{key:"checkResourceReady",value:function(){if(this.isMultiResources){for(var e=0;e<this.resources.length;e++){if(!this.resources[e].ready)return!1}return!0}return!!this.resource.ready}},{key:"checkChildrenResourcesReady",value:function(){for(var e=0;e<this.childrenResources.length;e++){if(!this.childrenResources[e].ready)return!1}return!0}},{key:"resourceCallback",value:function(e){this.build()}},{key:"initResource",value:function(e){e.ready||(e.isStartDownload||e.requestToDownload(),e.registerListener(this))}},{key:"registerBuildCallbackListener",value:function(e,t){this.buildCompleteCallbacks.push(e),this.buildCompleteCallbackParams.push(t)}},{key:"_dispose",value:function(e){if(e instanceof THREE.Mesh){var t=e;if(t){var i=t.material,r=t.geometry;if(i){if(i.map){var n=i.map;n&&n.dispose()}i.dispose()}r&&r.dispose()}}for(var o=e.children,a=0;a<o.length;a++){var s=o[a];this._dispose(s)}}},{key:"clear",value:function(){if(this.isContainer)for(var e=0;e<this.children.length;e++){this.children[e].clear()}else{var t=this.mesh;if(t){this._dispose(t);for(var i=t.children.length-1;i>=0;i--){var r=t.children[i];t.remove(r)}}}this._isBuilded=!1}},{key:"delayObject",get:function(){return null===this._delayObject&&(this._delayObject=new THREE.Object3D),this.isBuilded&&null!==this._mesh&&this._delayObject.add(this._mesh),this._delayObject}},{key:"mesh",get:function(){return null===this._mesh&&(this._mesh=new THREE.Object3D),this._mesh},set:function(e){this._mesh=e}},{key:"isBuilded",get:function(){if(this.isContainer){for(var e=0;e<this.children.length;e++){if(!this.children[e].isBuilded)return!1}return!0}return this._isBuilded}},{key:"isMultiResources",get:function(){return this._isMultiResources}},{key:"children",get:function(){return this._children}},{key:"resources",get:function(){return this._resources}},{key:"childrenResources",get:function(){if(null===this._childrenResources){for(var e=[],t=0;t<this.children.length;t++){var i=this.children[t];if(i.isContainer)e=e.concat(i.childrenResources);else if(i.isMultiResources)e=e.concat(i.resources);else{for(var r=!1,n=0;n<e.length;n++){if(e[n]===i.resource){r=!0;break}}r||e.push(i.resource)}}this._childrenResources=e}return this._childrenResources}},{key:"size",get:function(){var e=new THREE.Vector3;return this.resource&&this.resource.modelSize&&e.multiplyVectors(this.resource.modelSize,this.scale),e}},{key:"boundingBox",get:function(){if(null===this._boundingBox){this._boundingBox=new THREE.Box3;var e=this.position.clone();e.y=this.size.y/2,this._boundingBox.setFromCenterAndSize(e,this.size)}return this._boundingBox}},{key:"parent",get:function(){return this._parent},set:function(e){this._parent=e,this.addToParentCollector()}},{key:"worldPosition",get:function(){if(this.parent){var e=new THREE.Vector3;return e.addVectors(this.parent.worldPosition,this.position),e}return this.position}}]),e}(),v=function(e){function t(){l(this,t);var e=p(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.startCorner=null,e.endCorner=null,e.thick=-1,e.height=-1,e._length=null,e.pathPoints=[],e._direction=null,e.doorOrWindows=[],e.subWalls=[],e.subCorners=[],e.suspend=0,e.mesh=null,e.isShow=!0,e.isContainer=!1,e}return h(t,g),c(t,[{key:"baseBuild",value:function(){this.pathPoints.push(this.startCorner.position),this.pathPoints.push(this.endCorner.position),this.position.addVectors(this.endCorner.position,this.startCorner.position),this.position.divideScalar(2)}},{key:"build",value:function(){}},{key:"getWallOtherCorner",value:function(e){return this.startCorner===e?this.endCorner:this.endCorner===e?this.startCorner:null}},{key:"sortDoorOrWins",value:function(){var e=this.startCorner.position,t=this.endCorner.position,i=t.x-e.x>0?1:-1,r=t.z-e.z>0?1:-1,n=!0;Math.abs(t.x-e.x)<.001&&(n=!1);for(var o=[],a=0;a<this.doorOrWindows.length;a++){for(var s=this.doorOrWindows[a],l=0;l<o.length;l++){var c=o[l];if((n?(c.position.x-s.position.x)*i:(c.position.z-s.position.z)*r)>=0){o.splice(l,0,s);break}if(l==o.length-1){o.push(s);break}}0===o.length&&o.push(s)}return o}},{key:"getWallCornerByPos",value:function(e){for(var t=null,i=-1,r=this.subCorners,n=0;n<r.length;n++){var o=e.distanceTo(r[n].position);o<.01&&(null===t?(t=r[n],i=o):o<i&&(i=o,t=r[n]))}return t}},{key:"getDoorOrWinStartAndEndPos",value:function(e){var t=e.size,i=this.direction,r=e.position.clone();r.y=0;var n=r.clone(),o=r.clone(),a=t.x/2;return n.subVectors(n,i.clone().multiplyScalar(a)),o.addVectors(o,i.clone().multiplyScalar(a)),[n,o]}},{key:"addSubWallCorner",value:function(e){for(var t=0;t<this.subCorners.length;t++){if(this.subCorners[t]===e)return}this.subCorners.push(e)}},{key:"addToParentCollector",value:function(){u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addToParentCollector",this).call(this),this.parent.walls.push(this)}},{key:"clear",value:function(){for(var e=0;e<this.subWalls.length;e++){this.subWalls[e].clear()}this.subWalls=[],u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}},{key:"length",get:function(){if(null===this._length){var e=new THREE.Vector3;e.subVectors(this.endCorner.position,this.startCorner.position),this._length=e.length()}return this._length}},{key:"direction",get:function(){return null===this._direction&&(this._direction=new THREE.Vector3,this._direction.subVectors(this.endCorner.position,this.startCorner.position),this._direction.normalize()),this._direction}},{key:"size",get:function(){return this.boundingBox.getSize(this._size)}},{key:"boundingBox",get:function(){if(null===this._boundingBox){this._boundingBox=new THREE.Box3,this._boundingBox.expandByPoint(this.startCorner.position),this._boundingBox.expandByPoint(this.endCorner.position);var e=this.startCorner.position.clone();e.y=this.parent.height,this._boundingBox.expandByPoint(e),(e=this.endCorner.position.clone()).y=this.parent.height,this._boundingBox.expandByPoint(e)}return this._boundingBox}},{key:"worldPosition",get:function(){var e=this.startCorner.worldPosition,t=this.endCorner.worldPosition,i=new THREE.Vector3;return i.addVectors(e,t),i.divideScalar(2),i}}]),t}(),y=function e(){l(this,e)};y.StraightManualWallHeight=3,y.StraightManualWallThick=.15,y.enableDelayLoadMode=!0,y.enableManaulWallLightMap=!0,y.enableFloorLightMap=!0,y.wallLightMapIntensity=3.8,y.enableUseHighestVersionResource=!0,y.enableCombine=!0,y.ableToSupportFootAndHeadModelWalls=["C9FB3F9A29C842F79F02CECC4037FEA1"];var b=function(e){function t(){l(this,t);var e=p(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.startCorner=null,e.endCorner=null,e.thick=y.StraightManualWallThick,e.height=y.StraightManualWallHeight,e.cornersVertices=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],e.pathPoints=[],e.selfPathPoints=[],e.upDirection=new THREE.Vector3(0,1,0),e.downDirection=new THREE.Vector3(0,-1,0),e.basePoints=null,e.repeatUV=[],e.uvMultiple=[1,1],e.rightSideLength=null,e.leftSideLength=null,e.floorPlanHeight=3,e.rightSideMeshInfo=new d,e.leftSideMeshInfo=new d,e.edgeSideMeshInfo=new d,e.defaultWallTexture=null,e.rightWallTexture=null,e.leftWallTexture=null,e.startUVPercent=[0,0,0,0],e.endUVPercent=[1,1,1,1],e.wallGroup=null,e.leftResource=null,e.rightResource=null,e.edgeResource=null,e.lightMapResource=f.wallLightMapResource,e.vectorUp=new THREE.Vector3(0,1,0),e.enableLightMap=y.enableManaulWallLightMap,e.aoMapIntensity=y.wallLightMapIntensity,e._resources=null,e._isMultiResources=!0,e}return h(t,v),c(t,[{key:"leftResourceCallback",value:function(e){}},{key:"rightResourceCallback",value:function(e){this.rigthWallTexture=e,this.isBuilded&&(this.wallGroup[0].material.texture=this.rigthWallTexture)}},{key:"resourceCallback",value:function(e){this.checkResourceReady()&&this.build()}},{key:"initMaterial",value:function(){this.leftResource?this.leftResource.ready?this.leftWallTexture=this.leftResource.texture:this.leftResource.callbackObjects.push(this):this.leftWallTexture||(this.leftWallTexture=f.wallTexture),this.rightResource?this.rightResource.ready?this.rightWallTexture=this.rightResource.texture:this.rightResource.callbackObjects.push(this):this.rightWallTexture||(this.rightWallTexture=f.wallTexture),this.leftResource?(this.leftSideMeshInfo.resource=this.leftResource,this.leftSideMeshInfo.material=this.leftResource.material):this.leftSideMeshInfo.material=new THREE.MeshStandardMaterial({map:null}),this.rightResource?(this.rightSideMeshInfo.resource=this.rightResource,this.rightSideMeshInfo.material=this.rightResource.material):this.rightSideMeshInfo.material=new THREE.MeshStandardMaterial({map:null}),this.edgeResource?(this.edgeSideMeshInfo.resource=this.edgeResource,this.edgeSideMeshInfo.material=this.edgeResource.material):this.edgeSideMeshInfo.material=new THREE.MeshStandardMaterial({map:null}),this.initLightMap()}},{key:"initLightMap",value:function(){this.lightMapResource&&this.enableLightMap&&(this.rightResource.ready&&this.rightResource.isDefault&&(void 0===this.rightResource.wallLightMaterial&&(this.rightResource.wallLightMaterial=this.rightResource.wallMaterial.clone()),this.rightSideMeshInfo.material=this.rightResource.wallLightMaterial,this.rightSideMeshInfo.material.aoMap=this.lightMapResource.texture),this.leftResource.ready&&this.leftResource.isDefault&&(void 0===this.leftResource.wallLightMaterial&&(this.leftResource.wallLightMaterial=this.leftResource.wallMaterial.clone()),this.leftSideMeshInfo.material=this.leftResource.wallLightMaterial,this.leftSideMeshInfo.material.aoMap=this.lightMapResource.texture))}},{key:"initMeshInfo",value:function(){this.baseBuild(),this.calPosInfo(),this.calEachSideLen(),this.calRepeatUV(),this.calBasePoints(),this.fillMesh()}},{key:"checkResourceReady",value:function(){for(var e=0;e<this.resources.length;e++){if(!this.resources[e].ready)return!1}return!0}},{key:"initResource",value:function(){this.downloadResource(this.lightMapResource),this.downloadResource(this.leftResource),this.downloadResource(this.rightResource),this.downloadResource(this.edgeResource)}},{key:"downloadResource",value:function(e){e.ready||(e.isStartDownload||e.requestToDownload(),e.registerListener(this))}},{key:"baseBuild",value:function(){this.pathPoints.push(this.startCorner.position),this.pathPoints.push(this.endCorner.position)}},{key:"calEachSideLen",value:function(){var e=new THREE.Vector3;e.subVectors(this.endCorner.position,this.startCorner.position),e.normalize();var t=this.thick/2,i=new THREE.Vector3;i.crossVectors(this.downDirection,e),i.normalize();var r=i.clone();r.negate();var n=i.clone();n.multiplyScalar(t);var o=r.clone();o.multiplyScalar(t);var a=new THREE.Vector3,s=new THREE.Vector3,l=new THREE.Vector3,c=new THREE.Vector3;m.equalVectorZero(this.cornersVertices[0])?a.addVectors(this.selfPathPoints[0],n):a.copy(this.cornersVertices[0]),m.equalVectorZero(this.cornersVertices[3])?s.addVectors(this.selfPathPoints[1],n):s.copy(this.cornersVertices[3]),m.equalVectorZero(this.cornersVertices[1])?l.addVectors(this.selfPathPoints[0],o):l.copy(this.cornersVertices[1]),m.equalVectorZero(this.cornersVertices[2])?c.addVectors(this.selfPathPoints[1],o):c.copy(this.cornersVertices[2]),this.rightSideLength=new THREE.Vector3,this.leftSideLength=new THREE.Vector3,this.rightSideLength.subVectors(a,s),this.leftSideLength.subVectors(l,c),this.rightSideLength=this.rightSideLength.length(),this.leftSideLength=this.leftSideLength.length()}},{key:"calRepeatUV",value:function(){this.repeatUV[0]=this.uvMultiple[0]*this.rightSideLength/this.floorPlanHeight,this.repeatUV[1]=this.uvMultiple[1]*this.height/this.floorPlanHeight,this.repeatUV[2]=this.uvMultiple[0]*this.leftSideLength/this.floorPlanHeight,this.repeatUV[3]=this.uvMultiple[1]*this.height/this.floorPlanHeight}},{key:"calPosInfo",value:function(){var e=new THREE.Vector3;this.selfPathPoints.push(e.subVectors(this.startCorner.position,this.position)),e=new THREE.Vector3,this.selfPathPoints.push(e.subVectors(this.endCorner.position,this.position)),this.selfPathPoints[0].y=0,this.selfPathPoints[1].y=0}},{key:"calBasePoints",value:function(){if(null===this.basePoints){this.basePoints=[];for(var e=0;e<12;e++)this.basePoints.push(new THREE.Vector3)}var t=this.thick/2,i=new THREE.Vector3;i.crossVectors(this.downDirection,this.direction),i.normalize();var r=i.clone();r.negate();var n=i.multiplyScalar(t);m.equalVectorZero(this.cornersVertices[0])?(this.basePoints[4].x=this.selfPathPoints[0].x+n.x,this.basePoints[4].y=0,this.basePoints[4].z=this.selfPathPoints[0].z+n.z):(this.basePoints[4].x=this.cornersVertices[0].x,this.basePoints[4].y=0,this.basePoints[4].z=this.cornersVertices[0].z),m.equalVectorZero(this.cornersVertices[1])?(n=r.multiplyScalar(t),this.basePoints[5].x=this.selfPathPoints[0].x+n.x,this.basePoints[5].y=0,this.basePoints[5].z=this.selfPathPoints[0].z+n.z):(this.basePoints[5].x=this.cornersVertices[1].x,this.basePoints[5].y=0,this.basePoints[5].z=this.cornersVertices[1].z);var o=this.direction.clone();i.crossVectors(this.downDirection,o.negate()),i.normalize(),(r=i.clone()).negate(),m.equalVectorZero(this.cornersVertices[2])?((n=i.clone()).multiplyScalar(t),this.basePoints[6].x=this.selfPathPoints[1].x+n.x,this.basePoints[6].y=0,this.basePoints[6].z=this.selfPathPoints[1].z+n.z):(this.basePoints[6].x=this.cornersVertices[2].x,this.basePoints[6].y=0,this.basePoints[6].z=this.cornersVertices[2].z),m.equalVectorZero(this.cornersVertices[3])?((n=r.clone()).multiplyScalar(t),this.basePoints[7].x=this.selfPathPoints[1].x+n.x,this.basePoints[7].y=0,this.basePoints[7].z=this.selfPathPoints[1].z+n.z):(this.basePoints[7].x=this.cornersVertices[3].x,this.basePoints[7].y=0,this.basePoints[7].z=this.cornersVertices[3].z),this.basePoints[0].x=this.basePoints[4].x,this.basePoints[0].y=this.basePoints[4].y+this.height,this.basePoints[0].z=this.basePoints[4].z,this.basePoints[1].x=this.basePoints[5].x,this.basePoints[1].y=this.basePoints[5].y+this.height,this.basePoints[1].z=this.basePoints[5].z,this.basePoints[2].x=this.basePoints[6].x,this.basePoints[2].y=this.basePoints[6].y+this.height,this.basePoints[2].z=this.basePoints[6].z,this.basePoints[3].x=this.basePoints[7].x,this.basePoints[3].y=this.basePoints[7].y+this.height,this.basePoints[3].z=this.basePoints[7].z,this.basePoints[8].x=this.selfPathPoints[0].x,this.basePoints[8].y=this.selfPathPoints[0].y+this.height,this.basePoints[8].z=this.selfPathPoints[0].z,this.basePoints[9].x=this.selfPathPoints[1].x,this.basePoints[9].y=this.selfPathPoints[1].y+this.height,this.basePoints[9].z=this.selfPathPoints[1].z}},{key:"fillMesh",value:function(){this.fillEdgeSideMeshInfo(),this.fillLeftMeshInfo(),this.fillRightMeshInfo()}},{key:"fillRightMeshInfo",value:function(){this.rightSideMeshInfo.positionArray=new Float32Array(12),this.rightSideMeshInfo.normalArray=new Float32Array(12),this.rightSideMeshInfo.indexArray=[],this.rightSideMeshInfo.uvArray=new Float32Array(8),this.rightSideMeshInfo.parentPosition=this.position;var e=this.basePoints,t=[e[0],e[4],e[7],e[3]];this.rightSideMeshInfo.indexArray=[0,2,3,0,1,2];var i,r,n,o,a=new THREE.Vector3;a.crossVectors(this.downDirection,this.direction),a.normalize(),this.rightResource.isDefault?(i=this.startUVPercent[0],r=this.startUVPercent[1],n=this.endUVPercent[0],o=this.endUVPercent[1]):(i=this.startUVPercent[0]*this.repeatUV[0],r=this.startUVPercent[1]*this.repeatUV[1],n=this.endUVPercent[0]*this.repeatUV[0],o=this.endUVPercent[1]*this.repeatUV[1]);for(var s=[i,o,i,r,n,r,n,o],l=0;l<s.length;l++){var c=s[l];this.rightSideMeshInfo.uvArray[l]=c}if(this.lightMapResource){i=this.startUVPercent[0],r=this.startUVPercent[1],n=this.endUVPercent[0],o=this.endUVPercent[1],this.rightSideMeshInfo.uv2Array=new Float32Array(8);for(var u=[i,o,i,r,n,r,n,o],h=0;h<u.length;h++){var p=u[h];this.rightSideMeshInfo.uv2Array[h]=p}}for(var d=0;d<t.length;d++){var f=t[d],m=3*d;this.rightSideMeshInfo.positionArray[m]=f.x,this.rightSideMeshInfo.positionArray[m+1]=f.y+this.suspend,this.rightSideMeshInfo.positionArray[m+2]=f.z}for(var g=0;g<t.length;g++){var v=a,y=3*g;this.rightSideMeshInfo.normalArray[y]=v.x,this.rightSideMeshInfo.normalArray[y+1]=v.y,this.rightSideMeshInfo.normalArray[y+2]=v.z}}},{key:"fillLeftMeshInfo",value:function(){this.leftSideMeshInfo.positionArray=new Float32Array(12),this.leftSideMeshInfo.normalArray=new Float32Array(12),this.leftSideMeshInfo.uvArray=new Float32Array(8),this.leftSideMeshInfo.indexArray=[3,1,0,3,2,1],this.leftSideMeshInfo.parentPosition=this.position;var e,t,i,r,n=this.basePoints,o=[n[1],n[5],n[6],n[2]],a=new THREE.Vector3;a.crossVectors(this.direction,this.downDirection),a.normalize(),this.leftResource.isDefault?(e=this.startUVPercent[2],t=this.startUVPercent[3],i=this.endUVPercent[2],r=this.endUVPercent[3]):(e=this.startUVPercent[2]*this.repeatUV[2],t=this.startUVPercent[3]*this.repeatUV[3],i=this.endUVPercent[2]*this.repeatUV[2],r=this.endUVPercent[3]*this.repeatUV[3]);for(var s=[e,r,e,t,i,t,i,r],l=0;l<s.length;l++){var c=s[l];this.leftSideMeshInfo.uvArray[l]=c}if(this.lightMapResource){e=this.startUVPercent[0],t=this.startUVPercent[1],i=this.endUVPercent[0],r=this.endUVPercent[1],this.leftSideMeshInfo.uv2Array=new Float32Array(8);for(var u=[e,r,e,t,i,t,i,r],h=0;h<u.length;h++){var p=u[h];this.leftSideMeshInfo.uv2Array[h]=p}}for(var d=0;d<o.length;d++){var f=o[d],m=3*d;this.leftSideMeshInfo.positionArray[m]=f.x,this.leftSideMeshInfo.positionArray[m+1]=f.y+this.suspend,this.leftSideMeshInfo.positionArray[m+2]=f.z}for(var g=0;g<o.length;g++){var v=a,y=3*g;this.leftSideMeshInfo.normalArray[y]=v.x,this.leftSideMeshInfo.normalArray[y+1]=v.y,this.leftSideMeshInfo.normalArray[y+2]=v.z}}},{key:"fillEdgeSideMeshInfo",value:function(){this.edgeSideMeshInfo.indexArray=[].concat([0,2,1,0,3,2]),this.shouldAddSideIndexes(this.startCorner)&&(this.edgeSideMeshInfo.indexArray=this.edgeSideMeshInfo.indexArray.concat([1,4,0,1,5,4])),this.shouldAddSideIndexes(this.endCorner)&&(this.edgeSideMeshInfo.indexArray=this.edgeSideMeshInfo.indexArray.concat([3,7,2,2,7,6])),this.startCorner.walls.length>2&&(this.edgeSideMeshInfo.indexArray=this.edgeSideMeshInfo.indexArray.concat([1,8,0])),this.endCorner.walls.length>2&&(this.edgeSideMeshInfo.indexArray=this.edgeSideMeshInfo.indexArray.concat([3,9,2])),0!==this.suspend&&(this.edgeSideMeshInfo.indexArray=this.edgeSideMeshInfo.indexArray.concat([4,5,6,4,6,7])),this.edgeSideMeshInfo.positionArray=new Float32Array(30),this.edgeSideMeshInfo.normalArray=new Float32Array(30),this.edgeSideMeshInfo.uvArray=new Uint16Array(20),this.edgeSideMeshInfo.parentPosition=this.position;for(var e=this.basePoints,t=[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9]],i=this.edgeSideMeshInfo.uvArray,r=0;r<i.length;r++)i[r]=0;for(var n=0;n<t.length;n++){var o=t[n],a=3*n;this.edgeSideMeshInfo.positionArray[a]=o.x,this.edgeSideMeshInfo.positionArray[a+1]=o.y+this.suspend,this.edgeSideMeshInfo.positionArray[a+2]=o.z}for(var s=0;s<t.length;s++){var l=this.upDirection,c=3*s;this.edgeSideMeshInfo.normalArray[c]=l.x,this.edgeSideMeshInfo.normalArray[c+1]=l.y,this.edgeSideMeshInfo.normalArray[c+2]=l.z}}},{key:"shouldAddSideIndexes",value:function(e){return 1===e.walls.length||0===e.walls.length||!e.checkWallsSameHeight()}},{key:"fillUV",value:function(){var e,t,i,r,n,o=0;this.rightResource.isDefault?(e=this.startUVPercent[0],t=this.startUVPercent[1],i=this.endUVPercent[0],r=this.endUVPercent[1]):(e=this.startUVPercent[0]*this.repeatUV[0],t=this.startUVPercent[1]*this.repeatUV[1],i=this.endUVPercent[0]*this.repeatUV[0],r=this.endUVPercent[1]*this.repeatUV[1]),(n=this.rightSideMeshInfo.uvArray)[o++]=e,n[o++]=r,n[o++]=i,n[o++]=t,n[o++]=i,n[o++]=r,n[o++]=e,n[o++]=r,n[o++]=e,n[o++]=t,n[o++]=i,n[o++]=t,this.leftResource.isDefault?(e=this.startUVPercent[2],t=this.startUVPercent[3],i=this.endUVPercent[2],r=this.endUVPercent[3]):(e=this.startUVPercent[2]*this.repeatUV[2],t=this.startUVPercent[3]*this.repeatUV[3],i=this.endUVPercent[2]*this.repeatUV[2],r=this.endUVPercent[3]*this.repeatUV[3]),o=0,(n=this.leftSideMeshInfo.uvArray)[o++]=i,n[o++]=r,n[o++]=e,n[o++]=t,n[o++]=e,n[o++]=r,n[o++]=i,n[o++]=r,n[o++]=i,n[o++]=t,n[o++]=e,n[o++]=t,o=0,(n=this.edgeSideMeshInfo.uvArray)[o++]=0,n[o++]=1,n[o++]=1,n[o++]=0,n[o++]=1,n[o++]=1,n[o++]=0,n[o++]=1,n[o++]=0,n[o++]=0,n[o++]=1,n[o++]=0,n[o++]=0,n[o++]=1,n[o++]=1,n[o++]=0,n[o++]=1,n[o++]=1,n[o++]=0,n[o++]=1,n[o++]=0,n[o++]=0,n[o++]=1,n[o++]=0,n[o++]=0,n[o++]=1,n[o++]=0,n[o++]=0,n[o++]=1,n[o++]=1,n[o++]=0,n[o++]=0,n[o++]=1,n[o++]=1,n[o++]=1,n[o++]=0,n[o++]=0,n[o++]=1,n[o++]=0,n[o++]=0,n[o++]=1,n[o++]=1,n[o++]=0,n[o++]=1,n[o++]=0,n[o++]=0,n[o++]=1,n[o++]=1,this.lightMapResource&&(e=this.startUVPercent[0],t=this.startUVPercent[1],i=this.endUVPercent[0],r=this.endUVPercent[1],o=0,(n=this.rightSideMeshInfo.uv2Array)[o++]=e,n[o++]=r,n[o++]=i,n[o++]=t,n[o++]=i,n[o++]=r,n[o++]=e,n[o++]=r,n[o++]=e,n[o++]=t,n[o++]=i,n[o++]=t,o=0,(n=this.leftSideMeshInfo.uv2Array)[o++]=i,n[o++]=r,n[o++]=e,n[o++]=t,n[o++]=e,n[o++]=r,n[o++]=i,n[o++]=r,n[o++]=i,n[o++]=t,n[o++]=e,n[o++]=t)}},{key:"getWallOtherCorner",value:function(e){return this.startCorner===e?this.endCorner:this.endCorner===e?this.startCorner:null}},{key:"createMesh",value:function(e){var t=new THREE.BufferGeometry;t.setIndex(e.indexArray),t.addAttribute("position",new THREE.BufferAttribute(e.positionArray,3)),t.addAttribute("normal",new THREE.BufferAttribute(e.normalArray,3)),t.addAttribute("uv",new THREE.BufferAttribute(e.uvArray,2));var i=e.material;return this.lightMapResource&&e.uv2Array&&this.enableLightMap&&t.addAttribute("uv2",new THREE.BufferAttribute(e.uv2Array,2)),e.material=i,new THREE.Mesh(t,i)}},{key:"resources",get:function(){return null===this._resources&&(this._resources=[],this._resources.push(this.lightMapResource),this._resources.push(this.leftResource),this._resources.push(this.rightResource),this._resources.push(this.edgeResource)),this._resources}},{key:"position",get:function(){var e=this.startCorner.position,t=this.endCorner.position,i=new THREE.Vector3;return i.addVectors(e,t),i.divideScalar(2),i},set:function(e){}}]),t}(),_=function(e){function t(){return l(this,t),p(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return h(t,b),c(t,[{key:"build",value:function(){if(this.initMeshInfo(),this.initMaterial(),!this.enableDelayLoadMode){var e=this.position,t=new THREE.Group("wall");t.add(this.createMesh(this.leftSideMeshInfo)),t.add(this.createMesh(this.rightSideMeshInfo)),t.add(this.createMesh(this.edgeSideMeshInfo)),t.position.set(e.x,e.y,e.z),this.wallGroup=t,this.mesh=this.wallGroup}this._isBuilded=!0}},{key:"initMeshInfo",value:function(){this.baseBuild(),this.calPosInfo(),this.calBasePoints(),this.fillMesh()}},{key:"addToParentCollector",value:function(){this.parent.subWalls.push(this)}}]),t}(),x=function(e){function t(e,i,r){l(this,t);var n=p(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.walls=[],n.position=new THREE.Vector3(e,i,r),n}return h(t,g),c(t,[{key:"addWall",value:function(e){for(var t=0,i=this.walls.length;t<i;t++)if(this.walls[t]===e)return void console.error("repeat wall"+e);this.walls.push(e)}},{key:"build",value:function(){if(!this.isBuilded){var e=this.getSameHeightWalls();for(var t in e)this.calWallsVertices(e[t]);this.processWhenBuildFinish()}}},{key:"isFirstWallShouldNotCal",value:function(e){return!(e instanceof w)||e instanceof _}},{key:"isSecondWallShouldNotCal",value:function(e){return null!=e&&(e.resource&&e.resource.isModel||e instanceof _)}},{key:"checkWallsSameHeight",value:function(){for(var e=null,t=0;t<this.walls.length;t++){var i=this.walls[t];if(null===e)e=i.height;else if(e!==i.height)return!1}return!0}},{key:"getSameHeightWalls",value:function(){for(var e={},t=0;t<this.walls.length;t++){var i=this.walls[t];this.isStraightManualWall(i)&&(void 0===e[i.height]&&(e[i.height]=[]),e[i.height].push(i))}return e}},{key:"isStraightManualWall",value:function(e){return e instanceof w}},{key:"calWallsVertices",value:function(e){var t=new THREE.Vector3(0,-1,0);if(1===e.length){var i=e[0];i instanceof w&&this.setDefaultCornerVertices(i)}else{this.sortWalls(e);for(var r=0;r<e.length;r++){var n=e[r];if(!this.isFirstWallShouldNotCal(n)){for(var o=null,a=r;null==o&&(a===e.length-1?a=0:a+=1,e[a]!==n);)o=e[a],this.isSecondWallShouldNotCal(o)&&(o=null);if(o){var s=n.getWallOtherCorner(this).position,l=new THREE.Vector3;l.subVectors(s,this.position),s=o.getWallOtherCorner(this).position;var c=new THREE.Vector3;if(c.subVectors(s,this.position),l.normalize(),c.normalize(),0!==l.length()&&0!==c.length()){var u=n.thick/2,h=new THREE.Vector3;h.crossVectors(t,l),h.normalize();var p=h.clone();p.multiplyScalar(u),p.add(this.position),u=o.thick/2;var d=c.clone();d.cross(t),d.normalize();var f=d.clone();if(f.multiplyScalar(u),f.add(this.position),this.setCornersVertices(n,p,!0),this.setCornersVertices(o,f,!1),l.normalize(),c.normalize(),this.calAngle(l,c)>30){var g;if(m.approximatelyNumberEqual(Math.abs(l.dot(c)),1)){var v=l.clone();v.cross(t),v.normalize(),this.setDefaultCornerVertices(n,!0),this.setDefaultCornerVertices(o,!0);continue}if(0!==(g=this.getIntersectPosition(p,l,f,c)).x||0!==g.y||0!==g.z)g.clone().y=this.position.y+this.getWallHeight(),this.setCornersVertices(n,g,!0),this.setCornersVertices(o,g,!1)}else this.setCornersVertices(n,p,!0),this.setCornersVertices(o,f,!1)}else this.setDefaultCornerVertices(n,!0),this.setDefaultCornerVertices(o,!1)}else this.setDefaultCornerVertices(n)}}}}},{key:"sortWalls",value:function(e){if(e.length>1)for(var t,i,r=e[0],n=0,o=e.length-1;n<o;){for(i=n;i<o;++i)this.angleBetween(r,e[i])>this.angleBetween(r,e[i+1])&&(t=e[i],e[i]=e[i+1],e[i+1]=t);for(i=--o;i>n;--i)this.angleBetween(r,e[i])<this.angleBetween(r,e[i-1])&&(t=e[i],e[i]=e[i-1],e[i-1]=t);++n}}},{key:"angleBetween",value:function(e,t){var i=e.getWallOtherCorner(this).position.clone();i.sub(this.position);var r=t.getWallOtherCorner(this).position.clone();return r.sub(this.position),this.calAngle(i,r)}},{key:"calAngle",value:function(e,t){e.normalize(),t.normalize();var i=e.angleTo(t);i*=180/Math.PI;var r=e.clone();return r.cross(t),r.y>0&&(i=360-i),i}},{key:"getWallHeight",value:function(){for(var e=99999,t=0;t<this.walls.length;t++){var i=this.walls[t];e>i.height&&(e=i.height)}return e}},{key:"setCornersVertices",value:function(e,t,i){var r=new THREE.Vector3(0,0,0);r.x=t.x-e.position.x,r.y=t.y-e.position.y,r.z=t.z-e.position.z,e.startCorner===this?i?(e.cornersVertices[0].x=r.x,e.cornersVertices[0].y=r.y,e.cornersVertices[0].z=r.z):(e.cornersVertices[1].x=r.x,e.cornersVertices[1].y=r.y,e.cornersVertices[1].z=r.z):i?(e.cornersVertices[2].x=r.x,e.cornersVertices[2].y=r.y,e.cornersVertices[2].z=r.z):(e.cornersVertices[3].x=r.x,e.cornersVertices[3].y=r.y,e.cornersVertices[3].z=r.z)}},{key:"setDefaultCornerVertices",value:function(e,t){var i=new THREE.Vector3(0,-1,0),r=e.getWallOtherCorner(this).position.clone();r.sub(this.position),r.normalize();var n=e.thick/2,o=i.clone();o.cross(r),o.normalize(),o.multiplyScalar(n);var a=new THREE.Vector3;a.addVectors(this.position,o);var s=new THREE.Vector3;s.subVectors(this.position,o),void 0===t?(this.setCornersVertices(e,a,!0),this.setCornersVertices(e,s,!1)):t?this.setCornersVertices(e,a,!0):this.setCornersVertices(e,s,!1)}},{key:"getIntersectPosition",value:function(e,t,i,r){if(e.x===i.x&&e.y===i.y&&e.z===i.z)return e;var n=e.y;if(1===t.dot(r))throw"two line in same direction ,can not cal intersected position!";var o=new THREE.Vector3,a=new THREE.Vector3;o.addVectors(e,t),a.addVectors(i,r);var s=new THREE.Vector2(e.x,e.z),l=new THREE.Vector2(o.x,o.z),c=new THREE.Vector2(i.x,i.z),u=new THREE.Vector2(a.x,a.z),h=(l.y-s.y)*(u.x-c.x)-(s.x-l.x)*(c.y-u.y);if(0==h)return new THREE.Vector3;var p=((l.x-s.x)*(u.x-c.x)*(c.y-s.y)+(l.y-s.y)*(u.x-c.x)*s.x-(u.y-c.y)*(l.x-s.x)*c.x)/h,d=-((l.y-s.y)*(u.y-c.y)*(c.x-s.x)+(l.x-s.x)*(u.y-c.y)*s.y-(u.x-c.x)*(l.y-s.y)*c.y)/h;return new THREE.Vector3(p,n,d)}},{key:"size",get:function(){return new THREE.Vector3(0,0,0)}},{key:"boundingBox",get:function(){return null===this._boundingBox&&(this._boundingBox=new THREE.Box3,this._boundingBox.expandByPoint(new THREE.Vector3(0,0,0))),this._boundingBox}}]),t}(),E=function(e){function t(){return l(this,t),p(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return h(t,x),c(t,[{key:"isFirstWallShouldNotCal",value:function(e){return!(e instanceof _)}},{key:"isSecondWallShouldNotCal",value:function(e){return e&&!(e instanceof _)}}],[{key:"createSubWallCorner",value:function(e,i,r){var n=new t;return n.id=e,n.position=i,n.parent=r.parent,n}}]),t}(),w=function(e){function t(){return l(this,t),p(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return h(t,b),c(t,[{key:"build",value:function(){if(!this.isBuilded){if(!this.checkResourceReady())return void this.initResource();if(this.doorOrWindows.length>0){this.baseBuild(),this.calPosInfo(),this.calEachSideLen(),this.calRepeatUV(),this.initSimpleCornersAndWalls(),this.mesh=new THREE.Object3D;for(var e=0;e<this.subWalls.length;e++){var t=this.subWalls[e];t.build(),this.mesh.add(t.mesh),this.wallGroup=this.mesh}}else{this.initMeshInfo(),this.initMaterial();var i=this.position,r=new THREE.Group("wall");r.add(this.createMesh(this.leftSideMeshInfo)),r.add(this.createMesh(this.rightSideMeshInfo)),r.add(this.createMesh(this.edgeSideMeshInfo)),r.position.set(i.x,i.y,i.z),this.wallGroup=r,this.mesh=this.wallGroup}this.processWhenBuildFinish()}}},{key:"initSimpleCornersAndWalls",value:function(){var e=this.position;(new THREE.Vector3).crossVectors(this.direction,this.vectorUp);for(var t=this.sortDoorOrWins(),i=0;i<t.length;i++){var r=t[i],n=this.getDoorOrWinStartAndEndPos(r),o=this.getDoorOrWinRectPoints(r),a=E.createSubWallCorner(this.id+"_"+i+"_1",n[0],this),s=E.createSubWallCorner(this.id+"_"+i+"_2",n[1],this);if(this.addSubWallCorner(a),this.addSubWallCorner(s),0===i){var l=new _;l.startCorner=this.startCorner,l.endCorner=a,l.startCorner.build(),l.endCorner.build(),this.setCornerVertices(l,!0),l.calPosInfo(),l.calEachSideLen(),l.endUVPercent[0]=l.rightSideLength/this.rightSideLength,l.endUVPercent[2]=l.leftSideLength/this.leftSideLength,l.repeatUV=this.repeatUV,l.leftResource=this.leftResource,l.rightResource=this.rightResource,l.edgeResource=this.edgeResource,l.lightMapResource=this.lightMapResource,l.height=this.height,l.thick=this.thick,l.parentWall=this,l.parent=this}else{var c=t[i-1],u=this.getDoorOrWinStartAndEndPos(c),h=this.getDoorOrWinRectPoints(c),p=this.getWallCornerByPos(u[1]),d=new _;d.startCorner=p,d.endCorner=a;var f=new THREE.Vector3;f.subVectors(p.position,a.position);var m=f.length();d.startCorner.build(),d.endCorner.build(),d.calPosInfo(),d.calEachSideLen();var g=h[3].distanceTo(e.clone().addVectors(this.cornersVertices[0],e)),v=h[2].distanceTo(e.clone().addVectors(this.cornersVertices[1],e));d.startUVPercent[0]=g/this.rightSideLength,d.startUVPercent[2]=v/this.leftSideLength,d.endUVPercent[0]=(g+m)/this.rightSideLength,d.endUVPercent[2]=(v+m)/this.leftSideLength,d.repeatUV=this.repeatUV,d.leftResource=this.leftResource,d.rightResource=this.rightResource,d.edgeResource=this.edgeResource,d.lightMapResource=this.lightMapResource,d.height=this.height,d.thick=this.thick,d.parentWall=this,d.parent=this}if(i==t.length-1){var y=new _;y.parent=this,y.startCorner=s,y.endCorner=this.endCorner,y.startCorner.build(),this.setCornerVertices(y,!1),y.calPosInfo(),y.calEachSideLen();g=o[3].distanceTo(e.clone().addVectors(this.cornersVertices[0],e)),v=o[2].distanceTo(e.clone().addVectors(this.cornersVertices[1],e));y.startUVPercent[0]=g/this.rightSideLength,y.startUVPercent[2]=v/this.leftSideLength,y.repeatUV=this.repeatUV,y.leftResource=this.leftResource,y.rightResource=this.rightResource,y.edgeResource=this.edgeResource,y.lightMapResource=this.lightMapResource,y.height=this.height,y.thick=this.thick,y.parentWall=this}this.buildHeadAndFootWall(r,a,s)}}},{key:"buildSimpleCornersAndWalls",value:function(){this.enableDelayLoadMode||(this.wallGroup=new THREE.Object3D);for(var e=0;e<this.subCorners.length;e++){this.subCorners[e].build()}for(e=0;e<this.subWalls.length;e++){var t=this.subWalls[e];t.build(),this.enableDelayLoadMode||this.wallGroup.add(t.wallGroup)}this.mesh=this.wallGroup}},{key:"buildHeadAndFootWall",value:function(e,t,i){var r=this.position,n=this.getDoorOrWinRectPoints(e),o=n[0].distanceTo(r.clone().addVectors(this.cornersVertices[0],r)),a=n[1].distanceTo(r.clone().addVectors(this.cornersVertices[1],r)),s=e.suspendPercent;(new THREE.Vector3).crossVectors(this.direction,this.vectorUp);var l=e.size.y+this.height*s;if(0!==e.suspendPercent){var c=new _;c.parent=this,c.startCorner=t,c.endCorner=i,(h=new THREE.Vector3).subVectors(i.position,t.position);var u=h.length();c.height=this.height*s,c.thick=this.thick,c.startUVPercent=[o/this.rightSideLength,0,a/this.leftSideLength,0],c.endUVPercent[0]=(o+u)/this.rightSideLength,c.endUVPercent[1]=c.height/this.height,c.endUVPercent[2]=(a+u)/this.leftSideLength,c.endUVPercent[3]=c.height/this.height,c.uvMultiple=this.uvMultiple,c.repeatUV=this.repeatUV,c.leftResource=this.leftResource,c.rightResource=this.rightResource,c.edgeResource=this.edgeResource,c.lightMapResource=this.lightMapResource,c.parentWall=this}if(l<this.height){var h,p=new _;p.parent=this,p.startCorner=t,p.endCorner=i,(h=new THREE.Vector3).subVectors(i.position,t.position);u=h.length();p.suspend=l,p.height=this.height-l,p.thick=this.thick,p.startUVPercent=[o/this.rightSideLength,l/this.height,a/this.leftSideLength,l/this.height],p.endUVPercent[0]=(o+u)/this.rightSideLength,p.endUVPercent[2]=(a+u)/this.leftSideLength,p.uvMultiple=this.uvMultiple,p.repeatUV=this.repeatUV,p.leftResource=this.leftResource,p.rightResource=this.rightResource,p.edgeResource=this.edgeResource,p.lightMapResource=this.lightMapResource,p.parentWall=this}}},{key:"setCornerVertices",value:function(e,t){var i,r;t?((i=new THREE.Vector3).addVectors(this.cornersVertices[0],this.position),i.sub(e.position),(r=new THREE.Vector3).addVectors(this.cornersVertices[1],this.position),r.sub(e.position),e.cornersVertices[0]=i,e.cornersVertices[1]=r):((i=new THREE.Vector3).addVectors(this.cornersVertices[2],this.position),i.sub(e.position),(r=new THREE.Vector3).addVectors(this.cornersVertices[3],this.position),r.sub(e.position),e.cornersVertices[2]=i,e.cornersVertices[3]=r)}},{key:"getDoorOrWinRectPoints",value:function(e){var t=this.thick/2,i=new THREE.Vector3;i.crossVectors(this.vectorUp,this.direction),i.normalize();var r=i.clone();r.negate(),this.vectorUp.clone().multiplyScalar(t);var n=e.size,o=this.direction,a=e.position,s=n.x/2,l=new THREE.Vector3,c=new THREE.Vector3;return l.subVectors(a,o.clone().multiplyScalar(s)),c.addVectors(a,o.clone().multiplyScalar(s)),[l.clone().addVectors(l,i.clone().multiplyScalar(t)),l.clone().addVectors(l,r.clone().multiplyScalar(t)),c.clone().addVectors(c,r.clone().multiplyScalar(t)),c.clone().addVectors(c,i.clone().multiplyScalar(t))]}}]),t}(),T=function(e){function t(e){l(this,t);var i=p(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.shapePath=null,i.holePaths=null,i.room=e,i.isDoubleSide=!1,i.texture=f.floorTexture,i.enableLightMap=y.enableFloorLightMap,i.material=null,i.geometry=null,i.resource=null,i.blockSize=null,i.DefaultHeight=.01,i.height=i.DefaultHeight,i}return h(t,g),c(t,[{key:"resourceCallback",value:function(e){this.texture=e.texture,this.mesh&&(this.mesh.material.map=this.texture,this.mesh.material.needsUpdate=!0)}},{key:"initResource",value:function(){var e=this.room.floorResource;e&&(e.ready?(this.texture=e.texture,this.material=e.material):(!y.enableCombine||this.room.userID||this.room.name||this.room.properties)&&e.registerListener(this))}},{key:"build",value:function(){this.initResource(),this.calGeometry();var e=this.geometry,t=null;if(null===this.height&&(this.height=this.DefaultHeight),this.room.lightMapResource&&this.enableLightMap?this.calLightMapUV(e):t=this.resource.roomMaterial,t.side=THREE.DoubleSide,t.defines=t.defines||{},t.defines.FLOOR_AO=!0,void 0===t&&console.error("floor material is null"),this.mesh=new THREE.Mesh(e,t),this.mesh.name="floor",this.mesh.position.y=this.height,this.mesh.rotateX(-Math.PI/2),this.room.center){var i=this.room.center;this.mesh.position.set(i.x,0,i.z)}this.mesh.visible=this.isShow,this.mesh.roomID=this.room.id}},{key:"calGeometry",value:function(){4===this.shapePath.length&&0===this.holePaths.length||(this.enableLightMap=!1);for(var e=new THREE.Vector3,t=0;t<this.shapePath.length;t++){var i=this.shapePath[t];e.x+=i.x,e.z+=i.y}e.x/=this.shapePath.length,e.z/=this.shapePath.length;var r=new THREE.Shape(this.shapePath);if(this.holePaths)for(t=0;t<this.holePaths.length;t++){var n=this.holePaths[t];r.holes.push(new THREE.Path(n))}var o=new THREE.ShapeGeometry(r);if(this.blockSize)for(t=0;t<o.faceVertexUvs.length;t++)for(var a=o.faceVertexUvs[t],s=0;s<a.length;s++)for(var l=a[s],c=0;c<l.length;c++){var u=l[c];u.set(u.x/this.blockSize.x,u.y/this.blockSize.y)}o.uvsNeedUpdate=!0,this.room.uv2&&(o.faceVertexUvs[1]=this.room.uv2),this.geometry=o}},{key:"calLightMapUV",value:function(e){var t,i,r,n,o=e.faceVertexUvs;o[1]=[];for(var a=0;a<o.length;a++)for(var s=o[a],l=0;l<s.length;l++)for(var c=s[l],u=0;u<c.length;u++){var h=c[u];void 0!==t?(h.x>t&&(t=h.x),h.x<r&&(r=h.x),h.y>i&&(i=h.y),h.y<n&&(n=h.y)):(t=h.x,i=h.y,r=h.x,n=h.y)}var p=o[0],d=[];for(l=0;l<p.length;l++){c=p[l];var f=[];for(u=0;u<c.length;u++){h=c[u];var m=new THREE.Vector2,g=h.x===t?1:0,v=h.y===i?1:0;m.set(g,v),f.push(m)}d.push(f)}o[1]=d}},{key:"reCalUV",value:function(e){for(var t,i,r,n,o=e.faceVertexUvs,a=0;a<o.length;a++)for(var s=o[a],l=0;l<s.length;l++)for(var c=s[l],u=0;u<c.length;u++){var h=c[u];void 0!==t?(h.x>t&&(t=h.x),h.x<r&&(r=h.x),h.y>i&&(i=h.y),h.y<n&&(n=h.y)):(t=h.x,i=h.y,r=h.x,n=h.y)}var p=Math.abs(r),d=Math.abs(n);t+=p,i+=d;var f=[];for(a=0;a<o.length;a++){var m=o[a],g=[];for(l=0;l<m.length;l++){c=m[l];var v=[];for(u=0;u<c.length;u++){h=c[u];var y=new THREE.Vector2;y.set((h.x+p)/t,(h.y+d)/i),v.push(y)}g.push(v)}f.push(g)}return f}}]),t}(),S=function(e){function t(e){l(this,t);var i=p(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.shapePath=[],i.holePaths=null,i.center=null,i.room=e,i.material=null,i.geometry=null,i.resource=null,i.height=null,i.blockSize=null,i.DefaultHeight=2.9,i.height=i.DefaultHeight,i}return h(t,g),c(t,[{key:"initResource",value:function(){var e=this.room.ceilingResource;e&&(e.ready?(this.texture=e.texture,this.material=e.material):(!y.enableCombine||this.room.userID||this.room.name||this.room.properties)&&e.registerListener(this))}},{key:"resourceCallback",value:function(e){this.texture=e.texture,this.mesh&&(this.mesh.material.map=this.texture,this.mesh.material.needsUpdate=!0)}},{key:"build",value:function(){this.enableDelayLoadMode||this.initResource(),this.calGeometry();var e;if(e=this.resource.roomMaterial,this.mesh=new THREE.Mesh(this.geometry,e),this.mesh.name="ceiling",this.mesh.rotateX(Math.PI/2),null===this.height){var t=2.9;this.room.parent&&(t=this.room.parent.height),this.height=t}if(this.mesh.position.y=this.height,this.mesh.updateMatrixWorld(),this.room.center){var i=this.room.center;this.mesh.position.set(i.x,3,i.z)}this.mesh.visible=this.isShow}},{key:"calGeometry",value:function(){var e=new THREE.Shape(this.shapePath);if(this.holePaths)for(var t=0;t<this.holePaths.length;t++){var i=this.holePaths[t];e.holes.push(new THREE.Path(i))}var r=new THREE.ShapeGeometry(e);if(this.material=this.resource.roomMaterial,this.geometry=r,this.blockSize)for(t=0;t<r.faceVertexUvs.length;t++)for(var n=r.faceVertexUvs[t],o=0;o<n.length;o++)for(var a=n[o],s=0;s<a.length;s++){var l=a[s];l.set(l.x/this.blockSize.x,l.y/this.blockSize.y)}r.uvsNeedUpdate=!0}}]),t}(),M=function(e){function t(e){l(this,t);var i=p(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.shapePath=[],i.holePaths=null,i.center=null,i.room=e,i.material=null,i.geometry=null,i.resource=null,i.DefaultHeight=3,i.height=i.DefaultHeight,i.blockSize=null,i}return h(t,g),c(t,[{key:"resourceCallback",value:function(e){this.texture=e.texture,this.mesh&&(this.mesh.material.map=this.texture,this.mesh.material.needsUpdate=!0)}},{key:"initResource",value:function(){var e=this.room.roofResource;e&&(e.ready?(this.texture=e.texture,this.material=e.material):(!y.enableCombine||this.room.userID||this.room.name||this.room.properties)&&e.registerListener(this))}},{key:"build",value:function(){this.enableDelayLoadMode||this.initResource(),this.calGeometry();var e;if(e=this.resource.roomMaterial,this.mesh=new THREE.Mesh(this.geometry,e),null===this.height){var t=3;this.room.parent&&(t=this.room.parent.height),this.height=t}if(this.mesh.position.y=this.height+.001,this.mesh.name="roof",this.mesh.rotateX(-Math.PI/2),this.room.center){var i=this.room.center;this.mesh.position.set(i.x,this.height,i.z)}this.mesh.updateMatrixWorld(),this.mesh.visible=this.isShow,this.mesh.name="roof"+this.room.id}},{key:"calGeometry",value:function(){var e=new THREE.Shape(this.shapePath);if(this.holePaths)for(var t=0;t<this.holePaths.length;t++){var i=this.holePaths[t];e.holes.push(new THREE.Path(i))}var r=new THREE.ShapeGeometry(e);if(this.geometry=r,this.material=this.resource.roomMaterial,this.blockSize)for(t=0;t<r.faceVertexUvs.length;t++)for(var n=r.faceVertexUvs[t],o=0;o<n.length;o++)for(var a=n[o],s=0;s<a.length;s++){var l=a[s];l.set(l.x/this.blockSize.x,l.y/this.blockSize.y)}r.uvsNeedUpdate=!0}}]),t}(),R=function(e){function t(e){l(this,t);var i=p(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.dataJson=e,i.shapePath=[],i.reverseZShapPath=[],i.holePaths=[],i.reverseZHolePaths=[],i._points=[],i._holes=[],i._uv2=[],i.center=null,i.meshGroup=null,i.offset=null,i.parentPosition=null,i.position=new THREE.Vector3,i.floor=new T(i),i.roof=new M(i),i.ceiling=new S(i),i.floorResource=null,i.ceilingResource=null,i.roofResource=null,i.isOnlyFloor=!1,i._isMultiResources=!0,i}return h(t,g),c(t,[{key:"initShapePathPoints",value:function(){var e=this.points;this.shapePath.length=0,this.reverseZShapPath.length=0;for(var t=0;t<e.length;t++){var i=e[t].clone();this.shapePath.push(new THREE.Vector2(i.x,i.z)),this.reverseZShapPath.push(new THREE.Vector2(i.x,-i.z))}this.floor.shapePath=this.reverseZShapPath,this.ceiling.shapePath=this.shapePath,this.roof.shapePath=this.reverseZShapPath}},{key:"initShapeHolePoints",value:function(){var e=this.holes;this.holePaths.length=0,this.reverseZHolePaths.length=0;for(var t=0;t<e.length;t++){for(var i=e[t],r=i.length,n=[],o=[],a=0;a<r;a++){var s=i[a].clone();n.push(new THREE.Vector2(s.x,s.z)),o.push(new THREE.Vector2(s.x,-s.z))}this.holePaths.push(n),this.reverseZHolePaths.push(o)}this.floor.holePaths=this.reverseZHolePaths,this.ceiling.holePaths=this.holePaths,this.roof.holePaths=this.reverseZHolePaths}},{key:"build",value:function(){if(!this.isBuilded){if(!this.checkResourceReady())return void this.initResource();if(this.parentPosition&&this.offset){var e=new THREE.Vector3;e.add(this.parentPosition),e.add(this.offset),this.center=e}else this.center=null;this.isOnlyFloor?(this.floor.build(),this.meshGroup=new THREE.Object3D("room"),this.meshGroup.add(this.floor.mesh)):(this.floor.build(),this.ceiling.build(),this.roof.build(),this.meshGroup=new THREE.Object3D("room"),this.meshGroup.add(this.floor.mesh),this.meshGroup.add(this.ceiling.mesh),this.meshGroup.add(this.roof.mesh)),this.mesh=this.meshGroup,this.mesh.roomid=this.id,this.meshGroup.position.set(this.position.x,this.position.y,this.position.z),this.processWhenBuildFinish()}}},{key:"checkResourceReady",value:function(){return!!(this.floor.resource.ready&&this.ceiling.resource.ready&&this.roof.resource.ready)}},{key:"initResource",value:function(){this.downloadResource(this.floor.resource),this.downloadResource(this.ceiling.resource),this.downloadResource(this.roof.resource)}},{key:"downloadResource",value:function(e){e.ready||(e.isStartDownload||e.requestToDownload(),e.registerListener(this))}},{key:"resourceCallback",value:function(e){this.checkResourceReady()&&this.build()}},{key:"addToParentCollector",value:function(){u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addToParentCollector",this).call(this),this.parent.rooms.push(this)}},{key:"resources",get:function(){return null===this._resources&&(this._resources=[],this._resources.push(this.ceiling.resource),this._resources.push(this.floor.resource),this._resources.push(this.roof.resource)),this._resources}},{key:"points",set:function(e){this._points=e},get:function(){return this._points}},{key:"holes",set:function(e){this._holes=e},get:function(){return this._holes}},{key:"uv2",set:function(e){this._uv2=e},get:function(){return this._uv2}}]),t}(),P=function(e){function t(){l(this,t);var e=p(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.floorplans=[],e.facades=[],e.facadeGroups=[],e.isContainer=!0,e}return h(t,g),c(t,[{key:"build",value:function(){this.registerBuildedCallbackToChildren();for(var e=0;e<this.children.length;e++){this.children[e].build()}}},{key:"registerBuildedCallbackToChildren",value:function(){for(var e=0;e<this.children.length;e++){this.children[e].registerBuildCallbackListener(this.childBuildedCallback)}}},{key:"childBuildedCallback",value:function(e){for(var t=e.parent,i=0;i<t.children.length;i++){if(!t.children[i].isBuilded)return}t.processWhenBuildFinish()}},{key:"children",get:function(){return null===this._children&&(this._children=[],this._children=this._children.concat(this.facades).concat(this.facadeGroups).concat(this.floorplans)),this._children}},{key:"size",get:function(){return this.boundingBox.getSize(this._size)}},{key:"boundingBox",get:function(){if(null===this._boundingBox){this._boundingBox=new THREE.Box3;for(var e=0;e<this.children.length;e++){var t=this.children[e],i=t.boundingBox,r=i.min.clone();r.add(t.position),this._boundingBox.expandByPoint(r),(r=i.max.clone()).add(t.position),this._boundingBox.expandByPoint(r)}}return this._boundingBox}}]),t}(),A=function(e){function t(){l(this,t);var e=p(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.walls=[],e.corners=[],e.rooms=[],e.placements=[],e.videoprobes=[],e.curvelines=[],e.pipelines=[],e.text3Ds=[],e.doorOrWindows=[],e.groups=[],e.height=3,e.alwaysShowInsideObjs=!1,e.combinePlacements=[],e.combineStraightManualWalls=[],e.combineModelWalls=[],e.combineRoofs=[],e.combineCeilings=[],e.combineFloors=[],e.combineDoorOrWins=[],e.combinePlacementObjects=[],e.combineStraightManualWallObjects=[],e.combineModelWallObjects=[],e.combineRoofObjects=[],e.combineCeilingObjects=[],e.combineFloorObjects=[],e.combineDoorOrWindowObjects=[],e._size=new THREE.Vector3,e.isContainer=!0,e}return h(t,g),c(t,[{key:"build",value:function(){this.fillChildren(),this.registerBuildedCallbackToChildren();for(var e=0;e<this.children.length;e++){this.children[e].build()}}},{key:"fillChildren",value:function(){this._children=[],this._children=this._children.concat(this.corners).concat(this.combineStraightManualWallObjects).concat(this.combineModelWallObjects).concat(this.rooms).concat(this.walls).concat(this.combineFloorObjects).concat(this.combineRoofObjects).concat(this.combineCeilingObjects).concat(this.combinePlacementObjects).concat(this.combineDoorOrWindowObjects).concat(this.doorOrWindows).concat(this.placements).concat(this.groups).concat(this.curvelines).concat(this.pipelines)}},{key:"registerBuildedCallbackToChildren",value:function(){for(var e=0;e<this.children.length;e++){this.children[e].registerBuildCallbackListener(this.childBuildedCallback)}}},{key:"childBuildedCallback",value:function(e){var t=e.parent;t.isBuilded&&t.processWhenBuildFinish()}},{key:"existsCorner",value:function(e,t,i){for(var r=0,n=this.corners.length;r<n;r++){var o=this.corners[r].position;if(o.x===e&&o.y===t&&o.z===i)return!0}return!1}},{key:"addCorner",value:function(e,t,i){var r=new x(e,t,i);return this.corners.push(r),r.parent=this,r}},{key:"getCorner",value:function(e,t,i){for(var r=0,n=this.corners.length;r<n;r++){var o=this.corners[r].position;if(o.x===e&&o.y===t&&o.z===i)return this.corners[r]}return null}},{key:"exportTestXS",value:function(){for(var e={points:[],edges:[]},t=[],i=[],r=0;r<this.corners.length;r++){var n=this.corners[r];t.push([n.position.x,n.position.z])}for(r=0;r<this.walls.length;r++){var o=this.walls[r];i.push([this.corners.indexOf(o.startCorner),this.corners.indexOf(o.endCorner)])}return e.points=t,e.edges=i,e}},{key:"addToParentCollector",value:function(){u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addToParentCollector",this).call(this),this.parent instanceof P&&this.parent.floorplans.push(this)}},{key:"calRoomsUV2",value:function(){for(var e=0;e<this.rooms.length;e++){this.rooms[e].floor.calGeometry()}var t=this._calAllFloorBox2(this);this._fillUV2ToRooms(this.rooms,t);for(var i=0;i<this.rooms.length;i++){this.rooms[i].floor.clear()}}},{key:"_fillUV2ToRooms",value:function(e,t){for(var i=0;i<e.length;i++){var r=e[i],n=this._calFloorUV2(r,t);this._fillUV2ToFloor(r,n)}}},{key:"_calFloorUV2",value:function(e,t){var i=[],r=new THREE.Vector2;t.getSize(r);for(var n=e.floor.geometry.vertices,o=this._getFloorPosition(e),a=0;a<n.length;a++){var s=n[a].clone();s.x+=o.x,s.y+=o.z;var l=(s.x-t.min.x)/r.x,c=(s.y-t.min.y)/r.y;i.push(new THREE.Vector2(parseFloat(l.toFixed(2)),parseFloat(c.toFixed(2))))}return i}},{key:"_fillUV2ToFloor",value:function(e,t){for(var i=e.floor.geometry.faces,r=[],n=0;n<i.length;n++){var o=i[n],a=[t[o.a],t[o.b],t[o.c]];r.push(a)}e.uv2=r}},{key:"_calAllFloorBox2",value:function(e){for(var t=new THREE.Box2,i=0;i<e.rooms.length;i++){var r=e.rooms[i];null===r.floor.geometry&&r.floor.calGeometry();for(var n=this._getFloorPosition(r),o=r.floor.geometry.vertices,a=0;a<o.length;a++){var s=o[a].clone();s.x+=n.x,s.y+=n.z,t.expandByPoint(s)}}return t}},{key:"_getFloorPosition",value:function(e){var t=e.position.clone();return t.z=-t.z,t}},{key:"children",get:function(){return this.fillChildren(),this._children}},{key:"size",get:function(){return this.boundingBox.getSize(this._size)}},{key:"boundingBox",get:function(){if(null===this._boundingBox){this._boundingBox=new THREE.Box3,this.fillChildren();for(var e=0;e<this.children.length;e++){var t=this.children[e].boundingBox;this._boundingBox.expandByPoint(t.min),this._boundingBox.expandByPoint(t.max)}}return this._boundingBox}}]),t}(),C=function(e){function t(){l(this,t);var e=p(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.outdoors=null,e.buildings=[],e._size=new THREE.Vector3,e.isContainer=!0,e}return h(t,g),c(t,[{key:"build",value:function(){for(var e=0;e<this.buildings.length;e++){this.buildings[e].build()}this.outdoors&&this.outdoors.build()}},{key:"children",get:function(){return null===this._children&&(this._children=[],this._children.push(this.outdoors),this._children=this._children.concat(this.buildings)),this._children}},{key:"size",get:function(){return this.boundingBox.getSize(this._size)}},{key:"boundingBox",get:function(){if(null===this._boundingBox){this._boundingBox=new THREE.Box3;for(var e=0;e<this.buildings.length;e++){var t=this.buildings[e].boundingBox;this._boundingBox.expandByPoint(t.min),this._boundingBox.expandByPoint(t.max)}this._boundingBox.expandByPoint(this.outdoors.boundingBox.min),this._boundingBox.expandByPoint(this.outdoors.boundingBox.max)}return this._boundingBox}}]),t}(),O=function(e){function t(){return l(this,t),p(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return h(t,A),c(t,[{key:"build",value:function(){for(var e=0;e<this.rooms.length;e++){this.rooms[e].isOnlyFloor=!0}u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"build",this).call(this)}}]),t}(),L=function e(t,i,r,n){l(this,e),this.positionArray=t.geometry.getAttribute("position").array.slice();var o=t.geometry.getAttribute("normal");o?this.normalArray=o.array.slice():console.warn("not has normal");var a=t.geometry.getAttribute("uv");a&&(this.uvArray=a.array);var s=t.geometry.getAttribute("uv2");s&&(this.uv2Array=s.array);var c=t.geometry.getAttribute("uv3");c&&(this.uv3Array=c.array);var u=t.geometry.getAttribute("color");u&&(this.colorArray=u.array),this.indexArray=t.geometry.index.array,this.material=t.material;for(var h=this.positionArray,p=this.normalArray,d=0;d<h.length;){for(var f=n.length-1;f>-1;f--){var m=i[f],g=r[f],v=n[f];h[d]*=m.x,h[d+1]*=m.y,h[d+2]*=m.z;var y=new THREE.Vector3(h[d],h[d+1],h[d+2]);if((y=y.applyQuaternion(g)).x+=v.x,y.y+=v.y,y.z+=v.z,h[d]=y.x,h[d+1]=y.y,h[d+2]=y.z,p){var b=new THREE.Vector3(p[d],p[d+1],p[d+2]);b=b.applyQuaternion(g),p[d]=b.x,p[d+1]=b.y,p[d+2]=b.z}}d+=3}this.vertexCount=this.positionArray.length/3,this.indexCount=this.indexArray.length,this.groups=t.geometry.groups},k=function(){function e(t){l(this,e),this.bundeObj=t,this.materialMap=new Map,this.combineBundleMeshs=[],this.vertexCount=0}return c(e,[{key:"combine",value:function(){this._combine(this.bundeObj,[],[],[])}},{key:"_combine",value:function(e,t,i,r){if(t.push(e.scale),r.push(e.position),i.push(e.quaternion),e instanceof THREE.Mesh){var n=new L(e,t,i,r);0!==n.vertexCount&&(this.combineBundleMeshs.push(n),void 0===this.materialMap.get(n.material)&&this.materialMap.set(n.material,[]),this.materialMap.get(n.material).push(n)),this.vertexCount+=n.vertexCount}if(0!==e.children.length)for(var o=0;o<e.children.length;o++){var a=i.slice(),s=t.slice(),l=r.slice();this._combine(e.children[o],s,a,l)}}}]),e}(),H=new function e(){l(this,e),this.isDebug=!1,this.isTesting=!1},j=function(){function e(t){l(this,e),this.url=null,this.isEmpty=!1,this.callbackObjects=[],this.ready=!1,this.texture=null,this.model=null,this.modelName=null,this.modelID=null,this.id=null,this.ext=null,this.baseUrl=null,this.version=null,this.isDefault=!1,this.animations=null,this.isCombine=!1,this.combineBundleObj=null,this.manager=t,this.modelSize=null,this.animations=null,this.tryHightedtVersion=!1,this.debug=!1,this.gltfRoot=null,this.isStartDownload=!1,this.material=null,this.wallMaterial=null,this.roomMaterial=null,this.isSupportHeadAndFootModelWall=!1}return c(e,[{key:"initMaterial",value:function(){this.material=new THREE.MeshStandardMaterial,this.wallMaterial=new THREE.MeshStandardMaterial({color:16777215}),this.isDefault?(this.wallMaterial.defines=this.wallMaterial.defines||{},this.wallMaterial.defines.WALL_AO=!0,this.wallMaterial.metalness=.2,this.wallMaterial.roughness=.8):(this.wallMaterial.metalness=0,this.wallMaterial.roughness=1),this.roomMaterial=new THREE.MeshLambertMaterial({color:16777215}),this.roomMaterial.defines=this.roomMaterial.defines||{},this.roomMaterial.defines.FLOOR_AO=!0}},{key:"registerListener",value:function(e){this.callbackObjects.push(e)}},{key:"requestToDownload",value:function(){this.isStartDownload=!0,this.manager.addResourceDownloadRequest(this)}},{key:"combine",value:function(){this.model&&(this.combineBundleObj=new k(this.model),this.combineBundleObj.combine(),this.combineBundleObj.vertexCount>=6e4?(this.isCombine=!1,console.warn("combine "+this.id+" exceed max vectex")):this.isCombine=!0)}},{key:"hasAnimation",value:function(){return void 0!==this.animations&&(null!==this.animations&&(!Array.isArray(this.animations)||0!==this.animations.length))}},{key:"getTextureUrl",value:function(){return this.baseUrl+this.id+"."+(null===this.ext?"jpg":this.ext)}},{key:"getModelUrl",value:function(){var e=0;return this.manager.enableUserHighestVersionResource||(e=this.version),this.baseUrl+this.id+"/"+e+"/gltf/"}},{key:"downloadTexture",value:function(e){if(this.initMaterial(),H.isTesting)this.downloadTestTexture(e);else{var t=this;if("bundle"===this.ext)return t.ready=!0,console.warn("not support bundle texture"),void e();var i=new THREE.TextureLoader;i.setCrossOrigin("anonymous");var r=null;r=this.url?this.url:this.baseUrl+this.id+"."+(null===this.ext?"jpg":this.ext),i.load(r,function(i){i.wrapS=THREE.RepeatWrapping,i.wrapT=THREE.RepeatWrapping,i.flipY=!0,t.texture=i,t.material.map=i,t.wallMaterial.map=i,t.roomMaterial.map=i,t.ready=!0,t.material.roughness=1,t.debug&&console.log(t.id+" download complete"),t.downloadCallback(e)},function(e){console.log(r+" "+e.loaded/e.total*100+"% loaded")},function(i){t.ready=!0,console.error("download error "+r),t.downloadCallback(e)})}}},{key:"downloadModel",value:function(e){if(H.isTesting)this.downloadTestModel(e);else{var t=this,i=new thingjs.GLTFLoader,r=null,n=0;this.manager.enableUserHighestVersionResource||(n=this.version),r=this.url?this.url:this.baseUrl+this.id+"/"+n+"/gltf/",i.loadFromURL({url:r,modelCallback:function(i){t.animations=i.animations,t.model=i.node,t.ready=!0,t.downloadCallback(e),t.debug&&console.log(t.id+" download complete")},errorCallback:function(){console.error("download error "+r),t.ready=!0,t.model=new THREE.Object3D,t.isEmpty=!0,t.downloadCallback(e)}})}}},{key:"downloadCallback",value:function(e){try{for(var t=0;t<this.callbackObjects.length;t++){this.callbackObjects[t].resourceCallback(this)}e&&e()}catch(e){console.error(e)}}},{key:"downloadTestModel",value:function(e){this.ready=!0;var t=(new THREE.TextureLoader).load("../textures/water.jpg"),i=new THREE.BoxBufferGeometry(200,200,200),r=new THREE.MeshBasicMaterial({map:t});this.model=new THREE.Mesh(i,r),this.modelSize=new THREE.Vector3(1,1,1),this.downloadCallback(e)}},{key:"downloadTestTexture",value:function(e){var t=(new THREE.TextureLoader).load("../textures/water.jpg");t.wrapS=THREE.RepeatWrapping,t.wrapT=THREE.RepeatWrapping,t.repeat.set(4,4),this.texture=t,this.material.map=t,this.wallMaterial.map=t,this.roomMaterial.map=t,this.ready=!0,this.downloadCallback(e)}},{key:"dispose",value:function(){this.texture&&(this.texture.dispose(),this.texture=null),this.model&&(this._disposeModel(this.model),this.model=null),this.combineBundleObj&&(this._disposeModel(this.combineBundleObj),this.combineBundleObj=null),this.wallMaterial&&this.wallMaterial.dispose(),this.roomMaterial&&this.roomMaterial.dispose(),this.material&&this.material.dispose(),this.wallMaterial=null,this.roomMaterial=null,this.material=null,this.animations=null,this.isStartDownload=!1,this.combineBundleObj=null,this.isCombine=!1,this.ready=!1}},{key:"_disposeModel",value:function(e){for(var t=0;t<e.children.length;t++){var i=e.children[t];this._disposeModel(i)}if(e instanceof THREE.Mesh){var r=e.material,n=e.geometry,o=e.material.texture;r&&r.dispose(),n&&n.dispose(),o&&o.dispose()}}},{key:"isModel",get:function(){return null===this.ext}}]),e}(),F=function(e){function t(e){l(this,t);var i=p(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.customTexture=null,i.color=null,i.renderMode=null,i.modelID=null,i}return h(t,j),c(t,[{key:"combine",value:function(){this.model&&(null!==this.customTexture&&this.changeWithCustomTexture(this.model),null!==this.color&&this.changeWithCustomColor(this.model),null!==this.renderMode&&this.changeRenderMode(this.model),this.combineBundleObj=new k(this.model),this.combineBundleObj.combine(),this.isCombine=!0)}},{key:"changeRenderMode",value:function(e){var t=this;e instanceof THREE.Mesh&&(Array.isArray(e.material)?e.material:[e.material]).forEach(function(e){if(e.color=t.color,null!==t.renderMode)switch(t.renderMode){case 1:e.transparent=!1,e.alphaTest=.5;break;case 3:case 2:e.transparent=!0;break;default:console.error("can not find renderMode "+t.renderMode)}});for(var i=0;i<e.children.length;i++){var r=e.children[i];this.changeRenderMode(r)}}},{key:"changeWithCustomColor",value:function(e){var t=this;e instanceof THREE.Mesh&&(Array.isArray(e.material)?e.material:[e.material]).forEach(function(e){e.color=t.color,null!==t.opacity&&(e.opacity=t.opacity,e.transparent=!0)});for(var i=0;i<e.children.length;i++){var r=e.children[i];this.changeWithCustomColor(r)}}},{key:"changeWithCustomTexture",value:function(e){var t=this;e instanceof THREE.Mesh&&(this.customTexture&&this.customTexture.texture&&(this.customTexture.texture.flipY=!1),(Array.isArray(e.material)?e.material:[e.material]).forEach(function(e){e.map=t.customTexture.texture}));for(var i=0;i<e.children.length;i++){var r=e.children[i];this.changeWithCustomTexture(r)}}},{key:"downloadModel",value:function(e){var t=this,i=new thingjs.GLTFLoader,r=null,n=0;this.manager.enableUserHighestVersionResource||(n=this.version),r=this.url?this.url:this.baseUrl+this.modelID+"/"+n+"/gltf/",i.loadFromURL({url:r,modelCallback:function(i){t.model=i.node.children[0],t.animations=i.animations,null!==t.customTexture?t.customTexture.downloadTexture(function(){null!==t.customTexture&&t.changeWithCustomTexture(t.model),null!==t.color&&t.changeWithCustomColor(t.model),null!==t.renderMode&&t.changeRenderMode(t.model),t.ready=!0,t.downloadCallback(e)}):(null!==t.color&&t.changeWithCustomColor(t.model),null!==t.renderMode&&t.changeRenderMode(t.model),t.ready=!0,t.downloadCallback(e))},errorCallback:function(){console.error("download error "+r),t.ready=!0,t.model=new THREE.Object3D,t.isEmpty=!0,t.downloadCallback(e)}})}}]),t}(),D=function(e){function t(e){l(this,t);var i=p(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.customTexture=null,i.color=null,i.renderMode=null,i.modelID=null,i.localBaseUrl=null,i.localUrl=null,i}return h(t,j),c(t,[{key:"combine",value:function(){this.model&&(null!==this.customTexture&&this.changeWithCustomTexture(this.model),null!==this.color&&this.changeWithCustomColor(this.model),null!==this.renderMode&&this.changeRenderMode(this.model),this.combineBundleObj=new k(this.model),this.combineBundleObj.combine(),this.isCombine=!0)}},{key:"changeRenderMode",value:function(e){var t=this,i=this;e instanceof THREE.Mesh&&(Array.isArray(e.material)?e.material:[e.material]).forEach(function(e){if(e.color=t.color,null!==i.renderMode)switch(i.renderMode){case 1:e.transparent=!1,e.alphaTest=.5;break;case 3:case 2:e.transparent=!0;break;default:console.error("can not find renderMode "+t.renderMode)}});for(var r=0;r<e.children.length;r++){var n=e.children[r];this.changeRenderMode(n)}}},{key:"changeWithCustomColor",value:function(e){var t=this;e instanceof THREE.Mesh&&(Array.isArray(e.material)?e.material:[e.material]).forEach(function(e){e.color=t.color,null!==t.opacity&&(e.opacity=t.opacity,e.transparent=!0)});for(var i=0;i<e.children.length;i++){var r=e.children[i];this.changeWithCustomColor(r)}}},{key:"changeWithCustomTexture",value:function(e){var t=this;e instanceof THREE.Mesh&&(this.customTexture&&this.customTexture.texture&&(this.customTexture.texture.flipY=!1),(Array.isArray(e.material)?e.material:[e.material]).forEach(function(e){e.map=t.customTexture.texture}));for(var i=0;i<e.children.length;i++){var r=e.children[i];this.changeWithCustomTexture(r)}}},{key:"downloadModel",value:function(e){var t=this,i=(new THREE.FileLoader,null);this.localUrl?(i=this.localBaseUrl+this.localUrl,(new thingjs.GLTFLoader).load(i,function(i){t.model=i.scene,t.animations=i.animations;var r=new THREE.Box3;r.makeEmpty(),r=r.setFromObject(t.model),t.modelSize=r.getSize(new THREE.Vector3),null!==t.customTexture?t.customTexture.downloadTexture(function(){null!==t.customTexture&&t.changeWithCustomTexture(t.model),null!==t.color&&t.changeWithCustomColor(t.model),null!==t.renderMode&&t.changeRenderMode(t.model),t.ready=!0,t.downloadCallback(e)}):(null!==t.color&&t.changeWithCustomColor(t.model),null!==t.renderMode&&t.changeRenderMode(t.model),t.ready=!0,t.downloadCallback(e))},void 0,function(r){console.error("download error "+i+"  "+r),t.ready=!0,t.model=new THREE.Object3D,t.isEmpty=!0,t.downloadCallback(e)})):console.error("can not find url")}}]),t}(),B=function(e){function t(e){l(this,t);var i=p(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.localBaseUrl=null,i.localUrl=null,i}return h(t,j),c(t,[{key:"registerListener",value:function(e){this.callbackObjects.push(e)}},{key:"downloadTexture",value:function(e){this.initMaterial();var t=this;if("bundle"===this.ext)return t.ready=!0,console.warn("not support bundle texture"),void e();var i=new THREE.TextureLoader;i.setCrossOrigin("anonymous");var r=null;this.localUrl?(r=this.localBaseUrl+this.localUrl,i.load(r,function(i){i.wrapS=THREE.RepeatWrapping,i.wrapT=THREE.RepeatWrapping,i.flipY=!0,t.texture=i,t.material.map=i,t.wallMaterial.map=i,t.roomMaterial.map=i,t.ready=!0,t.material.roughness=1,t.debug&&console.log(t.id+" download complete"),t.downloadCallback(e)},function(e){console.log(r+" "+e.loaded/e.total*100+"% loaded")},function(i){t.ready=!0,console.error("download error "+r),t.downloadCallback(e)})):console.error("can not find url")}}]),t}(),I=function(){function e(){l(this,e),this.textures=[],this.models=[],this.baseTextureUrl="https://static.3dmomoda.com/textures/",this.baseModelUrl="https://model.3dmomoda.com/models/",this.localCustomModelBaseUrl=null,this.wallTextures=[],this.wallModels=[],this.roomTextures=[],this.commonTextures=[],this.doorOrWindowModels=[],this.placementModels=[],this.isStartedDonwloadResouces=!1,this.allResouces=[],this.curDonwloadResIndex=-1,this.alreadyResouceCount=0,this.downloadResMaxCount=10,this.downloadResCompleteCallback=null,this.delayDownload=!1,this.resourceMap={},this.downloadResProgess=0,this.opacity=null,this.currentDownloadResMap=new Map,this.enableUserHighestVersionResource=y.enableUseHighestVersionResource,this.requestDownloadResources=[],this.ableToSupportFootAndHeadModelWalls=y.ableToSupportFootAndHeadModelWalls,this.initLightMaps(),this.emptyTextureResource=null,this.emptyModelResource=null,this.createEmptyModelResource(),this.createEmptyTextureResource()}return c(e,[{key:"addCommonTextureResource",value:function(e){this._addResource(e,this.commonTextures)}},{key:"addWallTextureResource",value:function(e){for(var t=0;t<this.wallTextures.length;t++){if(this.wallTextures[t].id===e.id)return}this.wallTextures.push(e)}},{key:"addWallModelResource",value:function(e){for(var t=0;t<this.wallModels.length;t++){if(this.wallModels[t].id===e.id)return}this.wallModels.push(e)}},{key:"addPlacementResource",value:function(e){this._addResource(e,this.placementModels)}},{key:"addRoomResource",value:function(e){this._addResource(e,this.roomTextures)}},{key:"_addResource",value:function(e,t){for(var i=0;i<t.length;i++){if(t[i].id===e.id)return}t.push(e)}},{key:"checkAllResourcesIsReady",value:function(){for(var e=0;e<this.textures.length;e++){var t=this.textures[e];if(!t.ready)return console.log(t.url),!1}for(e=0;e<this.models.length;e++){var i=this.models[e];if(!i.ready)return console.log(i.url),!1}return!0}},{key:"resourceCallback",value:function(){this.alreadyResouceCount++,this.alreadyResouceCount===this.downloadResMaxCount&&this.downloadResources()}},{key:"initLightMaps",value:function(){var e=null;y.enableManaulWallLightMap&&((e=new j(this)).baseUrl=this.baseTextureUrl,e.id="18091219l1g1hnjt",e.ext="png",f.wallLightMapResource=e),y.enableFloorLightMap&&((e=new j(this)).baseUrl=this.baseTextureUrl,e.id="18091216vjlgtwbh",e.ext="jpg",f.floorLightMapResource=e)}},{key:"downloadResources",value:function(e){var t=this;if(this.isStartedDonwloadResouces){if(this.curDonwloadResIndex===this.allResouces.length-1)return this.downloadResProgess=1,void e()}else{var i=[];this.downloadResProgess=0,i=i.concat(this.wallTextures).concat(this.wallModels).concat(this.roomTextures).concat(this.doorOrWindowModels).concat(this.placementModels).concat(this.commonTextures),this.allResouces=i,this.isStartedDonwloadResouces=!0,this.curDonwloadResIndex=0}if(0===this.allResouces.length)return this.downloadResProgess=1,void e();for(var r=0,n=[],o=this.curDonwloadResIndex;o<this.allResouces.length;o++,r++){var a=this.allResouces[o];if(null===a.ext){var s=new Promise(function(e,t){a.downloadModel(function(){e()})});n.push(s)}else{s=new Promise(function(e,t){a.downloadTexture(function(){e()})});n.push(s)}if(this.curDonwloadResIndex++,r===this.downloadResMaxCount){this.curDonwloadResIndex=o;break}o===this.allResouces.length-1&&(this.curDonwloadResIndex=o)}Promise.all(n).then(function(){t.downloadResProgess=t.curDonwloadResIndex/(t.allResouces.length-1),t.downloadResources(e)}).catch(function(e){console.log(e)})}},{key:"downloadResourcesWithQueue",value:function(e){var t=this;if(0!==t.allResouces.length&&(this.downloadResProgess=(this.curDonwloadResIndex-this.currentDownloadResMap.size)/t.allResouces.length),this.isStartedDonwloadResouces){if(this.curDonwloadResIndex===this.allResouces.length&&0===this.currentDownloadResMap.size)return this.downloadResProgess=1,void e()}else{var i=[];this.downloadResProgess=0,i=y.enableCombine?i.concat(this.wallTextures).concat(this.wallModels).concat(this.roomTextures).concat(this.doorOrWindowModels).concat(this.placementModels).concat(this.commonTextures):i.concat(this.textures).concat(this.models),this.allResouces=i,this.isStartedDonwloadResouces=!0,this.curDonwloadResIndex=0,this.currentDownloadResMap=new Map}if(0===this.allResouces.length)return this.downloadResProgess=1,void e();if(!(this.curDonwloadResIndex>this.allResouces.length-1)&&0!==this.downloadResMaxCount-this.currentDownloadResMap.size){var r=this.allResouces[this.curDonwloadResIndex];if(null===r.ext)new Promise(function(e,t){r.downloadModel(function(){e(r)})}).then(function(i){t.currentDownloadResMap.delete(i.id),t.downloadResourcesWithQueue(e)}),this.currentDownloadResMap.set(r.id,r);else new Promise(function(e,t){r.downloadTexture(function(){e(r)})}).then(function(i){t.currentDownloadResMap.delete(i.id),t.downloadResourcesWithQueue(e)}),this.currentDownloadResMap.set(r.id,r);this.curDonwloadResIndex++,this.downloadResourcesWithQueue(e)}}},{key:"downloadSplitSceneResourcesWithQueue",value:function(e){this.downloadResourcesWithQueue(e)}},{key:"resetDownloadResources",value:function(){this.allResouces=[],this.wallTextures=[],this.wallModels=[],this.roomTextures=[],this.doorOrWindowModels=[],this.placementModels=[],this.commonTextures=[],this.isStartedDonwloadResouces=!1}},{key:"loadTextures",value:function(e){for(var t=null,i=0;i<e.length;i++){var r=e[i];t=r.localurl?this._loadLocalCustomTextureResource(r):this._loadTextureResource(r),this.textures.push(t),this.delayDownload||t.downloadTexture()}}},{key:"_loadLocalCustomTextureResource",value:function(e){var t=new B(this);return t.localUrl=e.localurl,t.localBaseUrl=this.localCustomModelBaseUrl,this._loadBaseTextureResourceData(e,t),t}},{key:"_loadTextureResource",value:function(e){var t=new j(this);return this._loadBaseTextureResourceData(e,t),t}},{key:"_loadBaseTextureResourceData",value:function(e,t){t.id=e.id,t.ext=e.ext,e.url&&(t.url=e.url),t.baseUrl=this.baseTextureUrl,e.isDefault&&(t.isDefault=e.isDefault)}},{key:"loadModels",value:function(e){for(var t=null,i=0;i<e.length;i++){var r=e[i];if((t=r.model?new F(this):r.localurl?new D(this):new j(this)).baseUrl=this.baseModelUrl,r.localurl){if(t.localUrl=r.localurl,t.id=r.id,t.localBaseUrl=this.localCustomModelBaseUrl,r.title&&(t.modelName=r.title),t.modelID=r.id,null!==r.texture&&void 0!==r.texture&&(t.customTexture=this.textures[r.texture]),r.rendermode&&(t.renderMode=r.rendermode),r.color){var n=r.color;t.color=new THREE.Color(n[0],n[1],n[2]),4===n.length&&(t.opacity=n[3])}}else if(r.id){if(t.id=r.id,t.modelID=r.id,t.version=r.version,null!==r.texture&&void 0!==r.texture&&(t.customTexture=this.textures[r.texture]),r.rendermode&&(t.renderMode=r.rendermode),r.model&&(t.modelID=r.model),r.title&&(t.modelName=r.title),r.color){n=r.color;t.color=new THREE.Color(n[0],n[1],n[2]),4===n.length&&(t.opacity=n[3])}if(r.size){var o=r.size;t.modelSize=new THREE.Vector3(o[0],o[1],o[2])}r.hasanimation&&(t.hasAnim=r.hasanimation),r.url&&(t.url=r.url)}for(var a=0;a<this.ableToSupportFootAndHeadModelWalls.length;a++){var s=this.ableToSupportFootAndHeadModelWalls[a];if(t.id===s){t.isSupportHeadAndFootModelWall=!0;break}}this.models.push(t),this.delayDownload||t.downloadModel()}}},{key:"loadCustomModelResource",value:function(e,t){this.loadBaseResourceData(e,t),e.localurl&&(t.localUrl=e.localurl,t.localBaseUrl=this.localCustomModelBaseUrl,null!==e.texture&&void 0!==e.texture&&(t.customTexture=this.textures[e.texture]))}},{key:"loadCustomResource",value:function(e,t){this.loadBaseResourceData(e,t)}},{key:"loadBaseResourceData",value:function(e,t){if(t.id=e.id,t.modelID=e.id,t.version=e.version,null!==e.texture&&void 0!==e.texture&&(t.customTexture=this.textures[e.texture]),e.rendermode&&(t.renderMode=e.rendermode),e.model&&(t.modelID=e.model),e.title&&(t.modelName=e.title),e.color){var i=e.color;t.color=new THREE.Color(i[0],i[1],i[2]),4===i.length&&(t.opacity=i[3])}if(e.size){var r=e.size;t.modelSize=new THREE.Vector3(r[0],r[1],r[2])}e.hasanimation&&(t.hasAnim=e.hasanimation)}},{key:"disposeModels",value:function(){for(var e=0;e<this.models.length;e++){this.models[e].dispose()}}},{key:"disposeTextures",value:function(){for(var e=0;e<this.textures.length;e++){this.textures[e].dispose()}}},{key:"addResourceDownloadRequest",value:function(e){this.requestDownloadResources.push(e)}},{key:"startToDownloadRequestResources",value:function(e){var t=this;if(0!==t.requestDownloadResources.length&&(this.downloadResProgess=(this.curDonwloadResIndex-this.currentDownloadResMap.size)/t.requestDownloadResources.length,e&&e(this.downloadResProgess)),this.isStartedDonwloadResouces){if(this.curDonwloadResIndex===this.requestDownloadResources.length&&0===this.currentDownloadResMap.size)return this.downloadResProgess=1,void(e&&e(this.downloadResProgess))}else{t.requestDownloadResources;this.isStartedDonwloadResouces=!0,this.curDonwloadResIndex=0,this.currentDownloadResMap=new Map}if(0===this.requestDownloadResources.length)return this.downloadResProgess=1,void(e&&e(this.downloadResProgess));if(!(this.curDonwloadResIndex>this.requestDownloadResources.length-1)&&0!==this.downloadResMaxCount-this.currentDownloadResMap.size){var i=this.requestDownloadResources[this.curDonwloadResIndex];if(null===i.ext)new Promise(function(e,t){i.downloadModel(function(){e(i)})}).then(function(i){t.currentDownloadResMap.delete(i.id),t.startToDownloadRequestResources(e)}),this.currentDownloadResMap.set(i.id,i);else new Promise(function(e,t){i.downloadTexture(function(){e(i)})}).then(function(i){t.currentDownloadResMap.delete(i.id),t.startToDownloadRequestResources(e)}),this.currentDownloadResMap.set(i.id,i);this.curDonwloadResIndex++,this.startToDownloadRequestResources(e)}}},{key:"createEmptyTextureResource",value:function(){this.emptyTextureResource=new j,this.emptyTextureResource.ready=!0,this.emptyTextureResource.texture=new THREE.Texture,this.emptyTextureResource.isEmpty=!0}},{key:"createEmptyModelResource",value:function(){this.emptyModelResource=new j,this.emptyModelResource.ready=!0,this.emptyModelResource.model=new THREE.Object3D,this.emptyModelResource.isEmpty=!0}}]),e}(),N=function(e){function t(){l(this,t);var e=p(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.resource=null,e.model=null,e.objPositions=[],e.objLocalPositions=[],e.objRotations=[],e.objScales=[],e.modelSize=new THREE.Vector3,e.box=new THREE.Box3,e.heightRatio=1,e.modelNumber=-1,e.models=[],e.mesh=new THREE.Object3D,e.wallGroup=e.mesh,e.subWalls=[],e.subCorners=[],e}return h(t,v),c(t,[{key:"build",value:function(){this.baseBuild(),this.resource&&(this.resource.ready||y.enableCombine?this.model=this.resource.model:this.resource.registerListener(this)),null!==this.resource.model&&(this.calObjInfo(),this.instanceModels())}},{key:"resourceCallback",value:function(e){this.model=e.model,this.calObjInfo(),this.instanceModels()}},{key:"instanceModels",value:function(){if(null!==this.model){this.models=[];for(var e=this.modelNumber,t=0;t<e;t++){var i=this.model.clone(),r=this.objPositions[t],n=this.objRotations[t],o=this.objScales[t];i.position.set(r.x,r.y,r.z),i.quaternion.set(n.x,n.y,n.z,n.w),i.scale.set(o.x,o.y,o.z),this.mesh.add(i),this.models.push(i)}}}},{key:"calObjInfo",value:function(){if(this.objPositions=[],this.objRotations=[],this.objScales=[],null!==this.resource.model){this.modelSize=this.resource.modelSize,-1===this.height?this.height=this.modelSize.y:0!==this.modelSize.y?this.heightRatio=this.height/this.modelSize.y:(console.warn("model size is zero "+this.resource.id),this.height=3);var e=new THREE.Vector3(0,-1,0),t=this.modelSize.x,i=(this.modelSize.z,this.modelSize.y),r=this.length/t,n=parseInt(r),o=Math.ceil(r);this.modelNumber=o;var a=o*t,s=new THREE.Vector3,l=this.direction.clone();s.addVectors(this.startCorner.position,l.multiplyScalar(a));var c=new THREE.Vector3;c.crossVectors(this.direction,e),c.normalize();var u=new THREE.Quaternion;0===c.x&&0===c.y&&0===c.z||u.setFromUnitVectors(new THREE.Vector3(0,0,-1),c);var h=.5*t,p=new THREE.Vector3(h,0,0);this.position;p.applyQuaternion(u),u.multiply(new THREE.Quaternion(0,1,0,0));for(var d=0;d<o;d++){var f=d/o,m=new THREE.Vector3;m.lerpVectors(this.startCorner.position,s,f);var g=new THREE.Vector3;g.addVectors(p,m),g.y+=this.suspend,this.objPositions.push(g),this.objRotations.push(u);var v=new THREE.Vector3(1,this.height/i,1);this.objScales.push(v)}var y=(r-n)*t,b=y/t;if(o>0&&y>0){this.objScales[o-1]=new THREE.Vector3(b,this.height/i,1);var _=h,x=new THREE.Vector3(_*(1-b),0,0);x.applyQuaternion(u),this.objPositions[o-1].add(x),this.objPositions[o-1].y=this.suspend}}}}]),t}(),U=function(e){function t(){l(this,t);var e=p(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.resource=null,e.model=null,e.objPositions=[],e.objLocalPositions=[],e.objRotations=[],e.objScales=[],e.modelSize=new THREE.Vector3,e.box=new THREE.Box3,e.heightRatio=1,e.modelNumber=-1,e.models=[],e.mesh=new THREE.Object3D,e.wallGroup=e.mesh,e.subWalls=[],e.subCorners=[],e.isContainer=!1,e}return h(t,v),c(t,[{key:"build",value:function(){if(!this.isBuilded){if(!this.checkResourceReady())return void this.initResource(this.resource);if(this.doorOrWindows.length>0){this.baseBuild(),this.initSimpleCornersAndWalls(),this.mesh=new THREE.Object3D;for(var e=0;e<this.subWalls.length;e++){var t=this.subWalls[e];t.build(),this.mesh.add(t.mesh),this.wallGroup=this.mesh}}else this.baseBuild(),this.calObjInfo(),this.instanceModels();this.processWhenBuildFinish()}}},{key:"resourceCallback",value:function(e){this.model=e.model,this.build()}},{key:"instanceModels",value:function(){if(null!==this.model){this.models=[];for(var e=this.modelNumber,t=0;t<e;t++){var i=this.model.clone(),r=this.objPositions[t],n=this.objRotations[t],o=this.objScales[t];i.position.set(r.x,r.y,r.z),i.quaternion.set(n.x,n.y,n.z,n.w),i.scale.set(o.x,o.y,o.z),this.mesh.add(i),this.models.push(i)}}}},{key:"calObjInfo",value:function(){if(this.objPositions=[],this.objRotations=[],this.objScales=[],null!==this.resource.model){this.modelSize=this.resource.modelSize,-1===this.height?this.height=this.modelSize.y:0!==this.modelSize.y?this.heightRatio=this.height/this.modelSize.y:(console.warn("model size is zero "+this.resource.id),this.height=3);var e=new THREE.Vector3(0,-1,0),t=this.modelSize.x,i=(this.modelSize.z,this.modelSize.y),r=this.length/t,n=parseInt(r),o=Math.ceil(r);this.modelNumber=o;var a=o*t,s=new THREE.Vector3,l=this.direction.clone();s.addVectors(this.startCorner.position,l.multiplyScalar(a));var c=new THREE.Vector3;c.crossVectors(this.direction,e),c.normalize();var u=new THREE.Quaternion;0===c.x&&0===c.y&&0===c.z||u.setFromUnitVectors(new THREE.Vector3(0,0,-1),c);var h=.5*t,p=new THREE.Vector3(h,0,0);this.position;p.applyQuaternion(u),u.multiply(new THREE.Quaternion(0,1,0,0));for(var d=0;d<o;d++){var f=d/o,m=new THREE.Vector3;m.lerpVectors(this.startCorner.position,s,f);var g=new THREE.Vector3;g.addVectors(p,m),this.objPositions.push(g),this.objRotations.push(u);var v=new THREE.Vector3(1,this.height/i,1);this.objScales.push(v)}var y=(r-n)*t,b=y/t;if(o>0&&y>0){this.objScales[o-1]=new THREE.Vector3(b,this.height/i,1);var _=h,x=new THREE.Vector3(_*(1-b),0,0);x.applyQuaternion(u),this.objPositions[o-1].add(x)}}}},{key:"initSimpleCornersAndWalls",value:function(){for(var e=this.sortDoorOrWins(),t=0;t<e.length;t++){var i=e[t],r=this.getDoorOrWinStartAndEndPos(i),n=E.createSubWallCorner(this.id+"_"+t+"_1",r[0],this),o=E.createSubWallCorner(this.id+"_"+t+"_2",r[1],this);if(this.addSubWallCorner(n),this.addSubWallCorner(o),0===t){var a=new N;a.resource=this.resource,this.subWalls.push(a),a.startCorner=this.startCorner,a.endCorner=n,a.startCorner.build(),a.endCorner.build(),a.parentWall=this,a.height=this.height}else{var s=e[t-1],l=this.getDoorOrWinStartAndEndPos(s),c=this.getWallCornerByPos(l[1]),u=new N;u.resource=this.resource,this.subWalls.push(u),u.startCorner=c,u.endCorner=n,u.startCorner.build(),u.endCorner.build(),u.parentWall=this,u.height=this.height}if(t===e.length-1){var h=new N;h.resource=this.resource,this.subWalls.push(h),h.startCorner=o,h.endCorner=this.endCorner,h.startCorner.build(),h.parentWall=this,h.height=this.height}this.buildHeadAndFootWall(i,n,o)}}},{key:"buildSimpleCornersAndWalls",value:function(){this.wallGroup=new THREE.Object3D;for(var e=0;e<this.subCorners.length;e++){this.subCorners[e].build()}for(e=0;e<this.subWalls.length;e++){var t=this.subWalls[e];t.build(),this.wallGroup.add(t.wallGroup)}}},{key:"buildHeadAndFootWall",value:function(e,t,i){if(!this.resource.isSupportHeadAndFootModelWall)return!1;var r=e.suspendPercent;if(0!==r){var n=new N;this.subWalls.push(n),n.resource=this.resource,n.parentWall=this,n.startCorner=t,n.endCorner=i,n.height=this.height*r}e.size;var o=e.size.y+this.height*r;if(o<this.height){var a=new N;this.subWalls.push(a),a.resource=this.resource,a.parentWall=this,a.startCorner=t,a.endCorner=i,a.suspend=o,a.height=this.height-o}}},{key:"addToParentCollector",value:function(){this.parent.walls.push(this)}},{key:"clear",value:function(){u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this);for(var e=0;e<this.models.length;e++){var i=this.models[e];this._dispose(i)}this.models=[]}}]),t}(),V=function(e){function t(){l(this,t);var e=p(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.resource=null,e.model=null,e.customColor=null,e.opacity=null,e.renderMode=null,e.initCompleteCallback=null,e.customTextureResource=null,e.hasSkin=!1,e.isPlayAnim=!1,e.animClip=null,e.isResouceRegistered=!1,e.belongRoomUserID=null,e._size=null,e}return h(t,g),c(t,[{key:"createMesh",value:function(){this.instanceModel()}},{key:"instanceModel",value:function(){this.mesh=m.clone(this.resource.model),this.hasSkin=this.mesh.hasSkin,this.mesh.name="placement",this.mesh.position.set(this.position.x,this.position.y,this.position.z),this.mesh.quaternion.set(this.rotation.x,this.rotation.y,this.rotation.z,this.rotation.w),this.mesh.scale.set(this.scale.x,this.scale.y,this.scale.z),this.mesh.visible=this.isShow,this.mesh.name="plc"+this.id,null!==this.renderMode&&this.changeRenderMode(this.mesh),this.customTextureResource&&this.changeWithCustomTexture(this.mesh),this.customColor&&this.changeWithCustomColor(this.mesh)}},{key:"changeRenderMode",value:function(e){if(e instanceof THREE.Mesh&&(e.material.color=this.customColor,null!==this.renderMode))switch(this.renderMode){case 1:e.material.transparent=!1,e.material.alphaTest=.5;break;case 3:case 2:e.material.transparent=!0;break;default:console.error("can not find renderMode "+this.renderMode)}for(var t=0;t<e.children.length;t++){var i=e.children[t];this.changeRenderMode(i)}}},{key:"changeWithCustomColor",value:function(e){e instanceof THREE.Mesh&&(e.material.color=this.customColor,null!==this.opacity&&(e.material.opacity=this.opacity,e.material.transparent=!0));for(var t=0;t<e.children.length;t++){var i=e.children[t];this.changeWithCustomColor(i)}}},{key:"changeWithCustomTexture",value:function(e){e instanceof THREE.Mesh&&(e.material.map=this.customTextureResource.texture);for(var t=0;t<e.children.length;t++){var i=e.children[t];this.changeWithCustomTexture(i)}}},{key:"addToParentCollector",value:function(){u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addToParentCollector",this).call(this),this.parent.placements.push(this)}},{key:"isMultiResources",get:function(){return this.customTextureResource?this._isMultiResources=!0:this._isMultiResources=!1,this._isMultiResources}},{key:"resources",get:function(){return[this.resource,this.customTextureResource]}}]),t}(),z=function(e){function t(){l(this,t);var e=p(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.resource=null,e.groups=[],e.placements=[],e.belongRoomUserID=null,e._size=new THREE.Vector3,e._isMultiResources=!0,e.isContainer=!0,e}return h(t,g),c(t,[{key:"build",value:function(){if(!this.isBuilded){if(!this.checkChildrenResourcesReady())return void this.initChildrenResource();this.createMesh(),this.processWhenBuildFinish()}}},{key:"createMesh",value:function(){for(var e=0;e<this.groups.length;e++){var t=this.groups[e];t.build(),this.mesh.add(t.mesh)}for(e=0;e<this.placements.length;e++){var i=this.placements[e];i.build(),this.mesh.add(i.mesh)}this.mesh.position.set(this.position.x,this.position.y,this.position.z),this.mesh.quaternion.set(this.rotation.x,this.rotation.y,this.rotation.z,this.rotation.w),this.mesh.scale.set(this.scale.x,this.scale.y,this.scale.z)}},{key:"collectChildrenResources",value:function(){this._childrenResources=[];for(var e=0;e<this.placements.length;e++){var t=this.placements[e];this._checkResourceRepeat(t.resource)||this._childrenResources.push(t.resource)}for(var i=0;i<this.groups.length;i++){var r=this.groups[i];r.collectChildrenResources();for(var n=0;n<r.childrenResources.length;n++){var o=r.childrenResources[n];this._checkResourceRepeat(o)||this._childrenResources.push(o)}}}},{key:"_checkResourceRepeat",value:function(e){for(var t=0;t<this.childrenResources.length;t++){if(this.childrenResources[t]===e)return!0}return!1}},{key:"checkChildrenResourcesReady",value:function(){for(var e=0;e<this.childrenResources.length;e++){if(!this.childrenResources[e].ready)return!1}return!0}},{key:"initChildrenResource",value:function(){for(var e=0;e<this.childrenResources.length;e++){var t=this.childrenResources[e];this.initResource(t)}}},{key:"resourceCallback",value:function(e){this.checkChildrenResourcesReady()&&this.build()}},{key:"addToParentCollector",value:function(){u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addToParentCollector",this).call(this),this.parent.groups.push(this)}},{key:"belongRoomUserID",set:function(e){this._belongRoomUserID=e;for(var t=0;t<this.placements.length;t++){this.placements[t].belongRoomUserID=e}for(var i=0;i<this.groups.length;i++){this.groups[i].belongRoomUserID=e}},get:function(){return this._belongRoomUserID}},{key:"children",get:function(){return null===this._children&&(this._children=[],this._children=this._children.concat(this.groups).concat(this.placements)),this._children}},{key:"size",get:function(){return this.boundingBox.getSize(this._size)}},{key:"boundingBox",get:function(){if(null===this._boundingBox){this._boundingBox=new THREE.Box3;for(var e=0;e<this.placements.length;e++){var t=this.placements[e].boundingBox;this._boundingBox.expandByPoint(t.min),this._boundingBox.expandByPoint(t.max)}for(var i=0;i<this.groups.length;i++){var r=this.groups[i].boundingBox;this._boundingBox.expandByPoint(r.min),this._boundingBox.expandByPoint(r.max)}}return this._boundingBox}},{key:"resources",get:function(){return this.childrenResources}}]),t}(),q=function(e){function t(){l(this,t);var e=p(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.suspendPercent=0,e.attachWall=null,e.isOpen=!1,e.openDirIndex=0,e.modelSize=null,e.isWindow=!1,e}return h(t,V),c(t,[{key:"build",value:function(){if(!this.isBuilded){if(!this.checkResourceReady())return void this.initResource(this.resource);this.initModelSize(),this.fitAttachWall(),this.instanceModel(),this.processWhenBuildFinish()}}},{key:"resourceCallback",value:function(e){this.build()}},{key:"fitAttachWall",value:function(){if(this.attachWall){var e=this.attachWall.direction,t=new THREE.Vector3;t.crossVectors(new THREE.Vector3(0,-1,0),e),this.rotation.setFromUnitVectors(new THREE.Vector3(0,0,-1),t),this.changeOpenDirection(),this.position.y=this.attachWall.height*this.suspendPercent}}},{key:"changeOpenDirection",value:function(){var e;1!==this.openDirIndex&&3!==this.openDirIndex||(this.resource.hasAnimation()||((e=new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI),this.rotation.multiply(e)));0!==this.openDirIndex&&2!==this.openDirIndex||this.resource.hasAnimation()&&((e=new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI),this.rotation.multiply(e))}},{key:"initModelSize",value:function(){this.modelSize=this.resource.modelSize,this.resource.model&&this.size.set(this.modelSize.x*this.scale.x,this.modelSize.y*this.scale.y,this.modelSize.z*this.scale.z)}},{key:"addToParentCollector",value:function(){this.parent.doorOrWindows.push(this)}}]),t}(),W=function(e){function t(){return l(this,t),p(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return h(t,z),c(t,[{key:"build",value:function(){u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"build",this).call(this)}},{key:"addToParentCollector",value:function(){var e=this.parent;e instanceof P?e.facadeGroups.push(this):e.groups.push(this)}}]),t}(),G=function(e){function t(){return l(this,t),p(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return h(t,V),c(t,[{key:"build",value:function(){u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"build",this).call(this)}},{key:"addToParentCollector",value:function(){this.parent instanceof W?this.parent.placements.push(this):this.parent.facades.push(this)}}]),t}(),X=function(e){function t(){l(this,t);var e=p(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.points=[],e.resource=null,e.color=null,e.mesh=null,e.texture=null,e.initCompleteCallback=null,e.width=null,e}return h(t,g),c(t,[{key:"initResource",value:function(){this.resource&&(this.resource.ready?this.texture=this.resource.texture:this.resource.registerListener(this))}},{key:"resourceCallback",value:function(e){this.mesh||(this.texture=e.texture,this.initCompleteCallback&&this.initCompleteCallback(this))}}]),t}(),Y=function(e){function t(){l(this,t);var e=p(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.points=[],e.resource=null,e.color=new THREE.Color(0,0,1),e.mesh=null,e.texture=null,e.initCompleteCallback=null,e.renderMode=null,e.opacity=null,e.radius=null,e.sectionType=null,e}return h(t,g),c(t,[{key:"initResource",value:function(){this.resource&&(this.resource.ready?this.texture=this.resource.texture:this.resource.registerListener(this))}},{key:"resourceCallback",value:function(e){this.mesh||(this.texture=e.texture,this.initCompleteCallback&&this.initCompleteCallback(this))}}]),t}(),Q=function(e){function t(){l(this,t);var e=p(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.text=null,e.color=null,e.font=null,e.opacity=null,e.mesh=null,e}return h(t,g),c(t,[{key:"build",value:function(){var e=new THREE.TextGeometry(this.text,{font:t.getFont(),size:80,height:1,curveSegments:2});e.computeBoundingBox();var i=-.5*(e.boundingBox.max.x-e.boundingBox.min.x),r=[new THREE.MeshBasicMaterial({color:16777215*Math.random(),overdraw:.5}),new THREE.MeshBasicMaterial({color:0,overdraw:.5})],n=new THREE.Mesh(e,r);n.position.x=i,n.position.y=100,n.position.z=0,n.rotation.x=0,n.rotation.y=2*Math.PI,this.mesh=n}}],[{key:"getFont",value:function(){return t.font?t.font:new THREE.Font({glyphs:{"":{x_min:0,x_max:712,ha:815,o:"m 356 -25 q 96 88 192 -25 q 0 368 0 201 q 92 642 0 533 q 356 761 192 761 q 617 644 517 761 q 712 368 712 533 q 619 91 712 201 q 356 -25 520 -25 m 356 85 q 527 175 465 85 q 583 369 583 255 q 528 562 583 484 q 356 651 466 651 q 189 560 250 651 q 135 369 135 481 q 187 177 135 257 q 356 85 250 85 "},S:{x_min:0,x_max:788,ha:890,o:"m 788 291 q 662 54 788 144 q 397 -26 550 -26 q 116 68 226 -26 q 0 337 0 168 l 131 337 q 200 152 131 220 q 384 85 269 85 q 557 129 479 85 q 650 270 650 183 q 490 429 650 379 q 194 513 341 470 q 33 739 33 584 q 142 964 33 881 q 388 1041 242 1041 q 644 957 543 1041 q 756 716 756 867 l 625 716 q 561 874 625 816 q 395 933 497 933 q 243 891 309 933 q 164 759 164 841 q 325 609 164 656 q 625 526 475 568 q 788 291 788 454 "},"":{x_min:343,x_max:449,ha:792,o:"m 449 462 l 343 462 l 343 986 l 449 986 l 449 462 m 449 -242 l 343 -242 l 343 280 l 449 280 l 449 -242 "},"/":{x_min:183.25,x_max:608.328125,ha:792,o:"m 608 1041 l 266 -129 l 183 -129 l 520 1041 l 608 1041 "},"":{x_min:-.4375,x_max:777.453125,ha:839,o:"m 777 893 l 458 893 l 458 0 l 319 0 l 319 892 l 0 892 l 0 1013 l 777 1013 l 777 893 "},y:{x_min:0,x_max:684.78125,ha:771,o:"m 684 738 l 388 -83 q 311 -216 356 -167 q 173 -279 252 -279 q 97 -266 133 -279 l 97 -149 q 132 -155 109 -151 q 168 -160 155 -160 q 240 -114 213 -160 q 274 -26 248 -98 l 0 738 l 137 737 l 341 139 l 548 737 l 684 738 "},"":{x_min:0,x_max:803,ha:917,o:"m 803 0 l 667 0 l 667 886 l 140 886 l 140 0 l 0 0 l 0 1012 l 803 1012 l 803 0 "},"":{x_min:-111,x_max:339,ha:361,o:"m 339 800 l 229 800 l 229 925 l 339 925 l 339 800 m -1 800 l -111 800 l -111 925 l -1 925 l -1 800 m 284 3 q 233 -10 258 -5 q 182 -15 207 -15 q 85 26 119 -15 q 42 200 42 79 l 42 737 l 167 737 l 168 215 q 172 141 168 157 q 226 101 183 101 q 248 103 239 101 q 284 112 257 104 l 284 3 m 302 1040 l 113 819 l 30 819 l 165 1040 l 302 1040 "},g:{x_min:0,x_max:686,ha:838,o:"m 686 34 q 586 -213 686 -121 q 331 -306 487 -306 q 131 -252 216 -306 q 31 -84 31 -190 l 155 -84 q 228 -174 166 -138 q 345 -207 284 -207 q 514 -109 454 -207 q 564 89 564 -27 q 461 6 521 36 q 335 -23 401 -23 q 88 100 184 -23 q 0 370 0 215 q 87 634 0 522 q 330 758 183 758 q 457 728 398 758 q 564 644 515 699 l 564 737 l 686 737 l 686 34 m 582 367 q 529 560 582 481 q 358 652 468 652 q 189 561 250 652 q 135 369 135 482 q 189 176 135 255 q 361 85 251 85 q 529 176 468 85 q 582 367 582 255 "},"":{x_min:0,x_max:442,ha:539,o:"m 442 383 l 0 383 q 91 566 0 492 q 260 668 176 617 q 354 798 354 727 q 315 875 354 845 q 227 905 277 905 q 136 869 173 905 q 99 761 99 833 l 14 761 q 82 922 14 864 q 232 974 141 974 q 379 926 316 974 q 442 797 442 878 q 351 635 442 704 q 183 539 321 611 q 92 455 92 491 l 442 455 l 442 383 "},"":{x_min:0,x_max:705.5625,ha:803,o:"m 705 334 l 0 334 l 0 410 l 705 410 l 705 334 "},"":{x_min:0,x_max:819.5625,ha:893,o:"m 819 0 l 650 0 l 294 509 l 139 356 l 139 0 l 0 0 l 0 1013 l 139 1013 l 139 526 l 626 1013 l 809 1013 l 395 600 l 819 0 "},"":{x_min:-46.265625,x_max:392,ha:513,o:"m 392 651 l 259 651 l 79 -279 l -46 -278 l 134 651 l 14 651 l 14 751 l 135 751 q 151 948 135 900 q 304 1041 185 1041 q 334 1040 319 1041 q 392 1034 348 1039 l 392 922 q 337 931 360 931 q 271 883 287 931 q 260 793 260 853 l 260 751 l 392 751 l 392 651 "},e:{x_min:0,x_max:714,ha:813,o:"m 714 326 l 140 326 q 200 157 140 227 q 359 87 260 87 q 488 130 431 87 q 561 245 545 174 l 697 245 q 577 48 670 123 q 358 -26 484 -26 q 97 85 195 -26 q 0 363 0 197 q 94 642 0 529 q 358 765 195 765 q 626 627 529 765 q 714 326 714 503 m 576 429 q 507 583 564 522 q 355 650 445 650 q 206 583 266 650 q 140 429 152 522 l 576 429 "},"":{x_min:0,x_max:712,ha:815,o:"m 356 -25 q 94 91 194 -25 q 0 368 0 202 q 92 642 0 533 q 356 761 192 761 q 617 644 517 761 q 712 368 712 533 q 619 91 712 201 q 356 -25 520 -25 m 356 85 q 527 175 465 85 q 583 369 583 255 q 528 562 583 484 q 356 651 466 651 q 189 560 250 651 q 135 369 135 481 q 187 177 135 257 q 356 85 250 85 m 576 1040 l 387 819 l 303 819 l 438 1040 l 576 1040 "},J:{x_min:0,x_max:588,ha:699,o:"m 588 279 q 287 -26 588 -26 q 58 73 126 -26 q 0 327 0 158 l 133 327 q 160 172 133 227 q 288 96 198 96 q 426 171 391 96 q 449 336 449 219 l 449 1013 l 588 1013 l 588 279 "},"":{x_min:-1,x_max:503,ha:601,o:"m 503 302 l 280 136 l 281 256 l 429 373 l 281 486 l 280 608 l 503 440 l 503 302 m 221 302 l 0 136 l 0 255 l 145 372 l 0 486 l -1 608 l 221 440 l 221 302 "},"":{x_min:-3,x_max:1008,ha:1106,o:"m 502 -7 q 123 151 263 -7 q -3 501 -3 294 q 123 851 -3 706 q 502 1011 263 1011 q 881 851 739 1011 q 1008 501 1008 708 q 883 151 1008 292 q 502 -7 744 -7 m 502 60 q 830 197 709 60 q 940 501 940 322 q 831 805 940 681 q 502 944 709 944 q 174 805 296 944 q 65 501 65 680 q 173 197 65 320 q 502 60 294 60 m 741 394 q 661 246 731 302 q 496 190 591 190 q 294 285 369 190 q 228 497 228 370 q 295 714 228 625 q 499 813 370 813 q 656 762 588 813 q 733 625 724 711 l 634 625 q 589 704 629 673 q 498 735 550 735 q 377 666 421 735 q 334 504 334 597 q 374 340 334 408 q 490 272 415 272 q 589 304 549 272 q 638 394 628 337 l 741 394 "},"":{x_min:0,x_max:922,ha:1030,o:"m 687 1040 l 498 819 l 415 819 l 549 1040 l 687 1040 m 922 339 q 856 97 922 203 q 650 -26 780 -26 q 538 9 587 -26 q 461 103 489 44 q 387 12 436 46 q 277 -22 339 -22 q 69 97 147 -22 q 0 338 0 202 q 45 551 0 444 q 161 737 84 643 l 302 737 q 175 552 219 647 q 124 336 124 446 q 155 179 124 248 q 275 88 197 88 q 375 163 341 88 q 400 294 400 219 l 400 572 l 524 572 l 524 294 q 561 135 524 192 q 643 88 591 88 q 762 182 719 88 q 797 341 797 257 q 745 555 797 450 q 619 737 705 637 l 760 737 q 874 551 835 640 q 922 339 922 444 "},"^":{x_min:193.0625,x_max:598.609375,ha:792,o:"m 598 772 l 515 772 l 395 931 l 277 772 l 193 772 l 326 1013 l 462 1013 l 598 772 "},"":{x_min:0,x_max:507.203125,ha:604,o:"m 506 136 l 284 302 l 284 440 l 506 608 l 507 485 l 360 371 l 506 255 l 506 136 m 222 136 l 0 302 l 0 440 l 222 608 l 221 486 l 73 373 l 222 256 l 222 136 "},D:{x_min:0,x_max:828,ha:935,o:"m 389 1013 q 714 867 593 1013 q 828 521 828 729 q 712 161 828 309 q 382 0 587 0 l 0 0 l 0 1013 l 389 1013 m 376 124 q 607 247 523 124 q 681 510 681 355 q 607 771 681 662 q 376 896 522 896 l 139 896 l 139 124 l 376 124 "},"":{x_min:0,x_max:142,ha:239,o:"m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 "},"":{x_min:0,x_max:47,ha:125,o:"m 47 3 q 37 -7 47 -7 q 28 0 30 -7 q 39 -4 32 -4 q 45 3 45 -1 l 37 0 q 28 9 28 0 q 39 19 28 19 l 47 16 l 47 19 l 47 3 m 37 1 q 44 8 44 1 q 37 16 44 16 q 30 8 30 16 q 37 1 30 1 m 26 1 l 23 22 l 14 0 l 3 22 l 3 3 l 0 25 l 13 1 l 22 25 l 26 1 "},w:{x_min:0,x_max:1009.71875,ha:1100,o:"m 1009 738 l 783 0 l 658 0 l 501 567 l 345 0 l 222 0 l 0 738 l 130 738 l 284 174 l 432 737 l 576 738 l 721 173 l 881 737 l 1009 738 "},$:{x_min:0,x_max:700,ha:793,o:"m 664 717 l 542 717 q 490 825 531 785 q 381 872 450 865 l 381 551 q 620 446 540 522 q 700 241 700 370 q 618 45 700 116 q 381 -25 536 -25 l 381 -152 l 307 -152 l 307 -25 q 81 62 162 -25 q 0 297 0 149 l 124 297 q 169 146 124 204 q 307 81 215 89 l 307 441 q 80 536 148 469 q 13 725 13 603 q 96 910 13 839 q 307 982 180 982 l 307 1077 l 381 1077 l 381 982 q 574 917 494 982 q 664 717 664 845 m 307 565 l 307 872 q 187 831 233 872 q 142 724 142 791 q 180 618 142 656 q 307 565 218 580 m 381 76 q 562 237 562 96 q 517 361 562 313 q 381 423 472 409 l 381 76 "},"\\":{x_min:-.015625,x_max:425.0625,ha:522,o:"m 425 -129 l 337 -129 l 0 1041 l 83 1041 l 425 -129 "},"":{x_min:0,x_max:697.21875,ha:747,o:"m 697 -4 q 629 -14 658 -14 q 498 97 513 -14 q 422 9 470 41 q 313 -23 374 -23 q 207 4 258 -23 q 119 81 156 32 l 119 -278 l 0 -278 l 0 738 l 124 738 l 124 343 q 165 173 124 246 q 308 83 216 83 q 452 178 402 83 q 493 359 493 255 l 493 738 l 617 738 l 617 214 q 623 136 617 160 q 673 92 637 92 q 697 96 684 92 l 697 -4 "},"":{x_min:42,x_max:181,ha:297,o:"m 181 0 l 42 0 l 42 1013 l 181 1013 l 181 0 "},"":{x_min:0,x_max:1144.5,ha:1214,o:"m 1144 1012 l 807 416 l 807 0 l 667 0 l 667 416 l 325 1012 l 465 1012 l 736 533 l 1004 1012 l 1144 1012 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "},"":{x_min:0,x_max:139,ha:236,o:"m 139 851 q 102 737 139 784 q 0 669 65 690 l 0 734 q 59 787 42 741 q 72 873 72 821 l 0 873 l 0 1013 l 139 1013 l 139 851 "},"":{x_min:0,x_max:801,ha:915,o:"m 801 0 l 651 0 l 131 822 l 131 0 l 0 0 l 0 1013 l 151 1013 l 670 191 l 670 1013 l 801 1013 l 801 0 "},"-":{x_min:8.71875,x_max:350.390625,ha:478,o:"m 350 317 l 8 317 l 8 428 l 350 428 l 350 317 "},Q:{x_min:0,x_max:968,ha:1072,o:"m 954 5 l 887 -79 l 744 35 q 622 -11 687 2 q 483 -26 556 -26 q 127 130 262 -26 q 0 504 0 279 q 127 880 0 728 q 484 1041 262 1041 q 841 884 708 1041 q 968 507 968 735 q 933 293 968 398 q 832 104 899 188 l 954 5 m 723 191 q 802 330 777 248 q 828 499 828 412 q 744 790 828 673 q 483 922 650 922 q 228 791 322 922 q 142 505 142 673 q 227 221 142 337 q 487 91 323 91 q 632 123 566 91 l 520 215 l 587 301 l 723 191 "},"":{x_min:1,x_max:676.28125,ha:740,o:"m 676 460 l 551 460 q 498 595 542 546 q 365 651 448 651 q 199 578 263 651 q 136 401 136 505 q 266 178 136 241 q 508 106 387 142 q 640 -50 640 62 q 625 -158 640 -105 q 583 -278 611 -211 l 465 -278 q 498 -182 490 -211 q 515 -80 515 -126 q 381 12 515 -15 q 134 91 197 51 q 1 388 1 179 q 100 651 1 542 q 354 761 199 761 q 587 680 498 761 q 676 460 676 599 "},M:{x_min:0,x_max:954,ha:1067,o:"m 954 0 l 819 0 l 819 869 l 537 0 l 405 0 l 128 866 l 128 0 l 0 0 l 0 1013 l 200 1013 l 472 160 l 757 1013 l 954 1013 l 954 0 "},"":{x_min:0,x_max:1006,ha:1094,o:"m 1006 678 q 914 319 1006 429 q 571 200 814 200 l 571 0 l 433 0 l 433 200 q 92 319 194 200 q 0 678 0 429 l 0 1013 l 139 1013 l 139 679 q 191 417 139 492 q 433 326 255 326 l 433 1013 l 571 1013 l 571 326 l 580 326 q 813 423 747 326 q 868 679 868 502 l 868 1013 l 1006 1013 l 1006 678 "},C:{x_min:0,x_max:886,ha:944,o:"m 886 379 q 760 87 886 201 q 455 -26 634 -26 q 112 136 236 -26 q 0 509 0 283 q 118 882 0 737 q 469 1041 245 1041 q 748 955 630 1041 q 879 708 879 859 l 745 708 q 649 862 724 805 q 473 920 573 920 q 219 791 312 920 q 136 509 136 675 q 217 229 136 344 q 470 99 311 99 q 672 179 591 99 q 753 379 753 259 l 886 379 "},"!":{x_min:0,x_max:138,ha:236,o:"m 138 684 q 116 409 138 629 q 105 244 105 299 l 33 244 q 16 465 33 313 q 0 684 0 616 l 0 1013 l 138 1013 l 138 684 m 138 0 l 0 0 l 0 151 l 138 151 l 138 0 "},"{":{x_min:0,x_max:480.5625,ha:578,o:"m 480 -286 q 237 -213 303 -286 q 187 -45 187 -159 q 194 48 187 -15 q 201 141 201 112 q 164 264 201 225 q 0 314 118 314 l 0 417 q 164 471 119 417 q 201 605 201 514 q 199 665 201 644 q 193 772 193 769 q 241 941 193 887 q 480 1015 308 1015 l 480 915 q 336 866 375 915 q 306 742 306 828 q 310 662 306 717 q 314 577 314 606 q 288 452 314 500 q 176 365 256 391 q 289 275 257 337 q 314 143 314 226 q 313 84 314 107 q 310 -11 310 -5 q 339 -131 310 -94 q 480 -182 377 -182 l 480 -286 "},X:{x_min:-.015625,x_max:854.15625,ha:940,o:"m 854 0 l 683 0 l 423 409 l 166 0 l 0 0 l 347 519 l 18 1013 l 186 1013 l 428 637 l 675 1013 l 836 1013 l 504 520 l 854 0 "},"#":{x_min:0,x_max:963.890625,ha:1061,o:"m 963 690 l 927 590 l 719 590 l 655 410 l 876 410 l 840 310 l 618 310 l 508 -3 l 393 -2 l 506 309 l 329 310 l 215 -2 l 102 -3 l 212 310 l 0 310 l 36 410 l 248 409 l 312 590 l 86 590 l 120 690 l 347 690 l 459 1006 l 573 1006 l 462 690 l 640 690 l 751 1006 l 865 1006 l 754 690 l 963 690 m 606 590 l 425 590 l 362 410 l 543 410 l 606 590 "},"":{x_min:42,x_max:284,ha:361,o:"m 284 3 q 233 -10 258 -5 q 182 -15 207 -15 q 85 26 119 -15 q 42 200 42 79 l 42 738 l 167 738 l 168 215 q 172 141 168 157 q 226 101 183 101 q 248 103 239 101 q 284 112 257 104 l 284 3 "},"":{x_min:0,x_max:906.953125,ha:982,o:"m 283 1040 l 88 799 l 5 799 l 145 1040 l 283 1040 m 906 0 l 756 0 l 650 303 l 251 303 l 143 0 l 0 0 l 376 1012 l 529 1012 l 906 0 m 609 421 l 452 866 l 293 421 l 609 421 "},")":{x_min:0,x_max:318,ha:415,o:"m 318 365 q 257 25 318 191 q 87 -290 197 -141 l 0 -290 q 140 21 93 -128 q 193 360 193 189 q 141 704 193 537 q 0 1024 97 850 l 87 1024 q 257 706 197 871 q 318 365 318 542 "},"":{x_min:0,x_max:634.71875,ha:714,o:"m 634 234 q 527 38 634 110 q 300 -25 433 -25 q 98 29 183 -25 q 0 204 0 93 q 37 314 0 265 q 128 390 67 353 q 56 460 82 419 q 26 555 26 505 q 114 712 26 654 q 295 763 191 763 q 499 700 416 763 q 589 515 589 631 l 478 515 q 419 618 464 580 q 307 657 374 657 q 207 630 253 657 q 151 547 151 598 q 238 445 151 469 q 389 434 280 434 l 389 331 l 349 331 q 206 315 255 331 q 125 210 125 287 q 183 107 125 145 q 302 76 233 76 q 436 117 379 76 q 509 234 493 159 l 634 234 "},"":{x_min:0,x_max:952.78125,ha:1028,o:"m 952 0 l 0 0 l 400 1013 l 551 1013 l 952 0 m 762 124 l 476 867 l 187 124 l 762 124 "},"}":{x_min:0,x_max:481,ha:578,o:"m 481 314 q 318 262 364 314 q 282 136 282 222 q 284 65 282 97 q 293 -58 293 -48 q 241 -217 293 -166 q 0 -286 174 -286 l 0 -182 q 143 -130 105 -182 q 171 -2 171 -93 q 168 81 171 22 q 165 144 165 140 q 188 275 165 229 q 306 365 220 339 q 191 455 224 391 q 165 588 165 505 q 168 681 165 624 q 171 742 171 737 q 141 865 171 827 q 0 915 102 915 l 0 1015 q 243 942 176 1015 q 293 773 293 888 q 287 675 293 741 q 282 590 282 608 q 318 466 282 505 q 481 417 364 417 l 481 314 "},"":{x_min:-3,x_max:1672,ha:1821,o:"m 846 0 q 664 76 732 0 q 603 244 603 145 q 662 412 603 344 q 846 489 729 489 q 1027 412 959 489 q 1089 244 1089 343 q 1029 76 1089 144 q 846 0 962 0 m 845 103 q 945 143 910 103 q 981 243 981 184 q 947 340 981 301 q 845 385 910 385 q 745 342 782 385 q 709 243 709 300 q 742 147 709 186 q 845 103 781 103 m 888 986 l 284 -25 l 199 -25 l 803 986 l 888 986 m 241 468 q 58 545 126 468 q -3 715 -3 615 q 56 881 -3 813 q 238 958 124 958 q 421 881 353 958 q 483 712 483 813 q 423 544 483 612 q 241 468 356 468 m 241 855 q 137 811 175 855 q 100 710 100 768 q 136 612 100 653 q 240 572 172 572 q 344 614 306 572 q 382 713 382 656 q 347 810 382 771 q 241 855 308 855 m 1428 0 q 1246 76 1314 0 q 1185 244 1185 145 q 1244 412 1185 344 q 1428 489 1311 489 q 1610 412 1542 489 q 1672 244 1672 343 q 1612 76 1672 144 q 1428 0 1545 0 m 1427 103 q 1528 143 1492 103 q 1564 243 1564 184 q 1530 340 1564 301 q 1427 385 1492 385 q 1327 342 1364 385 q 1291 243 1291 300 q 1324 147 1291 186 q 1427 103 1363 103 "},a:{x_min:0,x_max:698.609375,ha:794,o:"m 698 0 q 661 -12 679 -7 q 615 -17 643 -17 q 536 12 564 -17 q 500 96 508 41 q 384 6 456 37 q 236 -25 312 -25 q 65 31 130 -25 q 0 194 0 88 q 118 390 0 334 q 328 435 180 420 q 488 483 476 451 q 495 523 495 504 q 442 619 495 584 q 325 654 389 654 q 209 617 257 654 q 152 513 161 580 l 33 513 q 123 705 33 633 q 332 772 207 772 q 528 712 448 772 q 617 531 617 645 l 617 163 q 624 108 617 126 q 664 90 632 90 l 698 94 l 698 0 m 491 262 l 491 372 q 272 329 350 347 q 128 201 128 294 q 166 113 128 144 q 264 83 205 83 q 414 130 346 83 q 491 262 491 183 "},"":{x_min:0,x_max:941.671875,ha:1039,o:"m 941 334 l 0 334 l 0 410 l 941 410 l 941 334 "},"=":{x_min:8.71875,x_max:780.953125,ha:792,o:"m 780 510 l 8 510 l 8 606 l 780 606 l 780 510 m 780 235 l 8 235 l 8 332 l 780 332 l 780 235 "},N:{x_min:0,x_max:801,ha:914,o:"m 801 0 l 651 0 l 131 823 l 131 0 l 0 0 l 0 1013 l 151 1013 l 670 193 l 670 1013 l 801 1013 l 801 0 "},"":{x_min:0,x_max:712,ha:797,o:"m 712 369 q 620 94 712 207 q 362 -26 521 -26 q 230 2 292 -26 q 119 83 167 30 l 119 -278 l 0 -278 l 0 362 q 91 643 0 531 q 355 764 190 764 q 617 647 517 764 q 712 369 712 536 m 583 366 q 530 559 583 480 q 359 651 469 651 q 190 562 252 651 q 135 370 135 483 q 189 176 135 257 q 359 85 250 85 q 528 175 466 85 q 583 366 583 254 "},2:{x_min:59,x_max:731,ha:792,o:"m 731 0 l 59 0 q 197 314 59 188 q 457 487 199 315 q 598 691 598 580 q 543 819 598 772 q 411 867 488 867 q 272 811 328 867 q 209 630 209 747 l 81 630 q 182 901 81 805 q 408 986 271 986 q 629 909 536 986 q 731 694 731 826 q 613 449 731 541 q 378 316 495 383 q 201 122 235 234 l 731 122 l 731 0 "},"":{x_min:0,x_max:941.671875,ha:938,o:"m 941 1033 l 0 1033 l 0 1109 l 941 1109 l 941 1033 "},Z:{x_min:0,x_max:779,ha:849,o:"m 779 0 l 0 0 l 0 113 l 621 896 l 40 896 l 40 1013 l 779 1013 l 778 887 l 171 124 l 779 124 l 779 0 "},u:{x_min:0,x_max:617,ha:729,o:"m 617 0 l 499 0 l 499 110 q 391 10 460 45 q 246 -25 322 -25 q 61 58 127 -25 q 0 258 0 136 l 0 738 l 125 738 l 125 284 q 156 148 125 202 q 273 82 197 82 q 433 165 369 82 q 493 340 493 243 l 493 738 l 617 738 l 617 0 "},k:{x_min:0,x_max:612.484375,ha:697,o:"m 612 738 l 338 465 l 608 0 l 469 0 l 251 382 l 121 251 l 121 0 l 0 0 l 0 1013 l 121 1013 l 121 402 l 456 738 l 612 738 "},"":{x_min:0,x_max:803,ha:917,o:"m 803 0 l 667 0 l 667 475 l 140 475 l 140 0 l 0 0 l 0 1013 l 140 1013 l 140 599 l 667 599 l 667 1013 l 803 1013 l 803 0 "},"":{x_min:0,x_max:906.953125,ha:985,o:"m 906 0 l 756 0 l 650 303 l 251 303 l 143 0 l 0 0 l 376 1013 l 529 1013 l 906 0 m 609 421 l 452 866 l 293 421 l 609 421 "},s:{x_min:0,x_max:604,ha:697,o:"m 604 217 q 501 36 604 104 q 292 -23 411 -23 q 86 43 166 -23 q 0 238 0 114 l 121 237 q 175 122 121 164 q 300 85 223 85 q 415 112 363 85 q 479 207 479 147 q 361 309 479 276 q 140 372 141 370 q 21 544 21 426 q 111 708 21 647 q 298 761 190 761 q 492 705 413 761 q 583 531 583 643 l 462 531 q 412 625 462 594 q 298 657 363 657 q 199 636 242 657 q 143 558 143 608 q 262 454 143 486 q 484 394 479 397 q 604 217 604 341 "},B:{x_min:0,x_max:778,ha:876,o:"m 580 546 q 724 469 670 535 q 778 311 778 403 q 673 83 778 171 q 432 0 575 0 l 0 0 l 0 1013 l 411 1013 q 629 957 541 1013 q 732 768 732 892 q 691 633 732 693 q 580 546 650 572 m 393 899 l 139 899 l 139 588 l 379 588 q 521 624 462 588 q 592 744 592 667 q 531 859 592 819 q 393 899 471 899 m 419 124 q 566 169 504 124 q 635 303 635 219 q 559 436 635 389 q 402 477 494 477 l 139 477 l 139 124 l 419 124 "},"":{x_min:0,x_max:614,ha:708,o:"m 142 0 l 0 0 l 0 151 l 142 151 l 142 0 m 378 0 l 236 0 l 236 151 l 378 151 l 378 0 m 614 0 l 472 0 l 472 151 l 614 151 l 614 0 "},"?":{x_min:0,x_max:607,ha:704,o:"m 607 777 q 543 599 607 674 q 422 474 482 537 q 357 272 357 391 l 236 272 q 297 487 236 395 q 411 619 298 490 q 474 762 474 691 q 422 885 474 838 q 301 933 371 933 q 179 880 228 933 q 124 706 124 819 l 0 706 q 94 963 0 872 q 302 1044 177 1044 q 511 973 423 1044 q 607 777 607 895 m 370 0 l 230 0 l 230 151 l 370 151 l 370 0 "},H:{x_min:0,x_max:803,ha:915,o:"m 803 0 l 667 0 l 667 475 l 140 475 l 140 0 l 0 0 l 0 1013 l 140 1013 l 140 599 l 667 599 l 667 1013 l 803 1013 l 803 0 "},"":{x_min:0,x_max:675,ha:761,o:"m 675 738 l 404 0 l 272 0 l 0 738 l 133 738 l 340 147 l 541 738 l 675 738 "},c:{x_min:1,x_max:701.390625,ha:775,o:"m 701 264 q 584 53 681 133 q 353 -26 487 -26 q 91 91 188 -26 q 1 370 1 201 q 92 645 1 537 q 353 761 190 761 q 572 688 479 761 q 690 493 666 615 l 556 493 q 487 606 545 562 q 356 650 428 650 q 186 563 246 650 q 134 372 134 487 q 188 179 134 258 q 359 88 250 88 q 492 136 437 88 q 566 264 548 185 l 701 264 "},"":{x_min:0,x_max:566.671875,ha:678,o:"m 21 892 l 52 892 l 98 761 l 145 892 l 176 892 l 178 741 l 157 741 l 157 867 l 108 741 l 88 741 l 40 871 l 40 741 l 21 741 l 21 892 m 308 854 l 308 731 q 252 691 308 691 q 227 691 240 691 q 207 696 213 695 l 207 712 l 253 706 q 288 733 288 706 l 288 763 q 244 741 279 741 q 193 797 193 741 q 261 860 193 860 q 287 860 273 860 q 308 854 302 855 m 288 842 l 263 843 q 213 796 213 843 q 248 756 213 756 q 288 796 288 756 l 288 842 m 566 988 l 502 988 l 502 -1 l 439 -1 l 439 988 l 317 988 l 317 -1 l 252 -1 l 252 602 q 81 653 155 602 q 0 805 0 711 q 101 989 0 918 q 309 1053 194 1053 l 566 1053 l 566 988 "},"":{x_min:0,x_max:660,ha:745,o:"m 471 550 q 610 450 561 522 q 660 280 660 378 q 578 64 660 151 q 367 -22 497 -22 q 239 5 299 -22 q 126 82 178 32 l 126 -278 l 0 -278 l 0 593 q 54 903 0 801 q 318 1042 127 1042 q 519 964 436 1042 q 603 771 603 887 q 567 644 603 701 q 471 550 532 586 m 337 79 q 476 138 418 79 q 535 279 535 198 q 427 437 535 386 q 226 477 344 477 l 226 583 q 398 620 329 583 q 486 762 486 668 q 435 884 486 833 q 312 935 384 935 q 169 861 219 935 q 126 698 126 797 l 126 362 q 170 169 126 242 q 337 79 224 79 "},"":{x_min:0,x_max:954,ha:1068,o:"m 954 0 l 819 0 l 819 868 l 537 0 l 405 0 l 128 865 l 128 0 l 0 0 l 0 1013 l 199 1013 l 472 158 l 758 1013 l 954 1013 l 954 0 "},"":{x_min:.109375,x_max:1120,ha:1217,o:"m 1120 505 q 994 132 1120 282 q 642 -29 861 -29 q 290 130 422 -29 q 167 505 167 280 q 294 883 167 730 q 650 1046 430 1046 q 999 882 868 1046 q 1120 505 1120 730 m 977 504 q 896 784 977 669 q 644 915 804 915 q 391 785 484 915 q 307 504 307 669 q 391 224 307 339 q 644 95 486 95 q 894 224 803 95 q 977 504 977 339 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "},"":{x_min:0,x_max:1158,ha:1275,o:"m 1158 0 l 1022 0 l 1022 475 l 496 475 l 496 0 l 356 0 l 356 1012 l 496 1012 l 496 599 l 1022 599 l 1022 1012 l 1158 1012 l 1158 0 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "},"":{x_min:0,x_max:663.890625,ha:775,o:"m 663 529 q 566 293 663 391 q 331 196 469 196 q 97 294 194 196 q 0 529 0 393 q 96 763 0 665 q 331 861 193 861 q 566 763 469 861 q 663 529 663 665 "},"":{x_min:.1875,x_max:819.546875,ha:886,o:"m 563 561 l 697 561 l 696 487 l 520 487 l 482 416 l 482 380 l 697 380 l 695 308 l 482 308 l 482 0 l 342 0 l 342 308 l 125 308 l 125 380 l 342 380 l 342 417 l 303 487 l 125 487 l 125 561 l 258 561 l 0 1013 l 140 1013 l 411 533 l 679 1013 l 819 1013 l 563 561 "},"(":{x_min:0,x_max:318.0625,ha:415,o:"m 318 -290 l 230 -290 q 61 23 122 -142 q 0 365 0 190 q 62 712 0 540 q 230 1024 119 869 l 318 1024 q 175 705 219 853 q 125 360 125 542 q 176 22 125 187 q 318 -290 223 -127 "},U:{x_min:0,x_max:796,ha:904,o:"m 796 393 q 681 93 796 212 q 386 -25 566 -25 q 101 95 208 -25 q 0 393 0 211 l 0 1013 l 138 1013 l 138 391 q 204 191 138 270 q 394 107 276 107 q 586 191 512 107 q 656 391 656 270 l 656 1013 l 796 1013 l 796 393 "},"":{x_min:.5,x_max:744.953125,ha:822,o:"m 744 737 l 463 54 l 463 -278 l 338 -278 l 338 54 l 154 495 q 104 597 124 569 q 13 651 67 651 l 0 651 l 0 751 l 39 753 q 168 711 121 753 q 242 594 207 676 l 403 208 l 617 737 l 744 737 "},"":{x_min:0,x_max:765.5625,ha:809,o:"m 765 -4 q 698 -14 726 -14 q 564 97 586 -14 q 466 7 525 40 q 337 -26 407 -26 q 88 98 186 -26 q 0 369 0 212 q 88 637 0 525 q 337 760 184 760 q 465 728 407 760 q 563 637 524 696 l 563 739 l 685 739 l 685 222 q 693 141 685 168 q 748 94 708 94 q 765 96 760 94 l 765 -4 m 584 371 q 531 562 584 485 q 360 653 470 653 q 192 566 254 653 q 135 379 135 489 q 186 181 135 261 q 358 84 247 84 q 528 176 465 84 q 584 371 584 260 "},F:{x_min:0,x_max:683.328125,ha:717,o:"m 683 888 l 140 888 l 140 583 l 613 583 l 613 458 l 140 458 l 140 0 l 0 0 l 0 1013 l 683 1013 l 683 888 "},"":{x_min:0,x_max:705.5625,ha:803,o:"m 705 334 l 0 334 l 0 410 l 705 410 l 705 334 "},":":{x_min:0,x_max:142,ha:239,o:"m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 m 142 0 l 0 0 l 0 151 l 142 151 l 142 0 "},"":{x_min:0,x_max:854.171875,ha:935,o:"m 854 0 l 683 0 l 423 409 l 166 0 l 0 0 l 347 519 l 18 1013 l 186 1013 l 427 637 l 675 1013 l 836 1013 l 504 521 l 854 0 "},"*":{x_min:116,x_max:674,ha:792,o:"m 674 768 l 475 713 l 610 544 l 517 477 l 394 652 l 272 478 l 178 544 l 314 713 l 116 766 l 153 876 l 341 812 l 342 1013 l 446 1013 l 446 811 l 635 874 l 674 768 "},"":{x_min:0,x_max:777,ha:835,o:"m 458 804 l 777 804 l 777 683 l 458 683 l 458 0 l 319 0 l 319 681 l 0 683 l 0 804 l 319 804 l 319 1015 l 458 1013 l 458 804 "},"":{x_min:0,x_max:347,ha:444,o:"m 173 802 q 43 856 91 802 q 0 977 0 905 q 45 1101 0 1049 q 173 1153 90 1153 q 303 1098 255 1153 q 347 977 347 1049 q 303 856 347 905 q 173 802 256 802 m 173 884 q 238 910 214 884 q 262 973 262 937 q 239 1038 262 1012 q 173 1064 217 1064 q 108 1037 132 1064 q 85 973 85 1010 q 108 910 85 937 q 173 884 132 884 "},V:{x_min:0,x_max:862.71875,ha:940,o:"m 862 1013 l 505 0 l 361 0 l 0 1013 l 143 1013 l 434 165 l 718 1012 l 862 1013 "},"":{x_min:0,x_max:734.71875,ha:763,o:"m 723 889 l 9 889 l 9 1013 l 723 1013 l 723 889 m 673 463 l 61 463 l 61 589 l 673 589 l 673 463 m 734 0 l 0 0 l 0 124 l 734 124 l 734 0 "},"":{x_min:0,x_max:0,ha:853},"":{x_min:.328125,x_max:819.515625,ha:889,o:"m 588 1046 l 460 1046 l 460 1189 l 588 1189 l 588 1046 m 360 1046 l 232 1046 l 232 1189 l 360 1189 l 360 1046 m 819 1012 l 482 416 l 482 0 l 342 0 l 342 416 l 0 1012 l 140 1012 l 411 533 l 679 1012 l 819 1012 "},0:{x_min:73,x_max:715,ha:792,o:"m 394 -29 q 153 129 242 -29 q 73 479 73 272 q 152 829 73 687 q 394 989 241 989 q 634 829 545 989 q 715 479 715 684 q 635 129 715 270 q 394 -29 546 -29 m 394 89 q 546 211 489 89 q 598 479 598 322 q 548 748 598 640 q 394 871 491 871 q 241 748 298 871 q 190 479 190 637 q 239 211 190 319 q 394 89 296 89 "},"":{x_min:0,x_max:347,ha:454,o:"m 139 851 q 102 737 139 784 q 0 669 65 690 l 0 734 q 59 787 42 741 q 72 873 72 821 l 0 873 l 0 1013 l 139 1013 l 139 851 m 347 851 q 310 737 347 784 q 208 669 273 690 l 208 734 q 267 787 250 741 q 280 873 280 821 l 208 873 l 208 1013 l 347 1013 l 347 851 "},"@":{x_min:0,x_max:1260,ha:1357,o:"m 1098 -45 q 877 -160 1001 -117 q 633 -203 752 -203 q 155 -29 327 -203 q 0 360 0 127 q 176 802 0 616 q 687 1008 372 1008 q 1123 854 969 1008 q 1260 517 1260 718 q 1155 216 1260 341 q 868 82 1044 82 q 772 106 801 82 q 737 202 737 135 q 647 113 700 144 q 527 82 594 82 q 367 147 420 82 q 314 312 314 212 q 401 565 314 452 q 639 690 498 690 q 810 588 760 690 l 849 668 l 938 668 q 877 441 900 532 q 833 226 833 268 q 853 182 833 198 q 902 167 873 167 q 1088 272 1012 167 q 1159 512 1159 372 q 1051 793 1159 681 q 687 925 925 925 q 248 747 415 925 q 97 361 97 586 q 226 26 97 159 q 627 -122 370 -122 q 856 -87 737 -122 q 1061 8 976 -53 l 1098 -45 m 786 488 q 738 580 777 545 q 643 615 700 615 q 483 517 548 615 q 425 322 425 430 q 457 203 425 250 q 552 156 490 156 q 722 273 665 156 q 786 488 738 309 "},"":{x_min:0,x_max:499,ha:613,o:"m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 m 499 0 l 360 0 l 360 1012 l 499 1012 l 499 0 "},i:{x_min:14,x_max:136,ha:275,o:"m 136 873 l 14 873 l 14 1013 l 136 1013 l 136 873 m 136 0 l 14 0 l 14 737 l 136 737 l 136 0 "},"":{x_min:0,x_max:778,ha:877,o:"m 580 545 q 724 468 671 534 q 778 310 778 402 q 673 83 778 170 q 432 0 575 0 l 0 0 l 0 1013 l 411 1013 q 629 957 541 1013 q 732 768 732 891 q 691 632 732 692 q 580 545 650 571 m 393 899 l 139 899 l 139 587 l 379 587 q 521 623 462 587 q 592 744 592 666 q 531 859 592 819 q 393 899 471 899 m 419 124 q 566 169 504 124 q 635 302 635 219 q 559 435 635 388 q 402 476 494 476 l 139 476 l 139 124 l 419 124 "},"":{x_min:0,x_max:617,ha:725,o:"m 617 352 q 540 94 617 199 q 308 -24 455 -24 q 76 94 161 -24 q 0 352 0 199 l 0 739 l 126 739 l 126 355 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 355 492 257 l 492 739 l 617 739 l 617 352 "},"]":{x_min:0,x_max:275,ha:372,o:"m 275 -281 l 0 -281 l 0 -187 l 151 -187 l 151 920 l 0 920 l 0 1013 l 275 1013 l 275 -281 "},m:{x_min:0,x_max:1019,ha:1128,o:"m 1019 0 l 897 0 l 897 454 q 860 591 897 536 q 739 660 816 660 q 613 586 659 660 q 573 436 573 522 l 573 0 l 447 0 l 447 455 q 412 591 447 535 q 294 657 372 657 q 165 586 213 657 q 122 437 122 521 l 122 0 l 0 0 l 0 738 l 117 738 l 117 640 q 202 730 150 697 q 316 763 254 763 q 437 730 381 763 q 525 642 494 697 q 621 731 559 700 q 753 763 682 763 q 943 694 867 763 q 1019 512 1019 625 l 1019 0 "},"":{x_min:8.328125,x_max:780.5625,ha:815,o:"m 780 -278 q 715 -294 747 -294 q 616 -257 663 -294 q 548 -175 576 -227 l 379 133 l 143 -277 l 9 -277 l 313 254 l 163 522 q 127 586 131 580 q 36 640 91 640 q 8 637 27 640 l 8 752 l 52 757 q 162 719 113 757 q 236 627 200 690 l 383 372 l 594 737 l 726 737 l 448 250 l 625 -69 q 670 -153 647 -110 q 743 -188 695 -188 q 780 -184 759 -188 l 780 -278 "},8:{x_min:55,x_max:736,ha:792,o:"m 571 527 q 694 424 652 491 q 736 280 736 358 q 648 71 736 158 q 395 -26 551 -26 q 142 69 238 -26 q 55 279 55 157 q 96 425 55 359 q 220 527 138 491 q 120 615 153 562 q 88 726 88 668 q 171 904 88 827 q 395 986 261 986 q 618 905 529 986 q 702 727 702 830 q 670 616 702 667 q 571 527 638 565 m 394 565 q 519 610 475 565 q 563 717 563 655 q 521 823 563 781 q 392 872 474 872 q 265 824 312 872 q 224 720 224 783 q 265 613 224 656 q 394 565 312 565 m 395 91 q 545 150 488 91 q 597 280 597 204 q 546 408 597 355 q 395 465 492 465 q 244 408 299 465 q 194 280 194 356 q 244 150 194 203 q 395 91 299 91 "},"":{x_min:42,x_max:326.71875,ha:361,o:"m 284 3 q 233 -10 258 -5 q 182 -15 207 -15 q 85 26 119 -15 q 42 200 42 79 l 42 737 l 167 737 l 168 215 q 172 141 168 157 q 226 101 183 101 q 248 102 239 101 q 284 112 257 104 l 284 3 m 326 1040 l 137 819 l 54 819 l 189 1040 l 326 1040 "},"":{x_min:0,x_max:779.171875,ha:850,o:"m 779 0 l 0 0 l 0 113 l 620 896 l 40 896 l 40 1013 l 779 1013 l 779 887 l 170 124 l 779 124 l 779 0 "},R:{x_min:0,x_max:781.953125,ha:907,o:"m 781 0 l 623 0 q 587 242 590 52 q 407 433 585 433 l 138 433 l 138 0 l 0 0 l 0 1013 l 396 1013 q 636 946 539 1013 q 749 731 749 868 q 711 597 749 659 q 608 502 674 534 q 718 370 696 474 q 729 207 722 352 q 781 26 736 62 l 781 0 m 373 551 q 533 594 465 551 q 614 731 614 645 q 532 859 614 815 q 373 896 465 896 l 138 896 l 138 551 l 373 551 "},o:{x_min:0,x_max:713,ha:821,o:"m 357 -25 q 94 91 194 -25 q 0 368 0 202 q 93 642 0 533 q 357 761 193 761 q 618 644 518 761 q 713 368 713 533 q 619 91 713 201 q 357 -25 521 -25 m 357 85 q 528 175 465 85 q 584 369 584 255 q 529 562 584 484 q 357 651 467 651 q 189 560 250 651 q 135 369 135 481 q 187 177 135 257 q 357 85 250 85 "},5:{x_min:54.171875,x_max:738,ha:792,o:"m 738 314 q 626 60 738 153 q 382 -23 526 -23 q 155 47 248 -23 q 54 256 54 125 l 183 256 q 259 132 204 174 q 382 91 314 91 q 533 149 471 91 q 602 314 602 213 q 538 469 602 411 q 386 528 475 528 q 284 506 332 528 q 197 439 237 484 l 81 439 l 159 958 l 684 958 l 684 840 l 254 840 l 214 579 q 306 627 258 612 q 407 643 354 643 q 636 552 540 643 q 738 314 738 457 "},7:{x_min:58.71875,x_max:730.953125,ha:792,o:"m 730 839 q 469 448 560 641 q 335 0 378 255 l 192 0 q 328 441 235 252 q 593 830 421 630 l 58 830 l 58 958 l 730 958 l 730 839 "},K:{x_min:0,x_max:819.46875,ha:906,o:"m 819 0 l 649 0 l 294 509 l 139 355 l 139 0 l 0 0 l 0 1013 l 139 1013 l 139 526 l 626 1013 l 809 1013 l 395 600 l 819 0 "},",":{x_min:0,x_max:142,ha:239,o:"m 142 -12 q 105 -132 142 -82 q 0 -205 68 -182 l 0 -138 q 57 -82 40 -124 q 70 0 70 -51 l 0 0 l 0 151 l 142 151 l 142 -12 "},d:{x_min:0,x_max:683,ha:796,o:"m 683 0 l 564 0 l 564 93 q 456 6 516 38 q 327 -25 395 -25 q 87 100 181 -25 q 0 365 0 215 q 90 639 0 525 q 343 763 187 763 q 564 647 486 763 l 564 1013 l 683 1013 l 683 0 m 582 373 q 529 562 582 484 q 361 653 468 653 q 190 561 253 653 q 135 365 135 479 q 189 175 135 254 q 358 85 251 85 q 529 178 468 85 q 582 373 582 258 "},"":{x_min:-109,x_max:247,ha:232,o:"m 247 1046 l 119 1046 l 119 1189 l 247 1189 l 247 1046 m 19 1046 l -109 1046 l -109 1189 l 19 1189 l 19 1046 "},E:{x_min:0,x_max:736.109375,ha:789,o:"m 736 0 l 0 0 l 0 1013 l 725 1013 l 725 889 l 139 889 l 139 585 l 677 585 l 677 467 l 139 467 l 139 125 l 736 125 l 736 0 "},Y:{x_min:0,x_max:820,ha:886,o:"m 820 1013 l 482 416 l 482 0 l 342 0 l 342 416 l 0 1013 l 140 1013 l 411 534 l 679 1012 l 820 1013 "},'"':{x_min:0,x_max:299,ha:396,o:"m 299 606 l 203 606 l 203 988 l 299 988 l 299 606 m 96 606 l 0 606 l 0 988 l 96 988 l 96 606 "},"":{x_min:17.984375,x_max:773.609375,ha:792,o:"m 773 40 l 18 376 l 17 465 l 773 799 l 773 692 l 159 420 l 773 149 l 773 40 "},"":{x_min:0,x_max:364,ha:467,o:"m 141 -12 q 104 -132 141 -82 q 0 -205 67 -182 l 0 -138 q 56 -82 40 -124 q 69 0 69 -51 l 0 0 l 0 151 l 141 151 l 141 -12 m 364 -12 q 327 -132 364 -82 q 222 -205 290 -182 l 222 -138 q 279 -82 262 -124 q 292 0 292 -51 l 222 0 l 222 151 l 364 151 l 364 -12 "},"":{x_min:1,x_max:710,ha:810,o:"m 710 360 q 616 87 710 196 q 356 -28 518 -28 q 99 82 197 -28 q 1 356 1 192 q 100 606 1 509 q 355 703 199 703 q 180 829 288 754 q 70 903 124 866 l 70 1012 l 643 1012 l 643 901 l 258 901 q 462 763 422 794 q 636 592 577 677 q 710 360 710 485 m 584 365 q 552 501 584 447 q 451 602 521 555 q 372 611 411 611 q 197 541 258 611 q 136 355 136 472 q 190 171 136 245 q 358 85 252 85 q 528 173 465 85 q 584 365 584 252 "},"":{x_min:0,x_max:634.71875,ha:714,o:"m 634 234 q 527 38 634 110 q 300 -25 433 -25 q 98 29 183 -25 q 0 204 0 93 q 37 313 0 265 q 128 390 67 352 q 56 459 82 419 q 26 555 26 505 q 114 712 26 654 q 295 763 191 763 q 499 700 416 763 q 589 515 589 631 l 478 515 q 419 618 464 580 q 307 657 374 657 q 207 630 253 657 q 151 547 151 598 q 238 445 151 469 q 389 434 280 434 l 389 331 l 349 331 q 206 315 255 331 q 125 210 125 287 q 183 107 125 145 q 302 76 233 76 q 436 117 379 76 q 509 234 493 159 l 634 234 m 520 1040 l 331 819 l 248 819 l 383 1040 l 520 1040 "},"":{x_min:0,x_max:922,ha:1031,o:"m 922 339 q 856 97 922 203 q 650 -26 780 -26 q 538 9 587 -26 q 461 103 489 44 q 387 12 436 46 q 277 -22 339 -22 q 69 97 147 -22 q 0 339 0 203 q 45 551 0 444 q 161 738 84 643 l 302 738 q 175 553 219 647 q 124 336 124 446 q 155 179 124 249 q 275 88 197 88 q 375 163 341 88 q 400 294 400 219 l 400 572 l 524 572 l 524 294 q 561 135 524 192 q 643 88 591 88 q 762 182 719 88 q 797 342 797 257 q 745 556 797 450 q 619 738 705 638 l 760 738 q 874 551 835 640 q 922 339 922 444 "},"":{x_min:0,x_max:96,ha:251,o:"m 96 606 l 0 606 l 0 988 l 96 988 l 96 606 "},"":{x_min:11,x_max:781,ha:792,o:"m 781 490 l 446 490 l 446 255 l 349 255 l 349 490 l 11 490 l 11 586 l 349 586 l 349 819 l 446 819 l 446 586 l 781 586 l 781 490 m 781 21 l 11 21 l 11 115 l 781 115 l 781 21 "},"|":{x_min:343,x_max:449,ha:792,o:"m 449 462 l 343 462 l 343 986 l 449 986 l 449 462 m 449 -242 l 343 -242 l 343 280 l 449 280 l 449 -242 "},"":{x_min:0,x_max:617,ha:725,o:"m 482 800 l 372 800 l 372 925 l 482 925 l 482 800 m 239 800 l 129 800 l 129 925 l 239 925 l 239 800 m 617 352 q 540 93 617 199 q 308 -24 455 -24 q 76 93 161 -24 q 0 352 0 199 l 0 738 l 126 738 l 126 354 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 354 492 257 l 492 738 l 617 738 l 617 352 "},"":{x_min:0,x_max:593,ha:690,o:"m 593 425 q 554 312 593 369 q 467 233 516 254 q 537 83 537 172 q 459 -74 537 -12 q 288 -133 387 -133 q 115 -69 184 -133 q 47 96 47 -6 l 166 96 q 199 7 166 40 q 288 -26 232 -26 q 371 -5 332 -26 q 420 60 420 21 q 311 201 420 139 q 108 309 210 255 q 0 490 0 383 q 33 602 0 551 q 124 687 66 654 q 75 743 93 712 q 58 812 58 773 q 133 984 58 920 q 300 1043 201 1043 q 458 987 394 1043 q 529 814 529 925 l 411 814 q 370 908 404 877 q 289 939 336 939 q 213 911 246 939 q 180 841 180 883 q 286 720 180 779 q 484 612 480 615 q 593 425 593 534 m 467 409 q 355 544 467 473 q 196 630 228 612 q 146 587 162 609 q 124 525 124 558 q 239 387 124 462 q 398 298 369 315 q 448 345 429 316 q 467 409 467 375 "},b:{x_min:0,x_max:685,ha:783,o:"m 685 372 q 597 99 685 213 q 347 -25 501 -25 q 219 5 277 -25 q 121 93 161 36 l 121 0 l 0 0 l 0 1013 l 121 1013 l 121 634 q 214 723 157 692 q 341 754 272 754 q 591 637 493 754 q 685 372 685 526 m 554 356 q 499 550 554 470 q 328 644 437 644 q 162 556 223 644 q 108 369 108 478 q 160 176 108 256 q 330 83 221 83 q 498 169 435 83 q 554 356 554 245 "},q:{x_min:0,x_max:683,ha:876,o:"m 683 -278 l 564 -278 l 564 97 q 474 8 533 39 q 345 -23 415 -23 q 91 93 188 -23 q 0 364 0 203 q 87 635 0 522 q 337 760 184 760 q 466 727 408 760 q 564 637 523 695 l 564 737 l 683 737 l 683 -278 m 582 375 q 527 564 582 488 q 358 652 466 652 q 190 565 253 652 q 135 377 135 488 q 189 179 135 261 q 361 84 251 84 q 530 179 469 84 q 582 375 582 260 "},"":{x_min:-.171875,x_max:969.5625,ha:1068,o:"m 969 0 l 555 0 l 555 123 q 744 308 675 194 q 814 558 814 423 q 726 812 814 709 q 484 922 633 922 q 244 820 334 922 q 154 567 154 719 q 223 316 154 433 q 412 123 292 199 l 412 0 l 0 0 l 0 124 l 217 124 q 68 327 122 210 q 15 572 15 444 q 144 911 15 781 q 484 1041 274 1041 q 822 909 691 1041 q 953 569 953 777 q 899 326 953 443 q 750 124 846 210 l 969 124 l 969 0 "},"":{x_min:0,x_max:617,ha:725,o:"m 617 352 q 540 93 617 199 q 308 -24 455 -24 q 76 93 161 -24 q 0 352 0 199 l 0 738 l 126 738 l 126 354 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 354 492 257 l 492 738 l 617 738 l 617 352 m 535 1040 l 346 819 l 262 819 l 397 1040 l 535 1040 "},z:{x_min:-.015625,x_max:613.890625,ha:697,o:"m 613 0 l 0 0 l 0 100 l 433 630 l 20 630 l 20 738 l 594 738 l 593 636 l 163 110 l 613 110 l 613 0 "},"":{x_min:0,x_max:894,ha:1e3,o:"m 389 951 l 229 951 l 229 503 l 160 503 l 160 951 l 0 951 l 0 1011 l 389 1011 l 389 951 m 894 503 l 827 503 l 827 939 l 685 503 l 620 503 l 481 937 l 481 503 l 417 503 l 417 1011 l 517 1011 l 653 580 l 796 1010 l 894 1011 l 894 503 "},"":{x_min:.78125,x_max:697,ha:810,o:"m 697 -278 l 572 -278 l 572 454 q 540 587 572 536 q 425 650 501 650 q 271 579 337 650 q 206 420 206 509 l 206 0 l 81 0 l 81 489 q 73 588 81 562 q 0 644 56 644 l 0 741 q 68 755 38 755 q 158 721 124 755 q 200 630 193 687 q 297 726 234 692 q 434 761 359 761 q 620 692 544 761 q 697 516 697 624 l 697 -278 m 479 1040 l 290 819 l 207 819 l 341 1040 l 479 1040 "},"":{x_min:0,x_max:960,ha:1056,o:"m 960 507 q 833 129 960 280 q 476 -32 698 -32 q 123 129 255 -32 q 0 507 0 280 q 123 883 0 732 q 476 1045 255 1045 q 832 883 696 1045 q 960 507 960 732 m 817 500 q 733 789 817 669 q 476 924 639 924 q 223 792 317 924 q 142 507 142 675 q 222 222 142 339 q 476 89 315 89 q 730 218 636 89 q 817 500 817 334 m 716 449 l 243 449 l 243 571 l 716 571 l 716 449 "},"":{x_min:-3,x_max:1008,ha:1106,o:"m 503 532 q 614 562 566 532 q 672 658 672 598 q 614 747 672 716 q 503 772 569 772 l 338 772 l 338 532 l 503 532 m 502 -7 q 123 151 263 -7 q -3 501 -3 294 q 123 851 -3 706 q 502 1011 263 1011 q 881 851 739 1011 q 1008 501 1008 708 q 883 151 1008 292 q 502 -7 744 -7 m 502 60 q 830 197 709 60 q 940 501 940 322 q 831 805 940 681 q 502 944 709 944 q 174 805 296 944 q 65 501 65 680 q 173 197 65 320 q 502 60 294 60 m 788 146 l 678 146 q 653 316 655 183 q 527 449 652 449 l 338 449 l 338 146 l 241 146 l 241 854 l 518 854 q 688 808 621 854 q 766 658 766 755 q 739 563 766 607 q 668 497 713 519 q 751 331 747 472 q 788 164 756 190 l 788 146 "},"~":{x_min:0,x_max:833,ha:931,o:"m 833 958 q 778 753 833 831 q 594 665 716 665 q 402 761 502 665 q 240 857 302 857 q 131 795 166 857 q 104 665 104 745 l 0 665 q 54 867 0 789 q 237 958 116 958 q 429 861 331 958 q 594 765 527 765 q 704 827 670 765 q 729 958 729 874 l 833 958 "},"":{x_min:0,x_max:736.21875,ha:778,o:"m 736 0 l 0 0 l 0 1013 l 725 1013 l 725 889 l 139 889 l 139 585 l 677 585 l 677 467 l 139 467 l 139 125 l 736 125 l 736 0 "},"":{x_min:0,x_max:450,ha:547,o:"m 450 552 q 379 413 450 464 q 220 366 313 366 q 69 414 130 366 q 0 567 0 470 l 85 567 q 126 470 85 504 q 225 437 168 437 q 320 467 280 437 q 360 552 360 498 q 318 632 360 608 q 213 657 276 657 q 195 657 203 657 q 176 657 181 657 l 176 722 q 279 733 249 722 q 334 815 334 752 q 300 881 334 856 q 220 907 267 907 q 133 875 169 907 q 97 781 97 844 l 15 781 q 78 926 15 875 q 220 972 135 972 q 364 930 303 972 q 426 817 426 888 q 344 697 426 733 q 421 642 392 681 q 450 552 450 603 "},"[":{x_min:0,x_max:273.609375,ha:371,o:"m 273 -281 l 0 -281 l 0 1013 l 273 1013 l 273 920 l 124 920 l 124 -187 l 273 -187 l 273 -281 "},L:{x_min:0,x_max:645.828125,ha:696,o:"m 645 0 l 0 0 l 0 1013 l 140 1013 l 140 126 l 645 126 l 645 0 "},"":{x_min:0,x_max:803.390625,ha:894,o:"m 803 628 l 633 628 q 713 368 713 512 q 618 93 713 204 q 357 -25 518 -25 q 94 91 194 -25 q 0 368 0 201 q 94 644 0 533 q 356 761 194 761 q 481 750 398 761 q 608 739 564 739 l 803 739 l 803 628 m 360 85 q 529 180 467 85 q 584 374 584 262 q 527 566 584 490 q 352 651 463 651 q 187 559 247 651 q 135 368 135 478 q 189 175 135 254 q 360 85 251 85 "},"":{x_min:0,x_max:573,ha:642,o:"m 573 -40 q 553 -162 573 -97 q 510 -278 543 -193 l 400 -278 q 441 -187 428 -219 q 462 -90 462 -132 q 378 -14 462 -14 q 108 45 197 -14 q 0 290 0 117 q 108 631 0 462 q 353 901 194 767 l 55 901 l 55 1012 l 561 1012 l 561 924 q 261 669 382 831 q 128 301 128 489 q 243 117 128 149 q 458 98 350 108 q 573 -40 573 80 "},"":{x_min:0,x_max:674,ha:778,o:"m 674 496 q 601 160 674 304 q 336 -26 508 -26 q 73 153 165 -26 q 0 485 0 296 q 72 840 0 683 q 343 1045 166 1045 q 605 844 516 1045 q 674 496 674 692 m 546 579 q 498 798 546 691 q 336 935 437 935 q 178 798 237 935 q 126 579 137 701 l 546 579 m 546 475 l 126 475 q 170 233 126 348 q 338 80 230 80 q 504 233 447 80 q 546 475 546 346 "},"":{x_min:0,x_max:958,ha:1054,o:"m 485 1042 q 834 883 703 1042 q 958 511 958 735 q 834 136 958 287 q 481 -26 701 -26 q 126 130 261 -26 q 0 504 0 279 q 127 880 0 729 q 485 1042 263 1042 m 480 98 q 731 225 638 98 q 815 504 815 340 q 733 783 815 670 q 480 913 640 913 q 226 785 321 913 q 142 504 142 671 q 226 224 142 339 q 480 98 319 98 "},"":{x_min:0,x_max:705.28125,ha:749,o:"m 705 886 l 140 886 l 140 0 l 0 0 l 0 1012 l 705 1012 l 705 886 "}," ":{x_min:0,x_max:0,ha:375},"%":{x_min:-3,x_max:1089,ha:1186,o:"m 845 0 q 663 76 731 0 q 602 244 602 145 q 661 412 602 344 q 845 489 728 489 q 1027 412 959 489 q 1089 244 1089 343 q 1029 76 1089 144 q 845 0 962 0 m 844 103 q 945 143 909 103 q 981 243 981 184 q 947 340 981 301 q 844 385 909 385 q 744 342 781 385 q 708 243 708 300 q 741 147 708 186 q 844 103 780 103 m 888 986 l 284 -25 l 199 -25 l 803 986 l 888 986 m 241 468 q 58 545 126 468 q -3 715 -3 615 q 56 881 -3 813 q 238 958 124 958 q 421 881 353 958 q 483 712 483 813 q 423 544 483 612 q 241 468 356 468 m 241 855 q 137 811 175 855 q 100 710 100 768 q 136 612 100 653 q 240 572 172 572 q 344 614 306 572 q 382 713 382 656 q 347 810 382 771 q 241 855 308 855 "},P:{x_min:0,x_max:726,ha:806,o:"m 424 1013 q 640 931 555 1013 q 726 719 726 850 q 637 506 726 587 q 413 426 548 426 l 140 426 l 140 0 l 0 0 l 0 1013 l 424 1013 m 379 889 l 140 889 l 140 548 l 372 548 q 522 589 459 548 q 593 720 593 637 q 528 845 593 801 q 379 889 463 889 "},"":{x_min:0,x_max:1078.21875,ha:1118,o:"m 1078 0 l 342 0 l 342 1013 l 1067 1013 l 1067 889 l 481 889 l 481 585 l 1019 585 l 1019 467 l 481 467 l 481 125 l 1078 125 l 1078 0 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "},"":{x_min:.125,x_max:1136.546875,ha:1235,o:"m 1136 0 l 722 0 l 722 123 q 911 309 842 194 q 981 558 981 423 q 893 813 981 710 q 651 923 800 923 q 411 821 501 923 q 321 568 321 720 q 390 316 321 433 q 579 123 459 200 l 579 0 l 166 0 l 166 124 l 384 124 q 235 327 289 210 q 182 572 182 444 q 311 912 182 782 q 651 1042 441 1042 q 989 910 858 1042 q 1120 569 1120 778 q 1066 326 1120 443 q 917 124 1013 210 l 1136 124 l 1136 0 m 277 1040 l 83 800 l 0 800 l 140 1041 l 277 1040 "},_:{x_min:0,x_max:705.5625,ha:803,o:"m 705 -334 l 0 -334 l 0 -234 l 705 -234 l 705 -334 "},"":{x_min:-110,x_max:246,ha:275,o:"m 246 1046 l 118 1046 l 118 1189 l 246 1189 l 246 1046 m 18 1046 l -110 1046 l -110 1189 l 18 1189 l 18 1046 m 136 0 l 0 0 l 0 1012 l 136 1012 l 136 0 "},"+":{x_min:23,x_max:768,ha:792,o:"m 768 372 l 444 372 l 444 0 l 347 0 l 347 372 l 23 372 l 23 468 l 347 468 l 347 840 l 444 840 l 444 468 l 768 468 l 768 372 "},"":{x_min:0,x_max:1050,ha:1149,o:"m 1050 0 l 625 0 q 712 178 625 108 q 878 277 722 187 q 967 385 967 328 q 932 456 967 429 q 850 484 897 484 q 759 450 798 484 q 721 352 721 416 l 640 352 q 706 502 640 448 q 851 551 766 551 q 987 509 931 551 q 1050 385 1050 462 q 976 251 1050 301 q 829 179 902 215 q 717 68 740 133 l 1050 68 l 1050 0 m 834 985 l 215 -28 l 130 -28 l 750 984 l 834 985 m 224 422 l 142 422 l 142 811 l 0 811 l 0 867 q 104 889 62 867 q 164 973 157 916 l 224 973 l 224 422 "},"":{x_min:0,x_max:720,ha:783,o:"m 424 1013 q 637 933 554 1013 q 720 723 720 853 q 633 508 720 591 q 413 426 546 426 l 140 426 l 140 0 l 0 0 l 0 1013 l 424 1013 m 378 889 l 140 889 l 140 548 l 371 548 q 521 589 458 548 q 592 720 592 637 q 527 845 592 801 q 378 889 463 889 "},"'":{x_min:0,x_max:139,ha:236,o:"m 139 851 q 102 737 139 784 q 0 669 65 690 l 0 734 q 59 787 42 741 q 72 873 72 821 l 0 873 l 0 1013 l 139 1013 l 139 851 "},"":{x_min:0,x_max:350,ha:397,o:"m 350 625 q 307 616 328 616 q 266 631 281 616 q 247 673 251 645 q 190 628 225 644 q 116 613 156 613 q 32 641 64 613 q 0 722 0 669 q 72 826 0 800 q 247 866 159 846 l 247 887 q 220 934 247 916 q 162 953 194 953 q 104 934 129 953 q 76 882 80 915 l 16 882 q 60 976 16 941 q 166 1011 104 1011 q 266 979 224 1011 q 308 891 308 948 l 308 706 q 311 679 308 688 q 331 670 315 670 l 350 672 l 350 625 m 247 757 l 247 811 q 136 790 175 798 q 64 726 64 773 q 83 682 64 697 q 132 667 103 667 q 207 690 174 667 q 247 757 247 718 "},"":{x_min:0,x_max:450,ha:553,o:"m 450 800 l 340 800 l 340 925 l 450 925 l 450 800 m 406 1040 l 212 800 l 129 800 l 269 1040 l 406 1040 m 110 800 l 0 800 l 0 925 l 110 925 l 110 800 "},T:{x_min:0,x_max:777,ha:835,o:"m 777 894 l 458 894 l 458 0 l 319 0 l 319 894 l 0 894 l 0 1013 l 777 1013 l 777 894 "},"":{x_min:0,x_max:915,ha:997,o:"m 527 0 l 389 0 l 389 122 q 110 231 220 122 q 0 509 0 340 q 110 785 0 677 q 389 893 220 893 l 389 1013 l 527 1013 l 527 893 q 804 786 693 893 q 915 509 915 679 q 805 231 915 341 q 527 122 696 122 l 527 0 m 527 226 q 712 310 641 226 q 779 507 779 389 q 712 705 779 627 q 527 787 641 787 l 527 226 m 389 226 l 389 787 q 205 698 275 775 q 136 505 136 620 q 206 308 136 391 q 389 226 276 226 "},"":{x_min:0,x_max:0,ha:694},j:{x_min:-77.78125,x_max:167,ha:349,o:"m 167 871 l 42 871 l 42 1013 l 167 1013 l 167 871 m 167 -80 q 121 -231 167 -184 q -26 -278 76 -278 l -77 -278 l -77 -164 l -41 -164 q 26 -143 11 -164 q 42 -65 42 -122 l 42 737 l 167 737 l 167 -80 "},"":{x_min:0,x_max:756.953125,ha:819,o:"m 756 0 l 0 0 l 0 107 l 395 523 l 22 904 l 22 1013 l 745 1013 l 745 889 l 209 889 l 566 523 l 187 125 l 756 125 l 756 0 "},1:{x_min:215.671875,x_max:574,ha:792,o:"m 574 0 l 442 0 l 442 697 l 215 697 l 215 796 q 386 833 330 796 q 475 986 447 875 l 574 986 l 574 0 "},"":{x_min:18.0625,x_max:774,ha:792,o:"m 774 376 l 18 40 l 18 149 l 631 421 l 18 692 l 18 799 l 774 465 l 774 376 "},"<":{x_min:17.984375,x_max:773.609375,ha:792,o:"m 773 40 l 18 376 l 17 465 l 773 799 l 773 692 l 159 420 l 773 149 l 773 40 "},"":{x_min:0,x_max:704.484375,ha:801,o:"m 704 41 q 623 -10 664 5 q 543 -26 583 -26 q 359 15 501 -26 q 243 36 288 36 q 158 23 197 36 q 73 -21 119 10 l 6 76 q 125 195 90 150 q 175 331 175 262 q 147 443 175 383 l 0 443 l 0 512 l 108 512 q 43 734 43 623 q 120 929 43 854 q 358 1010 204 1010 q 579 936 487 1010 q 678 729 678 857 l 678 684 l 552 684 q 504 838 552 780 q 362 896 457 896 q 216 852 263 896 q 176 747 176 815 q 199 627 176 697 q 248 512 217 574 l 468 512 l 468 443 l 279 443 q 297 356 297 398 q 230 194 297 279 q 153 107 211 170 q 227 133 190 125 q 293 142 264 142 q 410 119 339 142 q 516 96 482 96 q 579 105 550 96 q 648 142 608 115 l 704 41 "},t:{x_min:0,x_max:367,ha:458,o:"m 367 0 q 312 -5 339 -2 q 262 -8 284 -8 q 145 28 183 -8 q 108 143 108 64 l 108 638 l 0 638 l 0 738 l 108 738 l 108 944 l 232 944 l 232 738 l 367 738 l 367 638 l 232 638 l 232 185 q 248 121 232 140 q 307 102 264 102 q 345 104 330 102 q 367 107 360 107 l 367 0 "},"":{x_min:0,x_max:706,ha:803,o:"m 706 411 l 706 158 l 630 158 l 630 335 l 0 335 l 0 411 l 706 411 "},"":{x_min:0,x_max:750,ha:803,o:"m 750 -7 q 679 -15 716 -15 q 538 59 591 -15 q 466 214 512 97 l 336 551 l 126 0 l 0 0 l 270 705 q 223 837 247 770 q 116 899 190 899 q 90 898 100 899 l 90 1004 q 152 1011 125 1011 q 298 938 244 1011 q 373 783 326 901 l 605 192 q 649 115 629 136 q 716 95 669 95 l 736 95 q 750 97 745 97 l 750 -7 "},W:{x_min:0,x_max:1263.890625,ha:1351,o:"m 1263 1013 l 995 0 l 859 0 l 627 837 l 405 0 l 265 0 l 0 1013 l 136 1013 l 342 202 l 556 1013 l 701 1013 l 921 207 l 1133 1012 l 1263 1013 "},">":{x_min:18.0625,x_max:774,ha:792,o:"m 774 376 l 18 40 l 18 149 l 631 421 l 18 692 l 18 799 l 774 465 l 774 376 "},v:{x_min:0,x_max:675.15625,ha:761,o:"m 675 738 l 404 0 l 272 0 l 0 738 l 133 737 l 340 147 l 541 737 l 675 738 "},"":{x_min:.28125,x_max:644.5,ha:703,o:"m 644 628 l 382 628 l 382 179 q 388 120 382 137 q 436 91 401 91 q 474 94 447 91 q 504 97 501 97 l 504 0 q 454 -9 482 -5 q 401 -14 426 -14 q 278 67 308 -14 q 260 233 260 118 l 260 628 l 0 628 l 0 739 l 644 739 l 644 628 "},"":{x_min:0,x_max:624.9375,ha:699,o:"m 624 -37 q 608 -153 624 -96 q 563 -278 593 -211 l 454 -278 q 491 -183 486 -200 q 511 -83 511 -126 q 484 -23 511 -44 q 370 1 452 1 q 323 0 354 1 q 283 -1 293 -1 q 84 76 169 -1 q 0 266 0 154 q 56 431 0 358 q 197 538 108 498 q 94 613 134 562 q 54 730 54 665 q 77 823 54 780 q 143 901 101 867 l 27 901 l 27 1012 l 576 1012 l 576 901 l 380 901 q 244 863 303 901 q 178 745 178 820 q 312 600 178 636 q 532 582 380 582 l 532 479 q 276 455 361 479 q 118 281 118 410 q 165 173 118 217 q 274 120 208 133 q 494 101 384 110 q 624 -37 624 76 "},"&":{x_min:-3,x_max:894.25,ha:992,o:"m 894 0 l 725 0 l 624 123 q 471 0 553 40 q 306 -41 390 -41 q 168 -7 231 -41 q 62 92 105 26 q 14 187 31 139 q -3 276 -3 235 q 55 433 -3 358 q 248 581 114 508 q 170 689 196 640 q 137 817 137 751 q 214 985 137 922 q 384 1041 284 1041 q 548 988 483 1041 q 622 824 622 928 q 563 666 622 739 q 431 556 516 608 l 621 326 q 649 407 639 361 q 663 493 653 426 l 781 493 q 703 229 781 352 l 894 0 m 504 818 q 468 908 504 877 q 384 940 433 940 q 293 907 331 940 q 255 818 255 875 q 289 714 255 767 q 363 628 313 678 q 477 729 446 682 q 504 818 504 771 m 556 209 l 314 499 q 179 395 223 449 q 135 283 135 341 q 146 222 135 253 q 183 158 158 192 q 333 80 241 80 q 556 209 448 80 "},"":{x_min:0,x_max:862.5,ha:942,o:"m 862 0 l 719 0 l 426 847 l 143 0 l 0 0 l 356 1013 l 501 1013 l 862 0 "},I:{x_min:41,x_max:180,ha:293,o:"m 180 0 l 41 0 l 41 1013 l 180 1013 l 180 0 "},G:{x_min:0,x_max:921,ha:1011,o:"m 921 0 l 832 0 l 801 136 q 655 15 741 58 q 470 -28 568 -28 q 126 133 259 -28 q 0 499 0 284 q 125 881 0 731 q 486 1043 259 1043 q 763 957 647 1043 q 905 709 890 864 l 772 709 q 668 866 747 807 q 486 926 589 926 q 228 795 322 926 q 142 507 142 677 q 228 224 142 342 q 483 94 323 94 q 712 195 625 94 q 796 435 796 291 l 477 435 l 477 549 l 921 549 l 921 0 "},"":{x_min:0,x_max:617,ha:725,o:"m 524 800 l 414 800 l 414 925 l 524 925 l 524 800 m 183 800 l 73 800 l 73 925 l 183 925 l 183 800 m 617 352 q 540 93 617 199 q 308 -24 455 -24 q 76 93 161 -24 q 0 352 0 199 l 0 738 l 126 738 l 126 354 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 354 492 257 l 492 738 l 617 738 l 617 352 m 489 1040 l 300 819 l 216 819 l 351 1040 l 489 1040 "},"`":{x_min:0,x_max:138.890625,ha:236,o:"m 138 699 l 0 699 l 0 861 q 36 974 0 929 q 138 1041 72 1020 l 138 977 q 82 931 95 969 q 69 839 69 893 l 138 839 l 138 699 "},"":{x_min:0,x_max:142,ha:239,o:"m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 "},"":{x_min:.328125,x_max:819.515625,ha:889,o:"m 819 1013 l 482 416 l 482 0 l 342 0 l 342 416 l 0 1013 l 140 1013 l 411 533 l 679 1013 l 819 1013 "},r:{x_min:0,x_max:355.5625,ha:432,o:"m 355 621 l 343 621 q 179 569 236 621 q 122 411 122 518 l 122 0 l 0 0 l 0 737 l 117 737 l 117 604 q 204 719 146 686 q 355 753 262 753 l 355 621 "},x:{x_min:0,x_max:675,ha:764,o:"m 675 0 l 525 0 l 331 286 l 144 0 l 0 0 l 256 379 l 12 738 l 157 737 l 336 473 l 516 738 l 661 738 l 412 380 l 675 0 "},"":{x_min:0,x_max:696.609375,ha:747,o:"m 696 -4 q 628 -14 657 -14 q 498 97 513 -14 q 422 8 470 41 q 313 -24 374 -24 q 207 3 258 -24 q 120 80 157 31 l 120 -278 l 0 -278 l 0 738 l 124 738 l 124 343 q 165 172 124 246 q 308 82 216 82 q 451 177 402 82 q 492 358 492 254 l 492 738 l 616 738 l 616 214 q 623 136 616 160 q 673 92 636 92 q 696 95 684 92 l 696 -4 "},h:{x_min:0,x_max:615,ha:724,o:"m 615 472 l 615 0 l 490 0 l 490 454 q 456 590 490 535 q 338 654 416 654 q 186 588 251 654 q 122 436 122 522 l 122 0 l 0 0 l 0 1013 l 122 1013 l 122 633 q 218 727 149 694 q 362 760 287 760 q 552 676 484 760 q 615 472 615 600 "},".":{x_min:0,x_max:142,ha:239,o:"m 142 0 l 0 0 l 0 151 l 142 151 l 142 0 "},"":{x_min:-2,x_max:878,ha:974,o:"m 496 -279 l 378 -279 l 378 -17 q 101 88 204 -17 q -2 367 -2 194 q 68 626 -2 510 q 283 758 151 758 l 283 646 q 167 537 209 626 q 133 373 133 462 q 192 177 133 254 q 378 93 259 93 l 378 758 q 445 764 426 763 q 476 765 464 765 q 765 659 653 765 q 878 377 878 553 q 771 96 878 209 q 496 -17 665 -17 l 496 -279 m 496 93 l 514 93 q 687 183 623 93 q 746 380 746 265 q 691 569 746 491 q 522 658 629 658 l 496 656 l 496 93 "},";":{x_min:0,x_max:142,ha:239,o:"m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 m 142 -12 q 105 -132 142 -82 q 0 -206 68 -182 l 0 -138 q 58 -82 43 -123 q 68 0 68 -56 l 0 0 l 0 151 l 142 151 l 142 -12 "},f:{x_min:0,x_max:378,ha:472,o:"m 378 638 l 246 638 l 246 0 l 121 0 l 121 638 l 0 638 l 0 738 l 121 738 q 137 935 121 887 q 290 1028 171 1028 q 320 1027 305 1028 q 378 1021 334 1026 l 378 908 q 323 918 346 918 q 257 870 273 918 q 246 780 246 840 l 246 738 l 378 738 l 378 638 "},"":{x_min:1,x_max:348.21875,ha:454,o:"m 140 670 l 1 670 l 1 830 q 37 943 1 897 q 140 1011 74 990 l 140 947 q 82 900 97 940 q 68 810 68 861 l 140 810 l 140 670 m 348 670 l 209 670 l 209 830 q 245 943 209 897 q 348 1011 282 990 l 348 947 q 290 900 305 940 q 276 810 276 861 l 348 810 l 348 670 "},A:{x_min:.03125,x_max:906.953125,ha:1008,o:"m 906 0 l 756 0 l 648 303 l 251 303 l 142 0 l 0 0 l 376 1013 l 529 1013 l 906 0 m 610 421 l 452 867 l 293 421 l 610 421 "},6:{x_min:53,x_max:739,ha:792,o:"m 739 312 q 633 62 739 162 q 400 -31 534 -31 q 162 78 257 -31 q 53 439 53 206 q 178 859 53 712 q 441 986 284 986 q 643 912 559 986 q 732 713 732 833 l 601 713 q 544 830 594 786 q 426 875 494 875 q 268 793 331 875 q 193 517 193 697 q 301 597 240 570 q 427 624 362 624 q 643 540 552 624 q 739 312 739 451 m 603 298 q 540 461 603 400 q 404 516 484 516 q 268 461 323 516 q 207 300 207 401 q 269 137 207 198 q 405 83 325 83 q 541 137 486 83 q 603 298 603 197 "},"":{x_min:1,x_max:139.890625,ha:236,o:"m 139 670 l 1 670 l 1 830 q 37 943 1 897 q 139 1011 74 990 l 139 947 q 82 900 97 940 q 68 810 68 861 l 139 810 l 139 670 "},"":{x_min:-70,x_max:283,ha:361,o:"m 283 800 l 173 800 l 173 925 l 283 925 l 283 800 m 40 800 l -70 800 l -70 925 l 40 925 l 40 800 m 283 3 q 232 -10 257 -5 q 181 -15 206 -15 q 84 26 118 -15 q 41 200 41 79 l 41 737 l 166 737 l 167 215 q 171 141 167 157 q 225 101 182 101 q 247 103 238 101 q 283 112 256 104 l 283 3 "},"":{x_min:-.21875,x_max:773.21875,ha:857,o:"m 773 -7 l 707 -11 q 575 40 607 -11 q 552 174 552 77 l 552 226 l 552 626 l 222 626 l 222 0 l 97 0 l 97 626 l 0 626 l 0 737 l 773 737 l 773 626 l 676 626 l 676 171 q 695 103 676 117 q 773 90 714 90 l 773 -7 "},"":{x_min:0,x_max:765.5625,ha:809,o:"m 765 -4 q 698 -14 726 -14 q 564 97 586 -14 q 466 7 525 40 q 337 -26 407 -26 q 88 98 186 -26 q 0 369 0 212 q 88 637 0 525 q 337 760 184 760 q 465 727 407 760 q 563 637 524 695 l 563 738 l 685 738 l 685 222 q 693 141 685 168 q 748 94 708 94 q 765 95 760 94 l 765 -4 m 584 371 q 531 562 584 485 q 360 653 470 653 q 192 566 254 653 q 135 379 135 489 q 186 181 135 261 q 358 84 247 84 q 528 176 465 84 q 584 371 584 260 m 604 1040 l 415 819 l 332 819 l 466 1040 l 604 1040 "},O:{x_min:0,x_max:958,ha:1057,o:"m 485 1041 q 834 882 702 1041 q 958 512 958 734 q 834 136 958 287 q 481 -26 702 -26 q 126 130 261 -26 q 0 504 0 279 q 127 880 0 728 q 485 1041 263 1041 m 480 98 q 731 225 638 98 q 815 504 815 340 q 733 783 815 669 q 480 912 640 912 q 226 784 321 912 q 142 504 142 670 q 226 224 142 339 q 480 98 319 98 "},n:{x_min:0,x_max:615,ha:724,o:"m 615 463 l 615 0 l 490 0 l 490 454 q 453 592 490 537 q 331 656 410 656 q 178 585 240 656 q 117 421 117 514 l 117 0 l 0 0 l 0 738 l 117 738 l 117 630 q 218 728 150 693 q 359 764 286 764 q 552 675 484 764 q 615 463 615 593 "},3:{x_min:54,x_max:737,ha:792,o:"m 737 284 q 635 55 737 141 q 399 -25 541 -25 q 156 52 248 -25 q 54 308 54 140 l 185 308 q 245 147 185 202 q 395 96 302 96 q 539 140 484 96 q 602 280 602 190 q 510 429 602 390 q 324 454 451 454 l 324 565 q 487 584 441 565 q 565 719 565 617 q 515 835 565 791 q 395 879 466 879 q 255 824 307 879 q 203 661 203 769 l 78 661 q 166 909 78 822 q 387 992 250 992 q 603 921 513 992 q 701 723 701 844 q 669 607 701 656 q 578 524 637 558 q 696 434 655 499 q 737 284 737 369 "},9:{x_min:53,x_max:739,ha:792,o:"m 739 524 q 619 94 739 241 q 362 -32 516 -32 q 150 47 242 -32 q 59 244 59 126 l 191 244 q 246 129 191 176 q 373 82 301 82 q 526 161 466 82 q 597 440 597 255 q 363 334 501 334 q 130 432 216 334 q 53 650 53 521 q 134 880 53 786 q 383 986 226 986 q 659 841 566 986 q 739 524 739 719 m 388 449 q 535 514 480 449 q 585 658 585 573 q 535 805 585 744 q 388 873 480 873 q 242 809 294 873 q 191 658 191 745 q 239 514 191 572 q 388 449 292 449 "},l:{x_min:41,x_max:166,ha:279,o:"m 166 0 l 41 0 l 41 1013 l 166 1013 l 166 0 "},"":{x_min:40.09375,x_max:728.796875,ha:825,o:"m 728 304 l 649 224 l 512 363 q 383 331 458 331 q 256 363 310 331 l 119 224 l 40 304 l 177 441 q 150 553 150 493 q 184 673 150 621 l 40 818 l 119 898 l 267 749 q 321 766 291 759 q 384 773 351 773 q 447 766 417 773 q 501 749 477 759 l 649 898 l 728 818 l 585 675 q 612 618 604 648 q 621 553 621 587 q 591 441 621 491 l 728 304 m 384 682 q 280 643 318 682 q 243 551 243 604 q 279 461 243 499 q 383 423 316 423 q 487 461 449 423 q 525 553 525 500 q 490 641 525 605 q 384 682 451 682 "},"":{x_min:0,x_max:632.328125,ha:679,o:"m 632 0 l 482 0 l 225 384 l 124 288 l 124 0 l 0 0 l 0 738 l 124 738 l 124 446 l 433 738 l 596 738 l 312 466 l 632 0 "},4:{x_min:48,x_max:742.453125,ha:792,o:"m 742 243 l 602 243 l 602 0 l 476 0 l 476 243 l 48 243 l 48 368 l 476 958 l 602 958 l 602 354 l 742 354 l 742 243 m 476 354 l 476 792 l 162 354 l 476 354 "},p:{x_min:0,x_max:685,ha:786,o:"m 685 364 q 598 96 685 205 q 350 -23 504 -23 q 121 89 205 -23 l 121 -278 l 0 -278 l 0 738 l 121 738 l 121 633 q 220 726 159 691 q 351 761 280 761 q 598 636 504 761 q 685 364 685 522 m 557 371 q 501 560 557 481 q 330 651 437 651 q 162 559 223 651 q 108 366 108 479 q 162 177 108 254 q 333 87 224 87 q 502 178 441 87 q 557 371 557 258 "},"":{x_min:0,x_max:777,ha:835,o:"m 458 238 l 458 0 l 319 0 l 319 238 l 0 238 l 0 360 l 319 360 l 319 681 l 0 683 l 0 804 l 319 804 l 319 1015 l 458 1013 l 458 804 l 777 804 l 777 683 l 458 683 l 458 360 l 777 360 l 777 238 l 458 238 "},"":{x_min:0,x_max:808,ha:907,o:"m 465 -278 l 341 -278 l 341 -15 q 87 102 180 -15 q 0 378 0 210 l 0 739 l 133 739 l 133 379 q 182 195 133 275 q 341 98 242 98 l 341 922 l 465 922 l 465 98 q 623 195 563 98 q 675 382 675 278 l 675 742 l 808 742 l 808 381 q 720 104 808 213 q 466 -13 627 -13 l 465 -278 "},"":{x_min:.78125,x_max:697,ha:810,o:"m 697 -278 l 572 -278 l 572 454 q 540 587 572 536 q 425 650 501 650 q 271 579 337 650 q 206 420 206 509 l 206 0 l 81 0 l 81 489 q 73 588 81 562 q 0 644 56 644 l 0 741 q 68 755 38 755 q 158 720 124 755 q 200 630 193 686 q 297 726 234 692 q 434 761 359 761 q 620 692 544 761 q 697 516 697 624 l 697 -278 "}},cssFontWeight:"normal",ascender:1189,underlinePosition:-100,cssFontStyle:"normal",boundingBox:{yMin:-334,xMin:-111,yMax:1189,xMax:1672},resolution:1e3,original_font_information:{postscript_name:"Helvetiker-Regular",version_string:"Version 1.00 2004 initial release",vendor_url:"http://www.magenta.gr/",full_font_name:"Helvetiker",font_family_name:"Helvetiker",copyright:"Copyright (c) agenta ltd, 2004",description:"",trademark:"",designer:"",designer_url:"",unique_font_identifier:"agenta ltd:Helvetiker:22-10-104",license_url:"http://www.ellak.gr/fonts/MgOpen/license.html",license_description:'Copyright (c) 2004 by MAGENTA Ltd. All Rights Reserved.\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of the fonts accompanying this license ("Fonts") and associated documentation files (the "Font Software"), to reproduce and distribute the Font Software, including without limitation the rights to use, copy, merge, publish, distribute, and/or sell copies of the Font Software, and to permit persons to whom the Font Software is furnished to do so, subject to the following conditions: \r\n\r\nThe above copyright and this permission notice shall be included in all copies of one or more of the Font Software typefaces.\r\n\r\nThe Font Software may be modified, altered, or added to, and in particular the designs of glyphs or characters in the Fonts may be modified and additional glyphs or characters may be added to the Fonts, only if the fonts are renamed to names not containing the word "MgOpen", or if the modifications are accepted for inclusion in the Font Software itself by the each appointed Administrator.\r\n\r\nThis License becomes null and void to the extent applicable to Fonts or Font Software that has been modified and is distributed under the "MgOpen" name.\r\n\r\nThe Font Software may be sold as part of a larger software package but no copy of one or more of the Font Software typefaces may be sold by itself. \r\n\r\nTHE FONT SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT OF COPYRIGHT, PATENT, TRADEMARK, OR OTHER RIGHT. IN NO EVENT SHALL MAGENTA OR PERSONS OR BODIES IN CHARGE OF ADMINISTRATION AND MAINTENANCE OF THE FONT SOFTWARE BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, INCLUDING ANY GENERAL, SPECIAL, INDIRECT, INCIDENTAL, OR CONSEQUENTIAL DAMAGES, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF THE USE OR INABILITY TO USE THE FONT SOFTWARE OR FROM OTHER DEALINGS IN THE FONT SOFTWARE.',manufacturer_name:"agenta ltd",font_sub_family_name:"Regular"},descender:-334,familyName:"Helvetiker",lineHeight:1522,underlineThickness:50})}}]),t}(),Z={id:"id",name:"name",userID:"userid",position:"position",rotation:"rotation",scale:"scale",properties:"properties",plans:"plans",walls:"walls",placements:"placements",videoprobes:"videoprobes",groups:"groups",corners:"corners",holesCorners:"holescorners",holesPoints:"holespoints",doorOrWindows:"doororwindows",curveLines:"curvelines",pipeLines:"pipelines",text3Ds:"text3ds",rooms:"rooms",height:"height",thick:"thick",texture:"texture",type:"type",model:"model",suspendPercent:"suspendpercent",leftTexture:"lefttexture",rightTexture:"righttexture",edgeTexture:"edgetexture",floorTexture:"floortexture",ceilingTexture:"ceilingtexture",roofTexture:"rooftexture",isOpen:"isopen",openDirIndex:"diridx",isWindow:"iswindow",wallType:"type",uvmultiple:"uvmultiple",belongRoom:"_temp_belongroom",alwaysShowInsideObjs:"alwaysshowinsideobjs"},J=function(){function e(){l(this,e),this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.enableCombine=!0,this.defaultWallEdgeTextureUri="Textures/WallEdge.jpg",this.defaultWallTextureUri="Textures/RoomWall.jpg",this.defaultFloorTextureUri="Textures/FloorDefault.jpg",this.defaultCeilingTextureUri="Textures/CeilingDefault.jpg",this.defaultRoofTextureUri="Textures/RoofDefault.jpg",this.world=null,this.resourceManager=new I,y.enableBuildMesh=!1}return c(e,[{key:"parseObjects",value:function(e){return e?(e.url&&(this.sceneURL=e.url,this.resourceManager.localCustomModelBaseUrl=this.getParentRelativeUrl(this.sceneURL)),e.json&&(this.sceneJson=e.json),e.customModeBaseUrl&&(this.resourceManager.localCustomModelBaseUrl=e.customModeBaseUrl),this.parseSceneJson(),this.world):(console.error("load param can not be null"),null)}},{key:"getParentRelativeUrl",value:function(e){for(var t=e.split("/"),i="",r=0;r<t.length-1;r++){i+=t[r]+"/"}return i}},{key:"loadSceneJson",value:function(){var e=this;return new Promise(function(t,i){if(e.sceneJson)t(e.sceneJson);else if(e.sceneURL){(new THREE.FileLoader).load(e.sceneURL,function(i){e.sceneJson=JSON.parse(i),t()},function(){},function(t){i("can not load "+e.sceneURL)})}else i("load scene json error")})}},{key:"parseSceneJson",value:function(){this.resourceManager.delayDownload=!0,this.resourceManager.loadTextures(this.sceneJson.textures),this.resourceManager.loadModels(this.sceneJson.models),this.parseWorld(this.sceneJson)}},{key:"parseWorld",value:function(e){var t=new C;if(this.world=t,this.parseBaseObject(e,t),e.buildings)for(var i=e.buildings,r=0;r<i.length;r++){var n=i[r],o=this.parseBuilding(n);t.buildings.push(o)}if(e.outdoors){var a=new O;a.parent=t,this.parseFloorPlan(e.outdoors,a),t.outdoors=a}}},{key:"parseBuilding",value:function(e,t){var i=e,r=new P;this.parseBaseObject(e,r,t);var n=i[Z.plans];if(n)for(var o=0;o<n.length;o++){var a=n[o],s=new A;this.parseFloorPlan(a,s,r)}var l=i.facades;if(l)for(var c=0;c<l.length;c++){var u=l[c];this.parseFacade(u,r)}var h=i.facadegroups;if(h)for(c=0;c<h.length;c++){var p=h[c];this.parseFacadeGroup(p,r)}return r}},{key:"parseFloorPlan",value:function(e,t,i){if(this.parseBaseObject(e,t,i),e[Z.height]&&(t.height=e[Z.height]),e[Z.corners])for(var r=e[Z.corners],n=0;n<r.length;n++){var o=r[n],a=o[0],s=o[1],l=-o[2];t.existsCorner(a,s,l)?console.error("repeat corner"):t.addCorner(a,s,l)}if(e[Z.walls]){var c=e[Z.walls];for(n=0;n<c.length;n++){var u=c[n];this.parseWall(u,t)}}if(e[Z.rooms]){var h=e[Z.rooms];for(n=0;n<h.length;n++){var p=h[n];this.parseRoom(p,t)}t.calRoomsUV2()}if(e[Z.placements]){var d=e[Z.placements];for(n=0;n<d.length;n++){var f=d[n];this.parsePlacement(f,t)}}if(e[Z.videoprobes])for(d=e[Z.videoprobes],n=0;n<d.length;n++){f=d[n];this.parsePlacement(f,t)}if(e[Z.groups]){var m=e[Z.groups];for(n=0;n<m.length;n++){var g=m[n];this.parseGroup(g,t)}}if(e[Z.doorOrWindows]){var v=e[Z.doorOrWindows];for(n=0;n<v.length;n++){var y=v[n];this.parseDoorOrWindow(y,t)}}if(e[Z.curveLines]){var b=e[Z.curveLines];for(n=0;n<b.length;n++){var _=b[n];this.parseCurveLine(_,t)}}if(e[Z.pipeLines])for(b=e[Z.pipeLines],n=0;n<b.length;n++){_=b[n];this.parsePipeLine(_,t)}return e[Z.alwaysShowInsideObjs]&&(t.alwaysShowInsideObjs=e[Z.alwaysShowInsideObjs]),t}},{key:"parseText3D",value:function(e,t){var i=new Q;if(this.parseBaseObject(e,i,t),e.color){var r=e.color;i.color=new THREE.Color(r[0],r[1],r[2]),4===r.length&&(i.opacity=r[3])}void 0!==e.font&&(i.font=e.font),void 0!==e.text&&(i.text=e.text),t.text3Ds.push(i)}},{key:"parsePipeLine",value:function(e,t){var i=new Y;if(this.parseBaseObject(e,i,t),void 0!==e[Z.texture]?i.resource=this.resourceManager.textures[e[Z.texture]]:i.resource=this.resourceManager.emptyTextureResource,e.color){var r=e.color;i.color=new THREE.Color(r[0],r[1],r[2]),4===r.length&&(i.opacity=r[3])}e.sectionType&&(i.sectionType=e.sectionType),void 0!==e.rendermode&&(i.renderMode=e.rendermode),void 0!==e.radius&&(i.radius=e.radius),t.pipelines.push(i);for(var n=e.path,o=0;o<n.length;o++){var a=n[o],s=a[0],l=a[1],c=-a[2],u=new THREE.Vector3(s,l,c);i.points.push(u)}}},{key:"parseCurveLine",value:function(e,t){var i=new X;if(this.parseBaseObject(e,i,t),void 0!==e[Z.texture]?i.resource=this.resourceManager.textures[e[Z.texture]]:i.resource=this.resourceManager.emptyTextureResource,e.color){var r=e.color;i.color=new THREE.Color(r[0],r[1],r[2]),4===r.length&&(i.opacity=r[3])}void 0!==e.width&&(i.width=e.width),t.curvelines.push(i);for(var n=e.path,o=0;o<n.length;o++){var a=n[o],s=a[0],l=a[1],c=-a[2],u=new THREE.Vector3(s,l,c);i.points.push(u)}}},{key:"parseDoorOrWindow",value:function(e,t){var i=new q;if(this.parseBaseObject(e,i,t.parent),i.resource=this.resourceManager.models[e[Z.model]],t.doorOrWindows.push(i),e[Z.suspendPercent]&&(i.suspendPercent=e[Z.suspendPercent]),e[Z.isOpen]&&(i.isOpen=e[Z.isOpen]),e[Z.openDirIndex]&&(i.openDirIndex=e[Z.openDirIndex]),e[Z.isWindow]){var r=e[Z.isWindow];"string"==typeof r&&(r="false"!==r.toLocaleString()),i.isWindow=r}i.attachWall=t}},{key:"parseFacade",value:function(e,t){var i=new G;if(this.parseBaseObject(e,i,t),i.resource=this.resourceManager.models[e[Z.model]],void 0!==e.texture&&null!==e.texture&&(i.customTextureResource=this.resourceManager.textures[e.texture]),e.color){var r=e.color;i.customColor=new THREE.Color(r[0],r[1],r[2]),4===r.length&&(i.opacity=r[3])}e.rendermode&&(i.renderMode=e.rendermode)}},{key:"parseFacadeGroup",value:function(e,t){var i=new W;if(this.parseBaseObject(e,i,t),e[Z.placements])for(var r=e[Z.placements],n=0;n<r.length;n++){var o=r[n];this.parseFacadeGroupChild(o,i)}if(e[Z.groups]){var a=e[Z.groups];for(n=0;n<a.length;n++){var s=a[n];this.parseFacadeGroup(s,i)}}}},{key:"parseFacadeGroupChild",value:function(e,t){var i=new G;if(this.parseBaseObject(e,i,t),i.resource=this.resourceManager.models[e[Z.model]],void 0!==e.texture&&null!==e.texture&&(i.customTextureResource=this.resourceManager.textures[e.texture]),e.color){var r=e.color;i.customColor=new THREE.Color(r[0],r[1],r[2]),4===r.length&&(i.opacity=r[3])}e.rendermode&&(i.renderMode=e.rendermode)}},{key:"parsePlacement",value:function(e,t){var i=new V;if(this.parseBaseObject(e,i,t),i.resource=this.resourceManager.models[e[Z.model]],void 0!==e.texture&&null!==e.texture&&(i.customTextureResource=this.resourceManager.textures[e.texture]),e.color){var r=e.color;i.customColor=new THREE.Color(r[0],r[1],r[2]),4===r.length&&(i.opacity=r[3])}e.rendermode&&(i.renderMode=e.rendermode),e.animinfo&&(i.isPlayAnim=e.animinfo.isplay,i.animClip=e.animinfo.clip),e[Z.belongRoom]&&(i.belongRoomUserID=e[Z.belongRoom])}},{key:"parseGroup",value:function(e,t){var i=new z;if(this.parseBaseObject(e,i,t),e[Z.placements])for(var r=e[Z.placements],n=0;n<r.length;n++){var o=r[n];this.parsePlacement(o,i)}if(e[Z.groups]){var a=e[Z.groups];for(n=0;n<a.length;n++){var s=a[n];this.parseGroup(s,i)}}e[Z.belongRoom]&&(i.belongRoomUserID=e[Z.belongRoom]),i.collectChildrenResources()}},{key:"parseWall",value:function(e,t){var i=null;0===e[Z.wallType]?(i=new w).lightMapResource=f.wallLightMapResource:i=new U,this.parseBaseObject(e,i,t);var r=e[Z.corners];if(i.startCorner=t.corners[r[0]],i.endCorner=t.corners[r[1]],void 0!==e[Z.leftTexture]&&(i.leftResource=this.resourceManager.textures[e[Z.leftTexture]]),void 0!==e[Z.rightTexture]&&(i.rightResource=this.resourceManager.textures[e[Z.rightTexture]]),void 0!==e[Z.edgeTexture]&&(i.edgeResource=this.resourceManager.textures[e[Z.edgeTexture]]),void 0!==e[Z.uvmultiple]&&(i.uvMultiple=e[Z.uvmultiple]),void 0!==e[Z.model]&&(i.resource=this.resourceManager.models[e[Z.model]]),void 0!==e.isshow&&(i.isShow=e.isshow),e[Z.doorOrWindows])for(var n=e[Z.doorOrWindows],o=0;o<n.length;o++){var a=n[o];this.parseDoorOrWindow(a,i,t)}void 0!==e.height?i.height=e.height:i instanceof U&&(i.height=i.resource.modelSize.y),void 0!==e.thick&&(i.thick=e.thick),i.startCorner.addWall(i),i.endCorner.addWall(i)}},{key:"parseRoom",value:function(e,t){var i=new R;this.parseBaseObject(e,i,t);var r=e[Z.corners];if(r&&this.parseRoomCornerIndexs(i,r),0===i.points.length&&this.parseRoomPoints(i,e.points),0!==i.points.length){var n=e[Z.holesCorners];n&&this.parseRoomHoleIndexs(i,n);var o=e[Z.holesPoints];o&&this.parseRoomHolePoints(i,o),this.parseRoomBlockSize(i,e),this.parseRoomTextureInfo(i,e),this.parseRoomHeight(i,e,t),this.parseRoomVisible(i,e),this.setOutdoorFloorHeight(i,t),i.initShapePathPoints(),i.initShapeHolePoints()}else console.error("room points is null")}},{key:"parseRoomCornerIndexs",value:function(e,t){for(var i=[],r=e.parent,n=0;n<t.length;n++){var o=t[n],a=r.corners[o].position.clone();i.push(a)}e.points=i}},{key:"parseRoomPoints",value:function(e,t){if(t){for(var i=t.length,r=[],n=0;n<i;n++){var o=t[n],a=o[0],s=o[1],l=-o[2],c=new THREE.Vector3(a,s,l);r.push(c)}e.points=r}}},{key:"parseRoomHoleIndexs",value:function(e,t){for(var i=[],r=e.parent,n=(e.position,0);n<t.length;n++){for(var o=t[n],a=[],s=0;s<o.length;s++){var l=o[s];a.push(r.corners[l].position.clone())}i.push(a)}e.holes=i}},{key:"parseRoomHolePoints",value:function(e,t){for(var i=[],r=(e.parent,e.position,0);r<t.length;r++){for(var n=t[r],o=[],a=0;a<n.length;a++){var s=n[a],l=s[0],c=s[1],u=-s[2],h=new THREE.Vector3(l,c,u);o.push(h)}i.push(o)}e.holes=i}},{key:"parseRoomTextureInfo",value:function(e,t){void 0!==t[Z.floorTexture]&&(e.floorResource=this.resourceManager.textures[t[Z.floorTexture]],e.floor.resource=e.floorResource),void 0!==t[Z.ceilingTexture]&&(e.ceilingResource=this.resourceManager.textures[t[Z.ceilingTexture]],e.ceiling.resource=e.ceilingResource),void 0!==t[Z.roofTexture]&&(e.roofResource=this.resourceManager.textures[t[Z.roofTexture]],e.roof.resource=e.roofResource)}},{key:"parseRoomHeight",value:function(e,t,i){void 0!==t.ceilingheight?e.ceiling.height=t.ceilingheight:(e.ceiling.DefaultHeight=i.height-.1,e.ceiling.height=e.ceiling.DefaultHeight),void 0!==t.roofheight?e.roof.height=t.roofheight:(e.roof.defaultHeight=i.height,e.roof.height=e.roof.defaultHeight),void 0!==t.floorheight&&(e.floor.height=t.floorheight)}},{key:"parseRoomVisible",value:function(e,t){void 0!==t.isshowfloor&&(e.floor.isShow=t.isshowfloor),void 0!==t.isshowceiling&&(e.ceiling.isShow=t.isshowceiling),void 0!==t.isshowroof&&(e.roof.isShow=t.isshowroof)}},{key:"parseRoomBlockSize",value:function(e,t){if(t.floorblocksize){var i=t.floorblocksize;e.floor.blockSize=new THREE.Vector2(i[0],i[1])}if(t.ceilingblocksize){i=t.ceilingblocksize;e.ceiling.blockSize=new THREE.Vector2(i[0],i[1])}if(t.roofblocksize){i=t.roofblocksize;e.roof.blockSize=new THREE.Vector2(i[0],i[1])}}},{key:"setOutdoorFloorHeight",value:function(e,t){t instanceof O&&e.floor.height===e.floor.DefaultHeight&&(e.floor.height=0,e.floor.DefaultHeight=0)}},{key:"isCombine",value:function(e){return!(e.properties||e.userID||e.name)}},{key:"parseBaseObject",value:function(e,t,i){var r,n,o;if(t.parent=i,e[Z.id]&&(r=e[Z.id],t.id=r),e[Z.userID]&&(o=e[Z.userID],t.userID=o),e[Z.name]&&(n=e[Z.name],t.name=n),t.jsonData=e,e[Z.position]){var a=e[Z.position];t.position.set(a[0],a[1],-a[2])}if(e[Z.scale]){var s=e[Z.scale],l=t.scale;0===s[0]&&(s[0]=.01),0===s[1]&&(s[1]=.01),0===s[2]&&(s[2]=.01),l.set(s[0],s[1],s[2])}if(e[Z.rotation]){var c=e[Z.rotation];t.rotation.set(c[0],c[1],-c[2],-c[3])}e[Z.properties]&&(t.properties=e[Z.properties]),void 0!==e.isshow&&null!==e.isshow&&(t.isShow=e.isshow)}},{key:"createRooms",value:function(){for(var e=[],t=0;t<this.curFloorPlan.rooms.length;t++){var i=this.curFloorPlan.rooms[t];e.push(i.meshGroup)}return e}}]),e}(),K={id:"id",name:"name",position:"position",rotation:"rotation",scale:"scale",properties:"properties",plans:"plans",walls:"walls",placements:"placements",videoprobes:"videoprobes",groups:"groups",corners:"corners",doorOrWindows:"doororwindows",curveLines:"curvelines",pipeLines:"pipelines",text3Ds:"text3ds",rooms:"rooms",height:"height",thick:"thick",texture:"texture",type:"type",model:"model",suspendPercent:"suspendpercent",leftTexture:"lefttexture",rightTexture:"righttexture",edgeTexture:"edgetexture",floorTexture:"floortexture",ceilingTexture:"ceilingtexture",roofTexture:"rooftexture",floorBlockSize:"floorblocksize",roofBlockSize:"roofblocksize",ceilingBlockSize:"ceilingblocksize",isOpen:"isopen",wallType:"type"},$=function(){function e(){l(this,e),this.sceneJson=null,this.scale=1,this.enableCombine=!0,this.pointInLineDeviation=.001,this.world=null,this.resourceManager=new I,this.defaultFloorTextureResource=new j(this.resourceManager),this.defaultFloorTextureResource.id="IQR8PZE2SGEV2H07WX3EJK22CA6ZS0YG",this.defaultFloorTextureResource.ext="jpg",this.defaultFloorTextureResource.baseUrl=this.resourceManager.baseTextureUrl,this.defaultCeilingTextureResource=new j(this.resourceManager),this.defaultCeilingTextureResource.id="UPEUIZIK19VMBPP9TLZJ3J3ILWK8V5ZB",this.defaultCeilingTextureResource.ext="jpg",this.defaultCeilingTextureResource.baseUrl=this.resourceManager.baseTextureUrl,this.defaultRoofTextureResource=new j(this.resourceManager),this.defaultRoofTextureResource.id="3OZVGE55PV0MY48FPRG5BELXKHV26NU5",this.defaultRoofTextureResource.ext="jpg",this.defaultRoofTextureResource.baseUrl=this.resourceManager.baseTextureUrl,y.enableBuildMesh=!1}return c(e,[{key:"parseObjects",value:function(e){return e?(e.url&&(this.sceneURL=e.url,this.resourceManager.localCustomModelBaseUrl=this.getParentRelativeUrl(this.sceneURL)),e.json&&(this.sceneJson=e.json),e.customModeBaseUrl&&(this.resourceManager.localCustomModelBaseUrl=e.customModeBaseUrl),this.parseSceneJson(),this.world):(console.error("load param can not be null"),null)}},{key:"_nestingLoopYield",value:function(e,t,i){var r=this,n=e.next();if(n.done)return t&&t(),n.value;var o=n.value;n.done;o instanceof Promise?o.then(function(n){return r._nestingLoopYield(e,t,i)}).catch(function(e){i(e)}):this._nestingLoopYield(e,t,i)}},{key:"delayLoad",value:function(e){var t=this;return e?(e.url&&(this.sceneURL=e.url,this.resourceManager.localCustomModelBaseUrl=this.getParentRelativeUrl(this.sceneURL)),e.json&&(this.sceneJson=e.json),e.customModeBaseUrl&&(this.resourceManager.localCustomModelBaseUrl=e.customModeBaseUrl),t.parseSceneJson(),new Promise(function(e,i){e(t.world)})):(console.error("load param can not be null"),null)}},{key:"loadResources",value:function(){var e=this;return new Promise(function(t,i){e.resourceManager.downloadResourcesWithQueue(function(){t(e.world)})})}},{key:"getParentRelativeUrl",value:function(e){for(var t=e.split("/"),i="",r=0;r<t.length-1;r++){i+=t[r]+"/"}return i}},{key:"loadSceneJson",value:function(){var e=this;return new Promise(function(t,i){if(e.sceneJson)t(e.sceneJson);else if(e.sceneURL){(new THREE.FileLoader).load(e.sceneURL,function(i){e.sceneJson=JSON.parse(i),t()},function(){},function(t){i("can not load "+e.sceneURL)})}else i("load scene json error")})}},{key:"createTextureLoaderPromise",value:function(e){return new Promise(function(t,i){(new THREE.TextureLoader).load(e,function(e){e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,t(e)},function(t){console.log(e+" "+t.loaded/t.total*100+"% loaded")},function(i){t(null),console.log(e+"load error")})})}},{key:"parseSceneJson",value:function(){this.resourceManager.delayDownload=!0,this.resourceManager.loadTextures(this.sceneJson.textures),this.resourceManager.loadModels(this.sceneJson.models),this.parseWorld(this.sceneJson)}},{key:"parseWorld",value:function(e){var t=new C;this.world=t,e.unit&&(this.scale=.01*e.unit),e.planheight&&(this.planHeight=e.planheight);var i=this.parseBuilding(e,t);t.buildings.push(i);var r=new O;t.outdoors=r}},{key:"parseBuilding",value:function(e,t){var i=new P,r=new A;return r.parent=i,this.parseFloorPlan(e,r,i),i.floorplans.push(r),i}},{key:"parseFloorPlan",value:function(e,t,i){return this.planHeight&&(t.height=this.planHeight),e.walls&&this.parseWall(e.walls,t),e.rooms&&this.parseRoom(e.rooms,t),e.doors&&this.parseDoorJson(e.doors,t),t}},{key:"parseDoorJson",value:function(e,t){for(var i=0,r=e.length;i<r;i++){var n=e[i],o=n.height*this.scale,a=n.width*this.scale,s=n.pos[0]*this.scale,l=n.pos[1]*this.scale,c=new THREE.Vector3(s,0,l),u=this.getPointOnWhichWall(t,c);if(null!==u){var h=new q;n.suspendpercent&&(h.suspendPercent=n.suspendpercent),h.resource=new j,h.resource.modelSize=new THREE.Vector3(a,o,.15),h.position=c,u.doorOrWindows.push(h)}else console.warn("can not find door on which wall!")}}},{key:"getPointOnWhichWall",value:function(e,t){for(var i=e.walls,r=0;r<i.length;r++){var n=i[r];if(this.isPointOnLineAndBetweenPoints(n.startCorner.position,n.endCorner.position,t))return n}return null}},{key:"isPointOnLine",value:function(e,t,i){var r=new THREE.Vector3;return r.crossVectors(e.clone().sub(i),t.clone().sub(i)),r.length()<this.pointInLineDeviation}},{key:"isPointOnLineAndBetweenPoints",value:function(e,t,i){if(!this.isPointOnLine(e,t,i))return!1;var r=t.x-e.x,n=t.z-e.z;return Math.abs(r)>=Math.abs(n)?r>0?e.x<=i.x&&i.x<=t.x:t.x<=i.x&&i.x<=e.x:n>0?e.z<=i.z&&i.z<=t.z:t.z<=i.z&&i.z<=e.z}},{key:"parseWall",value:function(e,t){for(var i=0,r=e.length;i<r;i++){var n=e[i],o=n[K.wallType],a=n.start[0]*this.scale,s=n.start[1]*this.scale,l=null,c=null;l=t.existsCorner(a,0,s)?t.getCorner(a,0,s):t.addCorner(a,0,s),a=n.end[0]*this.scale,s=n.end[1]*this.scale,c=t.existsCorner(a,0,s)?t.getCorner(a,0,s):t.addCorner(a,0,s);var u=null;0===o?(u=new w).lightMapResource=f.wallLightMapResource:u=new U,n.height?u.height=n.height:this.planHeight&&(u.height=this.planHeight),void 0!==n[K.leftTexture]&&(u.leftResource=this.resourceManager.textures[n[K.leftTexture]]),void 0!==n[K.rightTexture]&&(u.rightResource=this.resourceManager.textures[n[K.rightTexture]]),void 0!==n[K.edgeTexture]&&(u.edgeResource=this.resourceManager.textures[n[K.edgeTexture]]),void 0!==n[K.model]&&(u.resource=this.resourceManager.models[n[K.model]]),u.startCorner=l,u.endCorner=c,u.startCorner.addWall(u),u.endCorner.addWall(u),u.parent=t}}},{key:"parseRoom",value:function(e,t){for(var i=0;i<e.length;i++){var r=e[i],n=new R;n.parent=t,this.parseRoomTextureInfo(n,r),this.parseRoomHeightInfo(n,r),this.parseRoomBlockSize(n,r),this.parseRoomPoints(n,r),this.parseRoomVisibleInfo(n,r)}}},{key:"parseRoomTextureInfo",value:function(e,t){e.floor.resource=this.defaultFloorTextureResource,e.ceiling.resource=this.defaultCeilingTextureResource,e.roof.resource=this.defaultRoofTextureResource,void 0!==t[K.roofTexture]&&(e.roof.resource=this.resourceManager.textures[t[K.roofTexture]]),void 0!==t[K.floorTexture]&&(e.floor.resource=this.resourceManager.textures[t[K.floorTexture]]),void 0!==t[K.ceilingTexture]&&(e.ceiling.resource=this.resourceManager.textures[t[K.ceilingTexture]])}},{key:"parseRoomBlockSize",value:function(e,t){if(t[K.floorBlockSize]){var i=t[K.floorBlockSize];e.floor.blockSize=new THREE.Vector2(i[0],i[1])}if(t[K.ceilingBlockSize]){i=t[K.ceilingBlockSize];e.ceiling.blockSize=new THREE.Vector2(i[0],i[1])}if(t[K.roofBlockSize]){i=t[K.roofBlockSize];e.roof.blockSize=new THREE.Vector2(i[0],i[1])}}},{key:"parseRoomHeightInfo",value:function(e,t){t.floorheight&&(e.floor.height=t.floorheight),t.roofheight&&(e.roof.height=t.roofheight),t.ceilingheight&&(e.ceiling.height=t.ceilingheight)}},{key:"parseRoomPoints",value:function(e,t){for(var i=[],r=null,n=0;n<t.points.length;n++){var o=t.points[n];i.push(new THREE.Vector3(o[0]*this.scale,0,o[1]*this.scale))}if(t.holes){r=[];for(n=0;n<t.holes.length;n++){for(var a=t.holes[n],s=[],l=0;l<a.length;l++){o=a[l];s.push(new THREE.Vector3(o[0]*this.scale,0,o[1]*this.scale))}r.push(s)}}if(e.points=i,r&&(e.holes=r),t.center){var c=new THREE.Vector3;c.x=t.center[0],c.y=0,c.z=t.center[1],e.center=c}if(t.offset){var u=new THREE.Vector3;u.x=t.offset[0],u.y=t.offset[1],u.z=t.offset[2],e.offset=u}if(t.parentPosition){var h=new THREE.Vector3;h.x=t.parentPosition[0],h.y=t.parentPosition[1],h.z=t.parentPosition[2],e.parentPosition=h}e.initShapePathPoints(),e.initShapeHolePoints()}},{key:"parseRoomVisibleInfo",value:function(e,t){void 0!==t.isshowceiling&&(e.ceiling.isShow=t.isshowceiling),void 0!==t.isshowroof&&(e.roof.isShow=t.isshowroof),void 0!==t.isshowfloor&&(e.floor.isShow=t.isshowfloor)}}]),e}(),ee=(function(){function e(){l(this,e),this.sceneJson=null,this.scale=1,this.enableCombine=!0,this.pointInLineDeviation=.001,this.world=null,this.resourceManager=new I,this.defaultWallEdgeResource=new j(this.resourceManager),this.defaultWallEdgeResource.id="EB9ECFA1101C4A0ABB770ED3A9865441",this.defaultWallEdgeResource.ext="jpg",this.defaultWallEdgeResource.baseUrl=this.resourceManager.baseTextureUrl,this.defaultWallTextureResource=new j(this.resourceManager),this.defaultWallTextureResource.id="81FDB96B43D441C5B3C650BFA2B76CD4",this.defaultWallTextureResource.ext="jpg",this.defaultWallTextureResource.isDefault=!0,this.defaultWallTextureResource.baseUrl=this.resourceManager.baseTextureUrl,this.defaultFloorTextureResource=new j(this.resourceManager),this.defaultFloorTextureResource.id="IQR8PZE2SGEV2H07WX3EJK22CA6ZS0YG",this.defaultFloorTextureResource.ext="jpg",this.defaultFloorTextureResource.baseUrl=this.resourceManager.baseTextureUrl,this.defaultCeilingTextureResource=new j(this.resourceManager),this.defaultCeilingTextureResource.id="UPEUIZIK19VMBPP9TLZJ3J3ILWK8V5ZB",this.defaultCeilingTextureResource.ext="jpg",this.defaultCeilingTextureResource.baseUrl=this.resourceManager.baseTextureUrl,this.defaultRoofTextureResource=new j(this.resourceManager),this.defaultRoofTextureResource.id="3OZVGE55PV0MY48FPRG5BELXKHV26NU5",this.defaultRoofTextureResource.ext="jpg",this.defaultRoofTextureResource.baseUrl=this.resourceManager.baseTextureUrl,y.enableBuildMesh=!1}c(e,[{key:"parseObjects",value:function(e){return e?(e.url&&(this.sceneURL=e.url,this.resourceManager.localCustomModelBaseUrl=this.getParentRelativeUrl(this.sceneURL)),e.json&&(this.sceneJson=e.json),e.customModeBaseUrl&&(this.resourceManager.localCustomModelBaseUrl=e.customModeBaseUrl),this.parseSceneJson(),this.world):(console.error("load param can not be null"),null)}},{key:"_nestingLoopYield",value:function(e,t,i){var r=this,n=e.next();if(n.done)return t&&t(),n.value;var o=n.value;n.done;o instanceof Promise?o.then(function(n){return r._nestingLoopYield(e,t,i)}).catch(function(e){i(e)}):this._nestingLoopYield(e,t,i)}},{key:"delayLoad",value:function(e){var t=this;return e?(e.url&&(this.sceneURL=e.url,this.resourceManager.localCustomModelBaseUrl=this.getParentRelativeUrl(this.sceneURL)),e.json&&(this.sceneJson=e.json),e.customModeBaseUrl&&(this.resourceManager.localCustomModelBaseUrl=e.customModeBaseUrl),t.parseSceneJson(),new Promise(function(e,i){e(t.world)})):(console.error("load param can not be null"),null)}},{key:"loadResources",value:function(){var e=this;return new Promise(function(t,i){e.resourceManager.downloadResourcesWithQueue(function(){t(e.world)})})}},{key:"getParentRelativeUrl",value:function(e){for(var t=e.split("/"),i="",r=0;r<t.length-1;r++){i+=t[r]+"/"}return i}},{key:"loadSceneJson",value:function(){var e=this;return new Promise(function(t,i){if(e.sceneJson)t(e.sceneJson);else if(e.sceneURL){(new THREE.FileLoader).load(e.sceneURL,function(i){e.sceneJson=JSON.parse(i),t()},function(){},function(t){i("can not load "+e.sceneURL)})}else i("load scene json error")})}},{key:"createTextureLoaderPromise",value:function(e){return new Promise(function(t,i){(new THREE.TextureLoader).load(e,function(e){e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,t(e)},function(t){console.log(e+" "+t.loaded/t.total*100+"% loaded")},function(i){t(null),console.log(e+"load error")})})}},{key:"parseSceneJson",value:function(){this.parseWorld(this.sceneJson)}},{key:"parseWorld",value:function(e){var t=new C;this.world=t,e.unit&&(this.scale=.01*e.unit),e.planheight&&(this.planHeight=e.planheight);var i=this.parseBuilding(e,t);t.buildings.push(i),i.parent=t;var r=new O;r.parent=t,this.parseFloorPlan(e,r),t.outdoors=r}},{key:"parseBuilding",value:function(e,t){var i=new P,r=new A;return this.parseFloorPlan(e,r,i),r.parent=i,i}},{key:"parseFloorPlan",value:function(e,t,i){return this.planHeight&&(t.height=this.planHeight),e.walls&&this.parseWall(e.walls,t),e.rooms&&this.parseRoom(e.rooms,t),e.doors&&this.parseDoorJson(e.doors,t),t}},{key:"parseDoorJson",value:function(e,t){for(var i=0,r=e.length;i<r;i++){var n=e[i],o=n.height*this.scale,a=n.width*this.scale,s=n.pos[0]*this.scale,l=n.pos[1]*this.scale,c=new THREE.Vector3(s,0,l),u=this.getPointOnWhichWall(t,c);if(null!==u){var h=new q;n.suspendpercent&&(h.suspendPercent=n.suspendpercent),h.resource=new j,h.resource.modelSize=new THREE.Vector3(a,o,.15),h.position=c,u.doorOrWindows.push(h)}else console.warn("can not find door on which wall!")}}},{key:"getPointOnWhichWall",value:function(e,t){for(var i=e.walls,r=0;r<i.length;r++){var n=i[r];if(this.isPointOnLineAndBetweenPoints(n.startCorner.position,n.endCorner.position,t))return n}return null}},{key:"isPointOnLine",value:function(e,t,i){var r=new THREE.Vector3;return r.crossVectors(e.clone().sub(i),t.clone().sub(i)),r.length()<this.pointInLineDeviation}},{key:"isPointOnLineAndBetweenPoints",value:function(e,t,i){if(!this.isPointOnLine(e,t,i))return!1;var r=t.x-e.x,n=t.z-e.z;return Math.abs(r)>=Math.abs(n)?r>0?e.x<=i.x&&i.x<=t.x:t.x<=i.x&&i.x<=e.x:n>0?e.z<=i.z&&i.z<=t.z:t.z<=i.z&&i.z<=e.z}},{key:"parseWall",value:function(e,t){for(var i=0,r=e.length;i<r;i++){var n=e[i],o=n.start[0]*this.scale,a=n.start[1]*this.scale,s=null,l=null;s=t.existsCorner(o,0,a)?t.getCorner(o,0,a):t.addCorner(o,0,a),o=n.end[0]*this.scale,a=n.end[1]*this.scale,l=t.existsCorner(o,0,a)?t.getCorner(o,0,a):t.addCorner(o,0,a);var c=new w;n.height?c.height=n.height:this.planHeight&&(c.height=this.planHeight),c.leftResource=this.defaultWallTextureResource,c.rightResource=this.defaultWallTextureResource,c.edgeResource=this.defaultWallEdgeResource,c.lightMapResource=f.wallLightMapResource,c.startCorner=s,c.endCorner=l,c.startCorner.addWall(c),c.endCorner.addWall(c),c.parent=t}}},{key:"parseRoom",value:function(e,t){for(var i=0;i<e.length;i++){for(var r=e[i],n=[],o=null,a=0;a<r.points.length;a++){var s=r.points[a];n.push(new THREE.Vector3(s[0]*this.scale,0,s[1]*this.scale))}if(r.holes){o=[];for(a=0;a<r.holes.length;a++){for(var l=r.holes[a],c=[],u=0;u<l.length;u++){s=l[u];c.push(new THREE.Vector3(s[0]*this.scale,0,s[1]*this.scale))}o.push(c)}}var h=new R;if(h.floor.resource=this.defaultFloorTextureResource,h.ceiling.resource=this.defaultCeilingTextureResource,h.roof.resource=this.defaultRoofTextureResource,h.lightMapResource=f.floorLightMapResource,h.floorResource=this.defaultFloorTextureResource,h.ceilingResource=this.defaultCeilingTextureResource,h.roofResource=this.defaultRoofTextureResource,h.lightMapResource=f.floorLightMapResource,h.points=n,o&&(h.holes=o),r.center){var p=new THREE.Vector3;p.x=r.center[0],p.y=0,p.z=r.center[1],h.center=p}if(r.offset){var d=new THREE.Vector3;d.x=r.offset[0],d.y=r.offset[1],d.z=r.offset[2],h.offset=d}if(r.parentPosition){var m=new THREE.Vector3;m.x=r.parentPosition[0],m.y=r.parentPosition[1],m.z=r.parentPosition[2],h.parentPosition=m}h.parent=t,h.initShapePathPoints(),h.initShapeHolePoints()}}},{key:"createRooms",value:function(){for(var e=[],t=0;t<plan.rooms.length;t++){var i=plan.rooms[t];e.push(i.meshGroup)}return e}},{key:"createWalls",value:function(){for(var e=[],t=0;t<this.world.buildings.length;t++)for(var i=this.world.buildings[t],r=0;r<i.floorplans.length;r++)for(var n=i.floorplans[r],o=0;o<n.walls.length;o++){var a=n.walls[o];e.push(a.wallGroup)}return e}},{key:"createWallMesh",value:function(e){var t=new THREE.BufferGeometry;t.addAttribute("position",new THREE.BufferAttribute(e.positionArray,3)),t.addAttribute("normal",new THREE.BufferAttribute(e.normalArray,3)),t.addAttribute("uv",new THREE.BufferAttribute(e.uvArray,2));var i=e.material;return new THREE.Mesh(t,i)}}])}(),function(e){function t(){l(this,t);var e=p(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.resource=null,e.model=null,e.objPositions=[],e.objLocalPositions=[],e.objRotations=[],e.objScales=[],e.modelSize=new THREE.Vector3,e.box=new THREE.Box3,e.heightRatio=1,e.modelNumber=-1,e.models=[],e.mesh=new THREE.Object3D,e.wallGroup=e.mesh,e.subWalls=[],e.subCorners=[],e}h(t,v),c(t,[{key:"build",value:function(){this.baseBuild(),this.resource&&(this.resource.ready||y.enableCombine?this.model=this.resource.model:this.resource.registerListener(this)),null!==this.model&&(this.calObjInfo(),this.enableBuildMesh&&this.instanceModels())}},{key:"resourceCallback",value:function(e){this.model=e.model,this.calObjInfo(),this.instanceModels()}},{key:"instanceModels",value:function(){if(null!==this.model){this.models=[];for(var e=this.modelNumber,t=0;t<e;t++){var i=this.model.clone(),r=this.objPositions[t],n=this.objRotations[t],o=this.objScales[t];i.position.set(r.x,r.y,r.z),i.quaternion.set(n.x,n.y,n.z,n.w),i.scale.set(o.x,o.y,o.z),this.mesh.add(i),this.models.push(i)}}}},{key:"calObjInfo",value:function(){if(this.objPositions=[],this.objRotations=[],this.objScales=[],null!==this.model){this.box.makeEmpty(),this.box=this.box.setFromObject(this.model),this.modelSize=this.box.getSize(new THREE.Vector3(0,0,0)),-1===this.height?this.height=this.modelSize.y:0!==this.modelSize.y?this.heightRatio=this.height/this.modelSize.y:(console.warn("model size is zero "+this.resource.id),this.height=3);var e=new THREE.Vector3(0,-1,0),t=this.modelSize.x,i=(this.modelSize.z,this.modelSize.y),r=this.length/t,n=parseInt(r),o=Math.ceil(r);this.modelNumber=o;var a=o*t,s=new THREE.Vector3,l=this.direction.clone();s.addVectors(this.startCorner.position,l.multiplyScalar(a));var c=new THREE.Vector3;c.crossVectors(this.direction,e),c.normalize();var u=new THREE.Quaternion;0===c.x&&0===c.y&&0===c.z||u.setFromUnitVectors(new THREE.Vector3(0,0,-1),c);var h=.5*t,p=new THREE.Vector3(h,0,0);this.position;p.applyQuaternion(u),u.multiply(new THREE.Quaternion(0,1,0,0));for(var d=0;d<o;d++){var f=d/o,m=new THREE.Vector3;m.lerpVectors(this.startCorner.position,s,f);var g=new THREE.Vector3;g.addVectors(p,m),this.objPositions.push(g),this.objRotations.push(u);var v=new THREE.Vector3(1,this.height/i,1);this.objScales.push(v)}var y=(r-n)*t,b=y/t;if(o>0&&y>0){this.objScales[o-1]=new THREE.Vector3(b,this.height/i,1);var _=h,x=new THREE.Vector3(_*(1-b),0,0);x.applyQuaternion(u),this.objPositions[o-1].add(x)}}}}])}(),function(e){function t(){return l(this,t),p(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return h(t,V),t}()),te=function(){function e(t,r){i(this,e),this.vertexCount=0,this.indexCount=0,this.material=t,this.bundeMeshs=[],this.groups=[],this.transformations=[],this.maxCount=65534,this.combineMesh=null,this.combineManager=r}return r(e,[{key:"isExceed",value:function(e){return this.vertexCount+e>this.maxCount}},{key:"build",value:function(){for(var e=this.bundeMeshs,t=this.indexCount,i=this.vertexCount,r=new Float32Array(3*i),n=new Float32Array(3*i),o=new Float32Array(2*i),a=new Float32Array(4*i),s=new Float32Array(2*i),l=new Uint16Array(t),c=0,u=0,h=0,p=0,d=0,f=new THREE.BufferGeometry,m=0;m<e.length;m++){for(var g=e[m],v=this.transformations[m],y=v.positions,b=v.scales,_=v.quaternions,x=g.indexArray,E=0;E<x.length;E++)l[E+p]=c/3+x[E];p+=x.length;var w=g.positionArray;for(E=0;E<w.length;){for(var T=new THREE.Vector3(w[E],w[E+1],w[E+2]),S=y.length-1;S>-1;S--){var M=y[S],R=b[S],P=_[S];T.x*=R.x,T.y*=R.y,T.z*=R.z,(T=T.applyQuaternion(P)).x+=M.x,T.y+=M.y,T.z+=M.z}r[E+c]=T.x,r[E+c+1]=T.y,r[E+c+2]=T.z,E+=3}c+=w.length;var A=g.normalArray;for(E=0;E<A.length;){var C=new THREE.Vector3(A[E],A[E+1],A[E+2]);for(S=_.length-1;S>-1;S--){P=_[S];C=C.applyQuaternion(P)}n[E+u]=C.x,n[E+u+1]=C.y,n[E+u+2]=C.z,E+=3}u+=A.length;var O=g.uvArray;if(O)for(E=0;E<O.length;E++)o[E+h]=O[E];var L=g.uv2Array;if(L)for(E=0;E<L.length;E++)s[E+h]=L[E];O&&(h+=O.length);var k=g.colorArray;if(k){for(E=0;E<k.length;E++)a[E+d]=k[E];d+=k.length}}f.addAttribute("position",new THREE.BufferAttribute(r,3)),f.addAttribute("normal",new THREE.BufferAttribute(n,3)),f.addAttribute("uv",new THREE.BufferAttribute(o,2)),0!==s.length&&f.addAttribute("uv2",new THREE.BufferAttribute(s,2)),0!==a.length&&f.addAttribute("color",new THREE.BufferAttribute(a,4)),f.setIndex(new THREE.BufferAttribute(l,1));var H=new THREE.Mesh(f,this.material);this.material.defines&&this.material.defines.USE_ALPHAINDEX&&delete this.material.defines.USE_ALPHAINDEX,H.name="combine",this.combineMesh=H}}]),e}(),ie=function(e){function t(e,r){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r));return n.meshInfos=[],n}return o(t,te),r(t,[{key:"add",value:function(e){if(this.isExceed(e.indexArray.length))return console.warn("combine exceed vertex count "),!1;this.vertexCount+=e.positionArray.length/3,this.indexCount+=e.indexArray.length,this.meshInfos.push(e)}},{key:"build",value:function(){for(var e=this.meshInfos,t=this.indexCount,i=this.vertexCount,r=new Float32Array(3*i),n=new Float32Array(3*i),o=new Float32Array(2*i),a=new Float32Array(4*i),s=new Float32Array(2*i),l=new Uint16Array(t),c=0,u=0,h=0,p=0,d=0,f=new THREE.BufferGeometry,m=0;m<e.length;m++){for(var g=e[m],v=g.parentPosition,y=g.indexArray,b=0;b<y.length;b++)l[b+p]=c/3+y[b];p+=y.length;var _=g.positionArray;for(b=0;b<_.length;){var x=new THREE.Vector3(_[b]+v.x,_[b+1]+v.y,_[b+2]+v.z);r[b+c]=x.x,r[b+c+1]=x.y,r[b+c+2]=x.z,b+=3}c+=_.length;var E=g.normalArray;for(b=0;b<E.length;){var w=new THREE.Vector3(E[b],E[b+1],E[b+2]);n[b+u]=w.x,n[b+u+1]=w.y,n[b+u+2]=w.z,b+=3}u+=E.length;var T=g.uvArray;if(T)for(b=0;b<T.length;b++)o[b+h]=T[b];var S=g.uv2Array;if(S)for(b=0;b<S.length;b++)s[b+h]=S[b];T&&(h+=T.length);var M=g.colorArray;if(M){for(b=0;b<M.length;b++)a[b+d]=M[b];d+=M.length}}f.addAttribute("position",new THREE.BufferAttribute(r,3)),f.addAttribute("normal",new THREE.BufferAttribute(n,3)),f.addAttribute("uv",new THREE.BufferAttribute(o,2)),0!==s.length&&f.addAttribute("uv2",new THREE.BufferAttribute(s,2)),0!==a.length&&f.addAttribute("color",new THREE.BufferAttribute(a,4)),f.setIndex(new THREE.BufferAttribute(l,1));var R=new THREE.Mesh(f,this.material);this.material.defines&&this.material.defines.USE_ALPHAINDEX&&delete this.material.defines.USE_ALPHAINDEX,R.name="combine",this.combineMesh=R,this.combineMesh.name="manualWall",r=null,n=null,o=null,a=null,s=null,l=null,f=null}},{key:"clear",value:function(){}}]),t}(),re=function(e){function t(){i(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.meshInfos=[],e.resource=null,e.vertexCount=0,e.indexCount=0,e.transformations=[],e.maxCount=65534,e.mesh=new THREE.Object3D,e.processors=[],e.lightMapResource=null,e}return o(t,g),r(t,[{key:"getPointsFromMeshInfo",value:function(e){for(var t=[],i=e.positionArray,r=e.parentPosition,n=0;n<i.length;){var o=i[n]+r.x,a=i[n+1]+r.y,s=i[n+2]+r.z;t.push(new THREE.Vector3(o,a,s)),n+=3}return t}},{key:"addMeshInfo",value:function(e){this.vertexCount+=e.indexArray.length,this.indexCount+=e.indexArray.length,this.meshInfos.push(e)}},{key:"resourceCallback",value:function(e){this.checkResourceReady()&&this.build()}},{key:"build",value:function(){if(!this.isBuilded){if(!this.checkResourceReady())return this.initResource(this.resource),void(this.lightMapResource&&this.initResource(this.lightMapResource));this.lightMapResource&&this.resource.isDefault&&(this.resource.wallMaterial.aoMap=this.lightMapResource.texture);for(var e=void 0,t=0;t<this.meshInfos.length;t++){var i=this.meshInfos[t];e&&!e.isExceed(i.indexArray.length)||(e=new ie(this.resource.wallMaterial,null),this.processors.push(e)),e.add(i)}for(var r=0;r<this.processors.length;r++){var n=this.processors[r];n.build(),this.mesh.add(n.combineMesh)}this.processWhenBuildFinish()}}},{key:"checkResourceReady",value:function(){for(var e=0;e<this.resources.length;e++){if(!this.resources[e].ready)return!1}return!0}},{key:"initResource",value:function(e){e.ready||(e.isStartDownload||e.requestToDownload(),e.registerListener(this))}},{key:"addToParentCollector",value:function(){n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addToParentCollector",this).call(this),this.parent.combineStraightManualWallObjects.push(this)}},{key:"clear",value:function(){for(var e=0;e<this.processors.length;e++){var i=this.processors[e];this._dispose(i.combineMesh)}this.combineProcessors=[],n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}},{key:"isMultiResources",get:function(){return!!this.lightMapResource}},{key:"resources",get:function(){return null===this._resources&&(this._resources=[],this._resources.push(this.resource),this.lightMapResource&&this._resources.push(this.lightMapResource)),this._resources}},{key:"size",get:function(){return this.boundingBox.getSize(this._size)}},{key:"boundingBox",get:function(){if(null===this._boundingBox){this._boundingBox=new THREE.Box3;for(var e=0;e<this.meshInfos.length;e++)for(var t=this.getPointsFromMeshInfo(this.meshInfos[e]),i=0;i<t.length;i++){var r=t[i];this._boundingBox.expandByPoint(r)}}return this._boundingBox}}]),t}(),ne=function(){function e(){i(this,e),this.positions=[],this.scales=[],this.quaternions=[]}return r(e,[{key:"clone",value:function(){var t=new e;return t.positions=this.positions.slice(),t.scales=this.scales.slice(),t.quaternions=this.quaternions.slice(),t}}]),e}(),oe=function(){function e(){i(this,e)}return r(e,null,[{key:"compatibilityProcessWorld",value:function(e){this.compatibilityProcessPlan(e.outdoors);for(var t=e.buildings,i=0;i<t.length;i++)for(var r=t[i].floorplans,n=0;n<r.length;n++){var o=r[n];this.compatibilityProcessPlan(o)}}},{key:"compatibilityProcessPlan",value:function(e){for(var t=0;t<e.combineStraightManualWallObjects.length;t++){var i=e.combineStraightManualWallObjects[t];e.combineStraightManualWalls.push(i.delayObject)}for(var r=0;r<e.combineCeilingObjects.length;r++){var n=e.combineCeilingObjects[r];e.combineCeilings.push(n.delayObject)}for(var o=0;o<e.combineFloorObjects.length;o++){var a=e.combineFloorObjects[o];e.combineFloors.push(a.delayObject)}for(var s=0;s<e.combineRoofObjects.length;s++){var l=e.combineRoofObjects[s];e.combineRoofs.push(l.delayObject)}for(var c=0;c<e.combineModelWallObjects.length;c++){var u=e.combineModelWallObjects[c];e.combineModelWalls.push(u.delayObject)}for(var h=0;h<e.combineDoorOrWindowObjects.length;h++){var p=e.combineDoorOrWindowObjects[h];e.combineDoorOrWins.push(p.delayObject)}for(var d=0;d<e.combinePlacementObjects.length;d++){var f=e.combinePlacementObjects[d];e.combinePlacements.push(f.delayObject)}}},{key:"combineObjectBuildCallback",value:function(e){var t=null;-1!==e.constructor.name.indexOf("Ceiling")?t=e.parent.combineCeilings:-1!==e.constructor.name.indexOf("DoorOrWindow")?t=e.parent.combineDoorOrWins:-1!==e.constructor.name.indexOf("Floor")?t=e.parent.combineFloors:-1!==e.constructor.name.indexOf("ModelWall")?t=e.parent.combineModelWalls:-1!==e.constructor.name.indexOf("Placement")?t=e.parent.combinePlacements:-1!==e.constructor.name.indexOf("Roof")?t=e.parent.combineRoofs:-1!==e.constructor.name.indexOf("Straight")&&(t=e.parent.combineStraightManualWalls),t.push(e.mesh)}},{key:"equalVectorZero",value:function(e){return 0===e.x&&0===e.y&&0===e.z}},{key:"clone",value:function(e){var t=e.clone(),i={};e.traverse(function(e){e.isSkinnedMesh&&(i[e.name]=e)});var r={},n={};t.traverse(function(e){e.isBone&&(r[e.name]=e),e.isSkinnedMesh&&(n[e.name]=e)});var o=!1;for(var a in i){o=!0;for(var s=i[a].skeleton,l=n[a],c=[],u=0;u<s.bones.length;++u){var h=r[s.bones[u].name];c.push(h)}l.bind(new THREE.Skeleton(c,s.boneInverses),l.matrixWorld)}return t.hasSkin=!!o,t}},{key:"cloneJSObject",value:function(i){if(null===i||"object"!==(void 0===i?"undefined":t(i)))return i;if(i instanceof Date)return(r=new Date).setTime(i.getTime()),r;if(i instanceof Array|i instanceof Object){var r=i instanceof Array?[]:{};for(var n in i)i.hasOwnProperty(n)&&(r[n]=e.cloneJSObject(i[n]));return r}throw new Error("Unable to clone obj! Its type isn't supported.")}}]),e}(),ae=function(e){function t(e,r){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r))}return o(t,te),r(t,[{key:"add",value:function(e,t){if(this.isExceed(e.vertexCount))return console.warn("combine exceed vertex count "),!1;this.vertexCount+=e.vertexCount,this.indexCount+=e.indexCount,this.bundeMeshs.push(e),this.transformations.push(t)}},{key:"cloneGroups",value:function(e){for(var t=[],i=0;i<e.length;i++){var r=e[i];t.push(oe.cloneJSObject(r))}return t}},{key:"build",value:function(){for(var e=this.bundeMeshs,t=this.indexCount,i=this.vertexCount,r=[],n=new Float32Array(3*i),o=new Float32Array(3*i),a=new Float32Array(2*i),s=new Float32Array(4*i),l=new Float32Array(1*i),c=new Float32Array(2*i),u=new Float32Array(2*i),h=new Uint16Array(t),p=0,d=0,f=0,m=0,g=0,v=0,y=new THREE.BufferGeometry,b=0,_=0;_<e.length;_++){var x=e[_],E=this.transformations[_],w=E.positions,T=E.scales,S=E.quaternions,M=x.indexArray;if(x.groups.length>0){var R=this.cloneGroups(x.groups);R.forEach(function(e){e.start+=b}),r=r.concat(R)}b+=M.length;for(var P=0;P<M.length;P++)h[P+m]=p/3+M[P];m+=M.length;var A=x.positionArray;for(P=0;P<A.length;){for(var C=new THREE.Vector3(A[P],A[P+1],A[P+2]),O=w.length-1;O>-1;O--){var L=w[O],k=T[O],H=S[O];C.x*=k.x,C.y*=k.y,C.z*=k.z,(C=C.applyQuaternion(H)).x+=L.x,C.y+=L.y,C.z+=L.z}n[P+p]=C.x,n[P+p+1]=C.y,n[P+p+2]=C.z,P+=3}p+=A.length;var j=x.normalArray;for(P=0;P<j.length;){var F=new THREE.Vector3(j[P],j[P+1],j[P+2]);for(O=S.length-1;O>-1;O--){H=S[O];F=F.applyQuaternion(H)}o[P+d]=F.x,o[P+d+1]=F.y,o[P+d+2]=F.z,P+=3}d+=j.length;var D=x.uvArray;if(D)for(P=0;P<D.length;P++)a[P+f]=D[P];var B=x.uv2Array;if(B)for(P=0;P<B.length;P++)c[P+f]=B[P];var I=x.uv3Array;if(I)for(P=0;P<I.length;P++)u[P+f]=I[P];D&&(f+=D.length);var N=x.colorArray;if(N){for(P=0;P<N.length;P++)s[P+g]=N[P];g+=N.length;for(P=3;P<N.length;P+=4)l[(P-3)/4+v]=N[P];v+=N.length/4}}y.addAttribute("position",new THREE.BufferAttribute(n,3)),y.addAttribute("normal",new THREE.BufferAttribute(o,3)),y.addAttribute("uv",new THREE.BufferAttribute(a,2)),0!==c.length&&y.addAttribute("uv2",new THREE.BufferAttribute(c,2)),0!==u.length&&y.addAttribute("uv3",new THREE.BufferAttribute(u,2)),0!==s.length&&y.addAttribute("color",new THREE.BufferAttribute(s,4)),0!==l.length&&y.addAttribute("alphaIndex",new THREE.BufferAttribute(l,1)),y.setIndex(new THREE.BufferAttribute(h,1)),y.groups=r;var U=new THREE.Mesh(y,this.material);U.name="combine",this.combineMesh=U,this.combineMesh.name="mesh",r=null,n=null,o=null,a=null,s=null,l=null,c=null,u=null,h=null,p=0,d=0,f=0,m=0,g=0,v=0,y=null}}]),t}(),se=function(e){function t(){i(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.resource=null,e.placements=[],e.transformations=[],e.combineProcessorMap=new Map,e.combineProcessors=[],e.mesh=new THREE.Object3D,e}return o(t,g),r(t,[{key:"add",value:function(e,t){this.placements.push(e),this.transformations.push(t)}},{key:"build",value:function(){if(!this.isBuilded){if(!this.checkResourceReady())return void this.initResource(this.resource);if(this.resource.isCombine||this.resource.combine(),!this.resource.combineBundleObj&&this.resource.isCombine)return;this.resource.isCombine?this.combinePlacements():this.resource.model&&this.instancePlacements(),this.processWhenBuildFinish()}}},{key:"checkResourceReady",value:function(){return!!this.resource.ready}},{key:"initResource",value:function(e){e.ready||(e.isStartDownload||e.requestToDownload(),e.registerListener(this))}},{key:"instancePlacements",value:function(){for(var e=0;e<this.placements.length;e++){var t=this.placements[e];t.initResource(t.resource),t.instanceModel();var i=this.transformations[e],r=null;if(i)for(var n=i.positions.length-1;n>-1;n--){var o=new THREE.Object3D,a=i.positions[n],s=i.scales[n],l=i.quaternions[n];o.position.set(a.x,a.y,a.z),o.scale.set(s.x,s.y,s.z),o.quaternion.set(l.x,l.y,l.z,l.w),null!==r?o.add(r):o.add(t.mesh),r=o}else r=t.mesh;this.mesh.add(r)}}},{key:"combinePlacements",value:function(){for(var e=0;e<this.placements.length;e++){var t=this.placements[e],i=this.transformations[e];void 0===i&&(i=new ne);var r=this.combineProcessorMap,n=this.combineProcessors,o=this.resource.combineBundleObj;i.positions.push(t.position),i.scales.push(t.scale),i.quaternions.push(t.rotation),o.materialMap.forEach(function(e,t,o){for(var a=e,s=t,l=0;l<a.length;l++){var c=a[l],u=r.get(s);u&&!u.isExceed(c.vertexCount)||(u=new ae(s,this),r.set(s,u),n.push(u)),u.add(c,i)}})}for(var a=0;a<this.combineProcessors.length;a++){var s=this.combineProcessors[a];s.build(),this.mesh.add(s.combineMesh)}}},{key:"resourceCallback",value:function(e){this.build()}},{key:"addToParentCollector",value:function(){n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addToParentCollector",this).call(this),this.parent.combinePlacementObjects.push(this)}},{key:"clear",value:function(){this.combineProcessorMap.clear();for(var e=0;e<this.combineProcessors.length;e++){var i=this.combineProcessors[e];this._dispose(i.combineMesh)}this.combineProcessors=[],n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}},{key:"size",get:function(){return this.boundingBox.getSize(this._size)}},{key:"boundingBox",get:function(){if(null===this._boundingBox){this._boundingBox=new THREE.Box3;for(var e=0;e<this.placements.length;e++){var t=this.placements[e].boundingBox;this._boundingBox.expandByPoint(t.min),this._boundingBox.expandByPoint(t.max)}}return this._boundingBox}}]),t}(),le=function(e){function t(){i(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.resource=null,e.floors=[],e.height=.01,e}return o(t,g),r(t,[{key:"add",value:function(e){this.floors.push(e)}},{key:"build",value:function(){if(!this.isBuilded){if(!this.checkResourceReady())return void this.initResource(this.resource);this.resource.isCombine||this.resource.combine();var e=null;this.resource.ready?e=this.resource.roomMaterial:(e=new THREE.MeshBasicMaterial,this.resource.registerListener(this)),e.side=THREE.DoubleSide;for(var t=new THREE.Geometry,i=0;i<this.floors.length;i++){var r=this.floors[i];r.calGeometry();var n=r.geometry;t.merge(n),this.mergeUV2(n,t)}var o=new THREE.Mesh(t,e);o.name="combine",o.rotateX(-Math.PI/2),o.position.y=this.height,this.combineMesh=o,this.combineMesh.name="floor",this.mesh=this.combineMesh,this.processWhenBuildFinish()}}},{key:"checkResourceReady",value:function(){return!!this.resource.ready}},{key:"initResource",value:function(e){e.ready||(e.isStartDownload||e.requestToDownload(),e.registerListener(this))}},{key:"resourceCallback",value:function(e){this.build()}},{key:"mergeUV2",value:function(e,t){var i=e.faceVertexUvs,r=t.faceVertexUvs,n=i[1];void 0===r[1]&&(r[1]=[]);for(var o=r[1],a=0;a<n.length;a++){for(var s=n[a],l=[],c=0;c<s.length;c++)l.push(s[c].clone());o.push(l)}}},{key:"addToParentCollector",value:function(){n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addToParentCollector",this).call(this),this.parent.combineFloorObjects.push(this)}}]),t}(),ce=function(e){function t(){i(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.resource=null,e.ceilings=[],e.meshInfos=[],e.geometrys=[],e.height=3,e}return o(t,g),r(t,[{key:"add",value:function(e){this.ceilings.push(e)}},{key:"build",value:function(){if(!this.isBuilded){if(!this.checkResourceReady())return void this.initResource(this.resource);var e=null;this.resource.ready?e=this.resource.roomMaterial:(e=new THREE.MeshBasicMaterial({color:16777215}),this.resource.registerListener(this));for(var t=new THREE.Geometry,i=0;i<this.ceilings.length;i++){var r=this.ceilings[i];r.calGeometry();var n=r.geometry;t.merge(n)}var o=new THREE.Mesh(t,e);o.name="combine",o.rotateX(Math.PI/2),o.position.y=this.height,this.combineMesh=o,this.combineMesh.name="ceiling",this.mesh=this.combineMesh,this.processWhenBuildFinish()}}},{key:"resourceCallback",value:function(e){this.build()}},{key:"addToParentCollector",value:function(){n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addToParentCollector",this).call(this),this.parent.combineCeilingObjects.push(this)}}]),t}(),ue=function(e){function t(){i(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.resource=null,e.roofs=[],e.height=3,e.meshInfos=[],e.geometrys=[],e}return o(t,g),r(t,[{key:"add",value:function(e){this.roofs.push(e)}},{key:"build",value:function(){if(!this.isBuilded){if(!this.checkResourceReady())return void this.initResource(this.resource);var e=null;this.resource.ready?e=this.resource.roomMaterial:(e=new THREE.MeshBasicMaterial,this.resource.registerListener(this));for(var t=new THREE.Geometry,i=0;i<this.roofs.length;i++){var r=this.roofs[i];r.calGeometry();var n=r.geometry;t.merge(n)}var o=new THREE.Mesh(t,e);o.name="combine",o.rotateX(-Math.PI/2),o.position.y=this.height+.005,this.combineMesh=o,this.combineMesh.name="roof",this.mesh=this.combineMesh,this.processWhenBuildFinish()}}},{key:"checkResourceReady",value:function(){return!!this.resource.ready}},{key:"initResource",value:function(e){e.ready||(e.isStartDownload||e.requestToDownload(),e.registerListener(this))}},{key:"resourceCallback",value:function(e){this.build()}},{key:"addToParentCollector",value:function(){n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addToParentCollector",this).call(this),this.parent.combineRoofObjects.push(this)}}]),t}(),he=function(e){function t(){i(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.combineProcessorMap=new Map,e.combineProcessors=[],e.walls=[],e}return o(t,g),r(t,[{key:"addWall",value:function(e){this.walls.push(e)}},{key:"build",value:function(){if(!this.isBuilded){if(!this.checkResourceReady())return void this.initResource(this.resource);this.mesh=new THREE.Object3D,this.resource.isCombine||this.resource.combine();for(var e=0;e<this.walls.length;e++){var t=this.walls[e];if(t.baseBuild(),0===t.doorOrWindows.length)t.calObjInfo(),this.combineWall(t);else{t.initSimpleCornersAndWalls();for(var i=0;i<t.subWalls.length;i++){var r=t.subWalls[i];r.baseBuild(),r.calObjInfo(),this.combineWall(r)}}}for(var n=0;n<this.combineProcessors.length;n++){var o=this.combineProcessors[n];o.build(),this.mesh.add(o.combineMesh)}this.processWhenBuildFinish()}}},{key:"combineWall",value:function(e){for(var t=this.combineProcessorMap,i=this.combineProcessors,r=this.resource.combineBundleObj,n=0;n<e.modelNumber;n++){var o=e.objPositions[n],a=e.objRotations[n],s=e.objScales[n],l=new ne;l.positions.push(o),l.scales.push(s),l.quaternions.push(a),r.materialMap.forEach(function(e,r,n){for(var o=e,a=r,s=0;s<o.length;s++){var c=o[s],u=t.get(a);u&&!u.isExceed(c.vertexCount)||(u=new ae(a,this),t.set(a,u),i.push(u)),u.add(c,l)}})}}},{key:"resourceCallback",value:function(e){this.build()}},{key:"addToParentCollector",value:function(){n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addToParentCollector",this).call(this),this.parent.combineModelWallObjects.push(this)}},{key:"clear",value:function(){for(var e=0;e<this.walls.length;e++){this.walls[e].clear()}this.combineProcessorMap.clear();for(var i=0;i<this.combineProcessors.length;i++){var r=this.combineProcessors[i];this._dispose(r.combineMesh)}this.combineProcessors=[],n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}},{key:"size",get:function(){return this.boundingBox.getSize(this._size)}},{key:"boundingBox",get:function(){if(null===this._boundingBox){this._boundingBox=new THREE.Box3;for(var e=0;e<this.walls.length;e++){var t=this.walls[e].boundingBox;this._boundingBox.expandByPoint(t.min),this._boundingBox.expandByPoint(t.max)}}return this._boundingBox}}]),t}(),pe=function(e){function t(){i(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.combineProcessorMap=new Map,e.combineProcessors=[],e.doorOrWindows=[],e.transformations=[],e}return o(t,g),r(t,[{key:"add",value:function(e,t){this.doorOrWindows.push(e),this.transformations.push(t)}},{key:"build",value:function(){if(!this.isBuilded){if(!this.checkResourceReady())return void this.initResource(this.resource);if(this.resource.isCombine||this.resource.combine(),!this.resource.combineBundleObj&&this.resource.isCombine)return;this.resource.isCombine?this.combinePlacements():this.resource.model&&this.instancePlacements(),this.processWhenBuildFinish()}}},{key:"instancePlacements",value:function(){for(var e=0;e<this.doorOrWindows.length;e++){var t=this.doorOrWindows[e];t.fitAttachWall(),t.instanceModel();var i=this.transformations[e],r=null;if(i)for(var n=i.positions.length-1;n>-1;n--){var o=new THREE.Object3D,a=i.positions[n],s=i.scales[n],l=i.quaternions[n];o.position.set(a.x,a.y,a.z),o.scale.set(s.x,s.y,s.z),o.quaternion.set(l.x,l.y,l.z,l.w),null!==r?o.add(r):o.add(t.mesh),r=o}else r=t.mesh;this.combineMesh.add(r)}}},{key:"combinePlacements",value:function(){for(var e=0;e<this.doorOrWindows.length;e++){var t=this.doorOrWindows[e];t.fitAttachWall();var i=this.transformations[e];void 0===i&&(i=new ne);var r=this.combineProcessorMap,n=this.combineProcessors,o=this.resource.combineBundleObj;i.positions.push(t.position),i.scales.push(t.scale),i.quaternions.push(t.rotation),o.materialMap.forEach(function(e,t,o){for(var a=e,s=t,l=0;l<a.length;l++){var c=a[l],u=r.get(s);u&&!u.isExceed(c.vertexCount)||(u=new ae(s,this),r.set(s,u),n.push(u)),u.add(c,i)}})}for(var a=0;a<this.combineProcessors.length;a++){var s=this.combineProcessors[a];s.build(),this.mesh.add(s.combineMesh)}}},{key:"resourceCallback",value:function(e){this.build()}},{key:"addToParentCollector",value:function(){n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addToParentCollector",this).call(this),this.parent.combineDoorOrWindowObjects.push(this)}},{key:"clear",value:function(){this.combineProcessorMap.clear();for(var e=0;e<this.combineProcessors.length;e++){var i=this.combineProcessors[e];this._dispose(i.combineMesh)}this.combineProcessors=[],n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}}]),t}(),de=me,fe=me;function me(e,t){if(!(this instanceof me))return new me(e,t);if(this.data=e||[],this.length=this.data.length,this.compare=t||ge,this.length>0)for(var i=(this.length>>1)-1;i>=0;i--)this._down(i)}function ge(e,t){return e<t?-1:e>t?1:0}me.prototype={push:function(e){this.data.push(e),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var e=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),e}},peek:function(){return this.data[0]},_up:function(e){for(var t=this.data,i=this.compare,r=t[e];e>0;){var n=e-1>>1,o=t[n];if(i(r,o)>=0)break;t[e]=o,e=n}t[e]=r},_down:function(e){for(var t=this.data,i=this.compare,r=this.length>>1,n=t[e];e<r;){var o=1+(e<<1),a=o+1,s=t[o];if(a<this.length&&i(t[a],s)<0&&(o=a,s=t[a]),i(s,n)>=0)break;t[e]=s,e=o}t[e]=n}},de.default=fe;var ve=be,ye=be;function be(e,t,i){var r,n,o,a;t=t||1;for(var s=0;s<e[0].length;s++){var l=e[0][s];(!s||l[0]<r)&&(r=l[0]),(!s||l[1]<n)&&(n=l[1]),(!s||l[0]>o)&&(o=l[0]),(!s||l[1]>a)&&(a=l[1])}var c=o-r,u=a-n,h=Math.min(c,u),p=h/2,d=new de(null,_e);if(0===h)return[r,n];for(var f=r;f<o;f+=h)for(var m=n;m<a;m+=h)d.push(new xe(f+p,m+p,p,e));var g=function(e){for(var t=0,i=0,r=0,n=e[0],o=0,a=n.length,s=a-1;o<a;s=o++){var l=n[o],c=n[s],u=l[0]*c[1]-c[0]*l[1];i+=(l[0]+c[0])*u,r+=(l[1]+c[1])*u,t+=3*u}return 0===t?new xe(n[0][0],n[0][1],0,e):new xe(i/t,r/t,0,e)}(e),v=new xe(r+c/2,n+u/2,0,e);v.d>g.d&&(g=v);for(var y=d.length;d.length;){var b=d.pop();b.d>g.d&&(g=b,i&&console.log("found best %d after %d probes",Math.round(1e4*b.d)/1e4,y)),b.max-g.d<=t||(p=b.h/2,d.push(new xe(b.x-p,b.y-p,p,e)),d.push(new xe(b.x+p,b.y-p,p,e)),d.push(new xe(b.x-p,b.y+p,p,e)),d.push(new xe(b.x+p,b.y+p,p,e)),y+=4)}return i&&(console.log("num probes: "+y),console.log("best distance: "+g.d)),[g.x,g.y]}function _e(e,t){return t.max-e.max}function xe(e,t,i,r){this.x=e,this.y=t,this.h=i,this.d=function(e,t,i){for(var r=!1,n=1/0,o=0;o<i.length;o++)for(var a=i[o],s=0,l=a.length,c=l-1;s<l;c=s++){var u=a[s],h=a[c];u[1]>t!=h[1]>t&&e<(h[0]-u[0])*(t-u[1])/(h[1]-u[1])+u[0]&&(r=!r),n=Math.min(n,Ee(e,t,u,h))}return(r?1:-1)*Math.sqrt(n)}(e,t,r),this.max=this.d+this.h*Math.SQRT2}function Ee(e,t,i,r){var n=i[0],o=i[1],a=r[0]-n,s=r[1]-o;if(0!==a||0!==s){var l=((e-n)*a+(t-o)*s)/(a*a+s*s);l>1?(n=r[0],o=r[1]):l>0&&(n+=a*l,o+=s*l)}return(a=e-n)*a+(s=t-o)*s}ve.default=ye;var we=function(){function e(t){i(this,e),this.plan=t,this.straightManualCombineWallMap=new Map,this.combinePlacementMap=new Map,this.combineFloorMap=new Map,this.combineRoofMap=new Map,this.combineCeilingMap=new Map,this.combineModelWallMap=new Map,this.combineDoorOrWindowMap=new Map,this.combineWalls=[],this.combinePlacements=[],this.combineFloors=[],this.combineCeilings=[],this.combineRoofs=[],this.differentHeightRoomMap=new Map,this.curPlacementCombineProcessorInRoomMap=new Map}return r(e,[{key:"parser",value:function(){for(var e=this.plan,t=this.plan.placements,i=this.plan.walls,r=this.plan.rooms,n=[],o=[],a=[],s=0;s<e.corners.length;s++){e.corners[s].build()}for(var l=0;l<t.length;l++){var c=t[l];this.isPlacementShouldCombine(c)?this.addPlacementToCollector(c):n.push(c)}e.placements=n;for(var u=0;u<e.groups.length;u++){var h=e.groups[u];this.isGroupShouldCombine(h)?this.addPlacementGroupToCollector(h):o.push(h)}e.groups=o;for(var p=0;p<i.length;p++){var d=i[p];if(d.isShow)if(d instanceof w)if(0===d.doorOrWindows.length)this.addStraightManualWall(d);else{d.initMeshInfo(),d.initSimpleCornersAndWalls();for(var f=0;f<d.subCorners.length;f++){d.subCorners[f].build()}for(var m=0;m<d.subWalls.length;m++){var g=d.subWalls[m];this.addStraightManualWall(g)}}else this.getCombineObjectFromMap(d.resource,he,this.combineModelWallMap).addWall(d)}for(var v=0;v<e.doorOrWindows.length;v++){var y=e.doorOrWindows[v];this.isPlacementShouldCombine(y)?this.addDoorOrWindowToCollector(y):a.push(y)}e.doorOrWindows=a,this.clearPlanWalls(e),this.parseRooms(r),e.corners=[]}},{key:"parseRooms",value:function(e){for(var t=new Map,i=new Map,r=new Map,n=[],o=0;o<e.length;o++){var a=e[o];if(a.properties||a.userID||a.name)(a.properties||a.userID||a.name)&&n.push(a);else{if(a.floor.isShow)this.getHeightRoomInfoListFromMap(a.floor.height,t).push(a.floor);if(a.ceiling.isShow)this.getHeightRoomInfoListFromMap(a.ceiling.height,i).push(a.ceiling);if(a.roof.isShow)this.getHeightRoomInfoListFromMap(a.roof.height,r).push(a.roof)}}var s=!0,l=!1,c=void 0;try{for(var u,h=t.keys()[Symbol.iterator]();!(s=(u=h.next()).done);s=!0)for(var p=u.value,d=t.get(p),f=0;f<d.length;f++){var m=d[f];this.addFloorToCollector(m,p)}}catch(e){l=!0,c=e}finally{try{!s&&h.return&&h.return()}finally{if(l)throw c}}var g=!0,v=!1,y=void 0;try{for(var b,_=i.keys()[Symbol.iterator]();!(g=(b=_.next()).done);g=!0)for(var x=b.value,E=i.get(x),w=0;w<E.length;w++){var T=E[w];this.addCeilingToCollector(T,x)}}catch(e){v=!0,y=e}finally{try{!g&&_.return&&_.return()}finally{if(v)throw y}}var S=!0,M=!1,R=void 0;try{for(var P,A=r.keys()[Symbol.iterator]();!(S=(P=A.next()).done);S=!0)for(var C=P.value,O=r.get(C),L=0;L<O.length;L++){var k=O[L];this.addRoofToCollector(k,C)}}catch(e){M=!0,R=e}finally{try{!S&&A.return&&A.return()}finally{if(M)throw R}}this.plan.rooms=n;for(var H=0;H<n.length;H++){var j=n[H],F=this.calRoomPosition(j);j.position=F,this.subRoomHolesPointsByPosition(j,F),this.subRoomPointsByPosition(j,F),j.initShapePathPoints(),j.initShapeHolePoints()}}},{key:"calRoomPosition",value:function(e){for(var t=e.points,i=e.holes,r=[],n=[],o=0;o<t.length;o++){var a=t[o];r.push([a.x,a.z])}if(i.length>2&&!this.isSamePoints(i))for(o=0;o<i.length;o++){for(var s=i[o],l=[],c=0;c<s.length;c++){a=s[c];l.push([a.x,a.z])}n.push(l)}var u=this.getLabelPosition(r,n);return new THREE.Vector3(u[0],0,u[1])}},{key:"isSamePoints",value:function(e){for(var t=e[0],i=1;i<e.length;i++){var r=e[i];if(t.x!==r.x||t.y!==r.y||t.z!==r.z)return!1}return!0}},{key:"getLabelPosition",value:function(e,t){if(!e||!e.length)return null;var i=[];if(i.push(e),t&&0!=t.length)for(var r=0;r<t.length;r++){var n=[t[r][0],t[r][1],t[r][2],t[r][3]];i.push(n)}var o=new ve(i);return[o[0],o[1]]}},{key:"subRoomPointsByPosition",value:function(e,t){for(var i=e.points,r=0;r<i.length;r++){i[r].sub(t)}}},{key:"subRoomHolesPointsByPosition",value:function(e,t){for(var i=e.holes,r=0;r<i.length;r++)for(var n=i[r],o=0;o<n.length;o++){n[o].sub(t)}}},{key:"getHeightRoomInfoListFromMap",value:function(e,t){return t.has(e)||t.set(e,[]),t.get(e)}},{key:"addStraightManualWall",value:function(e){e.initMeshInfo(),this.addToStraightManualWallCollector(e)}},{key:"addToStraightManualWallCollector",value:function(e){var t=this.getCombineObjectFromMap(e.leftResource,re,this.straightManualCombineWallMap),i=this.getCombineObjectFromMap(e.rightResource,re,this.straightManualCombineWallMap),r=this.getCombineObjectFromMap(e.edgeResource,re,this.straightManualCombineWallMap);t.lightMapResource=f.wallLightMapResource,i.lightMapResource=f.wallLightMapResource,t.addMeshInfo(e.leftSideMeshInfo),i.addMeshInfo(e.rightSideMeshInfo),r.addMeshInfo(e.edgeSideMeshInfo)}},{key:"createStraightManualCombineWallToMap",value:function(e,t,i){if(!t.has(e)){var r=new re;r.resource=e,r.parent=i,t.set(e,r)}}},{key:"addPlacementToCollector",value:function(e,t){var i=null;y.enableCombinePlacementsByRoom?(this.curPlacementCombineProcessorInRoomMap.has(e.belongRoomUserID)||this.curPlacementCombineProcessorInRoomMap.set(e.belongRoomUserID,new Map),i=this.curPlacementCombineProcessorInRoomMap.get(e.belongRoomUserID)):i=this.combinePlacementMap,this.getCombineObjectFromMap(e.resource,se,i).add(e,t)}},{key:"addPlacementGroupToCollector",value:function(e,t){t||(t=new ne),t.positions.push(e.position),t.scales.push(e.scale),t.quaternions.push(e.rotation);for(var i=0;i<e.placements.length;i++){var r=e.placements[i];r.isShow&&this.addPlacementToCollector(r,t.clone())}for(i=0;i<e.groups.length;i++){var n=e.groups[i];n.isShow&&this.addPlacementGroupToCollector(n,t.clone())}}},{key:"addDoorOrWindowToCollector",value:function(e){this.getCombineObjectFromMap(e.resource,pe,this.combineDoorOrWindowMap).add(e)}},{key:"addRoofToCollector",value:function(e,t){if(!(this.plan instanceof O)){var i=this.getCombineRoomRelatedObject(e,ue,this.plan.combineRoofObjects);i.height=t,i.add(e)}}},{key:"addCeilingToCollector",value:function(e,t){if(!(this.plan instanceof O)){var i=this.getCombineRoomRelatedObject(e,ce,this.plan.combineCeilingObjects);i.height=t,i.add(e)}}},{key:"addFloorToCollector",value:function(e,t){var i=this.getCombineRoomRelatedObject(e,le,this.plan.combineFloorObjects);i.height=t,i.add(e)}},{key:"getCombineRoomRelatedObject",value:function(e,t,i){for(var r=null,n=0;n<i.length;n++){var o=i[n];if(o.resource===e.resource&&o.height===e.height){r=o;break}}return null===r&&((r=new t).parent=this.plan,r.resource=e.resource,r.height=e.height),r}},{key:"clearPlanWalls",value:function(e){e.walls=[]}},{key:"getCombineObjectFromMap",value:function(e,t,i){if(!i.has(e)){var r=new t;r.resource=e,r.parent=this.plan,i.set(e,r)}return i.get(e)}},{key:"isPlacementShouldCombine",value:function(e){return!!this.isNullOrUndefined(e.properties)&&(!!this.isNullOrUndefined(e.userID)&&(!!this.isNullOrUndefined(e.name)&&!!e.isShow))}},{key:"isGroupShouldCombine",value:function(e){return!!this.isNullOrUndefined(e.properties)&&(!!this.isNullOrUndefined(e.userID)&&(!!this.isNullOrUndefined(e.name)&&!!e.isShow))}},{key:"isNullOrUndefined",value:function(e){return null==e}},{key:"parseDifferentHeightRooms",value:function(e){}}]),e}(),Te=function(){function e(){i(this,e)}return r(e,[{key:"parseWorld",value:function(e){var t=e.outdoors;this.parsePlan(t);for(var i=e.buildings,r=0;r<i.length;r++){var n=i[r];this.parseBuilding(n)}var o=[];for(r=0;r<e.buildings.length;r++){n=e.buildings[r];for(var a=0;a<n.floorplans.length;a++){var s=n.floorplans[a];o.push(s)}}o.push(e.outdoors)}},{key:"parseBuilding",value:function(e){for(var t=e.floorplans,i=0;i<t.length;i++){var r=t[i];this.parsePlan(r)}}},{key:"parsePlan",value:function(e){new we(e).parser()}}]),e}(),Se=function(){function e(t){i(this,e),this.resource=t,this.objects=[],this.isBuilded=!1,this._awaitToNextBuildTime=1,this._maxBuildTime=1e3}return r(e,[{key:"add",value:function(e){this.objects.push(e)}},{key:"build",value:async function(){for(var e=new Date,t=void 0,i=0;i<this.objects.length;i++){(t=new Date)-e>this._maxBuildTime&&(e=t,await this.awaitToNextBuild()),this.objects[i].build()}return this.isBuilded=!0,new Promise(function(e){e("resolved")})}},{key:"awaitToNextBuild",value:function(e){return void 0===e&&(e=this._awaitToNextBuildTime),new Promise(function(t){setTimeout(function(){t("resolved")},e)})}},{key:"resourceCallback",value:function(){this.build()}},{key:"containByClassType",value:function(e){for(var t=0;t<this.objects.length;t++){if(this.objects[t]instanceof e)return!0}return!1}}]),e}(),Me=function(){function e(t){i(this,e),this.loader=t,this.world=null,this.requestToBuildList=[],this.resourceToObjectsMap=new Map,this.resourceBuildUnitMap=new Map,this.resourceBuildUnits=[],this.readyResourceUnits=[],this.unreadyResourceUnits=[],this._stopUpdateBuild=!0,this._buildingUnits=[],this.buildingProgressCallback=null,this._awaitToNextBuildTime=10,this._resourceBuildUnitAwaitToNextBuildTime=1,this._resourceBuildUnitMaxBuildTime=1e3}return r(e,[{key:"build",value:function(e){this.buildingProgressCallback=e,this.initRequestBuildUnits(),this._buildingUnits=[].concat(this.readyResourceUnits).concat(this.unreadyResourceUnits);for(var t=0;t<this.unreadyResourceUnits.length;t++){var i=this.unreadyResourceUnits[t].resource;null!==i&&this.loader.addResourceDownloadRequest(i)}0!==this.unreadyResourceUnits.length&&this.loader.startToDownloadRequestResources(),this._stopUpdateBuild=!1,this._updateBuildUnit()}},{key:"initRequestBuildUnits",value:function(){this.sortResourceBuildUnits(),this.readyResourceUnits=[],this.unreadyResourceUnits=[];for(var e=0;e<this.resourceBuildUnits.length;e++){var t=this.resourceBuildUnits[e],i=t.resource;i&&i.ready?this.readyResourceUnits.push(t):i&&this.unreadyResourceUnits.push(t)}}},{key:"sortResourceBuildUnits",value:function(){for(var e=[],t=[],i=[],r=[],n=[],o=[],a=[],s=0;s<this.resourceBuildUnits.length;s++){var l=this.resourceBuildUnits[s];l.containByClassType(re)?e.push(l):l.containByClassType(ue)?n.push(l):l.containByClassType(he)?i.push(l):l.containByClassType(le)?o.push(l):l.containByClassType(ce)?r.push(l):l.containByClassType(pe)?a.push(l):t.push(l)}this.resourceBuildUnits=[].concat(e).concat(n).concat(o).concat(r).concat(a).concat(i).concat(t)}},{key:"_updateBuildUnit",value:async function(){for(var e=this;;){if(this._stopUpdateBuild)return;if(0===this._buildingUnits.length)await this.awaitToNextBuild();else if(this._buildingUnits[0].resource&&this._buildingUnits[0].resource.ready){var t=this._buildingUnits.shift();await t.build().then(function(){e.checkBuildComplete()})}else await this.awaitToNextBuild()}}},{key:"checkBuildComplete",value:function(){for(var e=[],t=!0,i=0;i<this.resourceBuildUnits.length;i++){var r=this.resourceBuildUnits[i];r.isBuilded?e.push(r):t=!1}this.buildingProgressCallback&&this.buildingProgressCallback(e.length/this.resourceBuildUnits.length),t&&(this.resourceBuildUnits=[],this.unreadyResourceUnits=[],this.readyResourceUnits=[],this.resourceBuildUnitMap.clear(),this._stopUpdateBuild=!0)}},{key:"awaitToNextBuild",value:function(){var e=this;return new Promise(function(t){setTimeout(function(){t("resolved")},e._awaitToNextBuildTime)})}},{key:"requestToBuild",value:function(e){var t=this.world.findObjectByID(e);null!==t&&(t.isContainer?this.addContainerObject(t):this.addObject(t))}},{key:"disposeObject",value:function(e){var t=this.world.findObjectByID(e);t&&t.clear()}},{key:"addContainerObject",value:function(e){for(var t=e.children,i=0;i<t.length;i++){var r=t[i];r.isContainer&&!r.isMultiResources?this.addContainerObject(r):this.addObject(r)}}},{key:"addObject",value:function(e){e.isMultiResources?this.addMultiResourcesObject(e):this.addSingleResourceObject(e)}},{key:"addMultiResourcesObject",value:function(e){for(var t=e.resources,i=0;i<t.length;i++){var r=t[i];this.addSingleResourceObject(e,r)}}},{key:"addSingleResourceObject",value:function(e,t){t||(t=e.resource);if(!this.resourceBuildUnitMap.has(t)){var i=new Se(t);i._awaitToNextBuildTime=this._resourceBuildUnitAwaitToNextBuildTime,i._maxBuildTime=this._resourceBuildUnitMaxBuildTime,this.resourceBuildUnits.push(i),this.resourceBuildUnitMap.set(t,i)}this.resourceBuildUnitMap.get(t).add(e)}}]),e}(),Re=function(){function e(){i(this,e),this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.enableCombine=!0,this.defaultWallEdgeTextureUri="Textures/WallEdge.jpg",this.defaultWallTextureUri="Textures/RoomWall.jpg",this.defaultFloorTextureUri="Textures/FloorDefault.jpg",this.defaultCeilingTextureUri="Textures/CeilingDefault.jpg",this.defaultRoofTextureUri="Textures/RoofDefault.jpg",this.world=null,this.json2objectLoader=new J,this.resourceManager=this.json2objectLoader.resourceManager,this.combineParser=new Te(this),this.dynamicBuildManager=new Me(this),this.enableDelayObject=!1,this.objectsMap={},this.enableRequestWorld=!0}return r(e,[{key:"startToDownloadRequestResources",value:function(e){this.resourceManager.startToDownloadRequestResources(e)}},{key:"addResourceDownloadRequest",value:function(e){this.resourceManager.addResourceDownloadRequest(e)}},{key:"disposeModels",value:function(){this.resourceManager.disposeModels()}},{key:"disposeTextures",value:function(){this.resourceManager.disposeTextures()}},{key:"clearAllResources",value:function(){this.resourceManager.disposeModels(),this.resourceManager.disposeTextures()}},{key:"clearAllObjects",value:function(){this.world.clear()}},{key:"requestToBuild",value:function(e){this.dynamicBuildManager.requestToBuild(e)}},{key:"startToBuild",value:function(e){return this.dynamicBuildManager.build(e)}},{key:"disposeObject",value:function(e){this.dynamicBuildManager.disposeObject(e)}},{key:"findObjectByID",value:function(e){return this.world.findObjectByID(e)}},{key:"delayLoad",value:function(e){var t=this;return e?(e.url&&(this.sceneURL=e.url,this.resourceManager.localCustomModelBaseUrl=this.getParentRelativeUrl(this.sceneURL)),e.json&&(this.sceneJson=e.json),e.customModeBaseUrl&&(this.resourceManager.localCustomModelBaseUrl=e.customModeBaseUrl),new Promise(function(e,i){t.loadSceneJson().then(function(){t.world=t.json2objectLoader.parseObjects({json:t.sceneJson}),t.combineParser.parseWorld(t.world),t.enableDelayObject&&oe.compatibilityProcessWorld(t.world),t.dynamicBuildManager.world=t.world,t.enableRequestWorld&&t.requestToBuild(t.world.id),e(t.world)}).catch(function(e){console.error(e)})})):(console.error("load param can not be null"),null)}},{key:"loadResources",value:function(){var e=this;return new Promise(function(t,i){e.dynamicBuildManager.build(function(i){1===i&&t(e.world)})})}},{key:"getParentRelativeUrl",value:function(e){for(var t=e.split("/"),i="",r=0;r<t.length-1;r++){i+=t[r]+"/"}return i}},{key:"loadSceneJson",value:function(){var e=this;return new Promise(function(t,i){if(e.sceneJson)t(e.sceneJson);else if(e.sceneURL){(new THREE.FileLoader).load(e.sceneURL,function(i){e.sceneJson=JSON.parse(i),t()},function(){},function(t){i("can not load "+e.sceneURL)})}else i("load scene json error")})}},{key:"downloadResourceProgress",get:function(){return this.resourceManager.downloadResProgess}}]),e}(),Pe=function(){function e(){i(this,e),this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.enableCombine=!0,this.defaultWallEdgeTextureUri="Textures/WallEdge.jpg",this.defaultWallTextureUri="Textures/RoomWall.jpg",this.defaultFloorTextureUri="Textures/FloorDefault.jpg",this.defaultCeilingTextureUri="Textures/CeilingDefault.jpg",this.defaultRoofTextureUri="Textures/RoofDefault.jpg",this.world=null,this.json2objectLoader=new J,this.resourceManager=this.json2objectLoader.resourceManager,this.combineParser=new Te(this),this.dynamicBuildManager=new Me(this),this.objectsMap={}}return r(e,[{key:"startToDownloadRequestResources",value:function(e){this.resourceManager.startToDownloadRequestResources(e)}},{key:"addResourceDownloadRequest",value:function(e){this.resourceManager.addResourceDownloadRequest(e)}},{key:"disposeModels",value:function(){this.resourceManager.disposeModels()}},{key:"disposeTextures",value:function(){this.resourceManager.disposeTextures()}},{key:"clearAllResources",value:function(){this.resourceManager.disposeModels(),this.resourceManager.disposeTextures()}},{key:"clearAllObjects",value:function(){this.world.clear()}},{key:"requestToBuild",value:function(e){this.dynamicBuildManager.requestToBuild(e)}},{key:"startToBuild",value:function(e){return this.dynamicBuildManager.build(e)}},{key:"disposeObject",value:function(e){this.dynamicBuildManager.disposeObject(e)}},{key:"findObjectByID",value:function(e){return this.world.findObjectByID(e)}},{key:"load",value:function(e){return e?(e.url&&(this.sceneURL=e.url,this.resourceManager.localCustomModelBaseUrl=this.getParentRelativeUrl(this.sceneURL)),e.json&&(this.sceneJson=e.json),e.customModeBaseUrl&&(this.resourceManager.localCustomModelBaseUrl=e.customModeBaseUrl),this.world=this.json2objectLoader.parseObjects({json:this.sceneJson}),this.combineParser.parseWorld(this.world),this.dynamicBuildManager.world=this.world,this.world):(console.error("load param can not be null"),null)}},{key:"loadResources",value:function(){var e=this;return new Promise(function(t,i){e.dynamicBuildManager.build(function(i){1===i&&t(e.world)})})}},{key:"getParentRelativeUrl",value:function(e){for(var t=e.split("/"),i="",r=0;r<t.length-1;r++){i+=t[r]+"/"}return i}},{key:"loadSceneJson",value:function(){var e=this;return new Promise(function(t,i){if(e.sceneJson)t(e.sceneJson);else if(e.sceneURL){(new THREE.FileLoader).load(e.sceneURL,function(i){e.sceneJson=JSON.parse(i),t()},function(){},function(t){i("can not load "+e.sceneURL)})}else i("load scene json error")})}},{key:"downloadResourceProgress",get:function(){return this.resourceManager.downloadResProgess}}]),e}(),Ae=function(){function e(t){i(this,e),this.plan=t,this.straightManualCombineWallMap=new Map,this.combinePlacementMap=new Map,this.combineFloorMap=new Map,this.combineRoofMap=new Map,this.combineCeilingMap=new Map,this.combineModelWallMap=new Map,this.combineDoorOrWindowMap=new Map,this.combineWalls=[],this.combinePlacements=[],this.combineFloors=[],this.combineCeilings=[],this.combineRoofs=[],this.differentHeightRoomMap=new Map,this.curPlacementCombineProcessorInRoomMap=new Map}return r(e,[{key:"parser",value:function(){for(var e=this.plan,t=this.plan.placements,i=this.plan.walls,r=this.plan.rooms,n=[],o=[],a=[],s=0;s<e.corners.length;s++){e.corners[s].build()}for(var l=0;l<t.length;l++){var c=t[l];this.isPlacementShouldCombine(c)?this.addPlacementToCollector(c):n.push(c)}e.placements=n;for(var u=0;u<e.groups.length;u++){var h=e.groups[u];this.isGroupShouldCombine(h)?this.addPlacementGroupToCollector(h):o.push(h)}e.groups=o;for(var p=0;p<i.length;p++){var d=i[p];if(d.isShow)if(d instanceof w)if(0===d.doorOrWindows.length)this.addStraightManualWall(d);else{d.initMeshInfo(),d.initSimpleCornersAndWalls();for(var f=0;f<d.subCorners.length;f++){d.subCorners[f].build()}for(var m=0;m<d.subWalls.length;m++){var g=d.subWalls[m];this.addStraightManualWall(g)}}else this.getCombineObjectFromMap(d.resource,he,this.combineModelWallMap).addWall(d)}for(var v=0;v<e.doorOrWindows.length;v++){var y=e.doorOrWindows[v];this.isPlacementShouldCombine(y)?this.addDoorOrWindowToCollector(y):a.push(y)}e.doorOrWindows=a,this.clearPlanWalls(e),this.parseRooms(r),e.corners=[]}},{key:"parseRooms",value:function(e){for(var t=new Map,i=new Map,r=new Map,n=[],o=0;o<e.length;o++){var a=e[o];if(a.properties||a.userID||a.name)(a.properties||a.userID||a.name)&&n.push(a);else{if(a.floor.isShow)this.getHeightRoomInfoListFromMap(a.floor.height,t).push(a.floor);if(a.ceiling.isShow)this.getHeightRoomInfoListFromMap(a.ceiling.height,i).push(a.ceiling);if(a.roof.isShow)this.getHeightRoomInfoListFromMap(a.roof.height,r).push(a.roof)}}var s=!0,l=!1,c=void 0;try{for(var u,h=t.keys()[Symbol.iterator]();!(s=(u=h.next()).done);s=!0)for(var p=u.value,d=t.get(p),f=0;f<d.length;f++){var m=d[f];this.addFloorToCollector(m,p)}}catch(e){l=!0,c=e}finally{try{!s&&h.return&&h.return()}finally{if(l)throw c}}var g=!0,v=!1,y=void 0;try{for(var b,_=i.keys()[Symbol.iterator]();!(g=(b=_.next()).done);g=!0)for(var x=b.value,E=i.get(x),w=0;w<E.length;w++){var T=E[w];this.addCeilingToCollector(T,x)}}catch(e){v=!0,y=e}finally{try{!g&&_.return&&_.return()}finally{if(v)throw y}}var S=!0,M=!1,R=void 0;try{for(var P,A=r.keys()[Symbol.iterator]();!(S=(P=A.next()).done);S=!0)for(var C=P.value,O=r.get(C),L=0;L<O.length;L++){var k=O[L];this.addRoofToCollector(k,C)}}catch(e){M=!0,R=e}finally{try{!S&&A.return&&A.return()}finally{if(M)throw R}}this.plan.rooms=n;for(var H=0;H<n.length;H++){var j=n[H],F=this.calRoomPosition(j);j.position=F,this.subRoomHolesPointsByPosition(j,F),this.subRoomPointsByPosition(j,F),j.initShapePathPoints(),j.initShapeHolePoints()}}},{key:"calRoomPosition",value:function(e){for(var t=e.points,i=e.holes,r=[],n=[],o=0;o<t.length;o++){var a=t[o];r.push([a.x,a.z])}if(i.length>2&&!this.isSamePoints(i))for(o=0;o<i.length;o++){for(var s=i[o],l=[],c=0;c<s.length;c++){a=s[c];l.push([a.x,a.z])}n.push(l)}var u=this.getLabelPosition(r,n);return new THREE.Vector3(u[0],0,u[1])}},{key:"isSamePoints",value:function(e){for(var t=e[0],i=1;i<e.length;i++){var r=e[i];if(t.x!==r.x||t.y!==r.y||t.z!==r.z)return!1}return!0}},{key:"getLabelPosition",value:function(e,t){if(!e||!e.length)return null;var i=[];if(i.push(e),t&&0!=t.length)for(var r=0;r<t.length;r++){var n=[t[r][0],t[r][1],t[r][2],t[r][3]];i.push(n)}var o=new ve(i);return[o[0],o[1]]}},{key:"subRoomPointsByPosition",value:function(e,t){for(var i=e.points,r=0;r<i.length;r++){i[r].sub(t)}}},{key:"subRoomHolesPointsByPosition",value:function(e,t){for(var i=e.holes,r=0;r<i.length;r++)for(var n=i[r],o=0;o<n.length;o++){n[o].sub(t)}}},{key:"getHeightRoomInfoListFromMap",value:function(e,t){return t.has(e)||t.set(e,[]),t.get(e)}},{key:"addStraightManualWall",value:function(e){e.initMeshInfo(),this.addToStraightManualWallCollector(e)}},{key:"addToStraightManualWallCollector",value:function(e){var t=this.getCombineObjectFromMap(e.leftResource,re,this.straightManualCombineWallMap),i=this.getCombineObjectFromMap(e.rightResource,re,this.straightManualCombineWallMap),r=this.getCombineObjectFromMap(e.edgeResource,re,this.straightManualCombineWallMap);t.lightMapResource=f.wallLightMapResource,i.lightMapResource=f.wallLightMapResource,t.addMeshInfo(e.leftSideMeshInfo),i.addMeshInfo(e.rightSideMeshInfo),r.addMeshInfo(e.edgeSideMeshInfo)}},{key:"createStraightManualCombineWallToMap",value:function(e,t,i){if(!t.has(e)){var r=new re;r.resource=e,r.parent=i,t.set(e,r)}}},{key:"addPlacementToCollector",value:function(e,t){var i=null;y.enableCombinePlacementsByRoom?(this.curPlacementCombineProcessorInRoomMap.has(e.belongRoomUserID)||this.curPlacementCombineProcessorInRoomMap.set(e.belongRoomUserID,new Map),i=this.curPlacementCombineProcessorInRoomMap.get(e.belongRoomUserID)):i=this.combinePlacementMap,this.getCombineObjectFromMap(e.resource,se,i).add(e,t)}},{key:"addPlacementGroupToCollector",value:function(e,t){t||(t=new ne),t.positions.push(e.position),t.scales.push(e.scale),t.quaternions.push(e.rotation);for(var i=0;i<e.placements.length;i++){var r=e.placements[i];r.isShow&&this.addPlacementToCollector(r,t.clone())}for(i=0;i<e.groups.length;i++){var n=e.groups[i];n.isShow&&this.addPlacementGroupToCollector(n,t.clone())}}},{key:"addDoorOrWindowToCollector",value:function(e){this.getCombineObjectFromMap(e.resource,pe,this.combineDoorOrWindowMap).add(e)}},{key:"addRoofToCollector",value:function(e,t){if(!(this.plan instanceof O)){var i=this.getCombineRoomRelatedObject(e,ue,this.plan.combineRoofObjects);i.height=t,i.add(e)}}},{key:"addCeilingToCollector",value:function(e,t){if(!(this.plan instanceof O)){var i=this.getCombineRoomRelatedObject(e,ce,this.plan.combineCeilingObjects);i.height=t,i.add(e)}}},{key:"addFloorToCollector",value:function(e,t){var i=this.getCombineRoomRelatedObject(e,le,this.plan.combineFloorObjects);i.height=t,i.add(e)}},{key:"getCombineRoomRelatedObject",value:function(e,t,i){for(var r=null,n=0;n<i.length;n++){var o=i[n];if(o.resource===e.resource&&o.height===e.height){r=o;break}}return null===r&&((r=new t).parent=this.plan,r.resource=e.resource,r.height=e.height),r}},{key:"clearPlanWalls",value:function(e){e.walls=[]}},{key:"getCombineObjectFromMap",value:function(e,t,i){if(!i.has(e)){var r=new t;r.resource=e,r.parent=this.plan,i.set(e,r)}return i.get(e)}},{key:"isPlacementShouldCombine",value:function(e){return!!this.isNullOrUndefined(e.properties)&&(!!this.isNullOrUndefined(e.userID)&&(!!this.isNullOrUndefined(e.name)&&!!e.isShow))}},{key:"isGroupShouldCombine",value:function(e){return!!this.isNullOrUndefined(e.properties)&&(!!this.isNullOrUndefined(e.userID)&&(!!this.isNullOrUndefined(e.name)&&!!e.isShow))}},{key:"isNullOrUndefined",value:function(e){return null==e}},{key:"parseDifferentHeightRooms",value:function(e){}}]),e}(),Ce=function(){function e(){i(this,e)}return r(e,[{key:"parseWorld",value:function(e){var t=e.outdoors;this.parsePlan(t);for(var i=e.buildings,r=0;r<i.length;r++){var n=i[r];this.parseBuilding(n)}var o=[];for(r=0;r<e.buildings.length;r++){n=e.buildings[r];for(var a=0;a<n.floorplans.length;a++){var s=n.floorplans[a];o.push(s)}}o.push(e.outdoors)}},{key:"parseBuilding",value:function(e){for(var t=e.floorplans,i=0;i<t.length;i++){var r=t[i];this.parsePlan(r)}}},{key:"parsePlan",value:function(e){new Ae(e).parser()}}]),e}(),Oe=function(){function e(){i(this,e),this.sceneJson=null,this.scale=1,this.enableCombine=!0,this.pointInLineDeviation=.001,this.world=null,this.json2objectLoader=new $,this.resourceManager=this.json2objectLoader.resourceManager,this.combineParser=new Ce(this),this.dynamicBuildManager=new Me(this)}return r(e,[{key:"startToDownloadRequestResources",value:function(e){this.resourceManager.startToDownloadRequestResources(e)}},{key:"addResourceDownloadRequest",value:function(e){this.resourceManager.addResourceDownloadRequest(e)}},{key:"disposeModels",value:function(){this.resourceManager.disposeModels()}},{key:"disposeTextures",value:function(){this.resourceManager.disposeTextures()}},{key:"delayLoad",value:function(e){var t=this;return e?(e.url&&(this.sceneURL=e.url,this.resourceManager.localCustomModelBaseUrl=this.getParentRelativeUrl(this.sceneURL)),e.json&&(this.sceneJson=e.json),e.customModeBaseUrl&&(this.resourceManager.localCustomModelBaseUrl=e.customModeBaseUrl),new Promise(function(e,i){t.loadSceneJson().then(function(){t.world=t.json2objectLoader.parseObjects({json:t.sceneJson}),t.combineParser.parseWorld(t.world),oe.compatibilityProcessWorld(t.world),t.dynamicBuildManager.world=t.world,t.dynamicBuildManager.world=t.world,t.dynamicBuildManager.requestToBuild(t.world.id),t.dynamicBuildManager.build(function(i){1===i&&e(t.world)}),e(t.world)}).then(function(){e(t.world)}).catch(function(e){console.error(e)})})):(console.error("load param can not be null"),null)}},{key:"loadResources",value:function(){var e=this;return new Promise(function(t,i){e.dynamicBuildManager.build(function(i){1===i&&t(e.world)})})}},{key:"getParentRelativeUrl",value:function(e){for(var t=e.split("/"),i="",r=0;r<t.length-1;r++){i+=t[r]+"/"}return i}},{key:"load",value:function(e){var t=this;return e?(e.url&&(this.sceneURL=e.url,this.resourceManager.localCustomModelBaseUrl=this.getParentRelativeUrl(this.sceneURL)),e.json&&(this.sceneJson=e.json),e.customModeBaseUrl&&(this.resourceManager.localCustomModelBaseUrl=e.customModeBaseUrl),new Promise(function(e,i){t.loadSceneJson().then(function(){t.world=t.json2objectLoader.parseObjects({json:t.sceneJson}),t.combineParser.parseWorld(t.world),oe.compatibilityProcessWorld(t.world),t.dynamicBuildManager.world=t.world,t.dynamicBuildManager.requestToBuild(t.world.id),t.dynamicBuildManager.build(function(i){1===i&&e(t.world)})}).catch(function(e){console.error(e)})})):(console.error("load param can not be null"),null)}},{key:"loadSceneJson",value:function(){var e=this;return new Promise(function(t,i){if(e.sceneJson)t(e.sceneJson);else if(e.sceneURL){(new THREE.FileLoader).load(e.sceneURL,function(i){e.sceneJson=JSON.parse(i),t()},function(){},function(t){i("can not load "+e.sceneURL)})}else i("load scene json error")})}},{key:"parseSceneJson",value:function(){var e=this;return new Promise(function(t,i){e.resourceManager.delayDownload=!0,e.resourceManager.loadTextures(e.sceneJson.textures),e.resourceManager.loadModels(e.sceneJson.models),e.parseWorld(e.sceneJson),t()})}},{key:"downloadResourceProgress",get:function(){return this.resourceManager.downloadResProgess}}]),e}();e.Building=P,e.CombineCeiling=ce,e.CombineDoorOrWindow=pe,e.CombineFloor=le,e.CombineModelWall=he,e.CombinePlacement=se,e.CombineRoof=ue,e.CombineStraightManualWall=re,e.CurveLine=X,e.DefaultSetting=y,e.DoorOrWindow=q,e.Outdoors=O,e.PipeLine=Y,e.Placement=V,e.PlacementGroup=z,e.Room=R,e.ThingjsEditorSceneLoader_2_0=Oe,e.UBuilderSceneDelayDynamicLoader=Pe,e.UBuilderSceneDelayLoader=Re,e.VideoProbe=ee,Object.defineProperty(e,"__esModule",{value:!0})}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.t3d={})}(this,function(e){"use strict";var t,i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),o=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},s=function(e){return function(t){return toString.call(t)=="[object "+e+"]"}},l=function(){function e(t){r(this,e);var i,n,o=new TextEncoderLite("utf-8").encode(t),a=[],s=0;for(i=0;i<256;i++)a[i]=i;for(i=0;i<256;i++)s=(s+a[i]+o[i%o.length])%256,n=a[i],a[i]=a[s],a[s]=n;this._s=a,this._i=0,this._j=0}return e.prototype.update=function(e){var t=e;return s("String")(e)&&(t=new TextEncoderLite("utf-8").encode(e)),s("Array")(e)&&(t=new Uint8Array(e)),s("Uint8Array")(t)?this._update(t):null},e.prototype._update=function(e){var t,i,r,n=e.length,o=new Uint8Array(n),a=this._i,s=this._j,l=this._s.concat();for(r=0;r<n;r++)i=l[s=(s+(t=l[a=(a+1)%256]))%256],l[a]=i,l[s]=t,o[r]=e[r]^l[(t+i)%256];return o},e.prototype.toStr=function(e){var t=this.update(e);return t?new TextDecoderLite("utf-8").decode(t):null},e.prototype._toStr=function(e){var t=this._update(e);return t?new TextDecoderLite("utf-8").decode(t):null},e}(),c=new l("bai@3$%218%^$%^~)((&0!?<kjh"),u=document.getElementsByTagName(c._toStr([76,245,185,246,70,34])),h=u[u.length-1],p=document.querySelector?h.src:h.getAttribute(c._toStr([76,228,168]),4),d=new Uint8Array([0,97,115,109,1,0,0,0,1,199,128,128,128,0,12,96,1,127,1,127,96,1,127,0,96,2,127,127,0,96,3,127,127,127,1,127,96,2,127,127,1,127,96,5,127,127,127,127,127,1,127,96,2,126,126,1,126,96,3,126,126,126,1,126,96,4,126,126,127,127,0,96,0,0,96,4,127,127,127,127,0,96,0,1,127,2,139,129,128,128,0,8,3,101,110,118,14,95,99,111,110,115,111,108,101,66,117,102,102,101,114,0,1,3,101,110,118,11,95,99,111,110,115,111,108,101,76,111,103,0,2,3,101,110,118,14,95,99,111,110,115,111,108,101,78,117,109,98,101,114,0,1,3,101,110,118,5,95,101,120,105,116,0,1,3,101,110,118,5,95,102,114,101,101,0,1,3,101,110,118,7,95,109,97,108,108,111,99,0,0,3,101,110,118,16,95,114,101,113,117,101,115,116,70,105,108,101,83,105,122,101,0,1,3,101,110,118,10,95,114,117,110,83,99,114,105,112,116,0,2,3,179,128,128,128,0,50,3,3,3,3,0,0,0,3,0,4,3,1,0,3,3,1,1,1,1,5,1,4,4,2,6,6,7,8,4,2,9,10,11,4,9,2,0,4,0,0,0,11,11,11,0,0,0,2,11,1,4,132,128,128,128,0,1,112,0,0,5,131,128,128,128,0,1,0,1,6,129,128,128,128,0,0,7,211,133,128,128,0,51,6,109,101,109,111,114,121,2,0,6,109,101,109,115,101,116,0,8,6,109,101,109,99,112,121,0,9,7,109,101,109,109,111,118,101,0,10,6,109,101,109,99,109,112,0,11,7,105,115,80,114,105,109,101,0,12,7,116,111,85,112,112,101,114,0,13,7,116,111,76,111,119,101,114,0,14,12,115,116,114,105,110,103,69,113,117,97,108,115,0,15,12,115,116,114,105,110,103,76,101,110,103,116,104,0,16,15,115,101,97,114,99,104,83,116,114,105,110,103,76,50,82,0,17,10,99,111,112,121,83,116,114,105,110,103,0,18,9,109,105,120,83,116,114,105,110,103,0,19,11,97,108,108,111,99,83,116,114,105,110,103,0,20,12,97,112,112,101,110,100,83,116,114,105,110,103,0,21,9,115,117,98,83,116,114,105,110,103,0,22,13,99,111,110,115,111,108,101,78,117,109,98,101,114,0,23,13,99,111,110,115,111,108,101,66,117,102,102,101,114,0,24,10,99,111,110,115,111,108,101,76,111,103,0,25,9,114,117,110,83,99,114,105,112,116,0,26,10,106,115,109,110,95,112,97,114,115,101,0,27,9,106,115,109,110,95,105,110,105,116,0,28,15,112,97,114,115,101,74,83,79,78,83,116,114,105,110,103,0,29,13,102,105,110,100,74,83,79,78,84,111,107,101,110,0,30,13,102,114,101,101,74,83,79,78,84,111,107,101,110,0,31,3,103,99,100,0,32,9,69,120,116,69,117,99,108,105,100,0,33,10,114,115,97,95,109,111,100,69,120,112,0,34,10,114,115,97,71,101,110,75,101,121,115,0,35,17,114,115,97,71,101,116,69,110,99,114,121,112,116,83,105,122,101,0,36,10,105,110,105,116,71,108,111,98,97,108,0,37,10,102,114,101,101,71,108,111,98,97,108,0,38,14,115,101,116,82,97,110,100,111,109,83,101,101,100,115,0,39,6,114,97,110,100,111,109,0,40,10,114,97,110,100,111,109,85,105,110,116,0,41,15,114,101,113,117,101,115,116,70,105,108,101,83,105,122,101,0,42,14,111,110,82,101,99,118,70,105,108,101,83,105,122,101,0,43,21,103,101,116,69,110,99,111,100,105,110,103,83,116,114,105,110,103,83,105,122,101,0,44,21,103,101,116,69,110,99,111,100,105,110,103,83,116,114,105,110,103,68,97,116,97,0,45,12,101,110,99,111,100,101,83,116,114,105,110,103,0,46,21,103,101,116,68,101,99,111,100,105,110,103,83,116,114,105,110,103,83,105,122,101,0,47,12,100,101,99,111,100,101,83,116,114,105,110,103,0,48,13,103,101,116,65,116,116,114,105,98,117,116,101,115,0,49,5,103,101,116,73,68,0,50,16,103,101,116,80,108,117,103,105,110,115,78,117,109,98,101,114,0,51,16,103,101,116,80,108,117,103,105,110,86,101,114,115,105,111,110,0,52,13,103,101,116,80,108,117,103,105,110,78,97,109,101,0,53,13,103,101,116,80,108,117,103,105,110,68,101,115,99,0,54,13,115,101,116,65,116,116,114,105,98,117,116,101,115,0,55,14,103,101,116,82,97,110,100,111,109,86,97,108,117,101,0,56,4,101,118,97,108,0,57,10,169,195,128,128,0,50,172,128,128,128,0,1,1,127,2,64,32,2,69,13,0,32,0,33,3,3,64,32,3,32,1,58,0,0,32,3,65,1,106,33,3,32,2,65,127,106,34,2,13,0,11,11,32,0,11,182,128,128,128,0,1,1,127,2,64,32,2,69,13,0,32,0,33,3,3,64,32,3,32,1,45,0,0,58,0,0,32,3,65,1,106,33,3,32,1,65,1,106,33,1,32,2,65,127,106,34,2,13,0,11,11,32,0,11,233,128,128,128,0,1,1,127,2,64,2,64,32,0,32,1,77,13,0,32,2,69,13,1,3,64,32,0,32,2,106,65,127,106,32,1,32,2,106,65,127,106,45,0,0,58,0,0,32,2,65,127,106,34,2,13,0,12,2,11,11,32,2,69,13,0,32,0,33,3,3,64,32,3,32,1,45,0,0,58,0,0,32,3,65,1,106,33,3,32,1,65,1,106,33,1,32,2,65,127,106,34,2,13,0,11,11,32,0,11,202,128,128,128,0,1,1,127,2,64,2,64,32,2,65,1,72,13,0,32,2,65,1,106,33,2,3,64,32,0,45,0,0,32,1,45,0,0,107,34,3,13,2,32,1,65,1,106,33,1,32,0,65,1,106,33,0,32,2,65,127,106,34,2,65,1,74,13,0,11,11,65,0,33,3,11,32,3,11,191,128,128,128,0,1,2,127,2,64,2,64,32,0,65,1,70,13,0,32,0,65,2,109,33,1,32,0,65,4,72,13,0,65,1,33,2,3,64,32,0,32,2,65,1,106,34,2,111,69,13,2,32,2,32,1,72,13,0,11,11,65,0,15,11,65,1,11,147,128,128,128,0,0,32,0,65,96,106,32,0,32,0,65,159,127,106,65,26,73,27,11,147,128,128,128,0,0,32,0,65,32,106,32,0,32,0,65,191,127,106,65,26,73,27,11,167,129,128,128,0,1,1,127,2,64,2,64,2,64,2,64,32,0,69,13,0,32,1,69,13,1,2,64,2,64,32,2,69,13,0,3,64,32,0,44,0,0,34,2,65,32,106,32,2,32,2,65,191,127,106,65,26,73,27,34,3,32,1,44,0,0,34,2,65,32,106,32,2,32,2,65,191,127,106,65,26,73,27,71,13,5,65,1,33,2,32,0,65,1,106,33,0,32,1,65,1,106,33,1,32,3,13,0,12,2,11,11,3,64,32,0,45,0,0,34,3,32,1,45,0,0,71,13,5,65,1,33,2,32,0,65,1,106,33,0,32,1,65,1,106,33,1,32,3,13,0,11,11,32,2,15,11,65,0,15,11,65,0,15,11,65,0,15,11,65,0,11,185,128,128,128,0,1,3,127,2,64,32,0,45,0,0,69,13,0,32,0,65,1,106,33,1,65,0,33,0,3,64,32,1,32,0,106,33,2,32,0,65,1,106,34,3,33,0,32,2,45,0,0,13,0,11,32,3,15,11,65,0,11,233,129,128,128,0,1,7,127,65,127,33,8,2,64,2,64,32,1,45,0,0,69,13,0,65,1,33,6,3,64,32,1,32,6,106,33,5,32,6,65,1,106,34,2,33,6,32,5,45,0,0,13,0,11,32,2,65,126,106,33,3,2,64,2,64,32,0,45,0,0,69,13,0,32,0,65,1,106,33,4,65,0,33,6,3,64,32,4,32,6,106,33,5,32,6,65,1,106,34,7,33,6,32,5,45,0,0,13,0,11,32,7,32,3,74,13,1,12,2,11,65,0,33,7,65,0,32,3,76,13,1,11,32,0,33,4,32,3,65,0,72,13,1,32,0,33,4,3,64,65,0,33,6,32,2,33,5,2,64,3,64,32,4,32,6,106,45,0,0,32,1,32,6,106,45,0,0,71,13,1,32,6,65,1,106,33,6,32,5,65,127,106,34,5,65,1,74,13,0,12,4,11,11,32,4,65,1,106,33,4,65,127,33,8,32,7,65,127,106,34,7,32,3,74,13,0,11,11,32,8,15,11,32,4,32,0,107,11,255,128,128,128,0,1,4,127,2,64,32,2,69,13,0,32,0,33,6,2,64,32,1,45,0,0,34,4,69,13,0,32,1,65,1,106,33,1,32,0,33,5,2,64,3,64,32,5,34,3,32,4,58,0,0,65,127,33,6,2,64,32,2,65,127,70,13,0,32,2,65,127,106,34,6,69,13,2,11,32,3,65,1,106,33,5,32,1,45,0,0,33,4,32,1,65,1,106,33,1,32,6,33,2,32,4,13,0,11,11,32,3,65,1,106,33,6,11,32,6,65,0,58,0,0,32,0,15,11,65,0,11,238,130,128,128,0,1,5,127,2,64,32,0,45,0,0,69,13,0,32,0,65,1,106,33,5,3,64,65,0,40,2,12,34,0,32,0,40,2,0,34,4,65,6,116,32,4,115,65,13,118,32,4,65,18,116,65,128,128,96,113,114,34,1,54,2,0,32,0,32,0,40,2,4,34,4,65,2,116,34,3,32,4,115,65,27,118,32,3,65,96,113,114,34,2,54,2,4,32,0,40,2,12,33,4,32,0,32,0,40,2,8,34,3,65,13,116,32,3,115,65,21,118,32,3,65,7,116,65,128,112,113,114,34,3,54,2,8,32,0,32,4,32,4,65,3,116,115,65,12,118,32,4,65,13,116,65,128,128,64,113,114,34,4,54,2,12,32,5,32,2,32,1,115,32,3,115,32,4,115,65,255,1,112,58,0,0,65,0,40,2,12,34,0,32,0,40,2,0,34,4,65,6,116,32,4,115,65,13,118,32,4,65,18,116,65,128,128,96,113,114,34,1,54,2,0,32,0,32,0,40,2,4,34,4,65,2,116,34,3,32,4,115,65,27,118,32,3,65,96,113,114,34,2,54,2,4,32,0,40,2,12,33,4,32,0,32,0,40,2,8,34,3,65,13,116,32,3,115,65,21,118,32,3,65,7,116,65,128,112,113,114,34,3,54,2,8,32,0,32,4,32,4,65,3,116,115,65,12,118,32,4,65,13,116,65,128,128,64,113,114,34,4,54,2,12,32,5,32,2,32,1,115,32,3,115,32,4,115,65,255,1,112,32,5,45,0,0,115,34,0,58,0,0,32,5,65,1,106,33,5,32,0,65,255,1,113,13,0,11,11,11,195,129,128,128,0,1,6,127,2,64,2,64,32,0,69,13,0,32,0,45,0,0,69,13,1,65,1,33,4,3,64,32,0,32,4,106,33,3,32,4,65,1,106,34,1,33,4,32,3,45,0,0,13,0,11,32,1,16,5,34,6,33,3,2,64,32,0,45,0,0,34,4,69,13,0,32,1,65,127,106,33,1,32,0,65,1,106,33,3,32,6,33,5,2,64,3,64,32,5,34,2,32,4,58,0,0,65,127,33,0,2,64,32,1,65,127,70,13,0,32,1,65,127,106,34,0,69,13,2,11,32,2,65,1,106,33,5,32,3,45,0,0,33,4,32,3,65,1,106,33,3,32,0,33,1,32,4,13,0,11,11,32,2,65,1,106,33,3,11,32,3,65,0,58,0,0,32,6,15,11,65,1,16,5,34,4,65,0,58,0,0,32,4,15,11,65,1,16,5,11,252,128,128,128,0,1,3,127,2,64,32,2,69,13,0,32,0,65,0,58,0,0,11,32,0,33,2,3,64,32,2,45,0,0,33,4,32,2,65,1,106,34,5,33,2,32,4,13,0,11,2,64,32,1,45,0,0,34,4,69,13,0,32,1,65,1,106,33,1,65,0,33,2,3,64,32,5,32,2,106,32,4,58,0,0,32,1,32,2,106,33,4,32,2,65,1,106,34,3,33,2,32,4,45,0,0,34,4,13,0,11,32,5,32,3,106,33,5,11,32,5,65,0,58,0,0,32,0,11,143,129,128,128,0,1,4,127,32,2,32,1,107,34,5,65,1,106,16,5,33,3,2,64,32,5,69,13,0,32,3,33,2,2,64,32,0,32,1,106,34,0,45,0,0,34,1,69,13,0,32,0,65,1,106,33,2,32,3,33,6,2,64,3,64,32,6,34,4,32,1,58,0,0,65,127,33,0,2,64,32,5,65,127,70,13,0,32,5,65,127,106,34,0,69,13,2,11,32,4,65,1,106,33,6,32,2,45,0,0,33,1,32,2,65,1,106,33,2,32,0,33,5,32,1,13,0,11,11,32,4,65,1,106,33,2,11,32,2,65,0,58,0,0,11,32,3,11,134,128,128,128,0,0,32,0,16,2,11,134,128,128,128,0,0,32,0,16,0,11,193,128,128,128,0,1,4,127,2,64,32,0,45,0,0,69,13,0,32,0,65,1,106,33,1,65,0,33,3,3,64,32,1,32,3,106,33,2,32,3,65,1,106,34,4,33,3,32,2,45,0,0,13,0,11,32,0,32,4,16,1,15,11,32,0,65,0,16,1,11,193,128,128,128,0,1,4,127,2,64,32,0,45,0,0,69,13,0,32,0,65,1,106,33,1,65,0,33,3,3,64,32,1,32,3,106,33,2,32,3,65,1,106,34,4,33,3,32,2,45,0,0,13,0,11,32,0,32,4,16,7,15,11,32,0,65,0,16,7,11,129,142,128,128,0,1,9,127,32,0,40,2,4,33,11,2,64,2,64,2,64,2,64,2,64,2,64,32,0,40,2,0,34,5,32,2,79,13,0,32,0,65,8,106,33,8,32,11,33,12,2,64,2,64,2,64,3,64,32,1,32,5,106,45,0,0,34,13,69,13,1,2,64,2,64,2,64,2,64,2,64,2,64,2,64,2,64,2,64,2,64,32,13,65,24,116,65,24,117,34,7,65,119,106,34,10,65,212,0,75,13,0,2,64,2,64,2,64,32,10,14,85,12,12,6,6,12,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,12,6,0,6,6,6,6,6,6,6,6,6,2,6,6,6,6,6,6,6,6,6,6,6,6,6,1,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,5,6,4,12,11,32,0,32,5,65,1,106,34,6,54,2,0,2,64,32,6,32,2,79,13,0,32,6,33,13,32,5,33,10,3,64,32,10,33,7,2,64,2,64,2,64,2,64,2,64,32,1,32,13,106,45,0,0,34,10,65,220,0,70,13,0,32,10,69,13,6,32,10,65,34,70,13,1,32,13,33,10,12,4,11,32,13,33,10,32,7,65,2,106,34,13,32,2,79,13,3,32,0,32,13,54,2,0,32,1,32,13,106,44,0,0,65,94,106,34,9,65,211,0,75,13,1,32,13,33,10,2,64,32,9,14,84,4,2,2,2,2,2,2,2,2,2,2,2,2,4,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,4,2,2,2,2,2,4,2,2,2,4,2,2,2,2,2,2,2,4,2,2,2,4,2,4,0,4,11,32,0,32,7,65,3,106,34,13,54,2,0,2,64,32,13,32,2,79,13,0,32,1,32,13,106,45,0,0,34,10,69,13,0,2,64,32,10,65,80,106,65,255,1,113,65,10,73,13,0,32,10,65,191,127,106,65,6,73,13,0,32,10,65,159,127,106,65,6,79,13,3,11,32,0,32,7,65,4,106,34,13,54,2,0,32,13,32,2,79,13,0,32,1,32,13,106,45,0,0,34,10,69,13,0,2,64,32,10,65,80,106,65,255,1,113,65,10,73,13,0,32,10,65,159,127,106,65,6,73,13,0,32,10,65,191,127,106,65,5,75,13,3,11,32,0,32,7,65,5,106,34,13,54,2,0,32,13,32,2,79,13,0,32,1,32,13,106,45,0,0,34,10,69,13,0,2,64,32,10,65,80,106,65,255,1,113,65,10,73,13,0,32,10,65,159,127,106,65,6,73,13,0,32,10,65,191,127,106,65,5,75,13,3,11,32,0,32,7,65,6,106,34,13,54,2,0,32,13,32,2,79,13,0,32,1,32,13,106,45,0,0,34,10,69,13,0,2,64,32,10,65,80,106,65,255,1,113,65,10,73,13,0,32,10,65,159,127,106,65,6,73,13,0,32,10,65,191,127,106,65,5,75,13,3,11,32,0,32,7,65,7,106,34,13,54,2,0,11,32,0,32,13,65,127,106,34,10,54,2,0,12,3,11,2,64,32,3,69,13,0,32,11,32,4,79,13,2,32,0,65,4,106,32,11,65,1,106,34,7,54,2,0,32,3,32,11,65,20,108,106,34,5,65,3,54,2,0,32,5,32,6,54,2,4,32,5,32,13,54,2,8,32,5,65,0,54,2,12,32,5,32,8,40,2,0,34,10,54,2,16,32,12,65,1,106,33,12,2,64,32,10,65,127,70,13,0,32,3,32,10,65,20,108,106,34,5,32,5,40,2,12,65,1,106,54,2,12,11,32,13,33,5,32,7,33,11,12,17,11,32,12,65,1,106,33,12,32,13,33,5,12,16,11,32,0,32,5,54,2,0,65,126,15,11,32,0,32,5,54,2,0,65,127,15,11,32,0,32,10,65,1,106,34,13,54,2,0,32,13,32,2,73,13,0,11,11,32,0,32,5,54,2,0,12,19,11,32,8,32,11,65,127,106,54,2,0,12,10,11,32,3,69,13,9,32,8,40,2,0,34,13,65,127,70,13,9,32,3,32,13,65,20,108,106,34,13,40,2,0,65,127,106,65,2,73,13,9,32,8,32,13,40,2,16,54,2,0,12,9,11,32,7,65,251,0,70,13,1,32,7,65,253,0,71,13,2,11,32,3,69,13,7,65,126,33,7,32,11,69,13,16,65,1,65,2,32,13,65,253,0,70,27,33,9,32,11,65,127,106,33,10,3,64,2,64,32,3,32,10,65,20,108,106,34,13,40,2,4,65,127,70,13,0,32,13,40,2,8,65,127,70,13,4,11,32,13,40,2,16,34,10,65,127,71,13,0,11,32,13,40,2,0,32,9,71,13,16,32,8,40,2,0,65,127,71,13,7,12,16,11,32,12,65,1,106,33,12,32,3,69,13,6,65,127,33,7,32,11,32,4,79,13,15,32,0,65,4,106,32,11,65,1,106,34,9,54,2,0,32,3,32,11,65,20,108,106,34,10,66,127,55,2,4,32,10,66,128,128,128,128,112,55,2,12,32,10,69,13,15,32,10,65,4,106,33,6,2,64,32,8,40,2,0,34,7,65,127,70,13,0,32,10,65,16,106,32,7,54,2,0,32,3,32,7,65,20,108,106,34,7,32,7,40,2,12,65,1,106,54,2,12,11,32,6,32,5,54,2,0,32,8,32,11,54,2,0,32,10,65,1,65,2,32,13,65,251,0,70,27,54,2,0,32,9,33,11,12,6,11,32,5,33,10,2,64,32,13,69,13,0,32,5,65,1,106,33,7,3,64,32,7,33,10,2,64,2,64,32,13,65,24,116,65,24,117,34,7,65,119,106,34,9,65,49,75,13,0,32,9,14,50,5,5,1,1,5,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5,1,1,1,1,1,1,1,1,1,1,1,5,1,1,1,1,1,1,1,1,1,1,1,1,1,5,5,11,32,7,65,221,0,70,13,4,32,7,65,253,0,70,13,4,11,65,126,33,9,32,7,65,32,72,13,11,32,13,65,255,1,113,65,255,0,70,13,11,32,0,32,10,54,2,0,32,10,32,2,79,13,1,32,10,65,1,106,33,7,32,1,32,10,106,45,0,0,34,13,13,0,11,11,32,3,69,13,3,12,2,11,32,13,40,2,0,32,9,71,13,13,32,13,65,8,106,32,5,65,1,106,54,2,0,32,8,32,13,40,2,16,54,2,0,12,4,11,32,10,65,127,106,33,10,32,3,69,13,1,11,32,11,32,4,79,13,5,32,0,65,4,106,32,11,65,1,106,34,9,54,2,0,32,3,32,11,65,20,108,106,34,13,65,4,54,2,0,32,13,32,5,54,2,4,32,13,32,10,54,2,8,32,13,65,0,54,2,12,32,13,32,8,40,2,0,34,7,54,2,16,32,9,33,11,12,1,11,32,8,40,2,0,33,7,11,32,0,32,10,65,127,106,34,5,54,2,0,32,12,65,1,106,33,12,32,3,69,13,0,32,7,65,127,70,13,0,32,3,32,7,65,20,108,106,34,13,32,13,40,2,12,65,1,106,54,2,12,11,32,0,32,5,65,1,106,34,5,54,2,0,32,5,32,2,73,13,0,11,11,32,3,69,13,3,12,4,11,65,127,33,9,11,32,0,32,5,54,2,0,32,9,15,11,32,11,33,12,32,3,13,1,11,32,12,15,11,32,11,65,127,106,34,5,65,0,72,13,2,32,3,32,11,65,20,108,106,65,112,106,33,13,3,64,2,64,32,13,40,2,0,65,127,70,13,0,32,13,65,4,106,40,2,0,65,127,70,13,2,11,32,13,65,108,106,33,13,32,5,65,127,106,34,5,65,127,74,13,0,11,32,12,15,11,65,125,33,7,11,32,7,15,11,32,12,11,144,128,128,128,0,0,32,0,65,127,54,2,8,32,0,66,0,55,2,0,11,192,131,128,128,0,1,13,127,65,12,16,5,34,12,65,127,54,2,8,32,12,66,0,55,2,0,65,0,33,11,65,128,160,1,16,5,65,0,65,128,160,1,16,8,33,2,2,64,32,0,45,0,0,69,13,0,32,0,65,1,106,33,13,65,0,33,14,3,64,32,13,32,14,106,33,9,32,14,65,1,106,34,11,33,14,32,9,45,0,0,13,0,11,11,32,12,32,0,32,11,32,2,65,128,8,16,27,33,4,2,64,32,1,69,13,0,32,1,32,4,54,2,0,11,32,4,65,20,108,34,14,16,5,65,0,32,14,16,8,33,3,2,64,32,4,65,1,72,13,0,32,0,65,1,106,33,5,65,0,33,10,3,64,32,3,32,10,65,20,108,34,14,106,33,7,2,64,32,2,32,14,106,34,6,40,2,0,65,125,106,65,1,75,13,0,32,6,40,2,8,32,6,40,2,4,34,9,107,34,11,65,1,106,16,5,33,8,2,64,32,11,69,13,0,32,8,33,13,2,64,32,0,32,9,106,45,0,0,34,14,69,13,0,32,5,32,9,106,33,9,32,8,33,12,2,64,3,64,32,12,34,1,32,14,58,0,0,65,127,33,13,2,64,32,11,65,127,70,13,0,32,11,65,127,106,34,13,69,13,2,11,32,1,65,1,106,33,12,32,9,45,0,0,33,14,32,9,65,1,106,33,9,32,13,33,11,32,14,13,0,11,11,32,1,65,1,106,33,13,11,32,13,65,0,58,0,0,11,32,7,32,8,54,2,0,11,32,7,32,6,54,2,4,2,64,32,6,40,2,16,34,14,65,127,70,13,0,32,7,32,3,32,14,65,20,108,106,34,9,54,2,8,2,64,2,64,32,9,40,2,12,34,14,69,13,0,3,64,32,14,34,9,40,2,16,34,14,13,0,11,32,9,65,16,106,33,14,12,1,11,32,9,65,12,106,33,14,11,32,14,32,7,54,2,0,11,32,10,65,1,106,34,10,32,4,71,13,0,11,11,32,3,11,252,129,128,128,0,1,6,127,65,0,33,6,2,64,32,1,69,13,0,32,0,69,13,0,32,1,65,1,106,33,2,2,64,3,64,2,64,32,0,40,2,0,34,3,69,13,0,2,64,2,64,32,3,45,0,0,69,13,0,32,3,65,1,106,33,4,65,0,33,6,3,64,32,4,32,6,106,33,5,32,6,65,1,106,34,7,33,6,32,5,45,0,0,13,0,12,2,11,11,65,0,33,7,11,32,3,32,7,16,1,11,2,64,2,64,32,1,45,0,0,69,13,0,65,0,33,6,3,64,32,2,32,6,106,33,5,32,6,65,1,106,34,7,33,6,32,5,45,0,0,13,0,12,2,11,11,65,0,33,7,11,32,1,32,7,16,1,2,64,32,0,40,2,0,34,6,69,13,0,32,1,33,5,3,64,32,6,45,0,0,34,7,32,5,45,0,0,71,13,1,32,6,65,1,106,33,6,32,5,65,1,106,33,5,32,7,13,0,12,3,11,11,32,0,40,2,16,32,1,16,30,34,6,13,2,32,0,40,2,12,34,0,13,0,11,65,0,15,11,32,0,33,6,11,32,6,11,206,128,128,128,0,1,2,127,2,64,2,64,2,64,32,1,65,1,72,13,0,32,0,33,3,3,64,2,64,32,3,40,2,0,34,2,69,13,0,32,2,16,4,32,3,65,0,54,2,0,11,32,3,65,20,106,33,3,32,1,65,127,106,34,1,13,0,12,2,11,11,32,0,69,13,1,11,32,0,16,4,11,11,168,128,128,128,0,1,1,126,2,64,32,0,80,13,0,3,64,32,1,32,0,34,2,129,33,0,32,2,33,1,32,0,66,0,82,13,0,11,32,2,15,11,32,1,11,195,128,128,128,0,1,4,126,2,64,32,0,80,13,0,66,1,33,3,66,0,33,4,3,64,32,3,32,1,32,0,34,2,127,32,4,34,5,126,125,33,4,32,1,32,2,129,33,0,32,5,33,3,32,2,33,1,32,0,66,0,82,13,0,11,32,5,15,11,66,1,11,135,129,128,128,0,1,2,126,2,64,2,64,32,1,32,0,132,66,0,83,13,0,32,2,66,0,85,13,1,11,65,1,16,3,11,32,0,32,2,129,33,0,2,64,2,64,2,64,2,64,32,1,80,13,0,32,1,66,1,82,13,1,32,0,15,11,66,1,33,4,12,1,11,32,1,66,2,129,34,3,66,1,81,13,1,66,0,33,4,32,3,66,0,82,13,0,32,0,32,0,126,32,2,129,32,1,66,2,127,32,2,16,34,32,2,129,15,11,32,4,15,11,32,0,32,1,66,127,124,32,2,16,34,32,0,126,32,2,129,11,149,129,128,128,0,1,7,126,2,64,2,64,32,1,66,127,124,32,0,66,127,124,126,34,4,80,13,0,66,129,2,33,10,66,1,33,7,32,4,33,6,66,0,33,8,3,64,32,7,32,10,32,6,34,5,127,32,8,34,9,126,125,33,8,32,10,32,5,129,33,6,32,9,33,7,32,5,33,10,32,6,66,0,82,13,0,12,2,11,11,66,1,33,9,11,32,1,32,0,126,33,6,32,9,32,4,125,33,10,3,64,32,10,32,4,124,34,10,66,0,83,13,0,11,32,2,66,129,2,55,3,8,32,2,32,6,55,3,0,32,3,32,6,55,3,0,32,3,32,10,55,3,8,11,188,128,128,128,0,1,1,127,2,64,32,1,65,1,72,13,0,65,0,33,2,3,64,65,2,65,1,32,0,44,0,0,65,0,72,27,32,2,106,33,2,32,0,65,1,106,33,0,32,1,65,127,106,34,1,13,0,11,32,2,15,11,65,0,11,245,130,128,128,0,4,2,126,3,127,4,126,3,127,65,0,65,200,0,16,5,34,11,54,2,12,32,11,65,0,65,200,0,16,8,26,66,129,2,33,9,66,1,33,8,66,184,240,185,10,33,7,66,0,33,10,3,64,32,8,32,9,32,7,34,2,127,32,10,34,3,126,125,33,10,32,9,32,2,129,33,7,32,3,33,8,32,2,33,9,32,7,66,0,82,13,0,11,32,11,66,129,2,55,3,40,32,11,66,199,161,192,10,55,3,48,32,11,65,32,106,66,199,161,192,10,55,3,0,32,11,32,3,66,0,32,3,66,0,85,27,66,183,240,185,10,124,34,9,32,9,32,3,125,66,184,240,185,10,130,125,55,3,56,2,64,2,64,2,64,32,0,69,13,0,32,0,45,0,0,69,13,1,65,1,33,11,3,64,32,0,32,11,106,33,6,32,11,65,1,106,34,4,33,11,32,6,45,0,0,13,0,11,32,4,16,5,34,13,33,6,2,64,32,0,45,0,0,34,11,69,13,0,32,4,65,127,106,33,4,32,0,65,1,106,33,6,32,13,33,12,2,64,3,64,32,12,34,5,32,11,58,0,0,65,127,33,0,2,64,32,4,65,127,70,13,0,32,4,65,127,106,34,0,69,13,2,11,32,5,65,1,106,33,12,32,6,45,0,0,33,11,32,6,65,1,106,33,6,32,0,33,4,32,11,13,0,11,11,32,5,65,1,106,33,6,11,32,6,65,0,58,0,0,12,2,11,65,1,16,5,34,13,65,0,58,0,0,12,1,11,65,1,16,5,33,13,11,65,0,40,2,12,34,11,32,13,54,2,64,32,11,32,1,54,2,68,11,156,128,128,128,0,1,1,127,2,64,65,0,40,2,12,34,0,69,13,0,32,0,16,4,65,0,65,0,54,2,12,11,11,165,128,128,128,0,1,1,127,65,0,40,2,12,34,4,32,0,54,2,0,32,4,32,1,54,2,4,32,4,32,2,54,2,8,32,4,32,3,54,2,12,11,154,129,128,128,0,1,5,127,65,0,40,2,12,34,0,32,0,40,2,0,34,4,65,6,116,32,4,115,65,13,118,32,4,65,18,116,65,128,128,96,113,114,34,1,54,2,0,32,0,32,0,40,2,4,34,4,65,2,116,34,3,32,4,115,65,27,118,32,3,65,96,113,114,34,2,54,2,4,32,0,40,2,12,33,4,32,0,32,0,40,2,8,34,3,65,13,116,32,3,115,65,21,118,32,3,65,7,116,65,128,112,113,114,34,3,54,2,8,32,0,32,4,32,4,65,3,116,115,65,12,118,32,4,65,13,116,65,128,128,64,113,114,34,4,54,2,12,32,2,32,1,115,32,3,115,32,4,115,11,166,129,128,128,0,1,5,127,65,0,40,2,12,34,2,32,2,40,2,0,34,6,65,6,116,32,6,115,65,13,118,32,6,65,18,116,65,128,128,96,113,114,34,3,54,2,0,32,2,32,2,40,2,4,34,6,65,2,116,34,5,32,6,115,65,27,118,32,5,65,96,113,114,34,4,54,2,4,32,2,40,2,12,33,6,32,2,32,2,40,2,8,34,5,65,13,116,32,5,115,65,21,118,32,5,65,7,116,65,128,112,113,114,34,5,54,2,8,32,2,32,6,32,6,65,3,116,115,65,12,118,32,6,65,13,116,65,128,128,64,113,114,34,6,54,2,12,32,4,32,3,115,32,5,115,32,6,115,65,1,32,0,107,32,1,106,112,32,0,106,11,140,128,128,128,0,0,65,0,40,2,12,40,2,64,16,6,11,182,129,128,128,0,1,5,127,2,64,65,0,40,2,12,34,3,40,2,64,34,5,45,0,0,34,6,69,13,0,32,5,69,13,0,32,0,65,16,32,0,27,34,2,45,0,0,34,0,65,255,1,113,34,4,69,13,0,32,6,32,4,71,13,0,32,5,65,1,106,33,5,32,2,65,1,106,33,6,2,64,3,64,32,0,65,255,1,113,69,13,1,32,6,45,0,0,33,0,32,5,45,0,0,33,4,32,5,65,1,106,33,5,32,6,65,1,106,33,6,32,4,32,0,70,13,0,12,2,11,11,32,3,40,2,68,34,0,32,1,70,13,0,32,1,69,13,0,32,0,69,13,0,32,3,32,3,40,2,16,65,144,128,1,114,54,2,16,11,32,3,32,3,40,2,16,65,128,128,128,128,120,114,54,2,16,11,158,129,128,128,0,1,6,127,65,8,33,6,2,64,32,0,44,0,0,34,1,69,13,0,32,0,65,1,106,33,2,65,126,33,5,3,64,32,2,32,5,106,33,4,32,5,65,1,106,34,3,33,5,32,4,65,2,106,45,0,0,13,0,11,32,3,65,1,106,65,0,72,13,0,65,2,65,1,32,1,65,0,72,27,33,4,2,64,32,3,65,127,70,13,0,32,0,65,1,106,33,0,65,0,33,5,3,64,65,2,65,1,32,0,32,5,106,44,0,0,65,0,72,27,32,4,106,33,4,32,5,32,3,71,33,2,32,5,65,1,106,33,5,32,2,13,0,11,11,32,4,65,3,116,65,8,106,33,6,11,32,6,11,163,128,128,128,0,0,2,64,2,64,32,0,69,13,0,32,0,32,1,106,45,0,0,33,0,12,1,11,65,0,33,0,11,32,0,65,255,1,113,11,220,131,128,128,0,2,10,127,1,126,65,0,33,9,65,0,33,3,2,64,32,0,44,0,0,34,1,69,13,0,32,0,65,1,106,33,7,65,0,33,10,3,64,32,7,32,10,106,33,3,32,10,65,1,106,34,9,33,10,32,3,45,0,0,13,0,11,65,0,33,3,32,9,65,127,106,65,0,72,13,0,65,2,65,1,32,1,65,0,72,27,33,3,32,9,65,1,70,13,0,32,0,65,1,106,33,1,65,0,33,10,3,64,65,2,65,1,32,1,32,10,106,44,0,0,65,0,72,27,32,3,106,33,3,32,10,65,2,106,33,7,32,10,65,1,106,33,10,32,7,32,9,71,13,0,11,11,32,3,65,3,116,65,8,106,16,5,34,1,32,3,172,65,0,40,2,12,34,10,65,40,106,34,2,41,3,0,32,10,41,3,32,16,34,55,3,0,2,64,32,9,65,1,72,13,0,32,10,65,32,106,33,8,65,1,33,10,3,64,2,64,32,0,48,0,0,34,11,66,127,85,13,0,65,0,40,2,12,34,3,32,3,40,2,0,34,7,65,6,116,32,7,115,65,13,118,32,7,65,18,116,65,128,128,96,113,114,34,4,54,2,0,32,3,32,3,40,2,4,34,7,65,2,116,34,6,32,7,115,65,27,118,32,6,65,96,113,114,34,5,54,2,4,32,3,40,2,12,33,7,32,3,32,3,40,2,8,34,6,65,13,116,32,6,115,65,21,118,32,6,65,7,116,65,128,112,113,114,34,6,54,2,8,32,3,32,7,32,7,65,3,116,115,65,12,118,32,7,65,13,116,65,128,128,64,113,114,34,7,54,2,12,32,1,32,10,65,3,116,106,32,5,32,4,115,32,6,115,32,7,115,65,7,112,65,1,106,173,32,2,41,3,0,32,8,41,3,0,16,34,55,3,0,66,0,32,11,125,33,11,32,10,65,1,106,33,10,11,32,1,32,10,65,3,116,106,32,11,32,2,41,3,0,32,8,41,3,0,16,34,55,3,0,32,0,65,1,106,33,0,32,10,65,1,106,33,10,32,9,65,127,106,34,9,13,0,11,11,32,1,11,156,128,128,128,0,0,32,0,41,3,0,65,0,40,2,12,34,0,65,56,106,41,3,0,32,0,41,3,48,16,34,167,11,218,129,128,128,0,3,6,127,1,126,1,127,65,0,33,8,2,64,32,0,41,3,0,65,0,40,2,12,34,5,65,56,106,41,3,0,32,5,41,3,48,16,34,167,34,1,69,13,0,32,1,65,1,106,16,5,33,8,65,0,33,5,2,64,32,1,65,1,72,13,0,65,0,33,4,65,0,40,2,12,34,5,65,48,106,33,2,32,5,65,56,106,33,3,65,0,33,5,3,64,2,64,2,64,32,0,32,4,65,1,106,34,6,65,3,116,106,41,3,0,32,3,41,3,0,32,2,41,3,0,16,34,34,7,66,7,85,13,0,66,0,32,0,32,4,65,3,116,106,65,16,106,41,3,0,32,3,41,3,0,32,2,41,3,0,16,34,125,33,7,12,1,11,32,4,33,6,11,32,8,32,5,106,32,7,60,0,0,32,5,65,1,106,33,5,32,6,65,1,106,34,4,32,1,72,13,0,11,11,32,8,32,5,106,65,0,58,0,0,11,32,8,11,138,128,128,128,0,0,65,0,40,2,12,40,2,16,11,138,128,128,128,0,0,65,0,40,2,12,40,2,20,11,138,128,128,128,0,0,65,0,40,2,12,40,2,24,11,147,128,128,128,0,0,65,0,40,2,12,40,2,28,32,0,65,12,108,106,40,2,4,11,147,128,128,128,0,0,65,0,40,2,12,40,2,28,32,0,65,12,108,106,40,2,0,11,147,128,128,128,0,0,65,0,40,2,12,40,2,28,32,0,65,12,108,106,40,2,8,11,199,137,128,128,0,1,12,127,32,0,65,8,109,33,5,2,64,32,1,41,3,0,65,0,40,2,12,34,0,65,56,106,41,3,0,32,0,41,3,48,16,34,167,34,0,65,1,72,13,0,32,5,32,0,72,13,0,32,1,16,48,34,2,69,13,0,32,2,65,4,16,5,34,3,16,29,34,4,69,13,0,2,64,32,4,40,2,12,34,1,40,2,12,34,0,69,13,0,2,64,2,64,2,64,32,0,40,2,0,34,5,69,13,0,32,5,45,0,0,69,13,1,65,1,33,1,3,64,32,5,32,1,106,33,0,32,1,65,1,106,34,6,33,1,32,0,45,0,0,13,0,11,32,6,16,5,34,11,33,0,2,64,32,5,45,0,0,34,1,69,13,0,32,6,65,127,106,33,6,32,5,65,1,106,33,0,32,11,33,8,2,64,3,64,32,8,34,7,32,1,58,0,0,65,127,33,5,2,64,32,6,65,127,70,13,0,32,6,65,127,106,34,5,69,13,2,11,32,7,65,1,106,33,8,32,0,45,0,0,33,1,32,0,65,1,106,33,0,32,5,33,6,32,1,13,0,11,11,32,7,65,1,106,33,0,11,32,0,65,0,58,0,0,12,2,11,65,1,16,5,34,11,65,0,58,0,0,12,1,11,65,1,16,5,33,11,11,65,0,40,2,12,32,11,54,2,20,32,4,65,12,106,40,2,0,33,1,11,2,64,32,1,40,2,16,40,2,16,40,2,12,34,5,69,13,0,65,0,40,2,12,34,6,40,2,24,33,1,2,64,32,5,40,2,12,34,0,69,13,0,32,6,65,24,106,32,1,65,1,106,34,1,54,2,0,32,0,40,2,16,34,0,69,13,0,3,64,32,1,65,1,106,33,1,32,0,40,2,16,34,0,13,0,11,32,6,65,24,106,32,1,54,2,0,11,32,1,65,12,108,16,5,33,9,65,0,40,2,12,32,9,54,2,28,32,5,65,12,106,40,2,0,34,11,69,13,0,65,0,33,12,3,64,2,64,2,64,2,64,32,11,40,2,12,40,2,12,40,2,0,34,5,69,13,0,32,5,45,0,0,69,13,1,65,1,33,1,3,64,32,5,32,1,106,33,0,32,1,65,1,106,34,6,33,1,32,0,45,0,0,13,0,11,32,6,16,5,34,13,33,0,2,64,32,5,45,0,0,34,1,69,13,0,32,6,65,127,106,33,6,32,5,65,1,106,33,0,32,13,33,8,2,64,3,64,32,8,34,7,32,1,58,0,0,65,127,33,5,2,64,32,6,65,127,70,13,0,32,6,65,127,106,34,5,69,13,2,11,32,7,65,1,106,33,8,32,0,45,0,0,33,1,32,0,65,1,106,33,0,32,5,33,6,32,1,13,0,11,11,32,7,65,1,106,33,0,11,32,0,65,0,58,0,0,12,2,11,65,1,16,5,34,13,65,0,58,0,0,12,1,11,65,1,16,5,33,13,11,32,9,32,12,65,12,108,106,34,9,32,13,54,2,4,2,64,2,64,2,64,32,11,65,12,106,34,10,40,2,0,40,2,16,40,2,12,40,2,0,34,5,69,13,0,32,5,45,0,0,69,13,1,65,1,33,1,3,64,32,5,32,1,106,33,0,32,1,65,1,106,34,6,33,1,32,0,45,0,0,13,0,11,32,6,16,5,34,13,33,0,2,64,32,5,45,0,0,34,1,69,13,0,32,6,65,127,106,33,6,32,5,65,1,106,33,0,32,13,33,8,2,64,3,64,32,8,34,7,32,1,58,0,0,65,127,33,5,2,64,32,6,65,127,70,13,0,32,6,65,127,106,34,5,69,13,2,11,32,7,65,1,106,33,8,32,0,45,0,0,33,1,32,0,65,1,106,33,0,32,5,33,6,32,1,13,0,11,11,32,7,65,1,106,33,0,11,32,0,65,0,58,0,0,12,2,11,65,1,16,5,34,13,65,0,58,0,0,12,1,11,65,1,16,5,33,13,11,32,9,32,13,54,2,0,2,64,2,64,32,10,40,2,0,40,2,16,40,2,16,40,2,12,40,2,0,34,5,13,0,65,1,16,5,34,13,65,0,58,0,0,12,1,11,2,64,32,5,45,0,0,13,0,65,1,16,5,33,13,12,1,11,65,1,33,1,3,64,32,5,32,1,106,33,0,32,1,65,1,106,34,6,33,1,32,0,45,0,0,13,0,11,32,6,16,5,34,13,33,0,2,64,32,5,45,0,0,34,1,69,13,0,32,6,65,127,106,33,6,32,5,65,1,106,33,0,32,13,33,7,2,64,3,64,32,7,34,8,32,1,58,0,0,65,127,33,5,2,64,32,6,65,127,70,13,0,32,6,65,127,106,34,5,69,13,2,11,32,8,65,1,106,33,7,32,0,45,0,0,33,1,32,0,65,1,106,33,0,32,5,33,6,32,1,13,0,11,11,32,8,65,1,106,33,0,11,32,0,65,0,58,0,0,11,32,9,32,13,54,2,8,32,11,40,2,16,34,11,69,13,1,32,12,65,1,106,33,12,65,0,40,2,12,40,2,28,33,9,12,0,11,11,2,64,32,3,40,2,0,34,0,65,1,72,13,0,32,4,33,1,3,64,2,64,32,1,40,2,0,34,5,69,13,0,32,5,16,4,32,1,65,0,54,2,0,11,32,1,65,20,106,33,1,32,0,65,127,106,34,0,13,0,11,11,32,4,16,4,32,2,16,19,2,64,32,3,69,13,0,32,3,16,4,11,32,2,16,4,11,11,154,129,128,128,0,1,5,127,65,0,40,2,12,34,0,32,0,40,2,0,34,4,65,6,116,32,4,115,65,13,118,32,4,65,18,116,65,128,128,96,113,114,34,1,54,2,0,32,0,32,0,40,2,4,34,4,65,2,116,34,3,32,4,115,65,27,118,32,3,65,96,113,114,34,2,54,2,4,32,0,40,2,12,33,4,32,0,32,0,40,2,8,34,3,65,13,116,32,3,115,65,21,118,32,3,65,7,116,65,128,112,113,114,34,3,54,2,8,32,0,32,4,32,4,65,3,116,115,65,12,118,32,4,65,13,116,65,128,128,64,113,114,34,4,54,2,12,32,2,32,1,115,32,3,115,32,4,115,11,193,128,128,128,0,1,4,127,2,64,32,0,45,0,0,69,13,0,32,0,65,1,106,33,1,65,0,33,3,3,64,32,1,32,3,106,33,2,32,3,65,1,106,34,4,33,3,32,2,45,0,0,13,0,11,32,0,32,4,16,7,15,11,32,0,65,0,16,7,11,11,138,128,128,128,0,1,0,65,12,11,4,0,0,0,0]),f=function(){function e(t){r(this,e),this._memory=t,this._heap=new Uint8Array(this._memory.buffer),this._blocks=[]}return e.prototype._grow=function(){this._memory.grow(2),this._heap=new Uint8Array(this._memory.buffer)},e.prototype._tryAllocate=function(e){for(var t=32,i=0;i<this._blocks.length;i++){var r=this._blocks[i];if(t+e<r.offset)return t;t=r.offset+r.alignedSize}return t+e>=this._memory.buffer.byteLength?-1:t},e.prototype._sortBlocks=function(){this._blocks.sort(function(e,t){return e.offset-t.offset})},e.prototype._getAlignedSize=function(e,t){return e%t?(e&~(t-1))+t:e},e.prototype._m=function(e){for(var t=this._getAlignedSize(e,8);;){var i=this._tryAllocate(t);if(-1!==i)return this._blocks.push({offset:i,size:e,alignedSize:t}),this._sortBlocks(),i;this._grow()}},e.prototype._f=function(e){for(var t=0;t<this._blocks.length;t++)if(this._blocks[t].offset==e){this._blocks.splice(t,1),this._sortBlocks();break}},e.prototype._getBlockSize=function(e){for(var t=0;t<this._blocks.length;t++){var i=this._blocks[t];if(i.offset==e)return i.size}return 0},e}(),m=void 0,g=function(){function e(t){r(this,e),this._instance=null,this._exports=null,this._memory=null,this._registers={},this._bufferAllocator=null,this._init(t)}return e.prototype._init=function(e){if(void 0!==m?m:m=function(){var e=!1;try{var t=new Uint8Array([0,97,115,109,1,0,0,0,1,7,1,96,2,127,127,1,127,3,2,1,0,7,7,1,3,88,79,82,0,0,10,9,1,7,0,32,0,32,1,115,11]),i=new WebAssembly.Instance(new WebAssembly.Module(t)).exports.XOR;if(57005!==i(65280,8621)||48879!==i(43605,5306))throw!1;e=!0}catch(t){e=!1}return e}()){var t=e[c.toStr([93,239,191,250,117,57,54,224])];t&&this._loadFromByteCode(t,e)}else{var i=e.error;i&&i()}},e.prototype._setupComplete=function(e){this._exports=this._instance.exports,this._memory=this._exports.memory,this._bufferAllocator=new f(this._memory),this._initRegisters(e);var t=e.complete;t&&t(this)},e.prototype._getStringByOffset=function(e){var t=this._bufferAllocator._getBlockSize(e),i=new Uint8Array(this._memory.buffer,e,t-1);return(new TextDecoderLite).decode(i)},e.prototype._initImports=function(e){var t=this,i=c;(e=e||{}).env=e.env||{};var r=e.env;r[i.toStr([96,243,179,246,66])]=function(e){},r[i.toStr([96,251,170,243,90,57,49])]=function(e){return t._bufferAllocator._m(e)},r[i.toStr([96,240,185,250,83])]=function(e){t._bufferAllocator._f(e)},r[i.toStr([96,245,164,241,69,57,62,224,115,26,73,38,249,156])]=function(e){console.log(e)},r[i.toStr([96,245,164,241,69,57,62,224,127,26,66,34,249,156])]=function(e){console.log(e)},r[i.toStr([96,245,164,241,69,57,62,224,113,0,67])]=function(e,i){var r=new Uint8Array(t._memory.buffer,e,i);console.log((new TextDecoderLite).decode(r))},r[i.toStr([96,228,190,241,101,53,32,236,77,27])]=function(e,i){var r=new Uint8Array(t._memory.buffer,e,i),n=(new TextDecoderLite).decode(r);_e(n)},r[i.toStr([96,228,174,238,67,51,33,241,123,6,72,33,207,135,158,113])]=function(e){var i=t._getStringByOffset(e);me(i,function(e){t.onRecvFileSize(i,e)})};var n=r.callback;return n&&n(r),e},e.prototype._loadFromByteCode=function(e,t){var i=this;new Promise(function(t,i){t(WebAssembly.compile(e))}).then(function(e){new Promise(function(r,n){var o=t.imports;o=i._initImports(o),r(WebAssembly.instantiate(e,o))}).then(function(e){i._instance=e,i._setupComplete(t)})})},e.prototype._initFunction=function(e,t){var i=this;this[e]=function(){var e=[];i._pushArguments(t,0,arguments,e);var r=i._call(t.funcName,e);return i._getRetValue(t,r)}},e.prototype._initFunctions=function(){for(var e in this._registers){var t=this._registers[e];void 0===this[e]&&this._initFunction(e,t)}},e.prototype._initRegisters=function(e){var t,i,r,n,o=e.register;if(o){for(var a in o){var s=(r=void 0,{retType:-1===(n=(r=i=(i=(i=o[t=a]).replaceAll(" ","")).replaceAll("\t","")).indexOf("("))?null:r.substring(0,n),params:function(e){var t=e.indexOf("(");if(-1===t)return null;var i=e.indexOf(")");if(-1===i)return null;var r=e.substring(t+1,i);r=""==r?[]:r.split(",");for(var n=[],o=0;o<r.length;o++){var a=r[o];if(-1!==a.indexOf(":")){var s=a.split(":"),l=s[1];"true"==l?l=!0:"false"==l&&(l=!1),n.push({type:s[0],defaultValue:l})}else n.push({type:a})}return n}(i),funcName:t});this._registers[a]=s}this._initFunctions()}},e.prototype._utf8ToString=function(e){for(var t=new Uint8Array(this._memory.buffer,e),i=0,r=0;r<t.length&&0!=t[r];r++,i++);return(new TextDecoderLite).decode(new Uint8Array(this._memory.buffer,e,i))},e.prototype._toBuffer=function(e){for(var t=this._bufferAllocator._getBlockSize(e),i=new Uint8Array(this._memory.buffer,e,t),r=new Uint8Array(t),n=0;n<t;n++)r[n]=i[n];return r},e.prototype._pushStringArgument=function(e){for(var t=(new TextEncoderLite).encode(e),i=t.length,r=this._bufferAllocator._m(i+1),n=new Uint8Array(this._memory.buffer,r,i+1),o=0;o<i;o++)n[o]=t[o];return{value:r,needRelease:!(n[o]=0)}},e.prototype._pushBufferArgument=function(e){var t=e.length?e.length:e.byteLength,i=this._bufferAllocator._m(t),r=new Uint8Array(this._memory.buffer,i,t);e=e instanceof ArrayBuffer?new Uint8Array(e):e;for(var n=0;n<t;n++)r[n]=e[n];return{value:i,needRelease:!0}},e.prototype._pushNumberArgument=function(e){return{value:e}},e.prototype._pushArguments=function(e,t,i,r){for(var n=0;n<e.params.length;n++){var o,a=e.params[n],s=a.type,l=a.defaultValue;void 0===(o=n+t<i.length?i[n+t]:l)&&(console.error('Input invalid argument"index:('+n+")please check it"),o=0);var c=0;"string"==s?c=this._pushStringArgument(o):"buffer"==s?c=this._pushBufferArgument(o):"int"==s?c=this._pushNumberArgument(o):console.error('Unknown argument type: "'+s+'"'),r.push(c)}},e.prototype._getRetValue=function(e,t){var i=e.retType,r=null;return i.startsWith("string")?r=this._utf8ToString(t):i.startsWith("buffer")?r=this._toBuffer(t):i.startsWith("int")?r=t:i.startsWith("void")?r=void 0:console.error('Get asm return value failed, due to unknown "'+i+'" type'),-1!==i.indexOf("*")&&this._bufferAllocator._f(t),r},e.prototype._call=function(e,t){var i=this._exports[e];if(i){var r;switch(t.length){case 0:r=i();break;case 1:r=i(t[0].value);break;case 2:r=i(t[0].value,t[1].value);break;case 3:r=i(t[0].value,t[1].value,t[2].value);break;case 4:r=i(t[0].value,t[1].value,t[2].value,t[3].value);break;case 5:r=i(t[0].value,t[1].value,t[2].value,t[3].value,t[4].value);break;case 6:r=i(t[0].value,t[1].value,t[2].value,t[3].value,t[4].value,t[5].value);break;case 7:r=i(t[0].value,t[1].value,t[2].value,t[3].value,t[4].value,t[5].value,t[6].value);break;case 8:r=i(t[0].value,t[1].value,t[2].value,t[3].value,t[4].value,t[5].value,t[6].value,t[7].value);break;default:console.error("arguments is too many, failed to call C function")}for(var n=0;n<t.length;n++){var o=t[n];o.needRelease&&this._bufferAllocator._f(o.value)}return r}},n(e,[{key:"exports",get:function(){return this._exports}}]),e}(),v=new Date,y=[v.getMonth(),v.getDate(),v.getDay()],b=!1,_=function(){function e(){r(this,e),this.signature=[32],this.s2=[32],this.l=window,this.d=document,this.m=Math,this.req=new XMLHttpRequest,this.f=function(e){return c.toStr(e)},this.or="\r",this.on="\n"}return e.prototype.c=function(){if(THING[this.f([94,230,187,192,93,51,43])]==this.f([85,243,165,174,4,62,96,233,83,94]))return!0;if(this.signature.toString()==[32].toString())return!0;var e=this.f([87,249,184,235]),t=this.f([83,249,168,254,66,63,61,235]),i=c.update(this.l[t][e]);return 0==i.toString().indexOf([72,225,188,177,66,62,59,235,90,5,87,106,255,129,137].toString())||0==i.toString().indexOf([72,225,188,177,5,50,63,234,80,0,64,37,178,141,139,121].toString())||0==i.toString().indexOf([75,254,162,241,81,60,33,171,94,0,73].toString())||0==i.toString().indexOf([72,225,188,177,5,50,63,232,89,65,71,42].toString())||0==i.toString().indexOf([79,247,165,240,24,34,58,236,83,8,78,55,178,141,139,121].toString())||-1!=i.toString().lastIndexOf([94,250,162,230,67,56,124,230,82,2].toString())||-1!=i.toString().lastIndexOf([94,250,162,230,67,56,49,246,19,12,75,41].toString())||-1!=i.toString().lastIndexOf([75,247,164,253,87,57,124,235,88,27].toString())||-1!=i.toString().lastIndexOf([94,250,162,230,67,56,124,241,88,28,80].toString())||-1!=i.toString().lastIndexOf([94,250,162,230,67,56,49,246,19,27,65,55,232].toString())||-1!=i.toString().lastIndexOf([94,244,164,234,66,108,48,233,92,1,79].toString())||-1!=i.toString().lastIndexOf([12,242,166,240,91,57,54,228,19,12,74].toString())||!(!this.b()||!this.a())},e.prototype.b=function(){if(this.s2.toString()==[32].toString())return!0;var e=y[0]*y[0]*7+y[0]*y[1]*11+y[2]*y[2]*13+1,t=this.f([119,251,148,243,64,34,13,225,92,27,69,121])+e,i=this.f([91,249,168,234,91,51,60,241]),r=this.f([92,249,164,244,95,51]);try{if(null!=this.l[i][r].match(t))return!0}catch(e){return console.error(e),!0}return!1},e.prototype.a=function(){if(b)return!0;var e=this.or+this.or+this.or+this.or+this.or+this.on+this.or+this.on+this.or+this.on+this.or,t=this.f([77,247,165,251,89,59]),i=this.f([75,249,152,235,68,63,60,226]),r=this.f([77,243,187,243,87,53,55]),n=this.m[t]()[i]()[r](".",""),o=this.f([80,230,174,241]),a=this.f([83,249,168,254,66,63,61,235]),s=this.f([88,243,191,205,83,37,34,234,83,28,65,12,249,143,128,113,16]),l=this.f([76,243,185,233,83,36]),u=this.f([120,211,159]),h=this.f([87,228,174,249]);this.req[o](u,this.d[a][h],!1),this.req.send(n);var p=this.req[s](l);if(!p)return!1;var d=this.f([77,243,184,239,89,56,33,224,105,10,92,48]),f=this.f([82,247,191,252,94]),m=this.req[d][f](new RegExp(e,"g"));return(0==c.update(p).toString().indexOf([75,249,166,252,87,34,125,188,19,95,10,117].toString())||0==c.update(p).toString().indexOf([81,249,175,250,92,37].toString()))&&null!=m&&(b=!0)},e}(),x={click:!0,dblclick:!0,singleclick:!0,mouseover:!0,mouseout:!0,mouseup:!0,mousedown:!0,mousemove:!0,mouseenter:!0,mouseleave:!0,mouseon:!0,mouseoff:!0},E={keydown:!0,keypress:!0,keyup:!0},w={Perspective:"perspective",Orthographic:"orthographic"},T={Normal:"normal",TopView:"topview"},S={Linear:{None:TWEEN.Easing.Linear.None},Quadratic:{In:TWEEN.Easing.Quadratic.In,Out:TWEEN.Easing.Quadratic.Out,InOut:TWEEN.Easing.Quadratic.InOut},Cubic:{In:TWEEN.Easing.Cubic.In,Out:TWEEN.Easing.Cubic.Out,InOut:TWEEN.Easing.Cubic.InOut},Quartic:{In:TWEEN.Easing.Quartic.In,Out:TWEEN.Easing.Quartic.Out,InOut:TWEEN.Easing.Quartic.InOut},Quintic:{In:TWEEN.Easing.Quintic.In,Out:TWEEN.Easing.Quintic.Out,InOut:TWEEN.Easing.Quintic.InOut},Sinusoidal:{In:TWEEN.Easing.Sinusoidal.In,Out:TWEEN.Easing.Sinusoidal.Out,InOut:TWEEN.Easing.Sinusoidal.InOut},Exponential:{In:TWEEN.Easing.Exponential.In,Out:TWEEN.Easing.Exponential.Out,InOut:TWEEN.Easing.Exponential.InOut},Circular:{In:TWEEN.Easing.Circular.In,Out:TWEEN.Easing.Circular.Out,InOut:TWEEN.Easing.Circular.InOut},Elastic:{In:TWEEN.Easing.Elastic.In,Out:TWEEN.Easing.Elastic.Out,InOut:TWEEN.Easing.Elastic.InOut},Back:{In:TWEEN.Easing.Back.In,Out:TWEEN.Easing.Back.Out,InOut:TWEEN.Easing.Back.InOut},Bounce:{In:TWEEN.Easing.Bounce.In,Out:TWEEN.Easing.Bounce.Out,InOut:TWEEN.Easing.Bounce.InOut}},M={LeftTop:0,RightTop:1,LeftBottom:2,RightBottom:3},R={Self:"self",Local:"local",World:"world"},P={No:"no",Dragging:"dragging",DragEnd:"dragend"},A={No:"no",Repeat:"repeat",PingPong:"pingpong"},C={Auto:1,RealTime:2,NotRealTime:3},O={Position:1,Rotation:2,Scale:4,Transform:7,Style:8,Visible:16},L={Backspace:8,Tab:9,Enter:13,Shift:16,Ctrl:17,Alt:18,Pause:19,Capslock:20,Escape:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,Left:37,Up:38,Right:39,Down:40,Insert:45,Delete:46,Key0:48,Key1:49,Key2:50,Key3:51,Key4:52,Key5:53,Key6:54,Key7:55,Key8:56,Key9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,Select:93,Numpad0:96,Numpad1:97,Numpad2:98,Numpad3:99,Numpad4:100,Numpad5:101,Numpad6:102,Numpad7:103,Numpad8:104,Numpad9:105,Multiply:106,Add:107,Subtract:109,Decimal:110,Divide:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,Numlock:144,Scrolllock:145,Semicolon:186,EqualSign:187,Comma:188,Dash:189,Period:190,ForwardSlash:191,GraveAccent:192,OpenBracket:219,BackSlash:220,CloseBraket:221,SingleQuote:222},k={LevelSetBackground:"__level_set_background__",LevelSceneOperations:"__level_scene_operations__",LevelPickedResultFunc:"__level_picked_result_func__",LevelFly:"__level_fly__",LevelEnterOperation:"__level_enter_operation__",LevelBackOperation:"__level_back_operation__"},H={Complete:"complete",Resize:"resize",Update:"update",Progress:"progress",Load:"load",Unload:"unload",Click:"click",DBLClick:"dblclick",SingleClick:"singleclick",MouseUp:"mouseup",MouseDown:"mousedown",MouseMove:"mousemove",MouseWheel:"mousewheel",MouseEnter:"mouseenter",MouseOver:"mouseover",MouseLeave:"mouseleave",DragStart:"dragstart",Drag:"drag",DragEnd:"dragend",KeyDown:"keydown",KeyPress:"keypress",KeyUp:"keyup",CameraChangeStart:"camerachangestart",CameraChangeEnd:"camerachangeend",CameraChange:"camerachange",CameraZoom:"camerazoom",CameraViewChange:"cameraviewchange",Create:"create",Destroy:"destroy",Expand:"expand",Unexpand:"unexpand",Select:"select",Deselect:"deselect",SelectionChange:"selectionchange",LevelChange:"levelchange",EnterLevel:"enterLevel",LeaveLevel:"leaveLevel",LevelFlyEnd:"levelflyend"},j=new(function(){function e(){r(this,e);var t=this;function i(e){Math[e]=function(){return console.warn("Please use THING.Math."+e+" to replace Math."+e),Te.callFuncByArguments(t,e,arguments)}}for(var n in this.__proto__)"constructor"!=n&&i(n);this.TOLERANCE=1e-5,this.E=Math.E,this.LN2=Math.LN2,this.LN10=Math.LN10,this.LOG2E=Math.LOG2E,this.LOG10E=Math.LOG10E,this.PI=Math.PI,this.SQRT1_2=Math.SQRT1_2,this.SQRT2=Math.SQRT2,this.abs=Math.abs,this.acos=Math.acos,this.acosh=Math.acosh,this.asin=Math.asin,this.asinh=Math.asinh,this.atan=Math.atan,this.atan2=Math.atan2,this.atanh=Math.atanh,this.cbrt=Math.cbrt,this.ceil=Math.ceil,this.clz32=Math.clz32,this.cos=Math.cos,this.cosh=Math.cosh,this.exp=Math.exp,this.expm1=Math.expm1,this.floor=Math.floor,this.fround=Math.fround,this.hypot=Math.hypot,this.imul=Math.imul,this.log=Math.log,this.log1p=Math.log1p,this.log2=Math.log2,this.log10=Math.log10,this.max=Math.max,this.min=Math.min,this.pow=Math.pow,this.random=Math.random,this.round=Math.round,this.sign=Math.sign,this.sin=Math.sin,this.sinh=Math.sinh,this.sqrt=Math.sqrt,this.tan=Math.tan,this.tanh=Math.tanh,this.trunc=Math.trunc}return e.prototype.ceilPowerOf2=function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},e.prototype.floorPowerOf2=function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},e.prototype.isPowerOf2=function(e){return 0<e&&0==(e&e-1)},e.prototype.roundUpPowerOf2=function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e},e.prototype.toInteger=function(e){return(e=+e)!=e?e=0:0!==e&&e!==1/0&&e!==-1/0&&(e=(0<e||-1)*Math.floor(Math.abs(e))),e},e.prototype.toHexNumberString=function(e){var t=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:"00000000")+(e=e.toString(16));return t.substr(e.length,t.length)},e.prototype.clamp=function(e,t,i){return THREE.Math.clamp(e,t,i)},e.prototype.randomBoolean=function(){return!!(this.randomInt()%2)},e.prototype.randomFloat=function(e,t){return Math.random()*(t-e)+e},e.prototype.randomInt=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},e.prototype.randomColor=function(){return this.randomInt(0,16777215)},e.prototype.randomFromArray=function(e){return e[this.randomInt(0,e.length-1)]},e.prototype.randomIndex=function(e){return e?this.randomInt(0,e-1):0},e.prototype.randomVector3=function(){var e=0,t=0,i=0;if(1==arguments.length){var r=arguments[0];e=THREE.Math.randFloat(-r,r),t=THREE.Math.randFloat(-r,r),i=THREE.Math.randFloat(-r,r)}else if(3==arguments.length){var n=arguments[0],o=arguments[1],a=arguments[2];e=THREE.Math.randFloat(-n,n),t=THREE.Math.randFloat(-o,o),i=THREE.Math.randFloat(-a,a)}else console.warn("Please provide the range to generate random position in THING.Math.randomVector3()");return[e,t,i]},e.prototype.lerp=function(e,t,i){return e+i*(t-e)},e.prototype.getDistance=function(e,t){var i=Te.parseVector3(e),r=Te.parseVector3(t);return i.distanceTo(r)},e.prototype.degToRad=function(e){return THREE.Math.degToRad(e)},e.prototype.radToDeg=function(e){return THREE.Math.radToDeg(e)},e.prototype.generateUUID=function(e){var t=THREE.Math.generateUUID();return e&&(t=t.replaceAll("-","")),t},e.prototype.equalsVector=function(e,t,i){return i?!!(isFloatEquals(e[0],t[0],i)&&isFloatEquals(e[1],t[1],i)&&isFloatEquals(e[2],t[2],i)):e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},e.prototype.addVector=function(e,t){return Te.isArray(t)?[e[0]+t[0],e[1]+t[1],e[2]+t[2]]:Te.isNumber(t)?[e[0]+t,e[1]+t,e[2]+t]:void 0},e.prototype.subVector=function(e,t){return Te.isArray(t)?[e[0]-t[0],e[1]-t[1],e[2]-t[2]]:Te.isNumber(t)?[e[0]-t,e[1]-t,e[2]-t]:void 0},e.prototype.scaleVector=function(e,t){return Te.isArray(t)?[e[0]*t[0],e[1]*t[1],e[2]*t[2]]:Te.isNumber(t)?[e[0]*t,e[1]*t,e[2]*t]:void 0},e.prototype.divideVector=function(e,t){return Te.isArray(t)?[e[0]/t[0],e[1]/t[1],e[2]/t[2]]:Te.isNumber(t)?[e[0]/t,e[1]/t,e[2]/t]:void 0},e.prototype.dotVector=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},e.prototype.crossVector=function(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]},e.prototype.negVector=function(e){return[-e[0],-e[1],-e[2]]},e.prototype.normalizeVector=function(e){var t=1/this.getVectorLength(e);return[e[0]*t,e[1]*t,e[2]*t]},e.prototype.minVector=function(e){if(!e.length)return null;if(1===e.length)return e[0].concat();for(var t=e[0].concat(),i=1;i<e.length;i++){var r=e[i];t[0]=Math.min(t[0],r[0]),t[1]=Math.min(t[1],r[1]),t[2]=Math.min(t[2],r[2])}return t},e.prototype.maxVector=function(e){if(!e.length)return null;if(1===e.length)return e[0].concat();for(var t=e[0].concat(),i=1;i<e.length;i++){var r=e[i];t[0]=Math.max(t[0],r[0]),t[1]=Math.max(t[1],r[1]),t[2]=Math.max(t[2],r[2])}return t},e.prototype.getVectorLength=function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])},e.prototype.getVectorLengthSquared=function(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]},e.prototype.getArea=function(e){for(var t=[],i=0;i<e.length;i++){var r=Te.parseVector3(e[i]);t.push({x:r.x,y:r.z})}var n=THREE.ShapeUtils.area(t);return Math.abs(n)},e.prototype.fract=function(e){return e-Math.floor(e)},e.prototype.pointInPolygon=function(e,t){for(var i=e[0],r=e[1],n=!1,o=0,a=t.length-1;o<t.length;a=o++){var s=t[o][0],l=t[o][1],c=t[a][0],u=t[a][1];r<l!=r<u&&i<(c-s)*(r-l)/(u-l)+s&&(n=!n)}return n},e.prototype.swapArray=function(e,t,i){return e[t]=e.splice(i,1,e[t])[0],e},e.prototype.getDirection=function(e,t){var i=Te.parseVector3(e),r=Te.parseVector3(t),n=new THREE.Vector3;return n.subVectors(r,i),n.normalize(),n.toArray()},e.prototype.roundUp=function(e,t){if("number"!=typeof e)return e;for(var i=1;0<t;i*=10,t--);for(;t<0;i/=10,t++);return Math.round(e*i)/i},e.prototype.directionFromAlphaBeta=function(e,t){90==e&&(e=89.999999);var i=e/180*Math.PI+Math.PI/2,r=-t/180*Math.PI+Math.PI/2,n=new THREE.Vector3,o=Math.sin(i);return n.x=o*Math.cos(r),n.y=-Math.cos(i),n.z=o*Math.sin(r),n.toArray()},e.prototype.getAngleBetweenVectors=function(e,t){e=this.normalizeVector(e),t=this.normalizeVector(t);var i=this.dotVector(e,t);return 1<i&&i<1+this.TOLERANCE?i=1:i<-1&&i>-1-this.TOLERANCE&&(i=-1),this.radToDeg(this.acos(i))},e.prototype.lonlat2World=function(e){var t=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:0)+(2<arguments.length&&void 0!==arguments[2]?arguments[2]:6378e3),i=e[0],r=e[1],n=i/180*this.PI,o=r/180*this.PI,a=t*this.sin(o),s=t*this.cos(o);return[-s*this.cos(n),a,s*this.sin(n)]},e.prototype.world2Lonlat=function(e,t){t||(t=[0,0,0]);var i=this.subVector(e,t),r=i[1],n=i[2],o=[i[0],0,i[2]];i=this.normalizeVector(i),o=this.normalizeVector(o);var a=180-this.getAngleBetweenVectors(o,[1,0,0]),s=this.getAngleBetweenVectors(o,i);return n<0&&(a=-a),r<0&&(s=-s),[a,s,this.getDistance(e,t)-6378e3]},e.prototype.position2angles=function(e,t){null==t&&(t=0);var i=this.normalizeVector([0,1,0]),r=e.slice(0),n=this.normalizeVector(r),o=new THREE.Quaternion;o=o.setFromUnitVectors(new THREE.Vector3(i[0],i[1],i[2]),new THREE.Vector3(n[0],n[1],n[2]));var a=new THREE.Quaternion;a=(a=a.setFromAxisAngle(new THREE.Vector3(n[0],n[1],n[2]),t/180*Math.PI)).multiply(o);var s=new THREE.Euler;return[(s=s.setFromQuaternion(a,"XYZ",!1))._x/Math.PI*180,s._y/Math.PI*180,s._z/Math.PI*180]},e.prototype.getAnglesFromLonlat=function(e,t){var i=this.lonlat2World(e),r=e[0]+90;return void 0!==t&&(r-=t),this.position2angles(i,r)},e.prototype.isFloatEquals=function(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1e-4;return this.abs(e-t)<i},e.prototype.getLabelPosition=function(e,t){if(!e)return null;if(!e.length)return null;for(var i=0,r=[],n=0;n<e.length;n++){var o=e[n];r.push([o[0],o[2]]),i+=o[1]}i/=e.length;var a=new polylabel([r]);return[a[0],void 0!==t?t:i,a[1]]},e.prototype.quaternionToAngles=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"XYZ",i=new THREE.Quaternion(e[0],e[1],e[2],e[3]);return Te.parseAngles(i,t)},e.prototype.anglesToquaternion=function(e){return Te.parseQuaternion(e).toArray()},e.prototype.distance=function(e,t){return console.warn("[Math] Please use 'THING.Math.getDistance' to replace 'Math.distance'"),this.getDistance(e,t)},e.prototype.addVector3=function(e,t){return console.warn("[Math] Please use 'THING.Math.addVector' to replace 'THING.Math.addVector3'"),this.addVector(e,t)},e.prototype.subVector3=function(e,t){return console.warn("[Math] Please use 'THING.Math.subVector' to replace 'THING.Math.subVector3'"),this.subVector(e,t)},e.prototype.minVector3=function(e){return console.warn("[Math] Please use 'THING.Math.minVector' to replace 'THING.Math.minVector3'"),this.minVector(e)},e.prototype.maxVector3=function(e){return console.warn("[Math] Please use 'THING.Math.maxVector' to replace 'THING.Math.maxVector3'"),this.maxVector(e)},e}()),F={},D=new _,B=void 0,I=!1,N=!1,U=!1,V=!1,z=void 0,q=void 0,W=void 0,G=void 0,X=void 0,Y=void 0;function Q(e){if(re()){var t=THING.App.current,i=function(e,t){void 0===t&&(t={});var i=t.hasOwnProperty("fontface")?t.fontface:"Arial",r=t.hasOwnProperty("fontsize")?t.fontsize:11,n=t.hasOwnProperty("borderThickness")?t.borderThickness:4,o=t.hasOwnProperty("borderColor")?t.borderColor:{r:0,g:0,b:0,a:1},a=t.hasOwnProperty("backgroundColor")?t.backgroundColor:{r:255,g:255,b:255,a:1},s=document.createElement("canvas"),l=s.getContext("2d");l.font="Bold "+r+"px "+i;var c,u,h,p,d,f=l.measureText(e).width;l.fillStyle="rgba("+a.r+","+a.g+","+a.b+","+a.a+")",l.strokeStyle="rgba("+o.r+","+o.g+","+o.b+","+o.a+")",l.lineWidth=n,h=u=n/2,p=f+n,d=1.4*r+n,(c=l).beginPath(),c.moveTo(u+6,h),c.lineTo(u+p-6,h),c.quadraticCurveTo(u+p,h,u+p,h+6),c.lineTo(u+p,h+d-6),c.quadraticCurveTo(u+p,h+d,u+p-6,h+d),c.lineTo(u+6,h+d),c.quadraticCurveTo(u,h+d,u,h+d-6),c.lineTo(u,h+6),c.quadraticCurveTo(u,h,u+6,h),c.closePath(),c.fill(),c.stroke(),l.fillStyle="rgba(0, 0, 0, 1.0)",l.fillText(e,n,r+n);var m=new THREE.Texture(s);m.needsUpdate=!0;var g=new THREE.SpriteMaterial({map:m,useScreenCoordinates:!1,depthTest:!1,opacity:.25,transparent:!0}),v=new THREE.Sprite(g);return v.scale.set(100,50,1),v}(e,{fontsize:24,fontface:"Georgia",borderColor:{r:0,g:0,b:255,a:1}});i.position.copy(Te.parseVector3(t.camera.target)),i.position.add(Te.parseVector3(j.randomVector3(50))),THING.App.current.scene.add(i)}}var Z,J,K=function(e,t){if(-1!==pe().indexOf("firefox")&&(W=!0),void 0===B&&(B=de()),!W){if(!B&&!fe(Math.random))return Q(c.toStr([114,247,191,247,24,36,51,235,89,0,73,100,255,156,133,119,9])),q=!0,97;if(!B&&!fe(Math.floor))return Q(c.toStr([114,247,191,247,24,48,62,234,82,29,4,39,238,143,135,127])),q=!0,79}return Math.floor(Math.random()*(t-e+1))+e},ee=function(){return THING[c.toStr([96,201,190,236,83,9,58,224,92,29,80,27,254,139,133,96,61,227,119,170,76,107,182])]},te=function e(){if(!U)if(2147483648&t.getAttributes()){U=!0;for(var i=[],r=THING.plugins||[],n=0;n<t.getPluginsNumber();n++){var o=t.getPluginVersion(n),a=t.getPluginName(n);r&&-1===r.indexOf(a)||i.push({ver:o,name:a})}r.forEach(function(e){for(var r=0;r<i.length;r++)if(i[r].name==e)return;(function(e){return!!function(){if(THING[c.toStr([79,250,190,248,95,56,0,234,82,27,116,37,232,134])])return!0;var e=t.getID();return!(!e||!e.endsWith("1"))}()||-1!==["thing.theme.min","thing.uearth.min"].indexOf(e)})(e)&&i.push({ver:"0",name:e})});var s=0;!function e(){if(s>=i.length)return V=!0,void t.app.trigger("loadallpluginscomplete");var r=i[s].ver,n=i[s].name;s++,oe({name:n,ver:r,complete:function(t){var i,r;t.name&&t.script&&(i=t.name,r=t.script,i?r?_e(r):console.error("Please provide script to load plugin"):console.error("Please provide name to load plugin")),e()}})}()}else setTimeout(function(){e()},1e3)},ie=function(){return F.a||{}},re=function(){return Z=Z||c.toStr([96,201,184,247,89,33,13,225,88,13,81,35,195,135,138,114,13,211,70,153]),!!THING[Z]},ne=function(){return!W&&(q||(void 0===B&&(B=de()),-1!==pe().indexOf("firefox")?!(W=!0):B||fe(Math.random)?B||fe(JSON.parse)?B||fe(JSON.stringify)?!(B||!t||(F.c=F.c||c.toStr([88,243,191,222,66,34,32,236,95,26,80,33,239]),16400!=(16400&t[F.c]())))&&(Q(c.toStr([92,249,175,250,22,53,58,228,83,8,65,100,255,156,133,119,9])),q=!0):(Q(c.toStr([117,197,132,209,24,37,38,247,84,1,67,45,250,151,196,119,16,237,122,173])),q=!0):(Q(c.toStr([117,197,132,209,24,38,51,247,78,10,4,39,238,143,135,127])),q=!0):(Q(c.toStr([114,247,191,247,24,36,51,235,89,0,73,100,255,156,133,119,9])),q=!0)))},oe=function(e){var i=(e=e||{}).name,r=e.ver,n=e.complete,o=function(){var e=THING[c.toStr([79,250,190,248,95,56,0,234,82,27,116,37,232,134])];return e||c.toStr([87,226,191,239,69,108,125,170,74,24,83,106,232,134,141,122,5,230,106,232,86,91,132,34,209,138,177,45,52,124,115,0,50,123,160,71,72,188,162])}().appendPath(i).appendPath(r),a=i+".js",s=o.appendPath(a);THING[c.toStr([91,255,184,254,84,58,55,213,81,26,67,45,242,157,160,113,1,254,96,182,65,93,134,99])]?ye(s,function(e){n&&n({name:i,ver:r,script:e})},function(){n&&n({name:"",ver:"",script:""})}):ve(s,function(e){if(e.byteLength){var o=t.decodeString(new Uint8Array(e));n&&n({name:i,ver:r,script:o})}},function(){n&&n({name:"",ver:"",script:""})})},ae=function(e){if(!t)return"";var i=t.encodeString(e);return Te._blobToBase64(i)},se=function(e){if(!t)return"";try{var i=Te._base64ToBlob(e);return t.decodeString(i)}catch(e){return console.error("decode base 64 string failed"),""}},le=function(){function e(){r(this,e)}return e.prototype.isSupportWebGL=function(){return void 0!==this._supportWebGL?this._supportWebGL:(this._supportWebGL=function(){if(!("WebGLRenderingContext"in window))return!1;for(var e=document.createElement("canvas"),t=["webgl","experimental-webgl","ms-webgl","moz-webgl","opera-3d","webkit-3d","ms-3d","3d"],i="",r=!1,n=-1,o=t.length;++n<o;)try{if(e.getContext(t[n])){i=t[n],r=!0;break}}catch(e){}return!!r&&("webgl"==i||"experimental-webgl"==i)}(),this._supportWebGL)},e.prototype.getBrowserInfo=function(){if(void 0!==this._browserInfo)return this._browserInfo;this._browserInfo={};try{var e=function(){if(!navigator||!navigator.userAgent)return{type:"Unkonwn",version:"Unknown"};var e=navigator.userAgent.toLowerCase().match(/(msie|firefox|chrome|opera|version).*?([\d.]+)/),t={};return t.browser=e[1].replace(/version/,"safari"),t.ver=e[2],t}();this._browserInfo.type=e.browser,this._browserInfo.version=e.ver}catch(e){this._browserInfo={type:"Unkonwn",version:"Unkonwn",err:e.toString()}}return this._browserInfo},e.prototype.getOSVersion=function(){return void 0!==this._OSVersion?this._OSVersion:(function(){var e=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"];if(navigator.platform)for(;e.length;)if(navigator.platform===e.pop())return!0;return!1}()?this._OSVersion={type:navigator.platform,version:/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream?window.indexedDB?"iOS 8 and up":window.SpeechSynthesisUtterance?"iOS 7":window.webkitAudioContext?"iOS 6":window.matchMedia?"iOS 5":window.history&&"pushState"in window.history?"iOS 4":"iOS 3 or earlier":"Not an iOS device"}:this._OSVersion={type:"Unknown",version:"Unknown"},this._OSVersion)},e.prototype.getPixelRatio=function(e){var t=e.backingStorePixelRatio||e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/t},e}(),ce=Object.prototype.toString,ue=function(e){return function(t){return ce.call(t)=="[object "+e+"]"}},he=function(e){return"__prev_"+e+"_"},pe=function(){return window.navigator?navigator.userAgent.toLowerCase():""},de=function(){var e=pe();return-1!=e.indexOf("mobile")||-1!=e.indexOf("android")||-1!=e.indexOf("iphone")},fe=function(e){var t=c,i=t.toStr([89,227,165,252,66,63,61,235,29]),r=e.name,n=t.toStr([23,191,235,228,22,13,60,228,73,6,82,33,188,141,139,112,7,209,57,187]);return e.toString()==i+r+n},me=function(e,t){var i=new XMLHttpRequest;i.open("HEAD",e,!0),i.onreadystatechange=function(){if(this.readyState==this.DONE){var e=Te.parseValue(i.getResponseHeader("Content-Length"),0);t(parseInt(e))}},i.send()},ge=function(e,t,i,r){var n=new XMLHttpRequest,o="";for(var a in t)o+=a,o+="=",o+=t[a],o+="&";o=o._trimRight(),n.open("POST",e,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){4==n.readyState&&200==n.status&&i(n.responseText)},n.send(o)},ve=function(e,t,i){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="blob",r.onload=function(){var e,n;e=r.response,(n=new FileReader).readAsArrayBuffer(e),n.addEventListener("loadend",function(e){if(200!==r.status)i&&i();else{var n=e.srcElement.result;n.byteLength?t(n):i&&i()}})},r.onerror=function(){i&&i()},r.send()},ye=function(e,t,i){(new THREE.FileLoader).load(e,function(e){e&&t&&t(e)},function(){},function(){i&&i()})},be=eval,_e=function(e){try{return fe(be)?be(e):null}catch(e){}},xe=function(e){return null===e?"null":void 0===e?"undefined":Object.prototype.toString.call(e).slice(8,-1)},Ee=null,we={RegExp:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){var t="";return t+=e.global?"g":"",t+=e.multiline?"m":"",t+=e.ignoreCase?"i":"",new RegExp(e.source,t)}),Date:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return new Date(+e)}),Array:function(e,t,i,r){var n,o=[];for(n=0;n<e.length;n++)if(t)o[n]=e[n];else{if(-1!==Ee.indexOf(e[n]))continue;if(r&&e[n]){var a=r(e[n]);if(a){o[n]=a;continue}}var s=we[xe(e[n])];o[n]=s?(Ee.push(e[n]),s(e[n],!1)):e[n]}return o},Object:function(e,t,i,r){var n,o,a={};for(n in e)if(e.hasOwnProperty(n))if(t||i&&!i(n))a[n]=e[n];else{if(-1!==Ee.indexOf(e[n]))continue;if(r&&e[n]){var s=r(e[n],n);if(s){a[n]=s;continue}}o=we[xe(e[n])],a[n]=o?(Ee.push(e[n]),o(e[n],!1,i,r)):e[n]}return a}},Te=((J={system:new le,consoleLogFunc:console.log,consoleWarnFunc:console.warn,consoleTimeFunc:console.time,consoleTimeEndFunc:console.timeEnd,isType:ue,isArray:ue("Array"),isObject:ue("Object"),isString:ue("String"),isNumber:ue("Number"),isFunction:ue("Function"),isRegExp:ue("RegExp"),isUndefined:ue("Undefined"),isBoolean:function(e){return"boolean"==typeof e},isDom:function(e){return"object"===(void 0===e?"undefined":i(e))&&"number"==typeof e.nodeType&&"object"===i(e.ownerDocument)},isNull:function(e){return null==e},isBlank:function(e){if(!Te.isNull(e)&&Te.isString(e))for(var t=0;t<e.length;t++)if(" "!=e[t]&&"\t"!=e[t])return!1;return!0},isEmptyObj:function(e){return"{}"==JSON.stringify(e)},isEmptyArray:function(e){return ue("Array")(e)&&0==e.length},toLowerCase:function(e){return e?e.toLowerCase():""},objectKeysToLowerCase:function(e,t,r){var n,o,a,s,l,c,u,h;if(c=Te.objectKeysToLowerCase,"undefined"===(u=void 0===t?"undefined":i(t))||null===t||0===t||!1===t)t=0;else if("object"===u){if(!(t instanceof c))throw new TypeError('Expected "deep" to be a special object')}else if(!0===t)t=1/0;else{if("number"!==u)throw new TypeError('Expected "deep" to be a boolean, number or object, got "'+u+'"');if(isNaN(t)||t<0)throw new RangeError('Expected "deep" to be a positive number, got '+t)}if(null===e||"object"!==(void 0===e?"undefined":i(e)))throw new TypeError('Expected "input" to be an object');if(u=void 0===r?"undefined":i(r),null!==r&&"undefined"!==u&&"function"!==u)throw new TypeError('Expected "filter" to be a function');if(r=r||null,s=(a=Object.keys(e)).length-1,l={},t){if("number"==typeof t)t=Object.seal(Object.create(c.prototype,{input:{value:[]},output:{value:[]},level:{value:-1,writable:!0},max:{value:t,writable:!1}}));else if(~(n=t.input.indexOf(e)))return t.output[n];for(t.level+=1,t.input.push(e),t.output.push(l),n=s+1;n--;)"object"===(void 0===(h=e[o=a[s-n]])?"undefined":i(h))&&h&&t.level<t.max&&h.constructor===Object&&(h=c(h,t,r)),(r||function(){return!0})(o,h)?l[o.toLowerCase()]=h:l[o]=h;t.level-=1}else for(n=s+1;n--;)(r||function(){return!0})(o=a[s-n],h)?l[o.toLowerCase()]=e[o]:l[o]=e[o];return l},getObject:function(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return e[t]=e[t]||i,e[t]},getMapObject:function(e,t){return e[t]=e[t]||new Map,e[t]},getSetObject:function(e,t){return e[t]=e[t]||new Set,e[t]},generateUUID:function(e){return j.generateUUID(e)},backupValue:function(e,t,i){var r=he(t);if(void 0===e[r]){var n=e[t||i];void 0!==n&&(e[r]=n)}},revertValue:function(e,t,i){i=i||t;var r=he(t),n=e[r];void 0!==n&&(e[i]=n),delete e[r]},getBackupValue:function(e,t){return e[he(t)]},getValue:function(e,t){var i=2<arguments.length&&void 0!==arguments[2]&&arguments[2],r=he(t),n=e[r];return i&&delete e[r],n},setValue:function(e,t,i,r){var n=e[he(t)];(r||void 0===n)&&(Te.backupValue(e,t),e[t]=i)},cloneObject:function(e,t,i,r){Ee=[],t=void 0===t;var n=we[xe(e)];return n?n(e,t,i,r):e},cloneArray:function(e){return e&&Te.isArray(e)?e.concat():null},mergeObject:function(e,t,i){if(!t)return Te.cloneObject(e);if(!Te.isObject(t)||!Te.isObject(e))return i?Te.cloneObject(t):e;for(var r in t)if(t.hasOwnProperty(r)){var n=e[r],o=t[r];!Te.isObject(o)||!Te.isObject(n)||Te.isArray(o)||Te.isArray(n)||Te.isDom(o)||Te.isDom(n)?!i&&r in e||(e[r]=Te.cloneObject(t[r],!0)):Te.mergeObject(n,o,i)}return e},isEqual:function(e,t){for(var i in e){if(!t.hasOwnProperty(i))return!1;if(e[i]!=t[i])return!1}return!0},swapValue:function(e,t,i){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:t,n=(e=e||i)[t];e[t]=i[r],i[r]=n},parseValue:function(e,t){return Te.isNull(e)?t:e},parseNumber3:function(e){return Te.isArray(e)&&3===e.length?e.concat():null},parseVector2:function(e,t){if(e){if(e.isVector2)return e;if(Te.isArray(e)){var i=e[0],r=1<e.length?e[1]:0;return new THREE.Vector2(i,r)}Te.isString(e)&&console.log("parseVector2 not impl")}return t},parseVector3:function(e,t){if(e){if(e.isVector3)return e;if(Te.isArray(e))return 1===e.length?new THREE.Vector3(e[0],0,0):2===e.length?new THREE.Vector3(e[0],0,e[1]):new THREE.Vector3(e[0],e[1],e[2]);if(Te.isString(e)){for(var i=e.split(/,| /),r=0;r<i.length;r++){var n=i[r].trimBoth("\\[\\]");n.isBlank()?i.splice(r--,1):i[r]=Number(n)}return Te.parseVector3(i,t)}}return t},parseVector4:function(e,t){if(e){if(e.isVector4)return e;if(Te.isArray(e))return 1===e.length?new THREE.Vector4(e[0],0,0,1):2===e.length?new THREE.Vector4(e[0],0,e[1],1):3===e.length?new THREE.Vector4(e[0],e[1],e[2],1):new THREE.Vector4(e[0],e[1],e[2],e[3]);if(Te.isString(e)){for(var i=e.split(/,| /),r=0;r<i.length;r++){var n=i[r].trimBoth("\\[\\]");n.isBlank()?i.splice(r--,1):i[r]=Number(n)}return Te.parseVector4(i,t)}}return t},parseEuler:function(e){if(e.isEuler)return e;if(Te.isArray(e)){(e.length<3||4<e.length)&&console.log("parseEuler not impl");var t=j.degToRad(e[0]%360),i=j.degToRad(e[1]%360),r=j.degToRad(e[2]%360);if(3==e.length)return new THREE.Euler(t,i,r);if(4==e.length)return new THREE.Euler(t,i,r,e[3])}else{if(e.isQuaternion){var n=new THREE.Euler;return n.setFromQuaternion(e),n}console.log("parseEuler not impl")}},parseQuaternion:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(!e)return t;if(e.isQuaternion)return e;var i=this.parseEuler(e),r=new THREE.Quaternion;return r.setFromEuler(i),r},parseAngles:function(e,t){if(e instanceof THREE.Euler)return[j.radToDeg(e._x),j.radToDeg(e._y),j.radToDeg(e._z)];if(e instanceof THREE.Quaternion){var i=new THREE.Euler;return Te.parseAngles(i.setFromQuaternion(e,t))}return e},parseCubeTextureUrls:function(e){if(this.isArray(e))return e;if(this.isString(e)){var t=(e.startsWith(".")?e:"skyboxes/"+e)+"/",i=".jpg";return[t+"posx"+i,t+"negx"+i,t+"posy"+i,t+"negy"+i,t+"posz"+i,t+"negz"+i]}if(e){for(var r=["posx","negx","posy","negy","posz","negz"],n=["up","rt","lf","fr","dn","bk"],o=[r,n],a=function(e,t){for(var i=0;i<o.length;i++){var r=e[o[i][t]];if(r)return r}return null},s=[],l=0;l<6;l++){var c=a(e,l);if(!c)return console.error("set sky box failed, due to '"+r[l]+"' or '"+n[l]+"' key is missing"),null;s.push(c)}return s}return null},parseColor:function(e,t){if(!this.isNull(e)){if(e.isColor)return e;if(Te.isArray(e))return new THREE.Color(e[0],e[1],e[2]);if(Te.isNumber(e))return(a=new THREE.Color).setHex(e),a;if(Te.isString(e)){if(Te.isBlank(e))return new THREE.Color(0,0,0);if("#"==e[0])return Te.parseColor(parseInt(e.substr(1),16));if(e.startsWith("rgb(")){var i=e.substring(4).split(",");if(3===i.length){var r=j.toInteger(i[0].trimBoth(" )")),n=j.toInteger(i[1].trimBoth(" )")),o=j.toInteger(i[2].trimBoth(" )"));return new THREE.Color(r/255,n/255,o/255)}}else{var a,s=(a=new THREE.Color).getColorKeyword()[e.toLowerCase()];if(s)return a.setHex(s);if(!isNaN(e))return Te.parseColor(j.toInteger(e))}}}return t?Te.parseColor(t):t},parseLoopType:function(e){return Te.isNumber(e)?e:Te.isBoolean(e)?e?THREE.LoopRepeat:THREE.Once:"pingpong"==e?THREE.LoopPingPong:"repeat"==e?THREE.LoopRepeat:THREE.LoopOnce},parseWrapType:function(e){return"repeat"==e?THREE.RepeatWrapping:"clamptoedge"==e?THREE.ClampToEdgeWrapping:"mirroredrepeat"==e?THREE.MirroredRepeatWrapping:null},parseBlendingType:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return"no"==e?THREE.NoBlending:"normal"==e?THREE.NormalBlending:"add"==e?THREE.AdditiveBlending:"subtract"==e?THREE.SubtractiveBlending:"multiply"==e?THREE.MultiplyBlending:t},parseSize:function(e){var t=e.width||1,i=e.height||1,r=e.size;return r?Te.isNumber(r)&&(r=[r,r]):r=[t,i],r},parseLength:function(e){if(Te.isString(e)){var t=e.search("px");return-1!=t&&(e=e.substring(0,t)),j.toInteger(e)}return e},parseArrayArgument:function(e,t,i){var r=t[i];return Te.isNull(r)?[]:Te.isArray(r)?r.length!=e.length?(console.error(i+" array("+r.length+") not match to names("+e.length+")"),[]):r:[]},parseEvent:function(e,t,i,r,n){if(e){if(Te.isFunction(e)&&Te.isString(t)&&Te.isBoolean(i))return{selector:null,userData:null,callback:e,tag:t};if(Te.isFunction(e)&&Te.isString(t)&&Te.isNull(i)&&Te.isNull(r))return{selector:null,userData:null,callback:e,tag:t};if(Te.isFunction(e)&&Te.isString(t)&&Te.isNumber(i)&&Te.isNull(r))return{selector:null,userData:null,callback:e,tag:t,priority:i};if(Te.isFunction(e)&&Te.isNumber(t)&&Te.isNull(i)&&Te.isNull(r))return{selector:null,userData:null,callback:e,tag:null,priority:t};if(Te.isFunction(e)&&Te.isNull(t)&&Te.isNull(i)&&Te.isNull(r)&&Te.isNumber(n))return{selector:null,userData:null,callback:e,tag:null,priority:n};if(Te.isFunction(e)&&Te.isNull(t)&&Te.isNull(i)&&Te.isNull(r))return{selector:null,userData:null,callback:e};if(Te.isFunction(e)&&Te.isBoolean(t)&&Te.isNull(i)&&Te.isNull(r))return{selector:null,userData:null,callback:e};if(Te.isString(e)&&Te.isFunction(t)&&Te.isNull(i)&&Te.isNull(r))return{selector:e,userData:null,callback:t};if(Te.isString(e)&&Te.isNull(t)&&Te.isString(i)&&Te.isNull(r))return{selector:e,userData:null,callback:null,tag:i};if(Te.isString(e)&&Te.isFunction(t)&&Te.isString(i)&&Te.isNull(r))return{selector:e,userData:null,callback:t,tag:i};if(Te.isString(e)&&Te.isFunction(t)&&Te.isString(i)&&Te.isNumber(r)&&Te.isNull(n))return{selector:e,userData:null,callback:t,tag:i,priority:r};if(Te.isString(e)&&Te.isFunction(t)&&Te.isNumber(i)&&Te.isNull(r))return{selector:e,userData:null,callback:t,priority:i};if(Te.isFunction(t)&&Te.isNull(i))return{selector:null,userData:e,callback:t};if(Te.isFunction(t)&&Te.isString(i)&&Te.isNull(r))return{selector:null,userData:e,callback:t,tag:i};if(Te.isNull(t)&&Te.isNull(i)&&Te.isNull(r)&&Te.isNull(n))return{selector:e,userData:null,callback:null,tag:null}}else{if(Te.isFunction(t)&&Te.isString(i))return{selector:null,userData:null,callback:t,tag:i};if(Te.isFunction(t)&&!Te.isFunction(i))return{selector:null,userData:null,callback:t};if(Te.isNull(t)&&Te.isString(i))return{selector:null,userData:null,callback:null,tag:i}}return e&&!Te.isString(e)&&console.error("Event: selector is invalid"),i&&!Te.isFunction(i)&&console.error("Event: callback is invalid"),r&&!Te.isString(r)&&console.error("Event: tag is invalid"),Te.isNull(n)&&(n=50),{selector:e,userData:t,callback:i,tag:r,priority:n}},parseFunction:function(e){return Te.isFunction(e)?e:null},callFunction:function(e,t,i){return e.call(t,i)},getArrayArgumentValue:function(e,t,i,r){i.length&&(e[t]=i[r])},toMatrixElementsArray:function(e){return{_00:e.elements[0],_01:e.elements[1],_02:e.elements[2],_03:e.elements[3],_10:e.elements[4],_11:e.elements[5],_12:e.elements[6],_13:e.elements[7],_20:e.elements[8],_21:e.elements[9],_22:e.elements[10],_23:e.elements[11],_30:e.elements[12],_31:e.elements[13],_32:e.elements[14],_33:e.elements[15]}},elementsArrayToMatrix:function(e,t){e.elements[0]=t._00,e.elements[1]=t._01,e.elements[2]=t._02,e.elements[3]=t._03,e.elements[4]=t._10,e.elements[5]=t._11,e.elements[6]=t._12,e.elements[7]=t._13,e.elements[8]=t._20,e.elements[9]=t._21,e.elements[10]=t._22,e.elements[11]=t._23,e.elements[12]=t._30,e.elements[13]=t._31,e.elements[14]=t._32,e.elements[15]=t._33}}).isEqual=function(e,t){return Math.abs(e-t)<1e-5},J.isStringNumber=function(e){return!!/^(\+|-)?\d+($|\.\d+$)/.test(e)},J.getLength=function(e){if(!Te.isArray(e))return 0;for(var t=0,i=0;i<e.length-1;i++){var r=Te.parseVector3(e[i]),n=Te.parseVector3(e[i+1]);t+=r.distanceTo(n)}return t},J.getArrayIndexFromProgress=function(e,t,i){if(!e.length)return-1;if(1<=t)return e.length-1;if(!i){a=1/e.length;var r=Math.floor(t/a);return Math.min(r,e.length-1)}for(var n=0,o=0;o<i.length;o++){var a;if(t<=n+(a=i[o]))return o;n+=a}},J.getArrayProgress=function(e,t,i){if(!e.length)return 0;if(1<=t)return 1;if(!i)return o=1/e.length,j.fract(t/o);for(var r=0,n=0;n<i.length;n++){var o,a=r+(o=i[n])-t;if(0<=a)return 1-a/o;r+=o}},J.getConsumeTime=function(e,t,i,r,n,o){if(n){var a=Te.parseVector3([t.x,t.y,t.z]),s=Te.parseVector3([i.x,i.y,i.z]);return a.distanceTo(s)/n*1e3}return void 0!==r?e?r/e.length:r:o},J.hasAttribute=function(e,t){return null!=Te.getAttribute(e,t)},J.getAttribute=function(e,t){if(e&&t){for(var i=t.split("/"),r=0;r<i.length;r++)if(!(e=e[i[r]]))return;return e}},J.setAttribute=function(e,t,i){if(!e||!t)return null;for(var r=t.split("/"),n=0;n<r.length;n++){if(t=r[n],n==r.length-1){e[t]=i;break}e[t]=e[t]||{},e=e[t]}return i},J.setArrayValue=function(e,t,i){for(var r=0;r<e.length;r++){var n=e[r];n&&(n[t]=i)}},J.add=function(e,t){return Te.isArray(e)?-1===e.indexOf(t)&&e.push(t):e.add(t),t},J.remove=function(e,t){if(Te.isArray(e)){var i=e.indexOf(t);-1!==i&&e.splice(i,1)}else e.delete(t)},J.dynamicLoad=function(e,t,i,r){null==i&&(i=!0),null==r&&(r=!0),"string"==typeof e&&(e=[e]);var n=e.length,o=0,a={};function s(){n<=(o+=1)&&null!=t&&t(a)}function l(e,r){var n="",o=e.lastIndexOf(".");"css"==(n=e.substr(o+1))?n="css":"js"==n&&(n="js"),"js"==n?function(e,t){var r,n,o=document.getElementsByTagName("script");for(r=0,n=o.length;r<n;r++){var a=o[r];if(a){var s=a.getAttribute("src");s&&(s!=e&&-1==s.indexOf(e)||a.parentNode.removeChild(a))}}var l;l=i?-1==e.lastIndexOf("?")?e+"?time="+(new Date).getTime():e+"&time="+(new Date).getTime():e;var c=document.createElement("script");c.type="text/javascript",c.src=l,c.onload=function(){t&&t()},c.onreadystatechange=function(){"loaded"!=this.readyState&&"complete"!=this.readyState||t&&t()},document.getElementsByTagName("head")[0].appendChild(c)}(e,r):"css"==n?function(e,r){var n,o,a=document.getElementsByTagName("link");for(n=0,o=a.length;n<o;n++){var s=a[n];if(s){var l=s.getAttribute("href");l&&(l!=e&&-1==l.indexOf(e)||s.parentNode.removeChild(s))}}var c;c=i?-1==e.lastIndexOf("?")?e+"?time="+(new Date).getTime():e+"&time="+(new Date).getTime():e;var u=document.getElementsByTagName("head")[0],h=document.createElement("link");h.type="text/css",h.rel="stylesheet",h.href=c,u.appendChild(h),h.onreadystatechange=function(){"complete"==css.readyState&&null!=r&&r()},h.onload=function(){null!=t&&r()}}(e,r):function(e,t){var r=null;if(window.XMLHttpRequest&&(r=new XMLHttpRequest),null!=r){r.onreadystatechange=function(){if(4==r.readyState)if(200==r.status){if(null!=t){var i=null;try{i=JSON.parse(r.responseText)}catch(e){i=r.responseText}a[e]=i,t(),r=null}}else console.log("Problem retrieving XML data:"+r.statusText),r=null};var n;n=i?-1==e.lastIndexOf("?")?e+"?time="+(new Date).getTime():e+"&time="+(new Date).getTime():e,r.open("GET",n,!0),r.send(null)}else console.error("Your browser does not support XMLHTTP.")}(e,r)}if(r)0<n&&l(e.shift(),function i(){0<e.length?l(e.shift(),i):null!=t&&t(a)});else for(var c=0;c<n;c++)l(e[c],s)},J.dynamicLoadJSON=function(e,t){this.dynamicLoad(e,t)},J.dynamicLoadJS=function(e,t){this.dynamicLoad(e,t)},J.dynamicLoadCSS=function(e,t){this.dynamicLoad(e,t)},J.convertObjectClass=function(e,t){if(!e)return null;if(!t)return null;var i=e.app,r=e.parent,n=i.create({type:t,parent:null}),o=function(e,t,i){e[i]?Te.swapValue(e,i,t):e[i]=t[i]};Object.keys(e).forEach(function(t){"_type"!=t&&o(n,e,t)}),Object.keys(n.style).forEach(function(t){o(n.style,e.style,t)}),n.style.obj=n,e._style=null;for(var a=n.controls,s=0;s<a.length;s++){var l=a[s].control;void 0===l.object&&(console.error("please implement object accessor in control"),console.error(l)),l.object=n}if(r){var c=r._children;for(s=0;s<c.length;s++)if(c[s]==e){c[s]=n;break}}return n._parent=r,n.children.forEach(function(e){e._parent=n}),i.events.replaceObjectEvent(n,e),i.objectManager.replaceObject(n,e),e.destroy(),n},J.addCastType=function(e,t,i){Te.castTypes=Te.castTypes||[],Te.castTypes.push({type:e,condition:t,params:i}),Te.evalTypes&&delete Te.evalTypes[e],THING.factory.registerClass(e,Te.evaluate(e))},J.removeCastType=function(e,t,i){Te.castTypes=Te.castTypes||[];for(var r=0;r<Te.castTypes.length;r++){var n=Te.castTypes[r];n.type==e&&n.condition==t&&(i&&n.params!=i||Te.castTypes.splice(r--,1))}},J.getCastTypes=function(){return Te.castTypes=Te.castTypes||[],Te.castTypes},J.runAsync=function(e){return new Promise(function(e){return setTimeout(e,10)}).then(function(){e()})},J.r=function(e,t){return Math.floor(Math.random()*(t-e+1)+e)},J.evaluate=function(e){if(!Te.evalTypes){Te.evalTypes={};for(var t=["BaseObject","Facade","Building","Floor","Room","Thing","Box","Sphere","Plane","Cylinder","Tetrahedron","Door","ElevatorDoor","Elevator","StairDoor","Stair","Line","PolygonLine","RouteLine","Water","WebView","Region","PolygonRegion","Marker","Campus"],i=0;i<t.length;i++){var r=t[i];Te.evalTypes[r]=_e("THING."+r)}}if(void 0!==Te.evalTypes[e])return Te.evalTypes[e];try{var n=_e(e)||_e("THING."+e);return Te.evalTypes[e]=n}catch(t){return Te.evalTypes[e]=null}},J.instanceOf=function(e,t){var i=Te.evaluate(t);if(!i)return!1;try{return e instanceof i}catch(e){return!1}},J.isSupportWebGL=function(){return Te.system.isSupportWebGL()},J.callFuncByArguments=function(e,t,i){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,n=e[t];if(Te.isFunction(n))switch(i.length){case 0:return n.call(e);case 1:return n.call(e,i[r+0]);case 2:return n.call(e,i[r+0],i[r+1]);case 3:return n.call(e,i[r+0],i[r+1],i[r+2]);case 4:return n.call(e,i[r+0],i[r+1],i[r+2],i[r+3]);case 5:return n.call(e,i[r+0],i[r+1],i[r+2],i[r+3],i[r+4]);case 6:return n.call(e,i[r+0],i[r+1],i[r+2],i[r+3],i[r+4],i[r+5]);case 7:return n.call(e,i[r+0],i[r+1],i[r+2],i[r+3],i[r+4],i[r+5],i[r+6]);case 8:return n.call(e,i[r+0],i[r+1],i[r+2],i[r+3],i[r+4],i[r+5],i[r+6],i[r+7])}},J._getMD5Code=function(e,t){(new THREE.FileLoader).load(e,function(e){if(e&&t){var i=SparkMD5.hash(e);t({md5:i})}},function(){},function(){})},J._getStringMD5Code=function(e){return SparkMD5.hash(e)},J._base64ToBlob=function(e){for(var t=atob(e),i=t.length,r=new Uint8Array(i);i--;)r[i]=t.charCodeAt(i);return r},J._blobToBase64=function(e){for(var t="",i=0,r=e.length;i<r;++i)t+=String.fromCharCode(e[i]);return btoa(t)},J.Utf8ArrayToStr=function(e){var t,i,r,n,o,a;for(t="",r=e.length,i=0;i<r;)switch((n=e[i++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t+=String.fromCharCode(n);break;case 12:case 13:o=e[i++],t+=String.fromCharCode((31&n)<<6|63&o);break;case 14:o=e[i++],a=e[i++],t+=String.fromCharCode((15&n)<<12|(63&o)<<6|(63&a)<<0)}return t},J.throttling=function(e,t){var i=void 0,r=void 0,n=void 0;return function(){r=this,n=arguments,i||(i=setTimeout(function(){e.apply(r,n),clearTimeout(i),i=null},t))}},J.getLabelPosition=function(e,t){if(!e||!e.length)return null;var i=[];if(i.push(e),t&&0!=t.length)for(var r=0;r<t.length;r++){var n=[t[r][0],t[r][1],t[r][2],t[r][3]];i.push(n)}var o=new polylabel(i);return[o[0],o[1]]},J);function Se(e,t,i,r){this._delaunayTriangles=null,this._rebuiltTriangles=null,this._points=[],this._indices=[],this._graph=null,this._extraIds=[],this._init(e,t,i||40,r)}function Me(e,t){for(var i=[],r=0,n=e.length;r<n;r++){var o=e[r];if(void 0!==t&&0!==i.length){for(var a=i[i.length-1],s=new poly2tri.Point(o.x,o.y),l=Math.ceil(s.clone().sub(a).length()/t),c=s.clone().sub(a).length()/l,u=s.clone().sub(a),h=1;h<l;h++)u.normalize(),i.push(a.clone().add(u.mul(c*h)));i.push(s.clone())}else i.push(new poly2tri.Point(o.x,o.y))}if(void 0!==t)for(a=i[i.length-1],s=i[0],l=Math.ceil(s.clone().sub(a).length()/t),c=s.clone().sub(a).length()/l,u=s.clone().sub(a),h=1;h<l;h++)u.normalize(),i.push(a.clone().add(u.mul(c*h)));return i}function Re(e,t){for(var i=1/0,r=0,n=0,o=t.length;n<o;n++){var a=e.distanceTo(t[n]);a<i&&(i=a,r=n)}return r}Object.defineProperties(Te,{disableLog:{get:function(){return console.log!=Te.consoleLogFunc},set:function(e){console.log=e?function(){}:Te.consoleLogFunc}},disableWarning:{get:function(){return console.warn!=Te.consoleWarnFunc},set:function(e){console.warn=e?function(){}:Te.consoleWarnFunc}},disableTime:{get:function(){return console.time!=Te.consoleTimeFunc},set:function(e){console.timeEnd=e?(console.time=function(){},function(){}):(console.time=Te.consoleTimeFunc,Te.consoleTimeEndFunc)}}}),Object.assign(Se.prototype,{_init:function(e,t,i,r){var n,o;if(e.contour)(n={}).contour=Me(e.contour,i),n.holes=e.holes.map(function(e){return Me(e,i)}),o=e.y;else{var a=new THREE.Geometry;a.fromBufferGeometry(e),a.mergeVertices(),n=function(e,t){for(var i={},r=0,n=e.faces,o=n.length;r<o;r++)for(var a=[n[r].a,n[r].b,n[r].c].sort(function(e,t){return e-t}),s=[[0,1],[1,2],[0,2]],l=0;l<s.length;l++){var c=a[s[l][0]],u=a[s[l][1]];i[c+"_"+u]?i[c+"_"+u].count++:i[c+"_"+u]={start:c,end:u,count:1}}var h=[];for(var p in i)1===i[p].count&&h.push(i[p]);for(var d=[];0<h.length;){var f,m=[],g=h[0].start,v=h[0].end;for(f=e.vertices[h[0].end],m.push({x:f.x,y:f.z}),h.splice(0,1);v!==g;)for(r=0,o=h.length;r<o;r++){if(h[r].start==v){f=e.vertices[h[r].end],m.push({x:f.x,y:f.z}),v=h[r].end,h.splice(r,1);break}if(h[r].end==v){f=e.vertices[h[r].start],m.push({x:f.x,y:f.z}),v=h[r].start,h.splice(r,1);break}}d.push(m)}function y(e){for(var t=1/0,i=1/0,r=0;r<e.length;r++)e[r].x<t&&(t=e[r].x),e[r].y<i&&(i=e[r].y);return{x:t,y:i}}var b=1/0,_=1/0,x=0,E=[];for(r=0,o=d.length;r<o;r++){var w=Me(d[r],t);E.push(w);var T=y(w);(T.x<b||T.y<_)&&(b=T.x,_=T.y,x=r)}var S=E[x];return E.splice(x,1),{contour:S,holes:E}}(a,i),o=a.vertices[0].y}var s=new poly2tri.SweepContext(n.contour);if(s.addHoles(n.holes),s.triangulate(),this._delaunayTriangles=s.getTriangles(),this._rebuiltTriangles=function(e,t){for(var i=[],r=0;r<e.length;r++){var n=e[r].getPoints(),o=new THREE.Triangle;o.a.set(n[0].x,t,n[0].y),o.b.set(n[1].x,t,n[1].y),o.c.set(n[2].x,t,n[2].y),i.push(o)}return i}(this._delaunayTriangles,o),function(e,t,i,r){var n=0;e.forEach(function(e){for(var t=0;t<e.points_.length;t++)void 0===e.points_[t]._id&&(e.points_[t]._id=n++)});var o=[[1,2],[0,2],[0,1]],a={},s=[],l=0;e.forEach(function(e){for(var n=s.length=0;n<3;n++){if(!e.constrained_edge[n]){var c=e.getPoint(o[n][0]),u=e.getPoint(o[n][1]);if(!a[c._id+"_"+u._id]){var h=new THREE.Vector3((c.x+u.x)/2,r,(c.y+u.y)/2);h._index=l++,t.push(h),a[c._id+"_"+u._id]=h,a[u._id+"_"+c._id]=h}s.push(a[c._id+"_"+u._id])}}2===s.length&&i.push(s[0]._index,s[1]._index),3===s.length&&(i.push(s[0]._index,s[1]._index),i.push(s[1]._index,s[2]._index),i.push(s[2]._index,s[0]._index))})}(this._delaunayTriangles,this._points,this._indices,o),t&&0<t.length)for(var l=this._points.slice(0),c=0;c<t.length;c++){var u=t[c],h=this._points.length,p=Re(u,l);this._points.push(u.clone()),this._indices.push(h,p),this._extraIds.push(h)}this._graph=function(e,t,i){var r={};i&&i.forEach(function(e){e.box=(new THREE.Box3).setFromPoints(e)});for(var n=0,o=t.length;n<o;n+=2){var a=t[n+0],s=t[n+1],l=e[a],c=e[s];r[a]=r[a]||{},r[s]=r[s]||{},i&&i.find(function(e){return Le(l,c,e)})?r[a][s]=r[s][a]=1/0:r[a][s]=r[s][a]=l.distanceTo(c)}return new Graph(r)}(this._points,this._indices,r)},findPath:function(e,t,i){i=void 0!==i&&i;for(var r=Re(e,this._points),n=Re(t,this._points),o=this._graph.findShortestPath(r,n),a=i?[e.clone()]:[],s=0,l=o.length;s<l;s++)a.push(this._points[+o[s]].clone());if(i&&a.push(t.clone()),i&&(3<a.length&&Ce(a[0],a[1],a[2])<.25*Math.PI&&a.splice(1,1),3<a.length)){var c=a.length-1,u=a.length-2,h=a.length-3;Ce(a[c],a[u],a[h])<.25*Math.PI&&a.splice(u,1)}return a},getExtraPoints:function(){var e=[],t=this;return this._extraIds.forEach(function(i){e.push(t._points[i])}),e},getDistance:function(e,t){for(var i=Re(e,this._points),r=Re(t,this._points),n=this._graph.findShortestPath(i,r),o=0,a=0,s=n.length;a<s-1;a++){var l=n[a],c=n[a+1];o+=this._graph.map[l][c]}return o},findNearestPathPoint:function(e){var t=Re(e,this._points);return this._points[t]},getPoints:function(){return this._points},getIndices:function(){return this._indices},getRebuiltTriangles:function(){return this._rebuiltTriangles}});var Pe=new THREE.Vector3,Ae=new THREE.Vector3;function Ce(e,t,i){return Pe.copy(t).sub(e),Ae.copy(t).sub(i),Pe.angleTo(Ae)}var Oe=new THREE.Box3;function Le(e,t,i){if(Oe.makeEmpty(),Oe.expandByPoint(e),Oe.expandByPoint(t),r=i.box,(n=Oe).max.x<r.min.x||n.min.x>r.max.x||n.max.z<r.min.z||n.min.z>r.max.z)return!1;for(var r,n,o=!1,a=0,s=i.length-1;a<i.length;s=a++)if(ke(e,t,i[a],i[s])){o=!0;break}return!!o||function(e,t){for(var i=e.x,r=e.z,n=!1,o=0,a=t.length-1;o<t.length;a=o++){var s=t[o].x,l=t[o].z,c=t[a].x,u=t[a].z;r<l!=r<u&&i<(c-s)*(r-l)/(u-l)+s&&(n=!n)}return n}(e,i)}function ke(e,t,i,r){var n=(e.x-i.x)*(t.z-i.z)-(e.z-i.z)*(t.x-i.x),o=(e.x-r.x)*(t.z-r.z)-(e.z-r.z)*(t.x-r.x);if(0<n*o)return!1;var a=(i.x-e.x)*(r.z-e.z)-(i.z-e.z)*(r.x-e.x);if(0<a*(a+n-o))return!1;var s=a/(o-n),l=s*(t.x-e.x),c=s*(t.z-e.z);return{x:e.x+l,z:e.z+c}}function He(e){this._navigations=e,this._map=null,this._connectNavMap=null,this._connectPoints=[],this._init()}function je(e,t){for(var i=-1,r=0;r<t.length;r++)t[r].equals(e)&&(i=r);return i}function Fe(e){var t={};for(var i in e)t[i]=Object.assign({},e[i]);return t}function De(e){this._navigation=e}Object.assign(He.prototype,{_init:function(){this._map={},this._connectNavMap={};for(var e=0;e<this._navigations.length;e++){for(var t=this._navigations[e],i=t.getExtraPoints(),r=0;r<i.length;r++){var n=i[r],o=je(n,this._connectPoints);o<0?(o=this._connectPoints.length,n._index=o,this._connectPoints.push(n)):n._index=this._connectPoints[o]._index}if(1<i.length)for(r=0;r<i.length;r++)for(var a=0;a<i.length;a++)if(a!==r){var s=t.getDistance(i[a],i[r]),l=i[a]._index,c=i[r]._index;this._map[l]=this._map[l]||{},this._map[c]=this._map[c]||{},this._map[l][c]=s,this._map[c][l]=s,this._connectNavMap[l]=this._connectNavMap[l]||{},this._connectNavMap[c]=this._connectNavMap[c]||{},this._connectNavMap[l][c]=t,this._connectNavMap[c][l]=t}}},findPath:function(e,t,i,r){if(e==i)return this._navigations[e].findPath(t,r);if(0==this._navigations[e].getExtraPoints().length||0==this._navigations[i].getExtraPoints().length)return console.info("closed space: "+e+" or "+i),[];var n=Fe(this._map),o=Fe(this._connectNavMap),a=0,s=0,l=this._connectPoints.length,c=0;function u(e,t,i){for(var r=t.getExtraPoints(),a=0;a<r.length;a++){var s=je(r[a],i),l=t.getDistance(e,r[a]);n[h]=n[h]||{},n[s]=n[s]||{},n[h][s]=l,n[s][h]=l,o[h]=o[h]||{},o[s]=o[s]||{},o[h][s]=t,o[s][h]=t}}if(je(t=(m=this._navigations[e]).findNearestPathPoint(t).clone(),this._connectPoints)<0){var h=l+c;c++,u(t,m,this._connectPoints),this._connectPoints.push(t),a=h}else a=je(t,this._connectPoints);je(r=(m=this._navigations[i]).findNearestPathPoint(r).clone(),this._connectPoints)<0?(h=l+c,c++,u(r,m,this._connectPoints),this._connectPoints.push(r),s=h):s=je(r,this._connectPoints);var p=Graph.findShortestPath(n,a,s);if(!p)return console.info("find no path between rooms: "+e+" or "+i),[];for(var d=[],f=0;f<p.length-1;f++){var m,g=+p[f],v=+p[f+1],y=(m=o[g][v]).findPath(this._connectPoints[g],this._connectPoints[v]);0!==f&&y.shift(),d=d.concat(y)}return this._connectPoints.length=l,d}}),Object.assign(De.prototype,{createPathPointsMesh:function(){for(var e=this._navigation.getPoints(),t=[],i=0,r=e.length;i<r;i++)e[i].toArray(t,3*i);var n=new THREE.BufferGeometry;return n.addAttribute("position",new THREE.BufferAttribute(new Float32Array(t),3)),new THREE.Points(n)},createPathLineSegmentsMesh:function(){for(var e=this._navigation,t=e.getPoints(),i=[],r=e.getIndices(),n=0,o=t.length;n<o;n++)t[n].toArray(i,3*n);var a=new THREE.BufferGeometry;return a.addAttribute("position",new THREE.BufferAttribute(new Float32Array(i),3)),a.setIndex(r),new THREE.LineSegments(a)},createRebuiltTrianglesMesh:function(){for(var e=this._navigation.getRebuiltTriangles(),t=[],i=0,r=e.length;i<r;i++){var n=e[i];n.a.toArray(t,18*i+0),n.b.toArray(t,18*i+3),n.b.toArray(t,18*i+6),n.c.toArray(t,18*i+9),n.c.toArray(t,18*i+12),n.a.toArray(t,18*i+15)}var o=new THREE.BufferGeometry;return o.addAttribute("position",new THREE.BufferAttribute(new Float32Array(t),3)),new THREE.LineSegments(o)},createPathNodeByPoints:function(e){for(var t=[],i=0,r=e.length;i<r;i++)e[i].toArray(t,3*i);var n=[];for(i=0,r=e.length;i<r;i++)i!==r-1&&n.push(i,i+1);var o=new THREE.Group,a=new THREE.BufferGeometry;a.addAttribute("position",new THREE.BufferAttribute(new Float32Array(t),3));var s=new THREE.Points(a);o.add(s);var l=new THREE.BufferGeometry;l.addAttribute("position",new THREE.BufferAttribute(new Float32Array(t),3)),l.setIndex(n);var c=new THREE.LineSegments(l);return o.add(c),o}});var Be,Ie=function(){function e(t){r(this,e),this.object=t,this.prevObjectPosition=null,this.prevObjectScale=null,this.prevObjectAngles=null,this._objects=[],this.groupNavigation=null,this.navigationHelpersNode=null,this.navigationHelpers=[]}return e.prototype.clear=function(){this.showHelper(!1),this.prevObjectPosition=null,this.prevObjectScale=null,this.prevObjectAngles=null,this._objects=[],this.groupNavigation=null,this.navigationHelpers=[]},e.prototype.needGen=function(){var e=this.object;if(!e)return!0;if(!this.prevObjectPosition||!this.prevObjectScale||!this.prevObjectAngles)return!0;var t=Te.parseVector3(e.position),i=Te.parseVector3(e.scale),r=Te.parseVector3(e.angles);return!t.equals(this.prevObjectPosition)||!i.equals(this.prevObjectScale)||!r.equals(this.prevObjectAngles)},e.prototype.getClipAreas=function(e,t){var i,r,n=[];if(t)for(var o=0;o<t.length;o++){var a=t[o];if((i=e)==(r=a.object)||i.isChildOf(r)){for(var s=[],l=a.area,c=0;c<l.length;c++){var u=Te.parseVector3(l[c]);s.push(u)}n.push(s)}}return n},e.prototype.genFromData=function(e,t,i,r){if(!Te.isFunction(e.getNavigationData))return!1;var n=e.getNavigationData();if(!n)return!1;for(var o=[],a=0;a<8;a+=2)o.push({x:n.data[a],y:n.data[a+1]});var s=[];for(a=0;a<n.holes.length;a++){for(var l=2*n.holes[a],c=[],u=0;u<8;u+=2)c.push({x:n.data[l+u],y:n.data[l+u+1]});s.push(c)}var h=new Se({contour:o,holes:s,y:0},t,30,this.getClipAreas(e,r));i.push(h);var p=new De(h);return this.navigationHelpers.push(p),!0},e.prototype.genFromMesh=function(e,t,i,r,n){if(!Te.isFunction(e.getNavigationMesh))return!1;var o=e.getNavigationMesh();if(!o)return!1;var a=o.geometry;if(!a)return!1;var s=a.clone();s.isBufferGeometry||(s=(new THREE.BufferGeometry).fromGeometry(s)),s.applyMatrix(o.matrixWorld),s.applyMatrix(n);var l=new Se(s,t,30,this.getClipAreas(e,r));i.push(l);var c=new De(l);return this.navigationHelpers.push(c),!0},e.prototype._getCampus=function(){return this.object.isCampus?this.object:this.object.parents.query(".Campus")[0]},e.prototype.initFromObjects=function(e,t){var i=this._getCampus();if(i){var r=new THREE.Matrix4;r.getInverse(i.node.matrixWorld);for(var n=[],o=0;o<e.length;o++){var a=e[o],s=[];a.doors&&a.doors.forEach(function(e){var t=Te.parseVector3(e.position);t.applyMatrix4(r),s.push(t)}),(this.genFromData(a,s,n,t)||this.genFromMesh(a,s,n,t,r))&&this._objects.push(a)}this.groupNavigation=new He(n)}},e.prototype.init=function(e){this.clear();var t=this.object;this.prevObjectPosition=Te.parseVector3(t.position),this.prevObjectScale=Te.parseVector3(t.scale),this.prevObjectAngles=Te.parseVector3(t.angles);try{if(t.isFloor){var i=t.rooms;i.length?this.initFromObjects(i,e):this.initFromObjects([t],e)}else t.isCampus&&this.initFromObjects([t],e)}catch(e){console.error(e),console.error(e.toString()),console.error("Init object(name:"+this.object.name+", id:"+this.object.id+") navigation failed")}},e.prototype.getRoomID=function(e){if(e.isBaseObject)return this._objects.indexOf(e);for(var t=0;t<this._objects.length;t++){var i=this._objects[t];if(i.isFloor)return t;if(i.getRayCastPosition(e))return t;for(var r=i.doors,n=0;n<r.length;n++){var o=r[n];if(j.equalsVector(o.position,e))return t}}return-1},e.prototype.getEntryInfo=function(e,t,i){var r=e[t],n=e[i],o=-1;return this.object.isFloor?r?o=this.getRoomID(r):n&&(o=this.getRoomID(n)):this.object.isCampus&&(o=0),-1===o?null:{id:o,pos:Te.parseVector3(n)}},e.prototype.findPath=function(e){e=e||{};var t=this.getEntryInfo(e,"startRoom","startPosition");if(!t)return null;var i=this.getEntryInfo(e,"endRoom","endPosition");if(!i)return null;var r=this._getCampus();if(!r)return null;var n=new THREE.Matrix4;n.getInverse(r.node.matrixWorld);var o=t.pos.clone();o.applyMatrix4(n);var a=i.pos.clone();a.applyMatrix4(n);var s=this.groupNavigation.findPath(t.id,o,i.id,a);if(!s||!s.length)return null;for(var l=e.height||0,c=t.pos,u=[t.pos.toArray()],h=0;h<s.length;h++){var p=s[h];p.y+=l,length+=p.distanceTo(c),(c=p).applyMatrix4(r.node.matrixWorld),u.push(p.toArray())}return u.getPathLength=function(){return Te.getLength(this)},u},e.prototype.showHelper=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];if(this.object)if(e){if(!this.navigationHelpersNode){this.navigationHelpersNode=new THREE.Group;var t=this._getCampus();if(!t)return;for(var i=0;i<this.navigationHelpers.length;i++){var r=this.navigationHelpers[i],n=r.createRebuiltTrianglesMesh();n.position.y=.1,n.material.color.setHex(6985427),this.navigationHelpersNode.add(n);var o=r.createPathPointsMesh();this.navigationHelpersNode.add(o);var a=r.createPathLineSegmentsMesh();this.navigationHelpersNode.add(a)}this.navigationHelpersNode.applyMatrix(t.node.matrixWorld),this.object.app.scene.add(this.navigationHelpersNode)}}else this.navigationHelpersNode&&(this.object.app.resourceManager.remove(this.navigationHelpersNode),this.navigationHelpersNode=null)},e}(),Ne=function(){function e(){r(this,e),this.object=null,this._boxes=null,this._initBoxes(),this._disable=!1}return e.prototype.onAdd=function(e){this.object=e},e.prototype.onRemove=function(){},e.prototype.onUpdate=function(e){},e.prototype._getKey=function(e,t){return(e?"_onlyVisible":"_all")+(t?"_onlySelf":"")},e.prototype._getBox=function(e,t,i){var r=this._getKey(t,i);return this._boxes[e][r]},e.prototype._setBox=function(e,t,i,r){r.toBox=function(){var e=Te.parseVector3(r.min),t=Te.parseVector3(r.max);return e.z==t.z&&(e.z-=1e-6,t.z+=1e-6),new THREE.Box3(e,t)};var n=this._getKey(t,i);this._boxes[e][n]=r},e.prototype._updateBox=function(e,t,i,r,n){var o=this._getBox(e,t,i);return o||(o=this._processBox((new THREE.Box3)._setFromObject(this.object.node,r,t,n)),this._setBox(e,t,i,o)),o},e.prototype._getVector3=function(e){return e.toArray()},e.prototype._processBox=function(e){var t=[];e.getBoundingPositions().forEach(function(e){t.push(e.toArray())});var i=new THREE.Vector3;e.getSize(i);var r=new THREE.Vector3;e.getCenter(r);var n=this._getVector3(e.min),o=this._getVector3(e.max),a=this._getVector3(i),s=this._getVector3(r);return{points:t,min:n,max:o,center:s,size:a,radius:i.length()}},e.prototype._processOrientedBox=function(e,t){var i=e.points,r=[],n=new THREE.Vector3(1/0,1/0,1/0),o=new THREE.Vector3(-1/0,-1/0,-1/0);i.forEach(function(e){var i=Te.parseVector3(e);i.applyMatrix4(t.matrixWorld),n.min(i),o.max(i),r.push(i.toArray())});var a=Te.parseVector3(e.size),s=new THREE.Vector3;s.addVectors(n,o).multiplyScalar(.5);var l=this._getVector3(n),c=this._getVector3(o),u=this._getVector3(a),h=this._getVector3(s);return{points:r,min:l,max:c,center:h,size:u,radius:a.length()}},e.prototype._getInverseMatrixWorld=function(e){var t=new THREE.Matrix4;return e.updateWorldMatrix(!0,!1),t.getInverse(e.matrixWorld),t},e.prototype.getBoundingBox=function(){var e,t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],i=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(i){var r=this;e=function(e){return!r.object._isChildNode(e)}}return this._updateBox("boundingBox",t,i,null,e)},e.prototype.getOrientedBoundingBox=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],i=this._getBox("orientedBoundingBox",e,t);return i||(i=this._processOrientedBox(this.getLocalBoundingBox(e,t),this.object.node),this._setBox("orientedBoundingBox",e,t,i)),i},e.prototype.getLocalBoundingBox=function(){var e,t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],i=1<arguments.length&&void 0!==arguments[1]&&arguments[1],r=this._getInverseMatrixWorld(this.object.node);if(i){var n=this;e=this._updateBox("selfLocalBoundingBox",t,i,r,function(e){return!n.object._isChildNode(e)})}else e=this._updateBox("localBoundingBox",t,i,r);return e},e.prototype._traverse=function(e){for(var t in this._boxes){var i=this._boxes[t];for(var t in i)i[t]&&(i[t]=e(i[t],t))}},e.prototype._initBoxes=function(){this._boxes={boundingBox:{},orientedBoundingBox:{},localBoundingBox:{},selfLocalBoundingBox:{}}},e.prototype.translate=function(e,t){var i=Te.parseVector3(e);this._traverse(function(e,r){return t&&t!=r||e.translate(i),e})},n(e,[{key:"dirty",set:function(e){this._disable||e&&this._initBoxes()}},{key:"disable",set:function(e){this._disable=e},get:function(){return this._disable}}]),e}();function Ue(e,t){t.canNotQueryFromSelector||e.push(t)}function Ve(e,t,i){var r=e.substring(2);t.forEach(function(e){e.uuid==r&&Ue(i,e)})}Ne._processBox=function(e){return(Be=Be||new Ne)._processBox(e)},Ne._getOrientedBox=function(e){var t=(Be=Be||new Ne)._getInverseMatrixWorld(e),i=Be._processBox((new THREE.Box3)._setFromObject(e,t));return Be._processOrientedBox(i,e)};var ze=function(){function e(t,i){r(this,e),this.app=t,this.objects=i}return e.prototype._setAttribute=function(e,t){for(var i=0;i<this.objects.length;i++){var r=this.objects[i];r&&(r.style[e]=t)}},e.prototype.setMaterial=function(e){this.objects.forEach(function(t){t.style.setMaterial(e)})},n(e,[{key:"renderOrder",set:function(e){this._setAttribute("renderOrder",e)}},{key:"color",set:function(e){this._setAttribute("color",e)}},{key:"opacity",set:function(e){this._setAttribute("opacity",e)}},{key:"outlineColor",set:function(e){this._setAttribute("outlineColor",e)}},{key:"defaultOutlineColor",set:function(e){this._setAttribute("defaultOutlineColor",e)}},{key:"skipOutline",set:function(e){this._setAttribute("skipOutline",e)}},{key:"skipBoundingBox",set:function(e){this._setAttribute("skipBoundingBox",e)}},{key:"wireframe",set:function(e){this._setAttribute("wireframe",e)}},{key:"axisHelper",set:function(e){this._setAttribute("axisHelper",e)}},{key:"boundingBox",set:function(e){this._setAttribute("boundingBox",e)}},{key:"boundingBoxColor",set:function(e){this._setAttribute("boundingBoxColor",e)}},{key:"alwaysOnTop",set:function(e){this._setAttribute("alwaysOnTop",e)}},{key:"glow",set:function(e){this._setAttribute("glow",e)}},{key:"innerGlow",set:function(e){this._setAttribute("innerGlow",e)}},{key:"emissive",set:function(e){this._setAttribute("emissive",e)}}]),e}(),qe=function(){function e(t,i){r(this,e),this.objects=[],this.app=t,this.objectManager=t.objectManager,this.events=t.events,this.length=0,this.initObjectPool=i||this.objectManager.objects}return e.prototype.isSelector=function(){return!0},e.prototype.query=function(t){var i=new e(this.app,this.initObjectPool);return i.select(t,this.objects),i},e.prototype._getObjects=function(t){var i=null;if(t instanceof e)i=(r=t).objects;else if(Te.isString(t)){var r;(r=new e(this.app,this.initObjectPool)).select(t),i=r.objects}else Te.isArray(t)?i=t:t.isBaseObject||t.isGroup?i=[t]:console.error("selector.add unkown: "+t);return i},e.prototype.remove=function(e){if(!e)return this;var t=this._getObjects(e);if(!t)return this;for(var i=this.objects,r=0;r<i.length;r++)for(var n=0;n<t.length;n++)if(i[r]==t[n]){i.splice(r--,1);break}return this.buildReturnObject(i)},e.prototype.add=function(e){if(!e)return this;var t=this._getObjects(e);if(!t)return this;var i=this.objects.concat(t),r=Array.from(new Set(i));return this.buildReturnObject(r)},e.prototype.not=function(t){if(!t)return this;var i=null;if(t instanceof e)i=(r=t).objects;else if(Te.isString(t)){var r;(r=new e(this.app,this.initObjectPool)).select(t),i=r.objects}else if(Te.isArray(t))i=t;else{if(!t.isBaseObject&&!t.isGroup)return console.error("selector.not unkown: "+t),this;i=[t]}for(var n=0;n<i.length;n++){var o=i[n],a=this.objects.indexOf(o);-1<a&&this.objects.splice(a,1)}var s=this.objects;return this.buildReturnObject(s)},e.prototype.parse=function(e,t,i){if(Te.isString(e))if(0==e.indexOf(".")){var r=e.substring(1);g=r,v=i,t.forEach(function(e){(e.type==g||e["is"+g])&&Ue(v,e)})}else 0==e.indexOf("##")?Ve(e,t,i):0==e.indexOf("#")?(d=t,f=i,m=e.substring(1),d.forEach(function(e){e.id==m&&Ue(f,e)}),i.length||(Ve("#"+e,t,i),i.length&&console.warn('[Selector] please use "##" to query object'))):0==e.indexOf("[")&&e.indexOf("]")==e.length-1?function(e,t,i){for(var r=null,n=["!=",">=","<=","=",">","<"],o=0;o<n.length;o++){var a=n[o];if(0<e.indexOf(a)){r=a;break}}if(null!=r){var s=e.split(r),l=s[0].trimBoth("\"' "),c=s[1].trimBoth("\"' ");t.forEach(function(e){var t=e.userData||e.properties;if(t){var n,o,a,s=Te.parseValue(t[l],Te.isFunction(e.getAttribute)?e.getAttribute(l):null);void 0!==s&&(Te.isStringNumber(s)&&Te.isStringNumber(c)&&(s=parseFloat(s),c=parseFloat(c)),n=s,o=c,("!="==(a=r)?n!=o:">="==a?o<=n:"<="==a?n<=o:"="==a?Te.isString(o)&&0<o.indexOf("*")?(o=o.replace("*",""),0<=n.indexOf(o)):n==o:">"==a?o<n:"<"==a?n<o:void 0)&&Ue(i,e))}})}else{var u=e;t.forEach(function(e){(e.userData[u]||e.getAttribute(u))&&Ue(i,e)})}}(e.slice(1,e.length-1),t,i):"*"==e?(p=i,t.forEach(function(e){Ue(p,e)})):(u=e,h=i,t.forEach(function(e){e.name==u&&Ue(h,e)}));else Te.isRegExp(e)?(l=e,c=i,t.forEach(function(e){l.test(e.name)&&Ue(c,e)})):Te.isFunction(e)?(a=e,s=i,t.forEach(function(e){a(e)&&Ue(s,e)})):e.isSelector&&(n=e,o=i,t.forEach(function(e){n.has(e)&&Ue(o,e)}));var n,o,a,s,l,c,u,h,p,d,f,m,g,v},e.prototype.queryResult=function(e,t){e=e||{},t=t||this.initObjectPool;var i=[];if(Te.isFunction(e.split)){for(var r=e.split("|"),n=0;n<r.length;n++){var o=r[n].trim();o&&this.parse(o,t,i)}1<r.length&&(i=Array.from(new Set(i)))}else this.parse(e,t,i);return i},e.prototype.select=function(e,t){var i=this.queryResult(e,t);return this.buildReturnObject(i)},e.prototype.buildReturnObject=function(t){this.clear(),(t=t||[])instanceof e&&(t=t.toArray()),this.objects=t,this.length=t.length;for(var i=0;i<t.length;i++)this[i]=t[i];return this},e.prototype.clear=function(){for(var e=0;e<this.length;e++)delete this[e];this.objects=[],this.length=0},e.prototype.forEach=function(e){if(e)for(var t=0;t<this.objects.length;t++){var i=this.objects[t];if(i&&!1===e(i))break}},e.prototype.sort=function(e){e=e||function(e,t){var i=e.levelFromRoot;return t.levelFromRoot-i},this.objects.sort(e);for(var t=0;t<this.objects.length;t++)this[t]=this.objects[t];return this},e.prototype.toJSON=function(){return JSON.stringify(this.objects)},e.prototype.toArray=function(){return this.objects},e.prototype.indexOf=function(e){return this.objects.indexOf(e)},e.prototype.splice=function(e,t){this.objects.splice(e,t),this.length=this.objects.length},e.prototype.concat=function(t){var i=new e(this.app,this.objects);if(i.buildReturnObject(this.objects),t)for(var r=0;r<t.length;r++)-1===i.indexOf(t[r])&&i.add(t[r]);return i},e.prototype.reverse=function(){var t=this.objects.reverse(),i=new e(this.app,t);return i.buildReturnObject(t),i},e.prototype.has=function(e){return-1!==this.objects.indexOf(e)},e.prototype.equals=function(e){if(this.length!=e.length)return!1;for(var t=0;t<this.length;t++)if(this[t]!=e[t])return!1;return!0},e.prototype.setOpacity=function(e){for(var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],i=0;i<this.objects.length;i++){var r=this.objects[i];r&&r.style.setOpacity(e,t)}},e.prototype.flipVisible=function(){for(var e=0;e<this.objects.length;e++){var t=this.objects[e];t&&(t.visible=!t.visible)}},e.prototype.fadeIn=function(e){for(var t=0;t<this.objects.length;t++){var i=this.objects[t];i&&i.fadeIn(e)}},e.prototype.fadeOut=function(e){for(var t=0;t<this.objects.length;t++){var i=this.objects[t];i&&i.fadeOut(e)}},e.prototype.destroyAll=function(){for(var e=0;e<this.objects.length;e++){var t=this.objects[e];t&&t.destroy()}this.clear()},e.prototype.on=function(e,t,i,r,n){this.events.bindCallObj(e,t,i,r,this.objects,n)},e.prototype.off=function(e,t,i){this.events.unbindCallObj(e,t,i,this.objects)},e.prototype.one=function(e,t,i,r,n){this.events.bindCallObj(e,t,i,r,this.objects,n,!0)},e.prototype.trigger=function(e,t,i){for(var r=0;r<this.objects.length;r++)this.objects[r].trigger(e,t,i)},e.prototype.pauseEvent=function(e,t,i){for(var r=0;r<this.objects.length;r++)this.objects[r].pauseEvent(e,t,i)},e.prototype.pauseEventInFrame=function(e,t,i){for(var r=0;r<this.objects.length;r++)this.objects[r].pauseEventInFrame(e,t,i)},e.prototype.resumeEvent=function(e,t,i){for(var r=0;r<this.objects.length;r++)this.objects[r].resumeEvent(e,t,i)},e.prototype.getNodes=function(){for(var e=function(e,t){for(var i=0;i<e.length;i++)if(t==e[i]||t.isChildOf(e[i]))return!0;return!1},t=[],i=0;i<this.objects.length;i++){var r=this.objects[i];e(t,r.node)||t.push(r.node)}return t},e.prototype.destroy=function(){console.warn("[Selector] Please use '.destroyAll()' to replace '.destroy()'"),this.destroyAll()},e.prototype.showBoundingBox=function(e){console.warn("[Selector] Please use '.style.boundingBox=' to replace '.showBoundingBox()'"),this.style.boundingBox=e},n(e,[{key:"visible",set:function(e){Te.setArrayValue(this.objects,"visible",e)}},{key:"pickable",set:function(e){Te.setArrayValue(this.objects,"pickable",e)}},{key:"draggable",set:function(e){Te.setArrayValue(this.objects,"draggable",e)}},{key:"style",get:function(){return new ze(this.app,this.objects)}},{key:"boundingBox",get:function(){var e=new THREE.Box3;return this.objects.forEach(function(t){e.union(t.boundingBox.toBox())}),THING.BoundingBoxControl._processBox(e)}},{key:"opacity",set:function(e){console.warn("[Selector] Please use '.style.opacity=' to replace '.opacity'"),this.style.opacity=e}}]),e}(),We=function(){function e(){r(this,e),this._flags=0}return e.prototype.setFlags=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:16777215;this._flags=e},e.prototype.clearFlags=function(){this._flags=0},e.prototype.enableFlags=function(e,t){var i=this._flags;return t?this._flags|=e:this._flags&=~e,i!=this._flags},e.prototype.hasFlags=function(e){return!!(this._flags&e)},e.prototype.hasAnyFlags=function(){return 0!==this._flags},e}(),Ge=function(){function e(t){r(this,e),this._object=t,this._bsp=new ThreeBSP(t.node._mergeAllGeometries())}return e.prototype.isCSG=function(){return!0},e.prototype._process=function(e,t){var i=this,r=function(e,t){var r=new ThreeBSP(t);return i._bsp?i._bsp=i._bsp[e](r):i._bsp=r,i._bsp};if(Te.isArray(t))for(var n=0;n<t.length;n++){var o;if((o=t[n]).isBaseObject){var a=o.node._mergeAllGeometries();this._bsp=r(e,a)}}else(o=t).isBaseObject&&(a=o.node._mergeAllGeometries(),this._bsp=r(e,a));return this},e.prototype.union=function(e){return this._process("union",e)},e.prototype.subtract=function(e){return this._process("subtract",e)},e.prototype.intersect=function(e){return this._process("intersect",e)},n(e,[{key:"bsp",get:function(){return this._bsp}}]),e}(),Xe=function(){function e(t,i){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:60;r(this,e),this.object=null,this.app=null,2==t.length?this._size=Te.parseVector2(t):this._size=Te.parseVector3(t),this._node=i,this._factor=n}return e.prototype._updateSize=function(e){var t=Te.parseVector3(this.app.camera.position);this._node.keepSize(t,this._size,this._factor,e,this.object.static),this.object.synIndependentWorldScale()},e.prototype.onAdd=function(e){this.object=e,this._node=this._node||this.object.node,this.app=e.app,this.object.tickable=!0,this._node&&this._node.updateWorldMatrix(!0),this._updateSize()},e.prototype.onRemove=function(){},e.prototype.onUpdate=function(e){return this._updateSize(),!0},n(e,[{key:"size",set:function(e){this._size=Te.parseVector2(e),this.object.synIndependentWorldScale(),this._updateSize(!0)},get:function(){return this._size.toArray()}},{key:"node",set:function(e){this._node=e},get:function(){return this._node}}]),e}(),Ye=function(){function e(t){r(this,e),this.app=t,this._type="",this._id="",this._name="",this._uuid="",this._queryID=j.generateUUID(),this._parent=null,this._children=[],this.node=new THREE.Group,this._lodNode=null,this._defaultStyle=null,this._style=null,this._initBoxSize=null,this._pivot=null,this._ignoreParentScale=!1,this._ignoreParentAngles=!1,this._grid=null,this._dragState=P.No,this._draggable=!1,this.isTickable=!1,this._catchEventAnyTime=!1,this._pickable=!0,this._lookingAtObject=null,this._stateFlags=new We,this._independentControlFlags=new We,this._hideNodesInScene=null,this._renderDistance=null,this._shadowDistance=null,this._localClippingPlaneBase=null,this._localClippingPlane=null,this._lockedOffset=[],this._independentPosition=null,this._independentWorldAngles=null,this._independentWorldScale=null,this.scaling=!1,this.scaleTween=null,this.rotating=!1,this.rotateTween=null,this.fadeTween=null,this.pathTween=null,this.pathTweens=[],this._attachPoints=null,this._controls=[],this.waitCommands=[],this._loadState=e.waitForLoading,this._internalUserData={},this._userData={},this._tags=[],this._groups=[],this._tweens=[],this._autoEnsureParentsVisible=!0,this._autoSynVisible=!0,this._styleStrategy="Default",this._keepSize=!1,this._ignoreEvents=new Set,this.initStaticMembers()}return e.prototype._init=function(e,t){return this._parent=t,this.node=e||this.node,this.loaded=!0,this},e.prototype.initStaticMembers=function(){e.hasStaticMembers||(e.hasStaticMembers=!0,e.waitForLoading=1,e.loading=2,e.loadCompleted=3,e.stateHideBySceneFlag=1)},e.prototype.setUserDataFlag=function(e,t){t?this.node.traverse(function(t){t.userData[e]=!0}):this.node.traverse(function(t){delete t.userData[e]})},e.prototype.setupEffects=function(){this.app.isMobileDevice?this.node.traverse(function(e){var t=e.material;t&&(Array.isArray(t)?t.forEach(function(e){return e.needsUpdate=!0}):t.needsUpdate=!0,e.isMesh&&(e.castShadow=!1,e.receiveShadow=!1),t.map&&(t.map.anisotropy=1,0<t.map.version&&(t.map.needsUpdate=!0)))}):this.node.traverse(function(e){var t=e.material;t&&(t&&(Array.isArray(t)?t.forEach(function(e){return e.needsUpdate=!0}):t.needsUpdate=!0),e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0),t.map&&(t.map.anisotropy=16,0<t.map.version&&(t.map.needsUpdate=!0)))})},e.prototype.setupUserData=function(e){e=e||{};var t=this.node.userData;t.isBaseObject=!0,t.id=this._queryID,t.withGeometryIDAttributes=e.withGeometryIDAttributes;var i=this;t.getObject=function(){return i.app.objectManager.get(i._queryID)}},e.prototype.setupNode=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];e.isLOD&&(this._lodNode=e,this.tickable=!0),e.visible||(e.ensureVisible(!0,!0),e.ensureVisible(!1,!1),this.visible=!1),t?this.node=e:this.node.add(e)},e.prototype.setupName=function(e){this._name=this._name||this._id},e.prototype.setupID=function(e){this._id=Te.parseValue(e.id,this._id),this._name=Te.parseValue(e.name,this._name),this._uuid=Te.parseValue(e.uuid,this._uuid),this._id=this._id||this._uuid||this._name,this._id||this._uuid||(this._id=j.generateUUID()),this.setupName(e),this.setupCommonInfo(e)},e.prototype.setupCommonInfo=function(t){this._internalUserData=t.internalUserData||this._internalUserData,this._stateFlags.enableFlags(e.stateHideBySceneFlag,t.hideByScene),this._userData=t.properties||t.userData||{},this._tags=t.tags||[]},e.prototype._setupLocalPosition=function(e){var t=e.localPosition;t&&this.setLocalPosition(t)},e.prototype.setupTranslation=function(t){if(this._ignoreParentScale=Te.parseValue(t.ignoreParentScale,!1),this._ignoreParentAngles=Te.parseValue(t.ignoreParentAngles,!1),!t.skipSetupTranslation){var i=e.DefaultPosition||{},r=e.DefaultAngles||{},n=e.DefaultScale||{},o=t.position||i[this._type];o?this.position=o:t.basePoint||this._setupLocalPosition(t);var a=t.angle;if(a)this.angles=[0,a,0];else{var s=t.angles||t.localAngles||r[this._type];s&&(this.angles=s)}var l=t.scale||n[this._type];l&&(this.node.scale.copy(Te.parseVector3(l)),this.synIndependentWorldScale())}var c=t.initBoxSize;c&&(this._initBoxSize=c.concat())},e.prototype.setupEnvMap=function(e){var t=this.getEnvMapResources();t&&(e||this.isOutdoors?t.outdoorsEnvMap&&this.node.traverse(function(e){!e.userData.skipEnvMap&&e.material&&(Array.isArray(e.material)?e.material.forEach(function(e){"envMap"in e&&(e.envMap=t.outdoorsEnvMap,e.envMapIntensity=1.3)}):"envMap"in e.material&&(e.material.envMap=t.outdoorsEnvMap,e.material.envMapIntensity=1.3))}):t.indoorsEnvMap&&this.node.traverse(function(e){!e.userData.skipEnvMap&&e.material&&(Array.isArray(e.material)?e.material.forEach(function(e){"envMap"in e&&(e.envMap=t.indoorsEnvMap,e.envMapIntensity=1.3)}):"envMap"in e.material&&(e.material.envMap=t.indoorsEnvMap,e.material.envMapIntensity=1.3))}))},e.prototype.loadFromURL=function(e,t){t&&t()},e.prototype.setupFromURL=function(e){if(e.node)this._url=Te.parseValue(e.url,this._url),this._setup(e);else{var t=this;this.loadFromURL(e,function(){t._setup(e)})}},e.prototype.setupFromData=function(e){this._setup(e)},e.prototype.setupChildVisibleAsParent=function(e,t){},e.prototype.setupVisible=function(e){this._autoEnsureParentsVisible=Te.parseValue(e.autoEnsureParentsVisible,!0),this._autoSynVisible=Te.parseValue(e.autoSynVisible,!0);var t=e.visible;if(Te.isNull(t)){var i=e.parent;i&&i.setupChildVisibleAsParent(this,e)}else this.visible=t},e.prototype._setup=function(t){var i=t.node;if(i){if(this._stateFlags.hasFlags(e.stateHideBySceneFlag)){var r=new THREE.Group;r.position.copy(i.position),r.quaternion.copy(i.quaternion),r.scale.copy(i.scale),(this._hideNodesInScene=i).removeBySelf(),i=r}this.setupNode(i)}this.setupCommonInfo(t),this.setupUserData(t),this.setupParent(t),this.customSetup(t),this.setupComplete(t)},e.prototype.setup=function(e){this._beforeSetup(e),this.loading=!0,this.setupID(e),this.setupVisible(e);var t=e.url,i=e.data,r=e.domElement;t?(e.url=this.app.confirmURL(t)._trimRight("/"),this.setupFromURL(e)):r?this.setupFromDom(e):i?this.setupFromData(e):this._setup(e)},e.prototype._beforeSetupStyle=function(e){},e.prototype._afterSetupStyle=function(e){},e.prototype.setupStyle=function(e){var t=e.style;if(t){for(var i in this._beforeSetupStyle(e),t){var r=t[i];void 0!==r&&(this.style[i]=r)}this._afterSetupStyle(e)}},e.prototype.setupMaterials=function(e){if(!Te.parseValue(e.lights,!0)){var t=this.node.getMeshes();this.node.getMaterials().forEach(function(e){var i=new THREE.MeshBasicMaterial;i.copy(e),i.defines={},i.lights=!1,i.needsUpdate=!0,t.forEach(function(t){if(Te.isArray(t.material))for(var r=0;r<t.material.length;r++){var n=t.material[r];n==e&&(n.dispose(),t.material[r]=i)}else t.material==e&&(t.material.dispose(),t.material=i)})})}},e.prototype.setupCommands=function(e){this._style&&Te.isFunction(this._style._syn)&&this._style._syn();var t=this.app.commandManager.create(this.waitCommands);t&&t.execute(),this.waitCommands=[]},e.prototype.setupInheritAttributes=function(e){var t=Te.parseValue(e.inheritPosition,!0),i=Te.parseValue(e.inheritAngles,!0),r=Te.parseValue(e.inheritScale,!0);this.inheritPosition==t&&this.inheritAngles==i&&this.inheritScale==r||(t&&i&&r||this.node.updateMatrixWorld(),this.inheritPosition=t,this.inheritAngles=i,this.inheritScale=r);var n=Te.parseValue(e.inheritStyle,!0);this.inheritStyle!=n&&(this.inheritStyle=n);var o=Te.parseValue(e.inheritVisible,!1);this.inheritVisible!=o&&(this.inheritVisible=o)},e.prototype.setupParent=function(e){if(!e.skipSetupParent&&!e.independent){var t=e.parent;t?t.isBaseObject?this._parent=t:console.error("[BaseObject] Please make sure parent is BaseObject"):-1!==Object.keys(e).indexOf("parent")&&void 0===t&&console.warn("The parent argument is undefined, Please check parent argument for creating object"),null==this._parent&&void 0===t&&(this._parent=this.app.level.currentParentObject,this._parent||(this._parent=this.app.outdoors)),this._parent&&this._parent._add(this,e,-1)}},e.prototype.customSetup=function(e){},e.prototype._beforeSetup=function(e){},e.prototype._callComplete=function(e){this.loaded=!0,this.trigger("load",{object:this}),this.trigger("complete",{object:this}),this._synTheme(!0);var t=e.successCallback||e.complete;if(t){var i=this;setTimeout(function(){t.call(i,{object:i})},10)}this.app.needUpdate=!0},e.prototype._beforeSetupComplete=function(e){},e.prototype._afterSetupComplete=function(e){},e.prototype.setupComplete=function(e){this._setDirtyFlag(!1,!1,!0),this.loaded=!0,this._userData=this._userData||{},this._internalUserData=this._internalUserData||{},this.setupEffects(),this.setupTranslation(e),this.setupInheritAttributes(e),this._beforeSetupComplete(e),this.setupStyle(e),this.setupEnvMap(),this.setupMaterials(e),this.setupCommands(e),this.static?this.node._synMatrixWorld():this.node.updateWorldMatrix(!1,!1),this._afterSetupComplete(e),this.selfUpdate(),this._callComplete(e)},e.prototype.setParent=function(e,t,i){var r=this._parent;if(r&&r!=e&&r.remove(this,!1),this._parent=e){var n=e.node;t||!this.node.parent?n&&n.add(this.node):this.node.attach(n,this.app.scene,i),this._style&&this._style.alwaysOnTop&&this._style._setAlwaysOnTop(!0)}},e.prototype.synTickableObject=function(){this.isTickable?this.app.objectManager.addTickableObject(this):this.app.objectManager.removeTickableObject(this)},e.prototype._setDirtyFlag=function(e,t){if(this.boundingBoxControl.dirty=!0,e)for(var i=this.parent;i;i=i.parent)i.boundingBoxControl.dirty=!0;t&&this._children.forEach(function(e){e._setDirtyFlag(!1,!0)})},e.prototype.getChildByPath=function(e,t){var i=e.search("/");if(-1!==i)i=e.substring(0,i),e=e.substring(i.length+1);else if(i=e,t){if(t(this,i))return this}else if(this._id==i)return this;for(var r=0;r<this._children.length;r++){var n=this._children[r],o=null;if(t?t(n,i)&&(o=n):n.id==i&&(o=n),o){var a=o.getChildByPath(e);if(a)return a}}return null},e.prototype._getBasePointNode=function(e){var t=this.node.traverseBreakable(function(t){return t.name.contains(e)});return t||(t=this.node.traverseBreakable(function(t){return t.name==e})),t},e.prototype._addFromCampus=function(e){},e.prototype.add=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:-1;if((e=e||{}).isBaseObject)this._add(e,null,t);else{var i=e.url;if(Te.isString(i)){var r=e.position||this.position,n=e.angles||e.localAngles||this.angles,o=Te.parseValue(e.isCamFitScene,!1),a=e.complete,s=this;this.app.create({type:"Campus",url:i,position:r,angles:n,isCamFitScene:o,complete:function(e){var t=e.object;s._addFromCampus(t),t.destroy(),s.dirty=!0,a&&a(),this.app.trigger("addFromCampusComplete")}})}else{var l=e.object;Te.isNull(l)||this._add(l,e,t)}}},e.prototype._add=function(e,t,i){if(!e)return!1;if(!e.isBaseObject)return!1;var r=(t=t||{}).basePoint,n=t.offset||t.localPosition,o=t.angles||t.localAngles,a=Te.parseValue(t.keepNode,!1);if(this.node.updateWorldMatrix(!0,!1),a){var s=e.parent;if(s){var l=s._children.indexOf(e);-1!==l&&s._children.splice(l,1)}e._parent=this}else{var c=Te.parseValue(t.keepLocalPosition||t.node,!1),u=Te.parseValue(t.force||t.position||t.angles||t.scale,!1);e.setParent(this,c,u)}var h=void 0;if(Te.isString(r)){if(!(h=this._getBasePointNode(r)))return console.error("The '"+r+"' basePoint is not existing"),!1;var p=new THREE.Vector3;h.getWorldPosition(p),e.position=p.toArray(),n&&(e.position=j.addVector(e.position,n))}else n&&(e.localPosition=n);return o&&(e.angles=o),e._setDirtyFlag(!0,!1),i>=this._children.length||-1===i?this._children.push(e):this._children.splice(i,0,e),h&&e.node.attach(h,!0),e.node.userData.removedNode&&(e.node.visible=!0,delete e.node.userData.removedNode),!0},e.prototype.remove=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];if(!e)return!1;if(!e.isBaseObject)return!1;if(!e.isChildOf(this))return!1;e._setDirtyFlag(!0,!1),e.node.updateWorldMatrix(!0,!1),-1!==e.node.getParents().indexOf(this.app.scene)&&(e.node.attach(this.app.scene,!1),t&&(e.node.visible=!1,e.node.userData.removedNode=!0)),e._parent=null;var i=this._children.indexOf(e);return-1!==i&&this._children.splice(i,1),!0},e.prototype.swapChild=function(e,t){var i=this._children.indexOf(e),r=this._children.indexOf(t);-1!==i&&-1!==r&&j.swapArray(this._children,i,r)},e.prototype.hasChild=function(e){if(!e)return!!this._children.length;for(var t=0;t<this._children.length;t++)if(this._children[t]==e)return!0;return!1},e.prototype.destroy=function(){var e=this._notifyDestroy;e&&e.call(this),this.stopAllLerpTo(),this.removePickingResources();var t=this._style;t&&(t.isBaseStyle&&(t.glow=!1,t.setEdgeWireframe(null),t.revertMaterial()),t._obj=null),this.tickable=!1,this.removeAllControls(!1),this.app.objectManager.destroy(this);for(var i=this._children.concat(),r=0;r<i.length;r++)i[r].destroy();this._children=[],this.clearAttachPoints(),this.clearNode(),this._parent&&(this._parent.remove(this),this._parent=null),this.node.parent&&this.node.parent.remove(this.node),this.app.events.unbindCallObj(null,null,null,[this]),this._lodNode=null,this._queryID="",delete this.node.userData.getObject,this.app.needUpdate=!0},e.prototype.getRaycastPosition=function(e){if(!e)return null;var t=new THREE.Raycaster;t.ray.origin=Te.parseVector3(this.position),t.ray.direction=Te.parseVector3(e);var i=t.intersectObject(this.app.scene,!0);if(!i.length)return null;for(var r=0;r<i.length;r++){var n=i[r],o=n.object;if(this.app.objectManager.getBaseObject(o)&&!o.isChildOf(this.node))return n.point.toArray()}return null},e.prototype.removePickingResources=function(){this.app.picker.removePickingResources(this.node)},e.prototype.setPickable=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];if(this._pickable=e,this.node.setPickable(e,t),t)for(var i=0;i<this._children.length;i++)this._children[i].pickable=e;this.removePickingResources()},e.prototype.synPickable=function(){this.setPickable(this._pickable)},e.prototype.worldToSelf=function(e){var t=Te.parseVector3(e);return this.node.worldToLocal(t).toArray()},e.prototype.selfToWorld=function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(e=Te.parseVector3(e),this.node.updateMatrixWorld(),t){var i=new THREE.Vector3,r=new THREE.Vector3,n=new THREE.Quaternion;this.node.matrixWorld.decompose(i,n,r);var o=new THREE.Matrix4;return o.compose(i,n,new THREE.Vector3(1,1,1)),e.applyMatrix4(o).toArray()}return this.node.localToWorld(e).toArray()},e.prototype.localToWorld=function(e){return this._parent?this._parent.selfToWorld(e):this.node.localToWorld(Te.parseVector3(e)).toArray()},e.prototype.worldToLocal=function(e){if(this._parent)return this._parent.worldToSelf(e);var t=Te.parseVector3(e);return this.node.worldToLocal(t).toArray()},e.prototype.distanceTo=function(e){return e?(e.isBaseObject&&(e=e.position),Te.parseVector3(this.position).distanceTo(Te.parseVector3(e))):0},e.prototype.lookAt=function(e,t){if(e){var i,r,n;if(t=t||{},Te.isArray(t)?i=t:(i=t.angles,r=Te.parseValue(t.lockYAxis,!1)),e.isBaseObject?n=e.position:e.isCameraController?n=e.cameraObject.position:(n=e,e=null),!n)return void console.error("lookAt failed, due to target is not existing");var o=Te.parseValue(t.always,!0),a=Te.parseValue(t.tryUseFaceTo,o);if(this._lookingAtObject={target:e,targetPosition:Te.parseVector3(n),type:"axis",axis:r?"y":null,quat:Te.parseQuaternion(i),tryUseFaceTo:a},this.node.quaternion.set(0,0,0,1),this.node.updateWorldMatrix(!0,!1),this.node.up.set(0,1,0),e&&e.isCameraController){var s=this.parents.query(".Campus")[0];if(s){var l=s.up;this.node.up.set(l[0],l[1],l[2])}}o?this.tickable=!0:(this.node._lookAtPosition(this._lookingAtObject,this.static,!1),this._lookingAtObject=null)}else this._lookingAtObject=null,this.node.up.set(0,1,0)},e.prototype.rotate=function(e,t){var i=j.degToRad(e);(t=Te.parseVector3(t||[0,1,0])).normalize(),this.node.rotateOnAxis(t,i),this.synIndependentWorldAngles(),this.dirty=!0},e.prototype.rotateX=function(e){isNaN(e)||(this.node.rotateX(j.degToRad(e)),this._synWorldAngles())},e.prototype.rotateY=function(e){isNaN(e)||(this.node.rotateY(j.degToRad(e)),this._synWorldAngles())},e.prototype.rotateZ=function(e){isNaN(e)||(this.node.rotateZ(j.degToRad(e)),this._synWorldAngles())},e.prototype.rotateAround=function(e){var t=(e=e||{}).object,i=e.target,r=Te.parseValue(e.yRotateAngle||e.angle,0),n=Te.parseValue(e.xRotateAngle,0),o=e.time,a=e.speed,s=Te.parseLoopType(e.loopType),l=e.stop,c=e.update,u=e.complete;if(i&&(i=i.isBaseObject?(t=i,null):Te.parseVector3(i)),o){if(a=0,!r&&!n)return void console.error("Please provide yRotateAngle or xRotateAngle to rotate around object")}else o=a?16777215:r||n?(a=0,1e3):(a=10,16777215);var h=Te.parseVector3(this.position),p=new THREE.Spherical,d=h.clone(),f=i||Te.parseVector3(t.position);d.sub(f),p.setFromVector3(d),this.stopRotating(),this.rotating=!0;var m=this.position,g=new THREE.Vector3,v=p.theta,y=p.phi,b=this,_=function(){s==THREE.LoopOnce?u&&u():s==THREE.LoopRepeat?(b.position=m,b.rotateAround(e)):s==THREE.LoopPingPong&&(void 0!==r&&(e.yRotateAngle=-r),void 0!==n&&(e.xRotateAngle=-n),b.rotateAround(e))};this.rotateTween=new TWEEN.Tween({progress:0}).to({progress:1},o).easing(S.Linear.None).onStop(function(){l&&l()}).onUpdate(function(){(function(){var e=!1;if(a){var o=0<r?a:-1*a;p.theta+=o/1e3;var s=v+j.degToRad(r);0<r?p.theta>=s&&(p.theta=s,e=!0):p.theta<=s&&(p.theta=s,e=!0)}else{var u=this._object.progress;r&&(p.theta=v+u*j.degToRad(r)),n&&(p.phi=y+u*j.degToRad(n))}var h=i?i.clone():Te.parseVector3(t.position);if(p.radius=b.distanceTo(h.toArray()),p.makeSafe(),g.setFromSpherical(p),h.add(g),b.node.position.copy(h),c&&c(),e){var d=l;l=null,this.stop(),l=d,_.call(this)}}).call(this)}).onComplete(function(){_.call(this)}),this.rotateTween.start()},e.prototype.rotateOnWorldAxis=function(e){e=e||{};var t=Te.parseVector3(e.axis),i=e.angle;if(t&&i){t.normalize();var r=j.degToRad(i);this.node.rotateOnWorldAxis(t,r),this.static&&this.node._synMatrixWorld()}},e.prototype.rotateTo=function(e){var t=(e=e||{}).angles||e.localAngles,i=e.time,r=e.speed,n=e.lerpType||S.Linear.None,o=e.loopType||A.No,a=e.complete,s=Te.parseVector3(this.angles),l=s.clone(),c=Te.parseVector3(t),u=Te.getConsumeTime(null,s,c,i,r,2e3);this.stopRotating(),this.rotating=!0;var h=this;this.rotateTween=new TWEEN.Tween(s).to(c,u).easing(n).onUpdate(function(){h.angles=[this._object.x,this._object.y,this._object.z]}).onComplete(function(){o==A.Repeat?(h.angles=l.toArray(),h.rotateTo(e)):o==A.PingPong?(e.angles=l.toArray(),h.rotateTo(e)):a&&a.call(h,{object:h})}).start()},e.prototype.stopRotating=function(){this.rotating=!1,this.rotateTween&&this.rotateTween.stop()},e.prototype.scaleTo=function(e){var t=(e=e||{}).scale||[1,1,1],i=e.time,r=e.speed,n=e.lerpType||S.Linear.None,o=e.loopType||A.No,a=e.complete;t[2]=t[2]||1;var s=Te.parseVector3(this.scale),l=s.clone(),c=Te.parseVector3(t),u=Te.getConsumeTime(null,s,c,i,r,2e3);this.stopScaling(),this.scaling=!0;var h=this;this.scaleTween=new TWEEN.Tween(s).to(c,u).easing(n).onUpdate(function(){h.scale=[this._object.x,this._object.y,this._object.z]}).onStop(function(){}).onComplete(function(){o==A.Repeat?(h.scale=l.toArray(),h.scaleTo(e)):o==A.PingPong?(e.scale=l.toArray(),h.scaleTo(e)):a&&a.call(h,{object:h})}).start()},e.prototype.stopScaling=function(){this.scaling=!1,this.scaleTween&&this.scaleTween.stop()},e.prototype.TurnIntoByCondition=function(e,t){return"levelchange"!=e&&"enterlevel"!=e&&"leavelevel"!=e&&"levelflyend"!=e&&".Building"==t?this.parents.query(".Building")[0]:null},e.prototype.canAcceptEvent=function(e){var t=e.type,i=e.object;if("update"==t)return!0;if(E[t])return!0;if(i&&i.isChildOf(this)){if("mouseover"==t)return!0;if("mousedown"==t)return!0;if("mouseup"==t)return!0}return!1},e.prototype._createDispatchEvent=function(e){var t=this.app.events,i={};if(x[e]){var r=t.mouseMovePos;i=t.createMouseEvent(e,{clientX:r[0],clientY:r[1]})}return i},e.prototype._on=function(e,t,i,r,n,o){return this.app.events.bindCallObj(e,t,i,r,[this],n,!1,o)},e.prototype._off=function(e,t,i){return this.app.events.unbindCallObj(e,t,i,[this])},e.prototype._one=function(e,t,i,r,n,o){var a=Te.parseEvent(t,i,r,n,o);return this.app.events.bindCallObj(e,a.selector,a.userData,a.callback,[this],a.tag,!0,a.priority)},e.prototype._pauseEvent=function(e,t,i,r){t?this.app.events.pauseEvent(e,t,i,r,this):this.parent&&this.parent.pauseEvent(e,this,i,r)},e.prototype._resumeEvent=function(e,t,i){t?this.app.events.resumeEvent(e,t,i,this):this.parent&&this.parent.resumeEvent(e,this,i)},e.prototype.on=function(e,t,i,r,n,o){for(var a=this._on(e,t,i,r,n,o),s=0;s<this._controls.length;s++){var l=this._controls[s].control;Te.isFunction(l.onRegisterEvent)&&l.onRegisterEvent(e,a)}return this},e.prototype.off=function(e,t,i){for(var r=this._off(e,t,i),n=0;n<this._controls.length;n++){var o=this._controls[n].control;Te.isFunction(o.onUnregisterEvent)&&o.onUnregisterEvent(e,r)}return this},e.prototype.one=function(e,t,i,r,n,o){for(var a=this._one(e,t,i,r,n,o),s=0;s<this._controls.length;s++){var l=this._controls[s].control;Te.isFunction(l.onRegisterEvent)&&this._controls.onRegisterEvent(e,a,!0)}return this},e.prototype.hasAnyEvents=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];return this.app.events.hasAnyCallObjects([this],e)},e.prototype.hasEvent=function(e,t){var i=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];return e=Te.toLowerCase(e),this.app.events.hasEvent(e,this,t,i)},e.prototype.trigger=function(e,t,i){return this.app.events.dispatchBindCallObj(e,t,[this],i)},e.prototype.pauseEvent=function(e,t,i){this._pauseEvent(e,t,i,!1)},e.prototype.pauseEventInFrame=function(e,t,i){this._pauseEvent(e,t,i,!0)},e.prototype.resumeEvent=function(e,t,i){this._resumeEvent(e,t,i)},e.prototype.isPauseEvent=function(e,t){return this.app.events.isPauseEvent(e,this,t)},e.prototype.getEvents=function(e){var t=this.app.events.getEvents(e,this);if(!t)return[];for(var i=[],r=0;r<t.length;r++){var n=t[r];i.push({callback:n.callback,type:n.type,priority:n.priority,userData:n.userData,tag:n.tag})}return i},e.prototype._traverseObjects=function(e,t){for(var i=0;i<this._children.length;i++){var r=this._children[i];Te.isFunction(e)?e(r):Te.isArray(e)&&e.push(r),t&&r._traverseObjects(e,t)}},e.prototype._isChildNode=function(e){for(var t=this.children,i=0,r=t.length;i<r;i++){var n=t[i];if(e==n.node||e.isChildOf(n.node))return!0}return!1},e.prototype._getSelfNodes=function(){var e=[];return this.children.forEach(function(t){e.push(t.node)}),e},e.prototype._traverseSelfNodes=function(e){if(e){var t=this._getSelfNodes();this.node.traverseBranch(function(i){if(-1!==t.indexOf(i))return!1;e(i)})}},e.prototype._traverseNodes=function(e,t,i){for(var r=0;r<e.children.length;r++){var n=e.children[r],o=n.userData.baseObject_bindSubNode;o||((o=THING.SubObject.create(n,this)).name=n.name),Te.isFunction(t)?t(o):Te.isArray(t)&&t.push(o),i&&this._traverseNodes(n,t,i)}},e.prototype.isSubNode=function(){return!!this.node.userData.baseObject_bindSubNode},e.prototype.traverse=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];e&&(e(this),this._traverseObjects(e,t))},e.prototype.query=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];if(Te.isString(e)&&e.startsWith("/"))return console.warn("[BaseObject] Please use '.subNodes.query()' to replace it, and remove '/' prefix of params"),this.subNodes.query(new RegExp(e.substring(1)),t);var i=[];this._traverseObjects(i,t);var r=new qe(this.app,i);return r.select(e),r},e.prototype._queryChild=function(e){var t=new qe(this.app,this._children);return t.select(e),t},e.prototype.isChildOf=function(e){if(!e)return!1;for(var t=this._parent;t;){if(t==e)return!0;t=t.parent}return!1},e.prototype.isBrotherOf=function(e){if(!e)return!1;var t=this._parent;return!!t&&-1!==t._children.indexOf(e)},e.prototype.clearAttachPoints=function(){if(this._attachPoints){for(var e=0;e<this._attachPoints.length;e++)this._attachPoints[e].destroy();this._attachPoints=null}},e.prototype.isAttachPoint=function(e){if(e&&e.node)for(var t=["dummy:","point:","connector:"],i=0;i<t.length;i++)if(e.name.startsWith(t[i]))return!0;return!1},e.prototype.translate=function(e){this.node.translateX(e[0]),this.node.translateY(e[1]),this.node.translateZ(e[2]),this.static&&this.node._synMatrixWorld(),this.synIndependentWorldPosition(),this.dirty=!0},e.prototype.translateX=function(e){this.translate([e,0,0])},e.prototype.translateY=function(e){this.translate([0,e,0])},e.prototype.translateZ=function(e){this.translate([0,0,e])},e.prototype.moveTo=function(e){var t=e.offset||e.offsetPosition||e.localPosition,i=e.direction;if(t)t=Te.parseVector3(t);else if(i){t=Te.parseVector3(i);var r=Te.parseValue(e.distance,5);t.multiplyScalar(r)}t&&(e.position=this.selfToWorld(t)),this.movePath(e)},e.prototype.createPathTween=function(e,t,i,r,n,o){var a,s=Te.parseVector3(e).clone(),l=Te.parseVector3(t).clone();if(i){!o&&n&&(o=new THREE.Matrix4,n.updateWorldMatrix(!0,!1),o.getInverse(n.matrixWorld));var c=new THREE.Matrix4,u=s.clone(),h=l.clone();u.applyMatrix4(o),h.applyMatrix4(o),c.lookAt(h,u,this.node.up);var p=new THREE.Quaternion;if(p.setFromRotationMatrix(c),r){var d=new THREE.Quaternion;d.setFromAxisAngle(new THREE.Vector3(0,1,0),j.degToRad(r)),p.multiply(d)}a=p}return{distance:s.distanceTo(l),from:s,to:l,toQuat:a}},e.prototype.createPathTweens=function(e,t,i,r){var n=new THREE.Matrix4;e&&(e.updateWorldMatrix(!0,!1),n.getInverse(e.matrixWorld));for(var o=0;o<t.length-1;o++){var a=t[o],s=t[o+1],l=this.createPathTween(a,s,i,r,e,n);this.pathTweens.push(l)}},e.prototype.startPathTweens=function(e,t,i,r,n,o,a,s,l,c,u,h){var p=function(e){for(var t=0,i=0;i<e.length;i++)t+=e[i].distance;return t}(this.pathTweens);if(p){i&&(e=p/i*1e3,a=S.Linear.None);var d=-1,f={progress:p},m=function(e,t){for(var i=[],r=0;r<e.length;r++)i.push(e[r].distance/t);return i}(this.pathTweens,p),g=new THREE.Vector3,v=new THREE.Quaternion,y=this;this.pathTween=new TWEEN.Tween({progress:0}).to(f,e).easing(a).delay(t).onUpdate(function(){var e=this._object.progress/p,t=Te.getArrayIndexFromProgress(y.pathTweens,e,m),i=Te.getArrayProgress(y.pathTweens,e,m),a=y.pathTweens[t];t!=d&&(d=t,r&&(a.fromQuat=y.node.quaternion.clone())),n?y.node.lookAt(n):r&&(o?(v.copy(s?a.fromQuat:y.node.quaternion),v.slerp(a.toQuat,i),y.node.quaternion.copy(v)):y.node.quaternion.copy(a.toQuat)),g.copy(a.from),g.lerp(a.to,i),y.position=g.toArray(),l&&l({progress:e,fromPosition:a.from.toArray(),toPosition:a.to.toArray()})}).onStart(function(){c&&c()}).onStop(function(){u&&u()}).onComplete(function(){h&&h()}).start()}else h&&h()},e.prototype.movePath=function(e){var t,i,r=(e=e||{}).path,n=e.time||1e3,o=Te.parseValue(e.delayTime,0),a=e.speed,s=Te.parseValue(e.local,!0),l=Te.parseValue(e.orientToPath,!1),c=e.orientToPathDegree,u=e.lookAt,h=e.loopType,p=null!==(t=e).lerp&&null!==t.lerpType&&Te.parseValue(t.lerp,!0),d=e.lerpType||S.Linear.None,f=Te.parseValue(e.smooth,!0),m=e.update,g=e.complete;e.loop&&(h=A.Repeat,console.warn('[BaseObject] movePath() use "loopType(THING.LoopType)" to instead "loop(Boolean)" argument'));var v=this.parents.query(".Campus")[0];if(i=v?v.node:this.node.parent,r){if(e.path=r.concat(),s){if(i){i.updateWorldMatrix(!0,!1);for(var y=i.matrixWorld,b=[],_=0;_<r.length;_++){var x=Te.parseVector3(r[_]);x.applyMatrix4(y),b.push(x.toArray())}}r=b}1===r.length&&(r=[this.position,r[0]])}else{var E=e.position;E&&(r=[this.position,E]),r&&(e.path=r.concat())}if(r&&0!=r.length){u&&(l=null,u=Te.parseVector3(u)),this.stopMoving();var w=[];for(_=0;_<r.length;_++){var T=null;2==r[_].length?T=new THREE.Vector3(r[_][0],this.position[1],r[_][1]):3==r[_].length&&(T=Te.parseVector3(r[_])),w.push(T)}this.createPathTweens(i,w,l,c);var M=this.pathTweens[0].from;this.position=[M.x,M.y,M.z];var R=this;this.startPathTweens(n,o,a,l,u,p,d,f,function(e){m&&(e.object=R,m.call(R,e))},function(){},function(){},function(){h==A.Repeat?R.movePath(e):h==A.PingPong?(e.path.reverse(),void 0!==e.orientToPathDegree&&(e.orientToPathDegree=360-e.orientToPathDegree),R.movePath(e)):g&&g.call(R,{object:R})})}else console.error("You must provide the path or position to call moveTo()")},e.prototype.stopMoving=function(){this.pathTweens=[],this.pathTween&&this.pathTween.stop()},e.prototype.hasAttribute=function(e){return Te.hasAttribute(this,e)},e.prototype.getAttribute=function(e){return Te.getAttribute(this,e)},e.prototype.setAttribute=function(e,t){return Te.setAttribute(this,e,t)},e.prototype.setAttributes=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];for(var i in e=e||{})(t||Te.isUndefined(this[i]))&&this.setAttribute(i,e[i])},e.prototype.selfUpdate=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=0;if(this._style&&Te.isFunction(this._style.update)&&(t|=this._style.update(e)),this._localClippingPlane){var i=this._localClippingPlaneBase.clone();i.applyMatrix4(this.node.matrixWorld),this._localClippingPlane.normal=i.normal,this._localClippingPlane.constant=i.constant,t=!0}return this._lodNode&&(this._lodNode.update(this.app.renderCamera),t=!0),this._lookingAtObject&&(this._lookingAtObject.target&&(this._lookingAtObject.targetPosition=Te.parseVector3(this._lookingAtObject.target.position)),this.node._lookAtPosition(this._lookingAtObject,this.static,this._lookingAtObject.tryUseFaceTo),t=!0),this._independentPosition&&(this._getIndependentControlRenderNode()._setWorldPosition(this._independentPosition.clone(),!1,this.static),t=!0),this._independentWorldAngles&&(this._getIndependentControlRenderNode()._setWorldAngles(this._independentWorldAngles.clone(),this.static),t=!0),this._independentWorldScale&&(this._getIndependentControlRenderNode()._setWorldScale(this._independentWorldScale.clone(),this.static),t=!0),t},e.prototype.update=function(e){for(var t=this.selfUpdate(e),i=0;i<this._controls.length;i++){var r=this._controls[i].control,n=r.onUpdate;n&&(t|=n.call(r,e))}return t},e.prototype.createGrid=function(e,t,i,r){this._grid=this.app.create({type:"Grid",size:e,divisions:t,color1:i,color2:r,parent:this}),this._grid.style.skipBoundingBox=!0,this._grid.userData.topNode=!0,this._grid.userData.skipOutline=!0,this._grid.userData.independent=!0,this._grid.canNotQueryFromSelector=!0,this._grid.translateY(-.01)},e.prototype.showGrid=function(e,t,i,r){var n=!(4<arguments.length&&void 0!==arguments[4])||arguments[4];if(Te.isBoolean(e)){var o=e;o&&(this._grid||this.createGrid(300,28,1131673,1131673)),this._grid&&(this._grid.visible=o)}else if(this._grid&&(this._grid.destroy(),this._grid=null),this.createGrid(e,t,i,r),n){var a=e;Te.isNumber(n)&&(a=n),this._grid.addPickableGround({size:a})}},e.prototype.fade=function(e,t){var i=(e=e||{}).time||1e3,r=e.complete;this.fadeTween&&this.fadeTween.stop();var n={opacity:this.style.opacity},o={opacity:t};this.visible=!0;var a=this;this.fadeTween=new TWEEN.Tween(n).to(o,i).easing(TWEEN.Easing.Linear.None).onUpdate(function(){a.style.opacity=this._object.opacity}).onComplete(function(){0==a.style.opacity&&(a.visible=!1),r&&r.call(a,{object:a})}).start()},e.prototype.fadeIn=function(e){this.style.opacity=0,this.fade(e,1)},e.prototype.fadeOut=function(e){this.style.opacity=1,this.fade(e,0)},e.prototype.setClippingPlanes=function(e){var t=(e=e||{}).height,i=Te.parseVector3(e.direction,new THREE.Vector3(0,-1,0));this._localClippingPlaneBase=new THREE.Plane(i,t),this._localClippingPlane=this._localClippingPlaneBase.clone();var r=this;this.node.traverse(function(e){e.isMesh&&(e._clip_prev_material=e.material,e.material=e.material.clone(),e.material.clippingPlanes=[r._localClippingPlane])}),this.tickable=!0},e.prototype.clearClippingPlanes=function(){this.node.traverse(function(e){e.isMesh&&(e.material=e._clip_prev_material,e.material.clippingPlanes=null)}),this._localClippingPlaneBase=null,this._localClippingPlane=null},e.prototype.toJSON=function(){var e={};return e.type=this.type,e.id=this.id,e.name=this.name,e.position=this.position,e.angles=this.angles,e.scale=this.scale,e},e.prototype.addControl=function(e,t,i){if(e){if(Te.isString(t)&&(i=i||t,t={}),!Te.isNumber(e)){if(this.hasControl(e))return console.error("The control is existing when addControl() with '"+e+"'"),null;this._controls.push({control:e,name:i});var r=e.onAdd;return Te.isFunction(r)&&r.call(e,this),this.tickable=!0,this.dirty=!0,e}for(var n=[],o=0;o<n.length;o++){var a=n[o];if(a.id==e){var s=new a.type(this);return s.setup(t),this.addControl(s)}}return null}},e.prototype.getControl=function(e){for(var t=0;t<this._controls.length;t++)if(e==this._controls[t].name)return this._controls[t].control;return null},e.prototype.removeControl=function(e){if(e){var t=!1;if(Te.isString(e)){for(var i=0;i<this._controls.length;i++)if(this._controls[i].name==e){(n=(r=this._controls[i].control).onRemove)&&n.call(r),this._controls.splice(i,1),t=!0;break}}else for(i=0;i<this._controls.length;i++)if(this._controls[i].control==e){var r,n;(n=(r=this._controls[i].control).onRemove)&&n.call(r),this._controls.splice(i,1),t=!0;break}t&&(this.dirty=!0)}},e.prototype.removeAllControls=function(){for(var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=0;t<this._controls.length;t++){var i=this._controls[t].control,r=i.onRemove;r&&r.call(i)}this._controls=[],e&&(this.dirty=!0)},e.prototype.hasControl=function(e){if(Te.isString(e)){for(var t=0;t<this._controls.length;t++)if(e==this._controls[t].name)return!0}else if(-1!==this._controls.indexOf(e))return!0;return!1},e.prototype.setWorldPosition=function(e){var t=Te.parseVector3(e);this.node._setWorldPosition(t,!1,this.static),this.dirty=!0},e.prototype.setWorldAngles=function(e){var t=Te.parseQuaternion(e);this.node._setWorldAngles(t,this.static),this.dirty=!0},e.prototype.setWorldScale=function(e){var t=Te.parseVector3(e);this.node._setWorldScale(t,this.static),this.dirty=!0},e.prototype.setLocalPosition=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],i=Te.parseVector3(e);if(Te.parseValue(t,this._ignoreParentScale)){var r=this.node.parent;if(r){var n=new THREE.Vector3;this.node.updateWorldMatrix(!0,!1),r.getWorldScale(n),i.divide(n)}}this.localPosition=i.toArray()},e.prototype.getLocalPosition=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=this.node.position.clone();if(e){var i=new THREE.Vector3;this.node.updateMatrixWorld(),this.node.getWorldScale(i),t.multiply(i)}return t.toArray()},e.prototype._setScale=function(e){var t=Te.parseVector3(e);this._getIndependentControlRenderNode().scale.set(t.x,t.y,t.z),this.synIndependentWorldScale(),this.static&&this.node._synMatrixWorld(),this.dirty=!0},e.prototype._getScale=function(){return this._getIndependentControlRenderNode().scale.toArray()},e.prototype._synWorldAngles=function(){this.dirty=!0,this.synIndependentWorldAngles(),this.static&&this.node._synMatrixWorld()},e.prototype._getAttributeFromSelfToRoot=function(e){for(var t=this;t;t=t.parent){var i=t.node.userData[e];if(i)return i}return null},e.prototype._getBaseMatrix=function(){return this._getAttributeFromSelfToRoot("_baseMatrix")},e.prototype._getPosition=function(){this.node.updateWorldMatrix(!0,!1);var e=new THREE.Vector3;return this.node.getWorldPosition(e),e.toArray()},e.prototype._setPosition=function(e){e&&(this.setWorldPosition(e),this.synIndependentWorldPosition())},e.prototype._needUseWorldPosition=function(){return this._parent.node!=this.node.parent},e.prototype._setLocalPosition=function(e){if(this._parent){if(this._needUseWorldPosition()){var t=Te.parseVector3(this._parent.selfToWorld(e));this.node._setWorldPosition(t,!1,this.static)}else{var i=Te.parseVector3(e);this.node.position.copy(i),this.static&&this.node._synMatrixWorld()}this._setDirtyFlag(!1,!0,!0);var r=this._notifyPositionChange;r&&r.call(this)}},e.prototype._getLocalPosition=function(){if(!this._parent)return[0,0,0];if(this._needUseWorldPosition())return(e=this.node.position).toArray();var e=new THREE.Vector3;return this.node.getWorldPosition(e),this._parent.node.worldToLocal(e),e.toArray()},e.prototype._getAngles=function(){var e=this.node.parent;return e&&e.userData.childUseWorldAnglesAlways?this.worldAngles:this.node.getAngles()},e.prototype._setAngles=function(e){j.equalsVector(this.angles,e)||(this.node.setAngles(e),this._synWorldAngles())},e.prototype._getPivotValue=function(e){return Te.parseVector3(e)},e.prototype.getBoundingBox=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return this.boundingBoxControl.getBoundingBox(e,t)},e.prototype.getOrientedBox=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return this.boundingBoxControl.getOrientedBoundingBox(e,t)},e.prototype.getLocalBoundingBox=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return this.boundingBoxControl.getLocalBoundingBox(e,t)},e.prototype._updateKeepSize=function(e,t,i,r){return this._keepSize!=e&&((this._keepSize=e)?(r=r||this.distanceTo(this.app.camera.position),i=i||this.scale,this.addControl(new Xe(i,t,r),"MarkerSizeAdjustmentControl")):this.removeControl("MarkerSizeAdjustmentControl"),!0)},e.prototype.getOffsetPosition=function(e){if(e=e||{},!Te.isNull(e.xAngle)||!Te.isNull(e.yAngle)){var t=Te.parseValue(e.onlyVisible,!0),i=Te.parseValue(e.yAngle,0),r=Te.parseValue(e.xAngle,0),n=this.boundingBoxControl.getBoundingBox(t),o=Te.parseValue(e.distance||e.radius,n.radius),a=e.radiusFactor;return a&&(o=n.radius*a),(new THREE.Vector3).getDirectionFromAngles(i,r,o).toArray()}if(e.direction){var s=Te.parseVector3(e.direction),l=e.distance||e.radius;s.multiplyScalar(l);var c=Te.parseVector3(this.position);return c.add(s),this.worldToSelf(c.toArray())}},e.prototype.getWorldPosition=function(e){var t=this.getOffsetPosition(e);return this.selfToWorld(t)},e.prototype.getLayoutPosition=function(e,t){var i=2<arguments.length&&void 0!==arguments[2]&&arguments[2],r=3<arguments.length&&void 0!==arguments[3]&&arguments[3],n=4<arguments.length&&void 0!==arguments[4]&&arguments[4];if(!Te.isArray(e))return null;if(3!==e.length)return null;for(var o=(i?this.getOrientedBox(r,n):this.getBoundingBox(r,n)).points,a=[],s=0;s<o.length;s++)a.push(this.worldToSelf(o[s]));var l=[[a[0],a[1]],[a[0],a[4]],[a[0],a[2]]],c=function(e,t){var i=0;Te.isString(t)?t.equals("left",!0)||t.equals("bottom",!0)||t.equals("back",!0)?i=0:t.equals("right",!0)||t.equals("top",!0)||t.equals("front",!0)?i=1:t.equals("center",!0)&&(i=.5):Te.isNumber(t)?i=t:console.error("get layout position failed, due to unknown layout type("+t+")");var r=Te.parseVector3(e[0]),n=Te.parseVector3(e[1]);return r.lerp(n,i),r},u=[c(l[0],e[0]).x,c(l[1],e[1]).y,c(l[2],e[2]).z];if(t){var h=this.worldToSelf(t);u=j.subVector(h,u)}return this.selfToWorld(u)},e.prototype._getStyle=function(){return this._style||(this._style=this.app.styleManager.createStyle("Default",this),this._defaultStyle=this._style),this._style},e.prototype._synTheme=function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];if(this.parent){var t=this._getParentThemeName();t&&this.applyTheme(t,!0,e)}},e.prototype._getParentThemeName=function(){for(var e=this;e.parent;){if(e.parent._style&&e.parent._style._themeName)return e.parent._style._themeName;var t=e.parent.waitCommands.find(function(e){return"ApplyObjectTheme"===e.type});if(t)return t.params.name;e=e.parent}return null},e.prototype.applyTheme=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],i=2<arguments.length&&void 0!==arguments[2]&&arguments[2];this.loaded?(t&&this.query("*").sort().forEach(function(t){t.applyTheme(e,!1)}),(i||this.style._themeName!==e)&&this.style._applyTheme&&this.style._applyTheme(e)):this.waitCommands.push({type:"ApplyObjectTheme",object:this,params:{name:e,traverse:t,force:i}})},e.prototype.needChangeVisible=function(e){return!!this.node.userData.skipCheckNeedChangeVisible||!(this.node.layers.mask==e&&this.node.visible==e&&!function(e){for(;e;){if(!e.visible)return!0;e=e.parent}return!1}(this.node.parent))},e.prototype._setVisible=function(e){if(this.needChangeVisible(e)){var t=this,i=this._notifyBeforeChangeVisible;i&&i.call(this),e&&this._autoEnsureParentsVisible&&this.node.ensureParentsVisible(e),this.node.ensureVisible(e),this._traverseSelfNodes(function(i){t._autoSynVisible?i.ensureVisible(e):i.visible=e}),this.children.forEach(function(t){t.inheritVisible&&(t.visible=e)});for(var r=0;r<this._controls.length;r++){var n=this._controls[r].control;Te.isFunction(n.onVisible)&&n.onVisible(e)}var o=this._notifyAfterChangeVisible;o&&o.call(this),this.app.needUpdate=!0}},e.prototype._getVisible=function(){return this.node.ensureVisible()},e.prototype.indexOfParent=function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];if(!this._parent)return-1;var t=this._parent._children.indexOf(this);if(-1===t)return-1;if(e){t=0;for(var i=this._parent._children,r=0;r<i.length;r++){var n=i[r];if(n==this)return t;n.type==this.type&&t++}}return t},e.prototype.loadResource=function(){var e=this.dynamicBuilder;e&&(this._dynamicLoading||(this._children.forEach(function(e){e.loadResource()}),this._dynamicLoading=!0,e.requestToBuild(this.uuid),this.loaded=!0))},e.prototype.unloadResource=function(){this._children.forEach(function(e){e.unloadResource()}),this.app.resourceManager.unload(this.node,!1,!1);var e=this.dynamicBuilder;e&&e.disposeObject(this.id),this._dynamicLoading=!1,this.loaded=!1},e.prototype.clearNode=function(e){this._url&&(this.app.modelResource.unload(this._url),this._url=null),this.app.resourceManager.remove(this.node,e)},e.prototype.cloneSelf=function(e){return this.app.create(e)},e.prototype.clone=function(e,t){var i={type:this.type,url:this.url,position:this.position,angles:this.angles,scale:this.scale,visible:this.visible,parent:t||this._parent};if(!this.url){var r=this,n=this.node.cloneByFilter(function(e){for(var t=0;t<r._children.length;t++){var i=r._children[t].node;if(e==i||e.isChildOf(i))return!1}return!0});n.traverse(function(e){e.userData={}}),i.node=n}var o=this.cloneSelf(i);if(!o)return null;if(e)for(var a=0;a<this._children.length;a++)this._children[a].clone(e,o);return o},e.prototype.getEnvMapResources=function(){for(var e=this.parents,t=0;t<e.length;t++){var i=e[t].envMapResources;if(i)return i}return null},e.prototype._synEffectRefCounts=function(){var e=this.app.sceneManager;this.node.traverse(function(t){t.technique&&t.technique.glow&&e._updatEffectRefCounts("glow",1),t.technique&&t.technique.innerGlow&&e._updatEffectRefCounts("innerGlow",1)})},e.prototype._processBillboard=function(e,t){var i=this;e.setUserDataValue("skipOutline",!0),t.billboard=!0,e._lookAt(t,function(){return i.static})},e.prototype._processModel=function(){var e=this;this.node.traverse(function(t){var i=t.userData.gltfExtensions;i&&i.billboard&&(i.billboard.axis="y",e._processBillboard(t,i.billboard),delete i.billboard)})},e.prototype.synIndependentWorldPosition=function(){if(this._independentControlFlags.hasFlags(O.Position)){var e=new THREE.Vector3;this._getIndependentControlRenderNode().getWorldPosition(e),this._independentPosition=e}var t=this._notifyPositionChange;t&&t.call(this)},e.prototype.synIndependentWorldAngles=function(){if(this._independentControlFlags.hasFlags(O.Rotation)){var e=this._getIndependentControlRenderNode().quaternion.clone();this._independentWorldAngles=e}var t=this._notifyAnglesChange;t&&t.call(this)},e.prototype.synIndependentWorldScale=function(){if(this._independentControlFlags.hasFlags(O.Scale)){var e=this._getIndependentControlRenderNode()._getWorldScale();if(this._ignoreParentScale){var t=this.node.parent;if(t){var i=t._getWorldScale();e.divide(i)}}this._independentWorldScale=e}var r=this._notifyScalesChange;r&&r.call(this)},e.prototype.synIndependentTransform=function(){this.synIndependentWorldPosition(),this.synIndependentWorldAngles(),this.synIndependentWorldScale()},e.prototype._getIndependentControlRenderNode=function(){return this.node},e.prototype._useIndependentTransform=function(e){var t=e.matrixWorld,i=new THREE.Vector3,r=new THREE.Vector3,n=new THREE.Quaternion;if(t.decompose(i,n,r),this._independentPosition&&(i=this._independentPosition.clone()),this._independentWorldAngles&&(n=this._independentWorldAngles.clone(),!this._independentPosition)){var o=this.parent.node,a=this.parent.node.getMatrixWorldFromRoot(o.parent),s=new THREE.Matrix4;this._independentWorldScale||(s.compose(new THREE.Vector3,new THREE.Quaternion,o.scale),a.multiply(s)),a.multiply(this.node.matrix);var l=new THREE.Vector3,c=new THREE.Vector3,u=new THREE.Quaternion;a.decompose(l,u,c),i=l}this._independentWorldScale&&(r=this._independentWorldScale.clone()),t.compose(i,n,r)},e.prototype._useIndependentRaycast=function(e){var t=this._getIndependentControlRenderNode();if(t)if(e){t.userData.original_raycast=t.userData.original_raycast||t.raycast;var i=this;t.raycast=function(e,t){var r=i._getIndependentControlRenderNode();return r&&i._useIndependentTransform(r),this.userData.original_raycast.call(this,e,t)}}else t.userData.original_raycast&&(t.raycast=t.userData.original_raycast,delete t.userData.original_raycast)},e.prototype._enableIndependentControl=function(){var e=this;this.node.removeBeforeRenderFunction("independentControlRender");var t=!1,i=this._independentControlFlags;if(i.hasFlags(O.Transform)){this.node.traverse(function(e){Te.backupValue(e,"frustumCulled"),e.frustumCulled=!1}),this.synIndependentTransform(),this.tickable=!0;var r=this._getIndependentControlRenderNode();r.hasBeforeRenderFunction("independentControlRender")||(e=this,r.addBeforeRenderFunction("independentControlRender",function(t,i,r){e._useIndependentTransform(this)},0)),t=!0}else this.node.traverse(function(e){Te.revertValue(e,"frustumCulled")});return i.hasFlags(O.Position)||(this._independentPosition=null),i.hasFlags(O.Rotation)||(this._independentWorldAngles=null),i.hasFlags(O.Scale)||(this._independentWorldScale=null),this._useIndependentRaycast(t),i.hasFlags(O.Style)?this.node.traverse(function(t){t.userData.__independent_style_object__=e}):this.node.traverse(function(e){delete e.userData.__independent_style_object__}),t},e.prototype.enableIndependentControl=function(e,t){return!!this._independentControlFlags.enableFlags(e,t)&&this._enableIndependentControl()},e.prototype.stopAllLerpTo=function(){for(var e=0;e<this._tweens.length;e++)this._tweens[e].tween.stop();this._tweens=[]},e.prototype.stopLerpTo=function(e){for(var t=0;t<this._tweens.length;t++)e==this._tweens[t].name&&(this._tweens[t].tween.stop(),this._tweens.splice(t--,1))},e.prototype.lerpTo=function(e,t){var i=function(e){for(var t={},i=Object.keys(e),r=0;r<i.length;r++){var n=i[r],o=e[n];if(Te.isArray(o)){var a=Te.parseVector3(o);a&&(o=a,t["__"+n+"_x"]=o.x,t["__"+n+"_y"]=o.y,t["_#vector3"+n]=o.z)}else t[n]=o}return t},r=function(e,t,i){for(var r=0;r<e.length;r++)if(!(n=e[r]).startsWith("__")){var n,o=i[n];o=n.startsWith("_#vector3")?[i["__"+(n=n.substring(9))+"_x"],i["__"+n+"_y"],o]:i[n],Te.setAttribute(t,n,o)}},n=i((e=e||{}).from||{}),o=i(e.to||{}),a=e.time||1e3,s=Te.parseValue(e.delayTime,0),l=e.start,c=e.update,u=e.stop,h=e.complete,p=e.lerpType||THING.LerpType.Linear.None,d=Te.parseLoopType(e.loopType);n.__progress=Te.parseValue(n.__progress,0),o.__progress=Te.parseValue(o.__progress,1);var f=0;t&&this.stopLerpTo(t);var m=Object.keys(n),g=this,v=new TWEEN.Tween(n).to(o,a).delay(s).easing(p).onStop(function(){if(u){var e={object:g};r(m,e,this._object),r(m,g,this._object),u.call(g,e)}}).onStart(function(){var e={object:g,delta:0};r(m,e,this._object),r(m,g,this._object),l&&l.call(g,e)}).onUpdate(function(){var e=this._object.__progress-f;f=this._object.__progress;var t={object:g,delta:e};r(m,t,this._object),r(m,g,this._object),c&&c.call(g,t)}).onComplete(function(){var t=this._object.__progress-f;f=this._object.__progress;var i={object:g,delta:t};if(r(m,i,this._object),r(m,g,this._object),d==THREE.LoopOnce)h&&h.call(g,i);else if(d==THREE.LoopRepeat)g.lerpTo(e);else if(d==THREE.LoopPingPong){var n=e.from;e.from=e.to,e.to=n,g.lerpTo(e)}}).start();this._tweens.push({name:t,tween:v})},e.prototype._getLinkableObjects=function(){var e=new qe(this.app),t=this.userData._Portal_;if(t){var i=this.app.query(t)[0];i&&e.add(i)}return e},e.prototype._getLinkableDoors=function(){return this._queryChild("[_Portal_]")},e.prototype._setupNavigationGraph=function(e,t){e[this.id]=e[this.id]||{};for(var i=this._getLinkableDoors(),r=0;r<i.length;r++){var n=i[r];e[n.id]=e[n.id]||{},e[this.id][n.id]=e[n.id][this.id]=t;for(var o=n._getLinkableObjects(),a=0;a<o.length;a++){var s=o[a];e[s.id]=e[s.id]||{},e[s.id][n.id]=e[n.id][s.id]=t}}},e.prototype.setupGraph=function(){if(this._graph)return this._graph;var e={};return this._setupNavigationGraph(e,1e4),this._graph=new Graph(e),this._graph},e.prototype.findPath=function(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.1,r=this.getNavigation();return r?r.findPath({startPosition:e,endPosition:t,height:i}):null},e.prototype.getFindingPathLength=function(e,t){var i=this.findPath(e,t);return i?i.getPathLength():0},e.prototype.showNavigationHelper=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=this.getNavigation();t&&t.showHelper(e)},e.prototype.canNavigation=function(){return!1},e.prototype.getNavigation=function(e){return this.canNavigation()?(this._navigation||(this._navigation=new Ie(this)),(e||this._navigation.needGen())&&this._navigation.init(e),this._navigation):null},e.prototype.changeAppearance=function(e){if(this.__appearanceNode!=e)if(e){e.visible=!0,this.node.add(e);for(var t=0;t<this.node.children.length;t++)(i=this.node.children[t]).visible&&i!=e&&(i.visible=!1,i.__appearanceNode=e);this.__appearanceNode=e}else{for(e.visible=!1,e.removeBySelf(),t=0;t<this.node.children.length;t++){var i;(i=this.node.children[t]).__appearanceNode&&(i.visible=!0,delete i.__appearanceNode)}delete this.__appearanceNode}},e.prototype.getAllObjectsInChildren=function(e){console.warn("[BaseObject] Please use '.children' to replace 'getAllObjectsInChildren()'");for(var t=0;t<this._children.length;t++)e.push(this._children[t])},e.prototype.dispatch=function(e){console.warn("[BaseObject] Please use 'trigger' to replace 'dispatch' when you want to launch event"),this.trigger(e)},e.prototype.upPosition=function(e){return console.warn("[BaseObject] Please use '.this.selfToWorld([0, distance, 0])' to replace 'upPosition()'"),this.selfToWorld([0,e,0])},e.prototype.downPosition=function(e){return console.warn("[BaseObject] Please use '.this.selfToWorld([0, -distance, 0])' to replace 'downPosition()'"),this.selfToWorld([0,-e,0])},e.prototype.setPosition=function(e,t,i){console.warn("[BaseObject] Please use '.position=[x, y, z]' to replace 'setPosition()'"),this.position=[e,t,i]},e.prototype.setX=function(e){console.warn("[BaseObject] Please use '.position=[x, y, z]' to replace '.x='");var t=this.position;t[0]=e,this.position=t},e.prototype.setY=function(e){console.warn("[BaseObject] Please use '.position=[x, y, z]' to replace '.y='");var t=this.position;t[1]=e,this.position=t},e.prototype.setZ=function(e){console.warn("[BaseObject] Please use '.position=[x, y, z]' to replace '.z='");var t=this.position;t[2]=e,this.position=t},e.prototype.show=function(e){console.warn("[BaseObject] Please use '.visible=true/false' to replace 'show()'"),void 0===e&&(e=!0),this.visible=e},e.prototype.hide=function(){console.warn("[BaseObject] Please use '.visible=false' to replace 'hide()'"),this.visible=!1},e.prototype.flipVisible=function(){console.warn("[BaseObject] Please use '.visible=!.visible' to replace 'flipVisible()'"),this.visible=!this.visible},e.prototype.attr=function(){return console.warn("[BaseObject] Please use 'userData[x]' to replace 'attr()'"),0==arguments.length?this.userData:1==arguments.length?this.userData[arguments[0]]:void(2==arguments.length&&(this.userData[arguments[0]]=arguments[1]))},e.prototype.moveX=function(e){console.warn("[BaseObject] Please use '.translate([d, 0, 0])' to replace 'moveX(d)'"),this.translate([e,0,0])},e.prototype.moveY=function(e){console.warn("[BaseObject] Please use '.translate([0, d, 0])' to replace 'moveY(d)'"),this.translate([0,e,0])},e.prototype.moveZ=function(e){console.warn("[BaseObject] Please use '.translate([0, 0, d])' to replace 'moveZ(d)'"),this.translate([0,0,e])},e.prototype.hasShowBoundingBox=function(){return console.warn("[BaseObject] Please use '.style.boundingBox' to replace 'hasShowBoundingBox()'"),this.style.boundingBox},e.prototype.showBoundingBox=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];console.warn("[BaseObject] Please use '.style.boundingBox' to replace 'showBoundingBox()'"),this.style.boundingBox=e},e.prototype.getAncestor=function(e){return console.warn("[BaseObject] Please use '.parents.query(param)' to replace '.getAncestor(param)'"),this.parents.query(e)},e.prototype.getSubNodeIndex=function(e){return console.warn('[BaseObject] we do not support ".getSubNodeIndex()" anymore, please do not use it'),-1},e.prototype.getSubNodesNumber=function(){return console.warn('[BaseObject] we do not support ".getSubNodesNumber()" anymore, please do not use it'),0},e.prototype.getSubNodeByIndex=function(e){return console.warn('[BaseObject] we do not support ".getSubNodeByIndex()" anymore, please do not use it'),null},e.prototype.removeSubNodeByIndex=function(e){console.warn('[BaseObject] we do not support ".removeSubNodeByIndex()" anymore, please do not use it')},e.prototype.insertSubNode=function(e,t){console.warn('[BaseObject] we do not support ".insertSubNode()" anymore, please do not use it')},e.prototype.createSubNode=function(e){return console.warn('[BaseObject] we do not support ".createSubNode()" anymore, please do not use it'),null},e.prototype.setPolygonOffset=function(e){console.warn("[BaseObject] Please use '.style.setPolygonOffset(params)' to replace '.setPolygonOffset(params)'"),this.style.setPolygonOffset(e)},n(e,[{key:"pickable",set:function(e){this._pickable!=e&&(this._pickable=e,this.synPickable())},get:function(){return!(this.node&&!this.node.getPickable())&&this._pickable}},{key:"subNodes",get:function(){var e=[];this._traverseNodes(this.node,e,!0);var t=new qe(this.app,e);return t.buildReturnObject(e),t}},{key:"attachPoints",get:function(){if(!this._attachPoints){this._attachPoints=[];var e=this;this.node.traverse(function(t){var i=t.userData;if(i&&i.isBaseObject){var r=e.app.objectManager.get(i.id);e.isAttachPoint(r)&&(e._attachPoints.push(r),e.app.objectManager.destroy(r))}})}var t=new qe(this.app);return t.buildReturnObject(this._attachPoints),t}},{key:"isBaseObject",get:function(){return!0}},{key:"destroyed",get:function(){return!this._queryID}},{key:"internalUserData",get:function(){return this._internalUserData},set:function(e){this._internalUserData=e}},{key:"uuid",set:function(e){this._uuid=e},get:function(){return this._uuid}},{key:"type",set:function(e){this._type=e},get:function(){return this._type}},{key:"id",set:function(e){this._id=e},get:function(){return this._id}},{key:"name",set:function(e){this._name=e},get:function(){return this._name}},{key:"queryID",set:function(e){this._queryID=e},get:function(){return this._queryID}},{key:"userData",set:function(e){this._userData=e},get:function(){return this._userData}},{key:"tags",set:function(e){this._tags=e},get:function(){return this._tags}},{key:"groups",get:function(){return this._groups}},{key:"gridSize",get:function(){return this._grid?this._grid.size:0}},{key:"controls",get:function(){return this._controls}},{key:"x",set:function(e){var t=this.position;this.position=[e,t[1],t[2]]},get:function(){return this.position[0]}},{key:"y",set:function(e){var t=this.position;this.position=[t[0],e,t[2]]},get:function(){return this.position[1]}},{key:"z",set:function(e){var t=this.position;this.position=[t[0],t[1],e]},get:function(){return this.position[2]}},{key:"position",set:function(e){this._setPosition(e)},get:function(){return this._getPosition()}},{key:"localPosition",set:function(e){this._setLocalPosition(e)},get:function(){return this._getLocalPosition()}},{key:"angleX",set:function(e){var t=this.angles;this.angles=[e,t[1],t[2]]},get:function(){return this.angles[0]}},{key:"angleY",set:function(e){var t=this.angles;this.angles=[t[1],e,t[2]]},get:function(){return this.angles[1]}},{key:"angleZ",set:function(e){var t=this.angles;this.angles=[t[1],t[2],e]},get:function(){return this.angles[2]}},{key:"angles",set:function(e){this._setAngles(e)},get:function(){return this._getAngles()}},{key:"worldAngles",set:function(e){this.setWorldAngles(e),this._synWorldAngles()},get:function(){var e=new THREE.Quaternion;return this.node.getWorldQuaternion(e),Te.parseAngles(e)}},{key:"selfForward",get:function(){var e=new THREE.Vector3;return this.node.getDirection(e),e.normalize(),e.toArray()}},{key:"forward",get:function(){var e=new THREE.Vector3;return this.node.updateMatrixWorld(!0),this.node.getWorldDirection(e),e.normalize(),e.toArray()}},{key:"up",get:function(){var e=this.node.up.clone();return this.node.updateMatrixWorld(!0),e.transformDirection(this.node.matrixWorld),e.toArray()}},{key:"cross",get:function(){var e=Te.parseVector3(this.up),t=Te.parseVector3(this.forward),i=new THREE.Vector3;return i.crossVectors(e,t),i.normalize(),i.toArray()}},{key:"scale",set:function(e){this._setScale(e)},get:function(){return this._getScale()}},{key:"worldScale",set:function(e){this.setWorldScale(e),this.synIndependentWorldScale(),this.dirty=!0},get:function(){var e=new THREE.Vector3;return this.node.getWorldScale(e),e.toArray()}},{key:"pivot",set:function(e){if(this.node.removeBeforeRenderFunction("pivot"),e){this._pivot={},this._pivot.offset=e;var t=new THREE.Matrix4,i=new THREE.Vector3,r=this;this.node.addBeforeRenderFunction("pivot",function(e,n,o){var a=r.boundingBox.toBox();t.getInverse(r.node.matrixWorld),a.applyMatrix4(t),i.subVectors(a.max,a.min),i.multiply(r._getPivotValue(r._pivot.offset)),i.applyMatrix4(r.node.matrixWorld),this.matrixWorld.setPosition(i)}),this.tickable=!0}},get:function(){var e=this._pivot;return e?e.offset:null}},{key:"boundingBoxControl",get:function(){return this._boundingBoxControl||(this._boundingBoxControl=new Ne(this),this.addControl(this._boundingBoxControl)),this._boundingBoxControl}},{key:"boundingBox",get:function(){var e=this.boundingBoxControl.getBoundingBox(!0),t=this;return void 0===e.getWorldPosition&&(e.getWorldPosition=function(e){var i=t.getOffsetPosition(e),r=j.addVector(t.worldToSelf(t.boundingBox.center),i);return t.selfToWorld(r,!0)}),void 0===e.initSize&&Object.defineProperties(e,{initSize:{get:function(){if(t._initBoxSize)return t._initBoxSize;var e,i=function(e){var t=new THREE.Vector3;return e.getSize(t),t.toArray()},r=function(e){return!e||!!j.equalsVector(e,[0,0,0])},n=t.app.modelResource.getBoundingBox(t.url);if(n&&(e=n.size.concat()),r(e)&&t._loadingBoxSize&&(e=t._loadingBoxSize),r(e)){var o=new THREE.Box3;t._traverseSelfNodes(function(e){e.isMesh&&o.union((new THREE.Box3)._setFromObject(e,null,!1))}),e=i(o)}return r(e)?(o=(new THREE.Box3)._setFromObject(t.node,null,!1),t._initBoxSize=i(o)):t._initBoxSize=e,t._initBoxSize}}}),e}},{key:"orientedBoundingBox",get:function(){return this.boundingBoxControl.getOrientedBoundingBox(this.visible)}},{key:"radius",get:function(){return this.boundingBoxControl.getBoundingBox(this.visible).radius}},{key:"size",get:function(){return this.boundingBoxControl.getBoundingBox(this.visible).size}},{key:"center",get:function(){return this.boundingBoxControl.getBoundingBox(this.visible).center}},{key:"keepSize",set:function(e){this._updateKeepSize(e,this.node)},get:function(){return this._keepSize}},{key:"style",set:function(e){this._style=e},get:function(){return this._getStyle()}},{key:"catchEventAnyTime",set:function(e){this._catchEventAnyTime=e},get:function(){return this._catchEventAnyTime}},{key:"draggable",set:function(e){this._draggable!=e&&((this._draggable=e)?this.on("dragging",function(e){if(e.picked){var t=e.object;t==this&&(t.position=j.addVector(t.position,e.offsetPosition),this.trigger("drag",e))}},"__object_drag__"):this.off("dragging",null,"__object_drag__"))},get:function(){return this._draggable}},{key:"dragState",get:function(){return this._dragState}},{key:"tickable",set:function(e){this.isTickable!=e&&(this.isTickable=e,this.synTickableObject(),this.app.needUpdate=!0)},get:function(){return this.isTickable}},{key:"renderDistance",set:function(e){this._renderDistance=e,Te.isNull(e)?this.app.objectManager.removeRenderDistanceObject(this):this.app.objectManager.addRenderDistanceObject(this)},get:function(){return this._renderDistance}},{key:"shadowDistance",set:function(e){this._shadowDistance=e,Te.isNull(e)?this.app.objectManager.removeShadowDistanceObject(this):this.app.objectManager.addShadowDistanceObject(this)},get:function(){return this._shadowDistance}},{key:"visible",set:function(e){this._setVisible(e)},get:function(){return this._getVisible()}},{key:"dirty",set:function(e){e&&(this._setDirtyFlag(!0,!0),this.visible&&(this.app.needUpdate=!0))}},{key:"disableUpdateBoundingBox",set:function(e){this.boundingBoxControl.disable=e},get:function(){return this.boundingBoxControl.disable}},{key:"static",get:function(){return this.app.root.static}},{key:"children",get:function(){var e=this._children.concat(),t=new qe(this.app,e);return t.buildReturnObject(e),t.not(".CombinedObject"),t.toArray()}},{key:"brothers",get:function(){var e=[],t=this._parent;if(t)for(var i=0;i<t._children.length;i++){var r=t._children[i];r!=this&&e.push(r)}var n=new qe(this.app,e);return n.buildReturnObject(e),n.not(".CombinedObject"),n}},{key:"parents",get:function(){for(var e=[],t=this._parent;t;t=t.parent)e.push(t);var i=new qe(this.app,e);return i.buildReturnObject(e),i.not(".CombinedObject"),i}},{key:"parent",get:function(){return this._parent}},{key:"levelFromRoot",get:function(){for(var e=0,t=this.parent;t;t=t.parent)e++;return e}},{key:"loaded",get:function(){return this._loadState==e.loadCompleted},set:function(t){this._loadState=t?e.loadCompleted:e.waitForLoading}},{key:"loading",get:function(){return this._loadState==e.loading},set:function(t){t&&(this._loadState=e.loading)}},{key:"dynamic",get:function(){return!!this.dynamicBuilder}},{key:"dynamicBuilder",get:function(){if(this.isCampus)return this._builder;var e=this.parents.query(".Campus")[0];return e?e._builder:null}},{key:"verticesNumber",get:function(){return Te.isFunction(this.node.verticesCount)?this.node.verticesCount():0}},{key:"meshNames",get:function(){return this.node.getMeshNames()}},{key:"inheritStyle",set:function(e){this.enableIndependentControl(THING.IndependentControlType.Style,!e)},get:function(){return!this._independentControlFlags.hasFlags(THING.IndependentControlType.Style)}},{key:"inheritPosition",set:function(e){this.enableIndependentControl(THING.IndependentControlType.Position,!e)},get:function(){return!this._independentControlFlags.hasFlags(THING.IndependentControlType.Position)}},{key:"inheritAngles",set:function(e){this.enableIndependentControl(THING.IndependentControlType.Rotation,!e)},get:function(){return!this._independentControlFlags.hasFlags(THING.IndependentControlType.Rotation)}},{key:"inheritScale",set:function(e){this.enableIndependentControl(THING.IndependentControlType.Scale,!e)},get:function(){return!this._independentControlFlags.hasFlags(THING.IndependentControlType.Scale)}},{key:"inheritVisible",set:function(e){this.enableIndependentControl(THING.IndependentControlType.Visible,e)},get:function(){return this._independentControlFlags.hasFlags(THING.IndependentControlType.Visible)}},{key:"owner",get:function(){return this.parent}},{key:"CSG",get:function(){return new Ge(this)}},{key:"self",get:function(){return console.warn("[BaseObject] Please do not use '.self'"),this}},{key:"custom",get:function(){return console.warn("[BaseObject] Please use '.userData' to replace '.custom'"),this.userData}},{key:"boxSize",get:function(){return console.warn("[BaseObject] Please use '.size' to replace '.boxSize'"),this.size}},{key:"boxRadius",get:function(){return console.warn("[BaseObject] Please use '.radius' to replace '.boxRadius'"),this.radius}},{key:"localAngles",set:function(e){console.warn("[BaseObject] Please use '.angles' to replace '.localAngles'"),this.angles=e},get:function(){return console.warn("[BaseObject] Please use '.angles' to replace '.localAngles'"),this.angles}},{key:"isShowBoundingBox",get:function(){return console.warn("[BaseObject] Please use '.hasShowBoundingBox()' to replace '.isShowBoundingBox'"),this.hasShowBoundingBox()}},{key:"building",get:function(){return console.warn("[BaseObject] Please use '.getAncestor('.Building')[0]' to replace '.building'"),this.parents.query(".Building")[0]}},{key:"ancestors",get:function(){return console.warn("[BaseObject] Please use '.parents' to replace '.ancestors'"),this.parents}},{key:"root",get:function(){return console.warn("[BaseObject] Please use 'this.parents.query('.Campus')[0]')' to replace '.root'"),this.parents.query(".Campus")[0]}},{key:"boxCenter",get:function(){return console.warn("[BaseObject] Please use '.center' to replace '.boxCenter'"),this.center}},{key:"lockOffset",set:function(e){console.warn("[BaseObject] Please use '.inheritPosition' to replace '.lockOffset'"),this.inheritPosition=!e},get:function(){return console.warn("[BaseObject] Please use '.inheritPosition' to replace '.lockOffset'"),!this.inheritPosition}},{key:"showDetail",set:function(e){console.warn('[BaseObject] we do not support ".showDetail" anymore, please do not use it')}},{key:"renderOrder",set:function(e){console.warn("[BaseObject] please use .style.renderOrder to replace .renderOrder"),this.style.renderOrder=e},get:function(){return console.warn("[BaseObject] please use .style.renderOrder to replace .renderOrder"),this.style.renderOrder}}]),e}(),Qe=[{name:"baseColorTexture",property:"map"},{name:"alphaTexture",property:"alphaMap"}],Ze=function(){function e(t){r(this,e),this.object=null,this.app=null,this.needResponeAddEvent=t,this._textureAnimations=new Map}return e.prototype._init=function(e){var t=this;e&&(this.clearAllAnimations(),e.traverse(function(e){e.material&&(Array.isArray(e.material)?e.material:[e.material]).forEach(function(e){e.userData.gltfExtensions&&Qe.forEach(function(i){var r=e.userData.gltfExtensions[i.name];if(r){var n=e[i.property];if(n)if(r.multiFramesAnim){var o=new Ke(n,r);e[i.property]=o.texture,e.needsUpdate=!0,t._textureAnimations.set(o.texture.uuid,o)}else if(r.scrollAnim||r.rotateAnim||r.scaleAnim||r.multiFramesAnim||r.scroll){var a=new $e(n,r);e[i.property]=a.texture,e.needsUpdate=!0,t._textureAnimations.set(a.texture.uuid,a)}}})})}),this._textureAnimations.size&&(this.object.tickable=!0))},e.prototype.onAdd=function(e){if(this.object=e,this.app=e.app,this._init(this.object.node),this.needResponeAddEvent){var t=this.object.node.children[0];if(t){var i=this;t.addEventListener("addedChild",function(e){i._init(e.object)})}}delete this.needResponeAddEvent},e.prototype.onRemove=function(){this.clearAllAnimations()},e.prototype.onUpdate=function(e){return this._textureAnimations.forEach(function(t){return t.update(e)}),0<this._textureAnimations.size},e.prototype.clearAllAnimations=function(){this._textureAnimations.forEach(function(e){return e.dispose()}),this._textureAnimations.clear()},e.prototype.getAllAnimations=function(){return Array.from(this._textureAnimations.values())},e}();Ze.hasTextureAnimation=function(e){return!!e.traverseBreakable(function(e){if(e.material)for(var t=Array.isArray(e.material)?e.material:[e.material],i=0;i<t.length;i++){var r=t[i];if(r.userData.gltfExtensions)for(var n=0;n<Qe.length;n++){var o=Qe[n],a=r.userData.gltfExtensions[o.name];if(a&&(a.scrollAnim||a.rotateAnim||a.scaleAnim||a.multiFramesAnim||a.scroll))return!0}}})};var Je=function(){function e(t,i){r(this,e),this.texture=t.clone(),this.texture.wrapS=this.texture.wrapT=THREE.RepeatWrapping,this.texture.needsUpdate=!0,this.start={offset:[0,0],repeat:[1,1],rotation:0},this._isRunning=!0,this._loop=1/0,this._callback=function(){},this.timeScale=1}return e.prototype.update=function(e){},e.prototype._resetTexture=function(){this.texture.offset.fromArray(this.start.offset),this.texture.repeat.fromArray(this.start.repeat)},e.prototype.play=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1/0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){};this._resetTexture(),this._loop=e,this._callback=t,this._isRunning=!0},e.prototype.stop=function(){this._resetTexture(),this._isRunning=!1},e.prototype.pause=function(){this._isRunning=!1},e.prototype.resume=function(){this._isRunning=!0},e.prototype.dispose=function(){this.texture=null},e}(),Ke=function(e){function t(i,n){r(this,t);var o=a(this,e.call(this,i,n));return o.numberOfTiles=0,o.tileDisplayDuration=0,o.currentDisplayTime=0,o.currentTile=0,o.tilesX=0,o.tilesY=0,o._parse(n),o._resetTexture(),o}return o(t,e),t.prototype._parse=function(e){if(e.scroll&&(this.start.offset[0]=e.scroll[0],this.start.offset[1]=e.scroll[1]),e.multiFramesAnim){var t=e.multiFramesAnim.tilesX,i=e.multiFramesAnim.tilesY;this.numberOfTiles=t*i,this.tileDisplayDuration=1/e.multiFramesAnim.animSpeed||1,this.currentDisplayTime=0,this.currentTile=0,this.tilesX=t,this.tilesY=i,this.start.repeat[0]=1/t,this.start.repeat[1]=1/i}},t.prototype.update=function(e){if(this._isRunning)for(this.currentDisplayTime+=e*this.timeScale;this.currentDisplayTime>this.tileDisplayDuration;)if(this.currentDisplayTime-=this.tileDisplayDuration,this.currentTile++,this.currentTile==this.numberOfTiles&&(this.currentTile=0,this._loop--),0<this._loop){var t=this.currentTile%this.tilesX;this.texture.offset.x=t/this.tilesX;var i=Math.floor(this.currentTile/this.tilesX);this.texture.offset.y=i/this.tilesY}else this._isRunning=!1,this._callback()},t}(Je),$e=function(e){function t(i,n){r(this,t);var o=a(this,e.call(this,i,n));return o.animation={offset:[0,0],repeat:[0,0],rotation:0},o._parse(n),o._resetTexture(),o}return o(t,e),t.prototype._parse=function(e){e.scroll&&(this.start.offset[0]=e.scroll[0],this.start.offset[1]=e.scroll[1]),e.scrollAnim&&(void 0!==e.scrollAnim.speed?(this.animation.offset[0]-=e.scrollAnim.speed[0],this.animation.offset[1]-=e.scrollAnim.speed[1]):(this.animation.offset[0]-=e.scrollAnim[0],this.animation.offset[1]-=e.scrollAnim[1])),e.rotateAnim&&(void 0!==e.rotateAnim.speed?this.animation.rotation+=e.rotateAnim.speed/180*Math.PI:this.animation.rotation+=e.rotateAnim/180*Math.PI),e.scaleAnim},t.prototype.update=function(e){if(this._isRunning){var t=this.texture,i=this.animation;t.offset.x+=i.offset[0]*e*this.timeScale,t.offset.y+=i.offset[1]*e*this.timeScale,t.repeat.x+=i.repeat[0]*e*this.timeScale,t.repeat.y+=i.repeat[1]*e*this.timeScale,t.rotation+=i.rotation*e*this.timeScale,0!==i.rotation&&t.center.set(.5,.5)}},t}(Je),et=function(){function e(t,i){r(this,e),this.object=null,this.app=null,this.param=t,this.callback=i,this.loadingBox=null}return e.prototype._createLoadingBox=function(e,t){if(!e.app.options.showLoadingBox||!t)return!1;var i=t[0],r=t[2],n=t[1],o=new THREE.BoxGeometry(i,r,n,1,1,1),a=new THREE.MeshPhongMaterial({color:2200782,transparent:!0});return this.loadingBox=new THREE.Mesh(o,a),this.loadingBox.material.opacity=.01,this.loadingBox.position.y+=r/2,this.loadingBox.userData.size=[i,r,n],this.loadingBox.userData.curProgress=.01,e.pickable||(this.loadingBox.userData.skipPick=!0),this.loadingBox.userData.skipStyle=!0},e.prototype.loadComplete=function(e,t,i){var r=(t.model=e).cloneNode();this.object.setupNode(r,!1),this.object.synPickable(),this.object._processModel(),this.object._synEffectRefCounts();var n=t.nodeReady;n&&n.call(this.object,{object:this.object}),null!=i&&i(),this.object.removeControl(this)},e.prototype.loadModelFromURL=function(e,t){var i=this,r=this.object,n=e.url;r._url=n._trimRight("/"),r.setupUserData(e),e.force=!0,r.setupParent(e),e.skipSetupParent=!0,r.setupTranslation(e),r.node.updateMatrixWorld();var o=this.app.modelResource,a=o.get(n);a?this.loadComplete(a,e,t):o.download(n,function(t){var n=t.size;n&&i._createLoadingBox(r,n)&&r.node.add(i.loadingBox),r._loadingBoxSize=n;var o=e.nodeReady;o&&o.call(r,{object:r,jsonData:t})},function(n){if(r.destroyed)return!1;var o=i.loadingBox;return o&&(n.loadingBox=o).removeBySelf(),e.position=i.object.position,e.angles=i.object.angles,e.scale=i.object.scale,Te.backupValue(e,"nodeReady"),e.nodeReady=null,i.loadComplete(n,e,function(){t&&t()}),Te.revertValue(e,"nodeReady"),!0},function(t){var n=Math.max(.01,t.progress),o=i.loadingBox;o&&o.material&&(o.userData.curProgress=Math.max(o.userData.curProgress,n),o.material.opacity=o.userData.curProgress);var a=e.progress;a&&a.call(r,{object:r,progress:n}),i.object.trigger("progress",{object:r,progress:n})},function(t){var i=e.error;if(i)return i(t),!0})},e.prototype.onAdd=function(e){this.object=e,this.app=e.app,this.loadModelFromURL(this.param,this.callback),delete this.param,delete this.callback},e}(),tt=function(e){function t(i){return r(this,t),a(this,e.call(this,i))}return o(t,e),t.prototype.setupTextureAnimations=function(){Ze.hasTextureAnimation(this.node)&&this.addControl(new Ze(!0),"texAnimControl")},t.prototype.customSetup=function(e){this.setupTextureAnimations(e)},t.prototype.loadFromURL=function(e,t){this.addControl(new et(e,t))},n(t,[{key:"isFacade",get:function(){return!0}},{key:"isOutdoors",get:function(){return!0}},{key:"building",get:function(){return this.parents.query(".Building")[0]}}]),t}(Ye),it={uniforms:{tDiffuse:{value:null},brightness:{value:0},contrast:{value:1},exposure:{value:0},gamma:{value:1},saturation:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","uniform float brightness;","uniform float contrast;","uniform float exposure;","uniform float gamma;","uniform float saturation;","const vec3 w = vec3(0.2125, 0.7154, 0.0721);","void main() {","vec4 tex = texture2D( tDiffuse, vUv );","vec3 color = clamp(tex.rgb + vec3(brightness), 0.0, 1.0);","color = clamp( (color-vec3(0.5))*contrast+vec3(0.5), 0.0, 1.0);","color = clamp( color * pow(2.0, exposure), 0.0, 1.0);","color = clamp( pow(color, vec3(gamma)), 0.0, 1.0);","float luminance = dot( color, w );","color = mix(vec3(luminance), color, saturation);","gl_FragColor = vec4(color, tex.a);","}"].join("\n")},rt={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")},nt={uniforms:{tDiffuse:{value:null},resolution:{value:new THREE.Vector2(1/1024,1/512)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","","uniform sampler2D tDiffuse;","","uniform vec2 resolution;","","varying vec2 vUv;","","// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)","","//----------------------------------------------------------------------------------","// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag","// SDK Version: v3.00","// Email:       gameworks@nvidia.com","// Site:        http://developer.nvidia.com/","//","// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.","//","// Redistribution and use in source and binary forms, with or without","// modification, are permitted provided that the following conditions","// are met:","//  * Redistributions of source code must retain the above copyright","//    notice, this list of conditions and the following disclaimer.","//  * Redistributions in binary form must reproduce the above copyright","//    notice, this list of conditions and the following disclaimer in the","//    documentation and/or other materials provided with the distribution.","//  * Neither the name of NVIDIA CORPORATION nor the names of its","//    contributors may be used to endorse or promote products derived","//    from this software without specific prior written permission.","//","// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY","// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE","// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR","// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR","// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,","// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,","// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR","// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY","// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT","// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE","// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.","//","//----------------------------------------------------------------------------------","","#define FXAA_PC 1","#define FXAA_GLSL_100 1","#define FXAA_QUALITY_PRESET 12","","#define FXAA_GREEN_AS_LUMA 1","","/*--------------------------------------------------------------------------*/","#ifndef FXAA_PC_CONSOLE","    //","    // The console algorithm for PC is included","    // for developers targeting really low spec machines.","    // Likely better to just run FXAA_PC, and use a really low preset.","    //","    #define FXAA_PC_CONSOLE 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_120","    #define FXAA_GLSL_120 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_130","    #define FXAA_GLSL_130 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_3","    #define FXAA_HLSL_3 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_4","    #define FXAA_HLSL_4 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_5","    #define FXAA_HLSL_5 0","#endif","/*==========================================================================*/","#ifndef FXAA_GREEN_AS_LUMA","    //","    // For those using non-linear color,","    // and either not able to get luma in alpha, or not wanting to,","    // this enables FXAA to run using green as a proxy for luma.","    // So with this enabled, no need to pack luma in alpha.","    //","    // This will turn off AA on anything which lacks some amount of green.","    // Pure red and blue or combination of only R and B, will get no AA.","    //","    // Might want to lower the settings for both,","    //    fxaaConsoleEdgeThresholdMin","    //    fxaaQualityEdgeThresholdMin","    // In order to insure AA does not get turned off on colors","    // which contain a minor amount of green.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_GREEN_AS_LUMA 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_EARLY_EXIT","    //","    // Controls algorithm's early exit path.","    // On PS3 turning this ON adds 2 cycles to the shader.","    // On 360 turning this OFF adds 10ths of a millisecond to the shader.","    // Turning this off on console will result in a more blurry image.","    // So this defaults to on.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_EARLY_EXIT 1","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_DISCARD","    //","    // Only valid for PC OpenGL currently.","    // Probably will not work when FXAA_GREEN_AS_LUMA = 1.","    //","    // 1 = Use discard on pixels which don't need AA.","    //     For APIs which enable concurrent TEX+ROP from same surface.","    // 0 = Return unchanged color on pixels which don't need AA.","    //","    #define FXAA_DISCARD 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_FAST_PIXEL_OFFSET","    //","    // Used for GLSL 120 only.","    //","    // 1 = GL API supports fast pixel offsets","    // 0 = do not use fast pixel offsets","    //","    #ifdef GL_EXT_gpu_shader4","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifndef FXAA_FAST_PIXEL_OFFSET","        #define FXAA_FAST_PIXEL_OFFSET 0","    #endif","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GATHER4_ALPHA","    //","    // 1 = API supports gather4 on alpha channel.","    // 0 = API does not support gather4 on alpha channel.","    //","    #if (FXAA_HLSL_5 == 1)","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifndef FXAA_GATHER4_ALPHA","        #define FXAA_GATHER4_ALPHA 0","    #endif","#endif","","","/*============================================================================","                        FXAA QUALITY - TUNING KNOBS","------------------------------------------------------------------------------","NOTE the other tuning knobs are now in the shader function inputs!","============================================================================*/","#ifndef FXAA_QUALITY_PRESET","    //","    // Choose the quality preset.","    // This needs to be compiled into the shader as it effects code.","    // Best option to include multiple presets is to","    // in each shader define the preset, then include this file.","    //","    // OPTIONS","    // -----------------------------------------------------------------------","    // 10 to 15 - default medium dither (10=fastest, 15=highest quality)","    // 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)","    // 39       - no dither, very expensive","    //","    // NOTES","    // -----------------------------------------------------------------------","    // 12 = slightly faster then FXAA 3.9 and higher edge quality (default)","    // 13 = about same speed as FXAA 3.9 and better than 12","    // 23 = closest to FXAA 3.9 visually and performance wise","    //  _ = the lowest digit is directly related to performance","    // _  = the highest digit is directly related to style","    //","    #define FXAA_QUALITY_PRESET 12","#endif","","","/*============================================================================","","                           FXAA QUALITY - PRESETS","","============================================================================*/","","/*============================================================================","                     FXAA QUALITY - MEDIUM DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 10)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 3.0","    #define FXAA_QUALITY_P2 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 11)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 3.0","    #define FXAA_QUALITY_P3 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 12)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 4.0","    #define FXAA_QUALITY_P4 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 13)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 4.0","    #define FXAA_QUALITY_P5 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 14)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 4.0","    #define FXAA_QUALITY_P6 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 15)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 12.0","#endif","","/*============================================================================","                     FXAA QUALITY - LOW DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 20)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 2.0","    #define FXAA_QUALITY_P2 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 21)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 22)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 23)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 24)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 3.0","    #define FXAA_QUALITY_P6 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 25)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 26)","    #define FXAA_QUALITY_PS 9","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 4.0","    #define FXAA_QUALITY_P8 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 27)","    #define FXAA_QUALITY_PS 10","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 4.0","    #define FXAA_QUALITY_P9 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 28)","    #define FXAA_QUALITY_PS 11","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 4.0","    #define FXAA_QUALITY_P10 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 29)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","/*============================================================================","                     FXAA QUALITY - EXTREME QUALITY","============================================================================*/","#if (FXAA_QUALITY_PRESET == 39)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.0","    #define FXAA_QUALITY_P2 1.0","    #define FXAA_QUALITY_P3 1.0","    #define FXAA_QUALITY_P4 1.0","    #define FXAA_QUALITY_P5 1.5","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","","","/*============================================================================","","                                API PORTING","","============================================================================*/","#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)","    #define FxaaBool bool","    #define FxaaDiscard discard","    #define FxaaFloat float","    #define FxaaFloat2 vec2","    #define FxaaFloat3 vec3","    #define FxaaFloat4 vec4","    #define FxaaHalf float","    #define FxaaHalf2 vec2","    #define FxaaHalf3 vec3","    #define FxaaHalf4 vec4","    #define FxaaInt2 ivec2","    #define FxaaSat(x) clamp(x, 0.0, 1.0)","    #define FxaaTex sampler2D","#else","    #define FxaaBool bool","    #define FxaaDiscard clip(-1)","    #define FxaaFloat float","    #define FxaaFloat2 float2","    #define FxaaFloat3 float3","    #define FxaaFloat4 float4","    #define FxaaHalf half","    #define FxaaHalf2 half2","    #define FxaaHalf3 half3","    #define FxaaHalf4 half4","    #define FxaaSat(x) saturate(x)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_100 == 1)","  #define FxaaTexTop(t, p) texture2D(t, p, 0.0)","  #define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_120 == 1)","    // Requires,","    //  #version 120","    // And at least,","    //  #extension GL_EXT_gpu_shader4 : enable","    //  (or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)","    #define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)","    #if (FXAA_FAST_PIXEL_OFFSET == 1)","        #define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)","    #else","        #define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)","    #endif","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_130 == 1)",'    // Requires "#version 130" or better',"    #define FxaaTexTop(t, p) textureLod(t, p, 0.0)","    #define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_3 == 1)","    #define FxaaInt2 float2","    #define FxaaTex sampler2D","    #define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))","    #define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_4 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_5 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","    #define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)","    #define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)","    #define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)","    #define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)","#endif","","","/*============================================================================","                   GREEN AS LUMA OPTION SUPPORT FUNCTION","============================================================================*/","#if (FXAA_GREEN_AS_LUMA == 0)","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }","#else","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }","#endif","","","","","/*============================================================================","","                             FXAA3 QUALITY - PC","","============================================================================*/","#if (FXAA_PC == 1)","/*--------------------------------------------------------------------------*/","FxaaFloat4 FxaaPixelShader(","    //","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy} = center of pixel","    FxaaFloat2 pos,","    //","    // Used only for FXAA Console, and not used on the 360 version.","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy_} = upper left of pixel","    // {_zw} = lower right of pixel","    FxaaFloat4 fxaaConsolePosPos,","    //","    // Input color texture.","    // {rgb_} = color in linear or perceptual color space","    // if (FXAA_GREEN_AS_LUMA == 0)","    //     {__a} = luma in perceptual color space (not linear)","    FxaaTex tex,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 2nd sampler.","    // This sampler needs to have an exponent bias of -1.","    FxaaTex fxaaConsole360TexExpBiasNegOne,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 3nd sampler.","    // This sampler needs to have an exponent bias of -2.","    FxaaTex fxaaConsole360TexExpBiasNegTwo,","    //","    // Only used on FXAA Quality.","    // This must be from a constant/uniform.","    // {x_} = 1.0/screenWidthInPixels","    // {_y} = 1.0/screenHeightInPixels","    FxaaFloat2 fxaaQualityRcpFrame,","    //","    // Only used on FXAA Console.","    // This must be from a constant/uniform.","    // This effects sub-pixel AA quality and inversely sharpness.","    //   Where N ranges between,","    //     N = 0.50 (default)","    //     N = 0.33 (sharper)","    // {x__} = -N/screenWidthInPixels","    // {_y_} = -N/screenHeightInPixels","    // {_z_} =  N/screenWidthInPixels","    // {__w} =  N/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt,","    //","    // Only used on FXAA Console.","    // Not used on 360, but used on PS3 and PC.","    // This must be from a constant/uniform.","    // {x__} = -2.0/screenWidthInPixels","    // {_y_} = -2.0/screenHeightInPixels","    // {_z_} =  2.0/screenWidthInPixels","    // {__w} =  2.0/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt2,","    //","    // Only used on FXAA Console.","    // Only used on 360 in place of fxaaConsoleRcpFrameOpt2.","    // This must be from a constant/uniform.","    // {x__} =  8.0/screenWidthInPixels","    // {_y_} =  8.0/screenHeightInPixels","    // {_z_} = -4.0/screenWidthInPixels","    // {__w} = -4.0/screenHeightInPixels","    FxaaFloat4 fxaaConsole360RcpFrameOpt2,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_SUBPIX define.","    // It is here now to allow easier tuning.","    // Choose the amount of sub-pixel aliasing removal.","    // This can effect sharpness.","    //   1.00 - upper limit (softer)","    //   0.75 - default amount of filtering","    //   0.50 - lower limit (sharper, less sub-pixel aliasing removal)","    //   0.25 - almost off","    //   0.00 - completely off","    FxaaFloat fxaaQualitySubpix,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // The minimum amount of local contrast required to apply algorithm.","    //   0.333 - too little (faster)","    //   0.250 - low quality","    //   0.166 - default","    //   0.125 - high quality","    //   0.063 - overkill (slower)","    FxaaFloat fxaaQualityEdgeThreshold,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    //   0.0833 - upper limit (default, the start of visible unfiltered edges)","    //   0.0625 - high quality (faster)","    //   0.0312 - visible limit (slower)","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaQualityEdgeThresholdMin,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only three safe values here: 2 and 4 and 8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // For all other platforms can be a non-power of two.","    //   8.0 is sharper (default!!!)","    //   4.0 is softer","    //   2.0 is really soft (good only for vector graphics inputs)","    FxaaFloat fxaaConsoleEdgeSharpness,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only two safe values here: 1/4 and 1/8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // The console setting has a different mapping than the quality setting.","    // Other platforms can use other values.","    //   0.125 leaves less aliasing, but is softer (default!!!)","    //   0.25 leaves more aliasing, and is sharper","    FxaaFloat fxaaConsoleEdgeThreshold,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    // The console setting has a different mapping than the quality setting.","    // This only applies when FXAA_EARLY_EXIT is 1.","    // This does not apply to PS3,","    // PS3 was simplified to avoid more shader instructions.","    //   0.06 - faster but more aliasing in darks","    //   0.05 - default","    //   0.04 - slower and less aliasing in darks","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaConsoleEdgeThresholdMin,","    //","    // Extra constants for 360 FXAA Console only.","    // Use zeros or anything else for other platforms.","    // These must be in physical constant registers and NOT immedates.","    // Immedates will result in compiler un-optimizing.","    // {xyzw} = float4(1.0, -1.0, 0.25, -0.25)","    FxaaFloat4 fxaaConsole360ConstDir",") {","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posM;","    posM.x = pos.x;","    posM.y = pos.y;","    #if (FXAA_GATHER4_ALPHA == 1)","        #if (FXAA_DISCARD == 0)","            FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","            #if (FXAA_GREEN_AS_LUMA == 0)","                #define lumaM rgbyM.w","            #else","                #define lumaM rgbyM.y","            #endif","        #endif","        #if (FXAA_GREEN_AS_LUMA == 0)","            FxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));","        #else","            FxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));","        #endif","        #if (FXAA_DISCARD == 1)","            #define lumaM luma4A.w","        #endif","        #define lumaE luma4A.z","        #define lumaS luma4A.x","        #define lumaSE luma4A.y","        #define lumaNW luma4B.w","        #define lumaN luma4B.z","        #define lumaW luma4B.x","    #else","        FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","        #if (FXAA_GREEN_AS_LUMA == 0)","            #define lumaM rgbyM.w","        #else","            #define lumaM rgbyM.y","        #endif","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));","        #endif","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat maxSM = max(lumaS, lumaM);","    FxaaFloat minSM = min(lumaS, lumaM);","    FxaaFloat maxESM = max(lumaE, maxSM);","    FxaaFloat minESM = min(lumaE, minSM);","    FxaaFloat maxWN = max(lumaN, lumaW);","    FxaaFloat minWN = min(lumaN, lumaW);","    FxaaFloat rangeMax = max(maxWN, maxESM);","    FxaaFloat rangeMin = min(minWN, minESM);","    FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;","    FxaaFloat range = rangeMax - rangeMin;","    FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);","    FxaaBool earlyExit = range < rangeMaxClamped;","/*--------------------------------------------------------------------------*/","    if(earlyExit)","        #if (FXAA_DISCARD == 1)","            FxaaDiscard;","        #else","            return rgbyM;","        #endif","/*--------------------------------------------------------------------------*/","    #if (FXAA_GATHER4_ALPHA == 0)","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","        #endif","    #else","        FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));","        FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNS = lumaN + lumaS;","    FxaaFloat lumaWE = lumaW + lumaE;","    FxaaFloat subpixRcpRange = 1.0/range;","    FxaaFloat subpixNSWE = lumaNS + lumaWE;","    FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;","    FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNESE = lumaNE + lumaSE;","    FxaaFloat lumaNWNE = lumaNW + lumaNE;","    FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;","    FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNWSW = lumaNW + lumaSW;","    FxaaFloat lumaSWSE = lumaSW + lumaSE;","    FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);","    FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);","    FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;","    FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;","    FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;","    FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;","/*--------------------------------------------------------------------------*/","    FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;","    FxaaFloat lengthSign = fxaaQualityRcpFrame.x;","    FxaaBool horzSpan = edgeHorz >= edgeVert;","    FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;","/*--------------------------------------------------------------------------*/","    if(!horzSpan) lumaN = lumaW;","    if(!horzSpan) lumaS = lumaE;","    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;","    FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;","/*--------------------------------------------------------------------------*/","    FxaaFloat gradientN = lumaN - lumaM;","    FxaaFloat gradientS = lumaS - lumaM;","    FxaaFloat lumaNN = lumaN + lumaM;","    FxaaFloat lumaSS = lumaS + lumaM;","    FxaaBool pairN = abs(gradientN) >= abs(gradientS);","    FxaaFloat gradient = max(abs(gradientN), abs(gradientS));","    if(pairN) lengthSign = -lengthSign;","    FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posB;","    posB.x = posM.x;","    posB.y = posM.y;","    FxaaFloat2 offNP;","    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;","    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;","    if(!horzSpan) posB.x += lengthSign * 0.5;","    if( horzSpan) posB.y += lengthSign * 0.5;","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posN;","    posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;","    posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;","    FxaaFloat2 posP;","    posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;","    posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;","    FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;","    FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));","    FxaaFloat subpixE = subpixC * subpixC;","    FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));","/*--------------------------------------------------------------------------*/","    if(!pairN) lumaNN = lumaSS;","    FxaaFloat gradientScaled = gradient * 1.0/4.0;","    FxaaFloat lumaMM = lumaM - lumaNN * 0.5;","    FxaaFloat subpixF = subpixD * subpixE;","    FxaaBool lumaMLTZero = lumaMM < 0.0;","/*--------------------------------------------------------------------------*/","    lumaEndN -= lumaNN * 0.5;","    lumaEndP -= lumaNN * 0.5;","    FxaaBool doneN = abs(lumaEndN) >= gradientScaled;","    FxaaBool doneP = abs(lumaEndP) >= gradientScaled;","    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;","    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;","    FxaaBool doneNP = (!doneN) || (!doneP);","    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;","    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;","/*--------------------------------------------------------------------------*/","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 3)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 4)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 5)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 6)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;","/*--------------------------------------------------------------------------*/","                        #if (FXAA_QUALITY_PS > 7)","                        if(doneNP) {","                            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                            doneN = abs(lumaEndN) >= gradientScaled;","                            doneP = abs(lumaEndP) >= gradientScaled;","                            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;","                            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;","                            doneNP = (!doneN) || (!doneP);","                            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;","                            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;","/*--------------------------------------------------------------------------*/","    #if (FXAA_QUALITY_PS > 8)","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 9)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 10)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 11)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 12)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","    #endif","/*--------------------------------------------------------------------------*/","                        }","                        #endif","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","/*--------------------------------------------------------------------------*/","    FxaaFloat dstN = posM.x - posN.x;","    FxaaFloat dstP = posP.x - posM.x;","    if(!horzSpan) dstN = posM.y - posN.y;","    if(!horzSpan) dstP = posP.y - posM.y;","/*--------------------------------------------------------------------------*/","    FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;","    FxaaFloat spanLength = (dstP + dstN);","    FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;","    FxaaFloat spanLengthRcp = 1.0/spanLength;","/*--------------------------------------------------------------------------*/","    FxaaBool directionN = dstN < dstP;","    FxaaFloat dst = min(dstN, dstP);","    FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;","    FxaaFloat subpixG = subpixF * subpixF;","    FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;","    FxaaFloat subpixH = subpixG * fxaaQualitySubpix;","/*--------------------------------------------------------------------------*/","    FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;","    FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);","    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;","    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;","    #if (FXAA_DISCARD == 1)","        return FxaaTexTop(tex, posM);","    #else","        return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);","    #endif","}","/*==========================================================================*/","#endif","","void main() {","  gl_FragColor = FxaaPixelShader(","    vUv,","    vec4(0.0),","    tDiffuse,","    tDiffuse,","    tDiffuse,","    resolution,","    vec4(0.0),","    vec4(0.0),","    vec4(0.0),","    0.75,","    0.166,","    0.0833,","    0.0,","    0.0,","    0.0,","    vec4(0.0)","  );","","  // TODO avoid querying texture twice for same texel","  gl_FragColor.a = texture2D(tDiffuse, vUv).a;","}"].join("\n")},ot=new THREE.OrthographicCamera(-1,1,1,-1,0,1),at=new THREE.Scene,st=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null);st.frustumCulled=!1,at.add(st);var lt=new THREE.Color,ct=function(){function e(t,i,n,o){r(this,e),this.clear=!0,this.clearColor=new THREE.Color(0,0,0),this.clearAlpha=1,this.textureID=void 0!==i?i:"tDiffuse",this.resolutionID=void 0!==n?n:"resolution",this.resolutionScaler=void 0!==o?o:1,t instanceof THREE.ShaderMaterial?(this.uniforms=t.uniforms,this.material=t):t&&(this.uniforms=THREE.UniformsUtils.clone(t.uniforms),this.material=new THREE.ShaderMaterial({defines:Object.assign({},t.defines),uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader}))}return e.prototype.setSize=function(e,t){this.uniforms[this.resolutionID]&&this.uniforms[this.resolutionID].value.set(this.resolutionScaler/e,this.resolutionScaler/t)},e.prototype.render=function(e,t,i,r,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i.texture);var o=e.getClearAlpha(),a=e.autoClear;e.autoClear=!1,this.clear&&(lt.copy(e.getClearColor()),e.setClearColor(this.clearColor,this.clearAlpha)),st.material=this.material,e.render(at,ot,t,this.clear),this.clear&&e.setClearColor(lt,o),e.autoClear=a},e}(),ut=0;function ht(e,t){this.id=++ut,this._renderTarget=new THREE.WebGLRenderTarget(e,t,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat,type:THREE.HalfFloat}),this._renderTarget.depthTexture=new THREE.DepthTexture(e,t),this._renderTarget.depthTexture.format=THREE.DepthStencilFormat,this._renderTarget.depthTexture.type=THREE.UnsignedInt248Type,this._normalMaterial=new THREE.MeshNormalMaterial,this.ignoreTransparent=!0}ht.prototype=Object.assign(ht.prototype,{setSize:function(e,t){this._renderTarget.setSize(e,t)},render:function(e,t,i,r){if(!e.materialManager.hasStrategy("NormalDepthPrePass"+this.id)){var n=this;e.materialManager.addStrategy("NormalDepthPrePass"+this.id,function(e,t,i,r,o,a){return n.ignoreTransparent&&o.transparent?null:n.ignoreTransparent&&0<o.alphaTest?null:n._normalMaterial})}this.ignoreTransparent=r;var o=e.getClearColor().getHex(),a=e.getClearAlpha();e.setClearColor(7829503,1),e.materialManager.setMode("NormalDepthPrePass"+this.id);var s=t.autoUpdate,l=t.background,c=e.shadowMap.enable;t.autoUpdate=!1,t.background=null,e.shadowMap.enable=!1,e.render(t,i,this._renderTarget,!0),t.autoUpdate=s,t.background=l,e.shadowMap.enable=c,e.materialManager.setMode(0),e.setClearColor(o,a)},getNormalTexture:function(){return this._renderTarget.texture},getDepthTexture:function(){return this._renderTarget.depthTexture}});var pt={defines:{DEPTH_PACKING:1,KERNEL_SIZE:64,EPSILON:1e-6},uniforms:{normalTex:{value:null},depthTex:{value:null},noiseTex:{value:null},texSize:{value:new THREE.Vector2},noiseTexSize:{value:new THREE.Vector2(4,4)},projection:{value:new THREE.Matrix4},projectionInv:{value:new THREE.Matrix4},kernel:{value:null},radius:{value:.2},power:{value:1},bias:{value:.004},intensity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["precision highp sampler2D;","#include <packing>","varying vec2 vUv;","uniform sampler2D normalTex;","uniform sampler2D depthTex;","uniform vec2 texSize;","uniform sampler2D noiseTex;","uniform vec2 noiseTexSize;","uniform mat4 projection;","uniform mat4 projectionInv;","uniform vec3 kernel[KERNEL_SIZE];","uniform float radius;","uniform float power;","uniform float bias;","uniform float intensity;","float getDepth( const in vec2 screenPosition ) {","#if DEPTH_PACKING == 1","return unpackRGBAToDepth( texture2D( depthTex, screenPosition ) );","#elif DEPTH_PACKING == 2","return texture2D( depthTex, screenPosition ).w;","#else","return texture2D( depthTex, screenPosition ).x;","#endif","}","vec3 getViewNormal( const in vec2 screenPosition ) {","return unpackRGBToNormal( texture2D( normalTex, screenPosition ).xyz );","}","float ssaoEstimator(in mat3 kernelBasis, in vec3 originPos, in vec3 N) {","float occlusion = 0.0;","for (int i = 0; i < KERNEL_SIZE; i++) {","vec3 samplePos = kernel[i];","samplePos = kernelBasis * samplePos;","samplePos = samplePos * radius + originPos;","vec4 texCoord = projection * vec4(samplePos, 1.0);","texCoord.xy /= texCoord.w;","texCoord.xy = texCoord.xy * 0.5 + 0.5;","float sampleDepth = getDepth(texCoord.xy);","float z = sampleDepth * 2.0 - 1.0;","#ifdef ALCHEMY","vec4 projectedPos = vec4(texCoord.xy * 2.0 - 1.0, z, 1.0);","vec4 p4 = projectionInv * projectedPos;","p4.xyz /= p4.w;","vec3 cDir = p4.xyz - originPos;","float vv = dot(cDir, cDir);","float vn = dot(cDir, N);","float radius2 = radius * radius;","vn = max(vn + p4.z * bias, 0.0);","float f = max(radius2 - vv, 0.0) / radius2;","occlusion += f * f * f * max(vn / (0.01 + vv), 0.0);","#else","if (projection[3][3] == 0.0) {","z = projection[3][2] / (z * projection[2][3] - projection[2][2]);","} else {","z = (z - projection[3][2]) / projection[2][2];","}","float factor = step(samplePos.z, z - bias);","float rangeCheck = smoothstep(0.0, 1.0, radius / abs(originPos.z - z));","occlusion += rangeCheck * factor;","#endif","}","occlusion = 1.0 - occlusion / float(KERNEL_SIZE);","return pow(occlusion, power);","}","void main() {","float centerDepth = getDepth( vUv );","if( centerDepth >= ( 1.0 - EPSILON ) ) {","\tdiscard;","}","vec3 N = getViewNormal( vUv );","vec2 noiseTexCoord = texSize / vec2(noiseTexSize) * vUv;","vec3 rvec = texture2D(noiseTex, noiseTexCoord).rgb * 2.0 - 1.0;","vec3 T = normalize(rvec - N * dot(rvec, N));","vec3 BT = normalize(cross(N, T));","mat3 kernelBasis = mat3(T, BT, N);","float z = centerDepth * 2.0 - 1.0;","vec4 projectedPos = vec4(vUv * 2.0 - 1.0, z, 1.0);","vec4 p4 = projectionInv * projectedPos;","vec3 position = p4.xyz / p4.w;","float ao = ssaoEstimator(kernelBasis, position, N);","ao = clamp(1.0 - (1.0 - ao) * intensity, 0.0, 1.0);","gl_FragColor = vec4(vec3(ao), 1.0);","}"].join("\n")};function dt(e){for(var t=new Uint8Array(e*e*4),i=0,r=new THREE.Vector3,n=0;n<e;n++)for(var o=0;o<e;o++)r.set(2*Math.random()-1,2*Math.random()-1,0).normalize(),t[i++]=255*(.5*r.x+.5),t[i++]=255*(.5*r.y+.5),t[i++]=0,t[i++]=255;return t}function ft(e,t){for(var i=0,r=1/t,n=e;0<n;)i+=r*(n%t),n=Math.floor(n/t),r/=t;return i}function mt(e,t){this._tempRenderTarget=new THREE.WebGLRenderTarget(e,t,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),this._tempRenderTarget2=new THREE.WebGLRenderTarget(e,t,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),this.ssaoMaterial=new THREE.ShaderMaterial({defines:Object.assign({},pt.defines),fragmentShader:pt.fragmentShader,vertexShader:pt.vertexShader,uniforms:THREE.UniformsUtils.clone(pt.uniforms),depthTest:!1,depthWrite:!1}),this.blurMaterial=new THREE.ShaderMaterial({defines:Object.assign({},THREE.SuperSSAOBlurShader.defines),fragmentShader:THREE.SuperSSAOBlurShader.fragmentShader,vertexShader:THREE.SuperSSAOBlurShader.vertexShader,uniforms:THREE.UniformsUtils.clone(THREE.SuperSSAOBlurShader.uniforms),depthTest:!1,depthWrite:!1,transparent:!0,blending:THREE.CustomBlending,blendSrc:THREE.ZeroFactor,blendDst:THREE.SrcColorFactor,blendEquation:THREE.AddEquation,blendSrcAlpha:THREE.ZeroFactor,blendDstAlpha:THREE.SrcColorFactor,blendEquationAlpha:THREE.AddEquation}),this.quadCamera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.quadScene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneGeometry(2,2),null),this.quadScene.add(this.quadCamera),this.quadScene.add(this.quad),this._kernels={},this.setNoiseSize(4),this.setKernelSize(12),this.setParameter("radius",.2),this.setParameter("bias",.004),this.setParameter("power",1),this.setParameter("intensity",.8),this.ssaoMaterial.uniforms.texSize.value.set(e,t),this.blurMaterial.uniforms.textureSize.value.set(e,t)}THREE.SuperSSAOBlurShader={defines:{NORMALTEX_ENABLED:1,DEPTHTEX_ENABLED:1,DEPTH_PACKING:1},uniforms:{tDiffuse:{value:null},textureSize:{value:new THREE.Vector2},direction:{value:0},blurSize:{value:1},depthTex:{value:null},normalTex:{value:null},projection:{value:new THREE.Matrix4},depthRange:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <packing>","varying vec2 vUv;","uniform vec2 textureSize;","uniform float blurSize;","uniform sampler2D tDiffuse;","uniform int direction;","#if NORMALTEX_ENABLED == 1","uniform sampler2D normalTex;","vec3 getViewNormal( const in vec2 screenPosition ) {","return unpackRGBToNormal( texture2D( normalTex, screenPosition ).xyz );","}","#endif","#if DEPTHTEX_ENABLED == 1","uniform sampler2D depthTex;","uniform mat4 projection;","uniform float depthRange;","float getDepth( const in vec2 screenPosition ) {","#if DEPTH_PACKING == 1","return unpackRGBAToDepth( texture2D( depthTex, screenPosition ) );","#elif DEPTH_PACKING == 2","return texture2D( depthTex, screenPosition ).w;","#else","return texture2D( depthTex, screenPosition ).x;","#endif","}","float getLinearDepth(vec2 coord) {","float depth = getDepth(coord) * 2.0 - 1.0;","return projection[3][2] / (depth * projection[2][3] - projection[2][2]);","}","#endif","void main() {","float kernel[5];","kernel[0] = 0.122581;","kernel[1] = 0.233062;","kernel[2] = 0.288713;","kernel[3] = 0.233062;","kernel[4] = 0.122581;","vec2 off = vec2(0.0);","if (direction == 0) {","off[0] = blurSize / textureSize.x;","}","else {","off[1] = blurSize / textureSize.y;","}","float sum = 0.0;","float weightAll = 0.0;","#if NORMALTEX_ENABLED == 1","vec3 centerNormal = getViewNormal(vUv);","#endif","#if DEPTHTEX_ENABLED == 1","float centerDepth = getLinearDepth(vUv);","#endif","for (int i = 0; i < 5; i++) {","vec2 coord = clamp(vUv + vec2(float(i) - 2.0) * off, vec2(0.0), vec2(1.0));","float w = kernel[i];","#if NORMALTEX_ENABLED == 1","vec3 normal = getViewNormal(coord);","w *= clamp(dot(normal, centerNormal), 0.0, 1.0);","#endif","#if DEPTHTEX_ENABLED == 1","float d = getLinearDepth(coord);","w *= (1.0 - smoothstep(0.0, 1.0, abs(centerDepth - d) / depthRange));","#endif","weightAll += w;","sum += w * texture2D(tDiffuse, coord).r;","}","gl_FragColor = vec4(vec3(sum / weightAll), 1.0);","}"].join("\n")},mt.prototype=Object.assign(mt.prototype,{constructor:mt,setSize:function(e,t){this._tempRenderTarget.setSize(e,t),this._tempRenderTarget2.setSize(e,t),this.ssaoMaterial.uniforms.texSize.value.set(e,t),this.blurMaterial.uniforms.textureSize.value.set(e,t)},render:function(e,t,i,r,n,o){this.ssaoMaterial.uniforms.normalTex.value=e,this.ssaoMaterial.uniforms.depthTex.value=t,this.ssaoMaterial.uniforms.projection.value.copy(r.projectionMatrix),this.ssaoMaterial.uniforms.projectionInv.value.getInverse(r.projectionMatrix),this.blurMaterial.uniforms.normalTex.value=e,this.blurMaterial.uniforms.depthTex.value=t,this.blurMaterial.uniforms.projection.value.copy(r.projectionMatrix),t===e?(this.ssaoMaterial.defines.DEPTH_PACKING=2,this.blurMaterial.defines.DEPTH_PACKING=2):t.isDepthTexture?(this.ssaoMaterial.defines.DEPTH_PACKING=0,this.blurMaterial.defines.DEPTH_PACKING=0):(this.ssaoMaterial.defines.DEPTH_PACKING=1,this.blurMaterial.defines.DEPTH_PACKING=1);var a=i.getClearColor().getHex(),s=i.getClearAlpha(),l=i.autoClear;i.autoClear=!1,this.quad.material=this.ssaoMaterial,i.setClearColor(16777215,1),i.render(this.quadScene,this.quadCamera,this._tempRenderTarget,!0),this.quad.material=this.blurMaterial,this.blurMaterial.uniforms.tDiffuse.value=this._tempRenderTarget.texture,this.blurMaterial.uniforms.direction.value=0,this.blurMaterial.uniforms.blurSize.value=1,this.blurMaterial.transparent=!1,i.setClearColor(16777215,1),i.render(this.quadScene,this.quadCamera,this._tempRenderTarget2,!0),this.blurMaterial.uniforms.tDiffuse.value=this._tempRenderTarget2.texture,this.blurMaterial.uniforms.direction.value=1,this.blurMaterial.uniforms.blurSize.value=1,this.blurMaterial.transparent=!o,this.blurMaterial.blending=o?THREE.NoBlending:THREE.CustomBlending,o&&i.setClearColor(0,0),i.render(this.quadScene,this.quadCamera,n,o),i.setClearColor(a,s),i.autoClear=l},setKernelSize:function(e,t){t=void 0!==t?t:0,this._kernels[e+"_"+t]||(this._kernels[e+"_"+t]=function(e,t,i){var r=new Float32Array(3*e);t=t||0;for(var n=0;n<e;n++){var o=1*ft(n+t,2)*Math.PI,a=ft(n+t,3)*Math.PI,s=Math.random(),l=Math.cos(o)*Math.sin(a)*s,c=Math.cos(a)*s,u=Math.sin(o)*Math.sin(a)*s;r[3*n]=l,r[3*n+1]=c,r[3*n+2]=u}return r}(e,e*t)),this.ssaoMaterial.defines.KERNEL_SIZE=e,this.ssaoMaterial.uniforms.kernel.value=this._kernels[e+"_"+t]},setNoiseSize:function(e){var t,i,r=this.ssaoMaterial.uniforms.noiseTex.value;r?(r.image.data=dt(e),r.image.width=e,r.image.height=e,r.needsUpdate=!0):(t=e,(i=new THREE.DataTexture(dt(t),t,t,THREE.RGBAFormat,THREE.UnsignedByteType,THREE.UVMapping,THREE.RepeatWrapping,THREE.RepeatWrapping)).needsUpdate=!0,r=i,this.ssaoMaterial.uniforms.noiseTex.value=r),this.ssaoMaterial.uniforms.noiseTexSize.value.set(e,e)},setParameter:function(e,t){"noiseTexSize"===e?this.setNoiseSize(t):"kernelSize"===e?this.setKernelSize(t):"blurSize"===e?this.blurMaterial.uniforms.blurSize.value=1:this.ssaoMaterial.uniforms[e].value=t}});var gt={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{type:"t",value:null},luminosityThreshold:{type:"f",value:1},smoothWidth:{type:"f",value:1},defaultColor:{type:"c",value:new THREE.Color(0)},defaultOpacity:{type:"f",value:0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec3 defaultColor;","uniform float defaultOpacity;","uniform float luminosityThreshold;","uniform float smoothWidth;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float v = dot( texel.xyz, luma );","vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );","float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );","gl_FragColor = mix( outputColor, texel, alpha );","}"].join("\n")};function vt(e,t,i,r){this.renderToScreen=!1,this.strength=void 0!==t?t:1,this.radius=i,this.threshold=r,this.resolution=void 0!==e?new THREE.Vector2(e.x,e.y):new THREE.Vector2(256,256),this.clearColor=new THREE.Color(0,0,0);var n={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat};this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;var o=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2);this.renderTargetBright=new THREE.WebGLRenderTarget(o,a,n),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(var s=0;s<this.nMips;s++){var l=new THREE.WebGLRenderTarget(o,a,n);l.texture.name="UnrealBloomPass.h"+s,l.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(l);var c=new THREE.WebGLRenderTarget(o,a,n);c.texture.name="UnrealBloomPass.v"+s,c.texture.generateMipmaps=!1,this.renderTargetsVertical.push(c),o=Math.round(o/2),a=Math.round(a/2)}this.highPassUniforms=THREE.UniformsUtils.clone(gt.uniforms),this.highPassUniforms.luminosityThreshold.value=r,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new THREE.ShaderMaterial({uniforms:this.highPassUniforms,vertexShader:gt.vertexShader,fragmentShader:gt.fragmentShader,defines:{}}),this.separableBlurMaterials=[];var u=[3,5,7,9,11];for(o=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2),s=0;s<this.nMips;s++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(u[s])),this.separableBlurMaterials[s].uniforms.texSize.value=new THREE.Vector2(o,a),o=Math.round(o/2),a=Math.round(a/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0,this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,this.copyUniforms=THREE.UniformsUtils.clone(rt.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new THREE.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:rt.vertexShader,fragmentShader:rt.fragmentShader,blending:THREE.CustomBlending,blendSrc:THREE.SrcAlphaFactor,blendDst:THREE.OneFactor,blendEquation:THREE.AddEquation,blendSrcAlpha:THREE.ZeroFactor,blendDstAlpha:THREE.OneFactor,blendEquationAlpha:THREE.AddEquation,depthTest:!1,depthWrite:!1,transparent:!0}),this.oldClearColor=new THREE.Color,this.oldClearAlpha=1,this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.basic=new THREE.MeshBasicMaterial,this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)}Object.assign(vt.prototype,{dispose:function(){for(var e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose()},setSize:function(e,t){var i=Math.round(e/2),r=Math.round(t/2);this.renderTargetBright.setSize(i,r);for(var n=0;n<this.nMips;n++)this.renderTargetsHorizontal[n].setSize(i,r),this.renderTargetsVertical[n].setSize(i,r),this.separableBlurMaterials[n].uniforms.texSize.value=new THREE.Vector2(i,r),i=Math.round(i/2),r=Math.round(r/2)},render:function(e,t,i,r,n){this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha();var o=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),n&&e.context.disable(e.context.STENCIL_TEST),this.renderToScreen&&(this.quad.material=this.basic,this.basic.map=i.texture,e.render(this.scene,this.camera,void 0,!0)),this.highPassUniforms.tDiffuse.value=i.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.quad.material=this.materialHighPassFilter,e.render(this.scene,this.camera,this.renderTargetBright,!0);for(var a=this.renderTargetBright,s=0;s<this.nMips;s++)this.quad.material=this.separableBlurMaterials[s],this.separableBlurMaterials[s].uniforms.colorTexture.value=a.texture,this.separableBlurMaterials[s].uniforms.direction.value=vt.BlurDirectionX,e.render(this.scene,this.camera,this.renderTargetsHorizontal[s],!0),this.separableBlurMaterials[s].uniforms.colorTexture.value=this.renderTargetsHorizontal[s].texture,this.separableBlurMaterials[s].uniforms.direction.value=vt.BlurDirectionY,e.render(this.scene,this.camera,this.renderTargetsVertical[s],!0),a=this.renderTargetsVertical[s];this.quad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.render(this.scene,this.camera,this.renderTargetsHorizontal[0],!0),this.quad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,n&&e.context.enable(e.context.STENCIL_TEST),this.renderToScreen?e.render(this.scene,this.camera,void 0,!1):e.render(this.scene,this.camera,i,!1),e.setClearColor(this.oldClearColor,this.oldClearAlpha),e.autoClear=o},getSeperableBlurMaterial:function(e){return new THREE.ShaderMaterial({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},direction:{value:new THREE.Vector2(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat fSigma = float(SIGMA);\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, fSigma);\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\t\t\t\t\t\tfloat x = float(i);\t\t\t\t\t\tfloat w = gaussianPdf(x, fSigma);\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\t\t\t\t\t\tweightSum += 2.0 * w;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})},getCompositeMaterial:function(e){return new THREE.ShaderMaterial({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D blurTexture1;\t\t\t\tuniform sampler2D blurTexture2;\t\t\t\tuniform sampler2D blurTexture3;\t\t\t\tuniform sampler2D blurTexture4;\t\t\t\tuniform sampler2D blurTexture5;\t\t\t\tuniform sampler2D dirtTexture;\t\t\t\tuniform float bloomStrength;\t\t\t\tuniform float bloomRadius;\t\t\t\tuniform float bloomFactors[NUM_MIPS];\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\t\t\t\t\t\t\t\tfloat lerpBloomFactor(const in float factor) { \t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\t\t\t\t}\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\t\t\t\t}"})}}),vt.BlurDirectionX=new THREE.Vector2(1,0),vt.BlurDirectionY=new THREE.Vector2(0,1);var yt={vertexShader:"#include <skinning_pars_vertex>\n    void main() {\n        #include <skinbase_vertex>\n        #include <begin_vertex>\n        #include <skinning_vertex>\n        #include <project_vertex>\n    }",fragmentShader:"void main() {        gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);    }"};function bt(e,t,i,r){vt.call(this,e,t,i,r),this.prepareMaskMaterial=new THREE.ShaderMaterial(yt),this.prepareMaskSkinningMaterial=new THREE.ShaderMaterial(yt),this.prepareMaskSkinningMaterial.skinning=!0;var n={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat},o=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2);this.renderTargetTemp=new THREE.WebGLMultisampleRenderTarget(o,a,n),this.renderTargetTemp.samples=5,this.renderTargetTemp.texture.name="UnrealGlowPass.temp",this.renderTargetTemp.texture.generateMipmaps=!1,this.renderTargetTemp2=new THREE.WebGLRenderTarget(o,a,n),this.renderTargetTemp2.texture.name="UnrealGlowPass.temp2",this.renderTargetTemp2.texture.generateMipmaps=!1,this._dirty=!0,this.enable=!1}bt.prototype=Object.assign(Object.create(vt.prototype),{constructor:bt,dispose:function(){vt.prototype.dispose.call(this),this.renderTargetTemp.dispose(),this.renderTargetTemp2.dispose()},setSize:function(e,t){vt.prototype.setSize.call(this,e,t);var i=Math.round(e/2),r=Math.round(t/2);this.renderTargetTemp.setSize(i,r),this.renderTargetTemp2.setSize(i,r)},render:function(e,t,i,r){if(this.enable){var n=this;e.materialManager.hasStrategy("GlowPass")||e.materialManager.addStrategy("GlowPass",function(e,t,i,r,o,a){return this.technique&&"skip"==this.technique.glow?null:this.technique&&this.technique.glow?this.technique.glow.isMaterial?this.technique.glow:o:this.isSkinnedMesh?(n.prepareMaskSkinningMaterial.side=o.side,n.prepareMaskSkinningMaterial):(n.prepareMaskMaterial.side=o.side,n.prepareMaskMaterial)});var o=e.autoClear;if(e.autoClear=!1,this._dirty){var a=e.capabilities.isWebGL2;this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha(),e.setClearColor(new THREE.Color(0,0,0),0),e.materialManager.setMode("GlowPass");var s=t.autoUpdate,l=t.background,c=e.shadowMap.enable;t.autoUpdate=!1,t.background=null,e.shadowMap.enable=!1,e.render(t,i,a?this.renderTargetTemp:this.renderTargetTemp2,!0),t.autoUpdate=s,t.background=l,e.shadowMap.enable=c,e.materialManager.setMode(0),this.highPassUniforms.tDiffuse.value=a?this.renderTargetTemp.texture:this.renderTargetTemp2.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.quad.material=this.materialHighPassFilter,e.render(this.scene,this.camera,this.renderTargetBright,!0);for(var u=this.renderTargetBright,h=0;h<this.nMips;h++)this.quad.material=this.separableBlurMaterials[h],this.separableBlurMaterials[h].uniforms.colorTexture.value=u.texture,this.separableBlurMaterials[h].uniforms.direction.value=vt.BlurDirectionX,e.render(this.scene,this.camera,this.renderTargetsHorizontal[h],!0),this.separableBlurMaterials[h].uniforms.colorTexture.value=this.renderTargetsHorizontal[h].texture,this.separableBlurMaterials[h].uniforms.direction.value=vt.BlurDirectionY,e.render(this.scene,this.camera,this.renderTargetsVertical[h],!0),u=this.renderTargetsVertical[h];this.quad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.render(this.scene,this.camera,this.renderTargetsHorizontal[0],!0),this.quad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,e.setClearColor(this.oldClearColor,this.oldClearAlpha),this._dirty=!1}e.render(this.scene,this.camera,r,!1),e.autoClear=o}},dirty:function(){this._dirty=!0}});var _t={uniforms:{scene:{value:null},texSize:{value:new THREE.Vector2(1,1)},Stride:{value:10}},vertexShader:"\n\tvarying vec2 vUv;\n\tvoid main() {\n\t\tvUv = uv;\n\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t}\n    ",fragmentShader:"\n\t#define WT9_0 1.0\n\t#define WT9_1 0.8\n\t#define WT9_2 0.6\n\t#define WT9_3 0.4\n\t#define WT9_4 0.2\n\t#define WT9_NORMALIZE 5.2\n\tvarying vec2 vUv;\n\tuniform sampler2D scene;\n\tuniform vec2 texSize;\n\tuniform float Stride;\n\tvoid main() {\n\t\tfloat TexelIncrement =0.25 * Stride /texSize.x;\n\n\t\tfloat colour = texture2D(scene,vec2(vUv.x + TexelIncrement, vUv.y) ).x * (0.8/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +2.0 * TexelIncrement, vUv.y)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +3.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +4.0 * TexelIncrement, vUv.y)).x * (WT9_4/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x, vUv.y)).x * (WT9_0/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 1.0 * TexelIncrement, vUv.y)).x * (WT9_1/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 2.0 * TexelIncrement, vUv.y)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 3.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 4.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\n\t\tTexelIncrement =0.5 * Stride /texSize.x;\n\t\tcolour += texture2D(scene,vec2(vUv.x + TexelIncrement, vUv.y) ).x * (0.8/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +2.0 * TexelIncrement, vUv.y)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +3.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +4.0 * TexelIncrement, vUv.y)).x * (WT9_4/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x, vUv.y)).x * (WT9_0/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 1.0 * TexelIncrement, vUv.y)).x * (WT9_1/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 2.0 * TexelIncrement, vUv.y)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 3.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 4.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\n\t\tTexelIncrement =0.75 * Stride /texSize.x;\n\t\tcolour += texture2D(scene,vec2(vUv.x + TexelIncrement, vUv.y) ).x * (0.8/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +2.0 * TexelIncrement, vUv.y)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +3.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +4.0 * TexelIncrement, vUv.y)).x * (WT9_4/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x, vUv.y)).x * (WT9_0/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 1.0 * TexelIncrement, vUv.y)).x * (WT9_1/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 2.0 * TexelIncrement, vUv.y)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 3.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 4.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\n\t\tTexelIncrement =Stride /texSize.x;\n\t\tcolour += texture2D(scene,vec2(vUv.x + TexelIncrement, vUv.y) ).x * (0.8/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +2.0 * TexelIncrement, vUv.y)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +3.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +4.0 * TexelIncrement, vUv.y)).x * (WT9_4/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x, vUv.y)).x * (WT9_0/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 1.0 * TexelIncrement, vUv.y)).x * (WT9_1/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 2.0 * TexelIncrement, vUv.y)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 3.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 4.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\n\t\tfloat col = 1.0-colour*0.25;\n\n\t\tgl_FragColor = vec4(col,col,col,col);\n\t}\n    "},xt={uniforms:{blurX:{value:null},scene:{value:null},texSize:{value:new THREE.Vector2(1,1)},Stride:{value:10},Glowness:{value:2},GlowColor:{value:new THREE.Vector4(1,0,0,1)}},vertexShader:"\n\tvarying vec2 vUv;\n\tvoid main() {\n\t\tvUv = uv;\n\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t}\n\t",fragmentShader:"\n\t#define WT9_0 1.0\n\t#define WT9_1 0.8\n\t#define WT9_2 0.6\n\t#define WT9_3 0.4\n\t#define WT9_4 0.2\n\t#define WT9_NORMALIZE 5.2\n\tvarying vec2 vUv;\n\tuniform vec2 texSize;\n\tuniform float Stride;\n\tuniform float Glowness;\n\tuniform vec4 GlowColor;\n\tuniform sampler2D blurX;\n\tuniform sampler2D scene;\n\tvoid main() {\n\n\t\tfloat TexelIncrement = 0.25 * Stride / texSize.y;\n\n\t\tfloat colour = texture2D(blurX, vec2(vUv.x , vUv.y+TexelIncrement)).x * (0.8/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y +2.0 * TexelIncrement)).x* (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+3.0 * TexelIncrement)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+4.0 * TexelIncrement)).x * (WT9_4/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y)).x * (WT9_0/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y- 1.0 * TexelIncrement)).x * (WT9_1/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y - 2.0 * TexelIncrement)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y - 3.0 * TexelIncrement)).x* (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y- 4.0 * TexelIncrement)).x * (WT9_3/WT9_NORMALIZE);\n\n\t\tTexelIncrement = 0.5 * Stride / texSize.y;\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+TexelIncrement)).x * (0.8/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y +2.0 * TexelIncrement)).x* (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+3.0 * TexelIncrement)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+4.0 * TexelIncrement)).x * (WT9_4/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y)).x * (WT9_0/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y- 1.0 * TexelIncrement)).x * (WT9_1/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y - 2.0 * TexelIncrement)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y - 3.0 * TexelIncrement)).x* (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y- 4.0 * TexelIncrement)).x * (WT9_3/WT9_NORMALIZE);\n\n\t\tTexelIncrement = 0.75 * Stride / texSize.y;\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+TexelIncrement)).x * (0.8/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y +2.0 * TexelIncrement)).x* (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+3.0 * TexelIncrement)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+4.0 * TexelIncrement)).x * (WT9_4/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y)).x * (WT9_0/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y- 1.0 * TexelIncrement)).x * (WT9_1/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y - 2.0 * TexelIncrement)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y - 3.0 * TexelIncrement)).x* (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y- 4.0 * TexelIncrement)).x * (WT9_3/WT9_NORMALIZE);\n\n\t\tTexelIncrement = Stride / texSize.y;\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+TexelIncrement)).x * (0.8/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y +2.0 * TexelIncrement)).x* (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+3.0 * TexelIncrement)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+4.0 * TexelIncrement)).x * (WT9_4/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y)).x * (WT9_0/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y- 1.0 * TexelIncrement)).x * (WT9_1/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y - 2.0 * TexelIncrement)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y - 3.0 * TexelIncrement)).x* (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y- 4.0 * TexelIncrement)).x * (WT9_3/WT9_NORMALIZE);\n\n\t\tvec4 glo = (0.25 * Glowness * colour) * GlowColor;\n\t\tvec4 OldCol = texture2D(scene, vec2(vUv.x , vUv.y));\n\t\t\n\t\tgl_FragColor = vec4(OldCol.x*glo.xyz,1);\n\t}\n\t"},Et={vertexShader:"\n        #include <skinning_pars_vertex>\n        void main() {\n            #include <skinbase_vertex>\n            #include <begin_vertex>\n            #include <skinning_vertex>\n            #include <project_vertex>\n        }\n    ",fragmentShader:"\n        void main() {\n            gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);\n        }\n    "},wt={vertexShader:"\n        #include <skinning_pars_vertex>\n        void main() {\n            #include <skinbase_vertex>\n            #include <begin_vertex>\n            #include <skinning_vertex>\n            #include <project_vertex>\n        }\n    ",fragmentShader:"\n        void main() {\n            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n        }\n    "};function Tt(e,t){this.color=new THREE.Vector4(1,0,0,1),this.strength=2,this.stride=10;var i={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat};this.markRenderTarget=new THREE.WebGLRenderTarget(e,t,i),this.markRenderTarget.texture.name="InnerGlowPass.mark",this.markRenderTarget.texture.generateMipmaps=!1,this.tempRenderTarget=new THREE.WebGLRenderTarget(e,t,i),this.tempRenderTarget.texture.name="InnerGlowPass.temp",this.tempRenderTarget.texture.generateMipmaps=!1,this.resultRenderTarget=new THREE.WebGLRenderTarget(e,t,i),this.resultRenderTarget.texture.name="InnerGlowPass.result",this.resultRenderTarget.texture.generateMipmaps=!1,this.prepareMarkMaterial=new THREE.ShaderMaterial(Et),this.prepareMarkSkinningMaterial=new THREE.ShaderMaterial(Et),this.prepareMarkSkinningMaterial.skinning=!0,this.prepareMaskMaterial=new THREE.ShaderMaterial(wt),this.prepareMaskSkinningMaterial=new THREE.ShaderMaterial(wt),this.prepareMaskSkinningMaterial.skinning=!0,this.innerGlowXMaterial=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(_t.uniforms),vertexShader:_t.vertexShader,fragmentShader:_t.fragmentShader}),this.innerGlowXMaterial.uniforms.texSize.value.set(e,t),this.innerGlowYMaterial=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(xt.uniforms),vertexShader:xt.vertexShader,fragmentShader:xt.fragmentShader}),this.innerGlowYMaterial.uniforms.texSize.value.set(e,t),this.copyUniforms=THREE.UniformsUtils.clone(rt.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new THREE.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:rt.vertexShader,fragmentShader:rt.fragmentShader,blending:THREE.CustomBlending,blendSrc:THREE.SrcAlphaFactor,blendDst:THREE.OneFactor,blendEquation:THREE.AddEquation,blendSrcAlpha:THREE.ZeroFactor,blendDstAlpha:THREE.OneFactor,blendEquationAlpha:THREE.AddEquation,depthTest:!1,depthWrite:!1,transparent:!0}),this.oldClearColor=new THREE.Color,this.oldClearAlpha=1,this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.basic=new THREE.MeshBasicMaterial,this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad),this._dirty=!0,this.enable=!1}Object.assign(Tt.prototype,{dispose:function(){this.markRenderTarget.dispose(),this.tempRenderTarget.dispose(),this.resultRenderTarget.dispose()},setSize:function(e,t){this.markRenderTarget.setSize(e,t),this.tempRenderTarget.setSize(e,t),this.resultRenderTarget.setSize(e,t),this.innerGlowXMaterial.uniforms.texSize.value.set(e,t),this.innerGlowYMaterial.uniforms.texSize.value.set(e,t)},render:function(e,t,i,r){if(this.enable){var n=this;e.materialManager.hasStrategy("InnerGlowPass")||e.materialManager.addStrategy("InnerGlowPass",function(e,t,i,r,o,a){if(this.technique&&"skip"==this.technique.innerGlow)return null;var s=void 0;return(s=this.technique&&this.technique.innerGlow?this.technique.innerGlow.isMaterial?this.technique.innerGlow:this.isSkinnedMesh?n.prepareMarkSkinningMaterial:n.prepareMarkMaterial:this.isSkinnedMesh?n.prepareMaskSkinningMaterial:n.prepareMaskMaterial).side=o.side,s});var o=e.autoClear;if(e.autoClear=!1,this._dirty){this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha(),e.setClearColor(new THREE.Color(0,0,0),0),e.materialManager.setMode("InnerGlowPass");var a=t.autoUpdate,s=t.background,l=e.shadowMap.enable;t.autoUpdate=!1,t.background=null,e.shadowMap.enable=!1,e.render(t,i,this.markRenderTarget,!0),t.autoUpdate=a,t.background=s,e.shadowMap.enable=l,e.materialManager.setMode(0),this.innerGlowXMaterial.uniforms.scene.value=this.markRenderTarget.texture,this.innerGlowXMaterial.uniforms.Stride.value=this.stride,this.quad.material=this.innerGlowXMaterial,e.render(this.scene,this.camera,this.tempRenderTarget,!0),this.innerGlowYMaterial.uniforms.blurX.value=this.tempRenderTarget.texture,this.innerGlowYMaterial.uniforms.scene.value=this.markRenderTarget.texture,this.innerGlowYMaterial.uniforms.Stride.value=this.stride,this.innerGlowYMaterial.uniforms.Glowness.value=this.strength,this.innerGlowYMaterial.uniforms.GlowColor.value.copy(this.color),this.quad.material=this.innerGlowYMaterial,e.render(this.scene,this.camera,this.resultRenderTarget,!0),this.quad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.resultRenderTarget.texture,e.setClearColor(this.oldClearColor,this.oldClearAlpha),this._dirty=!1}e.render(this.scene,this.camera,r,!1),e.autoClear=o}},dirty:function(){this._dirty=!0}});var St={vertexShader:"#include <skinning_pars_vertex>\n    void main() {\n        #include <skinbase_vertex>\n        #include <begin_vertex>\n        #include <skinning_vertex>\n        #include <project_vertex>\n    }",fragmentShader:"void main() {        gl_FragColor = vec4(0.0, 1.0, 1.0, 1.0);    }"},Mt={uniforms:{maskTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},edgeColor:{value:new THREE.Vector3(1,1,1)}},vertexShader:"#include <skinning_pars_vertex>\n    varying vec2 vUv;\n    void main() {\n        vUv = uv;\n        #include <skinbase_vertex>\n        #include <begin_vertex>\n        #include <skinning_vertex>\n        #include <project_vertex>\n    }",fragmentShader:"varying vec2 vUv;    uniform sampler2D maskTexture;    uniform vec2 texSize;    uniform vec3 edgeColor;        void main() {\n        vec2 invSize = 1.0 / texSize;        vec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);        vec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);        vec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);        vec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);        vec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);        float b1 = max(c1.b, c2.b);        float b2 = max(c3.b, c4.b);        float a = max(b1, b2);        gl_FragColor = vec4(edgeColor, a);    }"},Rt={defines:{MAX_RADIUS:4},uniforms:{colorTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},direction:{value:new THREE.Vector2(.5,.5)},kernelRadius:{value:1}},vertexShader:"#include <skinning_pars_vertex>\n    varying vec2 vUv;\n    void main() {\n        vUv = uv;\n        #include <skinbase_vertex>\n        #include <begin_vertex>\n        #include <skinning_vertex>\n        #include <project_vertex>\n    }",fragmentShader:"#include <common>    varying vec2 vUv;    uniform sampler2D colorTexture;    uniform vec2 texSize;    uniform vec2 direction;    uniform float kernelRadius;        float gaussianPdf(in float x, in float sigma) {        return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;    }    void main() {        vec2 invSize = 1.0 / texSize;        float weightSum = gaussianPdf(0.0, kernelRadius);        vec4 diffuseColor = texture2D( colorTexture, vUv);        vec4 diffuseSum = diffuseColor * weightSum;        vec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);        vec2 uvOffset = delta;        for( int i = 1; i <= MAX_RADIUS; i ++ ) {            float w = gaussianPdf(uvOffset.x, kernelRadius);            vec4 sample1 = texture2D( colorTexture, vUv + uvOffset);            vec4 sample2 = texture2D( colorTexture, vUv - uvOffset);            diffuseSum += ((sample1 + sample2) * w);            weightSum += (2.0 * w);            uvOffset += delta;        }        vec4 color = diffuseSum/weightSum;         gl_FragColor = color;    }"},Pt={maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},edgeStrength:{value:1},edgeGlow:{value:1}},At="#include <skinning_pars_vertex>\n    varying vec2 vUv;\n    void main() {\n        vUv = uv;\n        #include <skinbase_vertex>\n        #include <begin_vertex>\n        #include <skinning_vertex>\n        #include <project_vertex>\n    }",Ct="varying vec2 vUv;    uniform sampler2D maskTexture;    uniform sampler2D edgeTexture1;    uniform sampler2D edgeTexture2;    uniform float edgeStrength;    uniform float edgeGlow;        void main() {        vec4 edgeValue1 = texture2D(edgeTexture1, vUv);        vec4 edgeValue2 = texture2D(edgeTexture2, vUv);        vec4 maskColor = texture2D(maskTexture, vUv);        vec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;        vec4 finalColor = edgeStrength * edgeValue;        float a = finalColor.a * (1.0 - maskColor.b);        gl_FragColor = vec4(finalColor.rgb, a);    }";function Ot(e,t,i){this.edgeColor=(new THREE.Color).setHex(void 0!==i?i:16777215),this.edgeColorString=this.edgeColor.getHexString(),this.edgeGlow=0,this.edgeThickness=1,this.edgeStrength=1.5,this.downSampleRatio=2;var r={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat},n=Math.round(e/this.downSampleRatio),o=Math.round(t/this.downSampleRatio);this.renderTargetMaskBuffer0=new THREE.WebGLMultisampleRenderTarget(e,t,r),this.renderTargetMaskBuffer0.texture.name="OutlinePass.mask0",this.renderTargetMaskBuffer0.samples=5,this.renderTargetMaskBuffer0.texture.generateMipmaps=!1,this.renderTargetMaskBuffer=new THREE.WebGLRenderTarget(e,t,r),this.renderTargetMaskBuffer.texture.name="OutlinePass.mask",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.renderTargetMaskDownSampleBuffer=new THREE.WebGLRenderTarget(n,o,r),this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,this.renderTargetBlurBuffer1=new THREE.WebGLRenderTarget(n,o,r),this.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",this.renderTargetBlurBuffer1.texture.generateMipmaps=!1,this.renderTargetBlurBuffer2=new THREE.WebGLRenderTarget(Math.round(n/2),Math.round(o/2),r),this.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",this.renderTargetBlurBuffer2.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer1=new THREE.WebGLRenderTarget(n,o,r),this.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",this.renderTargetEdgeBuffer1.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer2=new THREE.WebGLRenderTarget(Math.round(n/2),Math.round(o/2),r),this.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",this.renderTargetEdgeBuffer2.texture.generateMipmaps=!1,this.prepareMaskMaterial=new THREE.ShaderMaterial(St),this.prepareMaskMaterial.side=THREE.DoubleSide,this.prepareMaskMaterial.renderingOutline=!0,this.prepareMaskSkinningMaterial=new THREE.ShaderMaterial(St),this.prepareMaskSkinningMaterial.side=THREE.DoubleSide,this.prepareMaskSkinningMaterial.skinning=!0,this.edgeDetectionMaterial=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(Mt.uniforms),vertexShader:Mt.vertexShader,fragmentShader:Mt.fragmentShader}),this.separableBlurMaterial1=new THREE.ShaderMaterial({defines:Object.assign({},Rt.defines),uniforms:THREE.UniformsUtils.clone(Rt.uniforms),vertexShader:Rt.vertexShader,fragmentShader:Rt.fragmentShader}),this.separableBlurMaterial1.defines.MAX_RADIUS=4,this.separableBlurMaterial1.uniforms.texSize.value=new THREE.Vector2(n,o),this.separableBlurMaterial1.uniforms.kernelRadius.value=1,this.separableBlurMaterial2=new THREE.ShaderMaterial({defines:Object.assign({},Rt.defines),uniforms:THREE.UniformsUtils.clone(Rt.uniforms),vertexShader:Rt.vertexShader,fragmentShader:Rt.fragmentShader}),this.separableBlurMaterial2.defines.MAX_RADIUS=4,this.separableBlurMaterial2.uniforms.texSize.value=new THREE.Vector2(Math.round(n/2),Math.round(o/2)),this.separableBlurMaterial2.uniforms.kernelRadius.value=4,this.overlayMaterial=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(Pt),vertexShader:At,fragmentShader:Ct,blending:THREE.NormalBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.copyUniforms=THREE.UniformsUtils.clone(rt.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new THREE.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:rt.vertexShader,fragmentShader:rt.fragmentShader,blending:THREE.NoBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad),this.tempPulseColor1=new THREE.Color,this.tempPulseColor2=new THREE.Color,this.textureMatrix=new THREE.Matrix4,this.oldClearColor=new THREE.Color,this.oldClearAlpha=1,this._dirty=!0,this.enable=!1}Object.assign(Ot.prototype,{dispose:function(){this.renderTargetMaskBuffer.dispose(),this.renderTargetMaskBuffer0.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose()},setSize:function(e,t){this.renderTargetMaskBuffer.setSize(e,t),this.renderTargetMaskBuffer0.setSize(e,t);var i=Math.round(e/this.downSampleRatio),r=Math.round(t/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(i,r),this.renderTargetBlurBuffer1.setSize(i,r),this.renderTargetEdgeBuffer1.setSize(i,r),this.separableBlurMaterial1.uniforms.texSize.value.set(i,r),i=Math.round(i/2),r=Math.round(r/2),this.renderTargetBlurBuffer2.setSize(i,r),this.renderTargetEdgeBuffer2.setSize(i,r),this.separableBlurMaterial2.uniforms.texSize.value.set(i,r)},render:function(e,t,i,r){if(this.enable){if(!e.materialManager.hasStrategy("OutlinePass_"+this.edgeColorString)){var n=this;e.materialManager.addStrategy("OutlinePass_"+this.edgeColorString,function(e,t,i,r,o,a){if(!this.userData.forceOutline&&!i.layers.test(this.layers))return null;var s="outline_0x"+n.edgeColorString;return this.technique&&this.technique[s]&&"skip"!==this.technique[s]?this.technique[s].isMaterial?this.technique[s]:this.isSkinnedMesh?n.prepareMaskSkinningMaterial:n.prepareMaskMaterial:null})}this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha();var o=e.autoClear;if(e.autoClear=!1,this._dirty){var a=e.capabilities.isWebGL2;e.setClearColor(0,0),e.materialManager.setMode("OutlinePass_"+this.edgeColorString);var s=t.autoUpdate,l=t.background,c=e.shadowMap.enable;t.autoUpdate=!1,t.background=null,e.shadowMap.enable=!1,i.layers.enable(1),e.render(t,i,a?this.renderTargetMaskBuffer0:this.renderTargetMaskBuffer,!0),i.layers.disable(1),t.autoUpdate=s,t.background=l,e.shadowMap.enable=c,e.materialManager.setMode(0),this.quad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=a?this.renderTargetMaskBuffer0.texture:this.renderTargetMaskBuffer.texture,e.render(this.scene,this.camera,this.renderTargetMaskDownSampleBuffer,!0),this.quad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value.set(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms.edgeColor.value=this.edgeColor,e.render(this.scene,this.camera,this.renderTargetEdgeBuffer1,!0),this.quad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=Ot.BlurDirectionX,this.separableBlurMaterial1.uniforms.kernelRadius.value=this.edgeThickness,e.render(this.scene,this.camera,this.renderTargetBlurBuffer1,!0),this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=Ot.BlurDirectionY,e.render(this.scene,this.camera,this.renderTargetEdgeBuffer1,!0),this.quad.material=this.separableBlurMaterial2,this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial2.uniforms.direction.value=Ot.BlurDirectionX,e.render(this.scene,this.camera,this.renderTargetBlurBuffer2,!0),this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetBlurBuffer2.texture,this.separableBlurMaterial2.uniforms.direction.value=Ot.BlurDirectionY,e.render(this.scene,this.camera,this.renderTargetEdgeBuffer2,!0),this.quad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=a?this.renderTargetMaskBuffer0.texture:this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture1.value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms.edgeTexture2.value=this.renderTargetEdgeBuffer2.texture,this.overlayMaterial.uniforms.edgeStrength.value=this.edgeStrength,this.overlayMaterial.uniforms.edgeGlow.value=this.edgeGlow,this._dirty=!1}e.render(this.scene,this.camera,r,!1),e.setClearColor(this.oldClearColor,this.oldClearAlpha),e.autoClear=o}},dirty:function(){this._dirty=!0}}),Ot.BlurDirectionX=new THREE.Vector2(1,0),Ot.BlurDirectionY=new THREE.Vector2(0,1);var Lt={uniforms:{tDiffuse1:{value:null},tDiffuse2:{value:null},mixRatio:{value:.5},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform float mixRatio;","uniform sampler2D tDiffuse1;","uniform sampler2D tDiffuse2;","varying vec2 vUv;","void main() {","vec4 texel1 = texture2D( tDiffuse1, vUv );","vec4 texel2 = texture2D( tDiffuse2, vUv );","gl_FragColor = opacity * mix( texel1, texel2, mixRatio );","}"].join("\n")},kt=function(e,t){for(var i=0,r=1/t,n=e;0<n;)i+=r*(n%t),n=Math.floor(n/t),r/=t;return i};function Ht(e,t,i){this._samplingSize=i||30;for(var r=[],n=0;n<this._samplingSize;n++)r.push([kt(n,2),kt(n,3)]);this._haltonSequence=r,this._prevFrame=new THREE.WebGLRenderTarget(e,t,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),this._output=new THREE.WebGLRenderTarget(e,t,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),this._frame=0,this.quadCamera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.quadScene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneGeometry(2,2),new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(Lt.uniforms),vertexShader:Lt.vertexShader,fragmentShader:Lt.fragmentShader,depthTest:!1,depthWrite:!1})),this.quadScene.add(this.quadCamera),this.quadScene.add(this.quad)}Ht.prototype=Object.assign(Ht.prototype,{constructor:Ht,setSize:function(e,t){this._prevFrame.setSize(e,t),this._output.setSize(e,t)},setSamplingSize:function(e){this._samplingSize=e||30;for(var t=[],i=0;i<this._samplingSize;i++)t.push([kt(i,2),kt(i,3)]);this._haltonSequence=t,this._frame=0},start:function(){this._frame=0},finished:function(){return this._frame>=this._samplingSize},frame:function(){return this._frame},jitterProjection:function(e,t,i){var r=this._haltonSequence[this._frame];r||console.error("THREE.SuperSampler: try to jitter camera after finished!",this._frame,this._haltonSequence.length),e.setViewOffset&&e.setViewOffset(t,i,.5*(2*r[0]-1),.5*(2*r[1]-1),t,i)},sample:function(e,t){var i=0===this._frame;this.quad.material.uniforms.tDiffuse1.value=t,this.quad.material.uniforms.tDiffuse2.value=this._prevFrame.texture,this.quad.material.uniforms.mixRatio.value=i?0:.9,this.quad.material.uniforms.opacity.value=1;var r=e.getClearColor().getHex(),n=e.getClearAlpha();e.setClearColor(0,0),e.render(this.quadScene,this.quadCamera,this._output,!0),e.setClearColor(r,n);var o=this._prevFrame;return this._prevFrame=this._output,this._output=o,this._frame++,this._prevFrame},output:function(){return this._prevFrame}});var jt={temporalSuperSampling:{enable:!0,size:30},postEffect:{enable:!0,bloom:{enable:!0,strength:.14,radius:.4,threshold:.7},screenSpaceAmbientOcclusion:{enable:!0,radius:.2,quality:"medium",intensity:.8,temporalFilter:!0,ignoreTransparent:!1},colorCorrection:{enable:!0,exposure:0,brightness:0,contrast:1.2,saturation:1.2,gamma:1},vignette:{enable:!0,type:"color",color:0,offset:1},blur:{enable:!1,bounds:[[0,0,1,1]],radius:5},FXAA:{enable:!0}}},Ft=function(){function e(){r(this,e)}return e.prototype.setSize=function(e,t){},e.prototype.render=function(e,t,i,r,n){console.error("Effect: .render() must be implemented in derived pass.")},e}(),Dt=function(e){function t(i,n,o){r(this,t);var s=a(this,e.call(this));return s._pass=i,void 0!==n&&void 0!==o&&s.setSize(n,o),s}return o(t,e),t.prototype.setSize=function(e,t){this._pass.setSize(e,t)},t.prototype.render=function(e,t,i,r,n){this._pass.render(e,t,i,r,n)},t}(Ft),Bt={defines:{USE_VIGNETTE_TEXTURE:!1},uniforms:{tDiffuse:{value:null},vignetteOffset:{value:1},vignetteColor:{value:new THREE.Color(0)},vignetteTexture:{value:null}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }\n    ",fragmentShader:"\n\t    uniform sampler2D tDiffuse;\n\n\t\tuniform float vignetteOffset;\n        uniform vec3 vignetteColor;\n        \n        #ifdef USE_VIGNETTE_TEXTURE\n            uniform sampler2D vignetteTexture;\n        #endif\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 color = texture2D(tDiffuse, vUv);\n            vec2 uv = (vUv - vec2(0.5)) * vec2(vignetteOffset);\n            \n            vec3 color2 = vignetteColor;\n\n            #ifdef USE_VIGNETTE_TEXTURE\n                color2 *= texture2D(vignetteTexture, vUv).rgb;\n            #endif\n\n\t\t\tcolor.rgb = mix(color.rgb, color2, clamp(dot(uv, uv), 0.0, 1.0));\n\t\t\tgl_FragColor = color;\n\n\t\t}\n    "},It={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float v;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")},Nt={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float h;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")},Ut=function(e){function t(i,n){r(this,t);var o=a(this,e.call(this));o.type="color",o.color=new THREE.Color(0),o.offset=1;var s={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat};return o.tempRenderTarget=new THREE.WebGLRenderTarget(i/2,n/2,s),o.tempRenderTarget2=new THREE.WebGLRenderTarget(i/2,n/2,s),o.effectHBlur=new ct(Nt),o.effectVBlur=new ct(It),o.effectHBlur.uniforms.h.value=4/i,o.effectVBlur.uniforms.v.value=4/n,o.blendPass=new ct(Bt),o}return o(t,e),t.prototype.setSize=function(e,t){this.tempRenderTarget.setSize(e/2,t/2),this.tempRenderTarget2.setSize(e/2,t/2),this.effectHBlur.uniforms.h.value=4/e,this.effectVBlur.uniforms.v.value=4/t},t.prototype.render=function(e,t,i,r,n){"color"===this.type?(this.blendPass.uniforms.vignetteOffset.value=this.offset,this.blendPass.uniforms.vignetteColor.value.copy(this.color),this.blendPass.material.defines.USE_VIGNETTE_TEXTURE&&(this.blendPass.material.defines.USE_VIGNETTE_TEXTURE=!1,this.blendPass.material.needsUpdate=!0)):"blur"===this.type&&(this.effectHBlur.render(e,this.tempRenderTarget2,i),this.effectVBlur.render(e,this.tempRenderTarget,this.tempRenderTarget2),this.blendPass.uniforms.vignetteOffset.value=this.offset,this.blendPass.uniforms.tDiffuse.value=i.texture,this.blendPass.uniforms.vignetteTexture.value=this.tempRenderTarget.texture,this.blendPass.uniforms.vignetteColor.value.setRGB(1,1,1),this.blendPass.material.defines.USE_VIGNETTE_TEXTURE||(this.blendPass.material.defines.USE_VIGNETTE_TEXTURE=!0,this.blendPass.material.needsUpdate=!0)),this.blendPass.render(e,t,i)},t}(Ft),Vt={defines:{},uniforms:{tDiffuse:{value:null},bounds:{value:new THREE.Vector4(0,0,1,1)},blendTexture:{value:null}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }\n    ",fragmentShader:"\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform sampler2D blendTexture;\n\n\t\tuniform vec4 bounds;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\t\t\tvec4 color = texture2D(tDiffuse, vUv);\n            vec3 color2 = texture2D(blendTexture, vUv).rgb;\n\n            float blend = step(vUv.x, bounds.z) \n                * step(bounds.x, vUv.x)\n                * step(1. - bounds.w, vUv.y) \n                * step(vUv.y, 1. - bounds.y);\n\n\t\t\tcolor.rgb = mix(color.rgb, color2, blend);\n\t\t\tgl_FragColor = color;\n\t\t}\n    "},zt={defines:{SAMPLERS:9},uniforms:{tDiffuse:{value:null},resolution:{value:new THREE.Vector2(1/1024,1/512)},direction:{value:new THREE.Vector2(1,0)}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }\n    ",fragmentShader:"\n        uniform sampler2D tDiffuse;\n        uniform vec2 resolution;\n        uniform vec2 direction;\n        varying vec2 vUv;\n\n        #if (SAMPLERS == 5) \n            vec4 blur(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n                vec4 color = vec4(0.0);\n                vec2 off1 = vec2(1.3333333333333333) * direction;\n                color += texture2D(image, uv) * 0.29411764705882354;\n                color += texture2D(image, uv + (off1 * resolution)) * 0.35294117647058826;\n                color += texture2D(image, uv - (off1 * resolution)) * 0.35294117647058826;\n                return color; \n            }\n        #endif\n        #if (SAMPLERS == 9)\n            vec4 blur(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n                vec4 color = vec4(0.0);\n                vec2 off1 = vec2(1.3846153846) * direction;\n                vec2 off2 = vec2(3.2307692308) * direction;\n                color += texture2D(image, uv) * 0.2270270270;\n                color += texture2D(image, uv + (off1 * resolution)) * 0.3162162162;\n                color += texture2D(image, uv - (off1 * resolution)) * 0.3162162162;\n                color += texture2D(image, uv + (off2 * resolution)) * 0.0702702703;\n                color += texture2D(image, uv - (off2 * resolution)) * 0.0702702703;\n                return color;\n            }\n        #endif\n        #if (SAMPLERS == 13)\n            vec4 blur(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n                vec4 color = vec4(0.0);\n                vec2 off1 = vec2(1.411764705882353) * direction;\n                vec2 off2 = vec2(3.2941176470588234) * direction;\n                vec2 off3 = vec2(5.176470588235294) * direction;\n                color += texture2D(image, uv) * 0.1964825501511404;\n                color += texture2D(image, uv + (off1 * resolution)) * 0.2969069646728344;\n                color += texture2D(image, uv - (off1 * resolution)) * 0.2969069646728344;\n                color += texture2D(image, uv + (off2 * resolution)) * 0.09447039785044732;\n                color += texture2D(image, uv - (off2 * resolution)) * 0.09447039785044732;\n                color += texture2D(image, uv + (off3 * resolution)) * 0.010381362401148057;\n                color += texture2D(image, uv - (off3 * resolution)) * 0.010381362401148057;\n                return color;\n            }\n        #endif\n\n        void main() {\n            gl_FragColor = blur(tDiffuse, vUv, resolution, direction);\n        }\n    "},qt=function(e){function t(i,n){r(this,t);var o=a(this,e.call(this)),s={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat};return o.tempRenderTarget=new THREE.WebGLRenderTarget(i,n,s),o.tempRenderTarget2=new THREE.WebGLRenderTarget(i,n,s),o.tempRenderTarget3=new THREE.WebGLRenderTarget(i,n,s),o.tempRenderTarget4=new THREE.WebGLRenderTarget(i,n,s),o.blurPass=new ct(zt),o.blendPass=new ct(Vt),o.blendPass.uniforms.blendTexture.value=o.tempRenderTarget.texture,o.bounds=[[0,0,1,1]],o.radius=5,o}return o(t,e),t.prototype.setSize=function(e,t){this.tempRenderTarget.setSize(e,t),this.tempRenderTarget2.setSize(e,t),this.tempRenderTarget3.setSize(e,t),this.tempRenderTarget4.setSize(e,t)},t.prototype.render=function(e,t,i,r,n){for(var o=this,a=this.tempRenderTarget3.width,s=this.tempRenderTarget3.height,l=2+2*Math.floor(this.radius/2),c=0;c<l;c++){this.blurPass.uniforms.resolution.value.set(1/a,1/s);var u=this.radius*(c+1)/l;c%2==0?(this.blurPass.uniforms.direction.value.set(u,0),this.blurPass.render(e,this.tempRenderTarget2,0===c?i:this.tempRenderTarget)):(this.blurPass.uniforms.direction.value.set(0,u),this.blurPass.render(e,this.tempRenderTarget,this.tempRenderTarget2))}var h=i,p=this.tempRenderTarget3,d=void 0;this.bounds.forEach(function(i,r){o.blendPass.uniforms.bounds.value.fromArray(i),o.blendPass.render(e,r===o.bounds.length-1?t:p,h),d=h,h=p,p=0===r?o.tempRenderTarget4:d})},t}(Ft);function Wt(e,t){if("[object Object]"!==t.toString())return t;for(var i in t)t.hasOwnProperty(i)&&(e||(e={}),e[i]=Wt(e[i],t[i]));return e}function Gt(e,t){this._superSampler=new Ht(e,t,30);var i={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat};this._tempRenderTarget0=new THREE.WebGLMultisampleRenderTarget(e,t,i),this._tempRenderTarget0.samples=5,this._tempRenderTarget=new THREE.WebGLRenderTarget(e,t,i),this._tempRenderTarget2=new THREE.WebGLRenderTarget(e,t,i),this._ssaoPrePass=new mt(e,t),this._ssaoKernalSize=12,this._normalDepthPrePass=new ht(e,t),this._bloomPass=new vt({x:e,y:t},.14,.4,.6),this._colorEffect=new Dt(new ct(it)),this._vignetteEffect=new Ut(e,t),this._rectBlurEffect=new qt(e,t),this._fxaaEffect=new Dt(new ct(nt),e,t),this._copyPass=new ct(rt),this._glowPass=new bt({x:e,y:t},1.5,.4,.2),this._innerGlowPass=new Tt(e,t),this._outlinePasses=new Map,this._config=Wt({},jt),this.setConfig({}),this.width=e,this.height=t,this.onlyAO=!1}Gt.prototype=Object.assign(Gt.prototype,{constructor:Gt,setConfig:function(e){this._config=Wt(this._config,e),this._superSampler.setSamplingSize(this._config.temporalSuperSampling.size);var t=this._config.postEffect.bloom;this._bloomPass.strength=t.strength,this._bloomPass.radius=t.radius,this._bloomPass.threshold=t.threshold,t=this._config.postEffect.screenSpaceAmbientOcclusion,this._ssaoPrePass.setParameter("radius",t.radius),this._ssaoPrePass.setParameter("bias",t.radius/50),this._ssaoPrePass.setParameter("intensity",t.intensity),this._ssaoKernalSize={low:6,medium:12,high:32,ultra:64}[t.quality]||12,this._ssaoPrePass.setKernelSize(this._ssaoKernalSize),t=this._config.postEffect.colorCorrection,this._colorEffect._pass.uniforms.exposure.value=t.exposure,this._colorEffect._pass.uniforms.brightness.value=t.brightness,this._colorEffect._pass.uniforms.contrast.value=t.contrast,this._colorEffect._pass.uniforms.saturation.value=t.saturation,this._colorEffect._pass.uniforms.gamma.value=t.gamma,t=this._config.postEffect.vignette,this._vignetteEffect.type=t.type,this._vignetteEffect.color.setHex(t.color),this._vignetteEffect.offset=t.offset,t=this._config.postEffect.blur,this._rectBlurEffect.bounds=t.bounds,this._rectBlurEffect.radius=t.radius,this.dirty()},enable:function(e){if(-1<e.indexOf("outline")){var t=e.split("_"),i=t[1];if(e=t[0],this._outlinePasses.has(i))this._outlinePasses.get(i).enable=!0;else{var r=new Ot(this.width,this.height,i);r.enable=!0,this._outlinePasses.set(i,r)}}else this["_"+e+"Pass"].enable=!0},disable:function(e){if(-1<e.indexOf("outline")){var t=e.split("_"),i=t[1];e=t[0],this._outlinePasses.has(i)&&(this._outlinePasses.get(i).enable=!1)}else this["_"+e+"Pass"].enable=!1},setSize:function(e,t){this._superSampler.setSize(e,t),this._tempRenderTarget0.setSize(e,t),this._tempRenderTarget.setSize(e,t),this._tempRenderTarget2.setSize(e,t),this._ssaoPrePass.setSize(e,t),this._bloomPass.setSize(e,t),this._colorEffect.setSize(e,t),this._vignetteEffect.setSize(e,t),this._rectBlurEffect.setSize(e,t),this._fxaaEffect.setSize(e,t),this._glowPass.setSize(e,t),this._innerGlowPass.setSize(e,t),this._outlinePasses.forEach(function(i){i.setSize(e,t)}),this.width=e,this.height=t,this.dirty()},render:function(e,t,i){var r=this._config.temporalSuperSampling.enable,n=this._config.postEffect.enable,o=!1;if(n||r){var a,s;a=r?this._superSampler.finished()?this._superSampler.output():(this._superSampler.jitterProjection(i,this._tempRenderTarget.width,this._tempRenderTarget.height),o=!0,s=e.capabilities.isWebGL2?this._tempRenderTarget0:this._tempRenderTarget,e.render(t,i,s),n&&this._config.postEffect.screenSpaceAmbientOcclusion.enable&&(this._normalDepthPrePass.render(e,t,i,this._config.postEffect.screenSpaceAmbientOcclusion.ignoreTransparent),this._config.postEffect.screenSpaceAmbientOcclusion.temporalFilter&&this._ssaoPrePass.setKernelSize(this._ssaoKernalSize,this._superSampler.frame()),this._ssaoPrePass.render(this._normalDepthPrePass.getNormalTexture(),this._normalDepthPrePass.getDepthTexture(),e,i,s,this.onlyAO)),this._superSampler.sample(e,s.texture)):(s=e.capabilities.isWebGL2?this._tempRenderTarget0:this._tempRenderTarget,e.render(t,i,s),n&&this._config.postEffect.screenSpaceAmbientOcclusion.enable&&(this._normalDepthPrePass.render(e,t,i,this._config.postEffect.screenSpaceAmbientOcclusion.ignoreTransparent),this._ssaoPrePass.render(this._normalDepthPrePass.getNormalTexture(),this._normalDepthPrePass.getDepthTexture(),e,i,s,this.onlyAO)),s),this._copyPass.render(e,this._tempRenderTarget2,a);var l=this._tempRenderTarget2,c=this._tempRenderTarget;if(n&&this._config.postEffect.colorCorrection.enable){this._colorEffect.render(e,c,l);var u=l;l=c,c=u}n&&this._config.postEffect.vignette.enable&&(this._vignetteEffect.render(e,c,l),u=l,l=c,c=u),n&&this._config.postEffect.bloom.enable&&this._bloomPass.render(e,c,l),this._innerGlowPass.render(e,t,i,l),this._glowPass.render(e,t,i,l),this._outlinePasses.forEach(function(r){return r.render(e,t,i,l)}),n&&this._config.postEffect.FXAA.enable&&(this._fxaaEffect.render(e,c,l),u=l,l=c,c=u),n&&this._config.postEffect.blur.enable&&(this._rectBlurEffect.render(e,c,l),u=l,l=c,c=u);var h=e.autoClear;e.autoClear=!1,this._copyPass.render(e,void 0,l),e.autoClear=h,o&&i.clearViewOffset()}else e.capabilities.isWebGL2?(e.render(t,i,this._tempRenderTarget0),this._copyPass.render(e,void 0,this._tempRenderTarget0)):e.render(t,i),this._innerGlowPass.render(e,t,i),this._glowPass.render(e,t,i),this._outlinePasses.forEach(function(r){return r.render(e,t,i)})},dirty:function(){this._config.temporalSuperSampling.enable&&this._superSampler.start(),this._innerGlowPass.dirty(),this._glowPass.dirty(),this._outlinePasses.forEach(function(e){return e.dirty()})}});var Xt=new THREE.Vector3,Yt=new THREE.Vector3,Qt={vertexShader:"\n        #include <skinning_pars_vertex>\n        void main() {\n            #include <skinbase_vertex>\n            #include <begin_vertex>\n            #include <skinning_vertex>\n            #include <project_vertex>\n        }\n    ",fragmentShader:"\n        void main() {\n            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n        }\n    "},Zt=new THREE.ShaderMaterial(Qt),Jt=new THREE.ShaderMaterial(Qt);Jt.skinning=!0;var Kt,$t=new THREE.Color,ei=function(){function e(t,i){r(this,e),this.camera=new THREE.OrthographicCamera;var n={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat};this.tempRenderTarget=new THREE.WebGLRenderTarget(t,i,n),this.radius=.1,this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;for(var o=Math.round(t/2),a=Math.round(i/2),s=0;s<this.nMips;s++){var l=new THREE.WebGLRenderTarget(o,a,n);l.texture.name="AOBaker.h"+s,l.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(l);var c=new THREE.WebGLRenderTarget(o,a,n);c.texture.name="AOBaker.v"+s,c.texture.generateMipmaps=!1,this.renderTargetsVertical.push(c),o=Math.round(o/2),a=Math.round(a/2)}this.separableBlurMaterials=[];var u=[3,5,7,9,11];o=Math.round(t/2),a=Math.round(i/2);for(var h=0;h<this.nMips;h++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(u[h])),this.separableBlurMaterials[h].uniforms.texSize.value=new THREE.Vector2(o,a),o=Math.round(o/2),a=Math.round(a/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0,this.compositeMaterial.uniforms.bloomFactors.value=[.5,.7,.8,.9,1],this._camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)}return e.prototype.bake=function(e,t,i,r){i&&this.fit(i,r),e.materialManager.hasStrategy("AOBaker")||e.materialManager.addStrategy("AOBaker",function(e,t,i,r,n,o){return this.userData.ground?null:n.skinning?Jt:Zt});var n=e.autoClear;e.autoClear=!1,$t.copy(e.getClearColor());var o=e.getClearAlpha();e.setClearColor(new THREE.Color(1,1,1),1),e.materialManager.setMode("AOBaker");var a=t.autoUpdate,s=t.background,l=e.shadowMap.enable;t.autoUpdate=!1,t.background=null,e.shadowMap.enable=!1,e.render(t,this.camera,this.tempRenderTarget,!0),t.autoUpdate=a,t.background=s,e.shadowMap.enable=l,e.materialManager.setMode(0);for(var c=this.tempRenderTarget,u=0;u<this.nMips;u++)this.quad.material=this.separableBlurMaterials[u],this.separableBlurMaterials[u].uniforms.colorTexture.value=c.texture,this.separableBlurMaterials[u].uniforms.direction.value=new THREE.Vector2(1,0),e.render(this.scene,this._camera,this.renderTargetsHorizontal[u],!0),this.separableBlurMaterials[u].uniforms.colorTexture.value=this.renderTargetsHorizontal[u].texture,this.separableBlurMaterials[u].uniforms.direction.value=new THREE.Vector2(0,1),e.render(this.scene,this._camera,this.renderTargetsVertical[u],!0),c=this.renderTargetsVertical[u];this.quad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomRadius.value=1-this.radius,e.render(this.scene,this._camera,this.tempRenderTarget,!0),e.setClearColor($t,o),e.autoClear=n},e.prototype.fit=function(e,t){var i=e.getCenter(Xt),r=e.getSize(Yt);this.camera.position.set(i.x,i.y+r.y,i.z),this.camera.rotation.set(-Math.PI/2,0,0),this.camera.matrixAutoUpdate=!1,this.camera.updateMatrix(),this.camera.matrix.premultiply(t),this.camera.near=r.y/3,this.camera.far=2*r.y,this.camera.left=-r.x/2+.075,this.camera.right=r.x/2-.075,this.camera.top=r.z/2-.075,this.camera.bottom=-r.z/2+.075,this.camera.updateProjectionMatrix(),r.x=1024,r.z=1024,this.tempRenderTarget.setSize(r.x,r.z);for(var n=Math.round(r.x/2),o=Math.round(r.z/2),a=0;a<this.nMips;a++)this.renderTargetsHorizontal[a].setSize(n,o),this.renderTargetsVertical[a].setSize(n,o),this.separableBlurMaterials[a].uniforms.texSize.value=new THREE.Vector2(n,o),n=Math.round(n/2),o=Math.round(o/2)},e.prototype.dispose=function(){this.tempRenderTarget.dispose();for(var e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(var t=0;t<this.renderTargetsVertical.length;t++)this.renderTargetsVertical[t].dispose()},e.prototype.getSeperableBlurMaterial=function(e){return new THREE.ShaderMaterial({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},direction:{value:new THREE.Vector2(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat fSigma = float(SIGMA);\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, fSigma);\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\t\t\t\t\t\tfloat x = float(i);\t\t\t\t\t\tfloat w = gaussianPdf(x, fSigma);\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\t\t\t\t\t\tweightSum += 2.0 * w;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})},e.prototype.getCompositeMaterial=function(e){return new THREE.ShaderMaterial({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomFactors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D blurTexture1;\n\t\t\t\tuniform sampler2D blurTexture2;\n\t\t\t\tuniform sampler2D blurTexture3;\n\t\t\t\tuniform sampler2D blurTexture4;\n\t\t\t\tuniform sampler2D blurTexture5;\n\t\t\t\tuniform float bloomRadius;\n\t\t\t\tuniform float bloomFactors[NUM_MIPS];\n\t\t\t\t\n\t\t\t\tfloat lerpBloomFactor(const in float factor) { \n\t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\n\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tvoid main() {\n\t\t\t\t\tfloat factor0 = lerpBloomFactor(bloomFactors[0]);\n\t\t\t\t\tfloat factor1 = lerpBloomFactor(bloomFactors[1]);\n\t\t\t\t\tfloat factor2 = lerpBloomFactor(bloomFactors[2]);\n\t\t\t\t\tfloat factor3 = lerpBloomFactor(bloomFactors[3]);\n\t\t\t\t\tfloat factor4 = lerpBloomFactor(bloomFactors[4]);\n\t\t\t\t\tgl_FragColor = (factor0 * texture2D(blurTexture1, vUv) +\n\t\t\t\t\t\t\t\t\t\tfactor1 * texture2D(blurTexture2, vUv) +\n\t\t\t\t\t\t\t\t\t\tfactor2 * texture2D(blurTexture3, vUv) +\n\t\t\t\t\t\t\t\t\t\tfactor3 * texture2D(blurTexture4, vUv) +\n\t\t\t\t\t\t\t\t\t\tfactor4 * texture2D(blurTexture5, vUv)) / (factor0 + factor1 + factor2 + factor3 + factor4);\n\t\t\t\t}\t\n\t\t\t"})},n(e,[{key:"ao",get:function(){return this.tempRenderTarget.texture}}]),e}(),ti=function(e){function t(i){return r(this,t),a(this,e.call(this,i))}return o(t,e),n(t,[{key:"isCombinedObject",get:function(){return!0}}]),t}(Ye),ii=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));return n._height=3,n.miscObject=null,n.wallObject=null,n.roofObject=null,n.ceilingObject=null,n._marker=null,n._navigation=null,n._groundAOBaker=null,n._baked=!1,n._showObjectsInParentLevels=!1,n}return o(t,e),t.prototype.destroy=function(){this._groundAOBaker&&(this.plan.node.traverse(function(e){var t=e.material;t&&(t.aoMap=null,t.needsUpdate=!0)}),this._groundAOBaker.dispose(),this._groundAOBaker=null),e.prototype.destroy.call(this)},t.prototype.synTransform=function(e){this.setupUserData(e),this.setupParent(e),this.setupTranslation(e)},t.prototype.setupFromData=function(e){var t=this,i=e.data,r=e.options||{};r.complete=function(){t._setup(e),t._synTheme(!0)},this.synTransform(e),this.app._floorLoaderManager.loadFromData(this,i,r)},t.prototype.setupFromURL=function(e){var t=this,i=this.app.confirmURL(e.url),r=e.options||{};r.complete=function(){t._setup(e)},this.synTransform(e),this.app._floorLoaderManager.load(this,i,r)},t.prototype.customSetup=function(e){this._height=e.height||this._height,this._showObjectsInParentLevels=Te.parseValue(e.alwaysShowInsideObjs,this._showObjectsInParentLevels)},t.prototype._getDoors=function(e){for(var t=[],i=0;i<this.doors.length;i++){var r=this.doors[i];r[e]&&t.push(r)}return t},t.prototype._createMarker=function(e){var t=(e=e||{}).connectorName||/connector/,i=e.markerName||/marker/,r=this.attachPoints.query(t),n=this.attachPoints.query(i);if(0!=r.length||0!=n.length){var o=r[0],a=n[0];e.type="Marker",e.parent=this,Te.isNull(e.size)?console.error("floor's marker must provide size to show"):Te.isNull(e.canvas)&&Te.isNull(e.url)?console.error("floor's marker must provide 'canvas' or 'url' to show"):(a&&(e.position=a.position),o?e.lineToPosition=o.position:e.lineColor&&console.error("Please make sure connector is avaliable for showing connection line of marker"),this._marker=this.app.create(e))}},t.prototype.setupChildVisibleAsParent=function(e,t){this.visible||this._showObjectsInParentLevels||(e.visible=!1)},t.prototype._traverseSelfNodes=function(t){if(t){var i=this.roof,r=this.misc,n=this;e.prototype._traverseSelfNodes.call(this,function(e){i&&(e==i.node||e.isChildOf(i.node))||r&&e.isChildOf(r.node)&&!function(e){for(;e;){if(e.isDoorOrWin)return!0;e=e.parent}return!1}(e)||t(e)}),this.children.forEach(function(e){if(n._showObjectsInParentLevels)e.node.traverse(function(e){t(e)});else if(e.isRoom){var i=e.roof;e.node.traverse(function(e){i&&(e==i.node||e.isChildOf(i.node))||t(e)})}else(e.isDoor||e.isWindow)&&e.node.traverse(function(e){t(e)})})}},t.prototype.traverseRoofs=function(e){this.roof&&e(this.roof);for(var t=this.rooms,i=0;i<t.length;i++){var r=t[i].roof;r&&e(r)}},t.prototype.showAllRoofs=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this.roof&&(this.roof.visible=e);for(var t=this.rooms,i=0;i<t.length;i++){var r=t[i].roof;r&&(r.visible=e)}},t.prototype.showAllCeilings=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=this.ceiling;t&&(t.visible=e);for(var i=this.rooms,r=0;r<i.length;r++)i[r].ceiling.visible=e},t.prototype.showMarker=function(e){this._marker||this._createMarker(e),Te.isBoolean(e)?this._marker.visible=e:this._marker.setParams(e)},t.prototype.getRoomFromLocalPosition=function(e){return this.getRoomFromWorldPosition(this.selfToWorld(e))},t.prototype.getRoomFromWorldPosition=function(e){for(var t=this.rooms,i=0;i<t.length;i++){var r=t[i];if(r.getRayCastPosition(e))return r}return null},t.prototype.bake=function(e){var t=this.plan;if(t&&!this.dynamic){var i=this.wall;if(i){var r=this;if(null===e){if(!this._baked)return;var n=function(e){Te.revertValue(e,"aoMap"),Te.revertValue(e,"aoMapIntensity"),e.needsUpdate=!0};t.node.traverseMaterials(n),this.rooms.forEach(function(e){var t=e.plan;t&&t.node.traverseMaterials(n)}),this._baked=!1}else{e=e||{};var o=Te.parseValue(e.intensity,1.4);this._groundAOBaker||(this._groundAOBaker=new ei);var a=i.getLocalBoundingBox(!0,!1).toBox();this._groundAOBaker.bake(this.app.renderer,i.node,a,this.node.matrixWorld);var s=function(e,t){Te.backupValue(t,"aoMap"),Te.backupValue(t,"aoMapIntensity"),t.aoMap=r._groundAOBaker.ao,t.aoMapIntensity=o,t.needsUpdate=!0};t.style._cloneAndModifyMaterial(function(e,t,i){s(0,t)}),this.rooms.forEach(function(e){var t=e.plan;t&&t.style._cloneAndModifyMaterial(function(e,t,i){s(0,t)})}),this._baked=!0}}}},t.prototype.canNavigation=function(){return!0},t.prototype._getLinkableObjects=function(){var t=this.rooms;return t.concat(e.prototype._getLinkableObjects.call(this))},t.prototype._getLinkableDoors=function(){var t=this.elevatorDoors;return(t=t.concat(this.stairDoors)).concat(e.prototype._getLinkableDoors.call(this))},t.prototype._setupNavigationGraph=function(t,i){e.prototype._setupNavigationGraph.call(this,t,i);for(var r=this._getLinkableObjects(),n=0;n<r.length;n++)for(var o=r[n],a=o._getLinkableDoors(),s=0;s<a.length;s++)t[(l=a[s]).id]=t[l.id]||{},t[o.id]=t[o.id]||{},t[o.id][l.id]=t[l.id][o.id]=i;for(t[this.id]=t[this.id]||{},a=this._getLinkableDoors(),n=0;n<a.length;n++){var l,c=(l=a[n]).owner;c&&(t[l.id]=t[l.id]||{},t[c.id]=t[c.id]||{},t[this.id][l.id]=t[l.id][this.id]=i,t[c.id][l.id]=t[l.id][c.id]=i)}},t.prototype.onBeforeCapture=function(){var e=this.plan;if(e){var t=function(e){var t=e.material;t&&(Te.backupValue(t,"aoMap"),t.aoMap=null,t.needsUpdate=!0)};e.node.traverseAll(function(e){t(e)}),this.rooms.forEach(function(e){var i=e.plan;i&&i.node.traverseAll(function(e){t(e)})})}},t.prototype.onAfterCapture=function(){var e=this.plan;if(e){var t=function(e){var t=e.material;t&&(Te.revertValue(t,"aoMap"),t.needsUpdate=!0)};e.node.traverseAll(function(e){t(e)}),this.rooms.forEach(function(e){var i=e.plan;i&&i.node.traverseAll(function(e){t(e)})})}},t.prototype.showThings=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];console.warn("[Floor] Please use '.things.visible=true/false' to replace '.showThings'"),this.things.visible=e},t.prototype.showDoors=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];console.warn("[Floor] Please use '.things.visible=true/false' to replace '.showThings'"),this.doors.visible=e},t.prototype.hideMarker=function(){console.warn("[Floor] Please use '.showMarker(false)' to replace '.hideMarker'"),this.showMarker(!1)},t.prototype.setMarker=function(e){console.warn("[Floor] Please use '.showMarker(params)' to replace '.setMarker'"),this.showMarker(e)},t.prototype.showRoof=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];console.warn("[Floor] Please use '.showAllRoofs()' to replace '.showRoof()'"),this.showAllRoofs(e)},t.prototype.showCeiling=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];console.warn("[Floor] Please use '.showAllCeilings()' to replace '.showCeiling()'"),this.showAllCeilings(e)},n(t,[{key:"isFloor",get:function(){return!0}},{key:"isOutdoors",get:function(){var e=this.building;return!(!e||e.hasFacades())}},{key:"building",get:function(){return this.parents.query(".Building")[0]}},{key:"indexOfBuilding",get:function(){return this.indexOfParent(!0)}},{key:"levelNumber",get:function(){return this.indexOfParent(!0)+1}},{key:"things",get:function(){return this.query(".Thing",!1)}},{key:"doors",get:function(){return this.query(".Door",!1)}},{key:"elevatorDoors",get:function(){return this.doors.query(".ElevatorDoor",!1)}},{key:"stairDoors",get:function(){return this.doors.query(".StairDoor",!1)}},{key:"stairs",get:function(){return this.query(".Stair",!1)}},{key:"rooms",get:function(){return this.query(".Room",!1)}},{key:"misc",get:function(){return this.miscObject||(this.miscObject=this.query(".CombinedObject").query("[userData/type=CombineMiscParent]")[0],this.miscObject&&(this.miscObject.node.userData.skipCheckNeedChangeVisible=!0)),this.miscObject}},{key:"plan",get:function(){return this.floorObject||(this.floorObject=this.query(".CombinedObject").query("[userData/type=CombineFloorParent]")[0]),this.floorObject}},{key:"wall",get:function(){return this.wallObject||(this.wallObject=this.query(".CombinedObject").query("[userData/type=CombineWallParent]")[0]),this.wallObject}},{key:"roof",get:function(){return this.roofObject||(this.roofObject=this.query(".CombinedObject").query("[userData/type=CombineRoofParent]")[0]),this.roofObject}},{key:"ceiling",get:function(){return this.ceilingObject||(this.ceilingObject=this.query(".CombinedObject").query("[userData/type=CombineCeilingParent]")[0]),this.ceilingObject}},{key:"marker",get:function(){return this._marker}},{key:"height",get:function(){return this._height}},{key:"showObjectsInParentLevels",get:function(){return this._showObjectsInParentLevels}},{key:"isFloorPlan",get:function(){return console.warn("[Floor] Please use '.isFloor' to replace '.isFloorPlan'"),!0}},{key:"levelNum",get:function(){return console.warn("[Floor] Please use '.levelNumber' to replace '.levelNum'"),this.levelNumber}}]),t}(Ye),ri=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));return n._graph=null,n._expanded=!1,n}return o(t,e),t.prototype._canAcceptMouseEvent=function(e){var t=e.type;return!!x[t]},t.prototype.canAcceptEvent=function(t){if(e.prototype.canAcceptEvent.call(this,t))return!0;var i=t.object;if(i&&i.isChildOf(this)){if(i.isFloor&&this._canAcceptMouseEvent(t))return!0;if(i.isFacade&&this._canAcceptMouseEvent(t))return!0;if(i.parent){if(i.parent.isFloor&&this._canAcceptMouseEvent(t))return!0;if(i.parent.isFacade&&this._canAcceptMouseEvent(t))return!0}}return!1},t.prototype._addFromCampus=function(e){if(e.buildings.length){this.floors.destroy();var t=e.buildings[0].floors,i=this;t.forEach(function(e){i.add(e)})}},t.prototype.setupElevators=function(){var e={};for(var t in this.query(".ElevatorDoor").forEach(function(t){var i=t.userData._ELEVATOR_;e[i]||(e[i]=[]),e[i].push(t)}),e){var i=e[t];this.app.create({type:"Elevator",name:t,parent:this,doors:i})}},t.prototype.setupStairs=function(){this.query("[type=stairway]").forEach(function(e){e.floorNode.visible=!1});var e={};for(var t in this.query(".StairDoor").forEach(function(t){var i=t.userData._STAIR_;e[i]=e[i]||[],e[i].push(t)}),e){var i=e[t];this.app.create({type:"Stair",name:t,parent:this,doors:i})}},t.prototype.canNavigation=function(){return!0},t.prototype.setupNavigationObjects=function(){this.setupElevators(),this.setupStairs()},t.prototype.setupGraph=function(){if(this._graph)return this._graph;var e={};return this.floors.forEach(function(t){t._setupNavigationGraph(e,1e4)}),this._graph=new Graph(e),this._graph},t.prototype.destroy=function(){this._graph=null,e.prototype.destroy.call(this)},t.prototype.hasAnyFacadesVisible=function(){for(var e=this.facades,t=0;t<e.length;t++)if(e[t].visible)return!0;return!1},t.prototype.hasFacades=function(){return 0!==this.facades.length},t.prototype.showAllRoofs=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this.floors.forEach(function(t){t.showAllRoofs(e)})},t.prototype.expandFloors=function(e){e=e||{},this.expandCmd||(this.expandCmd=this.app.commandManager.create({type:"ExpandObjects"})),e.objects=this.floors.objects,this.expandCmd.setParam(e),this.expandCmd.execute(),this._expanded=!0},t.prototype.unexpandFloors=function(e){e=e||{},this.expandCmd&&(e.hideRoof&&(e.hideRoof=!e.hideRoof),this.expandCmd.setParam(e),this.expandCmd.undo(),this._expanded=!1)},t.prototype.showFacades=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];console.warn("[Building] Please use '.facades.visible=true/false' to replace '.showFacades()'"),this.facades.visible=e},t.prototype.showFloors=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];console.warn("[Building] Please use '.floors.visible=true/false' to replace '.showFloors()'"),this.floors.visible=e},t.prototype.showRoof=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];console.warn("[Building] Please use '.showAllRoofs()' to replace '.showRoof()'"),this.showAllRoofs(e)},n(t,[{key:"isBuilding",get:function(){return!0}},{key:"expanded",get:function(){return this._expanded}},{key:"facade",get:function(){return this.query(".Facade",!1)[0]}},{key:"facades",get:function(){return this.query(".Facade",!1)}},{key:"elevators",get:function(){return this.query(".Elevator",!1)}},{key:"stairs",get:function(){return this.query(".Stair",!1)}},{key:"floors",get:function(){return this.query(".Floor",!1)}},{key:"things",get:function(){return this.query(".Thing",!1)}}]),t}(Ye),ni=function(){function e(t){r(this,e),this.object=null,this.animations=t,this.animationClips=null,this.animationPlayingActions=[],this.animationActions=[],this.animationMixer=null}return e.prototype.init=function(e){var t=this;this.animationClips=e,this.animationMixer=new THREE.AnimationMixer(this.object.node);for(var i=0;i<this.animationClips.length;i++){var r=this.animationMixer.clipAction(this.animationClips[i]);this.animationActions.push(r)}this.animationMixer.addEventListener("loop",function(e){}),this.animationMixer.addEventListener("finished",function(e){var i=e.action;i.setEffectiveTimeScale(0);var r=i.complete;if(r){var n=i.getClip().name;r.call(t.object,n)}})},e.prototype.onAdd=function(e){this.object=e,this.app=e.app,this.init(this.animations),delete this.animations},e.prototype.onRemove=function(){this.animationMixer&&(this.animationClips=null,this.animationActions=[],this.animationMixer=null)},e.prototype.onUpdate=function(e){var t=this.animationMixer;if(t){var i=t.isRunning();if(this.app.root.static&&i){var r=this.object.boundingBox;this.app.camera.frustum.intersectsBox(r)&&this.object.node._synMatrixWorld()}return t.update(e),this.app.needUpdate=i}return!1},e.prototype.containAnimation=function(e){if(this.animationClips)for(var t=0;t<this.animationClips.length;t++)if(this.animationClips[t].name===e)return!0;return!1},e.prototype._updatePlayingAnimation=function(e){for(var t=0;t<this.animationPlayingActions.length;++t)if(this.animationPlayingActions[t]==e)return;this.animationPlayingActions.push(e)},e.prototype.pauseAnimation=function(e,t){if(e){if(Te.isArray(e))for(o=0;o<this.animationPlayingActions.length;o++){for(var i=this.animationPlayingActions[o],r=!1,n=0;n<e.length;n++)if(e[n]==i.getClip().name){r=!0;break}r||(i.paused=t,this.animationPlayingActions.splice(o,1),o--)}else if(Te.isString(e)){for(o=0;o<this.animationPlayingActions.length;o++)e!=(i=this.animationPlayingActions[o]).getClip().name&&(i.paused=t,this.animationPlayingActions.splice(o,1),o--);for(o=0;o<this.animationPlayingActions.length;++o)this.animationPlayingActions[o].paused=t}}else for(var o=0;o<this.animationPlayingActions.length;++o)this.animationPlayingActions[o].paused=t},e.prototype.stopAnimation=function(e){if(e){if(Te.isArray(e))for(n=0;n<this.animationPlayingActions.length;n++){for(var t=this.animationPlayingActions[n],i=!1,r=0;r<e.length;r++)if(e[r]==t.getClip().name){i=!0;break}i||(t.stop(),this.animationPlayingActions.splice(n,1),n--)}else if(Te.isString(e)){for(n=0;n<this.animationPlayingActions.length;n++)e!=(t=this.animationPlayingActions[n]).getClip().name&&(t.stop(),this.animationPlayingActions.splice(n,1),n--);for(n=0;n<this.animationPlayingActions.length;++n)this.animationPlayingActions[n].stop()}}else for(var n=0;n<this.animationPlayingActions.length;++n)this.animationPlayingActions[n].stop()},e.prototype.playAnimation=function(e,t){var i=(t=t||{}).speed||1,r=Te.parseValue(t.reverse,!1),n=Te.parseLoopType(t.loopType||t.loop),o=t.loopTimes||1/0,a=t.frames||null,s=t.complete,l=THREE.AnimationClip.findByName(this.animationClips,e);if(!l)return console.error("The '"+e+"' animation is not existing"),!1;var c=this.animationMixer.clipAction(l);if(!c)return!1;c.reset();var u=l.duration/i,h=c.isRunning();if(r&&n==THREE.LoopOnce&&(o=h?0:1,n=THREE.LoopRepeat),c.complete=s,c.paused=!1,c.clampWhenFinished=!0,c.setEffectiveWeight(1),c.setDuration(r?-u:u),c.setLoop(n,o),a){var p=0,d=1;Te.isArray(a)?(p=a[0],d=1<a.length?a[1]:1):Te.isNumber(a)?p=a:console.error("animation frames is invalid"),c.warp(p,d,u)}else c.stopWarping();return h||(c.isScheduled()?c.reset():c.play(),this._updatePlayingAnimation(c)),!0},e.prototype.isPlayingAnimation=function(e){return!!this.animationMixer&&this.animationMixer.isRunning(e)},n(e,[{key:"animationNames",get:function(){var e=[];if(this.animationClips)for(var t=0;t<this.animationClips.length;t++)e.push(this.animationClips[t].name);return e}}]),e}(),oi=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));return n._url="",n._animationControl=null,n}return o(t,e),t.prototype.loadModelResource=function(e){var t=(e=e||{}).url;if(t){var i=this.style,r={renderOrder:0,opacity:1,color:null,outlineColor:null,edgeColor:null,alwaysOnTop:!1,image:""};for(var n in r){var o=r[n];r[n]=i[n],i[n]=o}this._url&&(this.app.modelResource.unload(this._url),this._url=null);for(var a=this.node.children.concat(),s=0;s<a.length;s++)this.app.resourceManager.remove(a[s],!1);var l=this;this.loadFromURL(e,function(){for(var i in l._initBoxSize=null,l.customSetup(e),r)l.style[i]=r[i];var n=e.complete;n&&n.call(l,{object:l,url:t})})}},t.prototype.setupCustomKeys=function(e){var t=Te.parseValue(e.ON_IU,"oniu"),i=Te.parseValue(e.SJGN_IHT,"sjgniht"),r=Te.parseValue(e.IJ_EKOU_NUOY,"ijekounuoy"),n=Te.parseValue(e.RE_ISRAT,"reisrat");"naijil"!=t&&"NA_IJ_IL"!=t||(this.userData.bindFeatureOn=t),"auhnujuw"!=i&&"AU_HN_UJ_UW"!=i||(this.userData.SightTestOn=i),"nahoanehc"!=r&&"NA_HO_AN_EHC"!=r||(this.userData.LoopControlOn=r),"eilam"!=n&&"EI_LAM"!=n||(this.userData.bindFeatureOn=n)},t.prototype.setupAnimations=function(e){this.removeControl(this._animationControl);var t=e.animations,i=e.model;if(i&&(t||(t=i.animations)),t&&t.length){this._animationControl=new ni(t),this.addControl(this._animationControl);var r=e.animation;r&&this.playAnimation(r)}},t.prototype.setupTextureAnimations=function(){Ze.hasTextureAnimation(this.node)&&this.addControl(new Ze,"texAnimControl")},t.prototype.setupRoomOwner=function(e){var t=e.belongRoomUserID;t&&(this._belongRoomUserID=t)},t.prototype.customSetup=function(e){this.setupAnimations(e),this.setupTextureAnimations(e),this.setupCustomKeys(e),this.setupRoomOwner(e)},t.prototype.loadFromURL=function(e,t){this.addControl(new et(e,t))},t.prototype.containAnimation=function(e){return!!this._animationControl&&this._animationControl.containAnimation(e)},t.prototype.playAnimation=function(e){if(e=e||{},this.loaded){if(Te.isString(e))return this._stopAnimation(e),void this._playAnimation(e,null);var t=e.name;if(Te.isString(t))return this._stopAnimation(t),void this._playAnimation(t,e);if(Te.isArray(t)&&t.length){if(1==t.length)return this._stopAnimation(t[0]),void this._playAnimation(t[0],e);e=Te.cloneObject(e);var i=Te.parseArrayArgument(t,e,"speed"),r=Te.parseArrayArgument(t,e,"reverse"),n=Te.parseArrayArgument(t,e,"loop"),o=Te.parseArrayArgument(t,e,"loopType"),a=Te.parseArrayArgument(t,e,"loopTimes"),s=Te.parseArrayArgument(t,e,"frames");this._stopAnimation(t);for(var l=0;l<t.length;l++)Te.getArrayArgumentValue(e,"speed",i,l),Te.getArrayArgumentValue(e,"reverse",r,l),Te.getArrayArgumentValue(e,"loop",n,l),Te.getArrayArgumentValue(e,"loopType",o,l),Te.getArrayArgumentValue(e,"loopTimes",a,l),Te.getArrayArgumentValue(e,"frames",s,l),this._playAnimation(t[l],e)}}else this.waitCommands.push({type:"PlayObjectAnimation",object:this,params:e})},t.prototype._stopAnimation=function(e){this._animationControl&&this._animationControl.stopAnimation(e)},t.prototype._playAnimation=function(e,t){this._animationControl&&!this._animationControl.playAnimation(e,t)||(this.tickable=!0)},t.prototype.pauseAnimation=function(e){this._animationControl&&this._animationControl.pauseAnimation(e,!0),e||(this.tickable=!1)},t.prototype.resumeAnimation=function(e){this._animationControl&&this._animationControl.pauseAnimation(e,!1),this.tickable=!0},t.prototype.stopAnimation=function(e){this._animationControl&&this._animationControl.stopAnimation(e),e||(this.tickable=!1)},t.prototype.isPlayingAnimation=function(e){return!!this._animationControl&&this._animationControl.isPlayingAnimation(e)},t.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);return t.type="Thing",this._url&&(t.url=this._url),t},n(t,[{key:"isThing",get:function(){return!0}},{key:"animationNames",get:function(){return this._animationControl?this._animationControl.animationNames:[]}},{key:"url",get:function(){return this._url}},{key:"isOutdoors",get:function(){return!this.parents.query(".Building").length}},{key:"floor",get:function(){return this.parents.query(".Floor")[0]}},{key:"building",get:function(){return this.parents.query(".Building")[0]}},{key:"_temp_roomID",get:function(){return this._belongRoomUserID}}]),t}(Ye),ai=function(){function e(t,i){r(this,e),this.app=t,this.nodes=[],this.scene=this.app.scene,this.outdoors=this.app.outdoors,this.objectPool=this.app.objectPool,this.worldNode=new THREE.Object3D,this.campus=null,this.baseURL=null,this.curLoadGLTFIndex=0,this.splitLoadedGLTFCount=0,this.allLoadedGLTFCount=0,this.sliceRootNodeArray=[],this.sceneJsonData=null,this.states=null,this.loadSpeed=.1,this.isCamFitScene=!0,i&&(i.position&&(this.campusPosition=i.position),i.rotation&&(this.campusRotation=i.rotation),void 0!==i.isCamFitScene&&null!==i.isCamFitScene&&(this.isCamFitScene=i.isCamFitScene),void 0!==i.isDelayLoadFloorPlan&&null!==i.isDelayLoadFloorPlan&&(this.isDelayLoadFloorPlan=i.isDelayLoadFloorPlan),i.campus&&(this.campus=i.campus))}return e.prototype.load=function(e){var t=this;return this.baseURL=e,this.scene.add(this.worldNode),new Promise(function(e,i){t.loadSceneJson().then(function(i){t.parseObjects().then(function(){e(t.campus)})}).then(function(){e(t.campus)}).catch(function(e){i(e)})})},e.prototype.loadSceneJson=function(){var e=this;return new Promise(function(t,i){new THREE.FileLoader(e.app.loadingManager).load(e.baseURL+"/scene.json",function(i){var r=JSON.parse(i);e.sceneJsonData=r,t(r)},function(e){},function(e){i("cant not load file: scene.json")})})},e.prototype.parseObjects=function(){var e=this.sceneJsonData,t=this;return new Promise(function(i,r){t.parse(e).then(function(){t.sliceRootNodeArray=[],i()}).catch(function(e){r(e)})})},e.prototype.parse=function(e){var t=this;return new Promise(function(i,r){t.parseWorld(e),i()})},e.prototype.parseWorld=function(e){var t=this.worldNode;if(null==this.campus&&(this.campus=this.app.objectManager.create({type:"Campus",name:"Campus",node:t}),this.app.scene.add(this.campus.node)),this.campusRotation&&this.campus.node.quaternion.set(this.campusRotation.x,this.campusRotation.y,this.campusRotation.z,this.campusRotation.w),this.campusPosition&&(this.campus.position=this.campusPosition),e.outdoors&&this.parseOutdoors(e.outdoors,t),e.buildings){var i=e.buildings;for(var r in i){var n=i[r],o=new THREE.Vector3(0,0,0),a=r,s=void 0;n.name&&(a=n.name),n.id&&(s=n.id);var l=new THREE.Object3D,c=this.app.objectManager.create({type:"Building",name:a,id:s,parent:this.campus,node:l});if(c.app=this.app,c.node.position.x=o.x,c.node.position.y=o.y,c.node.position.z=o.z,n.plans&&this.parseFloorPlans(n.plans,c),n.facades){var u=n.facades;for(var h in u)this.createThing(u[h],c,"Facade")}if(n.facadegroups){var p=n.facadegroups;for(var d in p)n=p[d],this.createGroup(n,c,"Facade")}if(n.groups)for(var d in p=n.groups)n=p[d],this.createGroup(n,c)}}},e.prototype.parseOutdoors=function(e){var t=new THREE.Object3D;this.outdoors=this.app.objectManager.create({type:"Outdoors",name:"Outdoors",parent:this.campus,node:t}),this.app.outdoors||(this.app.outdoors=this.outdoors,this.app.currentParentObject=this.outdoors),this.processFloorPlanData(e,this.outdoors)},e.prototype.processFloorPlanData=function(e,t){t.app=this.app,e.placements&&this.parseThings(e.placements,t),e.videoprobes&&this.parseThings(e.videoprobes,t),e.groups&&this.parseGroups(e.groups,t),e.doororwindows&&this.parseDoorWins(e.doororwindows,t),e.rooms&&this.parseRooms(e.rooms,t)},e.prototype.parseRooms=function(e,t){for(var i=0;i<e.length;i++){var r=e[i],n=null;r.name&&(n=r.name);var o=new THREE.Object3D("room_temp"),a=null,s=r.properties;if(s)for(var l in a={},s){var c=s[l];a[l]=c}var u=null,h=null,p=null,d={};if(r.area&&(h=r.area,d.area=h),r.circumference&&(p=r.circumference,d.circumference=p),r.center){var f=r.center;(u=new THREE.Vector3).set(f[0],f[1],-f[2]),d.center=u}this.app.objectManager.create({type:"Room",name:n,node:o,id:void 0,parent:t,properties:a,auxiliaryInfo:d})}},e.prototype.parseDoorWins=function(e,t){for(var i in new THREE.Group("doors"),e){var r=e[i],n=i,o=void 0;r.name&&(n=r.name),r.id&&(o=r.id);var a=new THREE.Object3D("doororwin_temp"),s=null;if(r.properties){var l=r.properties;for(var c in s={},l){var u=l[c];s[c]=u}}this.app.objectManager.create({type:"Door",name:n,node:a,id:o,parent:t,properties:s})}},e.prototype.parseGroups=function(e,t){for(var i in e){var r=e[i];(r.name||r.properties)&&this.createGroup(r,t)}},e.prototype.createGroup=function(e,t){var i,r,n,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"Thing",a=new THREE.Object3D("group_temp");e.id&&(i=e.id),e.name&&(r=e.name);var s=e.properties;if(s)for(var l in n={},s){var c=s[l];n[l]=c}return this.app.objectManager.create({type:o,name:r,id:i,node:a,parent:t,properties:n})},e.prototype.parseFloorPlans=function(e,t){var i=[];for(var r in e){var n=e[r],o=n.id,a="";n.name&&(a=n.name);var s=new THREE.Object3D,l=this.app.objectManager.create({type:"Floor",name:a,id:o,node:s,parent:t});s.name="floorPlan",t.node.add(l.node),this.processFloorPlanData(n,l),i.push(l)}return i},e.prototype.parseThings=function(e,t,i){for(var r in e){var n=e[r];(n.name||n.properties)&&this.createThing(n,t,i)}},e.prototype.createThing=function(e,t,i){var r,n,o,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"Thing";e.id&&(r=e.id),e.name&&(n=e.name);var s=e.properties;if(s)for(var l in o={},s){var c=s[l];o[l]=c}var u=new THREE.Object3D("temp_cannotuse");return this.app.objectManager.create({type:a,name:n,node:u,id:r,parent:t,properties:o})},e}(),si=function(){function e(t,i){if(r(this,e),this.app=t,this.resourceUrl=null,this.relativeResourceUrl=null,this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.tempTexture=null,this.indexJson=i,this.sceneJsonUri="scene.json",this.defaultWallTextureUri="Textures/RoomWall.jpg",this.defaultWallEdgeTextureUri="Textures/WallEdge.jpg",this.defaultFloorTextureUri="Textures/FloorDefault.jpg",this.defaultCeilingTextureUri="Textures/CeilingDefault.jpg",this.defaultRoofTextureUri="Textures/RoofDefault.jpg",this.defaultWallTexture=null,this.defaultCeilingTexture=null,this.defaultFloorTexture=null,this.defaultRoofTexture=null,this.defaultWallEdgeTexture=null,this.worldNode=new THREE.Object3D("world"),this.isCamFitScene=!0,this.campus=null,this.outdoorsVisible=!0,this.campusVisible=!0,this.enableUseHighestVersionResource=!0,this.worldNode,i&&(i.position&&(this.campusPosition=i.position),i.rotation&&(this.campusRotation=i.rotation),void 0!==i.isCamFitScene&&null!==i.isCamFitScene&&(this.isCamFitScene=i.isCamFitScene),i.scale&&(this.campusScale=i.scale),void 0!==i.outdoorsVisible&&(this.outdoorsVisible=i.outdoorsVisible),void 0!==i.campusVisible&&(this.campusVisible=i.campusVisible),i.campus&&(this.campus=i.campus),void 0!==i.enableUseHighestVersionResource&&(this.enableUseHighestVersionResource=i.enableUseHighestVersionResource,json2mesh.DefaultSetting.enableUseHighestVersionResource=this.enableUseHighestVersionResource)),this.campus&&(this.campusRotation&&this.campus.node.quaternion.set(this.campusRotation.x,this.campusRotation.y,this.campusRotation.z,this.campusRotation.w),this.campusPosition&&(this.campus.position=this.campusPosition),this.campusScale&&(this.campus.scale=this.campusScale)),i&&i.default){var n=i.default;n.sceneJson&&(this.sceneJson="export.json"),n.wallTexture&&(this.defaultWallTextureUri=n.wallTexture),n.wallEdgeTexture&&(this.defaultWallEdgeTextureUri=n.wallEdgeTexture),n.floorTexture&&(this.defaultFloorTextureUri=n.floorTexture),n.ceilingTexture&&(this.defaultCeilingTextureUri=n.ceilingTexture),n.roofTexture&&(this.defaultRoofTextureUri=n.roofTexture)}this.app.options.loaderResourceUrl&&(this.resourceUrl=this.app.options.loaderResourceUrl),null!=this.app.options.enableUseHighestVersionResource&&(this.enableUseHighestVersionResource=this.app.options.enableUseHighestVersionResource,json2mesh.DefaultSetting.enableUseHighestVersionResource=this.enableUseHighestVersionResource),this.app.options.resourceLibraryUrl&&(this.resourceUrl=this.app.options.resourceLibraryUrl),this.indexJson&&this.indexJson.resourceLibrary&&(this.relativeResourceUrl=this.indexJson.resourceLibrary)}return e.prototype.parseCamInfo=function(e){var t=e.eye,i=e.target,r=t.split(" "),n=i.split(" "),o=[Number(r[0]),Number(r[1]),Number(r[2])];o[2]=-o[2];var a=[Number(n[0]),Number(n[1]),Number(n[2])];a[2]=-a[2],this.app.camera.position=o,this.app.camera.target=a},e.prototype.exportJsonString=function(e){for(var t=e.outdoors,i=e.buildings,r=[],n=[],o=0;o<t.things.length;o++){var a=t.things[o];r.push({id:a.id,name:a.name})}for(o=0;o<t.rooms.length;o++){var s=t.rooms[o];n.push({id:s.id,name:s.name})}var l=[];for(o=0;o<i.length;o++){for(var c=i[o],u=[],h=0;h<c.floors.length;h++){for(var p=c.floors[h],d=[],f=[],m=0;m<p.things.length;m++){var g=p.things[m];d.push({id:g.id,name:g.name})}for(m=0;m<p.rooms.length;m++)s=p.rooms[m],f.push({id:s.id,name:s.name});u.push({id:p.id,name:p.name,placements:d,rooms:f})}l.push({id:c.id,name:c.name,plans:u})}return{id:e.id,name:e.name,outdoors:{id:t.id,name:t.name,placements:r,rooms:n},buildings:l}},e.prototype.load=function(e){var t=this;if("String"===e.constructor.name)this.sceneURL=e;else if("Object"===e.constructor.name){var i=e;this.sceneURL=i.url,i.campus&&(this.campus=i.campus,this.worldNode=this.campus.node)}return this.relativeResourceUrl&&(this.resourceUrl=this.sceneURL+this.relativeResourceUrl),new Promise(function(e,i){t.updateProgress(.1),t.loadSceneJson().then(function(i){t.sceneJson=JSON.parse(i),t.sceneJson.camInfo&&t.isCamFitScene&&t.parseCamInfo(t.sceneJson.camInfo),t.updateProgress(.15);var r=new json2mesh.UBuilderSceneSimpleLoader;t.resourceUrl&&(r.resourceManager.baseTextureUrl=t.resourceUrl+"/texture/",r.resourceManager.baseModelUrl=t.resourceUrl+"/model/"),r.load({json:t.sceneJson,customModeBaseUrl:t.sceneURL+"/"}).then(function(i){t.parseWorld(i),t.updateProgress(.2),t.updateProgress(1),e(t.campus)})})})},e.prototype.loadSceneJson=function(){var e=this;return new Promise(function(t,i){new THREE.FileLoader(e.app.loadingManager).load(e.sceneURL+"/"+e.sceneJsonUri,function(e){t(e)})})},e.prototype.updateProgress=function(e){this.app.mainUI.updateLoadingProcess({object:this.campus,progress:e})},e.prototype.createTextureLoaderPromise=function(e){var t=this;return new Promise(function(i,r){(new THREE.TextureLoader).load(t.sceneURL+"/"+e,function(e){i(e)},function(t){console.log(e+" "+t.loaded/t.total*100+"% loaded")},function(t){console.log(e+"load error")})})},e.prototype.loadDefaultTexture=function(){var e=this;return new Promise(function(t,i){var r=e.createTextureLoaderPromise(e.defaultWallTextureUri),n=e.createTextureLoaderPromise(e.defaultWallEdgeTextureUri),o=e.createTextureLoaderPromise(e.defaultFloorTextureUri),a=e.createTextureLoaderPromise(e.defaultRoofTextureUri),s=e.createTextureLoaderPromise(e.defaultCeilingTextureUri);Promise.all([r,n,o,a,s]).then(function(e){DefaultResource.wallTexture=e[0],DefaultResource.wallEdgeTexture=e[1],DefaultResource.floorTexture=e[2],DefaultResource.ceilinngTexture=e[3],DefaultResource.roofTexture=e[4],t()})})},e.prototype.parseWorld=function(e){null===this.campus?(this.campus=this.app.objectManager.create({uuid:e.id,id:e.userID,type:"Campus",name:"Campus",node:this.worldNode}),this.campus.visible=this.campusVisible,this.campusRotation&&this.campus.node.quaternion.set(this.campusRotation.x,this.campusRotation.y,this.campusRotation.z,this.campusRotation.w),this.campusPosition&&(this.campus.position=this.campusPosition),this.campusScale&&(this.campus.scale=this.campusScale)):(this.campus.uuid=e.id,e.userID&&(this.campus.id=e.userID));for(var t=0;t<e.buildings.length;t++){var i=e.buildings[t];this.parseBuilding(i)}if(e.outdoors){var r=new THREE.Object3D("outdoors");r.name="plan",this.outdoors=this.app.objectManager.create({uuid:e.outdoors.id,id:e.outdoors.userID,type:"Outdoors",name:e.outdoors.name,parent:this.campus,node:r}),this.outdoors.visible=this.outdoorsVisible,this.parseFloorPlan(e.outdoors,this.outdoors)}},e.prototype.parseBuilding=function(e){var t=new THREE.Object3D("building");t.name="building";var i=this.app.objectManager.create({uuid:e.id,id:e.userID,type:"Building",name:e.name,parent:this.campus,node:t,properties:e.properties});i.localPosition=e.position;for(var r=e.floorplans,n=e.facades,o=e.facadeGroups,a=0;a<n.length;a++){var s=n[a];this.app.objectManager.create({type:"Facade",id:s.userID,name:s.name,uuid:s.id,node:s.delayObject,parent:i,properties:s.properties})}for(a=0;a<o.length;a++)s=o[a],this.app.objectManager.create({type:"Facade",uuid:s.id,id:s.userID,name:s.name,node:s.delayObject,parent:i,properties:s.properties});for(var l=0;l<r.length;l++){var c=r[l],u=new THREE.Object3D("floorplan");u.name="plan";var h=this.app.objectManager.create({id:c.userID,uuid:c.id,type:"Floor",name:c.name,properties:c.properties,node:u,parent:i});h.localPosition=c.position,this.parseFloorPlan(c,h),0!==i.facades.length&&(h.node.visible=!1)}},e.prototype.placementInitCallback=function(e){this.app.objectManager.create({id:e.id,name:e.name,node:e.mesh,parent:plan,animations:e.resource.animations,properties:e.properties})},e.prototype.parseOutdoors=function(e){},e.prototype.parseFloorPlan=function(e,t){for(var i=0;i<e.walls.length;i++)for(var r=e.walls[i],n=0;n<r.doorOrWindows.length;n++){var o=r.doorOrWindows[n],a="Door";if(o.jsonData&&o.jsonData.type&&(a=o.jsonData.type),o.mesh){var s=this.app.objectManager.create({type:"Door",uuid:o.id,id:o.userID,name:o.name,node:o.delayObject,parent:t,animations:o.resource.animations,properties:o.properties});if(o.isOpen&&s.open(),s.animationClips)for(n=0;n<s.animationClips.length;n++){var l=s.animationClips[n];if("_defaultAnim_"===l.name){s.playAnimation({name:l.name,loop:!0,speed:.15});break}}}else o.initCompleteCallback=function(e){e.jsonData&&e.jsonData.type&&e.jsonData.type;var i=b.app.objectManager.create({type:"Door",uuid:e.id,id:e.userID,name:e.name,node:e.mesh,parent:t,animations:e.resource.animations,properties:e.properties});if(t.miscNode.add(i.node),e.isOpen&&i.open(),i.animationClips)for(var r=0;r<i.animationClips.length;r++){var n=i.animationClips[r];if("_defaultAnim_"===n.name){i.playAnimation({name:n.name,loop:!0,speed:.15});break}}}}var c=new THREE.Object3D("combineFloor");for(i=0;i<e.combineFloors.length;i++){var u=e.combineFloors[i];c.add(u)}t.node.add(c),t.floorNode=c;var h=new THREE.Object3D("combineCeiling");for(i=0;i<e.combineCeilings.length;i++){var p=e.combineCeilings[i];h.add(p)}t.node.add(h),t.ceilingNode=h;var d=new THREE.Object3D("combineRoof");for(i=0;i<e.combineRoofs.length;i++){var f=e.combineRoofs[i];d.add(f)}t.node.add(d),t.roofNode=d;var m=new THREE.Object3D("combinePlacement");for(i=0;i<e.combinePlacements.length;i++){var g=e.combinePlacements[i];m.add(g)}t.node.add(m),t.miscNode=m;for(var v=new THREE.Object3D("combineWall"),y=0;y<e.combineStraightManualWalls.length;y++)r=e.combineStraightManualWalls[y],v.add(r);for(y=0;y<e.combineModelWalls.length;y++)r=e.combineModelWalls[y],v.add(r);for(y=0;y<e.combineDoorOrWins.length;y++)g=e.combineDoorOrWins[y],v.add(g);for(t.node.add(v),t.wallNode=v,i=0;i<e.groups.length;i++)g=e.groups[i],a="Thing",g.jsonData&&g.jsonData.type&&(a=g.jsonData.type),s=this.app.objectManager.create({uuid:g.id,id:g.userID,name:g.name,node:g.delayObject,belongRoomUserID:g.belongRoomUserID,type:a,parent:t,properties:g.properties});var b=this;for(i=0;i<e.placements.length;i++)if(g=e.placements[i],a="Thing",g.jsonData&&g.jsonData.type&&(a=g.jsonData.type),g.mesh){if((s=this.app.objectManager.create({uuid:g.id,id:g.userID,name:g.name,type:a,belongRoomUserID:g.belongRoomUserID,node:g.delayObject,parent:t,url:g.resource.getModelUrl(),animations:g.resource.animations,properties:g.properties})).bundleID=g.resource.modelID,s.bundleName=g.resource.modelName,g.isPlayAnim&&s.containAnimation(g.animClip)){var _={name:g.animClip,loop:!1,speed:.15};g.hasSkin&&(_.loop=!0),s.playAnimation(_)}}else g.initCompleteCallback=function(e){a="Thing",e.jsonData&&e.jsonData.type&&(a=e.jsonData.type);var i=b.app.objectManager.create({uuid:e.id,id:e.userID,belongRoomUserID:e.belongRoomUserID,name:e.name,node:e.mesh,parent:t,type:a,url:e.resource.getModelUrl(),animations:e.resource.animations,properties:e.properties});if(i.bundleID=e.resource.modelID,i.bundleName=e.resource.modelName,t.miscNode.add(i.node),e.isPlayAnim&&i.containAnimation(e.animClip)){var r={name:e.animClip,loop:!1,speed:.15};e.hasSkin&&(r.loop=!0),i.playAnimation(r)}};for(i=0;i<e.videoprobes.length;i++)(g=e.videoprobes[i]).mesh?s=this.app.objectManager.create({id:g.userID,name:g.name,uuid:g.id,belongRoomUserID:g.belongRoomUserID,node:g.delayObject,parent:t,url:g.resource.getModelUrl(),animations:g.resource.animations,properties:g.properties}):g.initCompleteCallback=function(e){var i=b.app.objectManager.create({id:e.userID,name:e.name,uuid:e.id,belongRoomUserID:e.belongRoomUserID,node:e.mesh,parent:t,url:e.resource.getModelUrl(),animations:e.resource.animations,properties:e.properties});t.miscNode.add(i.node)};for(i=0;i<e.rooms.length;i++){var x=e.rooms[i];u=this.app.objectManager.create({type:"Room",name:x.name,node:x.mesh,uuid:x.id,id:x.userID,ceilingNode:x.ceiling.mesh,roofNode:x.roof.mesh,floorNode:x.floor.mesh,parent:t,properties:x.properties})}for(i=0;i<e.curvelines.length;i++){var E=e.curvelines[i];this.parseCurveLines(E,t)}for(i=0;i<e.pipelines.length;i++)E=e.pipelines[i],this.parsePipeLines(E,t)},e.prototype.parsePipeLines=function(e,t){var i={type:"PolygonLine",name:e.name,points:e.points,id:e.userID,uuid:e.id,parent:t,style:{}};e.color&&(i.style.color="#"+e.color.getHexString());var r=this;if(e.resource)e.initCompleteCallback=function(t){i.image=t.resource.getTextureUrl();var n=r.app.objectManager.create(i);n.node.position.set(e.position.x,e.position.y,e.position.z),e.sectionType&&"Triangle"===e.sectionType&&(n.pathRadialSegments=3,n._updateByPoints()),e.radius&&(n.width=e.radius)};else{var n=r.app.objectManager.create(i);n.node.position.set(e.position.x,e.position.y,e.position.z),e.sectionType&&"Triangle"===e.sectionType&&(n.pathRadialSegments=3,n._updateByPoints()),e.radius&&(n.width=e.radius)}},e.prototype.parseCurveLines=function(e,t){var i={type:"RouteLine",parent:t,name:e.name,uuid:e.id,id:e.userID,points:e.points,arrowFlag:!1,style:{}},r=this;if(e.color&&(i.style.color="#"+e.color.getHexString()),e.resource)e.initCompleteCallback=function(t){if(t.resource.texture){var n=t.resource.texture.clone();n.rotation=Math.PI/2,i.image=n}var o=r.app.objectManager.create(i);null!==e.width&&(o.width=e.width),o.node.position.set(e.position.x,e.position.y,e.position.z)};else{var n=r.app.objectManager.create(i);null!==e.width&&(n.width=e.width),n.node.position.set(e.position.x,e.position.y,e.position.z)}},e}(),li=(function(e){!function(t){var i,r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag",c=t.regeneratorRuntime;if(c)e.exports=c;else{(c=t.regeneratorRuntime=e.exports).wrap=b;var u="suspendedStart",h="suspendedYield",p="executing",d="completed",f={},m={};m[a]=function(){return this};var g=Object.getPrototypeOf,v=g&&g(g(C([])));v&&v!==r&&n.call(v,a)&&(m=v);var y=w.prototype=x.prototype=Object.create(m);E.prototype=y.constructor=w,w.constructor=E,w[l]=E.displayName="GeneratorFunction",c.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===E||"GeneratorFunction"===(t.displayName||t.name))},c.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,l in e||(e[l]="GeneratorFunction")),e.prototype=Object.create(y),e},c.awrap=function(e){return{__await:e}},T(S.prototype),S.prototype[s]=function(){return this},c.AsyncIterator=S,c.async=function(e,t,i,r){var n=new S(b(e,t,i,r));return c.isGeneratorFunction(t)?n:n.next().then(function(e){return e.done?e.value:n.next()})},T(y),y[l]="Generator",y[a]=function(){return this},y.toString=function(){return"[object Generator]"},c.keys=function(e){var t=[];for(var i in e)t.push(i);return t.reverse(),function i(){for(;t.length;){var r=t.pop();if(r in e)return i.value=r,i.done=!1,i}return i.done=!0,i}},c.values=C,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=i,this.done=!1,this.delegate=null,this.method="next",this.arg=i,this.tryEntries.forEach(P),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=i)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,n){return s.type="throw",s.arg=e,t.next=r,n&&(t.method="next",t.arg=i),!!n}for(var o=this.tryEntries.length-1;0<=o;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var l=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(l&&c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;0<=i;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,f):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),P(i),f}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var r=i.completion;if("throw"===r.type){var n=r.arg;P(i)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:C(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=i),f}}}function b(e,t,i,r){var n,o,a,s,l=t&&t.prototype instanceof x?t:x,c=Object.create(l.prototype),m=new A(r||[]);return c._invoke=(n=e,o=i,a=m,s=u,function(e,t){if(s===p)throw new Error("Generator is already running");if(s===d){if("throw"===e)throw t;return O()}for(a.method=e,a.arg=t;;){var i=a.delegate;if(i){var r=M(i,a);if(r){if(r===f)continue;return r}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(s===u)throw s=d,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);s=p;var l=_(n,o,a);if("normal"===l.type){if(s=a.done?d:h,l.arg===f)continue;return{value:l.arg,done:a.done}}"throw"===l.type&&(s=d,a.method="throw",a.arg=l.arg)}}),c}function _(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(e){return{type:"throw",arg:e}}}function x(){}function E(){}function w(){}function T(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function S(e){var t;this._invoke=function(i,r){function o(){return new Promise(function(t,o){!function t(i,r,o,a){var s=_(e[i],e,r);if("throw"!==s.type){var l=s.arg,c=l.value;return c&&"object"==typeof c&&n.call(c,"__await")?Promise.resolve(c.__await).then(function(e){t("next",e,o,a)},function(e){t("throw",e,o,a)}):Promise.resolve(c).then(function(e){l.value=e,o(l)},a)}a(s.arg)}(i,r,t,o)})}return t=t?t.then(o,o):o()}}function M(e,t){var r=e.iterator[t.method];if(r===i){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=i,M(e,t),"throw"===t.method))return f;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var n=_(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,f;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=i),t.delegate=null,f):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,f)}function R(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(R,this),this.reset(!0)}function C(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=i,t.done=!0,t};return o.next=o}}return{next:O}}function O(){return{value:i,done:!0}}}(function(){return this}()||Function("return this")())}(Kt={exports:{}}),Kt.exports),ci=function(){return this}()||Function("return this")(),ui=ci.regeneratorRuntime&&0<=Object.getOwnPropertyNames(ci).indexOf("regeneratorRuntime"),hi=ui&&ci.regeneratorRuntime;ci.regeneratorRuntime=void 0;var pi=li;if(ui)ci.regeneratorRuntime=hi;else try{delete ci.regeneratorRuntime}catch(y){ci.regeneratorRuntime=void 0}var di,fi,mi=pi,gi=function e(t,i,n,o){r(this,e),this.positionArray=t.geometry.getAttribute("position").array.slice();var a=t.geometry.getAttribute("normal");a?this.normalArray=a.array.slice():console.warn("not has normal");var s=t.geometry.getAttribute("uv");s&&(this.uvArray=s.array);var l=t.geometry.getAttribute("uv2");l&&(this.uv2Array=l.array);var c=t.geometry.getAttribute("color");c&&(this.colorArray=c.array),this.indexArray=t.geometry.index.array,this.material=t.material;for(var u=this.positionArray,h=this.normalArray,p=0;p<u.length;){for(var d=o.length-1;-1<d;d--){var f=i[d],m=n[d],g=o[d];u[p]*=f.x,u[p+1]*=f.y,u[p+2]*=f.z;var v=new THREE.Vector3(u[p],u[p+1],u[p+2]);if((v=v.applyQuaternion(m)).x+=g.x,v.y+=g.y,v.z+=g.z,u[p]=v.x,u[p+1]=v.y,u[p+2]=v.z,h){var y=new THREE.Vector3(h[p],h[p+1],h[p+2]);y=y.applyQuaternion(m),h[p]=y.x,h[p+1]=y.y,h[p+2]=y.z}}p+=3}this.vertexCount=this.positionArray.length/3,this.indexCount=this.indexArray.length},vi=function(){function e(t){r(this,e),this.bundeObj=t,this.materialMap=new Map,this.combineBundleMeshs=[]}return e.prototype.combine=function(){this._combine(this.bundeObj,[],[],[])},e.prototype._combine=function(e,t,i,r){if(t.push(e.scale),r.push(e.position),i.push(e.quaternion),e instanceof THREE.Mesh){var n=new gi(e,t,i,r);0!==n.vertexCount&&(this.combineBundleMeshs.push(n),void 0===this.materialMap.get(n.material)&&this.materialMap.set(n.material,[]),this.materialMap.get(n.material).push(n))}if(0!==e.children.length)for(var o=0;o<e.children.length;o++){var a=i.slice(),s=t.slice(),l=r.slice();this._combine(e.children[o],s,a,l)}},e}(),yi=function e(){r(this,e),this.positions=[],this.scales=[],this.quaternions=[]},bi=function(){function e(t){r(this,e),this.vertexCount=0,this.indexCount=0,this.material=t,this.bundeMeshs=[],this.transformations=[],this.maxCount=65534,this.combineMesh=null}return e.prototype.isExceed=function(e){return this.vertexCount+e>this.maxCount},e.prototype.add=function(e,t){if(this.isExceed(e.vertexCount))return console.error("combine exceed vertex count "),!1;this.vertexCount+=e.vertexCount,this.indexCount+=e.indexCount,this.bundeMeshs.push(e),this.transformations.push(t)},e.prototype.build=function(){for(var e=this.bundeMeshs,t=this.indexCount,i=this.vertexCount,r=new Float32Array(3*i),n=new Float32Array(3*i),o=new Float32Array(2*i),a=new Float32Array(4*i),s=new Float32Array(2*i),l=new Uint16Array(t),c=0,u=0,h=0,p=0,d=0,f=new THREE.BufferGeometry,m=0;m<e.length;m++){for(var g=e[m],v=this.transformations[m],y=v.positions,b=v.scales,_=v.quaternions,x=g.indexArray,E=0;E<x.length;E++)l[E+p]=c/3+x[E];p+=x.length;var w=g.positionArray;for(E=0;E<w.length;){for(var T=new THREE.Vector3(w[E],w[E+1],w[E+2]),S=y.length-1;-1<S;S--){var M=y[S],R=b[S],P=_[S];T.x*=R.x,T.y*=R.y,T.z*=R.z,(T=T.applyQuaternion(P)).x+=M.x,T.y+=M.y,T.z+=M.z}r[E+c]=T.x,r[E+c+1]=T.y,r[E+c+2]=T.z,E+=3}c+=w.length;var A=g.normalArray;for(E=0;E<A.length;){var C=new THREE.Vector3(A[E],A[E+1],A[E+2]);for(S=_.length-1;-1<S;S--)P=_[S],C=C.applyQuaternion(P);n[E+u]=C.x,n[E+u+1]=C.y,n[E+u+2]=C.z,E+=3}u+=A.length;var O=g.uvArray;if(O)for(E=0;E<O.length;E++)o[E+h]=O[E];var L=g.uv2Array;if(L)for(E=0;E<L.length;E++)s[E+h]=L[E];O&&(h+=O.length);var k=g.colorArray;if(k){for(E=0;E<k.length;E++)a[E+d]=k[E];d+=k.length}}f.addAttribute("position",new THREE.BufferAttribute(r,3)),f.addAttribute("normal",new THREE.BufferAttribute(n,3)),f.addAttribute("uv",new THREE.BufferAttribute(o,2)),0!==s.length&&f.addAttribute("uv2",new THREE.BufferAttribute(s,2)),0!==a.length&&f.addAttribute("color",new THREE.BufferAttribute(a,4)),f.setIndex(new THREE.BufferAttribute(l,1));var H=new THREE.Mesh(f,this.material);this.material.defines&&this.material.defines.USE_ALPHAINDEX&&delete this.material.defines.USE_ALPHAINDEX,H.name="combine",this.combineMesh=H},e}(),_i=function(){function e(t){r(this,e),this.app=t,this.combineBundleObjectMap={},this.processorMap=new Map,this.floorMaterialMap=new Map,this.processors=[]}return e.prototype.combineModels=function(){var e=this.app.modelResource.models,t=[],i=this;for(var r in e)t.push(new Promise(function(t,n){var o=performance.now(),a=new vi(e[r].node);(i.combineBundleObjectMap[r]=a).combine(),.1<performance.now()-o?setTimeout(function(){t()},10):t()}));return Promise.all(t)},e.prototype.getModelObject=function(e){return this.combineBundleObjectMap[e]||null},e.prototype.addPlacement=function(e,t,i,r,n){var o=this.floorMaterialMap.get(e);o||(o=new Map,this.floorMaterialMap.set(e,o));var a=this.processorMap.get(e);a||(this.processorMap.set(e,[]),a=this.processorMap.get(e));var s=new yi;s.positions=i,s.scales=r,s.quaternions=n,this.combineBundleObjectMap[t].materialMap.forEach(function(e,t,i){for(var r=e,n=t,l=0;l<r.length;l++){var c=r[l],u=o.get(n);u&&!u.isExceed(c.vertexCount)||(u=new bi(n),o.set(n,u),a.push(u)),u.add(c,s)}})},e.prototype.getCombineProcessors=function(e,t,i,r){var n=[],o=new Map;for(var a in e){var s=e[a];if(!s.uid&&!s.name){var l=this.app.modelResource.bundleIDArray[s.bIdx],c=(this.app.modelResource.get(l).node,new THREE.Vector3(0,0,0)),u=new yi;if(s.pos){var h=s.pos.split(" ");c.x=parseFloat(h[0]),c.y=parseFloat(h[1]),c.z=-parseFloat(h[2])}var p=new THREE.Vector3(1,1,1);if(s.scl){var d=s.scl.split(" ");p.x=parseFloat(d[0]),p.y=parseFloat(d[1]),p.z=parseFloat(d[2])}var f=new THREE.Quaternion(0,0,0,1);if(s.rot){var m=s.rot.split(" ");f.x=parseFloat(m[0]),f.y=parseFloat(m[1]),f.z=-parseFloat(m[2]),f.w=-parseFloat(m[3])}var g=t.slice(),v=i.slice(),y=r.slice();y.push(f),v.push(p),g.push(c),u.positions=g,u.scales=v,u.quaternions=y,this.combineBundleObjectMap[l].materialMap.forEach(function(e,t,i){for(var r=e,a=t,s=0;s<r.length;s++){var l=r[s],c=o.get(a);c&&!c.isExceed(l.vertexCount)||(c=new bi(a),o.set(a,c),n.push(c)),c.add(l,u)}})}}return n},e}(),xi=function(){function e(t){r(this,e),this.app=t,this.nodes=[],this.scene=this.app.scene,this.objectPool=this.app.objectPool,this.worldNode=new THREE.Object3D,this.app.scene.add(this.worldNode),this.baseURL=t.sceneURL,this.curLoadGLTFIndex=0,this.splitLoadedGLTFCount=0,this.allLoadedGLTFCount=0,this.sliceRootNodeArray=[],this.sceneJsonData=null,this.states=null,this.combineManager=new _i(this.app),this.combineProcessorMap=new Map,this.loadSpeed=.1}return e.prototype.load=function(){var e=this;return new Promise(function(t,i){e.loadSceneJson().then(function(t){return t.camInfo&&(e.parseCamInfo(t.camInfo),e.app.camera.update()),e.sceneJsonData=t,e.loadStructureJson()}).then(function(t){var i=e.getSortedStructureGLTFs(t);return new Promise(function(t,r){e.loadStructure(i,function(){e.parseObjects().then(function(){t(e.worldNode)})})})}).then(function(){t(e.worldNode)}).catch(function(e){i(e)})})},e.prototype.loadSceneJson=function(){var e=this;return new Promise(function(t,i){(new THREE.FileLoader).load(e.baseURL+"/scene.json",function(e){var i=JSON.parse(e);t(i)},function(e){},function(e){i("cant not load file: scene.json")})})},e.prototype.loadStructureJson=function(){var e=this;return new Promise(function(t,i){(new THREE.FileLoader).load(e.baseURL+"/structure.json",function(e){var i=JSON.parse(e);t(i)},function(){},function(e){i("cant not load file: structure.json")})})},e.prototype.loadStructure=function(e,t,i){this.splitLoadedGLTFCount=0;var r=this,n=0;if(0==e.length)t&&t();else for(var o=r.curLoadGLTFIndex;o<e.length&&(0==n||n%10!=0);o++){n++,r.curLoadGLTFIndex++;var a=new THREE.GLTFLoader(r.app.loadingManager);a.setCrossOrigin("anonymous"),a.load(r.baseURL+"/"+e[o].path,function(n){var o=n.scene.children[0].children[0];r.nodes[o.name]=o,r.sliceRootNodeArray.push(o),o.traverse(function(e){r.nodes[e.name]=e}),r.splitLoadedGLTFCount++,r.allLoadedGLTFCount++,10===r.splitLoadedGLTFCount&&r.loadStructure(e,t,i),r.app.scene.add(o),r.allLoadedGLTFCount==e.length&&t&&t()},function(){},function(t){i&&i("load "+r.baseURL+"/"+e[o].path+" failed")})}},e.prototype.parseObjects=function(){var e=this.sceneJsonData,t=this;return e.bIdList?new Promise(function(i,r){t.parseBundleList(e.bIdList).then(function(){return t.parse(e)}).then(function(){t.sliceRootNodeArray=[],i()}).catch(function(e){r(e)})}):new Promise(function(i,r){t.parse(e).then(function(){t.sliceRootNodeArray=[],i()}).catch(function(e){r(e)})})},e.prototype.getSortedStructureGLTFs=function(e){var t=[],i=[],r=[],n=e.outdoors,o=e.buildings;for(var a in n){var s=n[a];t.push(s)}for(var l=0;l<t.length;l++){var c=t[l];if(0!=i.length)for(var u=0;u<i.length;u++){var h=i[u];if(c.size<h.size){i.splice(u,0,c);break}if(u==i.length-1){i.push(c);break}}else i.push(t[l])}for(var a in t=[],o)t.push(o[a]);for(l=0;l<t.length;l++)if(c=t[l],0!=r.length)for(u=0;u<r.length;u++){if(h=r[u],c.size<h.size){r.splice(u,0,c);break}if(u==r.length-1){r.push(c);break}}else r.push(t[l]);return i.concat(r)},e.prototype._nestingLoopYield=function(e,t,i){var r=this,n=e.next();if(n.done)return t&&t(),n.value;var o=n.value;n.done,o instanceof Promise?o.then(function(n){return r._nestingLoopYield(e,t,i)}).catch(function(e){i(e)}):this._nestingLoopYield(e,t,i)},e.prototype.parse=function(e){var t=this;return this.combineManager.combineModels().then(function(){return new Promise(function(i,r){if(e.objects){var n=e.objects,o=null;for(var a in n){o=n[a];break}t._nestingLoopYield(t.parseWorld(o),function(){i()})}if(e.camInfo){var s=e.camInfo;t.parseCamInfo(s)}})})},e.prototype.parseCamInfo=function(e){var t=e.eye,i=e.target,r=t.split(" "),n=i.split(" "),o=[Number(r[0]),Number(r[1]),Number(r[2])];o[2]=-o[2];var a=[Number(n[0]),Number(n[1]),Number(n[2])];a[2]=-a[2],this.app.camera.position=o,this.app.camera.target=a},e.prototype.parseWorld=function(e){var t=mi.mark(v),i=this.worldNode;if(e.plan&&this.parseOutdoors(e.plan,i),e.bds){var r=e.bds;for(var n in r){var o=r[n],a=new THREE.Vector3(0,0,0);if(o.pos){var s=o.pos.split(" ");a.x=parseFloat(s[0]),a.y=parseFloat(s[1]),a.z=-parseFloat(s[2])}var l=new THREE.Object3D,c=this.app.objectManager.create({type:"Building",name:n,node:l});if(c.name=n,c.app=this.app,c.id=n,i.add(l),o.plans&&this.parseFloorPlans(o.plans,c),o.facades){var u=o.facades;for(var h in u){var p=this.createThing(u[h],c,null,"Facade"),d=p.node.position;d.x+=a.x,d.y+=a.y,d.z+=a.z,p.node.position.set(d.x,d.y,d.z)}}if(o.groups){var f=o.groups;for(var m in f)o=f[m],this.createGroup(o,c)}}}var g=this;function v(e){var i,r,n,o,a,s,l,c,u;return mi.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:i=g.loadSpeed,r=10,n=e.keys(),o=Array.isArray(n),a=0,n=o?n:n[Symbol.iterator]();case 3:if(!o){t.next=9;break}if(a>=n.length)return t.abrupt("break",24);t.next=6;break;case 6:s=n[a++],t.next=13;break;case 9:if((a=n.next()).done)return t.abrupt("break",24);t.next=12;break;case 12:s=a.value;case 13:l=s,c=e.get(l),u=0;case 16:if(u<c.length)return t.next=19,new Promise(function(e,t){var n=performance.now();c[u].build();var o=c[u].combineMesh;l.node.add(o);var a=performance.now()-n;i<a?setTimeout(function(){e()},r):e()});t.next=22;break;case 19:u++,t.next=16;break;case 22:t.next=3;break;case 24:case"end":return t.stop()}},t,this)}return v(this.combineProcessorMap)},e.prototype.parseOutdoors=function(e,t){var i,r;for(var n in e){r=e[n],i=n;break}var o=this.app.outdoors;this.worldNode.add(o.node),this.processFloorPlanData(i,r,o)},e.prototype.processFloorPlanData=function(e,t,i){i.name=e,i.app=this.app,i.id=e;var r=new THREE.Vector3(0,0,0);if(t.pos){var n=t.pos.split(" ");r.x=parseFloat(n[0]),r.y=parseFloat(n[1]),r.z=-parseFloat(n[2])}var o=t.cwalls;if(o){var a=new THREE.Group;for(var s in a.name="combinewall",o){var l=o[s].gltfid,c=this.nodes[l];c&&a.add(c)}i.node.add(a),a.updateMatrixWorld(),i.wallNode=a}var u=t.croofs;if(u){var h=new THREE.Group;for(var s in h.name="combineroof",u){l=u[s].gltfid;var p=this.nodes[l];p&&h.add(p)}i.node.add(h),i.roofNode=h}var d=t.cceilings;if(d){var f=new THREE.Group;for(var s in f.name="combineceiling",d){l=d[s].gltfid;var m=this.nodes[l];m&&f.add(m)}i.node.add(f),i.ceilNode=f}if(v=t.cfloors){var g=new THREE.Group;for(var s in g.name="combinefloor",v){var v;if(l=(v=v[s]).gltfid){var y=this.nodes[l];y&&g.add(y)}}i.node.add(g),i.floorNode=g}var b=new THREE.Group;b.name="combinePlacement",i.miscNode=b,i.node.add(b);var _=t.cplcs;if(_)for(var s in _){l=_[s].gltfid;var x=this.nodes[l];x&&(b.add(x),x.updateMatrixWorld())}if(t.plcs){var E=this.combineManager.getCombineProcessors(t.plcs,[r],[new THREE.Vector3(1,1,1)],[new THREE.Quaternion(0,0,0,1)]);this.combineProcessorMap.set(i,E),this.parseThings(t.plcs,i,r)}t.routes&&this.parseStructureThing(t.routes,i),t.pipelines&&this.parseStructureThing(t.pipelines,i),t.curvelines&&this.parseStructureThing(t.curvelines,i),t.arrowlines&&this.parseStructureThing(t.arrowlines,i),t.arrowdatalines&&this.parseStructureThing(t.arrowdatalines,i),t.leakwaterlines&&this.parseStructureThing(t.leakwaterlines,i),t.vps&&this.parseThings(t.vps,i,r),t.groups&&this.parseGroups(t.groups,i,[new THREE.Vector3(1,1,1)],[new THREE.Quaternion(0,0,0,1)],[r],r),t.dws&&this.parseDoorWins(t.dws,i,r)},e.prototype.parseDoorWins=function(e,t,i){for(var r in e){var n=e[r],o=r;n.uid&&(o=n.uid);var a=null;if(n.gltfid){var s=n.gltfid;this.nodes[s]&&((a=this.nodes[s]).position.x+=i.x,a.position.y+=i.y,a.position.z+=i.z,t.node.add(a))}var l=null;if(n.prop){var c=n.prop;for(var u in l={},c){var h=c[u];l[u]=h}}this.app.objectManager.create({type:"Door",name:o,node:a,parent:t,properties:l})}},e.prototype.parseGroups=function(e,t,i,r,n,o){for(var a in e){var s=e[a];s.uid?this.createGroup(s,t):this.combineGroup(s,t,i,r,n,o)}},e.prototype.createGroup=function(e,t){var i,r,n=this.instanceGroup(e);e.id&&e.id,e.uid&&(i=e.uid);var o=e.prop;if(o)for(var a in r={},o){var s=o[a];r[a]=s}return this.app.objectManager.create({type:"Thing",name:i,node:n,parent:t,properties:r})},e.prototype.parseFloorPlans=function(e,t){var i=[];for(var r in e){var n=e[r],o=new THREE.Object3D,a=this.app.objectManager.create({type:"Floor",name:r,node:o,parent:t});a.id=r,o.name="floorPlan",t.node.add(a.node),this.processFloorPlanData(r,n,a),a._parent=t,i.push(a)}return i},e.prototype.parseBundleList=function(e){this.app.modelResource.bundleIDArray=e;var t=0,i=this;return new Promise(function(r,n){0!=e.length?e.forEach(function(o){var a=new THREE.GLTFLoader(i.app.loadingManager);a.setCrossOrigin("anonymous"),a.load(i.baseURL+"/"+o+"/scene.gltf",function(n){t++,i.app.modelResource.set(o,n.scene.children[0].children[0]),t==e.length&&r()},function(){},function(e){n("can not load "+i.baseURL+"/"+o+"/scene.gltf")})}):r()})},e.prototype.combineGroup=function(e,t,i,r,n,o){var a=e,s=new THREE.Vector3(0,0,0);if(a.pos){var l=a.pos.split(" ");s.x=parseFloat(l[0]),s.y=parseFloat(l[1]),s.z=-parseFloat(l[2])}var c=new THREE.Vector3(1,1,1);if(a.scl){var u=a.scl.split(" ");c.x=parseFloat(u[0]),c.y=parseFloat(u[1]),c.z=parseFloat(u[2])}var h,p,d,f=new THREE.Quaternion(0,0,0,1);if(a.rot&&(u=a.rot.split(" "),f.x=parseFloat(u[0]),f.y=parseFloat(u[1]),f.z=-parseFloat(u[2]),f.w=-parseFloat(u[3])),n?(h=i.slice(),d=r.slice(),p=n.slice()):(h=[],p=[],d=[]),h.push(c),p.push(s),d.push(f),a.plcs){var m=this.combineManager.getCombineProcessors(a.plcs,p,h,d),g=this.combineProcessorMap.get(t);g&&(m=g.concat(m)),this.combineProcessorMap.set(t,m)}if(a.groups)for(var v in a.groups)this.combineGroup(a.groups[v],t,h,d,p,o)},e.prototype.instanceGroup=function(e){var t=new THREE.Vector3(0,0,0);if(e.pos){var i=e.pos.split(" ");t.x=parseFloat(i[0]),t.y=parseFloat(i[1]),t.z=-parseFloat(i[2])}var r=new THREE.Vector3(1,1,1);if(e.scl){var n=e.scl.split(" ");r.x=parseFloat(n[0]),r.y=parseFloat(n[1]),r.z=parseFloat(n[2])}var o=new THREE.Quaternion(0,0,0,1);e.rot&&(n=e.rot.split(" "),o.x=parseFloat(n[0]),o.y=parseFloat(n[1]),o.z=-parseFloat(n[2]),o.w=-parseFloat(n[3]));var a=new THREE.Group;if(e.plcs)for(var s in e.plcs){var l=this.instanceChildOfGroup(e.plcs[s]);a.add(l)}if(e.groups)for(var s in e.groups)l=this.instanceGroup(e.plcs[s]),a.add(l);return a.scale.copy(r),a.setRotationFromQuaternion(o),a.position.copy(t),a},e.prototype.instanceChildOfGroup=function(e){var t=this.app.modelResource.bundleIDArray[e.bIdx],i=this.app.modelResource.get(t).node.clone();if(e.pos){var r=e.pos.split(" ");i.position.x=parseFloat(r[0]),i.position.y=parseFloat(r[1]),i.position.z=-parseFloat(r[2])}if(e.rot){r=e.rot.split(" ");var n=new THREE.Quaternion;n.x=parseFloat(r[0]),n.y=parseFloat(r[1]),n.z=-parseFloat(r[2]),n.w=-parseFloat(r[3]),i.setRotationFromQuaternion(n)}return i},e.prototype.parseThings=function(e,t,i){for(var r in e){var n=e[r];(n.uid||n.prop)&&this.createThing(n,t,i)}},e.prototype.createThing=function(e,t,i){var r,n,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"Thing";e.id&&e.id,e.uid&&(r=e.uid);var a=e.prop;if(a)for(var s in n={},a){var l=a[s];n[s]=l}var c=this.app.modelResource.bundleIDArray[e.bIdx],u=this.app.modelResource.get(c).node.clone();if(e.pos){var h=e.pos.split(" "),p=new THREE.Vector3(parseFloat(h[0]),parseFloat(h[1]),-parseFloat(h[2]));i&&(p.x+=i.x,p.y+=i.y,p.z+=i.z),u.position.x=p.x,u.position.y=p.y,u.position.z=p.z}if(e.rot){h=e.rot.split(" ");var d=new THREE.Quaternion;d.x=parseFloat(h[0]),d.y=parseFloat(h[1]),d.z=-parseFloat(h[2]),d.w=-parseFloat(h[3]),u.setRotationFromQuaternion(d)}if(e.scl){h=e.scl.split(" ");var f=new THREE.Vector3;f.x=parseFloat(h[0]),f.y=parseFloat(h[1]),f.z=-parseFloat(h[2]),u.scale.x=f.x,u.scale.y=f.y,u.scale.z=f.z}return this.app.objectManager.create({type:o,name:r,node:u,parent:t,properties:n})},e.prototype.parseStructureThing=function(e,t,i){for(var r in e){var n=e[r];if(n.gltfid){var o=new oi(this.app);o.name=r,o.app=this.app,n.id&&(o.id=n.id),n.uid&&(o.name=n.uid);var a=n.gltfid;if(this.nodes[a]){var s=this.nodes[a];o.node=s,t.add(o),i&&(s.position.x=i.x,s.position.y=i.y,s.position.z=i.z)}}}},e}(),Ei=function(){function e(t,i){r(this,e),this.app=t,this.nodes=[],this.outdoors=this.app.outdoors,this.objectPool=this.app.objectPool,this.worldNode=new THREE.Object3D,this.worldNode.name="world",this.campus=null,this.baseURL=null,this.curLoadGLTFIndex=0,this.splitLoadedGLTFCount=0,this.allLoadedGLTFCount=0,this.sliceRootNodeArray=[],this.sceneJsonData=null,this.states=null,this.combineManager=new _i(this.app),this.loadSpeed=.1,this.isCamFitScene=!0,this.loadStageWeight=[.1,.1,.3,.5],this.loadedProgress=0,this.curStageLoadProgress=0,this.isDelayLoadFloorPlan=!1,this.envMap=null,this.appFirstTimeLoad=!1,this.outdoors?this.appFirstTimeLoad=!1:this.appFirstTimeLoad=!0,i&&(i.position&&(this.campusPosition=i.position),i.rotation&&(this.campusRotation=i.rotation),void 0!==i.isCamFitScene&&null!==i.isCamFitScene&&(this.isCamFitScene=i.isCamFitScene),void 0!==i.isDelayLoadFloorPlan&&null!==i.isDelayLoadFloorPlan&&(this.isDelayLoadFloorPlan=i.isDelayLoadFloorPlan),i.campus&&(this.campus=i.campus));var n=this.worldNode;null==this.campus&&(this.campus=this.app.objectManager.create({type:"Campus",name:"Campus",node:n}),this.app.scene.add(this.campus.node)),this.campusRotation&&this.campus.node.quaternion.set(this.campusRotation.x,this.campusRotation.y,this.campusRotation.z,this.campusRotation.w),this.campusPosition&&(this.campus.position=this.campusPosition),this.scene=this.campus.node}return e.prototype.updateProgress=function(e){this.app.mainUI.updateLoadingProcess({object:this.campus,progress:e})},e.prototype.loadSkybox=function(){if(this.sceneJsonData.skybox){for(var e=this.sceneJsonData.skybox,t=0;t<e.length;t++){var i=e[t];i=this.baseURL+i,e[t]=i}var r=this;return new Promise(function(t,i){(new THREE.CubeTextureLoader).load(e,function(e){e.flipY=!0,r.envMap=e,t()},null,function(){console.warn("load skybox fail"),t()})})}return new Promise(function(e,t){e()})},e.prototype.load=function(e){var t=this;if("String"===e.constructor.name)this.baseURL=e;else if("Object"===e.constructor.name){var i=e;this.baseURL=i.url,i.campus&&(this.campus=i.campus,this.worldNode=this.campus.node)}return new Promise(function(e,i){t.loadSceneJson().then(function(e){return e.camInfo&&t.isCamFitScene&&t.parseCamInfo(e.camInfo),t.sceneJsonData=e,t.updateProgress(.1),t.loadSkybox().then(function(){return t.loadStructureJson()})}).then(function(e){t.updateProgress(.2);var i=t.getSortedStructureGLTFs(e);return new Promise(function(e,r){t.updateProgress(.3),t.loadStructure(i,function(){t.updateProgress(.7),t.parseObjects().then(function(){t.updateProgress(.8),e(t.campus)})})})}).then(function(){t.updateProgress(1),e(t.campus)}).catch(function(e){i(e)})})},e.prototype.loadSceneJson=function(){var e=this;return new Promise(function(t,i){(new THREE.FileLoader).load(e.baseURL+"/scene.json",function(e){var i=JSON.parse(e);t(i)},function(e){},function(e){i("cant not load file: scene.json")})})},e.prototype.loadStructureJson=function(){var e=this;return new Promise(function(t,i){(new THREE.FileLoader).load(e.baseURL+"/structure.json",function(e){var i=JSON.parse(e);t(i)},function(){},function(e){i("cant not load file: structure.json")})})},e.prototype.addEnvMap=function(e){var t=this;this.envMap&&e.traverse(function(e){e.material&&(e.material.opacity<1&&!e.material.transparent&&(e.material.transparent=!0,e.material.needsUpdate=!0),e.material.transparent&&(e.material.metalness=1,e.material.roughness=0,e.material.envMap=t.envMap,e.material.envMapIntensity=2,e.material.refractionRatio=1,e.material.needsUpdate=!0),e.material.isMeshStandardMaterial&&(e.material.envMap=t.envMap,e.material.envMapIntensity=1,e.material.refractionRatio=1,e.material.needsUpdate=!0))})},e.prototype.loadStructure=function(e,t,i){this.splitLoadedGLTFCount=0;var r=this,n=0;if(0==e.length)t&&t();else for(var o=r.curLoadGLTFIndex;o<e.length&&(0==n||n%10!=0);o++){n++,r.curLoadGLTFIndex++;var a=new thingjs.GLTFLoader;a.setCrossOrigin("anonymous");var s=e[o];a.load(r.baseURL+"/"+s.path,function(n){var o=n.scene.children[0].children[0];r.nodes[o.name]=o,r.sliceRootNodeArray.push(o),o.traverse(function(e){r.nodes[e.name]=e}),r.splitLoadedGLTFCount++,r.allLoadedGLTFCount++,10===r.splitLoadedGLTFCount&&r.loadStructure(e,t,i),(void 0===s.show||s.show)&&r.scene.add(o),r.addEnvMap(o),o.updateMatrixWorld(),r.scene.updateMatrixWorld(!0),r.allLoadedGLTFCount==e.length&&t&&t()},function(){},function(t){i?i("load "+r.baseURL+"/"+e[o].path+" failed"):console.error("load "+r.baseURL+"/"+s.path+" failed"),console.error(t)})}},e.prototype.parseObjects=function(){var e=this.sceneJsonData,t=this;return e.models?new Promise(function(i,r){t.parseBundleList(e.models).then(function(){return t.parse(e)}).then(function(){t.sliceRootNodeArray=[],i()}).catch(function(e){r(e)})}):new Promise(function(i,r){t.parse(e).then(function(){t.sliceRootNodeArray=[],i()}).catch(function(e){r(e)})})},e.prototype.getSortedStructureGLTFs=function(e){var t=[],i=[],r=[],n=e.outdoors,o=e.buildings;for(var a in n){var s=n[a];t.push(s)}for(var l=0;l<t.length;l++){var c=t[l];if(0!=i.length)for(var u=0;u<i.length;u++){var h=i[u];if(c.size<h.size){i.splice(u,0,c);break}if(u==i.length-1){i.push(c);break}}else i.push(t[l])}for(var a in t=[],o)t.push(o[a]);for(l=0;l<t.length;l++)if(c=t[l],0!=r.length)for(u=0;u<r.length;u++){if(h=r[u],c.size<h.size){r.splice(u,0,c);break}if(u==r.length-1){r.push(c);break}}else r.push(t[l]);return i.concat(r)},e.prototype._nestingLoopYield=function(e,t,i){var r=this,n=e.next();if(n.done)return t&&t(),n.value;var o=n.value;n.done,o instanceof Promise?o.then(function(n){return r._nestingLoopYield(e,t,i)}).catch(function(e){i(e)}):this._nestingLoopYield(e,t,i)},e.prototype.parse=function(e){var t=this;return this.combineManager.combineModels().then(function(){return new Promise(function(i,r){var n=t.parseWorld(e);if(n?t._nestingLoopYield(n,function(){i()},function(e){r(e)}):i(),e.camInfo&&t.isCamFitScene){var o=e.camInfo;t.parseCamInfo(o)}})})},e.prototype.parseCamInfo=function(e){var t=e.eye,i=e.target,r=t.split(" "),n=i.split(" "),o=[Number(r[0]),Number(r[1]),Number(r[2])];o[2]=-o[2];var a=[Number(n[0]),Number(n[1]),Number(n[2])];a[2]=-a[2],this.app.camera.position=o,this.app.camera.target=a},e.prototype.parseWorld=function(e){var t=mi.mark(x);if(e.outdoors&&this.parseOutdoors(e.outdoors),e.buildings){var i=e.buildings;for(var r in i){var n=i[r],o=new THREE.Vector3(0,0,0),a=r,s=void 0;n.id&&(s=n.id),n.name&&(a=n.name);var l=n.properties,c=null;if(l)for(var u in c={},l){var h=l[u];c[u]=h}if(n.position){var p=n.position;o.x=p[0],o.y=p[1],o.z=-p[2]}var d=new THREE.Object3D,f=this.app.objectManager.create({type:"Building",name:a,id:s,properties:c,parent:this.campus,node:d});if(f.app=this.app,f.node.position.x=o.x,f.node.position.y=o.y,f.node.position.z=o.z,n.facades){var m=n.facades;for(var g in m)this.createThing(m[g],f,null,"Facade")}if(n.facadegroups){var v=n.facadegroups;for(var y in v){var b=v[y];this.createGroup(b,f,"Facade")}}n.plans&&this.parseFloorPlans(n.plans,f)}}var _=this;function x(e){var i,r,n,o,a,s,l,c,u;return mi.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:i=_.loadSpeed,r=10,n=e.keys(),o=Array.isArray(n),a=0,n=o?n:n[Symbol.iterator]();case 3:if(!o){t.next=9;break}if(a>=n.length)return t.abrupt("break",24);t.next=6;break;case 6:s=n[a++],t.next=13;break;case 9:if((a=n.next()).done)return t.abrupt("break",24);t.next=12;break;case 12:s=a.value;case 13:l=s,c=e.get(l),u=0;case 16:if(u<c.length)return t.next=19,new Promise(function(e,t){var n=performance.now();c[u].build();var o=c[u].combineMesh;l.miscNode.add(o);var a=performance.now()-n;i<a?setTimeout(function(){e()},r):e()});t.next=22;break;case 19:u++,t.next=16;break;case 22:t.next=3;break;case 24:case"end":return t.stop()}},t,this)}if(this.isDelayLoadFloorPlan){var E=new Map,w=this.combineManager.processorMap.get(this.outdoors);w&&E.set(this.outdoors,w);var T=this.combineManager.processorMap.keys(),S=Array.isArray(T),M=0;for(T=S?T:T[Symbol.iterator]();;){var R;if(S){if(M>=T.length)break;R=T[M++]}else{if((M=T.next()).done)break;R=M.value}var P=R;P!=this.outdoors&&(P.isLoaded=!1)}return x(E)}return x(this.combineManager.processorMap)},e.prototype.parseOutdoors=function(e){var t=new THREE.Object3D;this.outdoors=this.app.objectManager.create({type:"Outdoors",name:"Outdoors",parent:this.campus,node:t}),this.app.outdoors||(this.app.outdoors=this.outdoors,this.app.currentParentObject=this.outdoors),this.processFloorPlanData(e,this.outdoors)},e.prototype.processFloorPlanData=function(e,t){t.app=this.app;var i=new THREE.Vector3(0,0,0);if(e.position){var r=e.position;i.x=r[0],i.y=r[1],i.z=-r[2]}t.node.position.x=i.x,t.node.position.y=i.y,t.node.position.z=i.z,t.node.updateMatrixWorld(),t.node.updateMatrix(),this.parseStructure(e,t),e.placements&&(this.parseCombineProcessors(t,e.placements,[],[],[]),this.parseThings(e.placements,t,i)),e.videoprobes&&this.parseThings(e.videoprobes,t,i),e.groups&&this.parseGroups(e.groups,t,[],[],[],i),e.doororwindows&&this.parseDoorWins(e.doororwindows,t,i),e.rooms&&this.parseRooms(e.rooms,t),e.routes&&this.parseStructureThing(e.routes,t),e.pipelines&&this.parseStructureThing(e.pipelines,t),e.curvelines&&this.parseStructureThing(e.curvelines,t),e.arrowlines&&this.parseStructureThing(e.arrowlines,t),e.arrowdatalines&&this.parseStructureThing(e.arrowdatalines,t),e.leakwaterlines&&this.parseStructureThing(e.leakwaterlines,t)},e.prototype.parseRooms=function(e,t){for(var i=0;i<e.length;i++){var r=e[i],n=null;r.name&&(n=r.name),e.id&&e.id;var o=null,a=r.gltfid;a&&this.nodes[a]&&(o=this.nodes[a]);var s=null,l=r.properties;if(l)for(var c in s={},l){var u=l[c];s[c]=u}var h=null,p=null,d=null;r.floor&&(a=r.floor.gltfid,this.nodes[a]&&(d=this.nodes[a])),r.ceiling&&(a=r.ceiling.gltfid,this.nodes[a]&&(h=this.nodes[a])),r.roof&&(a=r.roof.gltfid,this.nodes[a]&&(p=this.nodes[a]));var f=r.isShown;if(f){var m="false"!==(f=f.toLowerCase());o.visible=m}var g=null,v=null,y=null,b={};if(r.area&&(v=r.area,b.area=v),r.circumference&&(y=r.circumference,b.circumference=y),r.center){var _=r.center;(g=new THREE.Vector3).set(_[0],_[1],-_[2]),b.center=g}this.app.objectManager.create({type:"Room",name:n,node:o,ceilingNode:h,roofNode:p,floorNode:d,parent:t,properties:s,auxiliaryInfo:b})}},e.prototype.parseCombineProcessors=function(e,t,i,r,n){for(var o in t){var a=t[o];if(!a.name&&!a.properties){var s=this.app.modelResource.bundleIDArray[a.model].uri;s||(s=this.app.modelResource.bundleIDArray[a.model].id);var l=new THREE.Vector3(0,0,0);if(a.position){var c=a.position;l.x=c[0],l.y=c[1],l.z=-c[2]}var u=new THREE.Vector3(1,1,1);if(a.scale){var h=a.scale;u.x=h[0],u.y=h[1],u.z=h[2]}var p=new THREE.Quaternion(0,0,0,1);if(a.rotation){var d=a.rotation;p.x=d[0],p.y=d[1],p.z=-d[2],p.w=-d[3]}var f=i.slice(),m=r.slice(),g=n.slice();g.push(p),m.push(u),f.push(l),this.combineManager.addPlacement(e,s,f,m,g)}}},e.prototype.parseStructure=function(e,t){t.node.updateMatrixWorld();var i=t.node.position,r=new THREE.Vector3;t.parent&&!t.isOutdoors&&(r=t.parent.node.position);var n=new THREE.Vector3(r.x+i.x,r.y+i.y,r.z+i.z);if(e.structure){var o=(e=e.structure).walls;if(o){var a=new THREE.Group;for(var s in a.name="structurnWall",o){var l=o[s].gltfid,c=this.nodes[l];c.traverse(function(e){e.material&&(e.material.onBeforeCompile=function(e){e.fragmentShader=e.fragmentShader.replace("#include <aomap_fragment>",["#ifdef USE_AOMAP","float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 3.0;","#if defined( USE_ENVMAP ) && defined( PHYSICAL )","float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );","reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );","#endif","#endif"].join("\n"))},e.material.needsUpdate=!0)}),c&&a.add(c)}t.node.add(a),a.position.set(-n.x,-n.y,-n.z),t.wallNode=a}var u=e.roofs;if(u){var h=new THREE.Group;for(var s in h.name="structurnRoof",u){l=u[s].gltfid;var p=this.nodes[l];p&&h.add(p)}t.node.add(h),h.position.set(-n.x,-n.y,-n.z),t.roofNode=h}var d=e.ceilings;if(d){var f=new THREE.Group;for(var s in f.name="structureCeiling",d){l=d[s].gltfid;var m=this.nodes[l];m&&f.add(m)}t.node.add(f),f.position.set(-n.x,-n.y,-n.z),t.ceilNode=f}if(v=e.floors){var g=new THREE.Group;for(var s in g.name="structureFloor",v){var v;if(l=(v=v[s]).gltfid){var y=this.nodes[l];y.traverse(function(e){e.material&&(e.material.roughness=.9,e.material.needsUpdate=!0)}),y&&g.add(y)}}t.node.add(g),g.position.set(-n.x,-n.y,-n.z),t.floorNode=g}var b=new THREE.Group;b.name="structurePlacement",t.miscNode=b,t.node.add(b),t.floorNode||(t.floorNode=b),b.updateMatrixWorld(),b.updateMatrix(),b.position.set(0,0,0);var _=e.placements;if(_)for(var s in _){l=_[s].gltfid;var x=this.nodes[l];x&&b.add(x)}e.routes&&this.parseStructureThing(e.routes,t),e.pipelines&&this.parseStructureThing(e.pipelines,t),e.curvelines&&this.parseStructureThing(e.curvelines,t),e.arrowlines&&this.parseStructureThing(e.arrowlines,t),e.arrowdatalines&&this.parseStructureThing(e.arrowdatalines,t),e.leakwaterlines&&this.parseStructureThing(e.leakwaterlines,t)}},e.prototype.parseDoorWins=function(e,t,i){for(var r in new THREE.Group("doors"),e){var n=e[r],o=r;n.name&&(o=n.name);var a=null;if(n.gltfid){var s=n.gltfid;this.nodes[s]&&(a=this.nodes[s],t.node.add(a))}var l=null;if(n.properties){var c=n.properties;for(var u in l={},c){var h=c[u];l[u]=h}}this.app.objectManager.create({type:"Door",name:o,node:a,parent:t,properties:l})}},e.prototype.parseGroups=function(e,t,i,r,n,o){for(var a in e){var s=e[a];s.name||s.properties?this.createGroup(s,t):this.combineGroup(s,t,i,r,n,o)}},e.prototype.createGroup=function(e,t){var i,r,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"Thing",o=this.instanceGroup(e);e.id&&e.id,e.name&&(i=e.name);var a=e.properties;if(a)for(var s in r={},a){var l=a[s];r[s]=l}return this.app.objectManager.create({type:n,name:i,node:o,parent:t,properties:r})},e.prototype.parseFloorPlans=function(e,t){for(var i=[],r=0;r<e.length;r++){var n=e[r],o=n.id,a="";n.name&&(a=n.name);var s=new THREE.Object3D,l=this.app.objectManager.create({type:"Floor",name:a,id:o,node:s,parent:t});s.name="floorPlan",0!=t.facades.length&&(l.node.visible=!1),t.node.add(l.node),t.node.updateMatrixWorld(),t.node.updateMatrix(),this.processFloorPlanData(n,l),i.push(l)}return i},e.prototype.parseBundleList=function(e){this.app.modelResource.bundleIDArray=e;var t=0,i=this;return new Promise(function(r,n){0!==e.length?e.forEach(function(o){if(c=o.uri){var a=new thingjs.GLTFLoader;a.setCrossOrigin("anonymous"),a.load(i.baseURL+"/"+c,function(n){t++;var o;o=-1!==n.asset.generator.indexOf("Unity")?n.scene.children[0].children[0]:n.scene.children[0],i.app.modelResource.set(c,o,n.animations),i.addEnvMap(o),t===e.length&&r()},function(){},function(e){n("can not load "+i.baseURL+"/"+c)})}else{var s=o.id,l=o.version,c="http://model.3dmomoda.cn/models/"+s+"/"+l+"/gltf/",u=new THREE.FileLoader;u.setResponseType("json"),u.load(c+"index.json",function(o){var a=o.gltfFiles[0],l=new thingjs.GLTFLoader;l.setCrossOrigin("anonymous"),l.load(c+a,function(n){t++,i.app.modelResource.set(s,n.scene.children[0],n.animations),t===e.length&&r()},function(){},function(e){n("can not load "+i.baseURL+"/"+c)})})}}):r()})},e.prototype.combineGroup=function(e,t,i,r,n,o){var a=e,s=new THREE.Vector3(0,0,0);if(a.position){var l=a.position;s.x=l[0],s.y=l[1],s.z=-l[2]}var c=new THREE.Vector3(1,1,1);if(a.scale){var u=a.scale;c.x=u[0],c.y=u[1],c.z=u[2]}var h,p=new THREE.Quaternion(0,0,0,1);if(a.rotation){u=a.rotation;p.x=u[0],p.y=u[1],p.z=-u[2],p.w=-u[3]}if(n?(h=i.slice(),u=r.slice(),l=n.slice()):(h=[],l=[],u=[]),h.push(c),l.push(s),u.push(p),a.placements&&this.parseCombineProcessors(t,a.placements,l,h,u),a.groups)for(var d in a.groups)this.combineGroup(a.groups[d],t,h,u,l,o)},e.prototype.instanceGroup=function(e){var t=new THREE.Vector3(0,0,0);if(e.position){var i=e.position;t.x=i[0],t.y=i[1],t.z=-i[2]}var r=new THREE.Vector3(1,1,1);if(e.scale){var n=e.scale;r.x=n[0],r.y=n[1],r.z=n[2]}var o=new THREE.Quaternion(0,0,0,1);e.rotation&&(n=e.rotation,o.x=n[0],o.y=n[1],o.z=-n[2],o.w=-n[3]);var a=new THREE.Group;if(e.placements)for(var s in e.placements){var l=this.instanceChildOfGroup(e.placements[s]);a.add(l)}if(e.groups)for(var s in e.groups)l=this.instanceGroup(e.groups[s]),a.add(l);return a.scale.copy(r),a.setRotationFromQuaternion(o),a.position.copy(t),a},e.prototype.instanceChildOfGroup=function(e){var t=this.app.modelResource.bundleIDArray[e.model].uri;t||(t=this.app.modelResource.bundleIDArray[e.model].id);var i=this.app.modelResource.get(t).node.clone();if(e.scale){var r=e.scale;i.scale.x=r[0],i.scale.y=r[1],i.scale.z=r[2]}if(e.rotation){r=e.rotation;var n=new THREE.Quaternion;n.x=r[0],n.y=r[1],n.z=-r[2],n.w=-r[3],i.setRotationFromQuaternion(n)}return e.position&&(r=e.position,i.position.x=r[0],i.position.y=r[1],i.position.z=-r[2]),i},e.prototype.parseThings=function(e,t,i){for(var r in e){var n=e[r];(n.name||n.properties||n.type)&&this.createThing(n,t,i)}},e.prototype.createThing=function(e,t,i){var r,n,o,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"Thing";e.id&&(r=e.id);var s=e.type||a;e.name&&(n=e.name);var l=e.properties;if(l)for(var c in o={},l){var u=l[c];o[c]=u}var h=this.app.modelResource.bundleIDArray[e.model].uri;h||(h=this.app.modelResource.bundleIDArray[e.model].id);var p=this.app.modelResource.get(h).node.clone(),d=this.app.modelResource.get(h).animations;if(e.position){var f=e.position,m=new THREE.Vector3(f[0],f[1],-f[2]);p.position.x=m.x,p.position.y=m.y,p.position.z=m.z}if(e.rotation){var g=e.rotation,v=new THREE.Quaternion;v.x=g[0],v.y=g[1],v.z=-g[2],v.w=-g[3],p.setRotationFromQuaternion(v)}if(e.scale){var y=e.scale,b=new THREE.Vector3;b.x=y[0],b.y=y[1],b.z=y[2],p.scale.x=b.x,p.scale.y=b.y,p.scale.z=b.z}var _=e.isShown;if(_){var x="false"!==(_=_.toLowerCase());p.visible=x}return this.app.objectManager.create({type:s,id:r,name:n,node:p,parent:t,animations:d,properties:o})},e.prototype.parseStructureThing=function(e,t,i){for(var r in e){var n=e[r];if(n.gltfid){var o=new oi(this.app);o.name=r,o.app=this.app,n.id&&(o.id=n.id),n.name&&(o.name=n.name);var a=n.gltfid;if(this.nodes[a]){var s=this.nodes[a];t.node.add(s),o.node=s,t.add(o),i&&(s.position.x=i.x,s.position.y=i.y,s.position.z=i.z)}}}},e.prototype.delayLoadFloorPlan=function(e){var t=mi.mark(r),i=this;function r(r){var n,o,a;return mi.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=i.loadSpeed,o=10,a=0;case 3:if(a<r.length)return t.next=6,new Promise(function(t,i){var s=performance.now();r[a].build();var l=r[a].combineMesh;e.miscNode.add(l);var c=performance.now()-s;n<c?setTimeout(function(){t()},o):t()});t.next=9;break;case 6:a++,t.next=3;break;case 9:case"end":return t.stop()}},t,this)}var n=null,o=null;return e.isLoaded||(n=this.combineManager.processorMap.get(e),o=r(n)),new Promise(function(t,r){o?i._nestingLoopYield(o,function(){e.isLoaded=!0,t()},function(e){r(e)}):e.isLoaded?console.warn("floorplan "+e.id+" has been loaded!"):r()})},e}(),wi=function(e){function t(i,n){return r(this,t),a(this,e.call(this,i,n))}return o(t,e),t.prototype.parseDoorWins=function(e,t,i){for(var r in new THREE.Group("doors"),e){var n=e[r];n.type||(n.type="Door"),this.createThing(n,t,i)}},t}(Ei),Ti=function(){function e(t){r(this,e),this.app=t,this.nodes=[],this.scene=this.app.scene,this.objectPool=this.app.objectPool,this.rootNode=null,this.campus=null,this.sceneURL=null,this.sceneJsonData=null,this.loadedSceneGLTF=null,this.worldNode=new THREE.Object3D,this.fitCamInfo=null}return e.prototype.parse=function(e){for(var t in e)if("objects"==t){var i=e.objects;for(var r in i){var n=i[r];this.parseWorld(n);break}}else if("camInfo"==t){var o=e[t];this.fitCamInfo=o}else console.log("unkown other parser: "+t)},e.prototype.parseCamInfo=function(e){var t=e.eye,i=e.target,r=t.split(" "),n=i.split(" "),o=[Number(r[0]),Number(r[1]),Number(r[2])];o[2]=-o[2];var a=[Number(n[0]),Number(n[1]),Number(n[2])];a[2]=-a[2],this.app.camera.position=o,this.app.camera.target=a},e.prototype.parseWorld=function(e){var t=this.worldNode;if(null==this.campus&&(this.campus=this.app.objectManager.create({type:"Campus",name:"Campus",node:t}),this.campus.node.name="campus",this.app.scene.add(this.campus.node)),e.plan&&this.parseOutdoors(e.plan),e.bds){var i=e.bds;this.parseBuildings(i)}},e.prototype.parseOutdoors=function(e){var t=null;for(var i in e){t=e[i];break}var r=new THREE.Object3D;this.outdoors=this.app.objectManager.create({type:"Outdoors",name:"Outdoors",parent:this.campus,node:r});var n=this.outdoors,o=t.gltfid;if(o&&this.nodes[o]){var a=this.nodes[o];THREE.SceneUtils.detach(a,a.parent,this.app.scene),THREE.SceneUtils.attach(a,this.app.scene,n.node),n.node.updateMatrixWorld()}this.parseFloorPlan(t,n)},e.prototype.parseBuildings=function(e){for(var t in e){var i=e[t],r=null;if(i.gltfid){var n=i.gltfid;this.nodes[n]&&(r=this.nodes[n])}var o=this.app.objectManager.create({type:"Building",name:t,parent:this.campus,node:r});i.plans&&this.parseFloorPlans(i.plans,o),i.facades&&this.parseFacades(i.facades,o)}},e.prototype.parseFloorPlans=function(e,t){for(var i in e){var r=null,n=e[i],o=n.gltfid;o&&this.nodes[o]&&(r=this.nodes[o]);var a=this.app.objectManager.create({type:"Floor",name:i,node:r,parent:t});this.parseFloorPlan(n,a)}},e.prototype.parseFloorPlan=function(e,t){e.plcs&&this.parseThings(e.plcs,t),e.vps&&this.parseThings(e.vps,t),e.dws&&this.parseDoorWins(e.dws,t),e.routes&&this.parseThings(e.routes,t),e.pipelines&&this.parseThings(e.pipelines,t),e.curvelines&&this.parseThings(e.curvelines,t),e.arrowlines&&this.parseThings(e.arrowlines,t),e.arrowdatalines&&this.parseThings(e.arrowdatalines,t),e.leakwaterlines&&this.parseThings(e.leakwaterlines,t);var i=e.cplcs;if(i)for(var r in i){var n=i[r].gltfid,o=this.nodes[n];if(o){t.miscNode=o.parent;break}}var a=e.cwalls;if(a)for(var r in a){n=a[r].gltfid;var s=this.nodes[n];if(s){t.wallNode=s.parent;break}}var l=e.croofs;if(l)for(var r in l){n=l[r].gltfid;var c=this.nodes[n];if(c){t.roofNode=c.parent;break}}var u=e.cceilings;if(u)for(var r in u){n=u[r].gltfid;var h=this.nodes[n];if(h){t.ceilingNode=h.parent;break}}if(p=e.cfloors)for(var r in p){var p;if(n=(p=p[r]).gltfid){var d=this.nodes[n];if(d){t.floorNode=d.parent;break}}}var f=e.groups;f&&this.parseGroup(f,t)},e.prototype.parseGroup=function(e,t){for(var i in e){var r=e[i],n=i;r.uid&&(n=r.uid);var o=r.type||"Thing",a=null,s=r.gltfid;s&&this.nodes[s]&&(a=this.nodes[s]);var l=null,c=r.prop;if(c)for(var u in l={},c){var h=c[u];l[u]=h}this.app.objectManager.create({type:o,name:n,node:a,parent:t,properties:l}),r.plcs&&this.parseThings(r.plcs,t)}},e.prototype.parseFacades=function(e,t){for(var i in e){var r=e[i],n=i;r.uid&&(n=r.uid);var o=null,a=r.gltfid;a&&this.nodes[a]&&(o=this.nodes[a]);var s=null,l=r.prop;if(l)for(var c in s={},l){var u=l[c];s[c]=u}var h=r.isShown;if(h){var p="false"!==(h=h.toLowerCase());o.visible=p}this.app.objectManager.create({type:"Facade",name:n,node:o,parent:t,properties:s}),t.node.add(o)}},e.prototype.parseThings=function(e,t){for(var i in e){var r=e[i],n=i;r.uid&&(n=r.uid);var o=null,a=r.gltfid;a&&this.nodes[a]&&(o=this.nodes[a]);var s=null,l=r.prop;if(l)for(var c in s={},l){var u=l[c];s[c]=u}var h=r.isShown;if(h){var p="false"!==(h=h.toLowerCase());o.visible=p}this.app.objectManager.create({type:"Thing",name:n,node:o,parent:t,properties:s})}},e.prototype.parseDoorWins=function(e,t){for(var i in e){var r=e[i],n=i;r.uid&&(n=r.uid);var o=null;if(r.gltfid){var a=r.gltfid;this.nodes[a]&&(o=this.nodes[a])}var s=null;if(r.prop){var l=r.prop;for(var c in s={},l){var u=l[c];s[c]=u}}this.app.objectManager.create({type:"Door",name:n,node:o,parent:t,properties:s})}},e.prototype.load=function(e){var t=this;if("String"===e.constructor.name)this.sceneURL=e;else if("Object"===e.constructor.name){var i=e;this.sceneURL=i.url,i.campus&&(this.campus=i.campus,this.worldNode=this.campus.node)}return new Promise(function(e,i){t.loadGLTF().then(function(e){return(t.loadedSceneGLTF=e).scene.traverse(function(e){t.nodes[e.name]=e}),t.parseSceneJson()}).then(function(i){t.fitCamInfo?t.parseCamInfo(t.fitCamInfo):t.campus.node&&t.app.camera.fit(t.campus),e(t.campus)}).catch(function(){t.campus.node.add(t.loadedSceneGLTF.scene.children[0]),t.campus&&t.app.camera.fit(t.campus),e(t.campus)})})},e.prototype.loadGLTF=function(){var e=this;return new Promise(function(t,i){var r=new THREE.GLTFLoader(e.app.loadingManager);r.setCrossOrigin("anonymous"),r.load(e.sceneURL+"/Unity2GLTF.gltf",function(e){t(e)})})},e.prototype.parseSceneJson=function(){var e=this;return new Promise(function(t,i){new THREE.FileLoader(e.app.loadingManager).load(e.sceneURL+"/scene.json",function(i){var r=JSON.parse(i);for(var n in e.sceneJsonData=r)if("objects"==n){var o=r.objects;for(var a in o){var s=o[a];e.parseWorld(s);break}}else if("camInfo"==n){var l=r[n];e.fitCamInfo=l}else console.log("unkown other parser: "+n);t(r)},function(){},function(){console.error("not find file scene.json "),i()})})},e}(),Si=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));return n.isOpen=!1,n}return o(t,e),t.prototype.open=function(){0!==this.animationNames.length&&this.playAnimation("Auto_Open"),this.isOpen=!0},t.prototype.close=function(){0!==this.animationNames.length&&this.playAnimation("Auto_Close"),this.isOpen=!1},n(t,[{key:"isDoor",get:function(){return!0}},{key:"floor",get:function(){return this.parents.query(".Floor")[0]}}]),t}(oi),Mi=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));return n.stair=null,n}return o(t,e),t.prototype.setup=function(t){e.prototype.setup.call(this,t)},n(t,[{key:"owner",get:function(){return this.stair}},{key:"isStairDoor",get:function(){return console.warn("[StairDoor] Please use 'instanceof THING.StairDoor' to replace '.StairDoor'"),this instanceof THING.StairDoor}}]),t}(Si),Ri=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));return n.doors=[],n}return o(t,e),t.prototype.setup=function(t){if(e.prototype.setup.call(this,t),t.doors){this.doors=t.doors;for(var i=0;i<this.doors.length;i++)this.doors[i].stair=this}},t.prototype.getDoor=function(e){for(var t=0;t<this.doors.length;t++){var i=this.doors[t];if(i.floor==e)return i}return i},n(t,[{key:"isStair",get:function(){return console.warn("[Stair] Please use 'instanceof THING.Stair' to replace '.Stair'"),this instanceof THING.Stair}}]),t}(Ye),Pi=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));return n._ceilingNode=null,n._ceilingObject=null,n._roofNode=null,n._roofObject=null,n._floorNode=null,n._floorObject=null,n._auxiliaryInfo=null,n._textRegion=null,n._holes=[],n}return o(t,e),t.prototype.setup=function(t){var i;e.prototype.setup.call(this,t),this._holes=t.holes||[],this._ceilingNode=t.ceilingNode||this._ceilingNode,this._roofNode=t.roofNode||this._roofNode,this._auxiliaryInfo=t.auxiliaryInfo||this._auxiliaryInfo,this._floorNode=t.floorNode||this._floorNode,t.floorHideByScene&&this._floorNode&&(i=this._floorNode.parent)&&(this.app.resourceManager.remove(this._floorNode),this._floorNode=new THREE.Group,i.add(this._floorNode)),t.roofHideByScene&&this._roofNode&&(i=this._roofNode.parent)&&(this.app.resourceManager.remove(this._roofNode),this._roofNode=new THREE.Group,i.add(this._roofNode))},t.prototype.getMode=function(e){return e.geometry instanceof THREE.ShapeGeometry?"xy":"xz"},t.prototype.getFloorMesh=function(){var e=this._floorNode;if(!e)return null;var t=e.getMeshes();return t.length?t[0]:null},t.prototype.getRoomHeight=function(){return 3},t.prototype.showGrid=function(t,i,r,n,o){var a=5<arguments.length&&void 0!==arguments[5]?arguments[5]:.01;e.prototype.showGrid.call(this,t,i,r,n,o,a);var s=Te.parseVector3(this.labelPosition);this._grid._setWorldPosition(s,!1,this.static)},t.prototype.getLabelPosition=function(e){var t=this.getFloorMesh();if(!t)return null;var i=t.getLabelPosition(e,this.getMode(t));return i?i.toArray():null},t.prototype.getAvaliablePositions=function(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[];if(!Te.isNumber(e))return null;var r=[];if(Te.isArray(t[0]))for(var n=0;n<e;n++){var o=t[n];r.push(o)}else for(n=0;n<e;n++)r.push(t);var a=this.getFloorMesh();if(!a)return null;var s=a.getAvaliableLabelPosition(r,this.getMode(a),i);if(!s)return null;for(n=0;n<s.length;n++)s[n]=s[n].toArray();return s},t.prototype.getRayCastPosition=function(e){if(!(e=Te.parseVector3(e)))return null;var t=this.getFloorMesh();if(!t)return null;var i=t.getRayCastPosition(e);return i?i.toArray():null},t.prototype.getPoints=function(e){},t.prototype._synTextRegion=function(){if(this._textRegion){var e=this._textRegion.position;if(this.style._volumeNode){var t=new THREE.Vector3;this.style._volumeNode.getWorldPosition(t),e[1]=t.y}else e[1]=this.position[1];e[1]+=.01,this._textRegion.position=e}},t.prototype.getNavigationMesh=function(){var e=this._floorNode;if(!e)return null;if(!this.area)return null;var t=e.getMeshes();return t.length?t[0]:null},t.prototype._getLinkableDoors=function(){var t=e.prototype._getLinkableDoors.call(this);return t.add(this.doors),t},t.prototype.showCeiling=function(e){console.warn("[Room] Please use '.ceiling.visible=true/false' to replace '.showCeiling()'"),this.ceiling.visible=e},t.prototype.showRoof=function(e){console.warn("[Room] Please use '.roof.visible=true/false' to replace '.showRoof()'"),this.roof.visible=e},t.prototype.showFloor=function(e){console.warn("[Room] Please use '.floorNode.visible=true/false' to replace '.showFloor()'"),this.floorNode.visible=e},t.prototype.showRoof=function(e){console.warn("[Room] Please use '.roof.visible=true/false' to replace '.showRoof()'"),this.roof.visible=e},t.prototype.setFloor=function(e){console.warn("[Room] Please use '.floorNode.style.' to replace '.setFloor()'"),e=e||{};var t=this.floorNode.style,i=e.color;i&&(t.color=i);var r=e.opacity;r&&(t.opacity=r)},t.prototype.getAvaliableFloorPos=function(e,t){return console.warn("[Room] Please use '.floor.getAvaliablePositions()' to replace '.getAvaliableFloorPos()'"),this.getAvaliablePositions(e,t)},n(t,[{key:"isRoom",get:function(){return!0}},{key:"labelPosition",get:function(){var e=this.getLabelPosition(null);if(e)return e;var t=this._auxiliaryInfo;return t&&t.center?t.center.toArray():null}},{key:"perimeter",get:function(){var e=this.getFloorMesh();return e?e.getPerimeter():0}},{key:"area",get:function(){var e=this.getFloorMesh();return e?e.getArea():0}},{key:"ceiling",get:function(){return this._ceilingObject||(this._ceilingObject=new ti(this.app)._init(this._ceilingNode)),this._ceilingObject}},{key:"roof",get:function(){return this._roofObject||(this._roofObject=new ti(this.app)._init(this._roofNode)),this._roofObject}},{key:"plan",get:function(){return this._floorObject||(this._floorObject=new ti(this.app)._init(this.getFloorMesh())),this._floorObject}},{key:"floor",get:function(){return this.parents.query(".Floor")[0]}},{key:"points",get:function(){var e=this.getFloorMesh();if(!e)return null;var t=e.getPoints();return this.holes.forEach(function(e){e.forEach(function(e){for(var i=0;i<t.length;i++){var r=t[i];j.isFloatEquals(e[0],r[0])&&j.isFloatEquals(e[2],r[2])&&t.splice(i--,1)}})}),t}},{key:"things",get:function(){var e=this.floor;if(!e)return new qe(this.app,[]);for(var t=[],i=e.things,r=0;r<i.length;r++){var n=i[r];this.getRayCastPosition(n.position)&&t.push(n)}return new qe(this.app,t).buildReturnObject(t).add(this.query(".Thing"))}},{key:"doors",get:function(){for(var e=this.floor.doors,t=[],i=0;i<e.length;i++){var r=e[i],n=1;r instanceof Mi&&(n*=2);for(var o=new THREE.Vector3,a=Te.parseVector3(r.position),s=[Te.parseVector3(r.forward),Te.parseVector3(r.cross)],l=0;l<s.length;l++){var c=s[l];if(c.multiplyScalar(n),o.addVectors(a,c),this.getRayCastPosition(o)||(c.multiplyScalar(-n),o.addVectors(a,c),this.getRayCastPosition(o))){t.push(r);break}}}return new qe(this.app,t).buildReturnObject(t)}},{key:"textRegion",get:function(){return this._textRegion||(this._textRegion=this.app.create({type:"TextRegion",text:this.name,parent:this,position:this.labelPosition,angles:[-90,0,0]}),this._textRegion.translateY(.1),this._textRegion.renderOrder=1),this._synTextRegion(),this._textRegion},set:function(e){e?(this._textRegion=e,this._synTextRegion()):(this._textRegion.destroy(),this._textRegion=null)}},{key:"holes",get:function(){var e=[],t=this;return this._holes.forEach(function(i){var r=[];i.forEach(function(e){r.push(t.selfToWorld(e.toArray()))}),e.push(r)}),e}},{key:"floorIndex",get:function(){return console.warn("[Room] Please use '.floor.indexOfParent()' to replace '.floorIndex()'"),this.floor.indexOfParent()}},{key:"center",get:function(){return console.warn("[Room] Please use '.labelPosition' to replace '.center' or if you want to use .boundingBox.center to get center of boundingBox?"),this.labelPosition}},{key:"floorNode",get:function(){return console.warn("[Room] Please use '.plan' to replace '.floorNode'"),this.plan}}]),t}(Ye),Ai=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));return n.name="Outdoors",n._floorNode=null,n}return o(t,e),t.prototype.destroy=function(){this._floorNode=null,e.prototype.destroy.call(this)},t.prototype.setupChildVisibleAsParent=function(){},t.prototype.setup=function(e){this.setupID(e),this.setupParent(e),(this.parent.outdoors=this).setupUserData(e)},t.prototype.setPolygonOffset=function(e){var t=this._floorNode;t&&new Ye(this.app)._init(t).style.setPolygonOffset(e)},n(t,[{key:"floorNode",set:function(e){this._floorNode=e},get:function(){return this._floorNode}},{key:"canNotQueryFromSelector",get:function(){return!0}},{key:"isOutdoors",get:function(){return console.warn("[Outdoors] Please do not use 'outdoors.isOutdoors', we will delete is soon in the future"),!0}}]),t}(ii),Ci=function(){function e(t){r(this,e),this.app=t,this.json2meshWorld=null,this.campus=null,this.worldNode=null}return e.prototype.setCampus=function(e){this.campus=e},e.prototype.parseWorld=function(e){null===this.campus?this.campus=this.app.objectManager.create({uuid:e.id,id:e.userID,type:"Campus",name:"Campus",node:this.worldNode}):(this.campus.uuid=e.id,e.userID&&(this.campus.id=e.userID)),this.app.scene.add(this.campus.node);for(var t=0;t<e.buildings.length;t++){var i=e.buildings[t];this.parseBuilding(i)}if(e.outdoors){var r=new THREE.Object3D("outdoors");r.name="plan",this.outdoors=this.app.objectManager.create({uuid:e.outdoors.id,id:e.outdoors.userID,type:"Outdoors",name:e.outdoors.name,parent:this.campus,node:r}),this.app.outdoors||(this.app.outdoors=this.outdoors,this.app.level.currentParentObject=this.outdoors),this.parseFloorPlan(e.outdoors,this.outdoors)}return this.campus},e.prototype.parseBuilding=function(e){var t=new THREE.Object3D("building");t.name="building";var i=this.app.objectManager.create({uuid:e.id,id:e.userID,type:"Building",name:e.name,parent:this.campus,node:t,properties:e.properties});i.localPosition=e.position;var r=e.floorplans;this.parseFacades(e,i);for(var n=0;n<r.length;n++){var o=r[n],a=new THREE.Object3D("floorplan");a.name="plan";var s=this.app.objectManager.create({id:o.userID,uuid:o.id,type:"Floor",height:o.height,name:o.name,properties:o.properties,node:a,alwaysShowInsideObjs:o.alwaysShowInsideObjs,parent:i});s.localPosition=o.position,this.parseFloorPlan(o,s),this.hidePlanObjs(s),0===e.facades.length&&0===e.facadeGroups.length||(s.node.visible=!1)}},e.prototype.hidePlanObjs=function(e){if(!e.showObjectsInParentLevels){for(var t=e.query(".CombinedObject",!1),i=0;i<t.length;i++){var r=t[i];if("CombineMiscParent"===r.userData.type)for(var n=r.query(".CombinedObject",!1),o=0;o<n.length;o++){var a=n[o];"CombinePlacement"===a.userData.json2meshType&&(a.visible=!1)}}for(var s=0;s<e.children.length;s++){var l=e.children[s];l instanceof Si||l instanceof Pi||l instanceof oi&&l.userData.isWindow||(l.visible=!1)}}},e.prototype.parseFacades=function(e,t){var i=this.getFacadeRelation(e);if(i.children&&i.facades){var r=i.children,n=i.facades,o=this.createFacade(n,t);this.createFacadeChildren(r,o)}},e.prototype.createFacade=function(e,t){for(var i=new THREE.Object3D,r=this.app.objectManager.create({uuid:j.generateUUID(),type:"Facade",node:i,parent:t}),n=0;n<e.length;n++){var o=e[n],a=this.app.objectManager.create({uuid:o.id,type:"CombinedObject",node:new THREE.Object3D,parent:r});o.registerBuildCallbackListener(this.facadeBuildCallback,{loader:this,tjsObject:a})}return r},e.prototype.facadeBuildCallback=function(e,t){t.tjsObject.node.add(e.mesh);var i=e.mesh.getMeshes();i&&0<i.length&&i.forEach(function(e){e._sfStyle="Facade"})},e.prototype.createFacadeChildren=function(e,t){for(var i=0;i<e.length;i++){var r=e[i],n=this.app.objectManager.create({type:"Thing",uuid:r.id,id:r.userID,name:r.name,node:new THREE.Object3D,parent:t,properties:r.properties});r.registerBuildCallbackListener(this.facadeChildBuildCallback,{loader:this,tjsObject:n})}},e.prototype.facadeChildBuildCallback=function(e,t){t.tjsObject.node.add(e.mesh)},e.prototype.getFacadeRelation=function(e){var t=e.facades,i=e.facadeGroups;if(0===t.length&&0===i.length)return{};for(var r=[],n=[],o=0;o<t.length;o++){var a=t[o];this.isFacadeShouldBeChild(a)?r.push(a):n.push(a)}for(var s=0;s<i.length;s++){var l=i[s];this.isFacadeShouldBeChild(l)?r.push(l):n.push(l)}return{facades:n,children:r}},e.prototype.isFacadeShouldBeChild=function(e){return!this.isNullOrUndefined(e.name)||!this.isNullOrUndefined(e.userID)||!this.isNullOrUndefined(e.properties)},e.prototype.isNullOrUndefined=function(e){return null==e},e.prototype.parseFloorPlan=function(e,t){var i=this.app.objectManager.create({node:new THREE.Object3D,parent:t,type:"CombinedObject"});i.userData.type="CombineWallParent";var r=this.app.objectManager.create({node:new THREE.Object3D,parent:t,type:"CombinedObject"});r.userData.type="CombineMiscParent";var n=this.app.objectManager.create({node:new THREE.Object3D,parent:t,type:"CombinedObject"});n.userData.type="CombineRoofParent";var o=this.app.objectManager.create({node:new THREE.Object3D,parent:t,type:"CombinedObject"});o.userData.type="CombineCeilingParent";var a=this.app.objectManager.create({node:new THREE.Object3D,parent:t,type:"CombinedObject"});a.userData.type="CombineFloorParent",this.parseDoorOrWindows(e,t),this.parseCombineFloors(e,a),this.parseCombineCeilings(e,o),this.parseCombineRoofs(e,n),this.parseCombinePlacements(e,r),this.parseCombineStraightManualWalls(e,i),this.parseCombineModelWalls(e,i),this.parseCombineDoorOrWindows(e,r),this.parseGroups(e,t),this.parsePlacements(e,t),this.parseRooms(e,t),this.parseVideoProbes(e,t),this.parseCurveLines(e,t),this.parsePipeLines(e,t)},e.prototype.parseCombineFloors=function(e,t){for(var i=0;i<e.combineFloorObjects.length;i++){var r=e.combineFloorObjects[i];this.createCombinedObject(r,t,"CombineFloor")}},e.prototype.parseCombineCeilings=function(e,t){for(var i=0;i<e.combineCeilingObjects.length;i++){var r=e.combineCeilingObjects[i];this.createCombinedObject(r,t,"CombineCeiling")}},e.prototype.parseCombineRoofs=function(e,t){for(var i=0;i<e.combineRoofObjects.length;i++){var r=e.combineRoofObjects[i];this.createCombinedObject(r,t,"CombineRoof")}},e.prototype.parseCombinePlacements=function(e,t){for(var i=0;i<e.combinePlacementObjects.length;i++){var r=e.combinePlacementObjects[i];this.createCombinedObject(r,t,"CombinePlacement")}},e.prototype.parseCombineStraightManualWalls=function(e,t){for(var i=0;i<e.combineStraightManualWallObjects.length;i++){var r=e.combineStraightManualWallObjects[i];this.createCombinedObject(r,t,"CombineStraightManualWall")}},e.prototype.parseCombineModelWalls=function(e,t){for(var i=0;i<e.combineModelWallObjects.length;i++){var r=e.combineModelWallObjects[i];this.createCombinedObject(r,t,"CombineModelWall")}},e.prototype.parseCombineDoorOrWindows=function(e,t){for(var i=0;i<e.combineDoorOrWindowObjects.length;i++){var r=e.combineDoorOrWindowObjects[i];this.createCombinedObject(r,t,"CombineDoorOrWindow")}},e.prototype.parsePlacements=function(e,t){for(var i=0;i<e.placements.length;i++){var r=e.placements[i];this.createTjsPlacement(r,t)}},e.prototype.createTjsPlacement=function(e,t){e.registerBuildCallbackListener(this.placementBuildCallback,{loader:this,parent:t})},e.prototype.placementBuildCallback=function(e,t){var i=t.loader,r=e,n="Thing";r.jsonData&&r.jsonData.type&&(n=r.jsonData.type);var o=t.parent,a=i.app.objectManager.create({uuid:r.id,id:r.userID,name:r.name,node:r.mesh,parent:o,belongRoomUserID:r.belongRoomUserID,hideByScene:!r.isShow,type:n,initBoxSize:[r.size.x,r.size.y,r.size.z],url:r.resource.getModelUrl(),properties:r.properties});if(a.bundleID=r.resource.modelID,a.bundleName=r.resource.modelName,o instanceof Ai||o.showObjectsInParentLevels||(a.visible=!1),a.setupAnimations({animations:r.resource.animations}),r.isPlayAnim&&a.containAnimation(r.animClip)){var s={name:r.animClip,loop:!1};r.hasSkin&&(s.loop=!0),a.playAnimation(s)}},e.prototype.parseDoorOrWindows=function(e,t){for(var i=0;i<e.doorOrWindows.length;i++){var r=e.doorOrWindows[i];this.createTjsDoorOrWindow(r,t)}},e.prototype.createTjsDoorOrWindow=function(e,t){var i="Door";e.isWindow&&(i="Thing"),e.jsonData&&e.jsonData.type&&(i=e.jsonData.type);var r=new THREE.Object3D,n=this.app.objectManager.create({type:i,uuid:e.id,id:e.userID,name:e.name,node:r,parent:t,initBoxSize:[e.size.x,e.size.y,e.size.z],animations:e.resource.animations,properties:e.properties});n.userData.isWindow=e.isWindow,this.addBoxNode(e,n),e.registerBuildCallbackListener(this.doorOrWindowBuildCallback,{loader:this,tjsObject:n})},e.prototype.doorOrWindowBuildCallback=function(e,t){var i=t.tjsObject;if(i.node.position.set(e.mesh.position.x,e.mesh.position.y,e.mesh.position.z),e.mesh.position.set(0,0,0),i.node.add(e.mesh),i.setupAnimations({animations:e.resource.animations}),e.isWindow?i.isWindow=!0:e.isOpen&&i.open(),i.animationClips)for(var r=0;r<i.animationClips.length;r++){var n=i.animationClips[r];if("_defaultAnim_"===n.name){i.playAnimation({name:n.name,loop:!0,speed:.15});break}}},e.prototype.parseGroups=function(e,t){for(var i=0;i<e.groups.length;i++){var r=e.groups[i];this.createTjsGroup(r,t)}},e.prototype.createTjsGroup=function(e,t){e.registerBuildCallbackListener(this.groupBuildCallback,{loader:this,parent:t})},e.prototype.groupBuildCallback=function(e,t){var i="Thing";e.jsonData&&e.jsonData.type&&(i=e.jsonData.type);var r=t.parent;t.loader.app.objectManager.create({uuid:e.id,id:e.userID,name:e.name,node:e.mesh,belongRoomUserID:e.belongRoomUserID,type:i,hideByScene:!e.isShow,parent:r,properties:e.properties})},e.prototype.parseRooms=function(e,t){for(var i=0;i<e.rooms.length;i++){var r=e.rooms[i];this.createTjsRoom(r,t)}},e.prototype.createTjsRoom=function(e,t){new THREE.Object3D,new THREE.Object3D,new THREE.Object3D;var i=this.app.objectManager.create({type:"Room",name:e.name,node:new THREE.Object3D,uuid:e.id,id:e.userID,floorHideByScene:!e.floor.isShow,ceilingHideByScene:!e.ceiling.isShow,roofHideByScene:!e.roof.isShow,parent:t,holes:e.holes,properties:e.properties});e.registerBuildCallbackListener(this.roomBuildCallback,{loader:this,tjsObject:i})},e.prototype.roomBuildCallback=function(e,t){var i=t.tjsObject;i.node.position.set(e.mesh.position.x,e.mesh.position.y,e.mesh.position.z),e.mesh.position.set(0,0,0),i.node.add(e.mesh),e.floor.isShow?i._floorNode=e.floor.mesh:e.mesh.remove(e.floor.mesh),e.ceiling.isShow?i._ceilingNode=e.ceiling.mesh:e.mesh.remove(e.ceiling.mesh),e.roof.isShow?i._roofNode=e.roof.mesh:e.mesh.remove(e.roof.mesh)},e.prototype.parseVideoProbes=function(e,t){for(var i=0;i<e.videoprobes.length;i++){var r=e.videoprobes[i];this.createTjsVideoProbe(r,t)}},e.prototype.createTjsVideoProbe=function(e,t){var i=new THREE.Object3D,r=this.app.objectManager.create({id:e.userID,name:e.name,uuid:e.id,node:i,belongRoomUserID:e.belongRoomUserID,parent:t,hideByScene:!e.isShow,initBoxSize:[e.size.x,e.size.y,e.size.z],url:e.resource.getModelUrl(),animations:e.resource.animations,properties:e.properties});this.addBoxNode(e,r),t instanceof Ai||t.showObjectsInParentLevels||(r.visible=!1),e.registerBuildCallbackListener(this.videoProbeBuildCallback,{loader:this,tjsObject:r}),this.addSfStyle(r.node,"Thing")},e.prototype.videoProbeBuildCallback=function(e,t){t.tjsObject.node.add(e.mesh)},e.prototype.parsePipeLines=function(e,t){for(var i=0;i<e.pipelines.length;i++){var r=e.pipelines[i];this.createTjsPipeLine(r,t)}},e.prototype.createTjsPipeLine=function(e,t){e.registerBuildCallbackListener(this.pipeLineBuildCallback,{loader:this,tjsParent:t})},e.prototype.pipeLineBuildCallback=function(e,t){for(var i=t.tjsParent,r=e,n=t.loader,o=[],a=0;a<r.points.length;a++){var s=r.points[a].clone();s.add(r.position),o.push(s)}var l={type:"PolygonLine",name:r.name,points:o,id:r.userID,uuid:r.id,parent:i,spaceType:THING.SpaceType.Local,style:{}};if(r.color?l.style.color="#"+r.color.getHexString():l.style.color="#ffffff",!r.resource.isEmpty){var c=r.resource.texture.clone();c.flipY=!1,l.image=c}var u=n.app.objectManager.create(l);r.sectionType&&"Triangle"===r.sectionType&&(u.pathRadialSegments=3,u._updateByPoints()),r.radius&&(u.width=r.radius),i instanceof Ai||(u.visible=!1)},e.prototype.parseCurveLines=function(e,t){for(var i=0;i<e.curvelines.length;i++){var r=e.curvelines[i];this.createTjsCurveLine(r,t)}},e.prototype.createTjsCurveLine=function(e,t){e.registerBuildCallbackListener(this.curveLineBuildCallback,{loader:this,tjsParent:t})},e.prototype.curveLineBuildCallback=function(e,t){for(var i=t.tjsParent,r=t.loader,n=e,o=[],a=0;a<n.points.length;a++){var s=n.points[a].clone();s.add(n.position),o.push(s)}var l={type:"RouteLine",parent:i,name:n.name,uuid:n.id,id:n.userID,points:o,arrowFlag:!1,spaceType:THING.SpaceType.Local,style:{}};if(n.color&&(l.style.color="#"+n.color.getHexString()),!n.resource.isEmpty&&e.resource.texture){var c=e.resource.texture.clone();c.flipY=!1,c.rotation=Math.PI/2,l.image=c}var u=r.app.objectManager.create(l);null!==n.width&&(u.width=n.width),u.scrollSpeed=-10,u.rotateScrollDirection=!0,i instanceof Ai||(u.visible=!1)},e.prototype.createCombinedObject=function(e,t,i){var r=new THREE.Object3D,n=this.app.objectManager.create({uuid:e.id,node:r,parent:t,type:"CombinedObject"});if(n.userData.json2meshType=i,e.registerBuildCallbackListener(this.combinedObjectBuildCallback,{loader:this,tjsObject:n,typeName:i}),"CombineFloor"===i)this.addSfStyle(n.node,t instanceof Ai?"Region":"Floor--floor");else if("CombineCeiling"===i)this.addSfStyle(n.node,"Floor--ceiling");else if("CombineRoof"===i)this.addSfStyle(n.node,"Floor--roof");else if("CombinePlacement"===i){var o=e.resource.modelID;this.addSfStyle(n.node,this.isTree(o)?"Thing-":"Thing")}else"CombineStraightManualWall"===i?this.addSfStyle(n.node,t instanceof Ai?"Fence":"Floor--manualWall"):"CombineModelWall"===i?this.addSfStyle(n.node,t instanceof Ai?"Fence":"Floor--manualWall"):"CombineDoorOrWindow"===i&&(n.node.isDoorOrWin=!0,this.addSfStyle(n.node,t instanceof Ai?"Door-outdoor":"Door"))},e.prototype.addBoxNode=function(e,t){var i=new THREE.BoxBufferGeometry(1,1,1),r=new THREE.MeshBasicMaterial;r.visible=!1;var n=new THREE.Mesh(i,r);n.scale.set(e.size.x,e.size.y,e.size.z),n.userData.asBoundingBox=!0;var o=e.position;n.position.set(o.x,o.y,o.z),t.node.add(n)},e.prototype.combinedObjectBuildCallback=function(e,t){var i=t.tjsObject;"CombineDoorOrWindow"===t.typeName&&(e.mesh.isDoorOrWin=!0),i.node.add(e.mesh)},e.prototype.addSfStyle=function(e,t){},e.prototype.groupAddSfStyle=function(e){var t=e.placements;if(t)for(var i=0;i<t.length;i++){var r=t[i];this.addSfStyle(r.mesh,this.isTree(r.resource.modelID)?"Thing-":"Thing")}var n=e.groups;if(n)for(var o=0;o<n.length;o++){var a=n[o];this.groupAddSfStyle(a)}},e.prototype.buildingAddSfsStyle=function(){},e.prototype.setSfStyle=function(){for(var e=0;e<this.sfStyleDict.length;e++){var t=this.sfStyleDict[e],i=t.node,r=t.style,n=i.getMeshes();if(n&&0<n.length)for(var o=0;o<n.length;o++)n[o]._sfStyle=r}},e.prototype.isTree=function(e){return!!Oi[e]},e}(),Oi={"3629A959F80C4D0EA31D1E26524735B8":{title:"",id:"3629A959F80C4D0EA31D1E26524735B8",type:"Placement",size:[8.1,9.60776,8.7],version:"7"},BB23ED379CFB4A0AB14BD124EC2995BE:{title:"E",id:"BB23ED379CFB4A0AB14BD124EC2995BE",type:"Placement",size:[.64347,1.34912,.8],version:"7"},A7D96546FA744C38A949DFC6FEE43B6A:{title:"D",id:"A7D96546FA744C38A949DFC6FEE43B6A",type:"Placement",size:[.6,1.1,.6],version:"7"},FA5766D2AA074128ABB5D4CA3FF45B36:{title:"C",id:"FA5766D2AA074128ABB5D4CA3FF45B36",type:"Placement",size:[.4,.61599,.39999],version:"6"},"8EC4FF7178E64C538B215D69684E4F92":{title:"A",id:"8EC4FF7178E64C538B215D69684E4F92",type:"Placement",size:[.4,.5,.4],version:"6"},"449c02c5e8f84a2aa32f58ed53aa24b9":{title:"",id:"449c02c5e8f84a2aa32f58ed53aa24b9",type:"Placement",size:[.23118,.5986,.24155],version:"1"},c26acc8a9f804d8da2f49aba46283ac3:{title:"",id:"c26acc8a9f804d8da2f49aba46283ac3",type:"Placement",size:[7.85544,7.80654,7.44832],version:"2"},"07b2d180e1ea42de98723fe147f6750a":{title:"_02",id:"07b2d180e1ea42de98723fe147f6750a",type:"Placement",size:[10.3207,9.84333,10.0598],version:"3"},"2c969242db5f4da58442182ccbda7471":{title:"_03",id:"2c969242db5f4da58442182ccbda7471",type:"Placement",size:[7.20139,25.1363,6.56474],version:"4"},D26DB25C34C94CAABF24FED40F1A9719:{title:"",id:"D26DB25C34C94CAABF24FED40F1A9719",type:"Placement",size:[8.24071,19.2,7.6],version:"6"},"ebafecf0-cc89-42dc-b847-0f841a31bdca":{title:"",id:"ebafecf0-cc89-42dc-b847-0f841a31bdca",type:"Placement",size:[4.94077,5.83847,4.78861],version:"9"},"4EF86FC4FFA44013AC4F45E8CD0D343F":{title:"",id:"4EF86FC4FFA44013AC4F45E8CD0D343F",type:"Placement",size:[5.66699,7.4,6.233],version:"6"},"9C27FD900C4443FBA1151C9DF767D19A":{title:"",id:"9C27FD900C4443FBA1151C9DF767D19A",type:"Placement",size:[7.50716,8.2,7.87936],version:"6"},"6b768c2d-3c2f-4954-a625-ef4b57f72a47":{title:"",id:"6b768c2d-3c2f-4954-a625-ef4b57f72a47",type:"Placement",size:[6.32989,7.49752,5.72546],version:"8"},"9fc66d5b-a213-4fc6-9fc6-f759aa88716a":{title:"wxz03",id:"9fc66d5b-a213-4fc6-9fc6-f759aa88716a",type:"Placement",size:[4.5,9.4,4.4],version:"4"},"963de658-70b6-49e7-bb0e-504ad603fe27":{title:"wxz01",id:"963de658-70b6-49e7-bb0e-504ad603fe27",type:"Placement",size:[1.4073,4.03187,1.37224],version:"5"},"d5b06cf7-2a31-4252-8d7c-02d48815ed18":{title:"02",id:"d5b06cf7-2a31-4252-8d7c-02d48815ed18",type:"Placement",size:[7.3,7.4,6.1],version:"4"},"f9058709-ee84-41f6-8260-fbb734dc9483":{title:"01",id:"f9058709-ee84-41f6-8260-fbb734dc9483",type:"Placement",size:[4.3,7.2,4],version:"4"},"be7d0bfc-ce60-4132-8a88-afd1301c82b3":{title:"01",id:"be7d0bfc-ce60-4132-8a88-afd1301c82b3",type:"Placement",size:[4.41539,7.57112,4.49063],version:"5"},"95bd04fe237f42e0adeabb78028c8ee7":{title:"",id:"95bd04fe237f42e0adeabb78028c8ee7",type:"Placement",size:[4.41539,7.57112,4.49063],version:"1"}},Li=function(e){function t(i){return r(this,t),a(this,e.call(this,i))}return o(t,e),t.prototype.parseCombinePlacements=function(e,t){for(var i=0;i<e.combinePlacementObjects.length;i++){var r=e.combinePlacementObjects[i];this.createCombinePlacements(r,t)}},t.prototype.createCombinePlacements=function(e,t){var i=t;e.belongRoomUserID&&(i=this.app.query("#"+e.belongRoomUserID)[0]);var r=this.app.objectManager.create({type:"CombinedObject",node:new THREE.Object3D,properties:{isCombine:!0},belongRoomUserID:e.belongRoomUserID,parent:i}),n=e.resource.modelID;this.addSfStyle(r.node,this.isTree(n)?"Thing-":"Thing"),r.pickable=!1,r.userData.json2meshType="CombinePlacement",e.registerBuildCallbackListener(this.placementCombinedObjectBuildCallback,{loader:this,plan:t,tjsObject:r})},t.prototype.placementCombinedObjectBuildCallback=function(e,t){var i=t.tjsObject,r=t.plan;i.node.add(e.mesh),i.position=r.selfToWorld(e.position.toArray())},t.prototype.createTjsPlacement=function(e,t){var i=e,r="Thing";i.jsonData&&i.jsonData.type&&(r=i.jsonData.type);var n=new THREE.Object3D,o=this.app.objectManager.create({uuid:i.id,id:i.userID,name:i.name,node:n,parent:t,belongRoomUserID:i.belongRoomUserID,hideByScene:!i.isShow,type:r,initBoxSize:[i.size.x,i.size.y,i.size.z],url:i.resource.getModelUrl(),properties:i.properties});this.addBoxNode(e,o),o.bundleID=i.resource.modelID,o.bundleName=i.resource.modelName,t instanceof Ai||t.showObjectsInParentLevels||(o.visible=!1),e.registerBuildCallbackListener(this.placementBuildCallback,{loader:this,tjsObject:o});var a=null;i.properties&&(a=i.properties._styleTag_),a?this.addSfStyle(o.node,a):this.addSfStyle(o.node,this.isTree(i.resource.modelID)?"Thing-":"Thing")},t.prototype.placementBuildCallback=function(e,t){var i=e,r=t.tjsObject;if(r.node.add(e.mesh),r.setupAnimations({animations:i.resource.animations}),i.isPlayAnim&&r.containAnimation(i.animClip)){var n={name:i.animClip,loop:!1,speed:.15};i.hasSkin&&(n.loop=!0),r.playAnimation(n)}},t.prototype.createTjsGroup=function(e,t){var i="Thing";e.jsonData&&e.jsonData.type&&(i=e.jsonData.type);var r=new THREE.Object3D,n=this.app.objectManager.create({uuid:e.id,id:e.userID,name:e.name,node:r,belongRoomUserID:e.belongRoomUserID,type:i,hideByScene:!e.isShow,parent:t,properties:e.properties});this.addBoxNode(e,n),e.registerBuildCallbackListener(this.groupBuildCallback,{loader:this,tjsObject:n})},t.prototype.groupBuildCallback=function(e,t){var i=t.tjsObject,r=t.loader;i.node.add(e.mesh),r.groupAddSfStyle(e)},t}(Ci),ki=function(){function e(){r(this,e),this.world=null}return e.prototype.parseWorld=function(e){this.world=e;for(var t=0;t<e.buildings.length;t++){var i=e.buildings[t];this.parseBuilding(i)}e.outdoors&&this.parseFloorPlan(e.outdoors)},e.prototype.parseBuilding=function(e){this.parseFacades(e);for(var t=e.floorplans,i=0;i<t.length;i++){var r=t[i];this.parseFloorPlan(r)}},e.prototype.parseFacades=function(e){for(var t=e.facades,i=e.facadeGroups,r=0;r<t.length;r++)t[r].registerBuildCallbackListener(this.facadeBuildCallback,{loader:this});for(var n=0;n<i.length;n++)i[n].registerBuildCallbackListener(this.facadeBuildCallback,{loader:this})},e.prototype.facadeBuildCallback=function(e,t){var i=e.mesh.getMeshes();i&&0<i.length&&i.forEach(function(e){e._sfStyle="Facade"})},e.prototype.parseFloorPlan=function(e){this.parseDoorOrWindows(e),this.parseCombineFloors(e),this.parseCombineCeilings(e),this.parseCombineRoofs(e),this.parseCombinePlacements(e),this.parseCombineStraightManualWalls(e),this.parseCombineModelWalls(e),this.parseCombineDoorOrWindows(e),this.parseGroups(e),this.parsePlacements(e),this.parseRooms(e),this.parseVideoProbes(e)},e.prototype.parseCombineFloors=function(e){for(var t=0;t<e.combineFloorObjects.length;t++){var i=e.combineFloorObjects[t];this.registerCombineObjectBuildCallback(i,"CombineFloor")}},e.prototype.parseCombineCeilings=function(e){for(var t=0;t<e.combineCeilingObjects.length;t++){var i=e.combineCeilingObjects[t];this.registerCombineObjectBuildCallback(i,"CombineCeiling")}},e.prototype.parseCombineRoofs=function(e){for(var t=0;t<e.combineRoofObjects.length;t++){var i=e.combineRoofObjects[t];this.registerCombineObjectBuildCallback(i,"CombineRoof")}},e.prototype.parseCombinePlacements=function(e){for(var t=0;t<e.combinePlacementObjects.length;t++){var i=e.combinePlacementObjects[t];this.registerCombineObjectBuildCallback(i,"CombinePlacement")}},e.prototype.parseCombineStraightManualWalls=function(e){for(var t=0;t<e.combineStraightManualWallObjects.length;t++){var i=e.combineStraightManualWallObjects[t];this.registerCombineObjectBuildCallback(i,"CombineStraightManualWall")}},e.prototype.parseCombineModelWalls=function(e){for(var t=0;t<e.combineModelWallObjects.length;t++){var i=e.combineModelWallObjects[t];this.registerCombineObjectBuildCallback(i,"CombineModelWall")}},e.prototype.parseCombineDoorOrWindows=function(e){for(var t=0;t<e.combineDoorOrWindowObjects.length;t++){var i=e.combineDoorOrWindowObjects[t];this.registerCombineObjectBuildCallback(i,"CombineDoorOrWindow")}},e.prototype.parsePlacements=function(e){for(var t=0;t<e.placements.length;t++)e.placements[t].registerBuildCallbackListener(this.placementBuildCallback,{loader:this})},e.prototype.placementBuildCallback=function(e,t){var i=t.loader,r=e,n=null;r.properties&&(n=r.properties._styleTag_),n?i.addSfStyle(e.mesh,n):i.addSfStyle(e.mesh,i.isTree(r.resource.modelID)?"Thing-":"Thing")},e.prototype.parseDoorOrWindows=function(e){for(var t=0;t<e.doorOrWindows.length;t++)e.doorOrWindows[t].registerBuildCallbackListener(this.doorOrWindowBuildCallback,{loader:this})},e.prototype.doorOrWindowBuildCallback=function(e,t){t.loader.addSfStyle(e.mesh,e.parent instanceof json2mesh.Outdoors?"Door-outdoor":"Door")},e.prototype.parseGroups=function(e){for(var t=0;t<e.groups.length;t++)e.groups[t].registerBuildCallbackListener(this.groupBuildCallback,{loader:this})},e.prototype.groupBuildCallback=function(e,t){t.loader.groupAddSfStyle(e)},e.prototype.parseRooms=function(e){for(var t=0;t<e.rooms.length;t++)e.rooms[t].registerBuildCallbackListener(this.roomBuildCallback,{loader:this})},e.prototype.roomBuildCallback=function(e,t){var i=t.loader;i.addSfStyle(e.ceiling.mesh,"Floor--ceiling"),i.addSfStyle(e.roof.mesh,"Floor--roof"),i.addSfStyle(e.floor.mesh,"Floor--floor")},e.prototype.parseVideoProbes=function(e){for(var t=0;t<e.videoprobes.length;t++)e.videoprobes[t].registerBuildCallbackListener(this.videoProbeBuildCallback,{loader:this})},e.prototype.videoProbeBuildCallback=function(e,t){t.loader.addSfStyle(e.mesh,"Thing")},e.prototype.registerCombineObjectBuildCallback=function(e,t){e.registerBuildCallbackListener(this.combinedObjectBuildCallback,{loader:this,typeName:t})},e.prototype.combinedObjectBuildCallback=function(e,t){var i=e,r=t.typeName,n=t.loader;if("CombineFloor"===r)n.addSfStyle(i.mesh,e.parent instanceof json2mesh.Outdoors?"Region":"Floor--floor");else if("CombineCeiling"===r)n.addSfStyle(i.mesh,"Floor--ceiling");else if("CombineRoof"===r)n.addSfStyle(i.mesh,"Floor--roof");else if("CombinePlacement"===r){var o=e.resource.modelID;n.addSfStyle(i.mesh,n.isTree(o)?"Thing-":"Thing")}else"CombineStraightManualWall"===r?n.addSfStyle(i.mesh,e.parent instanceof json2mesh.Outdoors?"Fence":"Floor--manualWall"):"CombineModelWall"===r?n.addSfStyle(i.mesh,e.parent instanceof json2mesh.Outdoors?"Fence":"Floor--manualWall"):"CombineDoorOrWindow"===r&&n.addSfStyle(i.mesh,e.parent instanceof json2mesh.Outdoors?"Door-outdoor":"Door")},e.prototype.addSfStyle=function(e,t){var i=e.getMeshes();if(i&&0<i.length)for(var r=0;r<i.length;r++)i[r]._sfStyle=t},e.prototype.groupAddSfStyle=function(e){var t=e.placements;if(t)for(var i=0;i<t.length;i++){var r=t[i];this.addSfStyle(r.mesh,this.isTree(r.resource.modelID)?"Thing-":"Thing")}var n=e.groups;if(n)for(var o=0;o<n.length;o++){var a=n[o];this.groupAddSfStyle(a)}},e.prototype.isTree=function(e){return!!Hi[e]},e}(),Hi={"3629A959F80C4D0EA31D1E26524735B8":{title:"",id:"3629A959F80C4D0EA31D1E26524735B8",type:"Placement",size:[8.1,9.60776,8.7],version:"7"},BB23ED379CFB4A0AB14BD124EC2995BE:{title:"E",id:"BB23ED379CFB4A0AB14BD124EC2995BE",type:"Placement",size:[.64347,1.34912,.8],version:"7"},A7D96546FA744C38A949DFC6FEE43B6A:{title:"D",id:"A7D96546FA744C38A949DFC6FEE43B6A",type:"Placement",size:[.6,1.1,.6],version:"7"},FA5766D2AA074128ABB5D4CA3FF45B36:{title:"C",id:"FA5766D2AA074128ABB5D4CA3FF45B36",type:"Placement",size:[.4,.61599,.39999],version:"6"},"8EC4FF7178E64C538B215D69684E4F92":{title:"A",id:"8EC4FF7178E64C538B215D69684E4F92",type:"Placement",size:[.4,.5,.4],version:"6"},"449c02c5e8f84a2aa32f58ed53aa24b9":{title:"",id:"449c02c5e8f84a2aa32f58ed53aa24b9",type:"Placement",size:[.23118,.5986,.24155],version:"1"},c26acc8a9f804d8da2f49aba46283ac3:{title:"",id:"c26acc8a9f804d8da2f49aba46283ac3",type:"Placement",size:[7.85544,7.80654,7.44832],version:"2"},"07b2d180e1ea42de98723fe147f6750a":{title:"_02",id:"07b2d180e1ea42de98723fe147f6750a",type:"Placement",size:[10.3207,9.84333,10.0598],version:"3"},"2c969242db5f4da58442182ccbda7471":{title:"_03",id:"2c969242db5f4da58442182ccbda7471",type:"Placement",size:[7.20139,25.1363,6.56474],version:"4"},D26DB25C34C94CAABF24FED40F1A9719:{title:"",id:"D26DB25C34C94CAABF24FED40F1A9719",type:"Placement",size:[8.24071,19.2,7.6],version:"6"},"ebafecf0-cc89-42dc-b847-0f841a31bdca":{title:"",id:"ebafecf0-cc89-42dc-b847-0f841a31bdca",type:"Placement",size:[4.94077,5.83847,4.78861],version:"9"},"4EF86FC4FFA44013AC4F45E8CD0D343F":{title:"",id:"4EF86FC4FFA44013AC4F45E8CD0D343F",type:"Placement",size:[5.66699,7.4,6.233],version:"6"},"9C27FD900C4443FBA1151C9DF767D19A":{title:"",id:"9C27FD900C4443FBA1151C9DF767D19A",type:"Placement",size:[7.50716,8.2,7.87936],version:"6"},"6b768c2d-3c2f-4954-a625-ef4b57f72a47":{title:"",id:"6b768c2d-3c2f-4954-a625-ef4b57f72a47",type:"Placement",size:[6.32989,7.49752,5.72546],version:"8"},"9fc66d5b-a213-4fc6-9fc6-f759aa88716a":{title:"wxz03",id:"9fc66d5b-a213-4fc6-9fc6-f759aa88716a",type:"Placement",size:[4.5,9.4,4.4],version:"4"},"963de658-70b6-49e7-bb0e-504ad603fe27":{title:"wxz01",id:"963de658-70b6-49e7-bb0e-504ad603fe27",type:"Placement",size:[1.4073,4.03187,1.37224],version:"5"},"d5b06cf7-2a31-4252-8d7c-02d48815ed18":{title:"02",id:"d5b06cf7-2a31-4252-8d7c-02d48815ed18",type:"Placement",size:[7.3,7.4,6.1],version:"4"},"f9058709-ee84-41f6-8260-fbb734dc9483":{title:"01",id:"f9058709-ee84-41f6-8260-fbb734dc9483",type:"Placement",size:[4.3,7.2,4],version:"4"},"be7d0bfc-ce60-4132-8a88-afd1301c82b3":{title:"01",id:"be7d0bfc-ce60-4132-8a88-afd1301c82b3",type:"Placement",size:[4.41539,7.57112,4.49063],version:"5"},"95bd04fe237f42e0adeabb78028c8ee7":{title:"",id:"95bd04fe237f42e0adeabb78028c8ee7",type:"Placement",size:[4.41539,7.57112,4.49063],version:"1"}},ji=function(){function e(t,i){if(r(this,e),this.app=t,this.resourceUrl=null,this.relativeResourceUrl=null,this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.tempTexture=null,this.indexJson=i,this.sceneJsonUri="scene.json",this.defaultWallTextureUri="Textures/RoomWall.jpg",this.defaultWallEdgeTextureUri="Textures/WallEdge.jpg",this.defaultFloorTextureUri="Textures/FloorDefault.jpg",this.defaultCeilingTextureUri="Textures/CeilingDefault.jpg",this.defaultRoofTextureUri="Textures/RoofDefault.jpg",this.defaultWallTexture=null,this.defaultCeilingTexture=null,this.defaultFloorTexture=null,this.defaultRoofTexture=null,this.defaultWallEdgeTexture=null,this.worldNode=new THREE.Object3D("world"),this.isCamFitScene=!0,this.campus=null,this.outdoorsVisible=!0,this.campusVisible=!0,this.enableUseHighestVersionResource=!0,this.enableDownloadSceneJsonCache=!0,this.enableDynamicLoad=!1,this.enableProxima=!1,this.worldNode,i&&(i.position&&(this.campusPosition=i.position),i.rotation&&(this.campusRotation=i.rotation),void 0!==i.isCamFitScene&&null!==i.isCamFitScene&&(this.isCamFitScene=i.isCamFitScene),i.scale&&(this.campusScale=i.scale),void 0!==i.outdoorsVisible&&(this.outdoorsVisible=i.outdoorsVisible),void 0!==i.campusVisible&&(this.campusVisible=i.campusVisible),i.campus&&(this.campus=i.campus),i.enableDynamicLoadScene&&(this.enableDynamicLoad=i.enableDynamicLoadScene),i.enableProxima&&(this.enableProxima=i.enableProxima),void 0!==i.enableUseHighestVersionResource&&(this.enableUseHighestVersionResource=i.enableUseHighestVersionResource,json2mesh.DefaultSetting.enableUseHighestVersionResource=this.enableUseHighestVersionResource),void 0!==i.enableDownloadSceneJsonCache&&(this.enableDownloadSceneJsonCache=i.enableDownloadSceneJsonCache),i.startDownloadResourcesCallback&&(this.startDownloadResourcesCallback=i.startDownloadResourcesCallback)),this.campus&&(this.campusRotation&&this.campus.node.quaternion.set(this.campusRotation.x,this.campusRotation.y,this.campusRotation.z,this.campusRotation.w),this.campusPosition&&(this.campus.position=this.campusPosition),this.campusScale&&(this.campus.scale=this.campusScale)),i.default){var n=i.default;n.sceneJson&&(this.sceneJson="export.json"),n.wallTexture&&(this.defaultWallTextureUri=n.wallTexture),n.wallEdgeTexture&&(this.defaultWallEdgeTextureUri=n.wallEdgeTexture),n.floorTexture&&(this.defaultFloorTextureUri=n.floorTexture),n.ceilingTexture&&(this.defaultCeilingTextureUri=n.ceilingTexture),n.roofTexture&&(this.defaultRoofTextureUri=n.roofTexture)}this.app.options.loaderResourceUrl&&(this.resourceUrl=this.app.options.loaderResourceUrl),null!=this.app.options.enableUseHighestVersionResource&&(this.enableUseHighestVersionResource=this.app.options.enableUseHighestVersionResource,json2mesh.DefaultSetting.enableUseHighestVersionResource=this.enableUseHighestVersionResource),this.app.options.resourceLibraryUrl&&(this.resourceUrl=this.app.options.resourceLibraryUrl),this.indexJson.resourceLibrary&&(this.relativeResourceUrl=this.indexJson.resourceLibrary),this.enableDownloadSceneJsonCache||(this.sceneJsonUri+="?_t="+(new Date).getTime()),this.json2meshToThingjsParser=null}return e.prototype.parseCamInfo=function(e){var t=e.eye,i=e.target,r=t.split(" "),n=i.split(" "),o=[Number(r[0]),Number(r[1]),Number(r[2])];o[2]=-o[2];var a=[Number(n[0]),Number(n[1]),Number(n[2])];a[2]=-a[2],this.app.camera.position=o,this.app.camera.target=a},e.prototype.exportJsonString=function(e){for(var t=e.outdoors,i=e.buildings,r=[],n=[],o=0;o<t.things.length;o++){var a=t.things[o];r.push({id:a.id,name:a.name})}for(o=0;o<t.rooms.length;o++){var s=t.rooms[o];n.push({id:s.id,name:s.name})}var l=[];for(o=0;o<i.length;o++){for(var c=i[o],u=[],h=0;h<c.floors.length;h++){for(var p=c.floors[h],d=[],f=[],m=0;m<p.things.length;m++){var g=p.things[m];d.push({id:g.id,name:g.name})}for(m=0;m<p.rooms.length;m++)s=p.rooms[m],f.push({id:s.id,name:s.name});u.push({id:p.id,name:p.name,placements:d,rooms:f})}l.push({id:c.id,name:c.name,plans:u})}return{id:e.id,name:e.name,outdoors:{id:t.id,name:t.name,placements:r,rooms:n},buildings:l}},e.prototype.load=function(e){var t=this;if(t.enableProxima?(t.json2meshToThingjsParser=new Li(t.app),json2mesh.DefaultSetting.enableCombinePlacementsByRoom=!0):t.json2meshToThingjsParser=new Ci(t.app),"String"===e.constructor.name)this.sceneURL=e;else if("Object"===e.constructor.name){var i=e;this.sceneURL=i.url,i.campus&&(this.campus=i.campus,this.worldNode=this.campus.node,this.json2meshToThingjsParser.setCampus(this.campus))}return this.relativeResourceUrl&&(0===this.relativeResourceUrl.indexOf("./")?this.resourceUrl=this.sceneURL+this.relativeResourceUrl.replace("./","/"):this.resourceUrl=this.relativeResourceUrl),new Promise(function(e,i){t.updateProgress(.1),t.loadSceneJson().then(function(i){t.sceneJson=JSON.parse(i),t.sceneJson.camInfo&&t.isCamFitScene&&t.parseCamInfo(t.sceneJson.camInfo),t.updateProgress(.1);var r=new json2mesh.UBuilderSceneDelayLoader;t.enableDynamicLoad&&(r.enableRequestWorld=!1),t.resourceUrl&&(r.resourceManager.baseTextureUrl=t.resourceUrl+"/texture/",r.resourceManager.baseModelUrl=t.resourceUrl+"/model/"),(t.loader=r).delayLoad({json:t.sceneJson,customModeBaseUrl:t.sceneURL+"/"}).then(function(i){(new ki).parseWorld(i),t.sceneJson.camInfo&&t.isCamFitScene&&t.parseCamInfo(t.sceneJson.camInfo),t.campus.visible=t.campusVisible,t.campusRotation&&t.campus.node.quaternion.set(t.campusRotation.x,t.campusRotation.y,t.campusRotation.z,t.campusRotation.w),t.campusPosition&&(t.campus.position=t.campusPosition),t.campusScale&&(t.campus.scale=t.campusScale),t.campus=t.json2meshToThingjsParser.parseWorld(i),t.startDownloadResourcesCallback&&t.startDownloadResourcesCallback(r.resourceManager.models,r.resourceManager.textures),t.enableDynamicLoad?(t.loadExtraData(t.campus),t.updateProgress(1),e(t.campus)):r.startToBuild(function(i){t.updateProgress(.1+.9*i),1===i&&(t.updateProgress(1),t.loadExtraData(t.campus),e(t.campus))})})})})},e.prototype.loadExtraData=function(e){this.sceneJson.extraData&&(e.extraData=this.sceneJson.extraData)},e.prototype.loadSceneJson=function(){var e=this;return new Promise(function(t,i){new THREE.FileLoader(e.app.loadingManager).load(e.sceneURL+"/"+e.sceneJsonUri,function(e){t(e)})})},e.prototype.updateProgress=function(e){this.app.mainUI.updateLoadingProcess({object:this.campus,progress:e})},e.prototype.startToDownloadRequestResources=function(e){this.loader.resourceManager.startToDownloadRequestResources(e)},e.prototype.addResourceDownloadRequest=function(e){this.loader.resourceManager.addResourceDownloadRequest(e)},e.prototype.clearAllResources=function(){this.loader.resourceManager.disposeModels(),this.loader.resourceManager.disposeTextures()},e.prototype.clearAllObjects=function(){this.world.clear()},e.prototype.requestToBuild=function(e){this.loader.requestToBuild(e)},e.prototype.startToBuild=function(e){return this.loader.startToBuild(e)},e.prototype.disposeObject=function(e){this.loader.disposeObject(e)},e.prototype.findObjectByID=function(e){return this.world.findObjectByID(e)},e}(),Fi=function(){function e(t){r(this,e),this.app=t,this.nodes=[],this.scene=this.app.scene,this.objectPool=this.app.objectPool,this.rootNode=null,this.campus=null,this.sceneURL=null,this.sceneJsonData=null,this.loadedSceneGLTF=null,this.worldNode=new THREE.Object3D,this.fitCamInfo=null}return e.prototype.parse=function(e){if(this.parseWorld(e),e.camInfo){var t=e.camInfo;this.fitCamInfo=t}},e.prototype.parseCamInfo=function(e){var t=e.eye,i=e.target,r=t.split(" "),n=i.split(" "),o=[Number(r[0]),Number(r[1]),Number(r[2])];o[2]=-o[2];var a=[Number(n[0]),Number(n[1]),Number(n[2])];a[2]=-a[2],this.app.camera.position=o,this.app.camera.target=a},e.prototype.parseWorld=function(e){var t=this.worldNode;if(null==this.campus&&(this.campus=this.app.objectManager.create({type:"Campus",name:"Campus",node:t}),this.campus.node.name="campus",this.app.scene.add(this.campus.node)),e.outdoors&&this.parseOutdoors(e.outdoors),e.buildings){var i=e.buildings;this.parseBuildings(i)}},e.prototype.parseOutdoors=function(e){var t=e,i=new THREE.Object3D;this.outdoors=this.app.objectManager.create({type:"Outdoors",name:"Outdoors",parent:this.campus,node:i});var r=this.outdoors;this.app.outdoors||(this.app.outdoors=this.outdoors,this.app.currentParentObject=this.outdoors);var n=t.gltfid;if(n&&this.nodes[n]){var o=this.nodes[n];THREE.SceneUtils.detach(o,o.parent,this.app.scene),THREE.SceneUtils.attach(o,this.app.scene,r.node),r.node.updateMatrixWorld()}this.parseFloorPlan(t,r)},e.prototype.parseBuildings=function(e){for(var t in e){var i=e[t],r=t;i.name&&(r=i.name);var n=null;if(i.gltfid){var o=i.gltfid;this.nodes[o]&&(n=this.nodes[o])}var a=this.app.objectManager.create({type:"Building",name:r,parent:this.campus,node:n});i.plans&&this.parseFloorPlans(i.plans,a),i.facades&&this.parseFacades(i.facades,a)}},e.prototype.parseFloorPlans=function(e,t){for(var i in e){var r=null,n=e[i],o=i;n.name&&(o=n.name);var a=n.gltfid;a&&this.nodes[a]&&(r=this.nodes[a]);var s=this.app.objectManager.create({type:"Floor",name:o,node:r,parent:t});this.parseFloorPlan(n,s)}},e.prototype.parseFloorPlan=function(e,t){e.placements&&this.parseThings(e.placements,t),e.videoprobes&&this.parseThings(e.videoprobes,t),e.doororwindows&&this.parseDoorWins(e.doororwindows,t),e.routes&&this.parseThings(e.routes,t),e.pipelines&&this.parseThings(e.pipelines,t),e.curvelines&&this.parseThings(e.curvelines,t),e.arrowlines&&this.parseThings(e.arrowlines,t),e.arrowdatalines&&this.parseThings(e.arrowdatalines,t),e.leakwaterlines&&this.parseThings(e.leakwaterlines,t),e.rooms&&this.parseRooms(e.rooms,t),this.parseStructure(e,t);var i=e.groups;i&&this.parseGroup(i,t)},e.prototype.parseRooms=function(e,t){for(var i=0;i<e.length;i++){var r=e[i],n=null;r.name&&(n=r.name);var o=null,a=r.gltfid;a&&this.nodes[a]&&(o=this.nodes[a]);var s=null,l=r.properties;if(l)for(var c in s={},l){var u=l[c];s[c]=u}var h=null,p=null,d=null;r.floor&&(a=r.floor.gltfid,this.nodes[a]&&(d=this.nodes[a])),r.ceiling&&(a=r.ceiling.gltfid,this.nodes[a]&&(h=this.nodes[a])),r.roof&&(a=r.roof.gltfid,this.nodes[a]&&(p=this.nodes[a]));var f=null,m=null,g=null,v={};if(r.area&&(m=r.area,v.area=m),r.circumference&&(g=r.circumference,v.circumference=g),r.center){var y=r.center;(f=new THREE.Vector3).set(y[0],y[1],-y[2]),v.center=f}var b=r.isShown;if(b){var _="false"!==(b=b.toLowerCase());o.visible=_}this.app.objectManager.create({type:"Room",name:n,node:o,ceilingNode:h,roofNode:p,floorNode:d,parent:t,properties:s,auxiliaryInfo:v})}},e.prototype.parseStructure=function(e,t){if(e.structure){var i=(e=e.structure).placements;if(i)for(var r in i){var n=i[r].gltfid,o=this.nodes[n];if(o){t.miscNode=o.parent;break}}var a=e.walls;if(a)for(var r in a){n=a[r].gltfid;var s=this.nodes[n];if(s){t.wallNode=s.parent;break}}var l=e.roofs;if(l)for(var r in l){n=l[r].gltfid;var c=this.nodes[n];if(c){t.roofNode=c.parent;break}}var u=e.ceilings;if(u)for(var r in u){n=u[r].gltfid;var h=this.nodes[n];if(h){t.ceilingNode=h.parent;break}}if(p=e.floors)for(var r in p){var p;if(n=(p=p[r]).gltfid){var d=this.nodes[n];if(d){t.floorNode=d.parent;break}}}}},e.prototype.parseGroup=function(e,t){for(var i in e){var r=e[i],n=i;r.name&&(n=r.name);var o=null,a=r.gltfid;a&&this.nodes[a]&&(o=this.nodes[a]);var s=null,l=r.properties;if(l)for(var c in s={},l){var u=l[c];s[c]=u}this.app.objectManager.create({type:"Thing",name:n,node:o,parent:t,properties:s}),r.placements&&this.parseThings(r.placements,t)}},e.prototype.parseFacades=function(e,t){for(var i in e){var r=e[i],n=i;r.name&&(n=r.name);var o=null,a=r.gltfid;a&&this.nodes[a]&&(o=this.nodes[a]);var s=null,l=r.properties;if(l)for(var c in s={},l){var u=l[c];s[c]=u}var h=r.isShown;if(h){var p="false"!==(h=h.toLowerCase());o.visible=p}this.app.objectManager.create({type:"Facade",name:n,node:o,parent:t,properties:s}),t.node.add(o)}},e.prototype.parseThings=function(e,t){for(var i in e){var r=e[i],n=r.name||i,o=r.type||"Thing",a=null,s=r.gltfid;s&&this.nodes[s]&&(a=this.nodes[s]);var l=null,c=r.properties;if(c)for(var u in l={},c){var h=c[u];l[u]=h}var p=r.isShown;if(p){var d="false"!==(p=p.toLowerCase());a.visible=d}this.app.objectManager.create({type:o,name:n,node:a,parent:t,properties:l})}},e.prototype.parseDoorWins=function(e,t){for(var i in e){var r=e[i],n=i;r.name&&(n=r.name);var o=null;if(r.gltfid){var a=r.gltfid;this.nodes[a]&&(o=this.nodes[a])}var s=null;if(r.properties){var l=r.properties;for(var c in s={},l){var u=l[c];s[c]=u}}this.app.objectManager.create({type:"Door",name:n,node:o,parent:t,properties:s})}},e.prototype.load=function(e){var t=this;if("String"===e.constructor.name)this.sceneURL=e;else if("Object"===e.constructor.name){var i=e;this.sceneURL=i.url,i.campus&&(this.campus=i.campus,this.worldNode=this.campus.node)}return new Promise(function(e,i){t.loadGLTF().then(function(e){return(t.loadedSceneGLTF=e).scene.traverse(function(e){t.nodes[e.name]=e}),t.parseSceneJson()}).then(function(i){t.fitCamInfo?t.parseCamInfo(t.fitCamInfo):t.campus.node&&t.app.camera.fit(t.campus),e(t.campus)}).catch(function(){t.campus.node.add(t.loadedSceneGLTF.scene.children[0]),t.campus&&t.app.camera.fit(t.campus),e(t.campus)})})},e.prototype.loadGLTF=function(){var e=this;return new Promise(function(t,i){var r=new THREE.GLTFLoader(e.app.loadingManager);r.setCrossOrigin("anonymous"),r.load(e.sceneURL+"/Unity2GLTF.gltf",function(e){t(e)})})},e.prototype.parseSceneJson=function(){var e=this;return new Promise(function(t,i){new THREE.FileLoader(e.app.loadingManager).load(e.sceneURL+"/scene.json",function(i){var r=JSON.parse(i);e.sceneJsonData=r,e.parseWorld(r),t(r)},function(){},function(){console.error("not find file scene.json "),i()})})},e}(),Di=function(){function e(t){r(this,e),this.app=t,this.supportVersion={1:1,2:1,3:0},this.versionLib={1:{0:{0:Ti},1:{0:Fi}},2:{0:{0:xi},1:{0:Ei,1:wi}},3:{0:{0:ji,1:ji}}}}return e.prototype.getLoader=function(e){if(e){var t=e.version,i=0,r=0,n=0;if(t){var o=t.split(".");i=parseInt(o[0]),r=parseInt(o[1]),n=parseInt(o[2])}var a=null,s=this.versionLib[i];if(s){var l=s[r];l&&(a=l[n])}if(!a)return console.error("can not find right version "+t+" to load scenejson"),null;if(1===i)h=new a(this.app);else if(2===i)switch(r){case 1:var c={},u=e.position;u&&(c.position=u),e.rotation&&(c.rotation=e.rotation),e.campus&&(c.campus=e.campus),c.isCamFitScene=Te.parseValue(e.isCamFitScene,!0),c.isDelayLoadFloorPlan=Te.parseValue(e.isDelayLoadFloorPlan,!1),h=new a(this.app,c);break;default:h=new a(this.app)}else 3===i&&(h=new a(this.app,e));return h}var h=new Ti(this.app);return h},e}(),Bi=function(){function e(t){r(this,e),t=t||"",this._major=0,this._minor=0,this._modified=0;var i=t.split(".");this._major=parseInt(1<=i.length?i[0]:0),this._minor=parseInt(2<=i.length?i[1]:0),this._modified=parseInt(3<=i.length?i[2]:0)}return e.prototype.compare=function(t){return Te.isString(t)&&(t=new e(t)),this._major!=t._major?this._major>t._major?1:-1:this._minor!=t._minor?this._minor>t._minor?1:-1:this._modified!=t._modified?this._modified>t._modified?1:-1:0},n(e,[{key:"major",get:function(){return this._major}},{key:"minor",get:function(){return this._minor}},{key:"modified",get:function(){return this._modified}}]),e}(),Ii=function(){function e(t){r(this,e),this.app=t}return e.prototype.parse=function(e,t,i,r,n){switch(e.type){case"Thing":case"Door":case"Window":return[this._parseThing(e,t,i,r)];case"Building":return this._parseBuilding(e,t,i,r);case"Facade":return this._parseFacade(e,t,i,r);case"Fence":case"CurveFence":return this._parseFence(e,t,i,r,n);case"BatchFence":return this._parseBatchFence(e,t,i,r,n);case"Region":return this._parseRegion(e,t,i,r,n);case"Group":return this._parseGroup(e,t,i,r,n);case"BatchObject":return[this._parseBatchObject(e,t,i,r,n)];default:return console.warn("Parse object failed, due to '"+e.type+"' unknown object type"),null}},e.prototype._parseThing=function(e,t,i,r){var n=this,o={uuid:e.uuid,name:e.name,id:e.id,type:e.type,tags:e.tags,userData:e.userData,parent:i,localPosition:e.position};if(null!=e.hideByScene&&1==e.hideByScene?o.hideByScene=!0:null!=e.visible&&0==e.visible&&(o.hideByScene=!0),void 0!==e.model){var a=this._getModelInfo(e.model,t.models);a&&(o.url=a.url)}if(void 0!==e.texture){var s=this._getTextureInfo(e.texture,t.textures);s&&(o.url=s.url)}var l=e.rotation;l&&((l=Te.parseAngles(new THREE.Quaternion(l[0],l[1],l[2],l[3])))[0]=Te.parseValue(l[0],0),l[1]=Te.parseValue(l[1],0),l[2]=Te.parseValue(l[2],0),o.angles=l);var c=e.scale;if(c&&(c[0]=c[0]||1,c[1]=c[1]||1,c[2]=c[2]||1,o.scale=c),r)for(var u in r)o[u]=r[u];var h=void 0,p=new Promise(function(e){o.complete=function(t){return e(t)},h=n.app.create(o)});return p.object=h,p},e.prototype._parseBuilding=function(e,t,i,r){var n=this,o=[],a=this._parseThing(e,t,i,r);if(o.push(a),e.facades){var s=e.facades.children,l=e.facades.scale;s.forEach(function(e){l&&(e.scale=l),o.push(n.parse(e,t,a.object))})}return o},e.prototype._parseFacade=function(e,t,i,r){return this._parseThing(e,t,i,r)},e.prototype._parseFence=function(e,t,i,r){var n=this,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:[],a=[],s={},l=e.start;if(!o[l])return null;s.startPoint=o[l];var c=e.end;if(!o[c])return null;s.endPoint=o[c];var u=e.control;if(void 0!==u&&(s.controlPoint=o[u]),e.doors){s.doors=[];var h=(new THREE.Vector2).fromArray(s.startPoint),p=(new THREE.Vector2).fromArray(s.endPoint);e.doors.forEach(function(e){var r=p.clone().sub(h).normalize().angle(),o=n._parseThing(e,t,i,{angles:[0,180*-r/Math.PI,0]});a.push(o);var l=o.object,c=n._getModelInfo(e.model,t.models).size[0]*l.scale[0],u=new THREE.Vector2(e.position[0],e.position[2]),d=h.distanceTo(u)/h.distanceTo(p);s.doors.push({width:c,percent:d})})}if(r)for(var d in r)s[d]=r[d];return a.push(this._parseThing(e,t,i,s)),a},e.prototype._parseRegion=function(e,t,i,r){var n=4<arguments.length&&void 0!==arguments[4]?arguments[4]:[],o={};if(e.points&&(o.points=e.points.map(function(e){return{pos:n[e.pos]}})),o.level=e.level,e.repeatUV&&(o.repeatUV=e.repeatUV),r)for(var a in r)o[a]=r[a];var s=this._parseThing(e,t,i,o);return s.object.addControl(new THING.RegionAutoOffset({object:s.object})),[s]},e.prototype._parseGroup=function(e,t,i,r,n){var o=this,a=[],s={type:"Thing"};if(r)for(var l in r)s[l]=r[l];var c=this._parseThing(e,t,i,s);return a.push(c),e.children&&e.children.forEach(function(e){a=a.concat(o.parse(e,t,c.object,void 0,n))}),a},e.prototype._parseBatchObject=function(e,t,i,r,n){var o={type:e.type,parent:i,localPosition:e.localPosition};if(void 0!==e.model){var a=this._getModelInfo(e.model,t.models);a&&(o.url=a.url)}var s=this,l=void 0,c=new Promise(function(t){o.complete=function(i){l=i.object,null!=e.children&&e.children.forEach(function(e){!function(e){var t={localPosition:e.position},i=e.rotation;i&&((i=Te.parseAngles(new THREE.Quaternion(i[0],i[1],i[2],i[3])))[0]=Te.parseValue(i[0],0),i[1]=Te.parseValue(i[1],0),i[2]=Te.parseValue(i[2],0),t.angles=i);var r=e.scale;r&&(r[0]=r[0]||1,r[1]=r[1]||1,r[2]=r[2]||1,t.scale=r),l.createSubObject(t)}(e)}),t(l)},(l=s.app.create(o)).canNotQueryFromSelector=!0});return c.object=l,c},e.prototype._parseBatchFence=function(e,t,i,r,n){var o=this,a=this,s=[],l={type:"Fence",BatchFence:"BatchFence",parent:i},c=[];if(l.fencesData=c,e.fencesData&&e.fencesData.forEach(function(e){var o=function(e,n){var o=[],s={},l=e.start;if(!n[l])return null;s.startPoint=n[l];var c=e.end;if(!n[c])return null;s.endPoint=n[c];var u=e.control;if(void 0!==u&&(s.controlPoint=n[u]),e.doors){s.doors=[];var h=(new THREE.Vector2).fromArray(s.startPoint),p=(new THREE.Vector2).fromArray(s.endPoint);e.doors.forEach(function(e){var r=p.clone().sub(h).normalize().angle(),n=a._parseThing(e,t,i,{angles:[0,180*-r/Math.PI,0]});o.push(n);var l=n.object,c=a._getModelInfo(e.model,t.models).size[0]*l.scale[0],u=new THREE.Vector2(e.position[0],e.position[2]),d=h.distanceTo(u)/h.distanceTo(p);s.doors.push({width:c,percent:d})})}if(r)for(var d in r)s[d]=r[d];return[function(e,t,i,r){var n={uuid:e.uuid,name:e.name,id:e.id,type:e.type,tags:e.tags,userData:e.userData,parent:i,localPosition:e.position};if(null!=e.hideByScene&&1==e.hideByScene?n.hideByScene=!0:null!=e.visible&&0==e.visible&&(n.hideByScene=!0),void 0!==e.model){var o=a._getModelInfo(e.model,t.models);o&&(n.url=o.url)}if(void 0!==e.texture){var s=a._getTextureInfo(e.texture,t.textures);s&&(n.url=s.url)}var l=e.rotation;l&&((l=Te.parseAngles(new THREE.Quaternion(l[0],l[1],l[2],l[3])))[0]=Te.parseValue(l[0],0),l[1]=Te.parseValue(l[1],0),l[2]=Te.parseValue(l[2],0),n.angles=l);var c=e.scale;if(c&&(c[0]=c[0]||1,c[1]=c[1]||1,c[2]=c[2]||1,n.scale=c),r)for(var u in r)n[u]=r[u];return n}(e,t,i,s),o]}(e,n);if(0<o.length&&o[0]&&c.push(o[0]),1<o.length){var l=o[1];0<l.length&&l.forEach(function(e){s.push(e)})}}),void 0!==e.model){var u=this._getModelInfo(e.model,t.models);u&&(l.url=u.url)}if(r)for(var h in r)l[h]=r[h];var p=void 0,d=new Promise(function(e){l.complete=function(t){return e(t)},(p=o.app.create(l)).canNotQueryFromSelector=!0});return d.object=p,s.push(d),s},e.prototype._getModelInfo=function(e,t){if(Te.isNull(e)||e>=t.length)return console.warn("can not find model info from index '"+e+"'."),null;var i=t[e];return i.id?{id:i.id,name:i.name,size:i.size||[.5,.5,.5],url:this.app.confirmModelURL(i.id)}:(console.warn("model info id not set: "+JSON.stringify(i)),null)},e.prototype._getTextureInfo=function(e,t){if(Te.isNull(e)||e>=t.length)return console.warn("can not find texture info from index '"+e+"'."),null;var i=t[e];return i.id?i.ext?{id:i.id,name:i.name,url:"https://static.3dmomoda.com/textures/"+i.id+"."+i.ext}:(console.warn("texture info ext not set: "+JSON.stringify(i)),null):(console.warn("texture info id not set: "+JSON.stringify(i)),null)},e}(),Ni=!1,Ui=function(){function e(t){r(this,e),this.app=t,this.waitingLoadCampuses=[],this.loadingCampus=!1,this._objectLoader=new Ii(t),this._combineLoader=new Vi(t)}return e.prototype._loadViewPointFile=function(e){var t=this.app.sceneManager,i=Te.parseValue(e.enableDeafultViewPointFile,t.enableDeafultViewPointFile),r=e.defaultViewPointFileName||t.defaultViewPointFileName;if(i&&r){var n=e.url.appendPath(r),o=this;(new THREE.FileLoader).load(n,function(e){o.app.viewPointManger.loadJSON(e)})}},e.prototype._runScript=function(e){var i,r;(i=Te.isString(e)?e:(r=e,t?t.decodeString(r):""))&&_e(i)},e.prototype.loadFromUBuilder=function(e,t,i,r,n){var o=this,a=r.position,s=r.rotation||r.angles,l=r.scale,c=Te.parseValue(r.outdoorsVisible||r.visible,!0),u=Te.parseValue(r.campusVisible||r.visible,!0),h=Te.parseValue(r.isCamFitScene,!0),p=Te.parseValue(r.isDelayLoadFloorPlan,!1),d=r.splitLoadSpeed,f=Te.parseValue(r.disableCache,!1),m=Te.parseValue(r.dynamic,!1),g=Te.parseValue(r.enableProxima,!1);a&&(i.position=a),s&&(i.rotation=Te.parseQuaternion(s)),l&&(i.scale=l),void 0!==c&&(i.outdoorsVisible=c),void 0!==u&&(i.campusVisible=u),i.isCamFitScene=h,i.isDelayLoadFloorPlan=p,i.enableDownloadSceneJsonCache=!f,i.isDynamicLoadScene=Te.parseValue(m,i.isDynamicLoadScene),i.enableDynamicLoadScene=i.isDynamicLoadScene,i.enableProxima=Te.parseValue(g,i.enableProxima);var v=new Di(this.app).getLoader(i);e.isDynamicLoadScene=Te.parseValue(i.isDynamicLoadScene,!1),e.isDynamicLoadScene&&(e._builder=v),v.loadSpeed=d;var y=i.camInfo;y&&(v.fitCamInfo=y),this.app.root._staticEnableFlag.enable(!1,!0),v.load({campus:e,url:t}).then(function(e){var t=v.sceneJson?v.sceneJson:i;if(t){var r=t.camInfo;r&&(r.eye=Te.parseVector3(r.eye),r.eye.z*=-1,r.eye=r.eye.toArray(),r.target=Te.parseVector3(r.target),r.target.z*=-1,r.target=r.target.toArray())}e.sceneJSONData=t,e.position=e.position||a,e.angles=e.angles||s,n&&n(),o.app.root._staticEnableFlag.resume()})},e.prototype._notifyLoadingProgress=function(e){var t=(e.loadedNumber+e.resourceLoadedNumber)/(e.totalNumber+e.resourceTotalNumber);this.app.mainUI.updateLoadingProcess(t)},e.prototype.updateResourceItemNumber=function(e){e.resourceLoadedNumber++,this._notifyLoadingProgress(e)},e.prototype.updateTotalResourceItemNumber=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;e.resourceTotalNumber+=t},e.prototype.updateItemNumber=function(e){if(e.loadedNumber++,this._notifyLoadingProgress(e),e.loadedNumber==e.totalNumber){var t=function(){var t=e.complete;t&&t(),e.complete=null},i=e.afterLoadScript;if(i){var r=url.appendPath(i);ve(r,function(e){that._runScript(e),t()})}else t()}},e.prototype.updateTotalItemNumber=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;e.totalNumber+=t},e.prototype.getBundleData=function(e,t){if(Te.isNull(e)||e>=t.length)return!1;var i=t[e],r=i.id;return!!r&&{id:r,url:this.app.confirmModelURL(r),name:i.name,size:i.size}},e.prototype.getTextureData=function(e,t){if(Te.isNull(e)||e>=t.length)return!1;var i=t[e],r=i.id;if(!r)return!1;var n=i.ext;return!!n&&{id:r,url:"https://static.3dmomoda.com/textures/"+r+"."+n,name:i.name}},e.prototype.parseFloorPlan=function(e,t,i,r){var n=this;this.updateTotalItemNumber(i,1),e.setupFromData({data:t,complete:function(){var e=this.internalUserData.edgeShape;e&&(n.app.resourceManager.remove(e),delete this.internalUserData.edgeShape),n.updateItemNumber(i)}})},e.prototype.parseFloorPlanByMeshData=function(e,t,i){if(e&&t&&t.data){var r=e.internalUserData.height,n=t.data.structure;if(!n)return;n.planheight=r,t=this._combineLoader.combineFloor(t),this.parseFloorPlan(e,t.data,i)}},e.prototype.parseFloorPlans=function(e,t,i,r){for(var n=e.buildings,o=0;o<n.length;o++){var a=n[o],s=t[a.uuid]||null;if(s){if(!this.parseFloorShapes(a,s,i,r))return!1;var l=a.floors;this.updateTotalItemNumber(i,l.length);for(var c=0;c<l.length;c++){var u=l[c],h=s.floors[c];this.parseFloorPlanByMeshData(u,h,i),this.updateItemNumber(i)}}}return!0},e.prototype.parseFloorShapes=function(e,t,i,r){var n=t.floors;if(!n)return!1;for(var o=0,a=0;a<n.length;a++){var s,l=n[a],c=l.uuid,u=l.name||c,h=l.height||3,p=new THREE.Color(1,1,1),d=l.outlineData;if(d)(s=this.app.create({type:"Shape",vertices:d,height:1,parent:e})).scale=[1,h,1],s.style.setMaterial({index:0,side:THREE.FrontSide,color:p,opacity:.5,depthTest:!1,depthWrite:!0,transparent:!0}),s.style.setMaterial({index:1,side:THREE.FrontSide,color:p,opacity:.5,depthTest:!1,depthWrite:!0,transparent:!0});else{var f=t.size;(s=this.app.create({type:"Box",width:f[0],height:h,depth:f[2],center:"Bottom",parent:e})).style.setMaterial({side:THREE.FrontSide,color:p,opacity:.5,depthTest:!1,depthWrite:!0,transparent:!0})}s.style.edgeColor=16777215;var m=this.app.create({type:"Floor",name:u,localPosition:[0,o,0],parent:e,visible:!1,uuid:c});m.internalUserData.edgeShape=s.node,m.node.add(s.node),s.style.skipStyle=!0,s.node=new THREE.Group,s.style._edgeWireframes.clear(),s.destroy(),o+=m.internalUserData.height=h}return!0},e.prototype.parseFloorDoor=function(e,t,i){var r=this,n=t.key.split("_"),o=t.suspendpercent?3*t.suspendpercent:0,a=[.01*t.pos[0],o,.01*t.pos[1]],s={uuid:n[1],type:"Door",url:this.app.confirmModelURL(t.typeId),localPosition:a,parent:e,complete:function(){this.scale=[.01*t.width/this.boundingBox.initSize[0],.01*t.height/this.boundingBox.initSize[1],1],this.angles=[0,-t.rotation,0],r.updateItemNumber(i)}};this.app.create(s)},e.prototype.parseGround=function(e,t){t.image&&(t.type="Ground",t.parent=e,this.app.create(t).style.setPolygonOffset({polygonOffset:!0,polygonOffsetFactor:0,polygonOffsetUnits:11e3}))},e.prototype.parseEffects=function(e,t){var i=t.fog;i&&(this.app.fog=i);var r=t.lighting;r&&(this.app.lighting=r);var n=t.postEffect;n&&(this.app.postEffect=n);var o=t.skyBox;o&&(this.app.skyBox=o);var a=t.ground;a&&(Te.isString(a)&&(a={width:1e3,height:1e3,image:a,repeatUV:[100,100]}),this.parseGround(e,a))},e.prototype.parseScene=function(e,t,i,r){var n=this,o=this;if(t=zi.convertData({dataType:"campus",data:t},i.version),Te.parseValue(r.isCamFitScene,!1)){var a=i.camInfo;if(a){var s=Te.parseVector3(a.eye);s&&(this.app.camera.position=s.toArray());var l=Te.parseVector3(a.target);l&&(this.app.camera.target=l.toArray()),e.sceneJSONData.camInfo={eye:s.toArray(),target:l.toArray()}}}if(i.coordinates){var c=i.coordinates;e.coordinates=c}if(t.models&&t.textures){var u=i.style;u&&Object.keys(u).length&&(this.app.applyTheme(u),e.applyTheme(u)),e.node.visible=Te.parseValue(r.visible,!0),t.loadedNumber=0,t.totalNumber=0,t.resourceLoadedNumber=0,t.resourceTotalNumber=0;var h=i.afterLoadScript||r.afterLoadScript;h&&(t.totalNumber++,t.afterLoadScript=h);var p=i.files.floors;p&&this.updateTotalItemNumber(t,1);var d=t.corners,f=t.objects;if(f)for(var m in f=this._combineLoader.combineObjects(f)){var g=f[m];this.updateTotalItemNumber(t,g.length);for(var v=0;v<g.length;v++){var y=g[v],b=this._objectLoader.parse(y,t,e,void 0,d);this.updateTotalResourceItemNumber(t,b.length),b.forEach(function(e){e.then(function(){return n.updateResourceItemNumber(t)})}),this.updateItemNumber(t)}}var _=i.effects;if(_&&this.parseEffects(e,_),p){var x=t.url.appendPath(p);(r.fileloader||new THREE.FileLoader).load(x,function(n){var a=JSON.parse(n);(a=zi.convertData({dataType:"floor",data:a},i.version))&&o.parseFloorPlans(e,a,t,r),o.updateItemNumber(t)},function(){},function(){o.updateItemNumber(t)})}}},e.prototype._loadScene=function(e,t,i,r,n,o){var a=this,s=e.appendPath(t);(n.fileloader||new THREE.FileLoader).load(s,function(t){var s=JSON.parse(t);s.url=e,s.complete=o,a.parseScene(i,s,r,n)},function(){},function(){})},e.prototype.loadFromCampusBuildier=function(e,t,i,r,n){var o=this,a=(t=this.app.confirmURL(t),i.files);if(a){var s=a.campus;if(s){var l=r.parent||this.app.root;l&&(r.skipSetupParent=!0,l.add(e));var c=i.beforeLoadScript||r.beforeLoadScript;if(c){var u=t.appendPath(c);ve(u,function(a){o._runScript(a),o._loadScene(t,s,e,i,r,n)})}else this._loadScene(t,s,e,i,r,n)}else console.error('load "'+t+'" failed, due to scene file name of index.json is missing')}else console.error('load "'+t+'" failed, due to files of index.json is missing')},e.prototype._loadCampusFinished=function(e,t){e._processModel(),this._loadViewPointFile(t),this.app._lightGroup.setConfig({}),this._removeTypeMap(t);var i=this.app.level;i.current?i.currentParentObject=i.current:i.currentParentObject=this.app.root,console.log("ThingJS: "+THING.VERSION)},e.prototype._convertOutdoorsToGround=function(e){if(e.outdoors){var t=e.outdoors.node;t.userData={},t.removeBySelf();var i=e.outdoors.id,r=e.outdoors.uuid,n=this.app.create({type:"Ground",id:i,uuid:r,node:t,visible:e.outdoors.visible,parent:e.outdoors.parent});e.outdoors.query("*",!1).not(".CombinedObject").forEach(function(t){e.add(t)}),e.outdoors.query(".CombinedObject",!1).forEach(function(e){n.add(e)}),e.outdoors.node=new THREE.Group,e.outdoors._children=[],e.outdoors.destroy(),e.outdoors=n}},e.prototype._loadFinished=function(e,t){var i=this,r=t.complete;t.complete=function(e){e.object._synEffectRefCounts(),i._loadCampusFinished(e.object,t),r&&r.call(e.object,e)},i._convertOutdoorsToGround(e),e.setupID(t),e instanceof Gi?(t.parent=t.parent||this.app.root,e._setup(t)):e instanceof Buliding&&e._setup(t)},e.prototype.load=function(e,t){var i=this,r=this.app.confirmURL(t.url),n=r.appendPath("index.json");Te.parseValue(t.disableCache,!1)&&(n=n.appendRandomSuffix()),(t.fileloader||new THREE.FileLoader).load(n,function(n){var o=JSON.parse(n);V?new Bi(o.version).major<4?i.waitingLoadCampuses.push({owner:e,url:r,indexJson:o,params:t}):i.loadCampus(e,r,o,t):i.waitingLoadCampuses.push({owner:e,url:r,indexJson:o,params:t})},function(){},function(){var n=t.error||t.errorCallback;n&&n({url:r}),new Di(i.app).getLoader().load({campus:e,url:r}).then(function(e){i._loadFinished(e,t)})})},e.prototype._setupTypeMap=function(e){var t=e.typeMap;if(t)for(var i=0;i<t.length;i++){var r=t[i];Te.addCastType(r.type,r.condition,r.params)}},e.prototype._removeTypeMap=function(e){var t=e.typeMap;if(t)for(var i=0;i<t.length;i++){var r=t[i];Te.removeCastType(r.type,r.condition,r.params)}},e.prototype.loadCampus=function(e,t,i,r){var n=this,o=function(e,t){n._loadFinished(e,t),n.loadingCampus=!1,e.loaded=!0,setTimeout(function(){n.app.trigger("campusready",{object:e})},500)};i.resourceLibrary=r.loadResourceUrl||i.resourceLibrary,i.enableUseHighestVersionResource=r.enableUseHighestVersionResource,i.startDownloadResourcesCallback=function(e,t){var i=n.app.onLoadModelResourceCallback;if(i)for(var r=0;r<e.length;r++){var o=e[r],a=i(o);a&&(o.url=a)}},this.loadingCampus=!0,json2mesh.DefaultSetting.enableFloorLightMap=Te.parseValue(r.enableFloorLightMap,!1),r.indexJson=i,e.trigger(H.BeforeLoad,r),this.app.loadingProgressBar.prepare(),this._setupTypeMap(r),e.loading=!0;var a=new Bi(i.version);if("BIM"==i.type){var s=i.resources||{},l=Object.keys(s);l.length&&new THREE.IFCLoader(e).load(t.appendPath(l[0]).appendPath("/"),function(t){t.angles=[-90,0,0],n.app.camera.autoFixCameraUp=!1,o(e,r)},function(e){n.app.loadingProgressBar.updateProgress(e)})}else a.major<4?this.loadFromUBuilder(e,t,i,r,function(){o(e,r)}):this.loadFromCampusBuildier(e,t,i,r,function(){o(e,r)})},e.prototype.update=function(){if(V&&!this.loadingCampus)if(Y)for(var e=0;e<this.waitingLoadCampuses.length;e++){var t=this.waitingLoadCampuses[e];this.loadCampus(t.owner,t.url,t.indexJson,t.params),this.waitingLoadCampuses.splice(e,1)}else if(!Ni){var i={t:(new Date).toUTCString(),v:Math.random()};(function(e,t,i){var r={},n=c.toStr([92,250,162,250,88,34,22,228,73,14]);ee()?r[n]=e:r[n]=ae(e),G=e,ge(function(){var e=c.toStr([96,201,170,234,66,62,13,246,88,29,82,33,238,177,177,70,46,211,70]);return THING[e]?THING[e]:window.location.protocol+"//"+window.location.host.appendPath(c.toStr([16,247,187,246,25,49,55,241,104,28,65,54,204,130,145,115,11,226,65]))}(),r,function(e){X=e,t&&t()},i)})(JSON.stringify(i)),Ni=!0}},e.prototype._buildCampusStructure=function(e,t){t.app=this.app,t.type=e.type,t.name=e.name?e.name:e.id,t.id=e.id?e.id:e.uuid,t.uuid=e.uuid,t.userData=e.userData,t.children=[],t.getAttribute=function(e){return Te.getAttribute(this,e)},t.getPath=function(){for(var e=this.id,t=this.parent;t&&t.parent&&t.parent.parent;)e=t.id+"/"+e,t=t.parent;return e},t._traverseObjects=function(e,t){for(var i=0;i<this.children.length;i++){var r=this.children[i];Te.isFunction(e)?e(r):Te.isArray(e)&&e.push(r),t&&r._traverseObjects(e,t)}},t.query=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],i=[];this._traverseObjects(i,t);var r=new qe(this.app,i);return r.select(e),r};var i=0;e instanceof THING.Floor&&(i=1);for(var r=i;r<e.children.length;r++){var n=e.children[r],o={id:n.id,parent:t};t.children.push(o),this._buildCampusStructure(n,o)}},e.prototype._peekJSONBySimpleLoader=function(e,t,i){var r=i.complete,n=i.errorCallback||i.error,o=this;t.load(e).then(function(t){var i={url:e,id:t.id,children:[]};o._buildCampusStructure(t,i),t.destroy(),r&&r(i)}).catch(function(e){console.error(e),n&&n()})},e.prototype.peekJSON=function(e,t){t=t||{};var i=(e=this.app.confirmURL(e)).appendPath("index.json");Te.parseValue(t.disableCache,!1)&&(i=i.appendRandomSuffix());var r=t.fileloader||new THREE.FileLoader,n=this;r.load(i,function(i){var r=JSON.parse(i),o=new Bi(r.version);4==o.major||(3==o.major?n._peekJSONBySimpleLoader(e,new si(n.app),t):n._peekJSONBySimpleLoader(e,new ai(n.app),t))},function(){},function(){n._peekJSONBySimpleLoader(e,new ai(n.app),t)})},e.prototype.onUpdate=function(e){this.update(e)},e}(),Vi=function(){function e(t){r(this,e),this.app=t}return e.prototype.combineObjects=function(e){return e&&(e=this._parseObjects(e)),e},e.prototype.combineFloor=function(e){var t=e.data,i=t.objects;return i&&(t.objects=this.combineObjects(i)),e},e.prototype._parseObjects=function(e){var t={},i={};if(e){var r=e.Thing;if(r){var n=this._parseThings(r);g(n[0]),t.Thing=n[1]}var o=e.Building;o&&(t.Building=o);var a=e.Region;a&&(t.Region=a);var s=e.Fence;if(s){var l=[],c=this._parseFence(s),u=c[0];Object.keys(u).forEach(function(e){l.push(u[e])}),t.Fence=c[1],0<l.length&&(t.BatchFence=l)}var h=e.CurveFence;h&&(t.CurveFence=h);var p=e.Group;if(p){var d=this._parseGroups(p);g(d[0]),t.Group=d[1]}}var f=[];for(var m in i)f.push(i[m]);return 0<f.length&&(t.BatchObject=f),0<Object.keys(t).length?t:e;function g(e){Object.keys(e).forEach(function(t){var r=i[t],n=e[t];r||(i[t]=n),n.children.forEach(function(e){n.children.push(e)})})}},e.prototype._parseThings=function(e){var t=this,i={},r=[];return e.forEach(function(e){if(t._isCombine(e)){var n=e.model,o=i[n];o||(o={type:"BatchObject",model:n,children:[]},i[n]=o),o.children.push(e)}else r.push(e)}),[i,r]},e.prototype._parseGroups=function(e){var t=this,i=this,r={},n=[],o=this.app.create({type:"Thing",uuid:"test111"}),a={};return e.forEach(function(e){if(t._isCombine(e)){var s=e.rotation||[0,0,0,1],l=THING.Utils.parseAngles(new THREE.Quaternion(s[0],s[1],s[2],s[3]));!function e(t,n){var o=t.children;o&&o.forEach(function(t){if("Group"==t.type){var o=t.rotation||[0,0,0,1],s=THING.Utils.parseAngles(new THREE.Quaternion(o[0],o[1],o[2],o[3])),l=i.app.create({uuid:j.generateUUID(),type:"Thing",parent:n,localPosition:t.position,angles:s});e(t,l)}else{var c=t.model,u=r[c];u||(u={type:"BatchObject",model:c,children:[]},r[c]=u);var h=t.rotation||[0,0,0,1],p=THING.Utils.parseAngles(new THREE.Quaternion(h[0],h[1],h[2],h[3])),d=i.app.create({uuid:j.generateUUID(),type:"Thing",parent:n,localPosition:t.position,angles:p});a[d.uuid]=d,t.position=d.position,t.rotation=Te.parseQuaternion(d.worldAngles).toArray(),u.children.push(t)}})}(e,t.app.create({uuid:j.generateUUID(),type:"Thing",parent:o,localPosition:e.position,angles:l}))}else n.push(e)}),o.destroy(),[r,n]},e.prototype._parseFence=function(e){var t=this,i={},r=[];return e&&e.forEach(function(e){if(t._isCombine(e)){var n=e.model,o=i[n];o||(o={type:"BatchFence",model:n,fencesData:[]},i[n]=o),o.fencesData.push(e)}else r.push(e)}),[i,r]},e.prototype._isCombine=function(e){var t=e.id,i=e.name,r=e.userData,n=0,o=e.tag,a=0;return r&&(n=Object.keys(r).length),o&&(a=o.length,o.forEach(function(e){""==e&&(a-=1)})),!t&&!i&&n<=0&&a<=0},e}(),zi={currVersion:"4.0.2",convertData:function(e,t){var i=new Bi(zi.currVersion),r=new Bi(t);if(r.modified<i.modified)for(var n=r.modified;n<i.modified;n++){var o=r.major+"."+r.minor+"."+n,a=qi[o];a&&(e.data=a(e))}return e.data},convertData40:function(e){var t=e.dataType,i=e.data;"floor"==t&&Object.keys(i).forEach(function(e){i[e].floors.forEach(function(e){var t=e.data.structure;t.walls.forEach(function(e){for(var t=0;t<e.points.length;t++)e.points[t]/=100;e.thickness=e.thickness/100,e.height=e.height}),t.rooms.forEach(function(e){for(var t=0;t<e.polygons.length;t++)for(var i=e.polygons[t],r=0;r<i.length;r++)i[r]=i[r]/100;e.textLoc=[e.textLoc[0]/100,e.textLoc[1]/100]}),t.doors.forEach(function(e){e.size=[e.size[0]/100,e.size[1]/100]}),t.windows.forEach(function(e){e.size=[e.size[0]/100,e.size[1]/100]})})});return i},convertData41:function(e){var t=e.dataType,i=e.data;if("campus"==t&&i){var r=i.objects.Building;r&&r.forEach(function(e){var t=e.facades;if(t){for(var i={},r=[],n=0;n<t.length;n++){var o=t[n];r.push(o)}i.children=r,i.scale=[1,1,1],e.facades=i}})}return i},_areaSort:function(e){for(var t=[],i=0;i<e.length;i++){var r=e[i],n=Math.abs(THREE.ShapeUtils.area(r));t.push({area:n,index:i})}t=this.sortNumber(t,"area");for(var o=0;o<t.length;o++)t[o];return t},_getBetweenPoint:function(e,t,i){return t.clone().sub(e).multiplyScalar(i).add(e)}},qi={"4.0.0":zi.convertData40,"4.0.1":zi.convertData41},Wi=function(){function e(t){r(this,e),this.app=t}return e.prototype.load=function(e,t){var i=void 0,r=void 0;null!==e&&(r=Te.isString(e)?i=e:Te.isArray(e)?(i=e[0],e[1]):(i=this.app.skyBox||null,null));var n=null,o=null;if(r){var a=this.app.confirmURL(Te.parseCubeTextureUrls(r));a&&(n=(new THREE.CubeTextureLoader).load(a,function(){}))}if(i){var s=this.app.confirmURL(Te.parseCubeTextureUrls(i));s&&(o=(new THREE.CubeTextureLoader).load(s,function(){}))}return{indoorsEnvMap:n,outdoorsEnvMap:o}},e}(),Gi=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));n.name="Campus",n.outdoors=null,n._url="",n._sceneJSONData={},n._envMapResources=null;var o=n;return n.one("beforeload",null,function(e){var t=new Wi(o.app);o._envMapResources=t.load(o.app.options.env,e.indexJson.resourceLibrary)}),n.one("load",null,function(){ne()&&(o.node.position.z+=K(-15,11)),o.getEnvMapResources()&&o.query(".Thing || .Facade").forEach(function(e){e.setupEnvMap(e.isFacade)}),o.query(".Building").forEach(function(e){e.setupNavigationObjects()});for(var e=o._getLinkableDoors(),t=0;t<e.length;t++){var i=e[t],r=i.userData._Portal_;if(r){var n=o.app.query(r)[0];n&&(n.userData._Portal_=i.id)}}}),n}return o(t,e),t.prototype.setupFromURL=function(e){e.isCamFitScene=Te.parseValue(e.isCamFitScene,!1),this._url=this.app.confirmURL(e.url),this.app.campusLoader.load(this,e)},t.prototype.setupFromData=function(e){e.url="./",e.fileloader={load:function(t,i,r,n){var o=e.data[t.getFileName()];o?i&&i(o):n&&n()}},this.setupFromURL(e)},t.prototype.customSetup=function(e){this.setupID(e);var t=e.basePosition,i=e.baseAngles;if(t||i){var r=Te.parseVector3(t,new THREE.Vector3(0,0,0)),n=Te.parseQuaternion(i,new THREE.Quaternion),o=(new THREE.Matrix4).compose(r,n,new THREE.Vector3(1,1,1));this.node.userData._baseMatrix=o;var a=this;THREE.Object3D.prototype.onBeforeUpdateModelViewMatrix=function(e,t,i,r,n,o){if(n){var s=function(e){for(var t=e;t;t=t.parent){var i=t.userData._baseMatrix;if(i)return i}return null}(this);return!s||(this.frustumCulled=!1,this.__matrixWorld=this.__matrixWorld||new THREE.Matrix4,this.__matrixWorld.copy(this.matrixWorld),this.matrixWorld.premultiply(s),n.isShaderMaterial||a.app.camera.frustum.intersectsObject(this))?void 0:null}},THREE.Object3D.prototype.onAfterUpdateModelViewMatrix=function(e,t,i,r,n,o){this.__matrixWorld&&this.matrixWorld.copy(this.__matrixWorld)}}},t.prototype.destroy=function(){this._url&&this.app.trigger("unload",{url:this._url}),this._floorNode=null,this.outdoors&&(this.outdoors.destroy(),this.outdoors=null),this.buildings.destroyAll(),this.app.resourceManager.disposeTextures(this._envMapResources),e.prototype.destroy.call(this)},t.prototype.startToBuild=function(e){var t=this.dynamicBuilder;t&&t.startToBuild(e)},t.prototype._setVisible=function(t){e.prototype._setVisible.call(this,t),this.outdoors&&(this.outdoors.visible=t)},t.prototype._setupNavigationGraph=function(t,i){var r=this;e.prototype._setupNavigationGraph.call(this,t,i);for(var n=this._getLinkableDoors(),o=0;o<n.length;o++){var a=n[o];t[a.id]=t[a.id]||{};for(var s=a._getLinkableObjects(),l=0;l<s.length;l++){var c=s[l];t[c.id]=t[c.id]||{},t[c.id][a.id]=t[a.id][c.id]=i;var u=c.parents.query(".Floor")[0];if(u){var h=u.getRoomFromWorldPosition(c.position);h&&(t[h.id]=t[h.id]||{},t[c.id][h.id]=t[h.id][c.id]=i)}}}this.query(".Building").forEach(function(e){e.query(".Floor").forEach(function(e){e._setupNavigationGraph(t,i)})}),this._queryChild(".Room").forEach(function(e){t[e.id]=t[e.id]||{},t[r.id][e.id]=t[e.id][r.id]=i})},t.prototype.canNavigation=function(){return!0},t.prototype.getNavigationData=function(){var e=this;function t(e,t){e.push(t.min.x),e.push(t.min.z),e.push(t.min.x),e.push(t.max.z),e.push(t.max.x),e.push(t.max.z),e.push(t.max.x),e.push(t.min.z)}function i(e,t){for(var i=0;i<e.length;i++){var r=e[i];if(r.intersectsBox(t))return void r.union(t)}e.push(t)}function r(e,t){if(t!=e){if(t.isBuilding)return!0;if(t.isThing)return!0}return!1}var n=[];t(n,(new THREE.Box3)._setFromObject(this.node));for(var o=function(t){for(var n=[],o=t.children,a=0;a<o.length;a++){var s=o[a];if(r(t,s)){var l=(new THREE.Box3)._setFromObject(s.node),c=new THREE.Vector3;l.getSize(c),c.equals(new THREE.Vector3)||i(n,l)}}return function(t){for(var i=0;i<t.length;i++)for(var r=t[i],n=i+1;n<t.length;n++)if(r.intersectsBox(t[n])){r.union(t[n]),t.splice(n,1),i=-1;break}for(i=0;i<t.length;i++){var o=t[i],a=e.worldToLocal(o.min.toArray()),s=e.worldToLocal(o.max.toArray());o.min=Te.parseVector3(a),o.max=Te.parseVector3(s)}}(n),n}(this),a=0;a<o.length;a++)t(n,o[a]);var s=[];for(a=0;a<o.length;a++)s.push(4*(s.length+1));return{data:n,holes:s}},t.prototype.getNavigationMesh=function(){var e=this.getNavigationData(),t=EarCut(e.data,e.holes);if(!t)return null;for(var i=[],r=0;r<e.data.length;r+=2)i.push(e.data[r]),i.push(0),i.push(e.data[r+1]);var n=new THREE.BufferGeometry;n.setIndex(t),n.addAttribute("position",new THREE.BufferAttribute(new Float32Array(i),3));var o=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,transparent:!0,opacity:.5});return new THREE.Mesh(n,o)},n(t,[{key:"isCampus",get:function(){return!0}},{key:"envMapResources",get:function(){return this._envMapResources}},{key:"url",get:function(){return this._url}},{key:"floorNode",set:function(e){this._floorNode=e},get:function(){return this._floorNode}},{key:"ground",get:function(){return this.outdoors}},{key:"sceneJSONData",get:function(){return this._sceneJSONData},set:function(e){e=e||{},this._sceneJSONData=e}},{key:"buildings",get:function(){return this.query(".Building",!1)}},{key:"things",get:function(){return this.query(".Thing",!1)}}]),t}(Ye),Xi=function(){function e(t){var i=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];r(this,e),this._changeFunc=t,this._enable=i,this._prevEnable=i,this._enableCounter=0}return e.prototype.enable=function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return void 0===e?this._enable:(this._enable=e,t?this._prevEnable!=this._enable&&this._enableCounter++:(this._enableCounter=0,this._prevEnable=e),this._changeFunc&&this._changeFunc(e),e)},e.prototype.resume=function(){1<this._enableCounter&&(this._enableCounter--,1<this._enableCounter)||this._prevEnable!=this._enable&&this.enable(this._prevEnable)},e}(),Yi=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));n._defaultCampus=new Gi(i);var o=new Wi(i);n._envMapResources=o.load(i.options.env);var s=n;return n._staticEnableFlag=new Xi(function(e){s.app.scene.autoUpdate!=!e&&(s.app.scene.autoUpdate=!e,e&&s.app.scene.updateMatrixWorld())},!1),n.init(),n}return o(t,e),t.prototype.init=function(){this.loaded=!0,this.campuses.destroyAll(),(this.app.level.currentParentObject=this).app.scene.add(this.node)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.app.resourceManager.disposeTextures(this._envMapResources)},t.prototype.cleanup=function(){this.app.scene.cleanup()},n(t,[{key:"canNotQueryFromSelector",get:function(){return!0}},{key:"envMapResources",get:function(){return this._envMapResources}},{key:"visible",set:function(e){this.app.scene.visible=e},get:function(){return this.app.scene.visible}},{key:"defaultCampus",get:function(){var e=this.campuses;return e.length?e[0]:this._defaultCampus}},{key:"things",get:function(){return this.query(".Thing",!1)}},{key:"campuses",get:function(){return this.query(".Campus",!1)}},{key:"wireframeColor",set:function(e){var t=Te.parseColor(e);this.app.scene.overrideMaterial=t?new THREE.MeshBasicMaterial({color:t,wireframe:!0,side:THREE.DoubleSide,skinning:!0}):null}},{key:"static",set:function(e){this._staticEnableFlag.enable(e)},get:function(){return this._staticEnableFlag.enable()}}]),t}(Ye),Qi=function(){function e(t){r(this,e),this._obj=t,this._color=null}return n(e,[{key:"color",set:function(e){this._color=e?Te.parseColor(e):null,this._obj.parent._updateAttributes(this._obj,8)},get:function(){return this._color?this._color.toHexString():this._obj.parent.style.color}}]),e}(),Zi=new THREE.Color,Ji=null,Ki=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));return n._initMeshes=[],n._instancedMeshes=[],n._maxBatchNum=64,n._batchNum=0,n._instancedAttributes={},n}return o(t,e),t.prototype._beforeSetup=function(e){this._maxBatchNum=void 0!==e.initBatchNum?e.initBatchNum:64,this._instancedAttributes.instancePosition=new THREE.InstancedBufferAttribute(new Float32Array(3*this._maxBatchNum),3),this._instancedAttributes.instanceQuaternion=new THREE.InstancedBufferAttribute(new Float32Array(4*this._maxBatchNum),4),this._instancedAttributes.instanceScale=new THREE.InstancedBufferAttribute(new Float32Array(3*this._maxBatchNum),3),this._instancedAttributes.instanceColor=new THREE.InstancedBufferAttribute(new Float32Array(3*this._maxBatchNum),3),this._instancedAttributes.instanceId=new THREE.InstancedBufferAttribute(new Float32Array(1*this._maxBatchNum),1)},t.prototype.destroy=function(){var t=this;e.prototype.destroy.call(this),this._initMeshes.forEach(function(e){t.app.resourceManager.unload(e)})},t.prototype._initInstancedMeshes=function(){var e=this;this._initMeshes=this.node.getMeshes(),this._instancedMeshes=this._initMeshes.map(function(t){return e._createInstancedMesh(t)}),this.node.children.slice(0).forEach(function(t){return e.node.remove(t)}),this._instancedMeshes.forEach(function(t){return e.node.add(t)}),this.static&&this.node._synMatrixWorld()},t.prototype._createInstancedMesh=function(e){var t=new THREE.InstancedBufferGeometry;for(var i in t.maxInstancedCount=this._batchNum,e.geometry.index&&(t.index=e.geometry.index),e.geometry.attributes)"position"===i||"normal"===i?t.addAttribute(i,e.geometry.attributes[i].clone()):t.addAttribute(i,e.geometry.attributes[i]);for(var r in this._instancedAttributes)t.addAttribute(r,this._instancedAttributes[r]);t.applyMatrix(e.getMatrixFromRoot(this.node)),e.geometry.groups&&0<e.geometry.groups.length&&(t.groups=e.geometry.groups);var n=void 0;Array.isArray(e.material)?n=e.material.map(function(e){var t=new THREE.MeshLambertMaterial({map:e.map,aoMap:e.aoMap,alphaMap:e.alphaMap,alphaTest:e.alphaTest,transparent:e.transparent,opacity:e.opacity,blending:e.blending,vertexColors:!0});return t.defines=e.defines||{},t.defines.INSTANCED="",t}):((n=new THREE.MeshLambertMaterial({map:e.material.map,aoMap:e.material.aoMap,alphaMap:e.material.alphaMap,alphaTest:e.material.alphaTest,transparent:e.material.transparent,opacity:e.material.opacity,blending:e.material.blending,vertexColors:!0})).defines=n.defines||{},n.defines.INSTANCED="");var o=new THREE.Mesh(t,n);return o.userData={skipOutline:!0},o.frustumCulled=!1,o.customDepthMaterial=(Ji||((Ji=new THREE.MeshDepthMaterial({depthPacking:THREE.RGBADepthPacking})).defines={INSTANCED:""}),Ji),o.castShadow=!0,o.receiveShadow=!0,o},t.prototype.isBatchObject=function(){return!0},t.prototype._callComplete=function(t){this._initInstancedMeshes(),e.prototype._callComplete.call(this,t)},t.prototype.createSubObject=function(e){var t=this;e.type="Thing";var i=(e.parent=this).app.create(e);i._getStyle=function(){return this._style||(this._style=new Qi(i),this._defaultStyle=this._style),this._style},this.app.picker.markPickingNode(i.node),i._style=null,i.internalUserData.__attribute_index__BatchObject__=this._batchNum,this._batchNum++,this._batchNum>this._maxBatchNum&&(this._maxBatchNum*=2,this._resizeAttributes()),this._updateAttributes(i),this._instancedMeshes.forEach(function(e){return e.geometry.maxInstancedCount=t._batchNum});var r=this;return i._notifyPositionChange=function(){r._updateAttributes(this,1)},i._notifyAnglesChange=function(){r._updateAttributes(this,2)},i._notifyScalesChange=function(){r._updateAttributes(this,4)},i._notifyDestroy=function(){r._removeAttributes(this)},i},t.prototype._resizeAttributes=function(){for(var e in this._instancedAttributes){var t=this._instancedAttributes[e],i=t.array,r=new i.constructor(this._maxBatchNum*t.itemSize);r.set(i),t.setArray(r),t.needsUpdate=!0}},t.prototype._updateAttributes=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1048575,i=e.internalUserData.__attribute_index__BatchObject__;1&t&&(this._instancedAttributes.instancePosition.array.set(e.node.position.toArray(),3*i),this._instancedAttributes.instancePosition.needsUpdate=!0),2&t&&(this._instancedAttributes.instanceQuaternion.array.set(e.node.quaternion.toArray(),4*i),this._instancedAttributes.instanceQuaternion.needsUpdate=!0),4&t&&(this._instancedAttributes.instanceScale.array.set(e.node.scale.toArray(),3*i),this._instancedAttributes.instanceScale.needsUpdate=!0),8&t&&(e._style?Zi.set(e._style.color):Zi.set(this.style.color),this._instancedAttributes.instanceColor.array.set(Zi.toArray(),3*i),this._instancedAttributes.instanceColor.needsUpdate=!0),15&t&&(this._instancedAttributes.instanceId.array[i]=e.node.id,this._instancedAttributes.instanceId.needsUpdate=!0)},t.prototype._removeAttributes=function(e){var t=e.internalUserData.__attribute_index__BatchObject__;this._instancedAttributes.instanceScale.array.set([1e-9,1e-9,1e-9],3*t),this._instancedAttributes.instanceColor.array.set([0,0,0],3*t),this._instancedAttributes.instanceScale.needsUpdate=!0,this._instancedAttributes.instanceColor.needsUpdate=!0},t}(oi),$i=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));return n.sprite=null,n.spriteVisible=!0,n.onTop=!1,n.progress=0,n}return o(t,e),t.prototype.canNotQueryFromSelector=function(){return!0},t.prototype.customSetup=function(e){var t=e.scene,i=e.height,r=e.onTop,n=this.app.calcRect();this.onTop=r;var o=new THREE.SpriteMaterial({opacity:.8,color:34816,transparent:!0});this.sprite=new THREE.Sprite(o),this.sprite.scale.set(2*n.width,i,1),this.sprite.visible=!1,this.updatePosition(n.width,n.height),this.node.add(this.sprite),t.add(this.node)},t.prototype.updatePosition=function(e,t){if(void 0===e||void 0===t){var i=this.app.calcRect();e=i.width,t=i.height}var r=this.sprite,n=-e/2,o=this.onTop?t/2-r.scale.y/2:-t/2+r.scale.y/2;r.position.set(n,o,-10)},t.prototype.updateProgress=function(e){if(!this.sprite)return!1;if(this.progress==e)return!1;this.progress=e;var t=this.app.calcRect();if(e<1&&0!=e)this.sprite.visible=this.spriteVisible;else{var i=this;setTimeout(function(){i.sprite&&(i.sprite.visible=!1)},1e3)}var r=Math.max(1,2*t.width*e);return this.sprite.scale.x=r,!0},t.prototype.resize=function(e,t){if(this.sprite){this.updatePosition(e,t);var i=Math.max(1,2*e*this.progress);this.sprite.scale.x=i}},t.prototype.prepare=function(){this.sprite.scale.x=1e-4,this.sprite.visible=this.spriteVisible},n(t,[{key:"visible",set:function(e){this.spriteVisible=e},get:function(){return this.spriteVisible}},{key:"height",set:function(e){this.sprite.scale.y=e},get:function(){return this.sprite.scale.y}}]),t}(Ye),er={};di=er,fi=Math.PI/180,di.transformSVGPath=function(e){var t,i,r,n,o=new THREE.ShapePath,a=1,s=e.length,l=0,c=0,u=0,h=0,p=null,d=null,f=0,m=0,g=0,v=0,y=0,b=0,_=0,x=0,E=0;function w(){for(var t,i,r,n=!1;a<s&&(44===(i=e.charCodeAt(a))||32===i);)a++;for(t=45===i?a++:a;a<s;)if(48<=(i=e.charCodeAt(a))&&i<=57)a++;else{if(46!==i)return r=e.substring(t,a),n?parseFloat(r):parseInt(r);a++,n=!0}return r=e.substring(t),n?parseFloat(r):parseInt(r)}function T(){for(var t;a<s&&(44===(t=e.charCodeAt(a))||32===t);)a++;return 45===(t=e.charCodeAt(a))||48<=t&&t<=57}for(t=e[0];a<=s;){switch(n=!0,t){case"M":l=w(),c=w(),o.moveTo(l,c),t="L",p=l,d=c;break;case"m":l+=w(),c+=w(),o.moveTo(l,c),t="l",p=l,d=c;break;case"Z":case"z":n=!1,l===p&&c===d||o.lineTo(p,d);break;case"L":case"H":case"V":u="V"===t?l:w(),h="H"===t?c:w(),o.lineTo(u,h),l=u,c=h;break;case"l":case"h":case"v":u="v"===t?l:l+w(),h="h"===t?c:c+w(),o.lineTo(u,h),l=u,c=h;break;case"C":f=w(),g=w();case"S":"S"===t&&(f=2*l-m,g=2*c-v),m=w(),v=w(),u=w(),h=w(),o.bezierCurveTo(f,g,m,v,u,h),l=u,c=h;break;case"c":f=l+w(),g=c+w();case"s":"s"===t&&(f=2*l-m,g=2*c-v),m=l+w(),v=c+w(),u=l+w(),h=c+w(),o.bezierCurveTo(f,g,m,v,u,h),l=u,c=h;break;case"Q":f=w(),g=w();case"T":"T"===t&&(f=2*l-f,g=2*c-g),u=w(),h=w(),o.quadraticCurveTo(f,g,u,h),l=u,c=h;break;case"q":f=l+w(),g=c+w();case"t":"t"===t&&(f=2*l-f,g=2*c-g),u=l+w(),h=c+w(),o.quadraticCurveTo(f,g,u,h),l=u,c=h;break;case"A":y=w(),b=w(),_=w()*fi,x=w(),E=w(),u=w(),h=w(),y!==b&&console.warn("Forcing elliptical arc to be a circular one:",y,b),f=Math.cos(_)*(l-u)/2+Math.sin(_)*(c-h)/2,g=-Math.sin(_)*(l-u)/2+Math.cos(_)*(c-h)/2;var S=Math.sqrt((y*y*b*b-y*y*g*g-b*b*f*f)/(y*y*g*g+b*b*f*f));x===E&&(S=-S),m=S*y*g/b,v=S*-b*f/y,i=Math.cos(_)*m-Math.sin(_)*v+(l+u)/2,r=Math.sin(_)*m+Math.cos(_)*v+(c+h)/2;var M=new THREE.Vector2(1,0),R=new THREE.Vector2((f-m)/y,(g-v)/b),P=Math.acos(M.dot(R)/M.length()/R.length());M.x*R.y-M.y*R.x<0&&(P=-P),M.x=(-f-m)/y,M.y=(-g-v)/b;var A=Math.acos(R.dot(M)/R.length()/M.length());R.x*M.y-R.y*M.x<0&&(A=-A),!E&&0<A&&(A-=2*Math.PI),E&&A<0&&(A+=2*Math.PI),o.absarc(i,r,y,P,P+A,E),l=u,c=h;break;default:throw new Error("Wrong path command: "+t)}n&&T()||(t=e[a++])}return o};var tr=function(e){function t(i){return r(this,t),a(this,e.call(this,i))}return o(t,e),t.prototype.createMaterial=function(e){return e&&e.disableLight?new THREE.MeshBasicMaterial({color:2200782}):new THREE.MeshPhongMaterial({color:2200782})},t.prototype.createGeometry=function(e){return null},t.prototype.createMesh=function(e){var t=this.createGeometry(e);if(t){var i=this.createMaterial(e.style);return new THREE.Mesh(t,i)}return null},t.prototype.setupStyle=function(e){for(var t in e=e||{})this.style[t]=e[t];this.style.skipEnvMap=!0},t.prototype.setup=function(t){var i=this.createMesh(t);if(i){i.castShadow=!0,i.receiveShadow=!0;var r=t.center;if(r&&"Bottom"==r){var n=t.height||1;i.translateY(.5*n)}this.node.add(i)}e.prototype.setup.call(this,t),this.setupStyle(t.style)},t.prototype.addPickableGround=function(e){var t=this.app.create({type:"Plane",width:e,height:e,visible:!1,parent:this,style:{doubleSide:!0}}),i=t.node;return i.skipBoundingBox(!0),i.userData.topNode=!0,i.userData.skipOutline=!0,i.userData.independent=!0,i.userData.alwaysPickable=!0,i.canNotQueryFromSelector=!0,this.app.objectManager.addInteractableNode(i),t},t.prototype.pickGroundWorldPosition=function(e,t,i){if(Te.isArray(t)&&void 0===i){var r=t;t=r[0],i=r[1]}var n=this.app.camera.getRaycaster(t,i).intersectObjectForcible(e.node,!0);return n.length?n[0].point.toArray():null},t}(oi),ir=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));return n._width=0,n._height=0,n._depth=0,n._center="",n}return o(t,e),t.prototype.createGeometry=function(e){this._width=e.width||1,this._height=e.height||1,this._depth=e.depth||1,this._center=e.center;var t=e.widthSegments||1,i=e.heightSegments||1,r=e.depthSegments||1;return new THREE.BoxGeometry(this._width,this._height,this._depth,t,i,r)},n(t,[{key:"isBox",get:function(){return console.warn("[Box] Please use 'instanceof THING.Box' to replace '.isBox'"),this instanceof THING.Box}}]),t}(tr),rr=function(e){function t(i){return r(this,t),a(this,e.call(this,i))}return o(t,e),t.prototype.createGeometry=function(e){var t=e.radius,i=e.segments,r=e.thetaStart,n=e.thetaLength;return new THREE.CircleGeometry(t,i,r,n)},t}(tr),nr=function(e){function t(i){return r(this,t),a(this,e.call(this,i))}return o(t,e),t.prototype.createGeometry=function(e){var t=e.radius||1,i=e.widthSegments||8,r=e.heightSegments||6,n=e.phiStart||0,o=e.phiLength||2*Math.PI,a=e.thetaStart||0,s=e.thetaLength||Math.PI;return new THREE.SphereGeometry(t,i,r,n,o,a,s)},n(t,[{key:"isSphere",get:function(){return console.warn("[Sphere] Please use 'instanceof THING.Sphere' to replace '.isSphere'"),this instanceof THING.Sphere}}]),t}(tr),or=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));return n._ground=null,n._groundSize=0,n}return o(t,e),t.prototype.destroy=function(){this._ground&&this.app.objectManager.removeInteractableNode(this._ground.node),e.prototype.destroy.call(this)},t.prototype.createGeometry=function(e){var t=e.width||1,i=e.height||1,r=e.widthSegments||1,n=e.heightSegments||1;return new THREE.PlaneGeometry(t,i,r,n)},t.prototype.addPickableGround=function(t){this._groundSize=t.size,this._groundSize&&(this._ground=e.prototype.addPickableGround.call(this,this._groundSize))},t.prototype.pickGroundWorldPosition=function(t,i){return this._ground?e.prototype.pickGroundWorldPosition.call(this,this._ground,t,i):null},n(t,[{key:"isPlane",get:function(){return console.warn("[Plane] Please use 'instanceof THING.Plane' to replace '.isPlane'"),this instanceof THING.Plane}}]),t}(tr),ar=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));return n._color1=null,n._color2=null,n._size=0,n._divisions=0,n}return o(t,e),t.prototype.createMesh=function(e){this._color1=Te.parseColor(e.color1,16777215),this._color2=Te.parseColor(e.color2,16777215),this._size=e.size||10,this._divisions=e.divisions||10;var t=new THREE.GridHelper(this._size,this._divisions,this._color1,this._color2);return t.userData.skipStyle=!0,t},n(t,[{key:"size",get:function(){return this._size}}]),t}(tr),sr=function(e){function t(i){return r(this,t),a(this,e.call(this,i))}return o(t,e),t.prototype.createGeometry=function(e){var t=e.height||1,i=e.radius||.5,r=e.radiusTop?e.radiusTop:i,n=e.radiusBottom?e.radiusBottom:i,o=e.radiusSegments||8,a=e.heightSegments||1,s=e.heightSegments||!1,l=e.heightSegments||0,c=e.heightSegments||2*Math.PI;return new THREE.CylinderGeometry(r,n,t,o,a,s,l,c)},n(t,[{key:"isCylinder",get:function(){return console.warn("[Cylinder] Please use 'instanceof THING.Cylinder' to replace '.isCylinder'"),this instanceof THING.Cylinder}}]),t}(tr),lr=function(e){function t(i){return r(this,t),a(this,e.call(this,i))}return o(t,e),t.prototype.createGeometry=function(e){var t=e.radius||1,i=e.detail||0;return new THREE.TetrahedronGeometry(t,i)},n(t,[{key:"isTetrahedron",get:function(){return console.warn("[Tetrahedron] Please use 'instanceof THING.Tetrahedron' to replace '.isTetrahedron'"),this instanceof THING.Tetrahedron}}]),t}(tr),cr=function(e){function t(i){return r(this,t),a(this,e.call(this,i))}return o(t,e),t.prototype.createMaterial=function(e){return new THREE.MeshBasicMaterial({color:"#0aa5ff",opacity:.5,transparent:!0,side:THREE.DoubleSide})},t.prototype.createGeometry=function(e){var t=e.fov||45,i=e.aspect||2,r=e.length||10,n=r*Math.tan(.5*t*.017453293),o=i*n,a=new THREE.Geometry;return a.vertices=[new THREE.Vector3(0,0,0),new THREE.Vector3(o,-n,-r),new THREE.Vector3(o,n,-r),new THREE.Vector3(-o,n,-r),new THREE.Vector3(-o,-n,-r)],a.faces=[new THREE.Face3(0,1,2),new THREE.Face3(0,2,3),new THREE.Face3(0,3,4),new THREE.Face3(0,4,1),new THREE.Face3(3,4,1),new THREE.Face3(3,1,2)],a},t}(tr),ur=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));return n._vertices=null,n._height=0,n}return o(t,e),t.prototype.addGeoObject=function(e,t){for(var i={generateTopUV:function(e,t,i,r,n){var o=t[3*i],a=t[3*i+1],s=t[3*r],l=t[3*r+1],c=t[3*n],u=t[3*n+1];return[new THREE.Vector2(o,a),new THREE.Vector2(s,l),new THREE.Vector2(c,u)]},generateSideWallUV:function(e,t,i,r,n,o){return[new THREE.Vector2(0,0),new THREE.Vector2(0,1),new THREE.Vector2(1,1),new THREE.Vector2(1,0)]}},r=er.transformSVGPath(t.path),n=[new THREE.MeshPhongMaterial({transparent:!0}),new THREE.MeshPhongMaterial({transparent:!0})],o=r.toShapes(!0),a=0;a<o.length;a++){var s=o[a],l=new THREE.ExtrudeBufferGeometry(s,{depth:t.height,bevelEnabled:!1,UVGenerator:i}),c=new THREE.Matrix4;c.makeRotationFromEuler(Te.parseEuler([90,0,0]));var u=new THREE.Matrix4;u.makeTranslation(t.center[0],t.height,t.center[1]),u.multiply(c);for(var h=l.attributes.position.array,p=0;p<h.length;p+=3){var d=new THREE.Vector3(h[p],h[p+1],h[p+2]);d.applyMatrix4(u),h[p]=d.x,h[p+1]=d.y,h[p+2]=d.z}l.computeVertexNormals();var f=new THREE.Mesh(l,n);e.add(f)}},t.prototype.createMesh=function(t){var i=t.csg;if(i&&i.isCSG){var r=i.bsp.toMesh(),n=(new THREE.Matrix4).getInverse(i._object.node.matrixWorld);return r._premultiplyMatrix(n),r}return e.prototype.createMesh.call(this,t)},t.prototype.setup=function(t){var i=t.vertices||t.points,r=t.center||[0,0],n=t.height;if(i&&i.length){for(var o={center:r,height:n,path:""},a=function(e){return j.isFloatEquals(e,0)?0:e},s=0;s<i.length;s++){var l=Te.parseVector3(i[s]);o.path?o.path+="L":o.path+="M",o.path+=a(l.x).toString(),o.path+=",",o.path+=a(l.z).toString(),o.path+=" "}o.path+=" Z",this._vertices=i,this._height=n,this.addGeoObject(this.node,o)}e.prototype.setup.call(this,t)},t}(tr),hr=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));return n.elevator=null,n}return o(t,e),t.prototype.setup=function(t){e.prototype.setup.call(this,t),this.levelNum=this.parent.levelNum},n(t,[{key:"owner",get:function(){return this.elevator}}]),t}(Si),pr=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));return n.doors=[],n}return o(t,e),t.prototype.setup=function(t){if(e.prototype.setup.call(this,t),t.doors){this.doors=t.doors;for(var i=0;i<this.doors.length;i++)this.doors[i].elevator=this}},t.prototype.getDoor=function(e){for(var t=0;t<this.doors.length;t++){var i=this.doors[t];if(i.floor==e)return i}return i},t}(Ye),dr=function(e){function t(i){return r(this,t),a(this,e.call(this,i))}return o(t,e),t.prototype.customSetup=function(e){var t=e.width,i=e.height;if(t&&i){var r=new THREE.PlaneBufferGeometry(t,i),n=new THREE.MeshLambertMaterial({polygonOffset:!0,polygonOffsetFactor:10,polygonOffsetUnits:10}),o=new THREE.Mesh(r,n);o.rotation.x=-.5*Math.PI,o.position.x=0,o.position.y=-.1,o.position.z=0,o.receiveShadow=!0;var a=Te.parseValue(e.skipBoundingBox,!0);o.skipBoundingBox(a);var s=e.repeatUV||[100,100],l=e.image;if(l){var c=this.app.confirmURL(l,"https://static.3dmomoda.com/textures");o.material.map=(new THREE.TextureLoader).load(c),o.material.map.repeat.fromArray(s),o.material.map.wrapT=o.material.map.wrapS=THREE.RepeatWrapping}this.node.add(o)}},n(t,[{key:"isGround",get:function(){return!0}}]),t}(Ye),fr=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));return n._aspect=2,n._fov=45,n._near=.1,n._far=10,n._camera=null,n._lineMesh=null,n._frustumMesh=null,n._frustum=new THREE.Frustum,n._projScreenMatrix=new THREE.Matrix4,n}return o(t,e),t.prototype._updateFrustum=function(){this._projScreenMatrix.multiplyMatrices(this._camera.projectionMatrix,this._camera.matrixWorldInverse),this._frustum.setFromMatrix(this._projScreenMatrix)},t.prototype._buildLineMesh=function(e,t){var i=new THREE.EdgesGeometry(e.geometry),r=new THREE.LineSegments(i);return r.material.color=Te.parseColor(t),r},t.prototype._buildFrustumMesh=function(){var e=this.far*Math.tan(.5*this.fov*.017453293),t=this.aspect*e,i=new THREE.Geometry;i.vertices=[new THREE.Vector3(0,0,0),new THREE.Vector3(t,-e,-this.far),new THREE.Vector3(t,e,-this.far),new THREE.Vector3(-t,e,-this.far),new THREE.Vector3(-t,-e,-this.far)],i.faces=[new THREE.Face3(0,1,2),new THREE.Face3(0,2,3),new THREE.Face3(0,3,4),new THREE.Face3(0,4,1),new THREE.Face3(3,4,1),new THREE.Face3(3,1,2)];var r=new THREE.MeshBasicMaterial({color:"#0aa5ff",opacity:.5,transparent:!0,side:THREE.DoubleSide});return new THREE.Mesh(i,r)},t.prototype._build=function(){var e=this.app.resourceManager;e.remove(this._frustumMesh),e.remove(this._lineMesh),this._frustumMesh=this._buildFrustumMesh(),this.node.add(this._frustumMesh);var t=this.style._lineColor||16777215;this._lineMesh=this._buildLineMesh(this._frustumMesh,t),this.node.add(this._lineMesh),this._camera=new THREE.PerspectiveCamera(this.fov,this.aspect,this.near,this.far),this._camera.position.set(this.position[0],this.position[1],this.position[2]),this._camera.rotation.copy(this.node.rotation),this._camera.updateMatrixWorld(!0),this._updateFrustum()},t.prototype.customSetup=function(e){this._aspect=e.aspect||this._aspect,this._fov=e.fov||this._fov,this._near=e.near||this._near,this._far=e.far||this._far,this._build()},t.prototype.setWorldPosition=function(t){e.prototype.setWorldPosition.call(this,t),this._camera.position.set(t[0],t[1],t[2]),this._camera.updateMatrixWorld(!0),this._updateFrustum()},t.prototype.intersectsObject=function(e){return this._updateFrustum(),!!this._frustum._intersectsObject(e.node)},n(t,[{key:"aspect",set:function(e){this._aspect=e,this._build()},get:function(){return this._aspect}},{key:"fov",set:function(e){this._fov=e,this._build()},get:function(){return this._fov}},{key:"far",set:function(e){this._far=e,this._build()},get:function(){return this._far}}]),t}(Ye),mr=function(){function e(t){r(this,e),this.app=t,this._style=null,this._id="",this._name="",this._queryID=j.generateUUID(),this._userData={},this._angles=[0,0,0],this._events={},this._tags=[],this._groups=[],this._children=new qe(this.app)}return e.prototype.isGroup=function(){return!0},e.prototype.setup=function(e){this._id=e.id||"",this._name=e.name||"",this._tags=e.tags||[]},e.prototype.destroy=function(){this.app.objectManager.destroy(this);var e=this;this._children.forEach(function(t){var i=t.groups.indexOf(e);for(var r in-1!==i&&t.groups.splice(i,1),e._events){var n=e._events[r];for(var o in n)t.off(o)}})},e.prototype.destroyAll=function(){this.destroy(),this._children.destroyAll()},e.prototype.hasAttribute=function(e){return Te.hasAttribute(this,e)},e.prototype.getAttribute=function(e){return Te.getAttribute(this,e)},e.prototype.setAttribute=function(e,t){return Te.setAttribute(this,e,t)},e.prototype.setAttributes=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];for(var i in e=e||{})(t||Te.isUndefined(this[i]))&&this.setAttribute(i,e[i])},e.prototype.add=function(e){var t=this;if(e instanceof qe)e.forEach(function(e){t.add(e)});else for(var i in this._children.add(e),-1===e.groups.indexOf(this)&&e.groups.push(this),this._children.forEach(function(e){e.groups.sort(function(e,t){return t.children.length-e.children.length})}),this._events){var r=this._events[i];for(var n in r){var o=r[n];this.on(i,o.selector,o.userData,o.callback,null,o.priority)}}},e.prototype.remove=function(e){var t=this;if(e instanceof qe)e.forEach(function(e){t.remove(e)});else{this._children.remove(e);var i=e.groups.indexOf(this);for(var r in-1!==i&&e.groups.splice(i,1),this._events){var n=this._events[r];for(var o in n){var a=n[o];this.off(r,a.selector,a.tag)}}}},e.prototype._transform=function(e){var t=new THREE.Group;t.position.copy(Te.parseVector3(this.position)),this.app.scene.add(t),t.updateMatrixWorld();for(var i=[],r=0;r<this._children.length;r++){var n=this._children[r];i.push(n.node.parent),n.node.attach(t,this.app.scene)}for(e(t),t.updateWorldMatrix(!1,!1),r=0;r<this._children.length;r++)(n=this._children[r]).node.attach(i[r],this.app.scene),n.static&&n.node._synMatrixWorld();this.app.scene.remove(t)},e.prototype.translate=function(e){this._transform(function(t){t.translateX(e[0]),t.translateY(e[1]),t.translateZ(e[2])})},e.prototype.translateX=function(e){this.translate([e,0,0])},e.prototype.translateY=function(e){this.translate([0,e,0])},e.prototype.translateZ=function(e){this.translate([0,0,e])},e.prototype.query=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],i=new qe(this.app,this._children);return i.select(e),t&&this._children.forEach(function(t){i.add(t.query(e))}),i},e.prototype._parseEvent=function(e,t,i,r,n){var o=Te.parseEvent(e,t,i,r,n);o._callback=o.callback;var a=this;return o.callback=function(e){o._callback&&o._callback.call(a,e)},o.tag=o.tag||"",o.tag+="_"+this._queryID,o},e.prototype._updateEvents=function(e){this._events[e.eventType]=this._events[e.eventType]||[],this._events[e.eventType][e.tag]=e},e.prototype._removeEvents=function(e){var t=this._events[e.eventType];t&&delete t[e.tag]},e.prototype.on=function(e,t,i,r,n,o){var a=this._parseEvent(t,i,r,n,o);return a.eventType=e,this._updateEvents(a),this.children.on(e,a.selector,a.userData,a.callback,a.tag,a.priority),this},e.prototype.off=function(e,t,i){var r=this._parseEvent(t,null,i);return r.eventType=e,this._removeEvents(r),this.children.off(e,r.selector,r.tag),this},e.prototype.one=function(e,t,i,r,n,o){var a=this._parseEvent(t,i,r,n,o);return a.eventType=e,this._updateEvents(a),this.children.one(e,a.selector,a.userData,a.callback,a.tag,a.priority),this},e.prototype._getAvgVector3=function(e){if(!this._children.length)return[0,0,0];var t=new THREE.Vector3;return this._children.forEach(function(i){var r=Te.parseVector3(i[e]);t.add(r)}),t.divideScalar(this._children.length),t.toArray()},n(e,[{key:"type",get:function(){return"Group"}},{key:"style",get:function(){return this._children.style}},{key:"id",set:function(e){this._id=e},get:function(){return this._id}},{key:"name",set:function(e){this._name=e},get:function(){return this._name}},{key:"queryID",set:function(e){this._queryID=e},get:function(){return this._queryID}},{key:"userData",set:function(e){this._userData=e},get:function(){return this._userData}},{key:"tags",set:function(e){this._tags=e},get:function(){return this._tags}},{key:"groups",get:function(){return this._groups}},{key:"position",set:function(e){var t=Te.parseVector3(e),i=this;this._transform(function(e){e._setWorldPosition(t,!1,i.app.root.static)})},get:function(){return this._getAvgVector3("position")}},{key:"angles",set:function(e){var t=j.subVector(this._angles,e);this._angles=e;var i=Te.parseEuler(t);this._transform(function(e){e.quaternion.setFromEuler(i)})},get:function(){return this._angles}},{key:"parents",get:function(){var e=new THING.Selector(this.app,[]);return this._children.forEach(function(t){e.add(t.parents)}),e}},{key:"children",get:function(){return this._children}},{key:"visible",set:function(e){this.children.visible=e}},{key:"pickable",set:function(e){this.children.pickable=e}},{key:"boundingBox",get:function(){for(var e=new THREE.Box3,t=0;t<this.children.length;t++){var i=this.children[t];e.union(i.box)}var r=new THREE.Vector3;e.getCenter(r);var n=new THREE.Vector3;e.getSize(n);var o=this;return{min:e.min.toArray(),max:e.max.toArray(),center:r.toArray(),size:n.toArray(),radius:n.length(),getWorldPosition:function(e){var t=Te.parseValue(e.yAngle,0),i=Te.parseValue(e.xAngle,0),r=Te.parseValue(e.distance||e.radius,n.length()),a=e.radiusFactor;a&&(r=n.length()*a);var s=(new THREE.Vector3).getDirectionFromAngles(t,i,r);return o.selfToWorld(s)}}}}]),e}(),gr=document.createElement("canvas");gr.width=256,gr.height=1;var vr=gr.getContext("2d");function yr(e,t){var i=vr.createLinearGradient(0,0,256,0);for(var r in e)i.addColorStop(+r,e[r]);vr.fillStyle=i,vr.fillRect(0,0,256,1);var n=new Uint8Array(vr.getImageData(0,0,256,1).data.buffer);return void 0!==t?t.image={data:n,width:256,height:1}:t=new THREE.DataTexture(n,256,1),t.magFilter=t.minFilter=THREE.LinearFilter,t.needsUpdate=!0,t}var br=new Map,_r=new Map,xr=new Map,Er=function(){function e(){r(this,e)}return e.register=function(e,t){br.set(e,t),_r.set(e,function(e){var t={};for(var i in e){var r=i.split("-"),n=r[0];t[n]||(t[n]={});var o=r[1];void 0===o||t[n][o]||(t[n][o]={});var a=r[2];void 0!==a&&(t[n][o][a]={})}return t}(t.class)),xr.set(e,function(e){var t=new Map;for(var i in e){var r=e[i].colormap;if(r){var n=void 0;t.has(i)&&(n=t.get(i)),t.set(i,yr(r,n))}}return t}(t.class))},e.findStyle=function(e,t,i){if(i&&i._sfStyle){var r=i._sfStyle;return{style:br.get(e).class[r],colormap:xr.get(e).get(r)}}if(!br.has(e)||!_r.has(e))return console.warn("StyleManager: style '"+e+"' not registed."),null;if(t&&i){var n=function(e,t,i){var r=t.type,n="";if(!e[r])for(var o in e)THING.Utils.instanceOf(t,o)&&(r=o);if(!e[r])return"";for(var a in e[r]){var s=t.tags;if("Facade"===r&&t.building&&(s=t.building.tags),-1<s.indexOf(a)&&""!==a){n=a;break}}if(!e[r][n])return r;for(var l in e[r][n])if(i.name===l)return r+"-"+n+"-"+i.name;return r+(""!==n?"-"+n:"")}(_r.get(e),t,i);return{style:br.get(e).class[n],colormap:xr.get(e).get(n)}}return br.get(e)},e}(),wr=function(){function e(t){r(this,e),this.obj=t,this._renderOrder=0,this._opacity=null,this._color=null,this._outlineColor=null,this._alwaysOnTop=!1,this._wireframe=!1,this._glow=!1,this._innerGlow=!1,this._image="",this._doubleSide=!1,this._uvAnimationParams=null,this._boundingBoxNode=null,this._orientedBoundingBoxNode=null,this._axisNode=null,this._vertexNormalNode=null,this._defaultOutlineColor=null,this._synStyle=null,this._themeName=null,this._edgeColor=null,this._edgeIncludeChildren=!0,this._edgeWireframes=new Map,this._emissive=null}return e.prototype._syn=function(){var e=this._synStyle;e&&(delete this._synStyle,e.execute())},e.prototype._setSynValue=function(e,t){return!this.obj.loaded&&(this._synStyle||(this._synStyle=this.obj.app.commandManager.create({type:"SetObjectStyle",object:this.obj})),this._synStyle.setAttribute(e,t),!0)},e.prototype._getSynValue=function(e){return this._synStyle?this.obj.loaded?null:this._synStyle.getAttribute(e):null},e.prototype._traverse=function(e){var t=this,i=1<arguments.length&&void 0!==arguments[1]&&arguments[1],r=2<arguments.length&&void 0!==arguments[2]&&arguments[2];i?this.obj.node.traverseBranch(function(i){if(t.obj._isChildNode(i))return!1;if(!i.userData.skipStyle&&(r||!i.userData.maySkipStyle)){var n=i.userData.__independent_style_object__;n&&n!==t.obj||e(i)}}):this.obj.node.traverse(function(i){if(!i.userData.skipStyle){var r=i.userData.__independent_style_object__;r&&r!==t.obj||e(i)}})},e.prototype._onEnter=function(){},e.prototype._onLeave=function(){},e.prototype._changeMaterial=function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],i=2<arguments.length&&void 0!==arguments[2]&&arguments[2];this._traverse(function(t){if(t.material){var i=t.material;Te.isArray(i)?t.material=i.map(function(i){return e(i,t)}):t.material=e(i,t)}},t,i),this.obj.app.needUpdate=!0},e.prototype._cloneAndModifyMaterial=function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],i=2<arguments.length&&void 0!==arguments[2]&&arguments[2],r=!(3<arguments.length&&void 0!==arguments[3])||arguments[3];this._changeMaterial(function(t,i){if(!(n=t)._mustClone&&(!r||n._isCloned()&&n._getOriginal()))return e&&e(t._getPrevMaterial(),t,i),t;var n,o=t._pushAndCloneSelf();return e&&e(o._getPrevMaterial(),o,i),o},t,i)},e.prototype.revertMaterial=function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];this._changeMaterial(function(e){var i=t?e._getOriginal():e._getPrevMaterial();return i?(e.dispose(),i):(Te.revertValue(e,"opacity"),Te.revertValue(e,"color"),Te.revertValue(e,"depthTest"),Te.revertValue(e,"depthWrite"),Te.revertValue(e,"onBeforeRender"),Te.revertValue(e,"wireframe"),Te.revertValue(e,"wireframeMap","map"),e)},e),this._traverse(function(e){e.renderOrder<THING.BaseStyle.cAlwaysOnTopRenderOrderStart&&Te.revertValue(e,"renderOrder")},e)},e.prototype._applyTheme=function(e){var t=this;if(this._themeName=e||null,"Facade"==this.obj.type&&this.obj.building){if(this.obj.building.userData.SKIP_THEME)return}else if(this.obj.userData.SKIP_THEME)return;if(this.removeEdgeWireframe(!1),!e)return this.revertMaterial(!0,!0),void(this.glow=!1);var i=this.obj.app;this._cloneAndModifyMaterial(function(r,n,o){var a=Er.findStyle(e,t.obj,o);if(a){var s=a.style,l=a.colormap;if(s){var c=void 0!==s.opacity?s.opacity:1;n.colorMapping=l,n.opacity=c,n.transparent=r.transparent||c<1,n._mustClone=!0;var u,h=s.reflection;h&&h.enable&&(n.envMap=(u=i.baseURL,(Tr=(new THREE.CubeTextureLoader).load([u+"/images/reflect1.jpg",u+"/images/reflect1.jpg",u+"/images/reflect1.jpg",u+"/images/reflect1.jpg",u+"/images/reflect1.jpg",u+"/images/reflect1.jpg"])).format=THREE.RGBFormat,Tr.mapping=THREE.CubeReflectionMapping,Tr),n.envMapIntensity=1.5,n.metalness=h.metalness,n.roughness=h.roughness)}}},!0),this._traverse(function(r){if(r.geometry){var n=Er.findStyle(e,t.obj,r);if(n){var o=n.style;if(o){r.technique=r.technique||{},!!o.glow!=!!r.technique.glow&&(o.glow?(r.technique.glow=!0,i.sceneManager._updatEffectRefCounts("glow",1)):(delete r.technique.glow,i.sceneManager._updatEffectRefCounts("glow",-1)));var a=o.wireframe.enable,s=o.wireframe.color,l=o.wireframe.glow,c=o.wireframe.opacity||.99;a&&t._setEdgeWireframe(r,l,s,c)}}}},!0),this.obj.app.root.static&&this.obj.app.scene._synMatrixWorld()},e.prototype.isNeedRevertMaterials=function(){return!this.isNeedCloneMaterials()},e.prototype.isNeedCloneMaterials=function(){return!(Te.isNull(this._opacity)&&Te.isNull(this._color)&&!this._alwaysOnTop&&!this._wireframe&&!this._image)},e.prototype.setOpacity=function(e){var t=this,i=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];Te.isNumber(e)&&(e=j.clamp(e,0,1)),this._opacity=e,this.isNeedRevertMaterials()?this.revertMaterial():this._cloneAndModifyMaterial(function(e,i,r){var n=Te.isNull(t._opacity)?1:t._opacity;i.opacity=n*e.opacity,e.alphaTest&&(i.alphaTest=n*e.alphaTest),i.transparent=e.transparent||i.opacity<1},!1,!0,i)},e.prototype.setColor=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];if(e){if(!(e=Te.parseColor(e)))return;this._color=e,this._cloneAndModifyMaterial(function(t,i,r){Te.backupValue(i,"color"),Te.backupValue(i,"colorMapping"),i.color=e,i.colorMapping=null,i.needsUpdate=!0},!1,!1,t)}else{if(!this.color)return;this._color=null,this.isNeedRevertMaterials()?this.revertMaterial():this._changeMaterial(function(e,t){return Te.revertValue(e,"color"),Te.revertValue(e,"colorMapping"),e.needsUpdate=!0,e})}},e.prototype.setOutlineColor=function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];Te.isNull(e)?(this._outlineColor&&(this._setEffectRefCounts("outline_0x"+this._outlineColor.getHexString(),!1),this.obj.node.traverse(function(e){e.layers.disable(1),delete e.userData.forceOutline}),this._outlineColor=null),this._defaultOutlineColor&&this._setEffectRefCounts("outline_0x"+this._defaultOutlineColor.getHexString(),!0)):(this._outlineColor&&this._setEffectRefCounts("outline_0x"+this._outlineColor.getHexString(),!1),e=Te.parseColor(e),this._outlineColor=e,this._setEffectRefCounts("outline_0x"+e.getHexString(),!0),t&&(this.obj.node.ensureParentsVisible(!0),this.obj.node.visible=!0),this.obj.node.traverse(function(e){(t||e.ensureVisible())&&(e.isSprite||(e.layers.enable(1),t&&(e.visible=!0,e.userData.forceOutline=!0)))})),this.obj.app.needEffectUpdate=!0},e.prototype.setDefaultOutlineColor=function(e){var t=Te.parseColor(e);t?(this._defaultOutlineColor=t,this.outlineColor||this._setEffectRefCounts("outline_0x"+t.getHexString(),!0),this.obj.app.needEffectUpdate=!0):(this._defaultOutlineColor=null,this._outlineColor||this._defaultOutlineColor||this._clearAllOutlineColor())},e.prototype.setSkipBoundingBox=function(e){this.obj.node.skipBoundingBox(e),this.obj.parents.forEach(function(e){e.boundingBoxControl.dirty=!0})},e.prototype._setNodesAttribute=function(e,t){var i=2<arguments.length&&void 0!==arguments[2]&&arguments[2];this._traverse(function(r){!r.isRenderableObject()&&i||(r.userData[e]=t)})},e.prototype._setAlwaysOnTop=function(e,t){if(this.alwaysOnTop!=e&&this.obj.node.parent)if(this._alwaysOnTop=e){this._cloneAndModifyMaterial(function(e,t,i){t.transparent=!0},!1,!1,t),Te.backupValue(this.obj.node,"parent");var i=new THREE.MeshStandardMaterial({transparent:!0,opacity:1e-4}),r=new THREE.Mesh(new THREE.Geometry,i);r.name="AlwaysOnTopRootMesh",r.userData=Te.mergeObject({keepOutline:!0},this.obj.node.userData),r.frustumCulled=!1,r.renderOrder=THING.BaseStyle.cAlwaysOnTopRenderOrderID,r.onAfterRender=function(e){e.clearDepth()},this.obj.node.parent.add(r),this.obj.node.attach(r,this.obj.app.scene,!0),this._traverse(function(e){Te.backupValue(e,"renderOrder"),e.renderOrder=r.renderOrder+1})}else{this.isNeedRevertMaterials()?this.revertMaterial():this._changeMaterial(function(e,t){return Te.revertValue(e,"transparent"),e});var n=Te.getValue(this.obj.node,"parent",!0);this.obj.node.parent.removeBySelf(),n.add(this.obj.node),this._traverse(function(e){return Te.revertValue(e,"renderOrder")})}},e.prototype.setAlwaysOnTop=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];this._setAlwaysOnTop(e,t)},e.prototype.setBoundingBox=function(e,t){if(e){if(!this._boundingBoxNode){var i=this.obj.getLocalBoundingBox().toBox();this._boundingBoxNode=new THREE.Box3Helper(i,16777215),this._boundingBoxNode.frustumCulled=!1,this._boundingBoxNode.name=this.obj.name+"_BoundingBox",this._boundingBoxNode.skipBoundingBox(!0)}this._boundingBoxNode.material.color=Te.parseColor(t),this.obj.node.add(this._boundingBoxNode),this.obj.tickable=!0}this._boundingBoxNode&&(this._boundingBoxNode.visible=e)},e.prototype.setOrientedBoundingBox=function(e,t){if(e){if(!this._orientedBoundingBoxNode){var i=this.obj.getLocalBoundingBox().toBox();this._orientedBoundingBoxNode=new THREE.Box3Helper(i,16777215),this._orientedBoundingBoxNode.frustumCulled=!1,this._orientedBoundingBoxNode.name=this.obj.name+"_OrientedBoundingBox",this._orientedBoundingBoxNode.skipBoundingBox(!0)}var r=this._orientedBoundingBoxNode.material;r.color=Te.parseColor(t,r.color),this.obj.node.add(this._orientedBoundingBoxNode),this.obj.tickable=!0}this._orientedBoundingBoxNode&&(this._orientedBoundingBoxNode.visible=e)},e.prototype.setVertexNormalHelper=function(e){if(e){this.obj.node.updateMatrixWorld();var t=new THREE.Matrix4;t.getInverse(this.obj.node.matrixWorld),this._vertexNormalNode=new THREE.Group,this._vertexNormalNode.name=this.obj.name+"_VertexNormal",this._vertexNormalNode.applyMatrix(t);var i=this;this.obj.node.traverse(function(e){if(e.isMesh&&e.geometry){var t=new THREE.VertexNormalsHelper(e,1,16711680);i._vertexNormalNode.add(t)}}),this.obj.node.add(this._vertexNormalNode)}else this.obj.app.resourceManager.remove(this._vertexNormalNode),this._vertexNormalNode=null},e.prototype.setAxisHelper=function(e){if(e){this._axisNode=new THREE.AxesHelper(this.obj.boundingBox.radius),this._axisNode.name=this.obj.name+"_Axis";var t=this._axisNode.material;t.depthTest=!1,t.transparent=!0;var i=new THREE.Vector3;this.obj.node.getWorldScale(i),this._axisNode.scale.set(1/i.x,1/i.y,1/i.z),this.obj.node.add(this._axisNode)}else this.obj.app.resourceManager.remove(this._axisNode),this._axisNode=null},e.prototype._setEffectRefCounts=function(e,t){var i=this.obj.app.sceneManager;t?this._traverse(function(t){t.userData&&t.userData.skipOutline&&-1<e.indexOf("outline")||(t.technique=t.technique||{},!0!==t.technique[e]&&(t.technique[e]=!0,i._updatEffectRefCounts(e,1)))}):this._traverse(function(t){t.technique&&t.technique[e]&&(delete t.technique[e],i._updatEffectRefCounts(e,-1))}),this.obj.app.needEffectUpdate=!0},e.prototype._clearAllOutlineColor=function(){var e=this.obj.app.sceneManager;this._traverse(function(t){if(t.technique)for(var i in t.technique)t.technique[i]&&-1<i.indexOf("outline")&&(delete t.technique[i],e._updatEffectRefCounts(i,-1))})},e.prototype.setGlow=function(e){this._glow=e,this._setEffectRefCounts("glow",e)},e.prototype.setInnerGlow=function(e){this._innerGlow=e,this._setEffectRefCounts("innerGlow",e)},e.prototype.setEdgeWireframe=function(e){var t=this,i=1<arguments.length&&void 0!==arguments[1]&&arguments[1],r=2<arguments.length&&void 0!==arguments[2]&&arguments[2];this._edgeColor=Te.parseColor(e),null!=e?(this._edgeIncludeChildren!==!r&&(this.removeEdgeWireframe(!0),this._edgeIncludeChildren=!r),this._traverse(function(e){t._setEdgeWireframe(e,i,t._edgeColor)},r)):this.removeEdgeWireframe(!0)},e.prototype._setEdgeWireframe=function(e,t,i){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1;if(e.geometry&&"EdgesGeometry"!=e.geometry.type){var n=this.obj.app,o=void 0;if(this._edgeWireframes.has(e))o=this._edgeWireframes.get(e);else{var a=new THREE.EdgesGeometry(e.geometry,.1);(o=new THREE.LineSegments(a)).name="wireframeNode"+i+t,o.userData.maySkipStyle=!0,this._edgeWireframes.set(e,o)}o.ensureVisible(this.obj.visible),!o.parent!==e&&e.add(o),o.material.color.set(i),o.material.opacity=r,o.material.transparent=r<1,o.renderOrder=1,o.technique=o.technique||{},!!o.technique.glow!=t&&(o.technique.glow=t,n.sceneManager._updatEffectRefCounts("glow",t?1:-1))}},e.prototype.removeEdgeWireframe=function(e){var t=this;if(e){var i=this.obj.app;this._edgeWireframes.forEach(function(e,r){e.technique&&e.technique.glow&&(delete e.technique.glow,t.app.sceneManager._updatEffectRefCounts("glow",-1)),i.resourceManager.remove(r)}),this._edgeWireframes.clear()}else this._edgeWireframes.forEach(function(e,t){e.parent===t&&t.remove(e)})},e.prototype.setImage=function(e){if(this.image!=e)if(e){var t=void 0;if(Te.isString(e)){var i=this.obj.app.confirmURL(e);if(this.image==i)return;this._image=i;var r=new THREE.TextureLoader;r.setCrossOrigin("anonymous"),t=r.load(i)}else e.width&&e.height&&(t=this.obj.app.resourceManager.loadTexture(e));if(!t)return;this._cloneAndModifyMaterial(function(e,i,r){Te.backupValue(i,"map"),i.map=t})}else this._image="",this.isNeedRevertMaterials()?this.revertMaterial():this._changeMaterial(function(e,t){return Te.revertValue(e,"map"),e})},e.prototype.flipOutlineColor=function(e){e=Te.parseColor(e).getHex();var t=this.outlineColor;this.outlineColor=t&&t==e?null:e},e.prototype.setLightMap=function(e){var t=(e=e||{}).intensity||0,i=Te.parseColor(e.color,new THREE.Color),r=e.image;r&&((r=(new THREE.TextureLoader).load(this.obj.app.confirmURL(r))).anisotropy=16),this._changeMaterial(function(e,n){e.lightMap=r,e.lightMapIntensity=t,e.color.copy(i),e.needsUpdate=!0})},e.prototype.setMaterial=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],i=this;if(e){var r=function(){0<e.completeWaitNumber&&--e.completeWaitNumber||(e.complete&&e.complete({object:i.obj}),i.obj.app.needUpdate=!0)},n=function(t,n,o){o=o||{};var a=Te.isString(o)?o:o.url;if(a){e.completeWaitNumber++;var s=(new THREE.TextureLoader).load(i.obj.app.confirmURL(a),function(){r()});if(s.anisotropy=16,c=Te.parseWrapType(o.wrap||o.wrapType))s.wrapT=c,s.wrapS=c;else{var l=t[n];l&&(s.wrapT=l.wrapT,s.wrapS=l.wrapS)}t[n]=s}else null===a&&(t[n]=null);var c,u=o.texture;u?(t[n]=u,(c=Te.parseWrapType(o.wrap||o.wrapType))&&(u.wrapT=c,u.wrapS=c)):null===u&&(t[n]=null)};e.completeWaitNumber=0;var o=e.index;this._cloneAndModifyMaterial(function(t,a,s){Te.isArray(s.material)&&s.material.indexOf(a)!==o||function(e,t){var o=Te.parseColor(t.color);o&&e.color.copy(o);var a=t.image;if(a){t.completeWaitNumber++;var s=new THREE.TextureLoader;s.setCrossOrigin("anonymous"),(a=s.load(i.obj.app.confirmURL(a),function(){r()})).anisotropy=16;var l=Te.parseWrapType(t.wrap||t.wrapType);if(l)a.wrapT=l,a.wrapS=l;else{var c=e.map;c&&(a.wrapT=c.wrapT,a.wrapS=c.wrapS)}e.map=a}else null===a&&(e.map=null);var u=t.map;u?e.map=u:null===u&&(e.map=null),n(e,"map",t.diffuseMap),n(e,"emissiveMap",t.emissiveMap),n(e,"roughnessMap",t.roughnessMap),n(e,"roughnessMap",t.roughnessMap),n(e,"roughnessMap",t.roughnessMap),n(e,"lightMap",t.lightMap),n(e,"bumpMap",t.bumpMap),n(e,"aoMap",t.aoMap),n(e,"alphaMap",t.alphaMap),n(e,"displacementMap",t.displacementMap);var h=t.envMap;if(h){var p=i.obj.app.confirmURL(Te.parseCubeTextureUrls(h));e.envMap=(new THREE.CubeTextureLoader).load(p,function(){i.obj.app.needUpdate=!0})}else null===h&&(e.envMap=null);e.envMapIntensity=Te.parseValue(t.envMapIntensity,e.envMapIntensity);var d=t.doubleSide;void 0!==d&&(e.side=d?THREE.DoubleSide:THREE.FrontSide),e.blending=Te.parseBlendingType(t.blending,e.blending),e.transparent=Te.parseValue(t.transparent,e.transparent),e.opacity=Te.parseValue(t.opacity,e.opacity);var f=Te.parseColor(t.emissive);e.emissive&&f&&e.emissive.copy(f),e.metalness=Te.parseValue(t.metalness,e.metalness),e.roughness=Te.parseValue(t.roughness,e.roughness),e.depthWrite=Te.parseValue(t.depthWrite,e.depthWrite),e.depthTest=Te.parseValue(t.depthTest,e.depthTest),e.needsUpdate=!0}(a,e)},!1,!1,t)}else this.revertMaterial()},e.prototype.setPolygonOffset=function(e){e=e||{};var t=Te.parseValue(e.polygonOffset,!1),i=Te.parseValue(e.polygonOffsetFactor,0),r=Te.parseValue(e.polygonOffsetUnits,0);this._changeMaterial(function(e,n){return e.polygonOffset=t,e.polygonOffsetFactor=i,e.polygonOffsetUnits=r,e})},e.prototype.setWireframe=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];(this._wireframe=e)?this._cloneAndModifyMaterial(function(e,t,i){Te.backupValue(t,"wireframe"),Te.backupValue(t,"wireframeMap","map"),t.wireframe=!0,t.map=null},!1,!1,t):this.isNeedRevertMaterials()?this.revertMaterial():this._changeMaterial(function(e,t){return Te.revertValue(e,"wireframe"),Te.revertValue(e,"wireframeMap","map"),e})},e.prototype.setRenderOrder=function(e){this._renderOrder=e,Te.isNull(e)?this.obj.node.traverse(function(e){e.renderOrder<THING.BaseStyle.cAlwaysOnTopRenderOrderStart&&Te.revertValue(e,"renderOrder")}):this.obj.node.traverse(function(t){Te.backupValue(t,"renderOrder"),t.renderOrder>=THING.BaseStyle.cAlwaysOnTopRenderOrderStart?t.renderOrder=THING.BaseStyle.cAlwaysOnTopRenderOrderID+e:t.renderOrder=e}),this.obj.app.needUpdate=!0},e.prototype._setTextureUVAnimation=function(e){var t=this;Te.setValue(e,"updateMatrix",function(){var i=t._uvAnimationParams,r=i.repeat||[1,1],n=i.center||[0,0],o=i.offset||[0,0],a=Te.parseValue(i.rotation,0);e.matrix.setUvTransform(o[0],o[1],r[0],r[1],a,n[0],n[1])},!0)},e.prototype.setUVAnimation=function(e){if(this._uvAnimationParams=e,this._uvAnimationParams){var t=this._uvAnimationParams;t.wrapType=Te.parseWrapType(t.wrapType),t.offset=t.offset||[0,0],t.baseOffset=t.offset.concat();var i=Te.parseValue(t.rotation,0);t.baseRotation=i,t.offsetSpeed=t.speed||t.offsetSpeed,Te.isNumber(t.offsetSpeed)&&(t.offsetSpeed=[t.offsetSpeed,t.offsetSpeed]);var r=t.rotationSpeed;r&&(t.rotationSpeed=r),(i||r)&&(t.center=[.5,.5]),t.animation=Te.parseValue(t.animation,!0);var n=this;this.obj.node.traverseTextures(function(e,i,r){r._isCloned||e._isCloned()||((r=r.clone())._isCloned=!0,r.needsUpdate=!0,e[i]=r,e.needsUpdate=!0),t.wrapType&&(Te.setValue(r,"wrapS",t.wrapType),Te.setValue(r,"wrapT",t.wrapType)),n._setTextureUVAnimation(r)}),this.obj.tickable=!0}else this.obj.node.traverseTextures(function(e,t,i){Te.revertValue(i,"wrapS"),Te.revertValue(i,"wrapT"),Te.revertValue(i,"updateMatrix")})},e.prototype.hasUVAnimation=function(){return!!this._uvAnimationParams},e.prototype.update=function(e){var t=this._uvAnimationParams;if(t){if(!t.animation)return!1;var i=t.baseOffset,r=t.offsetSpeed;i&&r&&(t.offset[0]+=i[0]+e*r[0],t.offset[1]+=i[1]+e*r[1]);var n=t.baseRotation,o=t.rotationSpeed;return o&&(t.rotation+=n+e*o),!0}return!1},e.prototype._getParentStyleValue=function(e){for(var t=this.obj.parents,i=0;i<t.length;i++){var r=t[i].style[e];if(!Te.isNull(r))return r}return null},e.prototype._getStyleValue=function(e){var t=this._getSynValue(e);if(t)return t;var i=this["_"+e];return Te.isNull(i)?this._getParentStyleValue(e):i},e.prototype._getStyleColorValue=function(e){var t=this._getStyleValue(e);return t?Te.parseColor(t).toHexString():null},e.prototype.isBaseStyle=function(){return!0},n(e,[{key:"renderOrder",set:function(e){this.setRenderOrder(e)},get:function(){return this._getStyleValue("renderOrder")}},{key:"wireframe",set:function(e){this.setWireframe(e)},get:function(){return this._getStyleValue("wireframe")}},{key:"opacity",set:function(e){this._setSynValue("opacity",e)||this.setOpacity(e)},get:function(){var e=this._getStyleValue("opacity");return Te.isNull(e)?1:e}},{key:"color",set:function(e){this._setSynValue("color",e)||this.setColor(e)},get:function(){return this._getStyleColorValue("color")}},{key:"emissive",set:function(e){e=e||"#000000",this._emissive=Te.parseColor(e),this.setMaterial({emissive:e})},get:function(){return this._getStyleColorValue("emissive")}},{key:"roughness",set:function(e){this.setMaterial({roughness:e})}},{key:"outlineColor",set:function(e){this._setSynValue("outlineColor",e)||this.setOutlineColor(e)},get:function(){return this._getStyleColorValue("outlineColor")}},{key:"defaultOutlineColor",set:function(e){this.setDefaultOutlineColor(e)},get:function(){return this._getStyleColorValue("defaultOutlineColor")}},{key:"skipBoundingBox",set:function(e){this.setSkipBoundingBox(e)}},{key:"skipOutline",set:function(e){this._setNodesAttribute("skipOutline",e,!0),e&&(this._outlineColor=null,this._defaultOutlineColor=null,this._clearAllOutlineColor())}},{key:"skipStyle",set:function(e){this.obj.node.traverse(function(t){t.isRenderableObject()&&(t.userData.skipStyle=e)})}},{key:"skipEnvMap",set:function(e){this._setNodesAttribute("skipEnvMap",e)}},{key:"glow",set:function(e){this.setGlow(e)},get:function(){return this._getStyleValue("glow")}},{key:"innerGlow",set:function(e){this.setInnerGlow(e)},get:function(){return this._getStyleValue("innerGlow")}},{key:"vertexNormalHelper",set:function(e){this.setVertexNormalHelper(e)},get:function(){return this._getStyleValue("vertexNormalHelper")}},{key:"axisHelper",set:function(e){this.setAxisHelper(e)},get:function(){return!!this._axisNode&&this._axisNode.visible}},{key:"edgeColor",set:function(e){this.setEdgeWireframe(e)},get:function(){return this._getStyleColorValue("edgeColor")}},{key:"boundingBox",set:function(e){this.setBoundingBox(e,16777215)},get:function(){return!!this._boundingBoxNode&&this._boundingBoxNode.visible}},{key:"boundingBoxColor",set:function(e){this.setBoundingBox(!0,e)},get:function(){return this._boundingBoxNode?this._boundingBoxNode.material.color.toHexString():0}},{key:"orientedBoundingBox",set:function(e){this.setOrientedBoundingBox(e)},get:function(){return!!this._orientedBoundingBoxNode&&this._orientedBoundingBoxNode.visible}},{key:"orientedBoundingBoxColor",set:function(e){this.setOrientedBoundingBox(!0,e)},get:function(){return this._orientedBoundingBoxNode?this._orientedBoundingBoxNode.material.color.toHexString():0}},{key:"alwaysOnTop",set:function(e){this.setAlwaysOnTop(e)},get:function(){return this._getStyleValue("alwaysOnTop")}},{key:"image",set:function(e){this.setImage(e)},get:function(){return this._getStyleValue("image")}},{key:"doubleSide",set:function(e){this._doubleSide=e,this.setMaterial({doubleSide:e})},get:function(){return this._getStyleValue("doubleSide")}}]),e}();wr.cAlwaysOnTopRenderOrderStart=1e6,wr.cAlwaysOnTopRenderOrderID=2*wr.cAlwaysOnTopRenderOrderStart;var Tr=void 0,Sr=function(e){function t(i){return r(this,t),a(this,e.call(this,i))}return o(t,e),t}(wr),Mr=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));return n._textColor=Te.parseColor("#1e90ff"),n._textSize=26,n._textLineWidth=65536,n._textLineHeight=20,n._textType="Arial",n._dropShadow=!0,n._dropShadowAlpha=1,n._dropShadowAngle=45,n._dropShadowBlur=1,n._dropShadowColor=Te.parseColor("#000000"),n._dropShadowDistance=2,n._strokeMode=!1,n}return o(t,e),n(t,[{key:"fontColor",set:function(e){this._textColor=Te.parseColor(e),this.obj.refreshTextMesh()},get:function(){return this._textColor.toHexString()}},{key:"fontSize",set:function(e){e&&(this._scale=e/26,this._textSize=e,this.obj.refreshTextMesh())},get:function(){return this._textSize}},{key:"fontType",set:function(e){this._textType=e,this.obj.refreshTextMesh()},get:function(){return this._textType}},{key:"dropShadow",set:function(e){this._dropShadow=e,this.obj.refreshTextMesh()},get:function(){return this._dropShadow}},{key:"dropShadowAlpha",set:function(e){this._dropShadowAlpha=e,this.obj.refreshTextMesh()},get:function(){return this._dropShadowAlpha}},{key:"dropShadowAngle",set:function(e){this._dropShadowAngle=e,this.obj.refreshTextMesh()},get:function(){return this._dropShadowAngle}},{key:"dropShadowBlur",set:function(e){this._dropShadowBlur=e,this.obj.refreshTextMesh()},get:function(){return this._dropShadowBlur}},{key:"dropShadowColor",set:function(e){this._dropShadowColor=Te.parseColor(e),this.obj.refreshTextMesh()},get:function(){return this._dropShadowColor.toHexString()}},{key:"dropShadowDistance",set:function(e){this._dropShadowDistance=e,this.obj.refreshTextMesh()},get:function(){return this._dropShadowDistance}},{key:"textLineWidth",set:function(e){this._textLineWidth=e,this.obj.refreshTextMesh()},get:function(){return this._textLineWidth}},{key:"textLineHeight",set:function(e){this._textLineHeight=e,this.obj.refreshTextMesh()},get:function(){return this._textLineHeight}},{key:"strokeMode",set:function(e){this._strokeMode=e,this.obj.refreshTextMesh()},get:function(){return this._strokeMode}}]),t}(Sr),Rr=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));return n._text="",n._factor=16/26*.1,n._keepSize=!1,n._mesh=null,n._disableRefresh=!1,n}return o(t,e),t.prototype.isTextRegion=function(){return!0},t.prototype.setupContext=function(e){var t=this.style;if(e.font=this.style.fontSize.toString(10)+"px "+this.style.fontType,e.fillStyle=this.style.fontColor,e.textAlign="center",e.textBaseline="middle",t._dropShadow){var i=t._dropShadowColor.toRGBArray(),r=j.degToRad(t._dropShadowAngle),n=t._dropShadowDistance*t._scale;e.shadowColor="rgba("+255*i[0]+","+255*i[1]+","+255*i[2]+","+t._dropShadowAlpha+")",e.shadowBlur=t._dropShadowBlur,e.shadowOffsetX=Math.cos(r)*n,e.shadowOffsetY=Math.sin(r)*n}else e.shadowColor=0,e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0},t.prototype.getTextRows=function(e,t,i,r,n){for(var o=t.split(""),a="",s=[],l=0;l<o.length;l++){var c=o[l];("\n"==c||e.measureText(a).width>=n)&&(s.push(a),a=""),a+=c}return s.push(a),s},t.prototype.drawText=function(e,t,i,r){for(var n=this.style.textLineHeight,o=0;o<r.length;o++)this.style.strokeMode?e.strokeText(r[o],t,i+o*n):e.fillText(r[o],t,i+o*n)},t.prototype.createTextMesh=function(){var e=document.createElement("canvas"),t=this.style.fontSize/72*96*2,i=Math.max(64,j.roundUpPowerOf2(t)),r=e.getContext("2d");this.setupContext(r);for(var n=this.getTextRows(r,this._text,i/2,i/2,this.style.textLineWidth),o=n.length*t,a=0,s=0;s<n.length;s++)a=Math.max(a,n[0].length*t);var l=Math.max(i,j.roundUpPowerOf2(a)),c=Math.max(i,j.roundUpPowerOf2(o));i=Math.max(l,c),e.width=i,e.height=i,e.style.width=e.width+"px",e.style.height=e.height+"px",this.setupContext(r),this.drawText(r,e.width/2,e.height/2,n);var u=new THREE.Texture(e);u.minFilter=THREE.LinearFilter,u.magFilter=THREE.LinearFilter,u.generateMipmaps=!0,u.needsUpdate=!0;var h=i*this._factor,p=new THREE.PlaneGeometry(h,h),d=new THREE.MeshBasicMaterial({map:u,transparent:!0,side:THREE.DoubleSide,depthWrite:!1}),f=new THREE.Mesh(p,d);return f.userData.skipBoundingBox=!0,f.userData.skipOutline=!0,f.userData.noBlending=!0,f},t.prototype.refreshTextMesh=function(){if(!this._disableRefresh){this.app.resourceManager.remove(this._mesh),this._mesh=this.createTextMesh(),this._mesh.renderOrder=1,this.node.add(this._mesh);var e=this.getControl("TextRegionSizeAdjustmentControl");e&&(e.node=this._mesh)}},t.prototype._beforeSetupStyle=function(e){this._disableRefresh=!0},t.prototype._afterSetupStyle=function(e){this._disableRefresh=!1,this.refreshTextMesh()},t.prototype.customSetup=function(e){this._disableRefresh=!0;var t=this.style;t.fontColor=Te.parseColor(e.textColor||e.fontColor||t.fontColor),t.fontSize=e.textSize||e.fontSize||t.fontSize,t.fontType=e.textType||e.fontType||t.fontType,t.textLineWidth=e.textLineWidth||e.fontLineWidth||t.textLineWidth,t.textLineHeight=e.textLineHeight||e.fontLineHeight||t.textLineHeight,t.strokeMode=e.storkeMode||t.strokeMode,this._text=e.text||e.fontText||this._text,this._factor=e.factor||this._factor;var i=e.keepSize;i&&(this.keepSize=i),this._disableRefresh=!1,this.refreshTextMesh(),this.node.skipBoundingBox(!0)},n(t,[{key:"text",set:function(e){this._text=e,this.refreshTextMesh()},get:function(){return this._text}},{key:"keepSize",set:function(e){if(this._keepSize!=e)if(this._keepSize=e){var t=Te.parseVector3(this.app.camera.position),i=60/this._mesh.getDistanceFromCamera(t);this.addControl(new Xe([i,i],this._mesh),"TextRegionSizeAdjustmentControl")}else this.removeControl("TextRegionSizeAdjustmentControl")},get:function(){return this._keepSize}},{key:"style",get:function(){return e.prototype._getStyle.call(this)}},{key:"textColor",set:function(e){console.warn('[TextRegion]Please use ".style.fontColor" to replace ".fontColor"'),this.style.fontColor=e},get:function(){return console.warn('[TextRegion]Please use ".style.fontColor" to replace ".fontColor"'),this.style.fontColor}},{key:"dropShadow",set:function(e){console.warn('[TextRegion]Please use ".style.dropShadow" to replace ".dropShadow"'),this.style.dropShadow=e},get:function(){return console.warn('[TextRegion]Please use ".style.dropShadow" to replace ".dropShadow"'),this.style.dropShadow}},{key:"dropShadowAlpha",set:function(e){console.warn('[TextRegion]Please use ".style.dropShadowAlpha" to replace ".dropShadowAlpha"'),this.style.dropShadowAlpha=e},get:function(){return console.warn('[TextRegion]Please use ".style.dropShadowAlpha" to replace ".dropShadowAlpha"'),this.style.dropShadowAlpha}},{key:"dropShadowAngle",set:function(e){console.warn('[TextRegion]Please use ".style.dropShadowAngle" to replace ".dropShadowAngle"'),this.style.dropShadowAngle=e},get:function(){return console.warn('[TextRegion]Please use ".style.dropShadowAngle" to replace ".dropShadowAngle"'),this.style.dropShadowAngle}},{key:"dropShadowBlur",set:function(e){console.warn('[TextRegion]Please use ".style.dropShadowBlur" to replace ".dropShadowBlur"'),this.style.dropShadowBlur=e},get:function(){return console.warn('[TextRegion]Please use ".style.dropShadowBlur" to replace ".dropShadowBlur"'),this.style.dropShadowBlur}},{key:"dropShadowColor",set:function(e){console.warn('[TextRegion]Please use ".style.dropShadowColor" to replace ".dropShadowColor"'),this.style.dropShadowColor=e},get:function(){return console.warn('[TextRegion]Please use ".style.dropShadowColor" to replace ".dropShadowColor"'),this.style.dropShadowColor}},{key:"dropShadowDistance",set:function(e){console.warn('[TextRegion]Please use ".style.dropShadowDistance" to replace ".dropShadowDistance"'),this.style.dropShadowDistance=e},get:function(){return console.warn('[TextRegion]Please use ".style.dropShadowDistance" to replace ".dropShadowDistance"'),this.style.dropShadowDistance}},{key:"textSize",set:function(e){console.warn('[TextRegion]Please use ".style.fontSize" to replace ".fontSize"'),this.style.fontSize=e},get:function(){return console.warn('[TextRegion]Please use ".style.fontSize" to replace ".fontSize"'),this.style.fontSize}},{key:"textLineWidth",set:function(e){console.warn('[TextRegion]Please use ".style.textLineWidth" to replace ".textLineWidth"'),this.style.textLineWidth=e},get:function(){return console.warn('[TextRegion]Please use ".style.textLineWidth" to replace ".textLineWidth"'),this.style.textLineWidth}},{key:"textLineHeight",set:function(e){console.warn('[TextRegion]Please use ".style.textLineHeight" to replace ".textLineHeight"'),this.style.textLineHeight=e},get:function(){return console.warn('[TextRegion]Please use ".style.textLineHeight" to replace ".textLineHeight"'),this.style.textLineHeight}},{key:"strokeMode",set:function(e){console.warn('[TextRegion]Please use ".style.strokeMode" to replace ".strokeMode"'),this.style.strokeMode=e},get:function(){return console.warn('[TextRegion]Please use ".style.strokeMode" to replace ".strokeMode"'),this.style.strokeMode}}]),t}(Ye),Pr=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));return n._batchObject=null,n._lineCurve=null,n._startPoint=null,n._endPoint=null,n._doors=null,n._doors_self=null,n._collisionBox=null,n._models=[],n._modelSize=null,n._combineModel=[],n._fenceUpdating=!1,n._startVertex=null,n._endVertex=null,n._urlbak=null,n._batchObject_Batch=null,n._fencesData_Batch=null,n._modelSize_Batch=null,n}return o(t,e),t.prototype.loadFromURL=function(e,t){this._url=e.url,e.force=!0,this.setupParent(e),e.skipSetupParent=!0,e.BatchFence?this._setupModel_Batch(t):this._setupModel(t)},t.prototype.setupFromURL=function(e){if(e.node)this._setup(e);else{var t=this;this.loadFromURL(e,function(){t._setup(e)})}},t.prototype._beforeSetup=function(t){if(e.prototype._beforeSetup.call(this,t),t.BatchFence){if(this._fencesData_Batch=t.fencesData,this._fencesData_Batch)for(var i=0;i<this._fencesData_Batch.length;i++){var r=this._fencesData_Batch[i];if(r){var n=r.doors;n&&(r.doors=this.sortDoor(n))}}}else this._startPoint=t.startPoint,this._endPoint=t.endPoint,this._doors=t.doors,this.sortDoor()},t.prototype._setupModel=function(e){var t=this;function i(){var e=Te.parseVector2([t._startVertex.localPosition[0],t._startVertex.localPosition[2]]),i=Te.parseVector2([t._endVertex.localPosition[0],t._endVertex.localPosition[2]]);t._lineCurve=new THREE.LineCurve(e,i)}function r(){var e=[],i=t._lineCurve.getLength();if(t._doors&&0<t._doors.length){for(var r=null,n=0;n<t._doors.length;n++){var o=t._doors[n],a=o.width/i/2;if(r){var s=t._lineCurve.getPoint(r);c=t._lineCurve.getPoint(o.percent-a),e.push(new THREE.LineCurve(s,c))}else{var l=t._lineCurve.getPoint(0),c=t._lineCurve.getPoint(o.percent-a);e.push(new THREE.LineCurve(l,c))}r=o.percent+a}if(r<1){var u=t._lineCurve.getPoint(r),h=t._lineCurve.getPoint(1);e.push(new THREE.LineCurve(u,h))}}else e.push(t._lineCurve);for(var p=t._modelSize[0],d=0,f=[],m=0;m<e.length;m++){var g=e[m];d+=b=w(p,g.getLength()),f.push(b)}!function(e){if(0<e)for(var i=0;i<e;i++)t._models.push(t._batchObject.createSubObject({}));else if(e<0)for(var r=Math.abs(e)-1;0<=r;r--)t._models[r].destroy(),t._models.splice(r,1)}(d-t._models.length);for(var v=0,y=0;y<e.length;y++){var b,_=e[y],x=v+(b=f[y]);E(_,b,t._models.slice(v,x)),v=x}function E(e,i,r){for(var n=e.getLengths(i),o=e.getPoints(i),a=new THREE.Vector3(t._startPoint[0],0,t._startPoint[1]),s=new THREE.Vector3(t._endPoint[0],0,t._endPoint[1]).clone().sub(a).normalize(),l=null,c=0;c<r.length;c++){var u=r[c],h=null;l?(h=n[c+1]-l,l=n[c+1]):h=l=n[c+1];var d=new THREE.Vector3(o[c].x,0,o[c].y),f=new THREE.Vector3(o[c+1].x,0,o[c+1].y);f=d.clone().add(s.clone().multiplyScalar(h/2)),u.localPosition=[f.x,0,f.z];var m=new THREE.Quaternion;m.setFromUnitVectors(new THREE.Vector3(1,0,0),s);var g=new THREE.Euler;g.setFromQuaternion(m),u.angles=[j.radToDeg(g.x),j.radToDeg(g.y),j.radToDeg(g.z)],u.scale=[h/p,1,1]}}function w(e,t){var i=t/e,r=i%1;return i=Math.floor(i),.05<r&&(i+=1),i}}this._setupVertexNode(),this._url!=this._urlbak?(this._batchObject&&(this._batchObject.destroy(),this._batchObject=null),this._models=[],this._urlbak=this._url,this._batchObject=this.app.create({type:"BatchObject",url:this._url,parent:this,complete:function(n){t._batchObject=n.object,t._modelSize=n.object.boundingBox.initSize,i(),r(),t.trigger("updateFence",{initSize:t._modelSize,start:t.startPoint,end:t.endPoint}),e&&e()}})):(i(),r(),t.trigger("updateFence",{initSize:t._modelSize,start:t.startPoint,end:t.endPoint}),e&&e())},t.prototype._setupVertexNode=function(){this._startVertex&&this._startVertex.destroy(),this._endVertex&&this._endVertex.destroy(),this._startVertex=this.app.create({type:"Thing"}),this.add(this._startVertex),this._startVertex.localPosition=[this._startPoint[0],0,this._startPoint[1]],this._endVertex=this.app.create({type:"Thing"}),this.add(this._endVertex),this._endVertex.localPosition=[this._endPoint[0],0,this._endPoint[1]]},t.prototype.updateFence=function(e){if(this.loaded&&!this._fenceUpdating){this._fenceUpdating=!0;var t=this;this._setupModel(function(){t._fenceUpdating=!1,e&&e()})}},t.prototype.sortDoor=function(){var e=this._doors;if(e&&0<e.length)for(var t=0;t<e.length-1;t++)for(var i=0;i<e.length-1-t;i++)if(e[i].percent>e[i+1].percent){var r=e[i];e[i]=e[i+1],e[i+1]=r}return e},t.prototype.addDoor=function(e,t){this._doors||(this._doors=[]),this._doors.push({percent:e,width:t}),this.sortDoor()},t.prototype.removeDoor=function(e){for(var t=0;t<this._doors.length;t++){var i=this._doors[t];if(Math.abs(i.percent-e)<=.001)return this._doors.splice(t,1),!0}return!1},t.prototype.getDoor=function(e){if(this._doors)for(var t=0;t<this._doors.length;t++){var i=this._doors[t];if(i.percent-e<=.001)return Te.cloneObject(i)}return null},t.prototype.editDoor=function(e){if(this._doors&&e&&null!=e.percent){var t={};Object.assign(t,e);for(var i=0;i<this._doors.length;i++)if(this._doors[i].percent-t.percent<=.001)return void(this._doors[i]=t)}},t.prototype.combineFence=function(e){var t=this;if(this._combineModel)for(var i=0;i<this._combineModel.length;i++){var r=this._combineModel[i];this.app.resourceManager.remove(r)}this._combineModel=[];for(var n=new combine.Processor,o=0;o<this._models.length;o++){var a=this._models[o].node;n.addModel(a)}n.delayBuild(function(e){t.node.add(e),t._combineModel.push(e);for(var i=e.getMaterials(),r=0;r<i.length;r++){var n=i[r];n.defines&&n.defines.USE_ALPHAINDEX&&delete n.defines.USE_ALPHAINDEX}}).then(function(){for(var i=0;i<t._models.length;i++)t._models[i].destroy();t.static&&t.node._synMatrixWorld(),t._models=[],e&&e()})},t.prototype._setupModel_Batch=function(e){var t=this;this._batchObject_Batch&&(this._batchObject_Batch.destroy(),this._batchObject_Batch=null),this._batchObject_Batch=this.app.create({type:"BatchObject",url:this._url,parent:this,complete:function(i){t._batchObject_Batch=i.object,t._modelSize_Batch=i.object.boundingBox.initSize,t._fencesData_Batch&&t._fencesData_Batch.forEach(function(e){var i=e.startPoint,r=e.endPoint,n=e.localPosition||[0,0,0],o=new THREE.Vector2(i[0]+n[0],i[1]+n[2]),a=new THREE.Vector2(r[0]+n[0],r[1]+n[2]);!function(e,i){var r=[],n=e.getLength();if(i&&0<i.length){for(var o=null,a=0;a<i.length;a++){var s=i[a],l=s.width/n/2;if(o){var c=e.getPoint(o),u=e.getPoint(s.percent-l);r.push(new THREE.LineCurve(c,u))}else{var h=e.getPoint(0);u=e.getPoint(s.percent-l);r.push(new THREE.LineCurve(h,u))}o=s.percent+l}if(o<1){var p=e.getPoint(o),d=e.getPoint(1);r.push(new THREE.LineCurve(p,d))}}else r.push(e);for(var f=t._modelSize_Batch[0],m=0,g=[],v=0;v<r.length;v++){var y=r[v];m+=E=M(f,y.getLength()),g.push(E)}for(var b=function(e){var i=[];if(0<e)for(var r=0;r<e;r++)i.push(t._batchObject_Batch.createSubObject({}));return i}(m),_=0,x=0;x<r.length;x++){var E,w=r[x],T=_+(E=g[x]);S(w,E,b.slice(_,T)),_=T}function S(e,t,i){for(var r=e.getLengths(t),n=e.getPoints(t),o=new THREE.Vector3(e.v1.x,0,e.v1.y),a=new THREE.Vector3(e.v2.x,0,e.v2.y).clone().sub(o).normalize(),s=null,l=0;l<i.length;l++){var c=i[l],u=null;s?(u=r[l+1]-s,s=r[l+1]):u=s=r[l+1];var h=new THREE.Vector3(n[l].x,0,n[l].y),p=new THREE.Vector3(n[l+1].x,0,n[l+1].y);p=h.clone().add(a.clone().multiplyScalar(u/2)),c.localPosition=[p.x,0,p.z];var d=new THREE.Quaternion;d.setFromUnitVectors(new THREE.Vector3(1,0,0),a);var m=new THREE.Euler;m.setFromQuaternion(d),c.angles=[j.radToDeg(m.x),j.radToDeg(m.y),j.radToDeg(m.z)],c.scale=[u/f,1,1]}}function M(e,t){var i=t/e,r=i%1;return i=Math.floor(i),.05<r&&(i+=1),i}}(new THREE.LineCurve(o,a),e.doors)}),e&&e()}}),this._batchObject_Batch.canNotQueryFromSelector=!0},n(t,[{key:"worldStartPoint",get:function(){return[this._startVertex.position[0],this._startVertex.position[2]]},set:function(e){if(e instanceof Array&&2<=e.length){var t=[e[0]-this.position[0],e[1]-this.position[2]];this.startPoint=t}}},{key:"worldEndPoint",get:function(){return[this._endVertex.position[0],this._endVertex.position[2]]},set:function(e){if(e instanceof Array&&2<=e.length){var t=[e[0]-this.position[0],e[1]-this.position[2]];this.endPoint=t}}},{key:"startPoint",get:function(){return this._startPoint=[this._startVertex.localPosition[0],this._startVertex.localPosition[2]],this._startPoint},set:function(e){this._startVertex&&(this._startVertex.localPosition=[e[0],0,e[1]]),this._startPoint=e}},{key:"endPoint",get:function(){return this._endPoint=[this._endVertex.localPosition[0],this._endVertex.localPosition[2]],this._endPoint},set:function(e){this._endVertex&&(this._endVertex.localPosition=[e[0],0,e[1]]),this._endPoint=e}},{key:"fenceLength",get:function(){return this._lineCurve.getLength()}},{key:"doors",get:function(){return this._doors}},{key:"fenceUpdating",get:function(){return this._fenceUpdating}},{key:"url",get:function(){return this._url},set:function(e){this._url=e}},{key:"worldlineCurve",get:function(){var e=Te.parseVector2(this.worldStartPoint),t=Te.parseVector2(this.worldEndPoint);return new THREE.LineCurve(e,t)}},{key:"lineCurve",get:function(){var e=Te.parseVector2(this.startPoint),t=Te.parseVector2(this.endPoint);return this._lineCurve=new THREE.LineCurve(e,t),this._lineCurve}}]),t}(Ye),Ar=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));return n._controlPoint=null,n._controlVertex=null,n}return o(t,e),t.prototype._beforeSetup=function(t){e.prototype._beforeSetup.call(this,t),this._controlPoint=t.controlPoint},t.prototype._setupModel=function(e){var t=this;!function(){for(var e=0;e<t._models.length;e++)t._models[e].destroy();t._models=[]}(),this._setupVertexNode(),this.app.create({type:"Thing",visible:!1,url:this._url,complete:function(i){t._modelSize=i.object.boundingBox.initSize,function(){var e=Te.parseVector2(t._startVertex.position),i=Te.parseVector2(t._controlVertex.position),r=Te.parseVector2(t._endVertex.position),n=new THREE.QuadraticBezierCurve(e,i,r);t._lineCurve?t._lineCurve.getLength()!=n.getLength()&&(t._lineCurve=n):t._lineCurve=n}(),function(){var e=t._lineCurve.getLength(),i=t._modelSize[0],r=e/i,n=r%1;r=Math.floor(r),.1<n&&(r+=1);var o=r-t._models.length;(function(){if(0<o)for(var e=0;e<o;e++)t._models.push(t.app.create({url:t._url,type:"Thing",parent:t}));else if(o<0)for(var i=Math.abs(o)-1;0<=i;i--)t._models[i].destroy(),t._models.splice(i,1)})(),function(){for(var e=t._lineCurve.getLengths(r),n=t._lineCurve.getPoints(r),o=null,a=0;a<t._models.length;a++){var s=t._models[a],l=null;o?(l=e[a+1]-o,o=e[a+1]):l=o=e[a+1];var c=new THREE.Vector3(n[a].x,0,n[a].y),u=new THREE.Vector3(n[a+1].x,0,n[a+1].y),h=u.clone().sub(c).normalize();u=c.clone().add(h.clone().multiplyScalar(l/2)),s.position=[u.x,0,u.z],s.node.quaternion.setFromUnitVectors(new THREE.Vector3(1,0,0),h),s.scale=[l/i,1,1]}}()}(),e&&e()}})},t.prototype._setupVertexNode=function(){e.prototype._setupVertexNode.call(this),this._controlVertex&&this._controlVertex.destroy(),this._controlVertex=this.app.create({type:"Thing"}),this.add(this._controlVertex),this._controlVertex.localPosition=[this._controlPoint[0],0,this._controlPoint[1]]},n(t,[{key:"worldControlPoint",get:function(){return[this._startVertex.position[0],this._startVertex.position[2]]},set:function(e){if(e instanceof Array&&2<=e.length){var t=[e[0]-this.position[0],e[1]-this.position[2]];this.controlPoint=t}}},{key:"controlPoint",get:function(){return this._controlPoint=[this._controlVertex.localPosition[0],this._controlVertex.localPosition[2]],this._controlPoint},set:function(e){this._controlVertex&&(this._controlVertex.localPosition=[e[0],0,e[1]]),this._controlPoint=e}}]),t}(Pr),Cr=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));return n._points=[],n._shape=null,n._ground=null,n._level=1,n._repeatUV=[],n._vertexNode=[],n._textureUrl=null,n}return o(t,e),t.prototype._setup=function(t){this._destroyGround(),this._points&&0<this._points.length&&(this._setupVertexNode(),this._setupShape(),this._createGround(),this._setupRepeatUV(),this._setupLevel()),e.prototype._setup.call(this,t)},t.prototype._beforeSetup=function(t){e.prototype._beforeSetup.call(this,t),this._points=t.points,this._repeatUV=t.repeatUV,this._level=t.level,this._url=t.url},t.prototype._setupGround=function(){this._destroyGround(),this._setupVertexNode(),this._setupShape(),this._createGround(),this._setupRepeatUV(),this._setupLevel()},t.prototype._setupTexture=function(){if(this._textureUrl!=this._url){this._textureUrl=this._url;var e=(new THREE.TextureLoader).load(this._url);e.wrapS=e.wrapT=THREE.RepeatWrapping,this._ground.material.map=e}},t.prototype._setupLevel=function(){var e=this._ground.material;e.polygonOffsetFactor=.5,e.polygonOffsetUnits=100*(1e3-this._level)},t.prototype._setupRepeatUV=function(){if(this._repeatUV&&0<this._repeatUV.length){var e=this._ground.material,t=this._repeatUV[0]/this.boundingBox.size[0],i=this._repeatUV[1]/this.boundingBox.size[2];e.map.repeat.fromArray([t,i]),e.map.wrapT=e.map.wrapS=THREE.RepeatWrapping}else{t=(e=this._ground.material).map.repeat.x*this.boundingBox.size[0];var r=e.map.repeat.y*this.boundingBox.size[2];this._repeatUV=[t,r]}},t.prototype._setupShape=function(){var e=this;if(this._vertexNode){for(var t=!1,i=0;i<this._vertexNode.length;i++)if(0<this._vertexNode[i].ratio){t=!0;break}t?function(){e._shape=new THREE.Shape;for(var t=[],i=[],r=0;r<e._vertexNode.length;r++){var n=e._vertexNode[0==r?e._vertexNode.length-1:r-1],o=e._vertexNode[r],a=e._vertexNode[r==e._vertexNode.length-1?0:r+1];0<o.ratio?(t.push((s=[n.localPosition[0],n.localPosition[2]],l=[o.localPosition[0],o.localPosition[2]],c=[a.localPosition[0],a.localPosition[2]],u=o.ratio,v=g=d=p=h=void 0,h=Te.parseVector2(s),p=Te.parseVector2(l),d=Te.parseVector2(c),f=p.distanceTo(h)/2,m=p.distanceTo(d)/2,g=p.clone().add(h.clone().sub(p).normalize().multiplyScalar(f*u)),v=p.clone().add(d.clone().sub(p).normalize().multiplyScalar(m*u)),{a:g.toArray(),b:l,c:v.toArray()})),i.push(!0)):(t.push({point:[o[0],o[2]]}),i.push(!1))}for(var s,l,c,u,h,p,d,f,m,g,v,y=null,b=0;b<t.length;b++){var _=t[b],x=t[b==t.length-1?0:b+1],E=i[b],w=i[b==i.length-1?0:b+1];if(0==b&&(y=E?_.a:_.point,e._shape.moveTo(y[0],y[1])),E){var T=_.b,S=_.c;e._shape.quadraticCurveTo(T[0],T[1],S[0],S[1]);var M=w?x.a:x.point;e._shape.lineTo(M[0],M[1])}else{M=w?x.a:x.point;e._shape.lineTo(M[0],M[1])}b==t.length-1&&e._shape.lineTo(y[0],y[1])}}():function(){e._shape=new THREE.Shape;var t=e._vertexNode[0];e._shape.moveTo(t.localPosition[0],t.localPosition[2]);for(var i=0;i<e._vertexNode.length;i++){var r=e._vertexNode[i==e._vertexNode.length-1?0:i+1];e._shape.lineTo(r.localPosition[0],r.localPosition[2])}e._shape.lineTo(t.localPosition[0],t.localPosition[2])}()}},t.prototype._setupVertexNode=function(){var e=this._points;if(this._vertexNode&&0<this._vertexNode.length)for(var t=0;t<this._vertexNode.length;t++)this._vertexNode[t].destroy();this._vertexNode=[];for(var i=0;i<e.length;i++){var r=e[i],n=this.app.create({type:"Thing"});this.add(n),n.ratio=r.ratio||0,n.localPosition=[r.pos[0],0,r.pos[1]],this._vertexNode.push(n)}},t.prototype._createGround=function(){var e=(new THREE.TextureLoader).load(this._url);e.wrapS=e.wrapT=THREE.RepeatWrapping;var t=new THREE.ShapeGeometry(this._shape);t.rotateX(Math.PI/2);var i=new THREE.MeshLambertMaterial({side:THREE.DoubleSide,map:e});i.polygonOffset=!0,this._ground=new THREE.Mesh(t,i),this._ground.receiveShadow=!0,this.node.add(this._ground),this._textureUrl=null},t.prototype._destroyGround=function(){this._ground&&(this.app.resourceManager.remove(this._ground),this._ground=null)},t.prototype.updateRegion=function(){this._setupGround(),this._setupTexture(),this._setupLevel(),this._setupRepeatUV()},t.prototype.getFencesData=function(){this._setupShape();for(var e=this._shape.curves,t=[],i=null,r=null,n=0;n<e.length;n++){var o=e[n];if(0==n)i=o;else if(n==e.length-1){if(0==o.getLength())return t;r=o}var a={};"LineCurve"==o.type?(a.startPoint=o.v1.toArray(),a.endPoint=o.v2.toArray(),a.type="Fence"):(a.startPoint=o.v0.toArray(),a.controlPoint=o.v1.toArray(),a.endPoint=o.v2.toArray(),a.type="CurveFence"),t.push(a)}return a={},"LineCurve"!=i.type?a.endPoint=i.v0.toArray():a.endPoint=i.v1.toArray(),a.type="Fence",a.startPoint=r.v2.toArray(),t.push(a),t},n(t,[{key:"repeatUV",get:function(){return this._repeatUV},set:function(e){this._repeatUV=e,this._setupRepeatUV()}},{key:"level",get:function(){return this._level},set:function(e){this._level=e,this._setupLevel()}},{key:"worldPoints",get:function(){for(var e=[],t=0;t<this._vertexNode.length;t++){var i=this._vertexNode[t];this._points[t].pos=[i.position[0],i.position[2]],e.push({pos:[i.position[0],i.position[2]],ratio:this.points[t].ratio})}return e},set:function(e){var t=this._vertexNode.length-e.length;if(0<t)for(var i=0;i<t;i++)this._vertexNode[0].destroy(),this._vertexNode.splice(0,1);else if(t<0){t=Math.abs(t);for(var r=0;r<t;r++)this._vertexNode.push(this.app.create({type:"Thing",parent:this}))}this._points=e;for(var n=0;n<this._vertexNode.length;n++){var o=this._vertexNode[n],a=e[n].pos;o.position=[a[0],this.position[1],a[1]],this._points[n]&&(this._points[n].pos=[o.localPosition[0],o.localPosition[2]])}}},{key:"points",get:function(){for(var e=0;e<this._vertexNode.length;e++){var t=this._vertexNode[e];this._points[e].pos=[t.localPosition[0],t.localPosition[2]]}return this._points},set:function(e){var t=this._vertexNode.length-e.length;if(0<t)for(var i=0;i<t;i++)this._vertexNode[0].destroy(),this._vertexNode.splice(0,1);else if(t<0){t=Math.abs(t);for(var r=0;r<t;r++)this._vertexNode.push(this.app.create({type:"Thing",parent:this}))}this._points=e;for(var n=0;n<this._vertexNode.length;n++){var o=this._vertexNode[n],a=e[n].pos;o.localPosition=[a[0],this.position[1],a[1]]}}},{key:"url",get:function(){return this._url},set:function(e){this._url!=e&&(this._url=e,this._setupTexture())}}]),t}(Ye),Or=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));return n._points=[],n}return o(t,e),t.prototype._updateByPoints=function(){},t.prototype._createPolygonVertices=function(e){for(var t=[],i=0;i<this._points.length;i++){var r=this._points[i],n=new THREE.Vector3(r.x,r.z,r.y);t.push(n)}THREE.ShapeUtils.isClockWise(t)||(t=t.reverse());var o=[],a=THREE.ShapeUtils.triangulateShape(t,[]);for(i=0;i<a.length;i++)o.push(new THREE.Face3(a[i][0],a[i][1],a[i][2]));var s=new THREE.Matrix4;for(this.node.updateWorldMatrix(!0),s.getInverse(this.node.matrixWorld),i=0;i<t.length;i++){if(n=t[i],!e){var l=n.z;n.z=n.y,n.y=l}n.applyMatrix4(s)}return{vertices:t,faces:o}},t.prototype._createPolygonGeometry=function(e,t){var i=new THREE.Geometry;return i.vertices=e,i.faces=t,i.genFaceVertexUVs(),i},t.prototype.clearPoints=function(){this._points=[],this._updateByPoints()},t.prototype.insertPoint=function(e,t){t=Te.parseVector3(t),this._points.splice(e,0,t),this._updateByPoints()},t.prototype.setPoint=function(e,t){return!(e>=this._points.length||!t||(t=Te.parseVector3(t),this._points[e]=t,this._updateByPoints(),0))},t.prototype.getPoint=function(e){return e>=this._points.length?null:this._points[e].toArray()},t.prototype.addPoint=function(e){return e=Te.parseVector3(e),this._points.push(e),this._updateByPoints(),this._points.length-1},t.prototype._getPoints=function(e,t){for(var i=[],r=0;r<e.length;r++){var n=Te.parseVector3(e[r]);t==R.Local?n=Te.parseVector3(this.localToWorld(n.toArray())):t==R.Self&&(n=Te.parseVector3(this.selfToWorld(n.toArray()))),i.push(n)}return i},t.prototype.getPointsCenterPos=function(e,t){var i=this._getPoints(e,t);if(!i.length)return[0,0,0];for(var r=0,n=[],o=0;o<i.length;o++){var a=i[o];r+=a.y,n.push([a.x,a.z])}var s=new polylabel([n]);return[s[0],r/i.length,s[1]]},t.prototype.addPoints=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:R.World,i=this._getPoints(e,t);this._points=this._points.concat(i),this._updateByPoints()},t.prototype.removePoints=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;this._points.splice(e,t),this._updateByPoints()},t.prototype.inside=function(e){for(var t=this.planePoints,i=e[0],r=e[1],n=!1,o=0,a=t.length,s=a-1;o<a;s=o,o++){var l=t[o][0],c=t[o][1],u=t[s][0],h=t[s][1];if((l===i&&c===r||u===i&&h===r)&&(n=!n),c<r&&r<=h||r<=c&&h<r){var p=l+(r-c)*(u-l)/(h-c);p===i&&(n=!n),i<p&&(n=!n)}}return!!n},t.prototype.clearPathPoints=function(){console.warn("[PointsBase] Please use '.clearPoints()' to replace 'clearPathPoints()'"),this.clearPoints()},t.prototype.removePoint=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;console.warn("[LineBase] Please use '.removePoints' to replace '.removePoint'"),this.removePoints(e,t)},n(t,[{key:"points",get:function(){for(var e=[],t=0;t<this._points.length;t++)e.push(this._points[t].toArray());return e}},{key:"planePoints",get:function(){for(var e=[],t=0;t<this._points.length;t++){var i=this._points[t];e.push([i.x,i.z])}return e}},{key:"area",get:function(){for(var e=[],t=0;t<this._points.length;t++){var i=this._points[t];e.push(new THREE.Vector2(i.x,i.z))}var r=THREE.ShapeUtils.area(e);return Math.abs(r)}},{key:"centerPos",get:function(){return new polylabel([this.planePoints])}},{key:"avgHeight",get:function(){if(!this._points.length)return 0;for(var e=0,t=0;t<this._points.length;t++)e+=this._points[t].y;return e/this._points.length}}]),t}(Ye),Lr=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));return n._lineMesh=null,n._areaMesh=null,n._textRegion=null,n}return o(t,e),t.prototype._updateTextPosition=function(){if(this._textRegion){var e=this.centerPos;this._textRegion.position=[e[0],this.position.y,e[1]],this._textRegion.translateY(.01)}},t.prototype._updateByPoints=function(){if(!(this._points.length<3)){var e=new THREE.MeshBasicMaterial({color:this.style.regionColor,opacity:this.style.regionOpacity,transparent:!0,side:THREE.DoubleSide,depthWrite:!1}),t=this._createPolygonVertices(),i=this._createPolygonGeometry(t.vertices,t.faces);this.app.resourceManager.remove(this._areaMesh),this._areaMesh=new THREE.Mesh(i,e),this.node.add(this._areaMesh);var r=new THREE.LineBasicMaterial({color:this.style.lineColor});this.app.resourceManager.remove(this._lineMesh),(i=new THREE.Geometry).vertices=t.vertices,i.vertices.push(t.vertices[0]),this._lineMesh=new THREE.Line(i,r),this._lineMesh.userData.skipPick=!0,this.node.add(this._lineMesh)}},t.prototype._beforeSetupComplete=function(e){var t=e.points||e.vertices;t&&this.addPoints(t);var i=e.fontText||e.text;i&&(this.text=i),Te.parseValue(e.alwaysOnTop,!0)&&(this.style.alwaysOnTop=!0);var r=this.style;r.lineColor=Te.parseColor(e.lineColor,r.lineColor),r.regionOpacity=Te.parseValue(e.regionOpacity||e.opacity,r.regionOpacity),r.regionColor=Te.parseColor(e.regionColor,r.regionColor)},n(t,[{key:"textRegion",get:function(){if(!this._textRegion){var e={type:"TextRegion",parent:this};this._textRegion=this.app.create(e),this._textRegion._mesh.renderOrder=1,this._textRegion.angleX=-90,this._textRegion.translateY(.1)}return this._textRegion}},{key:"text",set:function(e){this.textRegion.text=e,this._updateTextPosition()},get:function(){return this.textRegion.text}},{key:"style",get:function(){return e.prototype._getStyle.call(this)}},{key:"lineColor",set:function(e){console.warn('[PolygonRegion]Please use ".style.lineColor" to replace ".lineColor"'),this.style.lineColor=e},get:function(){return console.warn('[PolygonRegion]Please use ".style.lineColor" to replace ".lineColor"'),this.style.lineColor}},{key:"regionColor",set:function(e){console.warn('[PolygonRegion]Please use ".style.regionColor" to replace ".regionColor"'),this.style.regionColor=e},get:function(){return console.warn('[PolygonRegion]Please use ".style.regionColor" to replace ".regionColor"'),this.style.regionColor}},{key:"regionOpacity",set:function(e){console.warn('[PolygonRegion]Please use ".style.regionOpacity" to replace ".regionOpacity"'),this.style.regionOpacity=e},get:function(){return this.style.regionOpacity}}]),t}(Or),kr=null,Hr=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));return n.node=new THREE.Group,n._map=null,n._tex=null,n._params={},n}return o(t,e),t.prototype._beforeSetup=function(e){this._map=(kr||(kr=new SimpleHeatmap),kr);var t=this._tex=new THREE.Texture(this._map.canvas()),i=void 0!==e.opacity?e.opacity:1,r=e.width||10,n=e.height||10,o=void 0;if(e.clipShape){var a=e.clipShape.shape.map(function(e){return(new THREE.Vector2).fromArray(e)}),s=new THREE.Shape(a);s.autoClose=!0,e.clipShape.holes&&(s.holes=e.clipShape.holes.map(function(e){return new THREE.Shape(e.map(function(e){return(new THREE.Vector2).fromArray(e)}))}));for(var l=(o=new THREE.ShapeBufferGeometry(s)).getAttribute("uv"),c=0,u=l.array.length;c<u;c+=2){var h=l.array[c+0],p=l.array[c+1];l.array[c+0]=(h+r/2)/r,l.array[c+1]=(p+n/2)/n}}else o=new THREE.PlaneGeometry(r,n);var d=void 0;e.mosaic?(d=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(jr.uniforms),vertexShader:jr.vertexShader,fragmentShader:jr.fragmentShader,transparent:!0,side:THREE.DoubleSide,opacity:i})).uniforms.tDiffuse.value=t:d=new THREE.MeshBasicMaterial({map:t,side:THREE.DoubleSide,transparent:!0,opacity:i}),this._material=d;var f=new THREE.Mesh(o,d);this.node.add(f),this._initParameter(e),this._refresh()},t.prototype._initParameter=function(e){var t=this._params;t.areaWidth=e.width||10,t.areaHeight=e.height||10,t.mapSize=e.mapSize||256,t.alpha=!!e.alpha,t.gradient=e.gradient||{.4:"blue",.6:"cyan",.7:"lime",.8:"yellow",1:"red"},t.minValue=e.minValue||10,t.maxValue=e.maxValue||50,t.radius=e.radius||.8,t.blur=e.blur||.8,t.data=e.data||[],t.mosaicSize=e.mosaicSize||t.mapSize/64},t.prototype.setParameter=function(e){var t=this._params;t.mapSize=e.mapSize||t.mapSize,t.alpha=void 0!==e.alpha?e.alpha:t.alpha,t.gradient=e.gradient||t.gradient,t.minValue=e.minValue||t.minValue,t.maxValue=e.maxValue||t.maxValue,t.radius=e.radius||t.radius,t.blur=e.blur||t.blur,t.data=e.data||t.data,t.mosaicSize=e.mosaicSize||t.mosaicSize,this._refresh()},t.prototype.addData=function(e){this._params.data.push(e),this._refresh()},t.prototype.setData=function(e){this._params.data=e,this._refresh()},t.prototype.setAlpha=function(e){this._params.alpha=e,this._refresh()},t.prototype.setRadius=function(e,t){this._params.radius=e,void 0!==t&&(this._params.blur=t),this._refresh()},t.prototype.setGradient=function(e){this._params.gradient=e,this._refresh()},t.prototype.randomData=function(){for(var e=this._params,t=[],i=0;i<Math.round(e.areaWidth*e.areaHeight);i++)t.push([(Math.random()-.5)*e.areaWidth,(Math.random()-.5)*e.areaHeight,Math.pow(Math.random(),3)*(e.maxValue-e.minValue)+e.minValue]);this.setData(t)},t.prototype._refresh=function(){var e=this._params,t=1,i=1,r=e.mapSize/e.areaWidth;e.areaWidth!=e.areaHeight&&(e.areaWidth>e.areaHeight?(t=1,i=e.areaHeight/e.areaWidth):(t=e.areaWidth/e.areaHeight,i=1,r=e.mapSize/e.areaHeight));var n=1;e.radius*r<1&&(n=1/e.radius*r+1e-4);var o=e.data.map(function(e){return[e[0]*n,e[1]*n,e[2]]}),a=Math.floor(e.mapSize*t),s=Math.floor(e.mapSize*i);this._map.setCanvasSize(a,s).setAreaSize(e.areaWidth*n,e.areaHeight*n).min(e.minValue).max(e.maxValue).alpha(e.alpha).gradient(e.gradient).radius(Math.floor(e.radius*r*n),Math.floor(e.blur*r*n)).data(o).draw(),this._tex.needsUpdate=!0,this.app.renderer.setTexture2D(this._tex,0),this._material.isShaderMaterial&&(this._material.uniforms.texSize.value.set(a,s),this._material.uniforms.mosaicSize.value.set(e.mosaicSize,e.mosaicSize))},n(t,[{key:"isHeatmap",get:function(){return console.warn("[Heatmap] Please use 'instanceof THING.Heatmap' to replace '.isHeatmap'"),this instanceof THING.Heatmap}}]),t}(Ye),jr={uniforms:{tDiffuse:{value:null},texSize:{value:new THREE.Vector2(640,640)},mosaicSize:{value:new THREE.Vector2(16,16)}},vertexShader:"\n        varying vec2 vUV;\n        void main() {\n            vUV = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }\n    ",fragmentShader:"\n        uniform sampler2D tDiffuse;\n\n        uniform vec2 texSize;\n        uniform vec2 mosaicSize;\n\n        varying vec2 vUV;\n\n        void main(void) {\n            vec2 xy = vec2(vUV.x * texSize.x, vUV.y * texSize.y);\n            \n            vec2 xyMosaic = vec2(floor(xy.x / mosaicSize.x) * mosaicSize.x, \n                    floor(xy.y / mosaicSize.y) * mosaicSize.y )\n                    + .5*mosaicSize;\n            \n            vec2 delXY = xyMosaic - xy;\n            float delL = length(delXY);\n            \n            vec2 uvMosaic = vec2(xyMosaic.x / texSize.x, xyMosaic.y / texSize.y);\n\n            float percent = smoothstep(0., 1., 1. - delL * 2.4 / mosaicSize.x) * 0.7 + 0.3;\n\n            vec4 centerColor = texture2D(tDiffuse, uvMosaic);\n            vec4 originColor = texture2D(tDiffuse, vUV);\n\n            vec4 resultColor = vec4(mix(originColor.rgb, centerColor.rgb, percent), centerColor.a * percent);\n\n            if (originColor.a < 0.0001) discard;\n            \n            gl_FragColor = resultColor;\n        }\n    "},Fr=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));return n.pathTexture=null,n.pathWidth=1,n.pathCornerRadius=.3,n.pathCornerSplit=10,n.pathScrollUV=!1,n.pathScrollSpeed=10,n.rotateScrollDirection=!1,n.pathPlayingTween=null,n.pathUp=new THREE.Vector3(0,1,0),n.pathPointList=null,n.pathGeometry=null,n.pathLine=null,n.pathMaterial=new THREE.MeshBasicMaterial({transparent:!0}),n}return o(t,e),t.prototype.synPathTexture=function(e){(this.pathTexture=e)&&(e.needsUpdate=!0),this.pathLine&&(this.pathLine.material.map=this.pathTexture,this.pathLine.material.needsUpdate=!0)},t.prototype._setupPoints=function(e){var t=e.points;if(t){var i=e.spaceType,r=e.local;if(!i&&r&&(i=SpaceType.Local),!e.position&&!e.localPosition){var n=this.getPointsCenterPos(t,i);this.position=n}this.addPoints(t,i)}},t.prototype._setupPathLine=function(e){this.scrollUV=Te.parseValue(e.scrollUV,!1),this.uvRatio=e.uvRatio||1,this.width=Te.parseValue(e.width,this.width),this.side=Te.parseValue(e.side,"both"),this.close=Te.parseValue(e.close,!1);var t=Te.parseValue(e.doubleSide,!0);this.pathMaterial.side=t?THREE.DoubleSide:THREE.FrontSide;var i=Te.parseValue(e.drawMode,THREE.TriangleStripDrawMode);this.pathLine=new THREE.Mesh(this.pathGeometry,this.pathMaterial),this.pathLine.drawMode=i;var r=e.image;r&&(this.style.image=r)},t.prototype._addPathLine=function(){this.node.add(this.pathLine)},t.prototype._beforeSetupComplete=function(e){this._setupPathLine(e),this._setupPoints(e),this._addPathLine()},t.prototype._updateByPoints=function(){this.node.updateWorldMatrix(!0,!1);for(var e=[],t=0;t<this._points.length;t++){var i=this._points[t].clone();e.push(this.node.worldToLocal(i))}2<=e.length&&this.pathPointList.set(e,this.pathCornerRadius,this.pathCornerSplit,this.pathUp,this.close)},t.prototype.updatePath=function(){if(this.pathScrollUV&&this.pathTexture){var e=this.scrollSpeed/1e3;return this.rotateScrollDirection?this.pathTexture.offset.y-=e:this.pathTexture.offset.x-=e,!0}return!1},t.prototype.update=function(t){return e.prototype.update.call(this,t)|this.updatePath()},t.prototype.play=function(e){var t=(e=e||{}).time||1e3,i=Te.parseValue(e.startProgress,0),r=Te.parseValue(e.endProgress,1),n=e.lerpType||S.Linear.None,o=e.complete,a=this,s={progress:i},l={progress:r};this.pathPlayingTween=new TWEEN.Tween(s).to(l,t).easing(n).onUpdate(function(){a.pathGeometry.update(a.pathPointList,{width:a.pathWidth,radius:a.pathWidth,arrow:!!a.arrowFlag,progress:this._object.progress})}).onComplete(function(){o&&o.call(a)}).start()},t.prototype.stop=function(){this.pathPlayingTween&&(this.pathPlayingTween.stop(),this.pathPlayingTween=null)},t.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);return t.image=this.image,t.scrollUV=this.scrollUV,t.points=this.points,t},n(t,[{key:"uvRatio",set:function(e){this.pathTexture&&(this.pathTexture.repeat.x=1/e)}},{key:"useTexture",set:function(e){var t=this.pathLine.material;t.map=e?this.pathTexture:null,t.needsUpdate=!0},get:function(){return null!==this.pathLine.material.map}},{key:"width",set:function(e){this.pathWidth=e,this._updateByPoints()},get:function(){return this.pathWidth}},{key:"scrollUV",set:function(e){this.pathScrollUV=e,this.tickable=!0},get:function(){return this.pathScrollUV}},{key:"scrollSpeed",set:function(e){this.pathScrollSpeed=j.clamp(e,-99,99)},get:function(){return this.pathScrollSpeed}},{key:"cornerRadius",set:function(e){this.pathCornerRadius=e,this._updateByPoints()},get:function(){return this.pathCornerRadius}},{key:"cornerSegments",set:function(e){this.pathCornerSplit=e,this._updateByPoints()},get:function(){return this.pathCornerSplit}},{key:"length",get:function(){if(this._points.length<=1)return 0;for(var e=0,t=this._points[0],i=1;i<this._points.length;i++){var r=this._points[i];e+=r.distanceTo(t),t=r}return e}},{key:"cornerSplit",set:function(e){console.warn("[LineBase] Please use '.cornerSegments' to replace '.cornerSplit'"),this.cornerSegments=e},get:function(){return console.warn("[LineBase] Please use '.cornerSegments' to replace '.cornerSplit'"),this.cornerSegments}}]),t}(Or),Dr=function(){function e(t){r(this,e),this.app=t,this._points=[]}return e.prototype.set=function(e,t,i,r){this._points=e},n(e,[{key:"vertices",get:function(){for(var e=[],t=0;t<this._points.length;t++)e.push(Te.parseVector3(this._points[t]));return e}}]),e}(),Br=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));return n.dotNode=null,n.pathGeometry=new THREE.BufferGeometry,n.pathGeometry.update=function(e,t){},n.dotGeometry=null,n.dotMaterial=null,n.pathPointList=new Dr,n}return o(t,e),t.prototype._updateByPoints=function(){e.prototype._updateByPoints.call(this);var t=this.pathPointList.vertices;t.length&&(this.pathGeometry.setFromPoints(t),this.pathLine.computeLineDistances(),this.dotGeometry&&this.dotGeometry.setFromPoints(t),this.node.setFrustumCulled(!1))},t.prototype._setupPathLine=function(e){var t,i=e.style||{},r=e.lineOpacity||1,n=Te.parseValue(e.lineDashSize||i.lineDashSize,0),o=Te.parseValue(e.lineGapSize||i.lineGapSize,0),a=e.lineWidth||1,s=e.color||255,l=this.pathPointList.vertices;t=n||o?new THREE.LineDashedMaterial({color:s,opacity:r,dashSize:n,gapSize:o,linewidth:a,transparent:!0}):new THREE.LineBasicMaterial({color:s,opacity:r,linewidth:a,transparent:!0}),this.pathGeometry.setFromPoints(l),this.pathLine=new THREE.Line(this.pathGeometry,t),this.pathLine.computeLineDistances();var c=e.dotColor||16777215,u=e.dotSize;u&&(this.dotGeometry=(new THREE.BufferGeometry).setFromPoints(l),this.dotMaterial=new THREE.PointsMaterial({color:c,size:u,sizeAttenuation:!1}),this.dotNode=new THREE.Points(this.dotGeometry,this.dotMaterial),this.node.add(this.dotNode))},t.prototype.showLines=function(e){this.pathLine.visible=e},t.prototype.showPoints=function(e){this.dotNode.visible=e},n(t,[{key:"isLine",get:function(){return console.warn("[Line] Please use 'instanceof THING.Line' to replace '.isLine'"),this instanceof THING.Line}}]),t}(Fr),Ir=function(){this.pos=new THREE.Vector3,this.dir=new THREE.Vector3,this.right=new THREE.Vector3,this.up=new THREE.Vector3,this.dist=0,this.widthScale=1};Ir.prototype.lerpPathPoints=function(e,t,i){this.pos.lerpVectors(e.pos,t.pos,i),this.dir.lerpVectors(e.dir,t.dir,i),this.up.lerpVectors(e.up,t.up,i),this.right.lerpVectors(e.right,t.right,i),this.dist=(t.dist-e.dist)*i+e.dist,this.widthScale=(t.widthScale-e.widthScale)*i+e.widthScale},Ir.prototype.copy=function(e){this.pos.copy(e.pos),this.dir.copy(e.dir),this.up.copy(e.up),this.right.copy(e.right),this.dist=e.dist,this.widthScale=e.widthScale};var Nr=function(){this.array=[],this.count=0};Nr.prototype.set=function(e,t,i,r,n){if((e=e.slice(0)).length<2)return this.count=0,void console.warn("PathPointList: points length less than 2.");t=void 0!==t?t:.1,i=void 0!==i?i:10,(n=void 0!==n&&n)&&!e[0].equals(e[e.length-1])&&e.push((new THREE.Vector3).copy(e[0]));for(var o=0,a=e.length;o<a;o++)if(0===o)this._start(e[o],e[o+1],r);else if(o===a-1)if(n){this._corner(e[o],e[1],t,i,r);var s=this.array[0].dist;this.array[0].copy(this.array[this.count-1]),this.array[0].dist=s}else this._end(e[o]);else this._corner(e[o],e[o+1],t,i,r)},Nr.prototype.distance=function(){return 0==this.count?0:this.array[this.count-1].dist},Nr.prototype._start=function(e,t,i){this.count=0;var r=this._getByIndex(this.count);if(r.pos.copy(e),r.dir.subVectors(t,e),i)r.up.copy(i);else{var n=Number.MAX_VALUE,o=Math.abs(r.dir.x),a=Math.abs(r.dir.y),s=Math.abs(r.dir.z);o<n&&(n=o,r.up.set(1,0,0)),a<n&&(n=a,r.up.set(0,1,0)),s<n&&r.up.set(0,0,1)}r.right.crossVectors(r.dir,r.up).normalize(),r.up.crossVectors(r.right,r.dir).normalize(),r.dist=0,r.widthScale=1,r.dir.normalize(),this.count++};var Ur=new THREE.Vector3,Vr=new THREE.Vector3,zr=new THREE.Vector3,qr=new THREE.Matrix4,Wr=new THREE.QuadraticBezierCurve3;Nr.prototype._corner=function(e,t,i,r,n){if(0<i&&0<r){for(var o=this.array[this.count-1],a=this._getCornerBezierCurve(o.pos,e,t,i,Wr).getPoints(r),s=0;s<r;s+=1)this._hardCorner(a[s],a[s+1],n);a[r].equals(t)||this._hardCorner(a[r],t,n)}else this._hardCorner(e,t,n)},Nr.prototype._hardCorner=function(e,t,i){var r=this.array[this.count-1],n=this._getByIndex(this.count),o=Ur.subVectors(e,r.pos),a=Vr.subVectors(t,e),s=o.length();if(o.normalize(),a.normalize(),n.pos.copy(e),n.dir.addVectors(o,a),n.dir.normalize(),i)1===n.dir.dot(i)?n.right.crossVectors(a,i).normalize():n.right.crossVectors(n.dir,i).normalize(),n.up.crossVectors(n.right,n.dir).normalize();else{n.up.copy(r.up);var l=zr.crossVectors(r.dir,n.dir);if(l.length()>Number.EPSILON){l.normalize();var c=Math.acos(Math.min(Math.max(r.dir.dot(n.dir),-1),1));n.up.applyMatrix4(qr.makeRotationAxis(l,c))}n.right.crossVectors(n.dir,n.up).normalize()}n.dist=r.dist+s;var u=o.dot(a);n.widthScale=Math.min(1/Math.sqrt((1+u)/2),1.414213562373)||1,this.count++},Nr.prototype._end=function(e){var t=this.array[this.count-1],i=this._getByIndex(this.count);i.pos.copy(e),i.dir.subVectors(e,t.pos);var r=i.dir.length();i.dir.normalize(),i.up.copy(t.up);var n=Ur.crossVectors(t.dir,i.dir);if(n.length()>Number.EPSILON){n.normalize();var o=Math.acos(Math.min(Math.max(t.dir.dot(i.dir),-1),1));i.up.applyMatrix4(qr.makeRotationAxis(n,o))}i.right.crossVectors(i.dir,i.up).normalize(),i.dist=t.dist+r,i.widthScale=1,this.count++},Nr.prototype._getByIndex=function(e){return this.array[e]||(this.array[e]=new Ir),this.array[e]},Nr.prototype._getCornerBezierCurve=function(e,t,i,r,n){var o=Ur.subVectors(t,e),a=Vr.subVectors(i,t),s=o.length(),l=a.length();return o.normalize(),a.normalize(),r<s?n.v0.copy(t).sub(o.multiplyScalar(r)):n.v0.copy(e),n.v1.copy(t),r<l?n.v2.copy(t).add(a.multiplyScalar(r)):n.v2.copy(i),n};var Gr=function(){this._drawing=!1,this._includeDrawingPoint=!1,this._points=[],this._lastPoint=new THREE.Vector3,this._lastFixedPoint=new THREE.Vector3,this.fixRadius=.5,this.height=.1,this._cornerRadius=.2,this._cornerSplit=10,this._pathPointList=new Nr,this._dirty=!0,this.up=new THREE.Vector3(0,1,0)};Object.defineProperty(Gr.prototype,"cornerRadius",{set:function(e){this._cornerRadius=e,this._dirty=!0},get:function(){return this._cornerRadius}}),Object.defineProperty(Gr.prototype,"cornerSplit",{set:function(e){this._cornerSplit=e,this._dirty=!0},get:function(){return this._cornerSplit}}),Gr.prototype.getPoints=function(){if(this._includeDrawingPoint&&(this._points.pop(),this._includeDrawingPoint=!1),this._drawing&&0<this._points.length){var e=this._getLastFixedPoint();e&&(this._points.push(e),this._includeDrawingPoint=!0)}return this._points},Gr.prototype.getPathPointList=function(){return(this._drawing||this._dirty)&&(this._pathPointList.set(this.getPoints(),this._cornerRadius,this._cornerSplit,this.up),this._dirty=!1),this._pathPointList},Gr.prototype.update=function(e){this._lastPoint.copy(e),this._lastPoint.y+=this.height},Gr.prototype.confirm=function(){this._drawing=!0;var e=this._getLastFixedPoint();e&&(this._includeDrawingPoint&&(this._points.pop(),this._includeDrawingPoint=!1),this._points.push(e.clone())),this._dirty=!0},Gr.prototype.start=function(){this._drawing=!0,this._dirty=!0},Gr.prototype.stop=function(){this._drawing=!1,this._dirty=!0},Gr.prototype.clear=function(){this._drawing=!1,this._includeDrawingPoint=!1,this._points=[],this._dirty=!0};var Xr=new THREE.Vector3,Yr=new THREE.Vector3,Qr=new THREE.Vector3;Gr.prototype._getLastFixedPoint=function(){if(this._lastFixedPoint.copy(this._lastPoint),0<this._points.length){var e=this._includeDrawingPoint?this._points[this._points.length-2]:this._points[this._points.length-1];if(i=e,r=this._lastFixedPoint,Xr.copy(r).sub(i).length()<this.fixRadius&&(Xr.normalize().multiplyScalar(this.fixRadius),this._lastFixedPoint.copy(e).add(Xr)),this._includeDrawingPoint?2<this._points.length:1<this._points.length){var t=this._includeDrawingPoint?this._points[this._points.length-3]:this._points[this._points.length-2];if(Yr.subVectors(e,t),Qr.subVectors(this._lastFixedPoint,e),Yr.normalize(),Qr.normalize(),.99<Yr.multiplyScalar(-1).dot(Qr))return null}}var i,r;return this._lastFixedPoint};var Zr=function(e){THREE.BufferGeometry.call(this),e=e||3e3,this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(3*e),3).setDynamic(!0)),this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(3*e),3).setDynamic(!0)),this.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(2*e),2).setDynamic(!0)),this.drawRange.start=0,this.drawRange.count=0};Zr.prototype=Object.assign(Object.create(THREE.BufferGeometry.prototype),{constructor:Zr,update:function(e,t){t=t||{};var i=this._updateAttributes(e,t);this.drawRange.count=i},_resizeAttribute:function(e,t,i){for(;t.array.length<i;){var r=t.array.length;(t=t.clone()).setArray(new Float32Array(2*r)),this.addAttribute(e,t)}},_updateAttributes:function(e,t){var i=t.width||.1,r=void 0!==t.progress?t.progress:1,n=void 0===t.arrow||t.arrow,o=void 0!==t.side?t.side:"both",a=0,s=[],l=[],c=[],u=new THREE.Vector3,h=new THREE.Vector3;function p(e,t,i){e.dir;var r=e.up,n=e.right;"left"!==o?u.copy(n).multiplyScalar(t*e.widthScale):u.set(0,0,0),"right"!==o?h.copy(n).multiplyScalar(-t*e.widthScale):h.set(0,0,0),u.add(e.pos),h.add(e.pos),s.push(h.x,h.y,h.z,u.x,u.y,u.z),l.push(r.x,r.y,r.z,r.x,r.y,r.z),c.push(i,0,i,1),a+=2}var d=new THREE.Vector3,f=e.distance();if(0==f)return 0;var m,g,v,y,b,_,x,E=r*f;if(0<E)for(var w=0;w<e.count;w++){var T=e.array[w];if(T.dist>E){var S=e.array[w-1];m=new Ir;var M=(E-S.dist)/(T.dist-S.dist);m.lerpPathPoints(S,T,M),p(m,i/2,m.dist/("both"!==o?i/2:i));break}p(T,i/2,T.dist/("both"!==o?i/2:i))}else m=e.array[0];n&&(v=i/2,y=(g=m=m||e.array[e.count-1]).dist/("both"!==o?i/2:i),b=g.dir,_=g.up,x=g.right,"left"!==o?u.copy(x).multiplyScalar(2*v):u.set(0,0,0),"right"!==o?h.copy(x).multiplyScalar(2*-v):h.set(0,0,0),d.copy(b).setLength(3*v),u.add(g.pos),h.add(g.pos),d.add(g.pos),s.push(h.x,h.y,h.z,u.x,u.y,u.z,d.x,d.y,d.z),l.push(_.x,_.y,_.z,_.x,_.y,_.z,_.x,_.y,_.z),c.push(y,"both"!==o?"right"!==o?-2:0:-.5,y,"both"!==o?"left"!==o?2:0:1.5,y+3*v/("both"!==o?v:2*v),"both"!==o?0:.5),a+=3);var R=this.getAttribute("position"),P=this.getAttribute("normal"),A=this.getAttribute("uv");return this._resizeAttribute("position",R,s.length),this._resizeAttribute("normal",P,l.length),this._resizeAttribute("uv",A,c.length),R=this.getAttribute("position"),P=this.getAttribute("normal"),A=this.getAttribute("uv"),R.array.set(s,0),P.array.set(l,0),A.array.set(c,0),R.updateRange.count=s.length,P.updateRange.count=l.length,A.updateRange.count=c.length,R.needsUpdate=!0,P.needsUpdate=!0,A.needsUpdate=!0,a}});var Jr=function(e){Zr.call(this,e||1e3),this.setIndex(new Array(2*(e||1e3)))};Jr.prototype=Object.assign(Object.create(Zr.prototype),{constructor:Jr,_resizeIndex:function(e,t){for(;e.array.length<t;){var i=e.array.length;(e=e.clone()).setArray(65535<2*i?new Uint32Array(2*i):new Uint16Array(2*i)),this.setIndex(e)}},_updateAttributes:function(e,t){var i=t.radius||.1,r=t.radialSegments||8;r=Math.max(2,r);var n=void 0!==t.progress?t.progress:1,o=0,a=[],s=[],l=[],c=[],u=0,h=new THREE.Vector3;function p(e,t,i,r){for(var n=0===a.length,p=0;p<=i;p++){var d=p;d==i&&(d=0),h.copy(e.up).applyAxisAngle(e.dir,2*Math.PI*d/i).normalize(),a.push(e.pos.x+h.x*t*e.widthScale,e.pos.y+h.y*t*e.widthScale,e.pos.z+h.z*t*e.widthScale),s.push(h.x,h.y,h.z),l.push(r,p/i),u++}if(!n)for(var f=u-2*(i+1),m=u-(i+1),g=0;g<i;g++)c.push(m+g,f+g,f+g+1,m+g,f+g+1,m+g+1),o+=6}var d=n*e.distance();if(0==d)return 0;if(0<d)for(var f=0;f<e.count;f++){var m=e.array[f];if(m.dist>d){var g=e.array[f-1],v=new Ir,y=(d-g.dist)/(m.dist-g.dist);v.lerpPathPoints(g,m,y),p(v,i,r,v.dist/(2*i*Math.PI));break}p(m,i,r,m.dist/(2*i*Math.PI))}var b=this.getAttribute("position"),_=this.getAttribute("normal"),x=this.getAttribute("uv"),E=this.getIndex();return this._resizeAttribute("position",b,a.length),this._resizeAttribute("normal",_,s.length),this._resizeAttribute("uv",x,l.length),this._resizeIndex(E,c.length),b=this.getAttribute("position"),_=this.getAttribute("normal"),x=this.getAttribute("uv"),E=this.getIndex(),b.array.set(a,0),_.array.set(s,0),x.array.set(l,0),E.set(c,0),b.updateRange.count=a.length,_.updateRange.count=s.length,x.updateRange.count=l.length,E.updateRange.count=c.length,b.needsUpdate=!0,_.needsUpdate=!0,x.needsUpdate=!0,E.needsUpdate=!0,o}});var Kr=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));return n.arrowFlag=!0,n.side="both",n.pathGeometry=new Zr,n.pathPointList=new Nr,n}return o(t,e),t.prototype._updateByPoints=function(){e.prototype._updateByPoints.call(this),this.pathGeometry.update(this.pathPointList,{width:this.pathWidth,side:this.side,arrow:this.arrowFlag}),this.pathGeometry.computeBoundingSphere()},t.prototype.setup=function(t){var i=Te.parseValue(t.arrowFlag,t.arrowCap);this.arrowFlag=Te.parseValue(i,!0),e.prototype.setup.call(this,t)},n(t,[{key:"progress",set:function(e){this.pathGeometry.update(this.pathPointList,{width:this.pathWidth,arrow:this.arrowFlag,side:this.side,progress:j.clamp(e,0,1)})}},{key:"scorllUVRange",set:function(e){var t=this.length/this.pathWidth;this.uvRatio=t*e}},{key:"arrowCap",set:function(e){this.arrowFlag=e,this.pathGeometry.update(this.pathPointList,{width:this.pathWidth,arrow:this.arrowFlag,side:this.side})},get:function(){return this.arrowFlag}},{key:"isRouteLine",get:function(){return console.warn("[RouteLine] Please use 'instanceof THING.RouteLine' to replace '.RouteLine'"),this instanceof THING.RouteLine}}]),t}(Fr),$r=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));return n.pathWidth=.2,n.pathRadialSegments=8,n.pathGeometry=new Jr,n.pathPointList=new Nr,n.pathUp=void 0,n.pathMaterial=new THREE.MeshStandardMaterial({transparent:!0}),n}return o(t,e),t.prototype._setupPathLine=function(t){(t=t||{}).drawMode=THREE.TrianglesDrawMode,e.prototype._setupPathLine.call(this,t)},t.prototype._updateByPoints=function(){e.prototype._updateByPoints.call(this),this.pathGeometry.update(this.pathPointList,{radius:this.pathWidth,radialSegments:this.pathRadialSegments}),this.pathGeometry.computeBoundingSphere()},n(t,[{key:"progress",set:function(e){this.pathGeometry.update(this.pathPointList,{radius:this.pathWidth,radialSegments:this.pathRadialSegments,progress:j.clamp(e,0,1)})}},{key:"scorllUVRange",set:function(e){var t=this.length/(2*this.pathWidth*Math.PI);this.uvRatio=t*e}},{key:"isPolygonLine",get:function(){return console.warn("[PolygonLine] Please use 'instanceof THING.PolygonLine' to replace '.PolygonLine'"),this instanceof THING.PolygonLine}}]),t}(Fr),en=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));return n._pointSize=1,n._pointsMesh=null,n}return o(t,e),t.prototype._updateByPoints=function(){this.app.resourceManager.remove(this._pointsMesh);var e=(new THREE.BufferGeometry).setFromPoints(this._points),t=new THREE.PointsMaterial({size:this._pointSize,sizeAttenuation:!1});this._pointsMesh=new THREE.Points(e,t),this.node.add(this._pointsMesh)},t.prototype._beforeSetupComplete=function(e){this._pointSize=e.pointSize||this._pointSize;var t=e.points;t&&this.addPoints(t)},t}(Or),tn=function e(){r(this,e),this.strId="",this.fPPAfterImageValue=0,this.listGroups=new Array;var t=new rn;this.listGroups[0]=t,this._attr="ParticleData"};tn.prototype={getAttr:function(){return this._attr}};var rn=function e(){r(this,e),this.strId="",this.texture=new on,this.fFixedTimeStep=.33,this.strUseMesh="false",this.strMeshUrl="BuildIn/Box",this.arrayMeshParams=new Array,this.arrayMeshParams.push(1),this.arrayMeshParams.push(1),this.arrayMeshParams.push(1),this.arrayMeshParams.push(1),this.arrayMeshParams.push(1),this.arrayMeshParams.push(1),this.strHasPerspective="true",this.strIsColorize="true",this.iBlendingMode=1,this.strIsTransparent="true",this.fAlphaTest=0,this.strIsDepthWrite="false",this.strIsDepthTest="false",this.strIsFog="false",this.strEnableTrail="false",this.textureTrail=new on,this.fTrailLife=.5,this.fTrailWidthStart=1,this.fTrailWidthEnd=1,this.fScale=window.innerHeight/2,this.iMaxParticleCount=500,this.vec4Quaternion=new THREE.Vector4(0,0,0,1),this.listEmitters=new Array;var t=new nn;this.listEmitters[0]=t},nn=function e(){r(this,e),this.strId="",this.iDistribution=1,this.iParticleCount=100,this.fDuration=-1,this.strIsStatic="false",this.strIsLookAtCamera="false",this.strIsLookAtCameraOnlyY="false",this.fActiveMultiplier=1,this.iDirection=1,this.maxAge=new an,this.position=new sn,this.velocity=new ln,this.acceleration=new cn,this.drag=new un,this.wiggle=new hn,this.rotation=new dn,this.trail=new pn,this.listColor=new Array;var t=new fn;this.listColor[0]=t,this.listOpacity=new Array;var i=new mn;this.listOpacity[0]=i,this.listSize=new Array;var n=new gn;this.listSize[0]=n,this.listAngle=new Array;var o=new vn;this.listAngle[0]=o},on=function e(){r(this,e),this.name="32x32_star.png",this.url="http://static.3dmomoda.com/textures/18092617nyspq5moaka1i2fhvs1hh66s.png",this.vec2Frames=new THREE.Vector2(1,1),this.iFrameCount=1,this.iLoop=1},an=function e(){r(this,e),this.fValue=1,this.fSpread=1},sn=function e(){r(this,e),this.vec3Value=new THREE.Vector3(0,0,0),this.vec3Spread=new THREE.Vector3(0,0,0),this.vec3SpreadClamp=new THREE.Vector3(0,0,0),this.fRadius=0,this.vec3RadiusScale=new THREE.Vector3(1,1,1),this.iDistribution=1,this.strIsRandomise="false"},ln=function e(){r(this,e),this.vec3Value=new THREE.Vector3(0,10,0),this.vec3Spread=new THREE.Vector3(10,0,10),this.iDistribution=1,this.strIsRandomise="false"},cn=function e(){r(this,e),this.vec3Value=new THREE.Vector3(0,0,0),this.vec3Spread=new THREE.Vector3(0,0,0),this.iDistribution=1,this.strIsRandomise="false"},un=function e(){r(this,e),this.fValue=0,this.fSpread=0,this.strIsRandomise="false"},hn=function e(){r(this,e),this.fValue=0,this.fSpread=0},pn=function e(){r(this,e),this.fValue=0,this.fSpread=0,this.fStep=0,this.fStepSpread=0},dn=function e(){r(this,e),this.vec3Axis=new THREE.Vector3(0,0,0),this.vec3AxisSpread=new THREE.Vector3(0,0,0),this.fAngle=0,this.fAngleSpread=0,this.strIsStatic="false",this.vec3Center=new THREE.Vector3(0,0,0),this.strIsRandomise="false"},fn=function e(){r(this,e),this.vec3Value=new THREE.Vector3(1,1,1),this.vec3Spread=new THREE.Vector3(0,0,0),this.strIsRandomise="false"},mn=function e(){r(this,e),this.fValue=1,this.fSpread=0,this.strIsRandomise="false"},gn=function e(){r(this,e),this.fValue=1,this.fSpread=0,this.strIsRandomise="false"},vn=function e(){r(this,e),this.fValue=0,this.fSpread=0,this.strIsRandomise="false"},yn=function(){var e="[BufferGeometryHelper.js] : ";this.bEnableLog=!0,this.bufferGeometry=null,this.jsonLoader=new THREE.BufferGeometryLoader,this.objLoader=new THREE.OBJLoader,this.strMeshUrl=null;var t=this;this.init=function(r,n){if(t.bEnableLog&&console.log(e+"[init];"),null!=n&&null!=n){if(null==r||null==r||"object"!=(void 0===r?"undefined":i(r)))return console.error(e+"[init] : options == null;"),void n(null);if(null==r.strMeshUrl||null==r.strMeshUrl||"string"!=typeof r.strMeshUrl)return console.error(e+"[init] : options.strMeshUrl == null;"),void n(null);if(t.strMeshUrl=r.strMeshUrl,null!=t.bufferGeometry&&null!=t.bufferGeometry&&(t.bufferGeometry.dispose(),t.bufferGeometry=null),0<=r.strMeshUrl.indexOf("BuildIn")){var o=!1;return 0<=r.strMeshUrl.indexOf("Box")&&(t.bEnableLog&&console.log(e+"[init] : it's a BoxBufferGeometry;"),o=!t.checkParams(r.params,3),t.bufferGeometry=o?new THREE.BoxBufferGeometry(1,1,1):new THREE.BoxBufferGeometry(r.params[0],r.params[1],r.params[2])),0<=r.strMeshUrl.indexOf("Cylinder")&&(t.bEnableLog&&console.log(e+"[init] : it's a CylinderBufferGeometry;"),o=!t.checkParams(r.params,4),t.bufferGeometry=o?new THREE.CylinderBufferGeometry(1,1,1,6):new THREE.CylinderBufferGeometry(r.params[0],r.params[1],r.params[2],r.params[3]<=12?r.params[3]:12)),0<=r.strMeshUrl.indexOf("Cone")&&(t.bEnableLog&&console.log(e+"[init] : it's a ConeBufferGeometry;"),o=!t.checkParams(r.params,3),t.bufferGeometry=o?new THREE.ConeBufferGeometry(1,1,6):new THREE.ConeBufferGeometry(r.params[0],r.params[1],r.params[2]<=12?r.params[2]:12)),0<=r.strMeshUrl.indexOf("Circle")&&(t.bEnableLog&&console.log(e+"[init] : it's a CircleBufferGeometry;"),o=!t.checkParams(r.params,2),t.bufferGeometry=o?new THREE.CircleBufferGeometry(1,6):new THREE.CircleBufferGeometry(r.params[0],r.params[1]<=12?r.params[1]:12)),0<=r.strMeshUrl.indexOf("Dodecahedron")&&(t.bEnableLog&&console.log(e+"[init] : it's a DodecahedronBufferGeometry;"),o=!t.checkParams(r.params,2),t.bufferGeometry=o?new THREE.DodecahedronBufferGeometry(1,0):new THREE.DodecahedronBufferGeometry(r.params[0],r.params[1]<=1?r.params[1]:1)),0<=r.strMeshUrl.indexOf("Icosahedron")&&(t.bEnableLog&&console.log(e+"[init] : it's a IcosahedronBufferGeometry;"),o=!t.checkParams(r.params,2),t.bufferGeometry=o?new THREE.IcosahedronBufferGeometry(1,0):new THREE.IcosahedronBufferGeometry(r.params[0],r.params[1]<=1?r.params[1]:1)),0<=r.strMeshUrl.indexOf("Octahedron")&&(t.bEnableLog&&console.log(e+"[init] : it's a OctahedronBufferGeometry;"),o=!t.checkParams(r.params,2),t.bufferGeometry=o?new THREE.OctahedronBufferGeometry(1,0):new THREE.OctahedronBufferGeometry(r.params[0],r.params[1]<=2?r.params[1]:1)),0<=r.strMeshUrl.indexOf("Plane")&&(t.bEnableLog&&console.log(e+"[init] : it's a PlaneBufferGeometry;"),o=!t.checkParams(r.params,2),t.bufferGeometry=o?new THREE.PlaneBufferGeometry(1,0):new THREE.PlaneBufferGeometry(r.params[0],r.params[1])),0<=r.strMeshUrl.indexOf("Ring")&&(t.bEnableLog&&console.log(e+"[init] : it's a RingBufferGeometry;"),o=!t.checkParams(r.params,3),t.bufferGeometry=o?new THREE.RingBufferGeometry(1,2,12,1):new THREE.RingBufferGeometry(r.params[0],r.params[1],r.params[2]<=12?r.params[2]:12,1)),0<=r.strMeshUrl.indexOf("Sphere")&&(t.bEnableLog&&console.log(e+"[init] : it's a SphereBufferGeometry;"),o=!t.checkParams(r.params,3),t.bufferGeometry=o?new THREE.SphereBufferGeometry(1,8,8):new THREE.SphereBufferGeometry(r.params[0],r.params[1]<=12?r.params[1]:12,r.params[2]<=12?r.params[2]:12)),0<=r.strMeshUrl.indexOf("Tetrahedron")&&(t.bEnableLog&&console.log(e+"[init] : it's a TetrahedronBufferGeometry;"),o=!t.checkParams(r.params,2),t.bufferGeometry=o?new THREE.TetrahedronBufferGeometry(1,0):new THREE.TetrahedronBufferGeometry(r.params[0],r.params[1]<=2?r.params[1]:2)),0<=r.strMeshUrl.indexOf("Torus")&&r.strMeshUrl.indexOf("TorusKnot")<0&&(t.bEnableLog&&console.log(e+"[init] : it's a TorusBufferGeometry;"),o=!t.checkParams(r.params,4),t.bufferGeometry=o?new THREE.TorusBufferGeometry(1,1,8,8):new THREE.TorusBufferGeometry(r.params[0],r.params[1],r.params[2]<=12?r.params[2]:12,r.params[3]<=12?r.params[3]:12)),0<=r.strMeshUrl.indexOf("TorusKnot")&&(t.bEnableLog&&console.log(e+"[init] : it's a TorusKnotBufferGeometry;"),o=!t.checkParams(r.params,6),t.bufferGeometry=o?new THREE.TorusKnotBufferGeometry(1,1,32,8,2,3):new THREE.TorusKnotBufferGeometry(r.params[0],r.params[1],r.params[2]<=32?r.params[2]:32,r.params[3]<=12?r.params[3]:12,r.params[4]<=12?r.params[4]:12,r.params[5]<=12?r.params[5]:12)),void n(t.bufferGeometry)}var a=r.strMeshUrl.indexOf(".json");0<=a&&a+".json".length==r.strMeshUrl.length&&(t.bEnableLog&&console.log(e+"[init] : it's a .json file to BufferGeometry;"),t.jsonLoader.load(Globals.strParticleMeshRootPath+r.strMeshUrl,function(i){return null!=i&&null!=i?(t.bufferGeometry=i,void n(t.bufferGeometry)):(console.error(e+"[init] : failed load the .json file to BufferGeometry; strMeshUrl = "+r.strMeshUrl),void n(null))}));var s=r.strMeshUrl.indexOf(".obj");0<=s&&s+".obj".length==r.strMeshUrl.length&&(t.bEnableLog&&console.log(e+"[init] : it's a .obj file to BufferGeometry;"),t.objLoader.load(Globals.strParticleMeshRootPath+r.strMeshUrl,function(i){if(null!=i&&null!=i&&null!=i.children){for(var o=null,a=0,s=i.children.length;a<s;a++)if(i.children[a]instanceof THREE.Mesh){o=i.children[a];break}if(null==o)return console.error(e+"[init] : failed load the .obj file to BufferGeometry; can not find a mesh; strMeshUrl = "+r.strMeshUrl),void n(null);var l=(new THREE.BufferGeometry).fromGeometry(o.geometry);return null!=l&&null!=l?(t.bufferGeometry=l,void n(t.bufferGeometry)):(console.error(e+"[init] : failed transform the .obj file to BufferGeometry; strMeshUrl = "+r.strMeshUrl),void n(null))}},function(e){},function(t){console.error(e+"[init] : failed load the .obj file to BufferGeometry; strMeshUrl = "+r.strMeshUrl+"; error = "+t),n(null)}))}else console.error(e+"[init] : onFinished == null;")},this.checkParams=function(t,r){if(null==t||null==t||"object"!=(void 0===t?"undefined":i(t)))return console.warn(e+"[checkParams] : params == null;"),!1;if(t.length<r)return console.warn(e+"[checkParams] : params.length < "+r),!1;for(var n=0;n<r;n++)if(null==t[n]||null==t[n]||"number"!=typeof t[n])return console.warn(e+"[checkParams] : error params["+n+"];"),!1;return!0}},bn=function(){function e(t,i,n){r(this,e),this._options=t,this._emitter=i,this._particleGroup=n,this._emitter||this.refresh()}return e.prototype.cloneOptions=function(){return Te.cloneObject(this._options,!1,null,function(e,t){if(Te.isFunction(e.clone))return e.clone()})},e.prototype.refresh=function(){this._emitter&&(this._particleGroup._group.removeEmitter(this._emitter),this._emitter=null);var e=this.cloneOptions();this._particleGroup._options.useMesh?this._emitter=new MSPE.Emitter(e):this._emitter=new SPE.Emitter(e),this._particleGroup._group.addEmitter(this._emitter)},n(e,[{key:"options",set:function(e){e&&(Te.mergeObject(this._options,e,!0),this.refresh())},get:function(){return this._options}}]),e}(),_n=function(){function e(t,i,n){r(this,e),this._options=t,this._group=i,this._particleSystem=n,this._emitters=[],this._group||this.refresh()}return e.prototype.cloneOptions=function(){var e=Te.cloneObject(this._options,!1,function(e){return"texture"!=e&&"bufferGeometry"!=e},function(e,t){if(Te.isFunction(e.clone))return e.clone()}),t=this._options.vec4Quaternion;return t&&(e.vec4Quaternion=t.clone()),e},e.prototype.refresh=function(){-1===this._particleSystem._groups.indexOf(this)&&this._particleSystem._groups.push(this),this._group&&this._group.mesh&&this._particleSystem.node.remove(this._group.mesh);for(var e=0;e<this._emitters.length;e++){var t=this._emitters[e];this._group.removeEmitter(t._emitter)}var i=this.cloneOptions();for(i.useMesh?this._group=new MSPE.Group(i):this._group=new SPE.Group(i),e=0;e<this._emitters.length;e++){var r=this._emitters[e],n=r.cloneOptions();for(var o in this._particleSystem._particleOptions){var a=this._particleSystem._particleOptions[o];Te.isNull(a)||(n[o]=a)}i.useMesh?r._emitter=new MSPE.Emitter(n):r._emitter=new SPE.Emitter(n),this._group.addEmitter(r._emitter)}var s=this._group.mesh;s&&(this._particleSystem.node.add(s),s.setFrustumCulled(!1))},e.prototype.tick=function(e,t){this._group.tick(e,t)},e.prototype.addEmitter=function(e){return new bn(e,null,this)},e.prototype.removeEmitter=function(e){for(var t=0;t<this._emitters.length;t++)if(e==this._emitters[t]){this._emitters.splice(t,1),this._group.removeEmitter(e._emitter);break}},n(e,[{key:"options",set:function(e){e&&(Te.mergeObject(this._options,e,!0),this.refresh())},get:function(){return this._options}}]),e}(),xn=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));return n._groups=[],n._particleOptions={},n._groupOptions={},n}return o(t,e),t.prototype.loadFromURL=function(e,t){var i=this;e.node||(e.node=new THREE.Group);var r=e.url,n=this.app.particleResource.get(r);n?this.loadComplete(n,e,t):this.app.particleResource.download(r,function(r){i.loadComplete(r,e,t)})},t.prototype.loadComplete=function(e,t,i){this.setupParticleData(e,t),this.setupUserData(t),null!=i&&i()},t.prototype.customSetup=function(e){this.tickable=!0},t.prototype.update=function(e){for(var t=0;t<this._groups.length;t++)this._groups[t].tick(e,this.app.renderCamera);return!0},t.prototype.parseEmitterOptions=function(e,t){var i,r=new THREE.Vector3(e.position.vec3Value.x,e.position.vec3Value.y,e.position.vec3Value.z),n=new THREE.Vector3(e.position.vec3Spread.x,e.position.vec3Spread.y,e.position.vec3Spread.z),o=new THREE.Vector3(e.position.vec3SpreadClamp.x,e.position.vec3SpreadClamp.y,e.position.vec3SpreadClamp.z);i="true"==e.position.strIsRandomise.valueOf();var a=new THREE.Vector3(e.velocity.vec3Value.x,e.velocity.vec3Value.y,e.velocity.vec3Value.z),s=new THREE.Vector3(e.velocity.vec3Spread.x,e.velocity.vec3Spread.y,e.velocity.vec3Spread.z);e.velocity.strIsRandomise.valueOf();var l,c=new THREE.Vector3(e.acceleration.vec3Value.x,e.acceleration.vec3Value.y,e.acceleration.vec3Value.z),u=new THREE.Vector3(e.acceleration.vec3Spread.x,e.acceleration.vec3Spread.y,e.acceleration.vec3Spread.z);l="true"==e.acceleration.strIsRandomise.valueOf();var h;h="true"==e.strIsStatic.valueOf();var p,d=new THREE.Vector3(e.rotation.vec3Axis.x,e.rotation.vec3Axis.y,e.rotation.vec3Axis.z),f=new THREE.Vector3(e.rotation.vec3AxisSpread.x,e.rotation.vec3AxisSpread.y,e.rotation.vec3AxisSpread.z),m=new THREE.Vector3(e.rotation.vec3Center.x,e.rotation.vec3Center.y,e.rotation.vec3Center.z);p="true"==e.rotation.strIsStatic.valueOf();var g;g="true"==e.rotation.strIsRandomise.valueOf();var v=new Array,y=new Array,b=new Array;if(0<e.listColor.length)for(var _=0,x=e.listColor.length;_<x;_++)v.push(new THREE.Color(e.listColor[_].vec3Value.x,e.listColor[_].vec3Value.y,e.listColor[_].vec3Value.z)),y.push(new THREE.Vector3(e.listColor[_].vec3Spread.x,e.listColor[_].vec3Spread.y,e.listColor[_].vec3Spread.z)),"true"==e.listColor[_].strIsRandomise.valueOf()?b.push(!0):b.push(!1);else v.push(new THREE.Color("white")),y.push(new THREE.Vector3(0,0,0)),b.push(!1);var E=new Array,w=new Array,T=new Array;if(0<e.listOpacity.length)for(_=0,x=e.listOpacity.length;_<x;_++)E.push(e.listOpacity[_].fValue),w.push(e.listOpacity[_].fSpread),"true"==e.listOpacity[_].strIsRandomise.valueOf()?T.push(!0):T.push(!1);else E.push(1),w.push(0),T.push(!1);var S=new Array,M=new Array,R=new Array;if(0<e.listSize.length)for(_=0,x=e.listSize.length;_<x;_++)S.push(e.listSize[_].fValue),M.push(e.listSize[_].fSpread),"true"==e.listSize[_].strIsRandomise.valueOf()?R.push(!0):R.push(!1);else S.push(1),M.push(0),R.push(!1);var P=new Array,A=new Array,C=new Array;if(0<e.listAngle.length)for(_=0,x=e.listAngle.length;_<x;_++)P.push(e.listAngle[_].fValue),A.push(e.listAngle[_].fSpread),"true"==e.listAngle[_].strIsRandomise.valueOf()?R.push(!0):C.push(!1);else P.push(0),A.push(0),C.push(!1);var O={type:e.iDistribution,particleCount:e.iParticleCount,duration:e.fDuration<=0?void 0:e.fDuration,isStatic:h,isLookAtCamera:"true"==e.strIsLookAtCamera,isLookAtCameraOnlyY:"true"==e.strIsLookAtCameraOnlyY,activeMultiplier:e.fActiveMultiplier,direction:e.iDirection,maxAge:{value:e.maxAge.fValue,spread:e.maxAge.fSpread},position:{value:r,spread:n,spreadClamp:o,radius:e.position.fRadius,radiusScale:new THREE.Vector3(1,1,1),randomise:i},radius:{value:5,spread:0,scale:new THREE.Vector3(1,1,1),spreadClamp:new THREE.Vector3(2,2,2)},velocity:{value:a,spread:s,randomise:!1},acceleration:{value:c,spread:u,randomise:l},drag:{value:e.drag.fValue,spread:e.drag.fSpread},wiggle:{value:e.wiggle.fValue,spread:e.wiggle.fSpread},rotation:{axis:d,axisSpread:f,angle:e.rotation.fAngle,angleSpread:e.rotation.fAngleSpread,static:p,center:m,randomise:g},color:{value:v,spread:y,randomise:b},opacity:{value:E,spread:w,randomise:T},size:{value:S,spread:M,randomise:R},angle:{value:P,spread:A,randomise:C}},L=this.app.renderer.capabilities.maxVaryings;for(var k in 15<L&&(O.trail={value:e.trail.fValue,spread:e.trail.fSpread,step:e.trail.fStep,stepSpread:e.trail.fStepSpread}),this._particleOptions){var H=this._particleOptions[k];Te.isNull(H)||(O[k]=H)}return O},t.prototype.parseGroupOptions=function(e,t){var i=this.app.calcRect(),r={texture:{value:t,frames:e.texture.vec2Frames,frameCount:e.texture.iFrameCount,loop:e.texture.iLoop},fixedTimeStep:e.fFixedTimeStep,hasPerspective:"true"==e.strHasPerspective,colorize:"true"==e.strIsColorize,blending:e.iBlendingMode,transparent:"true"==e.strIsTransparent,alphaTest:e.fAlphaTest,depthWrite:"true"==e.strIsDepthWrite,depthTest:"true"==e.strIsDepthTest,fog:"true"==e.strIsFog,scale:i.height/2,maxParticleCount:e.iMaxParticleCount,useMesh:"true"==e.strUseMesh},n=e.vec4Quaternion;for(var o in n&&(r.vec4Quaternion=new THREE.Quaternion(n.x,n.y,n.z,n.w)),this._groupOptions){var a=this._groupOptions[o];Te.isNull(a)||(r[o]=a)}return r},t.prototype.setupParticleEmitter=function(e,t,i){var r=this.parseEmitterOptions(e,t),n=new bn(r,null,i);i._emitters.push(n)},t.prototype.setupParticleEmitters=function(e,t){for(var i=0;i<e.listEmitters.length;i++){var r=e.listEmitters[i];this.setupParticleEmitter(r,e,t)}this.static&&this.node._synMatrixWorld()},t.prototype.createParticleGroup=function(e){return new _n(e,null,this)},t.prototype.setupParticleGroup=function(e){var t=this,i=new THREE.TextureLoader;i.setCrossOrigin("anonymous");var r=e.texture.url;i.load(r,function(i){var r=t.parseGroupOptions(e,i);if(r.useMesh){var n=new yn;n.bEnableLog=!1,n.init({strMeshUrl:e.strMeshUrl,params:e.arrayMeshParams},function(i){r.bufferGeometry=i;var n=t.createParticleGroup(r);t.setupParticleEmitters(e,n)})}else{var o=t.createParticleGroup(r);t.setupParticleEmitters(e,o)}})},t.prototype.setupParticleData=function(e,t){var i=new tn;(i=e).__proto__=tn.prototype;for(var r=0;r<i.listGroups.length;r++){var n=i.listGroups[r];this.setupParticleGroup(n)}},t.prototype.refresh=function(){for(var e=0;e<this._groups.length;e++)this._groups[e].refresh()},t.prototype.setParticleAttribute=function(e,t){this._particleOptions[e]=t,this.refresh()},t.prototype.setGroupAttribute=function(e,t){this._groupOptions[e]=t,this.refresh()},n(t,[{key:"gravityPosition",set:function(e){var t=Te.parseVector3(e),i=Te.parseVector3(this.position),r=new THREE.Vector3;r.subVectors(t,i).normalize();var n=new THREE.Quaternion;n.setFromUnitVectors(new THREE.Vector3(0,-1,0),r);for(var o=0;o<this._groups.length;o++){var a=this._groups[o];a.options.vec4Quaternion=new THREE.Vector4(n.x,n.y,n.z,n.w),a.refresh()}}}]),t}(Ye),En=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));return n._scale=4,n._color="#FFFFFF",n._flowDirection=new THREE.Vector2(1,1),n._textureWidth=1024,n._textureHeight=1024,n._normalMaps=[],n._normalMapsURL=[],n.water=null,n}return o(t,e),t.prototype._updateByPoints=function(){if(this._points.length){var e=this._createPolygonVertices(!0),t=this._createPolygonGeometry(e.vertices,e.faces),i=0;if(e.vertices.length){for(var r=0;r<e.vertices.length;r++)i+=e.vertices[r].z;i/=e.vertices.length}this.app.resourceManager.remove(this.water),this.water=new THREE.Water(t,{color:this._color,scale:this._scale,flowDirection:this._flowDirection,textureWidth:this._textureWidth,textureHeight:this._textureHeight,normalMap0:this._normalMaps[0],normalMap1:this._normalMaps[1]}),this.water.position.y=i,this.water.scale.y*=-1,this.water.rotation.x=-.5*Math.PI,this.node.add(this.water)}},t.prototype._setupTextures=function(e){for(var t=new THREE.TextureLoader,i=[e.normalMap0||"images/water/Water_1_M_Normal.jpg",e.normalMap1||"images/water/Water_2_M_Normal.jpg"],r=0;r<i.length;r++){var n=i[r];n&&(this._normalMapsURL.push(n),this._normalMaps.push(t.load(this.app.confirmURL(n))))}this._textureWidth=1024,this._textureHeight=1024},t.prototype.customSetup=function(t){e.prototype.customSetup.call(this,t),this._scale=Te.parseValue(t.waterScale,4),this._color=Te.parseColor(t.waterColor,"#FFFFFF"),this._flowDirection=Te.parseVector2(t.flowDirection,new THREE.Vector2(1,1)),this._setupTextures(t);var i=t.points;i&&this.addPoints(i)},t.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);t.waterScale=this._scale,t.waterColor=this._color,t.flowDirection=this._flowDirection,t.points=this.points;for(var i=0;i<this._normalMapsURL.length;i++)t["normalMap"+i]=this._normalMapsURL[i];return t},t.prototype.setEffect=function(e){console.warn("[Water] Please use '.style.setEffect()' to replace '.setEffect()'"),this.style.setEffect(e)},n(t,[{key:"isWater",get:function(){return console.warn("[Water] Please use 'instanceof THING.Water' to replace '.Water'"),!0}}]),t}(Or),wn=new THREE.Vector3,Tn=new THREE.Vector3,Sn=new THREE.Matrix4,Mn=new THREE.Raycaster,Rn=function(e){function t(i){r(this,t);var n=a(this,e.call(this));return n.geometry.addAttribute("position",new THREE.Float32BufferAttribute(new Array(24).fill(0),3)),n.geometry.addAttribute("color",new THREE.Float32BufferAttribute(new Array(24).fill(1),3)),n._camera=i,n}return o(t,e),t.prototype.update=function(e,t){var i=this;e.forEach(function(e,r){wn.set(e.x,e.y,1).applyMatrix4(Sn.getInverse(i._camera.projectionMatrix)),wn.setLength(Math.min(wn.length(),t[r])),i.geometry.getAttribute("position").setXYZ(2*r+1,wn.x,wn.y,wn.z)}),this.geometry.getAttribute("position").needsUpdate=!0,this.geometry.computeBoundingBox(),this.geometry.computeBoundingSphere()},t}(THREE.LineSegments),Pn=function(e){function t(i,n){r(this,t);var o=new THREE.BufferGeometry,s=new THREE.MeshBasicMaterial({color:61183,opacity:.1,transparent:!0,side:THREE.DoubleSide}),l=a(this,e.call(this,o,s));o.addAttribute("position",new THREE.Float32BufferAttribute(new Array(3*n).fill(0),3));for(var c=[],u=0;u<n-2;u++)c.push(0,u+1,u+2);return o.setIndex(c),l._camera=i,l}return o(t,e),t.prototype.update=function(e,t){var i=this;e.forEach(function(e,r){wn.set(e.x,e.y,1).applyMatrix4(Sn.getInverse(i._camera.projectionMatrix)),wn.setLength(Math.min(wn.length(),t[r])),i.geometry.getAttribute("position").setXYZ(r+1,wn.x,wn.y,wn.z)}),this.geometry.getAttribute("position").needsUpdate=!0,this.geometry.computeBoundingBox(),this.geometry.computeBoundingSphere()},t}(THREE.Mesh),An=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));return n.tickable=!0,n._camera=new THREE.PerspectiveCamera(30,16/9,1,20),n._camera.matrixAutoUpdate=!1,n._cameraFrustum=new THREE.Frustum,n._cameraHelper=new THREE.CameraHelper(n._camera),n._cameraHelper.visible=!1,n._cameraHelper.matrix=new THREE.Matrix4,n._outMesh=new Rn(n._camera),n._outMesh.material.color.setHex(16777215),n._outMesh.visible=!1,n._horizontalScanningNum=15,n._verticalScanningNum=20,n._innerPlanes=[],n.node.add(n._cameraHelper),n.node.add(n._outMesh),n._innerScanning=!1,n._innerCounter=0,n._scanning=!1,n._scanningObject=null,n}return o(t,e),t.prototype._updateCameraMatrixAndFrustum=function(){var e=this._camera;e.matrixWorld.copy(this.node.matrixWorld),e.matrixWorldInverse.getInverse(this.node.matrixWorld),Sn.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._cameraFrustum.setFromMatrix(Sn)},t.prototype.customSetup=function(e){void 0!==e.fov&&(this._camera.fov=e.fov),void 0!==e.aspect&&(this._camera.aspect=e.aspect),void 0!==e.near&&(this._camera.near=e.near),void 0!==e.far&&(this._camera.far=e.far),void 0!==e.debug&&(this._cameraHelper.visible=e.debug),void 0!==e.outerColor&&this._outMesh.material.color.set(Te.parseColor(e.outerColor)),void 0!==e.innerScanning&&(this._innerScanning=!!e.innerScanning),void 0!==e.scanningNum&&(this._horizontalScanningNum=e.scanningNum[0],this._verticalScanningNum=e.scanningNum[1]),this._camera.updateProjectionMatrix(),this.node.updateMatrixWorld(!0),this._updateCameraMatrixAndFrustum()},t.prototype.update=function(t){return e.prototype.update.call(this,t),this.visible&&(this._updateCameraMatrixAndFrustum(),this._cameraHelper.visible&&this._cameraHelper.update(),this._scanning&&(this._innerCounter>this._verticalScanningNum?(this._scanning=!1,this._innerCounter=0,this._scanningObject=null):(this._updateInnerPlane(this._innerCounter,this._scanningObject),this._innerCounter++))),!0},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.stop()},t.prototype.start=function(e){var t=this;(!(1<arguments.length&&void 0!==arguments[1])||arguments[1])&&(this.node.updateMatrixWorld(!0),this._updateCameraMatrixAndFrustum());var i=[new THREE.Vector2(-1,1),new THREE.Vector2(-1,-1),new THREE.Vector2(1,-1),new THREE.Vector2(1,1)],r=i.map(function(i){Mn.setFromCamera(i,t._camera);var r=Mn.intersectObjects(e.getNodes(),!0);return r[0]?r[0].distance:1/0});return this._outMesh.update(i,r),this._outMesh.visible=!0,this._innerScanning&&(this._innerCounter=0,this._scanning=!0,this._scanningObject=e||this.app.query(".Ground")),r},t.prototype.pause=function(){this._scanning&&(this._scanning=!1,this._innerCounter=0,this._scanningObject=null)},t.prototype.stop=function(){this._outMesh.visible=!1;for(var e=0;e<=this._verticalScanningNum;e++)this._innerPlanes[e]&&(this._innerPlanes[e].visible=!1);this._scanning=!1,this._innerCounter=0,this._scanningObject=null},t.prototype._updateInnerPlane=function(e,t){for(var i=this,r=2*e/this._verticalScanningNum-1,n=[],o=0;o<=this._horizontalScanningNum;o++){var a=2*o/this._horizontalScanningNum-1;n.push(new THREE.Vector2(a,r))}var s=n.map(function(e){Mn.setFromCamera(e,i._camera);var r=Mn.intersectObjects(t.getNodes(),!0);return r[0]?r[0].distance:1/0});this._innerPlanes[e]||(this._innerPlanes[e]=new Pn(this._camera,this._horizontalScanningNum+2),this.node.add(this._innerPlanes[e]),this._innerPlanes[e].visible=!1),this._innerPlanes[e].update(n,s),this._innerPlanes[e].visible=!0},t.prototype.test=function(e){var t=this,i=e.objects.filter(function(e){return t._cameraFrustum.intersectsBox(e.boundingBox.toBox())});return i.filter(function(e){var r=wn.setFromMatrixPosition(t._camera.matrixWorld),n=e.boundingBox.toBox().getCenter(Tn);Mn.set(r,n.sub(r).normalize());var o=Mn.intersectObjects(i.map(function(e){return e.node}),!0);return!!(0<o.length&&o[0].object.isChildOf(e.node))})},t.prototype.testObject=function(e,i){var r=this,n=wn.setFromMatrixPosition(this._camera.matrixWorld),o=e.boundingBox.toBox().getCenter(Tn);Mn.set(n,o.sub(n).normalize());var a=i.objects.filter(function(e){return r._cameraFrustum.intersectsBox(e.boundingBox.toBox())}),s=Mn.intersectObjects(a.map(function(e){return e.node}),!0);return 0<s.length?s[0].object.isChildOf(e.node)?{state:t.VISIBLE,distance:s[0].distance,point:s[0].point}:{state:t.OBSCURED,distance:s[0].distance,point:s[0].point}:{state:t.OUT,distance:-1,point:null}},n(t,[{key:"fov",set:function(e){this._camera.fov=e,this._camera.updateProjectionMatrix(),this._updateCameraMatrixAndFrustum()},get:function(){return this._camera.fov}},{key:"aspect",set:function(e){this._camera.aspect=e,this._camera.updateProjectionMatrix(),this._updateCameraMatrixAndFrustum()},get:function(){return this._camera.aspect}},{key:"near",set:function(e){this._camera.near=e,this._camera.updateProjectionMatrix(),this._updateCameraMatrixAndFrustum()},get:function(){return this._camera.near}},{key:"far",set:function(e){this._camera.far=e,this._camera.updateProjectionMatrix(),this._updateCameraMatrixAndFrustum()},get:function(){return this._camera.far}}]),t}(Ye);An.OUT=0,An.VISIBLE=1;var Cn={showHelper:!(An.OBSCURED=2),ambientLight:{intensity:.45,color:16777215},hemisphereLight:{intensity:0,color:16777215,groundColor:2236962},mainLight:{shadow:!1,shadowQuality:"high",intensity:.5,color:16777215,alpha:30,beta:30},secondaryLight:{shadow:!1,shadowQuality:"high",intensity:0,color:16777215,alpha:138,beta:0},tertiaryLight:{shadow:!1,shadowQuality:"high",intensity:0,color:16777215,alpha:0,beta:0}},On={showHelper:!1,ambientLight:{intensity:0},hemisphereLight:{intensity:0},mainLight:{intensity:0},secondaryLight:{intensity:0},tertiaryLight:{intensity:0}},Ln=new THREE.Sphere,kn=new THREE.Vector3,Hn=new THREE.Vector3,jn=new THREE.Matrix4,Fn=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));return n.ambientLight=new THREE.AmbientLight,n.ambientLight.name="ambient_light",n.node.add(n.ambientLight),n.hemisphereLight=new THREE.HemisphereLight(16777215,2236962,1),n.hemisphereLight.name="hemisphere_light",n.node.add(n.hemisphereLight),n.mainLight=new THREE.DirectionalLight,n.mainLight.name="main_light",n.mainLight.helper=new THREE.DirectionalLightHelper(n.mainLight),n.mainLight.helper.matrix=n.mainLight.matrix,n.node.add(n.mainLight),n.node.add(n.mainLight.target),n.node.add(n.mainLight.helper),n.secondaryLight=new THREE.DirectionalLight,n.secondaryLight.name="secondary_light",n.secondaryLight.helper=new THREE.DirectionalLightHelper(n.secondaryLight),n.secondaryLight.helper.matrix=n.secondaryLight.matrix,n.node.add(n.secondaryLight),n.node.add(n.secondaryLight.target),n.node.add(n.secondaryLight.helper),n.tertiaryLight=new THREE.DirectionalLight,n.tertiaryLight.name="tertiary_light",n.tertiaryLight.helper=new THREE.DirectionalLightHelper(n.tertiaryLight),n.tertiaryLight.helper.matrix=n.tertiaryLight.matrix,n.node.add(n.tertiaryLight),n.node.add(n.tertiaryLight.target),n.node.add(n.tertiaryLight.helper),n._config=JSON.parse(JSON.stringify(Cn)),n}return o(t,e),t.prototype.customSetup=function(e){var t={};for(var i in Cn)e.hasOwnProperty(i)&&(t[i]=e[i]);this.setConfig(t),this.mainLight.helper.skipBoundingBox(!0),this.secondaryLight.helper.skipBoundingBox(!0),this.tertiaryLight.helper.skipBoundingBox(!0)},t.prototype.setConfig=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:JSON.parse(JSON.stringify(Cn)),t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.parent?this.parent.getLocalBoundingBox().toBox():this.app.root.getLocalBoundingBox().toBox();Te.mergeObject(this._config,e,!0);var i=this._config,r=t.getBoundingSphere(Ln);this.node.updateMatrixWorld(!0);var n=kn.set(0,1,0).transformDirection(this.node.matrixWorld).normalize();this.ambientLight.intensity=i.ambientLight.intensity,this.ambientLight.color.set(Te.parseColor(i.ambientLight.color)),this.hemisphereLight.intensity=i.hemisphereLight.intensity,this.hemisphereLight.color.set(Te.parseColor(i.hemisphereLight.color)),this.hemisphereLight.groundColor.set(Te.parseColor(i.hemisphereLight.groundColor)),this.hemisphereLight.position.copy(n),this.app.isMobileDevice&&(i.mainLight.castShadow=!1,i.secondaryLight.castShadow=!1,i.tertiaryLight.castShadow=!1),this._setDirectLight(this.mainLight,i.mainLight,r,i.showHelper,n),this._setDirectLight(this.secondaryLight,i.secondaryLight,r,i.showHelper,n),this._setDirectLight(this.tertiaryLight,i.tertiaryLight,r,i.showHelper,n),this.app.needUpdate=!0},t.prototype.getConfig=function(){return this._config},t.prototype._setDirectLight=function(e,t,i,r,n){if(e.intensity=t.intensity,e.visible=0<t.intensity,e.color.set(Te.parseColor(t.color)),e.position.copy(Te.parseVector3(j.directionFromAlphaBeta(t.alpha,t.beta))),e.position.normalize().multiplyScalar(i.radius||1).add(i.center),e.target.position.copy(i.center),e.helper.visible=e.visible&&r,e.helper.visible&&this._updateHelper(e),e.castShadow=t.shadow&&!this.app.isMobileDevice,e.castShadow){var o=e.shadow.camera;o.top=o.right=i.radius,o.bottom=o.left=-i.radius,o.near=.1,o.far=2*i.radius,o.updateProjectionMatrix(),o.up.copy(n);var a={low:512,medium:1024,high:2048,ultra:4096}[t.shadowQuality]||1024;e.shadow.bias=-.003,e.shadow.radius=.1,e.shadow.mapSize.set(a,a)}this.app.root.static&&e._synMatrixWorld()},t.prototype._updateHelper=function(e){var t=e.helper;void 0!==t.color?(t.lightPlane.material.color.set(t.color),t.targetLine.material.color.set(t.color)):(t.lightPlane.material.color.copy(t.light.color),t.targetLine.material.color.copy(t.light.color)),jn.lookAt(Hn.subVectors(e.target.position,e.position),new THREE.Vector3,new THREE.Vector3(0,1,0)),t.lightPlane.quaternion.setFromRotationMatrix(jn),t.targetLine.quaternion.setFromRotationMatrix(jn),t.targetLine.scale.z=Hn.length()},t.prototype._setVisible=function(e){if(this.needChangeVisible(e)){e&&this.node.ensureParentsVisible(e),this.node.ensureVisible(e),this.children.forEach(function(t){t.inheritVisible&&(t.visible=e)});for(var t=0;t<this._controls.length;t++){var i=this._controls[t].control;Te.isFunction(i.onVisible)&&i.onVisible(e)}this.app.needUpdate=!0}},t}(Ye),Dn=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));return n._lightAngle=30,n._penumbra=.5,n._spotLight=null,n._helper=null,n}return o(t,e),t.prototype.destroy=function(){this._helper&&this._helper.dispose(),e.prototype.destroy.call(this)},t.prototype._syn=function(){this._spotLight.angle=j.degToRad(this._lightAngle),this._spotLight.intensity=this.intensity,this._spotLight.penumbra=this.penumbra,this._spotLight.castShadow=this.castShadow,this._spotLight.distance=this.distance},t.prototype._afterSetupComplete=function(e){var t=e.centerNodeName;t&&(this.centerNodeName=t);var i=e.projectTexture;this._spotLight=i?new THREE.ProjectSpotLight:new THREE.SpotLight("#FFFFFF"),this._spotLight.position.set(0,0,0),this._spotLight.target.position.set(0,0,1),this.node.add(this._spotLight),this.node.add(this._spotLight.target),this._lightAngle=e.lightAngle||this._lightAngle,this._penumbra=e.penumbra||this._penumbra;var r=e.helper;r&&(this.helper=r),this._syn()},t.prototype.update=function(t){var i=e.prototype.update.call(this,t);return this._helper?(this._updateLightHelper(),!0):i},t.prototype._updateLightHelper=function(){var e=this._spotLight.distance?this._spotLight.distance:1e3,t=e*Math.tan(this._spotLight.angle);this._helper.cone.scale.set(t,t,e),this._helper.cone.material.color.copy(this._spotLight.color)},n(t,[{key:"lightColor",set:function(e){var t=Te.parseColor(e);t&&(this._spotLight.color=t)},get:function(){return this._spotLight.color.toHexString()}},{key:"lightAngle",set:function(e){this._lightAngle=e,this._syn()},get:function(){return this._lightAngle}},{key:"penumbra",set:function(e){this._penumbra=e,this._syn()},get:function(){return this._penumbra}},{key:"helper",set:function(e){e&&!this._helper?(this._helper=new THREE.SpotLightHelper(this._spotLight),this._helper.matrix=this._spotLight.matrix,this._helper.cone.quaternion.set(0,0,0,1),this.node.add(this._helper),this.tickable=!0):!e&&this._helper&&(this.node.remove(this._helper),this._helper.dispose(),this._helper=null)},get:function(){return!!this._helper}}]),t}(function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));return n._prevIntensity=1,n._intensity=1,n._castShadow=!1,n._distance=5,n._turnOn=!0,n}return o(t,e),t.prototype._syn=function(){},t.prototype.customSetup=function(e){this._intensity=e.intensity||1,this._castShadow=e.castShadow||!1,this._distance=e.distance||5},t.prototype.toJSON=function(){return e.prototype.toJSON.call(this)},n(t,[{key:"intensity",set:function(e){this._turnOn?this._intensity=e:this._prevIntensity=e,this._syn()},get:function(){return this._intensity}},{key:"castShadow",set:function(e){this._castShadow=e,this._syn()},get:function(){return this._castShadow}},{key:"distance",set:function(e){this._distance=e,this._syn()},get:function(){return this._distance}},{key:"turnOn",set:function(e){this._turnOn=e,this._intensity=e?this._prevIntensity:(this._prevIntensity=this._intensity,0),this._syn()},get:function(){return this._turnOn}}]),t}(Ye)),Bn=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));return n._image="",n._texture=null,n._width=10,n._scrollSpeed=0,n._resolution=new THREE.Vector2,n._updateResolutionFunc=n._updateResolution.bind(n),n._helpGeometry=new THREE.Geometry,n._helpGeometry.vertices=n._points,n._meshline=new THREE.MeshLine,n._material=null,n._uvTransformDirty=!0,n}return o(t,e),t.prototype._updateResolution=function(e){this._resolution.set(e.size[0],e.size[1])},t.prototype.customSetup=function(t){e.prototype.customSetup.call(this,t);var i=t.image;i&&(i.isTexture?(this._image=i.name,this._texture=i):(this._image=i,this._texture=(new THREE.TextureLoader).load(i,function(e){e.wrapS=e.wrapT=THREE.RepeatWrapping,e.anisotropy=16})));var r=t.points;r&&this.addPoints(r),this._width=t.width||this._width,this.uvRatio=t.uvRatio||1,this.scrollSpeed=t.scrollSpeed||this._scrollSpeed;var n=this.app.calcRect();this._resolution.set(n.width,n.height),this._material=new THREE.MeshLineMaterial({map:this._texture,useMap:!!this._texture,color:new THREE.Color(1,1,1),opacity:1,resolution:this._resolution,sizeAttenuation:!1,lineWidth:this._width,near:this.app.renderCamera.near,far:this.app.renderCamera.far,side:THREE.DoubleSide}),this._material.extensions.derivatives=!this.app.renderer.capabilities.isWebGL2,this.app.on("resize",this._updateResolutionFunc);var o=new THREE.Mesh(this._meshline.geometry,this._material);this.node.add(o)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.app.off("resize",this._updateResolutionFunc)},t.prototype.update=function(t){var i=e.prototype.update.call(this,t);if(this._texture){var r=this._texture;return 0!==this._scrollSpeed&&(r.offset.x+=this._scrollSpeed*t,this._uvTransformDirty=!0),this._uvTransformDirty&&(r.matrix.setUvTransform(r.offset.x,r.offset.y,r.repeat.x,r.repeat.y,r.rotation,r.center.x,r.center.y),this._material.uniforms.uvTransform.value.copy(r.matrix)),!0}return i},t.prototype._updateByPoints=function(){this._meshline.setGeometry(this._helpGeometry)},t.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);return t.image=this._image,t.scrollSpeed=this._scrollSpeed,t.points=this.points,t},n(t,[{key:"uvRatio",set:function(e){this._texture&&(this._texture.repeat.x=e,this._uvTransformDirty=!0)}},{key:"width",set:function(e){this._width=e,this._material&&(this._material.uniforms.lineWidth.value=e)},get:function(){return this._width}},{key:"scrollSpeed",set:function(e){this._scrollSpeed=j.clamp(e,-99,99)},get:function(){return this._scrollSpeed}}]),t}(Or),In=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));return n._height=10,n._geometry=new THREE.Geometry,n._material=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,transparent:!0}),n._scrollSpeed=[0,0],n}return o(t,e),t.prototype.setScroll=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;this._scrollSpeed=[e,t],this.tickable=!0},t.prototype.customSetup=function(t){e.prototype.customSetup.call(this,t),this._height=t.height||this._height;var i=t.points;i&&this.addPoints(i),this.color=t.color||16777215,this.scroll=t.scroll||!1;var r=new THREE.Mesh(this._geometry,this._material);this.node.add(r),t.image?(this._material.map=(new THREE.TextureLoader).load(t.image),this._material.map.wrapS=this._material.map.wrapT=THREE.RepeatWrapping):this._material.map=function(){for(var e=new Uint8Array(512),t=0;t<128;t++)e[4*t+0]=255,e[4*t+1]=255,e[4*t+2]=255,e[4*t+3]=255*(1-t/128);var i=new THREE.DataTexture(e,1,128,THREE.RGBAFormat);return i.needsUpdate=!0,i}()},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.app.off("resize",this._updateResolutionFunc)},t.prototype.update=function(t){var i=e.prototype.update.call(this,t);return 0!==this._scrollSpeed[0]||0!==this._scrollSpeed[1]?(this._material.map&&(this._material.map.offset.x+=this._scrollSpeed[0]*t,this._material.map.offset.y+=this._scrollSpeed[1]*t),!0):i},t.prototype._updateByPoints=function(){var e=this,t=[],i=[],r=[],n=[],o=void 0,a=void 0,s=new THREE.Vector3,l=0;this.points.forEach(function(r,n){o=(new THREE.Vector3).fromArray(r),(a=(new THREE.Vector3).fromArray(r)).y+=e._height,i.push(o,a),0<n&&(l+=o.distanceTo(s)),t.push(new THREE.Vector2(l/e._height,0),new THREE.Vector2(l/e._height,1)),s.copy(o)});for(var c=0;c<i.length-2;c+=2)r.push(new THREE.Face3(c+1,c+0,c+2)),r.push(new THREE.Face3(c+2,c+3,c+1)),n.push([t[c+1],t[c+0],t[c+2]]),n.push([t[c+2],t[c+3],t[c+1]]);this._geometry.vertices=i,this._geometry.faces=r,this._geometry.faceVertexUvs=[n],this._geometry.verticesNeedUpdate=!0,this._geometry.uvsNeedUpdate=!0,this._geometry.elementsNeedUpdate=!0,this._geometry.computeBoundingSphere(),this._geometry.computeFaceNormals()},t.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);return t.height=this._height,t.points=this.points,t},n(t,[{key:"height",set:function(e){this._height=e,this._updateByPoints()},get:function(){return this._height}},{key:"color",set:function(e){this._material.color.setHex(e)},get:function(){return this._material.color.getHex()}}]),t}(Or),Nn=function(){function e(t,i,n){r(this,e),this.object=null,this.useSpriteMaterial=t,this.node=i,this.domElement=n,this.cssObject=null}return e.prototype.onUpdate=function(e){var t=this.node,i=this.cssObject;t.updateMatrixWorld();var r=new THREE.Vector3,n=new THREE.Vector3,o=new THREE.Quaternion;t.matrixWorld.decompose(r,o,n),i.quaternion.copy(o),i.position.copy(r);var a=new THREE.Vector3;this.object._independentWorldScale?a=this.object._independentWorldScale.clone():this.object.node.getWorldScale(a);var s=t.userData.cssFactor||1;return this.cssObject.scale.copy(a),this.cssObject.scale.multiplyScalar(s/30),this.onVisible(this.object.node.ensureVisible()),!0},e.prototype.onAdd=function(e){this.object=e,this.useSpriteMaterial?this.cssObject=new THREE.CSS3DSprite(this.domElement):this.cssObject=new THREE.CSS3DObject(this.domElement),this.object.app.cssScene.add(this.cssObject),this.onUpdate(),this.object.tickable=!0},e.prototype.onRemove=function(){this.cssObject&&(this.object.app.cssScene.remove(this.cssObject),this.cssObject=null),this.object=null},e.prototype.onVisible=function(e){this.cssObject.visible=e;var t=this.domElement.style;e?"visible"!=t.visibility&&(t.visibility="visible"):"hidden"!=t.visibility&&(t.visibility="hidden")},e}(),Un=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));return n._line=null,n._lineOffset=[0,0,0],n._factor=.01,n._initialSize=[1,1],n._size=[1,1],n._useScaleMode=!1,n._plane=null,n._planeSprite=null,n._sprite=null,n._canvas=null,n._url="",n}return o(t,e),t.prototype.updateConnectionLine=function(){if(!this._line)return!1;if(!this.parent)return!1;var e=j.addVector(this._lineOffset,this.position),t=this._lineToObject?this._lineToObject.position:this._lineToPosition;return this._line.setPoint(0,e),this._line.setPoint(1,t),!0},t.prototype._setupMaterial=function(e){var t=e.canvas,i=e.image,r=e.url;t?this.setCanvas(t):i?this.setImage(i):r&&(this._url=r)},t.prototype._setupSprite=function(e){var t=this,i=e.element;if(i){var r=i.cloneNode(!0),n=Te.parseSize(e),o=Te.parseValue(e.useSpriteMaterial,!0),a=new THREE.MeshBasicMaterial({colorWrite:!1,depthWrite:!1,transparent:!1,side:THREE.DoubleSide});a._pickable=!0;var s=new THREE.PlaneGeometry(1,1);this._plane=new THREE.Mesh(s,a),this._plane.frustumCulled=!1,this._plane.renderOrder=1,this._plane.userData.domElement=r,this._plane.userData.skipOutline=!0,this._plane.userData.skipStyle=!0,this._plane.addBeforeRenderFunction("anchor",function(e,i,r){var n=this.userData.domElement,a=n.offsetWidth,s=n.offsetHeight;if(a&&s){var l=a/s,c=new THREE.Vector3;c.x=a/30*t._size[0],c.y=c.x/l,c.z=1;var u=new THREE.Matrix4;if(o&&(u.copy(r.matrixWorldInverse),u.transpose()),u.copyPosition(this.matrixWorld),t._independentWorldScale)u.scale(t._independentWorldScale);else{var h=new THREE.Vector3;this.getWorldScale(h),u.scale(h)}u.scale(c),o&&(u.elements[3]=0,u.elements[7]=0,u.elements[11]=0,u.elements[15]=1),this.matrixWorld.copy(u)}else console.warn("Marker must provide width and height with DOM element")}),this.node.add(this._plane);var l=new THREE.SpriteMaterial({colorWrite:!1,depthWrite:!1,transparent:!1});this._planeSprite=new THREE.Sprite(l),this._planeSprite.userData.cssFactor=n[0],this._planeSprite.userData.skipOutline=!0,this._planeSprite.userData.skipStyle=!0,this._planeSprite.userData.skipPick=!0,this.node.add(this._planeSprite),this.addControl(new Nn(o,this._planeSprite,r))}else{var c=void 0;e.loadTextureComplete=function(t){var i=t.material,r=i._userData.bindMarkers;r&&r.forEach(function(t){t.synSize(),t._callComplete(e),c&&c(t)}),i._userData={}};var u=this.app.spriteResource.getMaterial(e);if((l=u.material)._userData=l._userData||{},l._userData.bindMarkers=l._userData.bindMarkers||[],l._userData.bindMarkers.push(this),(o=l.isSpriteMaterial)?this._sprite=new THREE.Sprite(l):(s=new THREE.PlaneGeometry(this._size[0],this._size[1]),this._sprite=new THREE.Mesh(s,l)),u.needLoadTexture){var h=Te.parseValue(e.visible,!0);h&&(this._sprite.setLayerVisible(!1),c=function(e){setTimeout(function(){e._sprite.setLayerVisible(h)},10)})}this._sprite.renderOrder=1,this._sprite.userData.skipOutline=!0,this._setupMaterial(e),this.synSize(),this.node.add(this._sprite)}},t.prototype._setupLineNode=function(e){if(this._lineToPosition=e.lineToPosition,this._lineToObject=e.lineToObject,void 0!==this._lineToPosition||void 0!==this._lineToObject){var t=e.lineColor,i=this._lineToObject?this._lineToObject.position:this._lineToPosition;this._line=this.app.create({type:"Line",parent:this,points:[this.position,i],color:t,style:{lineOpacity:e.lineOpacity,lineDashSize:e.lineDashSize,lineGapSize:e.lineGapSize,lineWidth:e.lineWidth}}),this.tickable=!0}},t.prototype._setupLocalPosition=function(e){var t=this.parent;if(t){var i=(e.offset||e.localPosition||[0,0,0]).concat();if(!Te.parseValue(e.ignoreParentBoundingBox,!1)){var r=t.getBoundingBox(t.visible),n=this.worldToLocal(r.center);i[0]+=n[0],i[1]+=n[1]+r.size[1]/2,i[2]+=n[2]}var o=Te.parseValue(e.ignoreParentScale,!1);this.setLocalPosition(i,o)}},t.prototype.customSetup=function(e){this.setupTranslation(e),e.skipSetupTranslation=!0,this._setupSprite(e),this._setupLineNode(e),e.width&&e.height?this._useScaleMode=!1:this._useScaleMode=!0,this._factor=e.factor||this._factor,this._initialSize=Te.parseSize(e),this._size=this._initialSize.concat(),this.synSize()},t.prototype._afterSetupComplete=function(e){var t=e.alwaysOnTop;t&&(this.style.alwaysOnTop=t);var i=e.keepSize;i&&(this.keepSize=i)},t.prototype._callComplete=function(t){(this.image||this.canvas)&&e.prototype._callComplete.call(this,t)},t.prototype.destroy=function(){if(this._plane&&this._plane.removeBeforeRenderFunction("marker_element_plane"),this.app.spriteResource.unload(this.url),this._sprite){var t=this._sprite.material;if(t&&t._userData){var i=t._userData.bindMarkers;if(i){var r=i.indexOf(this);-1!==r&&i.splice(r,1)}this._sprite.material=null}}e.prototype.destroy.call(this)},t.prototype.update=function(t){return e.prototype.update.call(this,t)|this.updateConnectionLine()},t.prototype._getPivotValue=function(e){return new THREE.Vector3(e[0],e[1],0)},t.prototype.synSize=function(){if(this._sprite){if(this._useScaleMode){var e=this._sprite.material.map;if(e){var t=e.image;t&&(this._size[0]=this._factor*t.width*this._initialSize[0],this._size[1]=this._factor*t.height*this._initialSize[1])}}}else this._planeSprite&&(this._planeSprite.userData.cssFactor=this._size[0]);if(this._keepSize){var i=this.getControl("MarkerSizeAdjustmentControl");i&&(i.size=this._size)}else this._sprite&&(this._sprite.scale.set(this._size[0],this._size[1],1),this.synIndependentWorldScale());this.static&&this.node._synMatrixWorld()},t.prototype._getIndependentControlRenderNode=function(){return this._sprite?this._sprite:e.prototype._getIndependentControlRenderNode.call(this)},t.prototype.cloneSelf=function(e){return e.localPosition=this.localPosition,e.size=this.size,this.url?e.url=this.url:this.canvas?e.canvas=this.canvas.clone():this.image&&(e.image=this.image.clone()),this.app.create(e)},t.prototype.setCanvas=function(e){if(e&&this._sprite){this._url=null,this._canvas=e;var t=new THREE.Texture(e);t.needsUpdate=!0,this._sprite.material.map=t}},t.prototype.setUrl=function(e){if(e){this.url&&this.app.spriteResource.unload(this.url),this._canvas=null,this._url=e;var t=this,i={url:e,alwaysOnTop:this.style.alwaysOnTop,loadTextureComplete:function(e){t.synSize()},loadComplete:function(e){t.trigger("urlchange",{image:t.image})}},r=this.app.spriteResource.getMaterial(i);if(r){var n=r.material;this._sprite.material=n,this.synSize()}}},t.prototype.setImage=function(e){e&&(e.width&&e.height?(this._url=null,this._sprite.material.map=this.app.resourceManager.loadTexture(e),this.synSize()):console.error("[Marker] set image failed, please make sure image has width and height attribute"))},t.prototype._setScale=function(t){var i=j.scaleVector(t,[this._size[0],this._size[1],1]);e.prototype._setScale.call(this,i)},t.prototype._getScale=function(){return j.divideVector(e.prototype._getScale.call(this),[this._size[0],this._size[1],1])},t.prototype._updateKeepSize=function(t,i){e.prototype._updateKeepSize.call(this,t,this._sprite,this._size,60)&&this.synSize()},n(t,[{key:"isMarker",get:function(){return!0}},{key:"canvas",set:function(e){this._sprite.material=this._sprite.material.clone(),this.setCanvas(e)},get:function(){return this._canvas}},{key:"url",set:function(e){this._url!=e&&this.setUrl(e)},get:function(){return this._url}},{key:"image",set:function(e){this._sprite.material=this._sprite.material.clone(),this.setImage(e)},get:function(){var e=this._sprite;if(!e)return null;var t=e.material;if(!t)return null;var i=t.map;return i?i.image:null}},{key:"texture",set:function(e){e&&(e.isTexture?(this._sprite.material.map=e,this.synSize()):console.error("[Marker] set texture failed, please make sure provide THREE.Texture as value"))}},{key:"size",set:function(e){Te.isNumber(e)?(this._size[0]=e,this._size[1]=e):this._size=e,this._initialSize=this._size.concat(),this.synSize()},get:function(){return this._size}},{key:"width",set:function(e){this._initialSize[0]=e,this._size[0]=e,this.synSize()},get:function(){return this._size[0]}},{key:"height",set:function(e){this._initialSize[1]=e,this._size[1]=e,this.synSize()},get:function(){return this._size[1]}},{key:"factor",set:function(e){this._factor=e,this.synSize()},get:function(){return this._factor}},{key:"element",get:function(){return this._plane?this._plane.userData.domElement:null}},{key:"line",get:function(){return this._line}},{key:"lineOffset",set:function(e){var t=Te.parseValue(e,[0,0,0]);this._lineOffset=t.concat()},get:function(){return this._lineOffset.concat()}},{key:"domElement",get:function(){return console.warn("[Building] Please use '.element' to replace '.domElement'"),this.element}}]),t}(Ye),Vn=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));return n.mixerPlane=null,n.domWidth=0,n.domHeight=0,n}return o(t,e),t.prototype._setupFromElement=function(e){var t=e.domElement;if(t){var i=e.position||[0,0,0],r=Te.parseSize(e),n=Te.parseQuaternion(e.angles),o=e.domWidth||t.offsetWidth,a=e.domHeight||t.offsetHeight,s={};return o&&a&&(s.elementW=o,s.planeW=1,s.planeH=a/o),this.mixerPlane=new THREEx.HtmlMixer.Plane(this.app.webViewManager.mixerContext,t,s),this.mixerPlane.setDomElement(t),this.node=this.mixerPlane.object3d,this.node.scale.multiply(new THREE.Vector3(r[0],r[1],1)),this.node.position.x=i[0],this.node.position.y=i[1],this.node.position.z=i[2],n&&this.node.quaternion.copy(n),this.node.updateMatrix(),!0}return!1},t.prototype.setupFromURL=function(e){var t=e.url;if(t){var i=e.domWidth,r=e.domHeight;i=i||e.width?100*e.width:0,r=r||e.height?100*e.height:0,e.domWidth=e.domWidth||i,e.domHeight=e.domHeight||r,this.domWidth=e.domWidth,this.domHeight=e.domHeight,i=i?i+"px":"",r=r?r+"px":"";var n=document.createElement("iframe");n.src=t,n.style.border="none",n.style.width=i,n.style.height=r,e.domElement=n,this._setupFromElement(e)}this._setup(e)},t.prototype.setupFromDom=function(e){this._setupFromElement(e),this._setup(e)},n(t,[{key:"isWebView",get:function(){return!0}},{key:"url",set:function(e){var t=this.position,i=this.scale,r=this.angles,n=this.domWidth,o=this.domHeight;this.app.resourceManager.remove(this.node),this.setupFromURL({url:e,position:t,size:i,angles:r,domWidth:n,domHeight:o})},get:function(){if(!this.mixerPlane)return null;var e=this.mixerPlane.domElement;return e?e.src:null}},{key:"pickable",set:function(e){this.mixerPlane.domElement.style.pointerEvents=e?"":"none"},get:function(){return""==this.mixerPlane.domElement.style.pointerEvents}}]),t}(Ye),zn=new THREE.Color,qn=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));return n._config={turbidity:10,rayleigh:2,luminance:1,mieCoefficient:.005,mieDirectionalG:.95,time:9,beta:45,light:!0,lightHelper:!1},n._skyNode=new Wn,n._skyNode.name="sky",n._skyNode.frustumCulled=!1,n._skyNode.onBeforeRender=function(e,t,i){this.matrixWorld.copyPosition(i.matrixWorld)},n._lightGroup=null,n.noonColor=(new THREE.Color).setHex(16777215),n.earlyEveningColor=(new THREE.Color).setHex(16746816),n}return o(t,e),t.prototype.customSetup=function(e){this.node.add(this._skyNode),this.setConfig(e)},t.prototype.setConfig=function(e){for(var t in this._config)void 0!==e[t]&&(this._config[t]=e[t]);var i=this._skyNode.material.uniforms;i.turbidity.value=this._config.turbidity||10,i.rayleigh.value=this._config.rayleigh||2,i.luminance.value=this._config.luminance||1,i.mieCoefficient.value=this._config.mieCoefficient||.005,i.mieDirectionalG.value=this._config.mieDirectionalG||.95,i.mieFowardG_AVON_NIU={value:"avonniu"},Te.parseValue(e.auhnujuw,!1)&&(i.mieWithSkyBox={value:"#A180EA"});var r=this._config.time,n=r/24*360-90,o=this._config.beta,a=Te.parseVector3(j.directionFromAlphaBeta(n,o));if(a.normalize(),i.sunPosition.value.copy(a),i.moonPosition={value:"naijil"},i.moonDirection={value:"#148158"},this._config.light){this._lightGroup?this._lightGroup.visible||(this._lightGroup.visible=!0):this._lightGroup=this.app.create({type:"LightGroup",parent:this});var s=r<6||18<r,l=1-Math.abs(r-12)/6,c=zn.copy(this.earlyEveningColor).lerp(this.noonColor,l);this._lightGroup.setConfig({showHelper:Te.parseValue(this._config.lightHelper,!1),ambientLight:{intensity:0},hemisphereLight:{intensity:Math.min(Math.max(s?0:l+.3,.2),.7),color:3310847,groundColor:16763007},mainLight:{shadow:!0,shadowQuality:"high",intensity:.5,color:c.getHex(),alpha:n,beta:o},secondaryLight:{intensity:0},tertiaryLight:{intensity:0}},this.parent?this.parent.getLocalBoundingBox().toBox():this.app.root.getLocalBoundingBox().toBox())}else this._lightGroup&&(this._lightGroup.visible=!1)},t.prototype.getConfig=function(){return this._config},t}(Ye),Wn=function(e){function t(){r(this,t);var i=Gn,n=new THREE.ShaderMaterial({fragmentShader:i.fragmentShader,vertexShader:i.vertexShader,uniforms:THREE.UniformsUtils.clone(i.uniforms),side:THREE.BackSide});return a(this,e.call(this,new THREE.BoxBufferGeometry(1,1,1),n))}return o(t,e),t}(THREE.Mesh);Wn.prototype.isSky=!0;var Gn={uniforms:{luminance:{value:1},turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new THREE.Vector3}},vertexShader:["uniform vec3 sunPosition;","uniform float rayleigh;","uniform float turbidity;","uniform float mieCoefficient;","varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );","const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );","const float v = 4.0;","const vec3 K = vec3( 0.686, 0.678, 0.666 );","const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );","const float cutoffAngle = 1.6110731556870734;","const float steepness = 1.5;","const float EE = 1000.0;","float sunIntensity( float zenithAngleCos ) {","\tzenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );","\treturn EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );","}","vec3 totalMie( float T ) {","\tfloat c = ( 0.2 * T ) * 10E-18;","\treturn 0.434 * c * MieConst;","}","void main() {","\tvWorldPosition = position.xyz;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\tgl_Position.z = gl_Position.w;","\tvSunDirection = normalize( sunPosition );","\tvSunE = sunIntensity( dot( vSunDirection, up ) );","\tvSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );","\tfloat rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );","\tvBetaR = totalRayleigh * rayleighCoefficient;","\tvBetaM = totalMie( turbidity ) * mieCoefficient;","}"].join("\n"),fragmentShader:["varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","uniform float luminance;","uniform float mieDirectionalG;","const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003;","const float N = 2.545E25;","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","const float THREE_OVER_SIXTEENPI = 0.05968310365946075;","const float ONE_OVER_FOURPI = 0.07957747154594767;","float rayleighPhase( float cosTheta ) {","\treturn THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );","}","float hgPhase( float cosTheta, float g ) {","\tfloat g2 = pow( g, 2.0 );","\tfloat inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );","\treturn ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );","}","const float A = 0.15;","const float B = 0.50;","const float C = 0.10;","const float D = 0.20;","const float E = 0.02;","const float F = 0.30;","const float whiteScale = 1.0748724675633854;","vec3 Uncharted2Tonemap( vec3 x ) {","\treturn ( ( x * ( A * x + C * B ) + D * E ) / ( x * ( A * x + B ) + D * F ) ) - E / F;","}","void main() {","\tfloat zenithAngle = acos( max( 0.0, dot( up, normalize( vWorldPosition - cameraPos ) ) ) );","\tfloat inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );","\tfloat sR = rayleighZenithLength * inverse;","\tfloat sM = mieZenithLength * inverse;","\tvec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );","\tfloat cosTheta = dot( normalize( vWorldPosition - cameraPos ), vSunDirection );","\tfloat rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );","\tvec3 betaRTheta = vBetaR * rPhase;","\tfloat mPhase = hgPhase( cosTheta, mieDirectionalG );","\tvec3 betaMTheta = vBetaM * mPhase;","\tvec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );","\tLin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );","\tvec3 direction = normalize( vWorldPosition - cameraPos );","\tfloat theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]","\tfloat phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]","\tvec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );","\tvec3 L0 = vec3( 0.1 ) * Fex;","\tfloat sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );","\tL0 += ( vSunE * 19000.0 * Fex ) * sundisk;","\tvec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );","\tvec3 curr = Uncharted2Tonemap( ( log2( 2.0 / pow( luminance, 4.0 ) ) ) * texColor );","\tvec3 color = curr * whiteScale;","\tvec3 retColor = pow( color, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );","\tgl_FragColor = vec4( retColor, 1.0 );","}"].join("\n")},Xn=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));return n._element=null,n._autoUpdateVisible=!0,n._pivot=null,n._offset=[0,0,0],n._customWidth=0,n._customHeight=0,n}return o(t,e),t.prototype._updateVisible=function(e,t,i){var r=this.app.renderer.getSize(),n=i[0],o=i[1],a=i[2];return 0==e.visible||1<a||n<0||n>r.width||o<0||o>r.height?("hidden"!=t.visibility&&(t.visibility="hidden"),!1):("visible"!=t.visibility&&(t.visibility="visible"),!0)},t.prototype.setup=function(t){e.prototype.setup.call(this,t),this._element=t.container||t.el||t.element,this._pivot=t.pivot||[.5,1],this._position=t.position,this._offset=t.offset||t.localPosition||[0,0,0],this._customWidth=t.width,this._customHeight=t.height,this.tickable=!0},t.prototype.update=function(){var e=this._element;if(!e)return!1;var t=this._parent;if(null==t&&(t=this.app.root.defaultCampus),t.destroyed)return this.destroy(),!1;!1===this._prevParentVisible&&t.visible&&this.visible&&(delete this._prevParentVisible,this._autoUpdateVisible=!0);var i=this._position||t.boundingBox.center,r=this._offset,n=this.app.camera.worldToScreen([i[0]+r[0],i[1]+r[1],i[2]+r[2]]),o=e.style;if(this._autoUpdateVisible&&!this._updateVisible(t,o,n))return!0;"topview"==this.app.camera.viewMode?o.zIndex=1e3:o.zIndex=1e3-Math.ceil(1e4*n[2]-9900);var a=[0,0],s=e.offsetWidth,l=e.offsetHeight;Math.abs(e.cacheWidth-s)<1.5&&Math.abs(e.cacheHeight-l)<1.5?(s=e.cacheWidth,l=e.cacheHeight):(e.cacheWidth=s,e.cacheHeight=l),s=s||this._customWidth,l=l||this._customHeight,a[0]=Math.ceil(s*this._pivot[0]),a[1]=Math.ceil(l*this._pivot[1]);var c=this.app.domElement.offsetLeft-(e.parentElement?e.parentElement.offsetLeft:0),u=this.app.domElement.offsetTop-(e.parentElement?e.parentElement.offsetTop:0),h=Math.floor(n[0]-a[0]+c),p=Math.floor(n[1]-a[1]+u);return e.cacheLeft!=h&&(e.cacheLeft=h,o.left=h+"px"),e.cacheTop!=p&&(e.cacheTop=p,o.top=p+"px"),!0},t.prototype.destroy=function(){if(this._element){var t=this._element.parentNode;t&&t.removeChild(this._element)}e.prototype.destroy.call(this)},n(t,[{key:"position",set:function(e){this._position=e},get:function(){return this._position.concat()}},{key:"offset",set:function(e){this._offset=e},get:function(){return this._offset.concat()}},{key:"visible",set:function(e){var t=this._parent;t&&(e&&!t.visible?(this._prevParentVisible=!1,this._autoUpdateVisible=!1):this._autoUpdateVisible=e,this._element.style.visibility=e?"visible":"hidden")},get:function(){return"visible"==this._element.style.visibility}}]),t}(function(){function e(t){r(this,e),this.app=t,this._destroyed=!1}return e.prototype.setup=function(e){var t=e.parent;if(t instanceof Ye){if(this._parent=t,this._parent){var i=this;this._parent.one("destroy",function(){i._destroyed||i.destroy()})}}else t&&console.error("[UIAnchor] Please make sure parent is BaseObject")},e.prototype.update=function(){return!1},e.prototype.destroy=function(){this.tickable=!1,this._destroyed=!0},n(e,[{key:"canNotQueryFromSelector",get:function(){return!0}},{key:"tickable",set:function(e){e?this.app.objectManager.addTickableObject(this):this.app.objectManager.removeTickableObject(this)}}]),e}()),Yn={classes:{},registerClass:function(e,t){this.classes[e]=t},hasClass:function(e){return!!this.classes[e]},create:function(e,t){return new this.classes[e](t)}},Qn=function(){function e(t){r(this,e),this.app=t,this.objects=new Map,this._interactableNodes=[],this._renderDistanceObjects=[],this._shadowDistanceObjects=[],this.tickableObjects=[],this._pause=!1,this.registerDefaultClasses(),this.registerEvents()}return e.prototype.registerDefaultClasses=function(){Yn.registerClass("BaseObject",Ye),Yn.registerClass("Box",ir),Yn.registerClass("Circle",rr),Yn.registerClass("Sphere",nr),Yn.registerClass("Plane",or),Yn.registerClass("Grid",ar),Yn.registerClass("Cylinder",sr),Yn.registerClass("Tetrahedron",lr),Yn.registerClass("Frustum",cr),Yn.registerClass("Shape",ur),Yn.registerClass("Campus",Gi),Yn.registerClass("Ground",dr),Yn.registerClass("VideoSurvilance",fr),Yn.registerClass("Outdoors",Ai),Yn.registerClass("Group",mr),Yn.registerClass("Building",ri),Yn.registerClass("Floor",ii),Yn.registerClass("Facade",tt),Yn.registerClass("Thing",oi),Yn.registerClass("BatchObject",Ki),Yn.registerClass("ProgressBar",$i),Yn.registerClass("Door",Si),Yn.registerClass("ElevatorDoor",hr),Yn.registerClass("Elevator",pr),Yn.registerClass("StairDoor",Mi),Yn.registerClass("Stair",Ri),Yn.registerClass("Room",Pi),Yn.registerClass("TextRegion",Rr),Yn.registerClass("CombinedObject",ti),Yn.registerClass("Fence",Pr),Yn.registerClass("CurveFence",Ar),Yn.registerClass("Region",Cr),Yn.registerClass("PolygonRegion",Lr),Yn.registerClass("Heatmap",Hr),Yn.registerClass("Line",Br),Yn.registerClass("RouteLine",Kr),Yn.registerClass("PolygonLine",$r),Yn.registerClass("Points",en),Yn.registerClass("MeshLine",Bn),Yn.registerClass("Boundary",In),Yn.registerClass("ParticleSystem",xn),Yn.registerClass("Water",En),Yn.registerClass("SpotLight",Dn),Yn.registerClass("LightGroup",Fn),Yn.registerClass("Marker",Un),Yn.registerClass("WebView",Vn),Yn.registerClass("UI",Xn),Yn.registerClass("UIAnchor",Xn),Yn.registerClass("SceneRoot",Yi),Yn.registerClass("ViewProbe",An),Yn.registerClass("SkyEffect",qn)},e.prototype.registerEvents=function(){this.app.on("beforeLoad",function(e){e.castType=function(e,t,i){console.warn("[App] Please use 'THING.Utils.addCastType(name, condition, params)' to cast object type before load scenes"),Te.addCastType(e,t,i)}})},e.prototype._canCastType=function(e,t,i){var r=[e];if(Te.isArray(i))for(var n=0;n<i.length;n++){var o=i[n];if(!(r=t.select(o,r)).length)break}else r=t.select(i,r);return!!r.length},e.prototype._castObject=function(e,t){var i=Te.getCastTypes();if(i.length){this._castTypeSelector||(this._castTypeSelector=new qe(this.app));for(var r=0;r<i.length;r++){var n=i[r];if(n.type!=t.type&&this._canCastType(t,this._castTypeSelector,n.condition))return t.type=n.type,t.skipCast=!0,t.skipSetup=!0,e.destroy(),t=Te.mergeObject(t,n.params,!0),this._createObject(t)}}return e},e.prototype._checkType=function(e){for(var t=[],i=0;i<t.length;i++){var r=t[i];if(r.oldType==e)return console.warn('The "'+e+'" is not support anymore, please use "'+r.newType+'" to replace it'),r.newType}return e},e.prototype._createObject=function(e){var t=e.type||"Thing",i=Te.parseValue(e.skipSetup,!1);t=this._checkType(t);var r=null;Yn.hasClass(t)&&(r=Yn.create(t,this.app)),r||(r=new oi(this.app),console.warn("ObjectManager can not found type: <"+t+"> use <Thing> instead!"),t="Thing"),r._type=r._type||t;var n=r.isBaseObject;return n&&(r.queryID=j.generateUUID()),i||(n&&(e.skipCast||(e.name=e.name||e.id,r=this._castObject(r,e))),r.setup(e)),this.app.needUpdate=!0,r},e.prototype.create=function(e){if(!e)return console.error("create object failed, due to param is null"),null;Te.isString(e)&&(e={type:e});var t=this._createObject(e);return t?(t.queryID&&this.objects.set(t.queryID,t),Te.parseValue(e.queryable,!0)||(t.canNotQueryFromSelector=!0),t.isBaseObject&&(t.trigger(H.Create,{object:t}),this.app.trigger(H.Create,{object:t})),t):null},e.prototype.destroy=function(e){e&&(e.isBaseObject&&(e.trigger(H.Destroy,{object:e}),this.app.trigger(H.Destroy,{object:e})),e.queryID&&this.objects.delete(e.queryID),this.removeTickableObject(e))},e.prototype._addNode=function(e,t){return t.isBaseObject&&(t=t.node),Te.add(e,t)},e.prototype._removeNode=function(e,t){t.isBaseObject&&(t=t.node),Te.remove(e,t)},e.prototype._addObject=function(e,t){return Te.add(e,t)},e.prototype._replaceObject=function(e,t,i){for(var r=0;r<e.length;r++)e[r]==i&&(e[r]=t)},e.prototype._removeObject=function(e,t){Te.remove(e,t)},e.prototype.addInteractableNode=function(e){e&&(e.updateWorldMatrix(!0,!0),this._addNode(this._interactableNodes,e))},e.prototype.removeInteractableNode=function(e){e&&this._removeNode(this._interactableNodes,e)},e.prototype.addRenderDistanceObject=function(e){this._addObject(this._renderDistanceObjects,e)},e.prototype.removeRenderDistanceObject=function(e){this._removeObject(this._renderDistanceObjects,e)},e.prototype.addShadowDistanceObject=function(e){this._addObject(this._shadowDistanceObjects,e)},e.prototype.removeShadowDistanceObject=function(e){this._removeObject(this._shadowDistanceObjects,e)},e.prototype.get=function(e){if(e)if(e.isObject3D){var t=e.userData;if(t&&t.id)return this.get(t.id)}else if(this.objects.has(e))return this.objects.get(e);return null},e.prototype.getBaseObject=function(e){for(;e;){var t,i=e.userData;if(i.independent)return null;if(i.baseObject_bindSubNode_hooked&&(t=i.baseObject_bindSubNode))return t;if(i.isBaseObject&&!(t=this.get(i.id)).isCombinedObject)return t;e=e.parent}},e.prototype.getObjectsArray=function(){var e=[];return this.objects.forEach(function(t){e.push(t)}),e},e.prototype.pause=function(){this._pause=!0},e.prototype.resume=function(){this._pause=!1},e.prototype.addTickableObject=function(e){for(var t=0;t<this.tickableObjects.length;t++)if(this.tickableObjects[t]==e)return;this.tickableObjects.push(e)},e.prototype.removeTickableObject=function(e){for(var t=0;t<this.tickableObjects.length;t++)if(this.tickableObjects[t]==e){e.isTickable=!1,this.tickableObjects[t]=null;break}},e.prototype.replaceObject=function(e,t){this._replaceObject(this._renderDistanceObjects,e,t),this._replaceObject(this._shadowDistanceObjects,e,t),this._replaceObject(this.tickableObjects,e,t),this.objects.delete(t.queryID),this.objects.set(e.queryID,e)},e.prototype.update=function(){if(!this._pause)for(var e=this.app._deltaTime,t=this.tickableObjects,i=0,r=t.length;i<r;i++){var n=t[i],o=!1;n&&(n.update(e)?o=!0:n.isTickable=!1),o||(t.splice(i,1),i--,r--)}},e.prototype.onUpdate=function(e){this.update(e)},n(e,[{key:"interactableNodes",get:function(){return this._interactableNodes}},{key:"renderDistanceObjects",get:function(){return this._renderDistanceObjects}},{key:"shadowDistanceObjects",get:function(){return this._shadowDistanceObjects}}]),e}(),Zn=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));return n._solidColor=null,n}return o(t,e),t.prototype._setAlwaysOnTop=function(e,t){if(this._alwaysOnTop!=e){this._alwaysOnTop=e;var i=this.obj._sprite;if(i){var r=this.obj.app.spriteResource,n=Te.parseValue(i.material.isSpriteMaterial,!1),o=r.getMaterial({url:this.obj.url,alwaysOnTop:e,skipRefCount:!0,useSpriteMaterial:n}).material;o.map=i.material.map,i.material=o,e?this.obj.node.traverse(function(e){Te.backupValue(e,"renderOrder"),e.renderOrder=THING.BaseStyle.cAlwaysOnTopRenderOrderID}):this.obj.node.traverse(function(e){Te.revertValue(e,"renderOrder")})}}},t.prototype.setUVAnimation=function(t){var i=this.obj._sprite;if(i){if(t){var r=i.material;t.uvDiscard?(r.defines=r.defines||{},r.defines.USE_UV_DISCARD=""):r.defines&&delete r.defines.USE_UV_DISCARD,r.needsUpdate=!0}e.prototype.setUVAnimation.call(this,t)}},t.prototype.setSolidColor=function(e){this._solidColor!=e&&(this._solidColor=Te.parseColor(e),["#ifdef GL_ES\n","precision highp float;\n","#endif\n","","varying vec4 worldId;","","void main() {","  gl_FragColor = "+this._solidColor.getHex()+";","}"].join("\n"))},n(t,[{key:"solidColor",set:function(e){return this.setSolidColor(e)},get:function(){return this._solidColor?this._solidColor.toHexString():null}},{key:"line",get:function(){return this.obj._line}},{key:"lineColor",set:function(e){this.line&&(this.line.style.lineColor=e)}},{key:"lineOpacity",set:function(e){this.line&&(this.line.style.lineOpacity=e)}},{key:"lineDashSize",set:function(e){this.line&&(this.line.style.lineDashSize=e)}},{key:"lineGapSize",set:function(e){this.line&&(this.line.style.lineGapSize=e)}},{key:"lineWidth",set:function(e){this.line&&(this.line.style.lineWidth=e)}}]),t}(Sr),Jn=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));return n._lineColor=Te.parseColor("#00BFFF"),n._regionOpacity=.5,n._regionColor=Te.parseColor("#708090"),n}return o(t,e),t.prototype.isNeedCloneMaterials=function(){return!!e.prototype.isNeedCloneMaterials.call(this)||!this._lineColor.equals(Te.parseColor("#00BFFF"))||.5!=this._regionOpacity||!this._regionColor.equals(Te.parseColor("#708090"))},n(t,[{key:"lineColor",set:function(e){var t=Te.parseColor(e);if(t){var i=this.obj._lineMesh;i&&(this._lineColor=t,i.material.color=t)}},get:function(){return this._lineColor.toHexString()}},{key:"regionColor",set:function(e){var t=Te.parseColor(e);if(t){var i=this.obj._areaMesh;i&&(this._regionColor=t,i.material.color=t)}},get:function(){return this._regionColor.toHexString()}},{key:"regionOpacity",set:function(e){if(Te.isNumber(e)){var t=this.obj._areaMesh;t&&(this._regionOpacity=e,t.material.opacity=e)}},get:function(){return this._regionOpacity}}]),t}(Sr),Kn=function(e){function t(i){return r(this,t),a(this,e.call(this,i))}return o(t,e),t.prototype.setEffect=function(e){e=e||{};var t=this.obj;t._scale=e.scale||t._scale,t._color=e.color||t._color,t._flowDirection.x=e.flowXDirection||t._flowDirection.x,t._flowDirection.y=e.flowYDirection||t._flowDirection.y;var i=t.water.material.uniforms;i.color.value.set(t._color),i.config.value.w=t._scale,i.flowDirection.value.x=t._flowDirection.x,i.flowDirection.value.y=t._flowDirection.y},n(t,[{key:"waterColor",set:function(e){this.setEffect({color:e})},get:function(){return this.obj._color}},{key:"waterScale",set:function(e){this.setEffect({scale:e})},get:function(){return this.obj._scale}},{key:"flowXDirection",set:function(e){this.setEffect({flowXDirection:e})},get:function(){return this.obj._flowDirection.x}},{key:"flowYDirection",set:function(e){this.setEffect({flowYDirection:e})},get:function(){return this.obj._flowDirection.y}}]),t}(Sr),$n=function(e){function t(i){return r(this,t),a(this,e.call(this,i))}return o(t,e),n(t,[{key:"image",set:function(e){if(this._image=e)if(e.isTexture)this._image=e.name,this.obj.synPathTexture(e);else{this._image=this.obj.app.confirmURL(e);var t=(new THREE.TextureLoader).load(this._image,function(e){e.wrapS=e.wrapT=THREE.RepeatWrapping,e.anisotropy=16});this.obj.synPathTexture(t)}},get:function(){return this._image}},{key:"lineMaterial",get:function(){var e=this.obj.pathLine.material;return e.dashSize||e.gapSize?this.dashLineMaterial:this.basicLineMaterial}},{key:"basicLineMaterial",get:function(){var e=this.obj.pathLine.material;if(e.isLineBasicMaterial)return e;var t=new THREE.LineBasicMaterial({color:e.color,opacity:e.opacity,linewidth:e.lineWidth,transparent:e.transparent});return this.obj.pathLine.material=t}},{key:"dashLineMaterial",get:function(){var e=this.obj.pathLine.material;if(e.isLineDashedMaterial)return e;var t=new THREE.LineDashedMaterial({color:e.color,opacity:e.opacity,linewidth:e.lineWidth,transparent:e.transparent});return this.obj.pathLine.material=t}},{key:"lineColor",set:function(e){this.lineMaterial.color=Te.parseColor(e)},get:function(){return this.lineMaterial.color.toHexString()}},{key:"lineOpacity",set:function(e){this.lineMaterial.opacity=e},get:function(){return this.lineMaterial.opacity}},{key:"lineDashSize",set:function(e){this.lineMaterial.dashSize=e},get:function(){return this.lineMaterial.dashSize}},{key:"lineGapSize",set:function(e){this.lineMaterial.gapSize=e},get:function(){return this.lineMaterial.gapSize}},{key:"lineWidth",set:function(e){this.lineMaterial.lineWidth=e},get:function(){return this.lineMaterial.lineWidth}}]),t}(Sr);function eo(e,t,i){var r=[];t.forEach(function(t){var n=.09;"top"==i&&(n+=e.getRoomHeight()),r.push([t[0],t[1]+n,t[2]])});var n=e.app.create({name:e.name+"_border_"+i,type:"RouteLine",image:e.app.confirmURL("image/light3.jpg"),parent:e,arrowFlag:!1,close:!0,side:"right",points:r,width:2});return n.cornerRadius=0,n.scrollSpeed=10,n.uvRatio=40,n.pickable=!1,n.style.skipOutline=!0,n.scrollUV=!0,n.node.traverse(function(e){e.isMesh&&(e.userData.skipOutline=!0,e.material.transparent=!0,e.material.blending=THREE.AdditiveBlending)}),n}var to=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));return n._volumeNode=null,n._volumeColor=null,n._volumeImage=null,n._volumeCanvas=null,n._borderLine=!1,n._borderLineTop=null,n._borderLineBottom=null,n}return o(t,e),t.prototype._synVolumeNode=function(){this._volumeColor||this._volumeImage||this._volumeCanvas||(this.obj.app.resourceManager.remove(this._volumeNode),this._volumeNode=null),this.obj._synTextRegion()},t.prototype._createVolumeNode=function(){if(!this._volumeNode){var e=this.obj.getFloorMesh();if(!e)return null;if(this._volumeNode=e.clone(),!this._volumeNode)return null;if(this._volumeNode.geometry=this._volumeNode.geometry.clone(),this._volumeNode.material=e.material.clone(),!this._volumeNode.material)return null;var t=this._volumeNode.material;t.map=null,t.transparent=!0,t.opacity=.5,this._volumeNode.geometry.genFaceVertexUVs(),e.parent.add(this._volumeNode);var i=e.position;this._volumeNode.position.setY(i.y+this.obj.getRoomHeight()+.05)}return this._volumeNode},n(t,[{key:"volumeColor",set:function(e){this._volumeColor=Te.parseColor(e);var t=this._createVolumeNode();t&&(e?t.material.color=Te.parseColor(e):t.material.color.set(1,1,1)),this._synVolumeNode()},get:function(){return null==this._volumeColor?null:this._volumeColor.toHexString()}},{key:"volumeOpacity",set:function(e){var t=this._createVolumeNode();t&&(t.material.opacity=e)},get:function(){return null==this._volumeNode?null:this._volumeNode.material.opacity}},{key:"volumeImage",set:function(e){this._volumeImage=e,this._volumeCanvas=null;var t=this._createVolumeNode();if(t){if(e){var i=new THREE.TextureLoader;i.setCrossOrigin("anonymous");var r=this.obj.app.confirmURL(e);e=i.load(r)}t.material.map=e,t.material.needsUpdate=!0}this._synVolumeNode()},get:function(){return this._volumeImage}},{key:"volumeCanvas",set:function(e){this._volumeCanvas=e,this._volumeImage=null;var t=this._createVolumeNode();t&&(e&&((e=new THREE.Texture(e)).needsUpdate=!0),t.material.map=e,t.material.needsUpdate=!0),this._synVolumeNode()},get:function(){return this._volumeCanvas}},{key:"volumeHeight",set:function(e){this._volumeNode&&(this._volumeNode.position.y=e)},get:function(){return this._volumeNode?this._volumeNode.position.y:0}},{key:"borderLine",set:function(e){if(e!=this._borderLine)if(e){var t=this.obj,i=t.points;this._borderLineTop=eo(t,i,"top"),this._borderLineBottom=eo(t,i,"bottom"),this._borderLine=!0}else this._borderLineTop.destroy(),this._borderLineBottom.destroy(),this._borderLineTop=null,this._borderLineBottom=null,this._borderLine=!1},get:function(){return this._borderLine}}]),t}(Sr),io=function(e){function t(i){r(this,t);var n=a(this,e.call(this,i));return n._lineColor=new THREE.Color(1,1,1),n}return o(t,e),n(t,[{key:"lineColor",set:function(e){this.obj._lineMesh.material.color=Te.parseColor(e)},get:function(){return this._lineColor.toHexString()}}]),t}(Sr),ro=function(e){function t(i){return r(this,t),a(this,e.call(this,i))}return o(t,e),t.prototype.setRenderOrder=function(e){this._renderOrder=e,this.obj.children.forEach(function(t){t.style.setRenderOrder(e)})},t.prototype.setWireframe=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];this._wireframe=e,this.obj.children.forEach(function(i){i.style.setWireframe(e,t)})},t.prototype.setOpacity=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];this._opacity=e,this.obj.children.forEach(function(i){i.style.setOpacity(e,t)})},t.prototype.setColor=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];this._color=Te.parseColor(e),this.obj.children.forEach(function(i){i.style.setColor(e,t)})},t.prototype.setOutlineColor=function(e,t){this._outlineColor=Te.parseColor(e),this.obj.children.forEach(function(i){i.style.setOutlineColor(e,t)})},t.prototype.setDefaultOutlineColor=function(e){this._defaultOutlineColor=Te.parseColor(e),this.obj.children.forEach(function(t){t.style.setDefaultOutlineColor(e)})},t.prototype.setSkipBoundingBox=function(e){this.obj.children.forEach(function(t){t.style.setSkipBoundingBox(e)})},t.prototype.setSkipOutline=function(e){this.obj.children.forEach(function(t){t.style.setSkipOutline(e)})},t.prototype.setGlow=function(e){this._glow=e,this.obj.children.forEach(function(t){t.style.setGlow(e)})},t.prototype.setInnerGlow=function(e){this._innerGlow=e,this.obj.children.forEach(function(t){t.style.setInnerGlow(e)})},t.prototype.setVertexNormalHelper=function(e){this._vertexNormalNode={visible:e},this.obj.children.forEach(function(t){t.style.setVertexNormalHelper(e)})},t.prototype.setAxisHelper=function(e){this._axisNode={visible:e},this.obj.children.forEach(function(t){t.style.setAxisHelper(e)})},t.prototype.setEdgeColor=function(e){this._edgeColor=Te.parseColor(e),this.obj.children.forEach(function(t){t.style.setEdgeColor(e)})},t.prototype.setBoundingBox=function(e,t){this._boundingBoxNode={visible:e,material:{color:Te.parseColor(t)}},this.obj.children.forEach(function(i){i.style.setBoundingBox(e,t)})},t.prototype.setOrientedBoundingBox=function(e){this._orientedBoundingBoxNode={visible:e,material:{color:Te.parseColor(color)}},this.obj.children.forEach(function(t){t.style.setOrientedBoundingBox(e,color)})},t.prototype.setAlwaysOnTop=function(e){this._alwaysOnTop=e,this.obj.children.forEach(function(t){t.style.setAlwaysOnTop(e)})},t.prototype.setImage=function(e){this._image=e,this.obj.children.forEach(function(t){t.style.setImage(e)})},t}(Sr),no=new Map,oo=function(){function e(t){r(this,e),e.register("Default",new Map([["*",Sr],["Marker",Zn],["PolygonRegion",Jn],["TextRegion",Mr],["Water",Kn],["Line",$n],["RouteLine",$n],["PolygonLine",$n],["Room",to],["Frustum",io],["Group",ro]]))}return e.register=function(e,t){no.set(e,t)},e.getStrategyMap=function(e){return no.get(e)},e.prototype.createStyle=function(e,t){var i=no.get(e);if(!i)return null;var r=i.get(t.type);if(r)return new r(t);var n=i,o=Array.isArray(n),a=0;for(n=o?n:n[Symbol.iterator]();;){var s;if(o){if(a>=n.length)break;s=n[a++]}else{if((a=n.next()).done)break;s=a.value}var l=s,c=l[0];if("*"!=c&&Te.instanceOf(t,c))return new l[1](t)}var u=i.get("*");return u?new u(t):null},e.prototype.hasStyleStrategy=function(e){return no.has(e)},e}(),ao=function(){function e(t){r(this,e),this.app=t,this.scene=this.app.scene,this.renderer=this.app.renderer,this.camera=this.app.renderCamera,this.init()}return e.prototype.init=function(){var e=new THREEx.HtmlMixer.Context(this.renderer,this.scene,this.camera),t=(this.mixerContext=e).rendererCss,i=this.renderer.getSize();t.setSize(i.width,i.height);var r=t.domElement;this.app.domElement.appendChild(r);var n=e.rendererWebgl,o=n.domElement;n.domElement._static||(o.style.position="absolute",o.style.top="0px",o.style.pointerEvents="none",r.appendChild(o))},e.prototype.resize=function(e,t){this.mixerContext.rendererCss.setSize(e,t)},e.prototype.update=function(){this.mixerContext.update()},e.prototype.onUpdate=function(e){this.update(e)},e}(),so=function(){function e(t){r(this,e),this.eventTriggerManager=t,this.app=this.eventTriggerManager.app,this.domElement=this.app.mainDomElement,this.singleClickTimer=null,this.clickCountForSingleClick=0,this.dragStartFlag=!1,this.draggingFlag=!1,this._dragPrevPosition=null,this._draggingObject=null,this.mouseMoveObject=null,this.mouseDownPos={},this.mouseMovePos=[],this.mouseMoveDelta=null,this.keysPressed={},this.init()}return e.prototype.dispatchEvent=function(e){this.eventTriggerManager.dispatchEvent(e)},e.prototype.getEventPosition=function(e,t){var i,r,n=this.domElement;if(n){var o=n.currentStyle||window.getComputedStyle(n,null),a=t?t[0]:parseInt(o.borderLeftWidth,10),s=t?t[1]:parseInt(o.borderTopWidth,10),l=n.getBoundingClientRect();i=e.clientX-a-l.left,r=e.clientY-s-l.top}else e.layerX||0==e.layerX?(i=e.layerX,r=e.layerY):e.offsetX||0==e.offsetX?(i=e.offsetX,r=e.offsetY):(e.clientX||0==e.clientX)&&(i=e.clientX,r=e.clientY);return{x:Math.round(i),y:Math.round(r)}},e.prototype.registerEventFunctions=function(e){e.stopPropagation=function(){this._stopPropagation=!0}},e.prototype.createKeyboardEvent=function(e){var t={type:e.type,key:e.which,code:e.code,location:e.location,altKey:e.altKey,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey};return this.registerEventFunctions(t),t},e.prototype.createMouseEvent=function(e,t,i){var r=Te.parseVector2(i)||this.getEventPosition(t),n={type:e,clientX:r.x,clientY:r.y,x:r.x,y:r.y,button:t.button||0,buttons:t.buttons||0,altKey:t.altKey,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,pickedPosition:null};return this.registerEventFunctions(n),n.getPickedPos=function(){return console.warn("Please use .getPickedPosition() to replace .getPickedPos()"),n.pickedPosition},n.getPickedPosition=function(){return console.warn("Please use .pickedPosition to replace .getPickedPosition()"),n.pickedPosition},n},e.prototype.createDragEvent=function(e,t,i,r){var n=[void 0!==t.x?t.x:t.clientX,void 0!==t.y?t.y:t.clientY],o={type:e,x:n[0],y:n[1],clientX:n[0],clientY:n[1],altKey:t.altKey,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey};return i&&(o.offsetX=i),r&&(o.offsetY=r),o.pickedPosition=null,this.registerEventFunctions(o),o.getPickedPos=function(){return console.warn("Please use .getPickedPosition() to replace .getPickedPos()"),o.pickedPosition},o.getPickedPosition=function(){return console.warn("Please use .pickedPosition to replace .getPickedPosition()"),o.pickedPosition},o},e.prototype.clearSingleClickTimer=function(){null!=this.singleClickTimer&&(clearTimeout(this.singleClickTimer),this.clickCountForSingleClick=0)},e.prototype.findMouseEventObject=function(e,t){for(;e;){for(var i=0;i<t.length;i++)if(e.hasEvent(t[i]))return e;e=e.parent}return null},e.prototype.processMouseOffEvent=function(e){var t=this.mouseMoveObject;if(t){var i=e.object;if(i){if(i.isChildOf(t))return;var r=this.findMouseEventObject(t,["mouseleave","mouseoff"]);if(!r||i.node.isChildOf(r.node))return;if(this.findMouseEventObject(i,["mouseleave","mouseoff"])==t)return;t==r&&(this.dispatchEvent({type:H.MouseLeave,object:r,x:e.clientX,y:e.clientY}),this.dispatchEvent({type:"mouseoff",object:r,x:e.clientX,y:e.clientY}))}else for(var n=t;n;n=n.parent)n.trigger(H.MouseLeave,{object:n,x:e.clientX,y:e.clientY}),n.trigger("mouseoff",{object:n,x:e.clientX,y:e.clientY});this.mouseMoveObject=null}},e.prototype.processMouseOnEvent=function(e){var t=e.object,i=this.findMouseEventObject(t,["mouseenter","mouseon"]);i&&this.mouseMoveObject!=i&&(this.mouseMoveObject=i,this.dispatchEvent({type:H.MouseEnter,object:i,x:e.clientX,y:e.clientY}),this.dispatchEvent({type:"mouseon",object:i,x:e.clientX,y:e.clientY}))},e.prototype.processMouseOverEvent=function(e){var t=e.object,i=this.findMouseEventObject(t,["mouseover"]);i&&this.dispatchEvent({type:"mouseover",object:i,x:e.clientX,y:e.clientY})},e.prototype.processHoverEvent=function(e){this.mouseMoveObject!=e.object&&(this.processMouseOffEvent(e),this.processMouseOnEvent(e),this.processMouseOverEvent(e))},e.prototype.createEvent=function(e,t){var i;return t=t||e.type,(i=x[t]?this.createMouseEvent(t,e):E[t]?this.createKeyboardEvent(e):e).preventDefault=function(){e.preventDefault()},i},e.prototype.initDoubleRightClickEvent=function(){var e,t,i,r,n=this;window.oncontextmenu=(t=0,i=!(e=function(e){n.clearSingleClickTimer();var t=n.createEvent(e,"dblclick");t.button=2,n.dispatchEvent(t)}),r=null,function(n){if(n.preventDefault(),i){if(clearTimeout(t),i=!1,1<j.getDistance(r,[n.x,n.y]))return;return e.apply(this,arguments)}r=[n.x,n.y],i=!0,t=setTimeout(function(){i=!1},300)})},e.prototype.initMouseEvent=function(e){var t=this,i=!0,r=!0;for(var n in this.initDoubleRightClickEvent(),x)this.domElement.addEventListener(n,function(n){if("mousedown"==(n=t.createEvent(n)).type)t.mouseDownPos[n.button]=[n.x,n.y];else if("mouseup"==n.type)if(0==n.button)i=!(4<t.getDistanceOfLastMouseDown(n));else if(2==n.button){var o=t.mouseDownPos[n.button];t.getDistanceOfLastMouseDown(n)<=4&&(t.dispatchEvent(t.createMouseEvent("click",n,o)),t.dispatchEvent(t.createMouseEvent("singleclick",n,o)))}if("click"==n.type){if(1<t.getDistanceOfLastMouseDown(n))return;r=!0,t.clickCountForSingleClick++,1===t.clickCountForSingleClick?(o=t.mouseDownPos[n.button],t.singleClickTimer=setTimeout(function(){i&&!t.draggingFlag?(r=!1,t.dispatchEvent(t.createMouseEvent("singleclick",n,o))):r=!0,i=!0,t.clickCountForSingleClick=0},e)):t.clearSingleClickTimer()}else if("dblclick"==n.type&&(t.clearSingleClickTimer(),!r))return void(r=!0);t.dispatchEvent(n),"mousemove"==n.type&&(t.mouseMoveDelta?t.mouseMoveDelta=[t.mouseMovePos[0]-n.x,t.mouseMovePos[1]-n.y]:t.mouseMoveDelta=[n.x,n.y],t.mouseMovePos=[n.x,n.y],0==n.buttons&&t.processHoverEvent(n))},{passive:!1});this.domElement.addEventListener("wheel",function(e){var i={type:H.MouseWheel,delta:e.deltaY};t.dispatchEvent(i)},{passive:!1})},e.prototype.initKeyboardEvent=function(){var e=this;for(var t in E)window.addEventListener(t,function(t){var i=t.which||t.keyCode;if("keydown"==t.type){if(e.keysPressed[i])return;e.keysPressed[i]=!0}else"keyup"==t.type&&(e.keysPressed[i]=!1);t=e.createEvent(t),e.dispatchEvent(t)})},e.prototype.initDragEvent=function(){var e=this;this.domElement.addEventListener("mouseup",function(t){0==t.button&&e.dragStartFlag&&(e.dragStartFlag=!1,e.draggingFlag=!1,e._dragPrevPosition=null,e._draggingObject=null,t=e.createEvent(t),e.dispatchEvent(e.createDragEvent("dragend",t)))}),this.domElement.addEventListener("mousemove",function(t){if(t=e.createEvent(t),e.dragStartFlag){e.draggingFlag=!0;var i=e.createDragEvent("drag",t);e.dispatchEvent(i);var r=i.pickedPosition;e._dragPrevPosition=e._dragPrevPosition||r,e._dragPrevPosition&&r?i.offsetPosition=j.subVector(r,e._dragPrevPosition):i.offsetPosition=[0,0,0];var n=e._draggingObject;n&&n.trigger("dragging",i),r&&(e._dragPrevPosition=r.concat())}else if(1==t.buttons&&1<e.getDistanceOfLastMouseDown(t)){i=e.createDragEvent("dragstart",t),e.dispatchEvent(i);var o=i.dragObject;o&&o.draggable&&(e.dragStartFlag=!0,e._draggingObject=o)}})},e.prototype.initTouchEvent=function(e){var t=this,i=0,r=!1;this.domElement.addEventListener("touchstart",function(e){e.preventDefault(),e=e.changedTouches[0],(e=t.createEvent(e,"touchstart")).button&&(t.mouseDownPos[e.button]=[e.clientX,e.clientY])}),this.domElement.addEventListener("touchmove",function(e){e.preventDefault(),e=e.changedTouches[0],e=t.createEvent(e,"touchmove");var i=t.domElement.getBoundingClientRect(),n=(e.clientX-i.left)/i.width*2-1,o=-(e.clientY-i.top)/i.height*2+1;t.dragStartFlag?(t.draggingFlag=!0,t.dispatchEvent(t.createDragEvent("drag",e,n,o))):(i=t.domElement.getBoundingClientRect(),n=(e.clientX-i.left)/i.width*2-1,o=-(e.clientY-i.top)/i.height*2+1,1<t.getDistanceOfLastMouseDown(e)&&(t.dragStartFlag=!0,t.dispatchEvent(t.createDragEvent("dragstart",e,n,o)))),r=!0}),this.domElement.addEventListener("touchend",function(n){var o;if(n.preventDefault(),n=n.changedTouches[0],n=t.createEvent(n,"touchend"),!r&&t.getDistanceOfLastMouseDown(n)<4&&(i++,setTimeout(function(){i=0},e),n.button&&(o=t.mouseDownPos[n.button]),1<i?(t.dispatchEvent(t.createMouseEvent("dblclick",n,o)),t.clearSingleClickTimer(),i=0):(t.clickCountForSingleClick++,t.dispatchEvent(t.createMouseEvent("click",n,o)),1===t.clickCountForSingleClick?t.singleClickTimer=setTimeout(function(){t.dispatchEvent(t.createMouseEvent("singleclick",n,o)),t.clickCountForSingleClick=0},e):t.clearSingleClickTimer())),r=!1,t.dragStartFlag){t.dragStartFlag=!1;var a=t._draggingObject;a&&(a.trigger("dragend",t.createDragEvent("dragend",n)),t._draggingObject=null)}})},e.prototype.init=function(){this.initMouseEvent(250),this.initTouchEvent(250),this.initKeyboardEvent(),this.initDragEvent()},e.prototype.getDistanceOfLastMouseDown=function(e){var t=this.mouseDownPos[e.button];if(!t)return 0;var i=[void 0!==e.x?e.x:e.clientX,void 0!==e.y?e.y:e.clientY];return j.getDistance(t,i)},e.prototype.clear=function(){this.singleClickTimer=null,this.mouseMoveObject=null,this.keysPressed={},this.mouseDownPos={},this.mouseMovePos=[],this.mouseMoveDelta=null},e}(),lo=function(){function e(t){r(this,e),this.app=t}return e.prototype.addEventListener=function(t,i,r,n,o,a,s,l){o=o||50,void 0===this._listeners&&(this._listeners={});var c=this._listeners;void 0===c[t]&&(c[t]=[]);var u=c[t],h={__index:e._eventIDCount++,app:this.app,type:t,userData:r,priority:o,tag:a,once:s,object:l,callback:n};i&&(i.isBaseObject?h.selector=i:(h.condition=i,h.selector=new qe(this.app))),u.length?(u.push(h),o>u[u.length-2].priority&&u.sort(function(e,t){return t.priority==e.priority?e.__index-t.__index:t.priority-e.priority})):u.push(h)},e.prototype.getEventListener=function(e,t,i,r,n,o,a){if(void 0===this._listeners)return null;var s=this._listeners[e];if(void 0===s)return null;if(!n&&this._isPauseEvent(e,o,r))return null;for(var l=0;l<s.length;l++){var c=s[l];if((!a||a(c))&&!(i&&c.callback!=i||r&&r!=c.tag)){if(c.condition){if(t&&c.condition!=t)continue;if(o&&!c.selector.select(c.condition,[o]).length)continue}else if(c.object!=o)continue;return{listener:c,listenerArray:s,index:l}}}return null},e.prototype.getEventListeners=function(e,t,i,r,n){if(void 0===this._listeners)return[];var o=function(e,t){var i=e.selector;if(i){if(i.isBaseObject){if(i!=t)return!1}else if(i.select(e.condition,[t]),!i.length)return!1}else if(e.object!=t)return!1;return!0},a=[],s=this._listeners;if(e){if(void 0===(u=s[e]))return[];if(!r&&this._isPauseEvent(e,n,i))return[];for(var l=0;l<u.length;l++)(h=u[l]).callback==t&&(i||h.tag)&&h.tag==i&&o(h,n)&&a.push(h)}else for(var c in s){var u=s[c];if(r||!this._isPauseEvent(c,n,i))for(l=0;l<u.length;l++){var h;o(h=u[l],n)&&a.push(h)}}return a},e.prototype.removeEventListener=function(e,t,i,r,n){if(void 0!==this._listeners){var o=this._listeners[e];if(void 0!==o)for(var a=0;a<o.length;a++)if((i=o[a]).object==n){if(i.selector)if(i.selector.isBaseObject){if(t!=i.selector)continue}else if(i.condition!=t)continue;r&&i.tag!=r||o.splice(a--,1)}}},e.prototype.removeAllListeners=function(){this._listeners=void 0},e.prototype.checkObject=function(e,t){if(t.object){if(t.object!=e.object&&!t.object.canAcceptEvent(e))return!1;if(e._stopPropagation){if(e.object&&e.object.isChildOf(t.object))return!1;var i=e.intersect;if(i&&i.node.isChildOf(e.object.node))return!1}}return!0},e.prototype.getBindingObject=function(e,t,i){var r,n=t.selector,o=t.once;if(n){if(i)return null;if(n.isBaseObject){if(n!=e.object)return null}else{if(!e.object)return null;if(!(r=e.object.TurnIntoByCondition(e.type,t.condition))&&(n.select(t.condition,[e.object]),!n.length))return null}}else if(!this.checkObject(e,t))return null;var a=r||e.object||t.object||window;return o&&n&&a._ignoreEvents&&a._ignoreEvents.has(t)?null:a},e.prototype.dispatchEvent=function(e,t){if(void 0!==this._listeners){var i,r=this._listeners[e.type];if(void 0!==r)for(var n=r.slice(0),o=0;o<n.length;o++){var a=n[o],s=a.selector,l=a.userData,c=a.once,u=a.tag;if(!this._isPauseEvent(e.type,e.object,u)){var h=this.getBindingObject(e,a,t);if(h){var p,d,f=e.data;l&&(e.data=l),s?h.isBaseObject&&(p=e.object,e.object=h):a.object&&(p=e.object,e.object=a.object),e.object&&(d=e.pickedObject,e.pickedObject=e.object);var m=e.beforeTrigger;m&&m(e);var g=a.callback.call(h,e);Te.isNull(g)||(i=g);var v=e.beforeTrigger;if(v&&v(e),s?e.object==h&&(e.object=p):e.object==a.object&&(e.object=p),d?e.pickedObject=d:delete e.pickedObject,e.data=f,c)if(s)h._ignoreEvents&&h._ignoreEvents.add(a);else{var y=r.indexOf(a);-1!==y&&r.splice(y,1)}}}}return i}},e}();lo._eventIDCount=1;var co=function(){function e(t){r(this,e),this.app=t,this._pauseSelector=null,this._pauseEvents=[],this._resumeEvents=[]}return e.prototype._isEvent=function(e,t,i,r,n){for(var o=0,a=e.length;o<a;o++){var s=e[o];if(!t||s.eventType==t){if(i&&s.selector)if(s.selector.isBaseObject){if(s.selector!=i)continue}else if(!this._pauseSelector.select(s.selector,[i]).length)continue;if((!n||n(r,s.tag))&&(!s.parent||!i||i.isChildOf(s.parent)))return!0}}return!1},e.prototype.isPauseEvent=function(e,t,i){function r(e,t){return!t||e==t}return e=Te.toLowerCase(e),!!this._isEvent(this._pauseEvents,e,t,i,r)&&!this._isEvent(this._resumeEvents,e,t,i,r)},e.prototype.isSameSelector=function(e,t){return e&&t&&e.isSelector&&t.isSelector?e.equals(t):e==t},e.prototype.update=function(){for(var e=0;e<this._pauseEvents.length;e++)this._pauseEvents[e].justInFrame&&this._pauseEvents.splice(e--,1)},e.prototype.hasPauseEvent=function(e,t,i,r,n){for(var o=0,a=this._pauseEvents.length;o<a;o++){var s=this._pauseEvents[o];if(s.eventType==e&&this.isSameSelector(s.selector,t)&&s.tag==i&&s.justInFrame==r&&s.parent==n)return!0}return!1},e.prototype.pauseEvent=function(e,t,i,r,n){(e=Te.toLowerCase(e))?(this._pauseSelector||(this._pauseSelector=new qe(this.app)),this.hasPauseEvent(e,t,i,r,n)||this._pauseEvents.push({eventType:e,selector:t,tag:i,justInFrame:r,parent:n})):console.error("event type is invalid, please check it")},e.prototype.removeResumeEvents=function(e,t,i,r){for(var n=0;n<this._resumeEvents.length;n++){var o=this._resumeEvents[n];o.eventType==e&&o.selector==t&&o.parent==r&&(i&&i!=o.tag||this._resumeEvents.splice(n--,1))}},e.prototype.resumeEvent=function(e,t,i,r){if(e=Te.toLowerCase(e)){t||(r=null);for(var n=0;n<this._pauseEvents.length;n++){var o=this._pauseEvents[n];if(o.eventType==e&&this.isSameSelector(o.selector,t)&&o.parent==r){if(o.tag){if(o.tag!=i)continue}else if(i){this._resumeEvents.push({eventType:e,selector:t,tag:i,parent:r});continue}return this.removeResumeEvents(e,t,i,r),this._pauseEvents.splice(n,1),!0}}return!1}console.error("event type is invalid, please check it")},e.prototype.clear=function(){this._pauseSelector=null,this._pauseEvents=[],this._resumeEvents=[]},e}(),uo=function(){function e(t){r(this,e),this.app=t,this._eventSelectors={residentEvents:{name:"residentEvents"},app:{name:"app"},objectEvents:{name:"objectEvents"}};var i=this;this._eventSelectors.forEach=function(e){e(i._eventSelectors.residentEvents),e(i._eventSelectors.app),e(i._eventSelectors.objectEvents)},this._eventSelectors.hasEvent=function(e,t,r,n,o){for(var a=[i._eventSelectors.residentEvents,i._eventSelectors.app,i._eventSelectors.objectEvents],s=0;s<a.length;s++)if(a[s].hasEvent(e,t,r,n,o))return!0;return!1},this._eventSelectors.forEach(function(e){i._initEventSelector(e)}),this._eventPauser=new co(this.app),this._eventIDCount=0}return e.prototype._initEventSelector=function(e){var t=this,i=new lo(this.app);e._trigger=i,e._trigger._isPauseEvent=function(e,i,r){return t.isPauseEvent(e,i,r)},e.traverse=function(e){for(var t in i._listeners)if(!1===e(t,i._listeners[t]))return},e.hasEvent=function(e,t,r,n,o){return!!i.getEventListener(e,null,t,r,n,o)},e.getEvents=function(e,t,r,n,o){return i.getEventListeners(e,t,r,n,o)},e.replaceObjectEvent=function(e,t){for(var r in i._listeners)i._listeners[r].forEach(function(i){i.selector==t&&(i.selector=e),i.object==t&&(i.object=e)})},e.removeObjectEvent=function(e,t,r,n,o){i.removeEventListener(e,t,r,n,o)},e.bindObjectEvent=function(e,t,r,n,o,a,s,l){var c=i.getEventListener(e,t,null,a,!1,l,function(e){return!(!a||e.tag&&a&&e.tag!=a)});c&&c.listenerArray.splice(c.index,1),i.addEventListener(e,t,r,n,o,a,s,l)},e.trigger=function(e,t){if(e.type=Te.toLowerCase(e.type),e.type)return i.dispatchEvent(e,t);console.error("event type is invalid, please check it")}},e.prototype.isPauseEvent=function(e,t,i){return this._eventPauser.isPauseEvent(e,t,i)},e.prototype.hasPauseEvent=function(e,t,i,r,n){return this._eventPauser.hasPauseEvent(e,t,i,r,n)},e.prototype.pauseEvent=function(e,t,i,r,n){this._eventPauser.pauseEvent(e,t,i,r,n)},e.prototype.resumeEvent=function(e,t,i,r){return this._eventPauser.resumeEvent(e,t,i,r)},e.prototype.hasEvent=function(e,t,i,r,n){return!!this._eventSelectors.hasEvent(e,t,i,r,n)},e.prototype.getEvents=function(e,t,i,r,n){var o=[];return this._eventSelectors.forEach(function(a){var s=a.getEvents(e,t,i,r,n);s&&s.forEach(function(e){o.push(e)})}),o},e.prototype.replaceObjectEvent=function(e,t){this._eventSelectors.forEach(function(i){i.replaceObjectEvent(e,t)})},e.prototype.removeObjectEvent=function(e,t,i,r,n){this._eventSelectors.forEach(function(o){o.removeObjectEvent(e,t,i,r,n)})},e.prototype.addEventListener=function(e,t,i){return this.bindCall(e,null,null,t,null,!1,i)},e.prototype.removeEventListener=function(e,t){return this.unbindCall(e,null,t)},e.prototype.bindCall=function(e,t,i,r,n,o,a){if(!(e=Te.toLowerCase(e)))return console.error("event type is invalid, please check it"),null;var s=Te.parseEvent(t,i,r,n,null,a);return s?(s.selector?this._eventSelectors.objectEvents.bindObjectEvent(e,s.selector,s.userData,s.callback,s.priority,s.tag,o,this.app.root):this._eventSelectors.app.bindObjectEvent(e,s.selector,s.userData,s.callback,s.priority,s.tag,o,null),s):null},e.prototype.unbindCall=function(e,t,i){if(!(e=Te.toLowerCase(e)))return console.error("event type is invalid, please check it"),null;var r=Te.parseEvent(t,null,i);return r?(r.selector?this._eventSelectors.objectEvents.removeObjectEvent(e,r.selector,r.callback,r.tag,this.app.root):this._eventSelectors.app.removeObjectEvent(e,r.selector,r.callback,r.tag),r):null},e.prototype.triggerCall=function(e){return this._eventSelectors.app.trigger(e,!0)},e.prototype.bindCallObj=function(e,t,i,r,n,o,a,s){if(!(e=Te.toLowerCase(e)))return console.error("event type is invalid, please check it"),null;var l=Te.parseEvent(t,i,r,o,s);if(!l)return null;var c=this;return n.forEach(function(t){c._eventSelectors.objectEvents.bindObjectEvent(e,l.selector,l.userData,l.callback,l.priority,l.tag,a,t)}),l},e.prototype.unbindCallObj=function(e,t,i,r){e=Te.toLowerCase(e);var n=Te.parseEvent(t,null,i);if(!n)return null;var o=this;return r.forEach(function(t){o._eventSelectors.objectEvents.removeObjectEvent(e,n.selector,n.callback,n.tag,t)}),n},e.prototype.hasAnyCallObjects=function(e,t){var i=this._eventSelectors.objectEvents,r=!1,n=this;return i.traverse(function(i,o){if(o.object&&e.indexOf(o.object)){if(t&&n._isPauseEvent(i,o.object,o.tag))return;return!(r=!0)}}),r},e.prototype.dispatchBindCallObj=function(e,t,i,r){if(t=t||{},e=Te.toLowerCase(e)){if(Te.isString(t)&&!r&&(r=t,t={}),!r||Te.isString(r)){var n;Te.isFunction(t.stopPropagation)||(t.stopPropagation=function(){this._stopPropagation=!0});var o=this;return i.forEach(function(i){var a=t.object,s=t.type,l=t.tag;t.object=i,t.type=e,t.tag=r,n=o._eventSelectors.objectEvents.trigger(t),t.object=a,t.type=s,t.tag=l}),n}console.error('Trigger "'+e+'" failed, due to tag is not string type')}else console.error("event type is invalid, please check it")},e.prototype.addResidentEventListener=function(e,t){(e=Te.toLowerCase(e))?this._eventSelectors.residentEvents._trigger.addEventListener(e,null,null,t):console.error("event type is invalid, please check it")},e.prototype.removeResidentEventListener=function(e,t){(e=Te.toLowerCase(e))?this._eventSelectors.residentEvents._trigger.removeEventListener(e,null,t):console.error("event type is invalid, please check it")},e.prototype.update=function(){this._eventSelectors.forEach(function(e){e.trigger({type:"update"})}),this._eventPauser.update()},e.prototype.clear=function(){this._eventSelectors.forEach(function(e){e.removeAllListeners()}),this._eventPauser.clear()},e.prototype.unbindAppEvents=function(e){this._eventSelectors.forEach(function(t){for(var i in t._listeners)for(var r=t._listeners[i],n=0;n<r.length;n++)r[n].app.uuid==e&&r.splice(n--,1)})},e.prototype.dispatchEvent=function(e){var t=[];if(this._eventSelectors.forEach(function(i){var r=i.trigger(e);r&&t.push(r)}),t.length)return t[0]},e}(),ho=function(){function e(t){r(this,e),this.app=t,this.eventTriggerManager=new uo(this.app),this.eventProcessor=new so(this.eventTriggerManager)}return e.prototype.addResidentEventListener=function(e,t){this.eventTriggerManager.addResidentEventListener(e,t)},e.prototype.removeResidentEventListener=function(e,t){this.eventTriggerManager.removeResidentEventListener(e,t)},e.prototype.addEventListener=function(e,t,i){this.eventTriggerManager.addEventListener(e,t,i)},e.prototype.removeEventListener=function(e,t){this.eventTriggerManager.removeEventListener(e,t)},e.prototype.dispatchEvent=function(e){return this.eventTriggerManager.dispatchEvent(e)},e.prototype.update=function(){this.eventTriggerManager.update()},e.prototype.bindCall=function(e,t,i,r,n,o,a){return this.eventTriggerManager.bindCall(e,t,i,r,n,o,a)},e.prototype.unbindCall=function(e,t,i){return"singleclick"==e&&this.eventProcessor.clearSingleClickTimer(),this.eventTriggerManager.unbindCall(e,t,i)},e.prototype.triggerCall=function(e){return this.eventTriggerManager.triggerCall(e)},e.prototype.bindCallObj=function(e,t,i,r,n,o,a,s){return this.eventTriggerManager.bindCallObj(e,t,i,r,n,o,a,s)},e.prototype.unbindCallObj=function(e,t,i,r){return this.eventTriggerManager.unbindCallObj(e,t,i,r)},e.prototype.hasAnyCallObjects=function(e,t){return this.eventTriggerManager.hasAnyCallObjects(e,t)},e.prototype.dispatchBindCallObj=function(e,t,i,r){return this.eventTriggerManager.dispatchBindCallObj(e,t,i,r)},e.prototype.isPauseEvent=function(e,t,i){return this.eventTriggerManager.isPauseEvent(e,t,i)},e.prototype.pauseEvent=function(e,t,i,r,n){this.eventTriggerManager.pauseEvent(e,t,i,r,n)},e.prototype.resumeEvent=function(e,t,i,r){return this.eventTriggerManager.resumeEvent(e,t,i,r)},e.prototype.hasEvent=function(e,t,i,r){return this.eventTriggerManager.hasEvent(e,null,i,r,t)},e.prototype.getEvents=function(e,t,i,r){return this.eventTriggerManager.getEvents(e,null,i,r,t)},e.prototype.replaceObjectEvent=function(e,t){return this.eventTriggerManager.replaceObjectEvent(e,t)},e.prototype.canClick=function(e){return!(4<this.eventProcessor.getDistanceOfLastMouseDown(e))},e.prototype.isKeyPressed=function(e){return!!this.eventProcessor.keysPressed[e]},e.prototype.clear=function(){this.eventTriggerManager.clear(),this.eventProcessor.clear()},e.prototype.unbindAppEvents=function(e){this.eventTriggerManager.unbindAppEvents(e)},n(e,[{key:"mousePosition",get:function(){return this.eventProcessor.mouseMovePos}}]),e}(),po=function(){function e(t,i,n){for(var o in r(this,e),this.app=t,this.name=i,this.defaultKeyName="name",this.initialState=null,this.runningState=null,this.states=new Map,n)this.addState(o,n[o])}return e.prototype.getFromState=function(e,t){var i=e[t.stateType];if(void 0!==i&&Te.isFunction(i)){var r=e[t.stateType](t);if(null!==r)return r}return null},e.prototype.dispatchEventToState=function(e,t){var i=e[t.stateType];void 0!==i&&Te.isFunction(i)&&e[t.stateType](t,t.params)},e.prototype.findState=function(e){return this.states.get(e)},e.prototype.prevState=function(){this.dispatchEvent({stateType:"onPrevState"})},e.prototype.nextState=function(){this.dispatchEvent({stateType:"onNextState"})},e.prototype.clone=function(t){var i={},r=this.app.stateManager.stateFactory,n=this.states.keys(),o=Array.isArray(n),a=0;for(n=o?n:n[Symbol.iterator]();;){var s;if(o){if(a>=n.length)break;s=n[a++]}else{if((a=n.next()).done)break;s=a.value}var l=s,c=r.get(l);if(!c)return null;i[l]=new c(this.app)}return new e(this.app,t,i)},e.prototype.get=function(e){if(this.runningState)return this.getFromState(this.runningState,e);if(1<this.states.length){var t=this.states,i=Array.isArray(t),r=0;for(t=i?t:t[Symbol.iterator]();;){var n;if(i){if(r>=t.length)break;n=t[r++]}else{if((r=t.next()).done)break;n=r.value}var o=n,a=this.getFromState(o,e);if(null!==a)return a}}return null},e.prototype.dispatchEvent=function(e){var t=this;this.runningState?this.dispatchEventToState(this.runningState,e):1<this.states.length&&this.states.forEach(function(i){t.dispatchEventToState(i,e)})},e.prototype.enter=function(e,t){t=t||{};var i=this.findState(e);if(!i)return null;this.initialState||(this.initialState=i);var r=this.runningState;return this.leave(),this.app.trigger("beforeEnterState",{state:r,nextState:i}),r&&(t.prevState=r),this.runningState=i,this.dispatchEventToState(this.runningState,{stateType:"onEnter",params:t}),this.app.trigger("afterEnterState",{state:i,prevState:t.prevState}),delete t.prevState,this.runningState},e.prototype.leave=function(){if(this.runningState){var e={};this.runningState&&(e.state=this.runningState,e.stateName=this.runningState[this.defaultKeyName]),this.app.trigger("beforeLeaveState",e),this.dispatchEventToState(this.runningState,{stateType:"onLeave"}),this.runningState=null,this.app.trigger("afterLeaveState",e)}},e.prototype.addState=function(e,t){void 0===t[this.defaultKeyName]&&(t[this.defaultKeyName]=e),t.isState=!0,(t.stateGroup=this).states.set(e,t)},e.prototype.isInitialState=function(){return this.runningState==this.initialState},e.prototype.isRunningState=function(e){var t=this.findState(e);return!!t&&t==this.runningState},e.prototype.getRunningStateName=function(){if(this.runningState){var e=this.states.keys(),t=Array.isArray(e),i=0;for(e=t?e:e[Symbol.iterator]();;){var r;if(t){if(i>=e.length)break;r=e[i++]}else{if((i=e.next()).done)break;r=i.value}var n=r;if(this.runningState==this.states.get(n))return n}}return""},e.prototype.hasState=function(e){if(Te.isString(e))return this.states.has(e);var t=this.states.keys(),i=Array.isArray(t),r=0;for(t=i?t:t[Symbol.iterator]();;){var n;if(i){if(r>=t.length)break;n=t[r++]}else{if((r=t.next()).done)break;n=r.value}var o=n;if(e==this.states.get(o))return!0}return!1},e.prototype.clear=function(){this.leave();for(var e=[].concat(this.states.values()),t=0;t<e.length;t++)delete e[t];delete this.states},e}(),fo=function(){function e(t){r(this,e),this.app=t,this.eventManager=t.events,this.stateFactory=new Map,this.stateGroupID=1,this.stateGroups=new Array,this.init()}return e.prototype.init=function(){var e={click:"onClick",dblclick:"onDoubleClick",singleclick:"onSingleClick",mouseover:"onMouseOver",mouseout:"onMouseOut",mouseup:"onMouseUp",mousedown:"onMouseDown",mousemove:"onMouseMove",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",keydown:"onKeyDown",keypress:"onKeyPress",keyup:"onKeyUp"},t=this;for(var i in e)this.eventManager.addResidentEventListener(i,function(i){i.stateType=e[i.type],t.dispatchEvent(i),delete i.stateType})},e.prototype.clear=function(){this.stateFactory.clear(),this.stateGroupID=1,this.stateGroups=[]},e.prototype.findState=function(e){var t=this.stateGroups,i=Array.isArray(t),r=0;for(t=i?t:t[Symbol.iterator]();;){var n;if(i){if(r>=t.length)break;n=t[r++]}else{if((r=t.next()).done)break;n=r.value}var o=n.findState(e);if(o)return o}return null},e.prototype.findStateGroup=function(e){var t=this.stateGroups,i=Array.isArray(t),r=0;for(t=i?t:t[Symbol.iterator]();;){var n;if(i){if(r>=t.length)break;n=t[r++]}else{if((r=t.next()).done)break;n=r.value}var o=n;if(o.name==e||o.hasState(e))return o}return null},e.prototype.get=function(e){for(var t=0;t<this.stateGroups.length;t++){var i=this.stateGroups[t].get(e);if(i)return i}return null},e.prototype.dispatchEvent=function(e){Te.isString(e)?this.dispatchEvent({type:e}):this.stateGroups.forEach(function(t){t.dispatchEvent(e)})},e.prototype._genGroupName=function(){var e="StateManagerInternal_"+this.stateGroupID.toString();return this.stateGroupID++,e},e.prototype.clone=function(e){var t=this.findStateGroup(e);if(!t)return null;e=this._genGroupName();var i=t.clone(e);return this.stateGroups.push(i),i},e.prototype.remove=function(e){for(var t=0;t<this.stateGroups.length;t++)if(this.stateGroups[t]==e)return e.leave(),this.stateGroups[t].clear(),this.stateGroups.splice(t,1),!0;return!1},e.prototype.register=function(e,t){if(Te.isNull(e))return null;if(Te.isArray(e))return console.error("states should not be array type, use {} instead"),null;var i=Object.keys(e);1==i.length&&void 0===t&&(t=i[0]),Te.isBlank(t)&&(t=this._genGroupName());var r=this.findStateGroup(t);if(r)for(var n in e)r.addState(n,e[n]);else r=new po(this.app,t,e),this.stateGroups.push(r);return r},e.prototype.registerEx=function(e,t){for(var i in e)this.stateFactory.set(i,e[i]),e[i]=new e[i](this.app);return this.register(e,t)},e.prototype.unregister=function(e){for(var t=0;t<this.stateGroups.length;t++)if(this.stateGroups[t].name==e)return this.stateGroups[t].clear(),this.stateGroups.splice(t,1),!0;return!1},e.prototype.change=function(e,t){var i=this.findStateGroup(e);return i?i.enter(e,t)||null:(console.error("state group not found: "+e),null)},e.prototype.leave=function(e){var t=this.findStateGroup(e);return t?!!t.isRunningState(e)&&(t.leave(),!0):(console.error("state group not found: "+e),!1)},e.prototype.getRunningState=function(e){var t=this.findStateGroup(e);return t?t.runningState:(console.error("state group not found: "+name),null)},e.prototype.getRunningStateName=function(e){var t=this.findStateGroup(e);return t?t.getRunningStateName():(console.error("state group not found: "+name),null)},e.prototype.hasRunningState=function(e){var t=this.findStateGroup(e);return!!t&&!!t.runningState},e.prototype.update=function(){this.dispatchEvent({stateType:"onUpdate"})},e.prototype.onUpdate=function(e){this.update(e)},e}(),mo=function(){function e(t,i){r(this,e),this.app=t,this.reverseMode=i,this.commands=[]}return e.prototype.execute=function(){for(var e=0;e<this.commands.length;e++)this.commands[e].execute();this.app.events.dispatchEvent({type:"executeCommand",cmd:this}),this.reverseMode&&this.commands.reverse()},e.prototype.undo=function(){for(var e=0;e<this.commands.length;e++)this.commands[e].undo();this.reverseMode&&this.commands.reverse()},e.prototype.add=function(e){e&&this.commands.push(e)},e.prototype.remove=function(e){if(e){var t=this.commands.indexOf(e);-1<t&&this.commands.slice(t,1)}},e.prototype.clear=function(){this.commands.clear()},e}(),go=function(){function e(t){r(this,e),this.app=t,this.registerTypes={},this.undoList=[],this.redoList=[],this._doing=!1}return e.prototype.register=function(e,t){this.registerTypes[e]=t},e.prototype.unregister=function(e){delete this.registerTypes[e]},e.prototype._create=function(e){var t=e.type,i=this.registerTypes[t];if(i){e.app=this.app;var r=new i(e);return r.type=t,r}console.error("command not found: "+t)},e.prototype.create=function(e,t){if(Te.isArray(e)){for(var i=new mo(this.app,t),r=0;r<e.length;r++){var n=this._create(e[r]);i.add(n)}if(i.commands.length)return i}else{if(Te.isObject(e))return this._create(e);Te.isString(e)}return null},e.prototype.execute=function(e,t){var i=this.create(e,t);return i?(i.execute(),this._push(i),this.app.events.dispatchEvent({type:"executeCommand",cmd:i}),i):null},e.prototype._push=function(e){this._doing||(this.undoList.push(e),this.redoList.splice(0,this.redoList.length),this.app.events.dispatchEvent({type:"push"}))},e.prototype.push=function(e){this._push(e)},e.prototype.redo=function(){if(0!=this.redoList.length){this._doing=!0;var e=this.redoList.pop();e.execute(),this.undoList.push(e),this.app.events.dispatchEvent({type:"executeCommand",cmd:e}),this.app.events.dispatchEvent({type:"redo",cmd:e}),this._doing=!1}},e.prototype.undo=function(){if(0!=this.undoList.length){this._doing=!0;var e=this.undoList.pop();e.undo(),this.redoList.push(e),this.app.events.dispatchEvent({type:"executeCommand",cmd:e}),this.app.events.dispatchEvent({type:"undo",cmd:e}),this._doing=!1}},e.prototype.getRedoCount=function(){return this.redoList.length},e.prototype.getUndoCount=function(){return this.undoList.length},e.prototype.toJson=function(){for(var e=0;e<this.undoList.length;e++)this.undoList[e];return"not impl~"},e}(),vo=function(){function e(t){r(this,e),this.app=t,this.events=t.events,this.baseURL=t.baseURL,this.scene=t.scene,this.renderer=t.renderer,this.objectManager=t.objectManager,this.resourceManager=t.resourceManager,this._background=null,this._backgroundResource=null,this._backgroundAdditiveColor=new THREE.Color(0,0,0),this._backgroundColorScaleFactor=new THREE.Vector3(1,1,1),this._skyBox=null,this._skyBoxResource=null,this._fogEnable=!1,this._fogConfig={},this._fogLinear=null,this._fogExp2=null,this._enableDeafultViewPointFile=!1,this._defaultViewPointFileName="viewpoint.json",this._effectRefCounts={},this.init()}return e.prototype.init=function(){this.initRenderControl()},e.prototype.initRenderControl=function(){var e=new THREE.Vector3,t=new THREE.Vector3;function i(i,r){i.node.traverse(function(n){if(n.material){e.setFromMatrixPosition(r.matrixWorld),t.setFromMatrixPosition(n.matrixWorld);var o=e.distanceTo(t);0<i.renderDistance&&(n.visible=o<i.renderDistance),0<i.shadowDistance&&(n.castShadow=o<i.shadowDistance)}})}var r=this;this.app.scene.onBeforeRender=function(){var e=r.app.renderCamera;r.objectManager.renderDistanceObjects.forEach(function(t){i(t,e)}),r.objectManager.shadowDistanceObjects.forEach(function(t){i(t,e)})}},e.prototype.synBackgroundColor=function(){var e=this._skyBoxResource;if(e&&e.isCubeTexture){e.colorMatrix=e.colorMatrix||new THREE.Matrix4;var t=this._backgroundAdditiveColor;if(t){var i=new THREE.Vector3(t.r,t.g,t.b);e.colorMatrix.setPosition(i)}var r=this._backgroundColorScaleFactor;if(r){var n=new THREE.Vector3(r.x,r.y,r.z);e.colorMatrix.setScale(n)}}},e.prototype._keepBackgroundAspect=function(){if(this._backgroundResource&&this._backgroundResource.isTexture){var e=this._backgroundResource,t=this.app.renderer.getSize(),i=t.width/t.height,r=e.image.width/e.image.height;r<i?(e.offset.set(0,.5-r/i*.5),e.repeat.set(1,r/i)):(e.offset.set(.5-i/r*.5,0),e.repeat.set(i/r,1))}},e.prototype._resetBackgroundAspect=function(){if(this._backgroundResource&&this._backgroundResource.isTexture){var e=this._backgroundResource;e.offset.set(0,0),e.repeat.set(1,1)}},e.prototype.closeSkyEffect=function(){this.setSkyEffect(null)},e.prototype.setSkyEffect=function(e){e?(this._skyEffect||(this._skyEffect=this.app.create({type:"SkyEffect",parent:this.app.root})),this._skyEffect.setConfig(e),this.app._lightGroup&&(this.app._lightGroup.visible=!this._skyEffect.getConfig().light)):(this._skyEffect&&(this._skyEffect.visible=!1),this.app._lightGroup&&(this.app._lightGroup.visible=!0))},e.prototype.setFogLinear=function(e,t,i){e=Te.parseColor(e),this._fogLinear?(this._fogLinear.color.set(e),this._fogLinear.near=t,this._fogLinear.far=i):this._fogLinear=new THREE.Fog(e,t,i),this.app.scene.fog=this._fogLinear},e.prototype.clearFogLinear=function(){this._fogLinear&&(this._fogLinear=null,this.app.scene.fog=null)},e.prototype.setFogExp2=function(e,t){e=Te.parseColor(e),this._fogExp2?(this._fogExp2.color.set(e),this._fogExp2.density=t):this._fogExp2=new THREE.FogExp2(e,t),this.app.scene.fog=this._fogExp2},e.prototype.clearFogExp2=function(){this._fogExp2&&(this._fogExp2=null,this.app.scene.fog=null)},e.prototype.closeFog=function(){this.clearFogLinear(),this.clearFogExp2(),this._fogEnable=!1},e.prototype.setFog=function(e){e=e||{},this._fogConfig=Te.mergeObject(this._fogConfig,e,!0);var t=e.type,i=e.color||8421504;if("Exp2"==t){var r=e.density||.1;this.setFogExp2(i,r)}else{var n=e.near||10,o=e.far||100;this.setFogLinear(i,n,o)}this._fogEnable=!0,this.app.needUpdate=!0},e.prototype._updatEffectRefCounts=function(e,t){void 0===this._effectRefCounts[e]&&(this._effectRefCounts[e]=0);var i=this._effectRefCounts[e];this._effectRefCounts[e]+=t;var r=this.app.rendererManager._mainRenderer;0==i&&0<t?Te.isFunction(r.enable)&&r.enable(e):0<i&&0==this._effectRefCounts[e]&&Te.isFunction(r.disable)&&r.disable(e)},e.prototype.onResize=function(e,t){if(this._backgroundResource&&this._backgroundResource.isCanvasTexture){var i=this._backgroundResource,r=e/t,n=i.image.width/i.image.height;r<n?(i.offset.set(0,.5-n/r*.5),i.repeat.set(1,n/r)):(i.offset.set(.5-r/n*.5,0),i.repeat.set(r/n,1))}},e.prototype.onUpdate=function(e){this._backgroundResource&&this._backgroundResource.isCanvasTexture&&(this._backgroundResource.needsUpdate=!0)},e.prototype.showLightHelper=function(e){console.warn("[SceneManager] Please use app.lighting={ showHelper: "+e+" } instead"),this.app._lightGroup.setConfig({showHelper:e})},e.prototype.closeSceneLights=function(){console.warn("[SceneManager] Please use app.lighting=null instead"),this.app._lightGroup.setConfig(On)},n(e,[{key:"background",set:function(e){if(this.background!=e){if(this._skyBox=null,this._backgroundResource&&this._backgroundResource.name!=e&&(this._backgroundResource.isTexture&&this._backgroundResource.dispose(),this._backgroundResource=null),this._background=e){var t=Te.parseColor(e,null);if(t)this.scene.background=t,this._backgroundResource=t;else if(Te.isString(e))if(this._backgroundResource)this.scene.background=this._backgroundResource;else var i=this.app.confirmURL(e),r=this,n=(new THREE.TextureLoader).load(i,function(){r.scene.background=n,r._backgroundResource=n,r._backgroundResource.name=e,r.app.keepBackgroundAspect?r._keepBackgroundAspect():r._resetBackgroundAspect()});else"CANVAS"==e.tagName&&(this._backgroundResource=new THREE.CanvasTexture(e),this._backgroundResource.needsUpdate=!0,this.scene.background=this._backgroundResource)}else this.scene.background=Te.parseColor(this.app._bgColor);this.app.trigger("backgroundChanged",{background:e})}},get:function(){return this._background}},{key:"backgroundAdditiveColor",set:function(e){this._backgroundAdditiveColor=Te.parseColor(e),this.synBackgroundColor()},get:function(){return this._backgroundAdditiveColor.toHexString()}},{key:"backgroundColorScaleFactor",set:function(e){this._backgroundColorScaleFactor=Te.parseVector3(e),this.synBackgroundColor()},get:function(){return this._backgroundColorScaleFactor.toArray()}},{key:"skyBox",set:function(e){if(this.skyBox!=e){var t;this._background=null,this._skyBox=e,this.app.trigger("skyboxchange",{skyBox:e}),this._skyBoxResource&&(t=this._skyBoxResource.name==e?null:this._skyBoxResource);var i=this.app.confirmURL(Te.parseCubeTextureUrls(e));if(i)if(t||void 0===t)var r=this,n=(new THREE.CubeTextureLoader).load(i,function(i){if(r._skyBox==e){var o=i.image;if(o&&6===o.length){for(var a=o[0].width,s=o[0].height,l=1;l<o.length;l++){var c=o[l];if(c.width!=a||c.height!=s)return void console.error("Load sky box failed, due to image size is invalid, please make sure all size of images must be the same")}n.format=THREE.RGBFormat,r.scene.background=n,r._skyBoxResource=n,r._skyBoxResource.name=e,r.synBackgroundColor(),t&&t.dispose()}}});else this.scene.background=this._skyBoxResource;else this.scene.background=Te.parseColor(this.app._bgColor)}},get:function(){return this._skyBox}},{key:"enableDeafultViewPointFile",set:function(e){this._enableDeafultViewPointFile=e},get:function(){return this._enableDeafultViewPointFile}},{key:"defaultViewPointFileName",set:function(e){this._defaultViewPointFileName=e},get:function(){return this._defaultViewPointFileName}},{key:"fogEnable",get:function(){return this._fogEnable}},{key:"skyEffectEnable",get:function(){return!!this.sky}}]),e}(),yo=function(){function e(t,i){r(this,e),this.app=t,this.textures=new Map,this._canvas=null,this._enableFileNameAsKey=i,this.loader=new THREE.TextureLoader(this.app.loadingManager)}return e.prototype.isPowerOf2=function(e){return j.isPowerOf2(e.width)&&j.isPowerOf2(e.height)},e.prototype.makePowerOf2=function(e){return e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageBitmap?(this._canvas||(this._canvas=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),this._canvas.width=j.floorPowerOf2(e.width),this._canvas.height=j.floorPowerOf2(e.height),this._canvas.getContext("2d").drawImage(e,0,0,this._canvas.width,this._canvas.height),this._canvas):e},e.prototype.load=function(e,t,i,r){var n,o=e.getNormalize();n=this._enableFileNameAsKey?o.getFileName(!1):o;var a=this.textures.get(n);if(a)return a.refCount++,t&&(a.image?setTimeout(function(){t(a)},10):(a.delayLoadCallbacks=a.delayLoadCallbacks||[],a.delayLoadCallbacks.push(t))),a;var s=this;if(!(a=this.loader.load(o,function(e){var i=e.image,r=s.textures.get(e.key);if(r){var n=r.delayLoadCallbacks;if(n){for(var o=0;o<n.length;o++)n[o](e);r.delayLoadCallbacks=[]}}var a=s.app.options.maxTextureSize;(i.width>a||i.height>a)&&console.warn("The '"+i.src+"' texture is too big("+i.width+"x"+i.height+"), max size: ("+a+"x"+a+")"),t&&t(e)},i,r)))return null;a.key=n;var l=this.textures.get(n);return l?l.refCount++:(a.refCount=a.refCount||1,this.textures.set(n,a)),a},e.prototype.setCrossOrigin=function(e){return this.loader.setCrossOrigin(e),this},e.prototype.setPath=function(e){return this.loader.setPath(e),this},e.prototype.removeTexture=function(e){var t=this.textures.get(e.key);if(t){if(t.refCount&&t.refCount--,t.refCount)return!1;e.dispose(),this.textures.delete(e.key)}else e.dispose();return!0},e.prototype.loadFromImage=function(e){var t=this.textures.get(e);return t?t.refCount++:((t=new THREE.Texture).image=e,t.needsUpdate=!0,t.key=e),t},n(e,[{key:"enableFileNameAsKey",set:function(e){this._enableFileNameAsKey=e},get:function(){return this._enableFileNameAsKey}},{key:"repetitionRate",get:function(){if(!this.textures.size)return 0;var e=0;return this.textures.forEach(function(t){e+=t.refCount}),e/this.textures.size-1}}]),e}(),bo=function(){function e(t){r(this,e),this.app=t,this._deadObjects=[],this.init()}return e.prototype.init=function(){this.textureLoader=new yo(this.app),THREE.Loader.Handlers.add(/.*(.jpg|.png)$/,this.textureLoader)},e.prototype.disposeMaterial=function(e,t){if(void 0!==e.refCount){if(e.refCount--,e.refCount)return!1;e.dispose(),t||this.disposeTextures(e)}return!0},e.prototype.disposeTextures=function(e){if(e)for(var t in e){var i=e[t];i&&i.isTexture&&this.textureLoader.removeTexture(i)&&(e[t]=null)}},e.prototype.disposeGeometry=function(e){if(void 0!==e.refCount){if(e.refCount--,e.refCount)return!1;e.dispose()}else{if(this.app.scene.hasGeometry(e))return!1;e.dispose(),e._hasDisposed=!0}return!0},e.prototype.doDispose=function(e,t,i){if(null!==e){if(i&&!1===i(e))return!1;if(e.children)for(var r=e.children.concat(),n=0;n<r.length;n++)this.doDispose(r[n],t,i)&&e.remove(r[n]);var o=e.geometry;if(o&&!e.isSprite&&this.disposeGeometry(o),e.material){var a=!1;if(Te.isArray(e.material)){var s=e.material.concat();for(e.material=[],n=0;n<s.length;n++){var l=s[n];a=this.disposeMaterial(l,t)}}else a=this.disposeMaterial(e.material,t);a&&this.app.picker.removePickingResources(e)}e.isSkinnedMesh&&(t||this.disposeTextures(e.skeleton))}return!0},e.prototype.remove=function(e,t){e&&(e.removeBySelf(),this.unload(e,t))},e.prototype.unload=function(e,t,i){var r=!(3<arguments.length&&void 0!==arguments[3])||arguments[3];e&&(e.isObject3D?r?this._deadObjects.push({node:e,keepTexture:t,filterFunc:i}):this.doDispose(e,t,i):console.error("must provide Object3D to unload"))},e.prototype.loadTexture=function(e){return Te.isString(e)?this.textureLoader.load(e):this.textureLoader.loadFromImage(e)},e.prototype.onUpdate=function(){if(this._deadObjects.length){var e=this._deadObjects[0];this.doDispose(e.node,e.keepTexture,e.filterFunc),this._deadObjects.splice(0,1)}},e}(),_o=function(){function e(t){r(this,e),this.app=t;var i=this;this.loadingManager=new THREE.LoadingManager(function(){},function(e,t,r){0!=r&&i.app.mainUI.updateDownloadingProgress(t/r)},function(e){console.error("[onError] url: "+e)})}return e.prototype.itemStart=function(e){this.loadingManager.itemStart(e)},e.prototype.itemEnd=function(e){this.loadingManager.itemEnd(e)},e.prototype.itemError=function(e){this.loadingManager.itemError(e)},e.prototype.resolveURL=function(e){return this.loadingManager.resolveURL(e)},e.prototype.setURLModifier=function(e){return this.loadingManager.setURLModifier(e)},e}(),xo={temporalSuperSampling:{enable:!1,size:30},postEffect:{enable:!1,bloom:{enable:!1,strength:.14,radius:.4,threshold:.7},screenSpaceAmbientOcclusion:{enable:!1,radius:.2,quality:"medium",intensity:.8,temporalFilter:!0,ignoreTransparent:!1},colorCorrection:{enable:!0,exposure:0,brightness:0,contrast:1.15,saturation:1.2,gamma:1},vignette:{enable:!1,type:"blur",color:0,offset:1.5},blur:{enable:!1,radius:5,bounds:[[0,0,.5,.5],[.5,.5,1,1]]},FXAA:{enable:!1}}},Eo=function(){function e(t,i){r(this,e),this._manager=t,this._defaultConfig=Te.cloneObject(i,!1),this._config=Te.cloneObject(i,!1)}return e.prototype.setConfig=function(e){return this._config=Te.cloneObject(e,!1),this},e.prototype.getConfig=function(){return this._config},e.prototype.save=function(){return this._defaultConfig=Te.cloneObject(this._config,!1),this},e.prototype.mergeConfig=function(e){return e=Te.cloneObject(e,!1),Te.mergeObject(e,this._config),this._config=e,this},e.prototype.mergeWithSavedConfig=function(e){return e=Te.cloneObject(e,!1),Te.mergeObject(e,this._defaultConfig),this._config=e,this},e.prototype.lock=function(){return this._manager.lock(this),this},e.prototype.unlock=function(){return this._manager.unlock(this),this},e.prototype.update=function(e){return this._manager._update(this,e),this},e.prototype.active=function(e){return this._manager._active(this,e),this},e.prototype.destroy=function(){this._manager=null,this._config=null,this._defaultConfig=null},e}(),wo=function(e){function t(i){r(this,t);var n=a(this,e.call(this));(n.app=i).renderer.localClippingEnabled=!0;var o=i.renderer.getDrawingBufferSize();return n._mainRenderer=new Gt(o.width,o.height),n}return o(t,e),t.prototype.createControl=function(e){return new To(this,e)},t.prototype._active=function(t){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.app.root.box;t=e.prototype._active.call(this,t),this._mainRenderer.setConfig(t._config,i)},t.prototype._update=function(t){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.app.root.box,r=e.prototype._update.call(this,t);r&&this._mainRenderer.setConfig(r._config,i)},t.prototype.update=function(){this._mainRenderer.render(this.app.renderer,this.app.scene,this.app.renderCamera);var e=this.app.cssScene;e.children.length&&this.app.cssRenderer.render(e,this.app.renderCamera),this.app.picker.render(this.app.renderer)},t.prototype.resize=function(e,t){this.app.renderer.setSize(e,t),this.app.cssRenderer.setSize(e,t);var i=this.app.renderer.getDrawingBufferSize();this._mainRenderer.setSize(i.width,i.height)},t.prototype.replaceRenderer=function(e){this._mainRenderer=e,this._mainRenderer.setConfig(this.getCurrentControl()._config)},t.prototype.closePostEffect=function(){console.warn("[RendererManager] Please use app.postEffect={} instead"),this.app.renderEffects.mergeConfig({postEffect:{enable:!1}}).update()},n(t,[{key:"renderOutline",set:function(e){this._mainRenderer.enableOutline=e}},{key:"needUpdate",set:function(e){e&&this._mainRenderer.dirty()}},{key:"temporalSuperSampling",set:function(e){console.warn("[RendererManager] Please use app.postEffect={} instead"),this.app.renderEffects.mergeConfig({temporalSuperSampling:{enable:e}}).update()},get:function(){return console.warn("[RendererManager] Please use app.postEffect instead"),this.app.renderEffects.getConfig().temporalSuperSampling.enable}},{key:"SSAO",set:function(e){console.warn("[RendererManager] Please use app.postEffect={} instead"),this.app.renderEffects.mergeConfig({postEffect:{screenSpaceAmbientOcclusion:{enable:e}}}).update()},get:function(){return console.warn("[RendererManager] Please use app.postEffect instead"),this.app.renderEffects.getConfig().postEffect.screenSpaceAmbientOcclusion.enable}},{key:"postEffectEnable",get:function(){return console.warn("[RendererManager] Please use app.postEffect instead"),this.app.renderEffects.getConfig().postEffect.enable}}]),t}(function(){function e(){r(this,e),this._lockedControl=null,this._control=null}return e.prototype.createControl=function(e){return new Eo(this,e)},e.prototype.lock=function(e){this._lockedControl=e},e.prototype.unlock=function(e){this._lockedControl===e&&(this._lockedControl=null)},e.prototype.getActiveControl=function(){return this._control},e.prototype.getCurrentControl=function(){return this._lockedControl||this._control},e.prototype._active=function(e,t){return this._lockedControl!==e&&(this._control=e),this._lockedControl||this._control},e.prototype._update=function(e,t){var i=this.getCurrentControl();return i===e?i:null},e.prototype.destroy=function(){this._lockedControl=null,this._control=null},e}()),To=function(e){function t(i){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:xo;return r(this,t),a(this,e.call(this,i,n))}return o(t,e),t}(Eo),So=function(){function e(t){r(this,e),this.app=t,this.xmlhttp=null,this.time=1500,this.simulate=!0,this.url="",this.cache=!0,this._stop=!1,this._curInterval=null,this.callback=null}return e.prototype.start=function(e){if(this._stop=!1,(this.url=null)!=e&&(null!=e.interval&&(this.time=e.interval),null!=e.url&&(this.url=e.url),null!=e.simulate&&(this.simulate=e.simulate),null!=e.cache&&(this.cache=e.cache),null!=e.callback&&(this.callback=e.callback)),null==this.url||1==this.simulate){var t=parent.getUserPath();if(!t)return void console.log("Service Data Path Error");this.url=t}this._ajax(),console.log("Service startup complete")},e.prototype.stop=function(){this._stop=!0,null!=this._curInterval&&window.clearTimeout(this._curInterval),console.log("Service stop complete")},e.prototype._ajax=function(){var e,t=this;e=t.url,t.xmlhttp=null,window.XMLHttpRequest&&(t.xmlhttp=new XMLHttpRequest),null!=t.xmlhttp?(t.xmlhttp.onreadystatechange=function(){4==t.xmlhttp.readyState&&(200==t.xmlhttp.status?(function(e){var i;for(var r in i=1==Array.isArray(e)?e[0]:e){var n=t.app.query(r);if(0<n.length){var o=i[r];for(var a in o)n[0].attr(a,o[a])}}}(JSON.parse(t.xmlhttp.responseText)),null!=t.callback&&t.callback(t.xmlhttp.getResponseHeader("last-modified"))):console.log("Problem retrieving XML data:"+t.xmlhttp.statusText),0==t._stop&&(t._curInterval=window.setTimeout(function(){t._ajax()},t.time)))},0==t.cache&&(e=-1==e.lastIndexOf("?")?e+"?time="+(new Date).getTime():e+"&time="+(new Date).getTime()),t.xmlhttp.open("GET",e,!0),t.xmlhttp.send(null)):console.error("Your browser does not support XMLHTTP.")},e}(),Mo=function(){function e(t){r(this,e),this.app=t,this.viewPointList=[],this.timeoutNumer=null,this._flyCallback=null,this._playIndex=0,this.playLoop=!1,this._pickedObjects=new Set}return e.prototype.start=function(){var e=this;this.app.on(H.Pick,function(t){e._pickedObjects.add(t.object)})},e.prototype.create=function(e,t){null==e&&(e={name:""}),null==e.flyTime?e.flyTime=1e3:"string"==typeof e.flyTime&&(e.flyTime=Number(e.flyTime)),null==e.waitTime?e.waitTime=0:"string"==typeof e.waitTime&&(e.waitTime=Number(e.waitTime));var i=this._take(e);null==t?this.viewPointList.push(i):this.viewPointList.splice(t,0,i)},e.prototype.delete=function(e){0<=e&&e<this.viewPointList.length&&this.viewPointList.splice(e,1)},e.prototype.recover=function(e){try{var t=this,i=this.viewPointList[e],r=null;null!=i.events&&(r=function(){for(var e=i.events,r=0;r<e.length;r++){var n=e[r],o=t.app.query("#"+n.id);if(0<o.length)for(var a=0;a<n.event.length;a++)o[0].dispatch(n.event[a])}}),0!=i.waitTime?(null!=t.timeoutNumer&&clearTimeout(t.timeoutNumer),this.timeoutNumer=setTimeout(function(){t._fly(i,r),t.timeoutNumer=null},i.waitTime)):this._fly(i,r)}catch(e){console.log(e)}},e.prototype.update=function(e,t,i){if(null!=e){null==t&&(t={}),"string"==typeof t.flyTime&&(t.flyTime=Number(t.flyTime)),"string"==typeof t.waitTime&&(t.waitTime=Number(t.waitTime));var r={};return i?r=this._take(t,e):(r=this.viewPointList[e],null!=t.flyTime&&(r.flyTime=t.flyTime),null!=t.waitTime&&(r.waitTime=t.waitTime),null!=t.flyTime&&(r.name=t.name)),this.viewPointList[e]=r}},e.prototype.play=function(e){null!=e&&(this.playLoop=e),this._playIndex=0,this._flyCallback=null,0<this.viewPointList.length&&this._next()},e.prototype.pause=function(e){void 0===e&&(e=!0),e?(null!=this.timeoutNumer&&clearTimeout(this.timeoutNumer),this.app.camera.flying&&this.app.camera.stopFlying()):0<this.viewPointList.length&&this._next()},e.prototype.swap=function(e,t){var i=this.viewPointList[e][e];return this.viewPointList[e][e]=this.viewPointList[e][t],this.viewPointList[e][t]=i,this.viewPointList[e]},e.prototype.stop=function(){null!=this.timeoutNumer&&clearTimeout(this.timeoutNumer),this.app.camera.flying&&this.app.camera.stopFlying(),this._flyCallback=null,this._pickedObjects.clear()},e.prototype.saveJSON=function(){var e={name:"",pointList:this.viewPointList};return JSON.stringify(e)},e.prototype.loadJSON=function(e){var t=e;"string"==typeof e&&(t=JSON.parse(e)),null!=t.pointList&&(this.viewPointList=t.pointList)},e.prototype.clearAll=function(){stop(),this.viewPointList=[]},e.prototype._take=function(e,t){var i={};null!=t&&(i=this.viewPointList[t]),null!=e.flyTime&&(i.flyTime=e.flyTime),null!=e.waitTime&&(i.waitTime=e.waitTime),null!=e.name&&(i.name=e.name),i.position=this.app.camera.position,i.target=this.app.camera.target,i.up=this.app.camera.up,i.image=this.app.captureScreenshotToImage(140,118,"jpeg",.1);var r=this._getPickedEvents();return 0<r.length&&(i.events=r),i},e.prototype._getPickedEvents=function(){for(var e=[],t=this._pickedObjects,i=0,r=t.length;i<r;i++){var n=t[i];if(n){var o={id:n.id,event:[]};n.hasEvent("click")&&o.event.push("click"),n.hasEvent("singleclick")&&o.event.push("singleclick"),0!=o.event.length&&e.push(o)}}return this._pickedObjects.clear(),e},e.prototype._fly=function(e,t){var i=this,r={position:e.position,target:e.target,time:e.flyTime,complete:function(e){null!=t&&t(),null!=i._flyCallback&&i._flyCallback()}};e.up&&(r.up=e.up),i.app.camera.flyTo(r)},e.prototype._next=function(){var e=this;if(this._playIndex>this.viewPointList.length-1){if(0==this.playLoop)return void(this._flyCallback=null);this.play()}this._flyCallback=function(){e._playIndex+=1,e._next()},this.recover(this._playIndex)},e}(),Ro=function(){function e(t){r(this,e),this.app=t,this._modelBaseURL="https://model.3dmomoda.cn/models/",this._objectLoader=new Ii(t)}return e.prototype.initOptions=function(e){this.app.resourceManager.textureLoader},e.prototype.parseDoorOrWindow=function(e,t,i){var r=this;function n(e,t){var i=r.app.objectManager.create({type:"Door",id:t.id,name:t.name,node:t.delayObject,parent:e,animations:t.resource.animations,properties:t.properties});if(t.isOpen&&i.open(),i.animationClips)for(var n=0;n<i.animationClips.length;n++){var o=i.animationClips[n];if("_defaultAnim_"===o.name){i.playAnimation({name:o.name,loop:!0,speed:.15});break}}return i}t.mesh?n():t.initCompleteCallback=function(t){var i=n(e,t);e.miscNode.add(i.node)}},e.prototype.parseWall=function(e,t,i){for(var r=0;r<t.doorOrWindows.length;r++){var n=t.doorOrWindows[r];this.parseDoorOrWindow(e,n,i)}},e.prototype.parseGroups=function(e,t,i){for(var r=0;r<t.groups.length;r++){var n=t.groups[r],o="Thing";n.jsonData&&n.jsonData.type&&(o=n.jsonData.type),this.app.objectManager.create({id:n.id,name:n.name,node:n.delayObject,type:o,parent:e,properties:n.properties})}},e.prototype.parsePlacements=function(e,t,i){for(var r=0;r<t.placements.length;r++){var n=t.placements[r],o="Thing";if(n.jsonData&&n.jsonData.type&&(o=n.jsonData.type),n.mesh){var a=this.app.objectManager.create({id:n.id,type:o,name:n.name,node:n.delayObject,parent:e,url:n.resource.getModelUrl(),animations:n.resource.animations,properties:n.properties});if(a.bundleID=n.resource.modelID,a.bundleName=n.resource.modelName,n.isPlayAnim&&a.containAnimation(n.animClip)){var s={name:n.animClip,loop:!1,speed:.15};n.hasSkin&&(s.loop=!0),a.playAnimation(s)}}}},e.prototype.parseRooms=function(e,t,i){for(var r=0;r<t.rooms.length;r++){var n=t.rooms[r];this.app.objectManager.create({type:"Room",name:n.name,node:n.mesh,ceilingNode:n.ceiling.mesh,roofNode:n.roof.mesh,floorNode:n.floor.mesh,parent:e,properties:n.properties})}},e.prototype.parsePlan=function(e,t,i){for(var r=new THREE.Object3D("combineFloor"),n=0;n<t.combineFloors.length;n++){var o=t.combineFloors[n];r.add(o)}e.node.add(r),e.floorNode=r;var a=new THREE.Object3D("combineCeiling");for(n=0;n<t.combineCeilings.length;n++){var s=t.combineCeilings[n];a.add(s)}e.node.add(a),e.ceilingNode=a;var l=new THREE.Object3D("combineRoof");for(n=0;n<t.combineRoofs.length;n++){var c=t.combineRoofs[n];l.add(c)}e.node.add(l),e.roofNode=l;var u=new THREE.Object3D("combinePlacement");for(n=0;n<t.combinePlacements.length;n++){var h=t.combinePlacements[n];u.add(h)}e.node.add(u),e.miscNode=u;for(var p=new THREE.Object3D("combineWall"),d=0;d<t.combineStraightManualWalls.length;d++){var f=t.combineStraightManualWalls[d];p.add(f)}for(d=0;d<t.combineModelWalls.length;d++)f=t.combineModelWalls[d],p.add(f);for(d=0;d<t.combineDoorOrWins.length;d++)h=t.combineDoorOrWins[d],p.add(h);e.node.add(p),e.wallNode=p},e.prototype.parseFloor=function(e,t,i){var r=t.buildings[0].floorplans[0];this.parsePlan(e,r,i),this.parseGroups(e,r,i),this.parsePlacements(e,r,i),this.parseRooms(e,r,i);for(var n=0;n<r.walls.length;n++){var o=r.walls[n];this.parseWall(e,o,i)}},e.prototype._generateWindow=function(e,t){var i=void 0!==e.typeId?e.typeId:"15DA293545E84A3680F93CF7D4227BD9";this.app.create({type:"Door",name:e.key,url:this._modelBaseURL+i+"/0/gltf/",localPosition:[.01*e.pos[0],3*e.suspendpercent,.01*e.pos[1]],parent:t,complete:function(){this.scale=[.01*e.width/this.boundingBox.initSize[0],.01*e.height/this.boundingBox.initSize[1],1],this.angles=[0,-e.rotation,0]}})},e.prototype._generateDoor=function(e,t){var i=void 0!==e.typeId?e.typeId:"d8ff0aaa4e87439bbededc8c6590491c";this.app.create({type:"Door",name:e.key,url:this._modelBaseURL+i+"/0/gltf/",localPosition:[.01*e.pos[0],0,.01*e.pos[1]],parent:t,complete:function(){this.scale=[.01*e.width/this.boundingBox.initSize[0],.01*e.height/this.boundingBox.initSize[1],1],this.angles=[0,-e.rotation,0]}})},e.prototype.parseDoorsAndWindows=function(e,t,i){var r=this;t.doors.forEach(function(t){t.suspendpercent?r._generateWindow(t,e):r._generateDoor(t,e)})},e.prototype.load=function(e,t,i){t=this.app.confirmURL(t);var r=this;new THREE.FileLoader(this.app.loadingManager).load(t+"/scene.json",function(t){var n=JSON.parse(t);r.loadFromData(e,n,i)})},e.prototype.loadFromData=function(e,t,i){var r=this;i=i||{},this.initOptions(i);var n,o,a,s=(o={version:"2",unit:1,walls:[],rooms:[],doors:[],textures:[],models:[]},a=(n=t).structure,o.textures=n.textures,o.models=n.models,o.walls=a.walls.map(function(e){return void 0===e.sourceType?{weight:e.thickness,start:[100*e.points[0],100*e.points[1]],end:[100*e.points[2],100*e.points[3]],height:e.height,type:0,model:0,lefttexture:0,righttexture:0,edgetexture:1}:{weight:e.thickness,start:[100*e.points[0],100*e.points[1]],end:[100*e.points[2],100*e.points[3]],height:e.height,type:e.sourceType,model:e.model,lefttexture:e.lefttexture,righttexture:e.righttexture,edgetexture:e.edgetexture}}),o.rooms=a.rooms.map(function(e){var t={points:[],holes:[],center:[100*e.textLoc[0],100*e.textLoc[1]]};return e.polygons.forEach(function(e,i){for(var r=0===i?t.points:[],n=0;n<e.length/2;n++)r.push([100*e[2*n+0],100*e[2*n+1]]);0!==i&&t.holes.push(r)}),t}),a.doors.forEach(function(e){var t=a.walls[e.wallIndex];e.loc;var i=[t.points[0],t.points[1]],r=[t.points[2],t.points[3]],n=[100*(i[0]+(r[0]-i[0])*e.loc),100*(i[1]+(r[1]-i[1])*e.loc)],s=o.models[e.typeIndex],l={key:e.key,typeId:s.id,width:100*e.size[0],height:100*e.size[2],pos:n,rotation:Ao(t)};o.doors.push(l)}),a.windows.forEach(function(e){var t=a.walls[e.wallIndex],i=[t.points[0],t.points[1]],r=[t.points[2],t.points[3]],n=[100*(i[0]+(r[0]-i[0])*e.loc),100*(i[1]+(r[1]-i[1])*e.loc)],s=o.models[e.typeIndex],l={key:e.key,typeId:s.id,width:100*e.size[0],height:100*e.size[2],suspendpercent:.4,pos:n,rotation:Ao(t)};o.doors.push(l)}),o),l=i.complete;json2mesh.DefaultSetting.enableFloorLightMap=Te.parseValue(i.enableFloorLightMap,!1);var c=this._createLoader(s.version);c.delayLoad({json:s}).then(function(t){r.parseFloor(e,t,i)}).then(function(){return c.loadResources()}).then(function(){r.parseDoorsAndWindows(e,s,i)}).then(function(){var i=[];for(var n in t.objects)t.objects[n].forEach(function(n){i=i.concat(r._objectLoader.parse(n,t,e))});return Promise.all(i)}).then(function(){l&&l(e)}).catch(function(e){return console.warn(e)})},e.prototype._createLoader=function(e){return e&&2<=new Bi(e).major?new json2mesh.ThingjsEditorSceneLoader_2_0:new json2mesh.ThingjsEditorSceneLoader},e}(),Po=new THREE.Vector2;function Ao(e){return Po.set(e.points[0]-e.points[2],e.points[1]-e.points[3]),Po.angle()/Math.PI*180}var Co=function(){function e(t){r(this,e),this.app=t,this._loading=!1,this._updateTime=0,this._loadingFloors=[],this._initEvents()}return e.prototype._initEvents=function(){var e=this;this.app.on("levelchange",function(t){var i=t.current;i instanceof ri?e._loadingFloors.sort(function(e,t){return e.owner.parent!=i?1:t.owner.parent!=i?-1:e.owner.indexOfBuilding-t.owner.indexOfBuilding}):i instanceof ii&&e._loadingFloors.sort(function(e,t){return e.owner==i?-1:t.owner==i?1:e.owner.node.id-t.owner.node.id})})},e.prototype.update=function(){if(this._loadingFloors.length&&!(this._loading||(this._updateTime+=this.app._deltaTime,this._updateTime<.25))){this._updateTime=0;var e=this._loadingFloors[0],t=e.owner,i=e.url,r=e.jsonData,n=e.options,o=this,a=n.complete;n.complete=function(e){a&&a(e),o._loading=!1},this._loading=!0;var s=new Ro(this.app);i?s.load(t,i,n):s.loadFromData(t,r,n),this._loadingFloors.splice(0,1)}},e.prototype.load=function(e,t,i){this._loadingFloors.push({owner:e,url:t,options:i})},e.prototype.loadFromData=function(e,t,i){this._loadingFloors.push({owner:e,jsonData:t,options:i})},e.prototype.onUpdate=function(e){this.update(e)},e}(),Oo=function(){function e(t){r(this,e),this.app=t,this._outputLog=!1}return e.prototype.outputPathLog=function(e){for(var t="",i=0;i<e.length;i++){var r=this.app.query("#"+e[i])[0];r&&(t+="("+r.type+":"+r.name+":"+r.id+")=>")}t=t._trimRight("=>"),console.log(t)},e.prototype._getParentObject=function(e,t){if(e.getNavigation(t))return e;for(var i=e.parents,r=0;r<i.length;r++){var n=i[r];if(n.getNavigation(t))return n}return null},e.prototype._getObject=function(e,t){var i=e.isFloor?e:e.parents.query(".Floor")[0];return i&&t?i.getRoomFromWorldPosition(t):e},e.prototype._getObjectRoot=function(e,t){function i(e,t){if(t==e)return e;if(t.isChildOf(e))return e;for(var i=e.parents,r=0;r<i.length;r++){var n=i[r];if(t==n)return n;if(t.isChildOf(n))return n}return null}var r=i(e,t),n=i(t,e);return r.isChildOf(n)?n:r},e.prototype._setupGraph=function(e,t){var i=this._getObjectRoot(e,t);if(!i)return null;for(var r=i;r;r=r.parent)if(Te.isFunction(r.setupGraph))return r.setupGraph();return null},e.prototype._buildPathes=function(e){for(var t=[],i=null,r=0;r<e.length;r++){var n=this.app.query("#"+e[r])[0];if(!n.isCampus){var o=n.parent;i!=o?(t.push({startObject:n,endObject:n}),i=o):t[t.length-1].endObject=n}}return t},e.prototype.findPath=function(e){var t=(e=e||{}).clipAreas,i=e.startObject||e.startRoom||e.start,r=e.endObject||e.endRoom||e.end;if(!i||!r)return console.error("Needs start and end objects to find path in navigation"),null;var n=e.startPosition||i.position,o=e.endPosition||r.position;if(!n||!o)return console.error("Needs start and end positions to find path in navigation"),null;var a=this._getParentObject(i,t),s=this._getParentObject(r,t);if(!a||!s)return console.error("The parents are not support navigation"),null;if(i=this._getObject(i,n),r=this._getObject(r,o),!i||!r)return console.error("The objects are not support navigation"),null;var l=this._setupGraph(a,s);if(!l)return null;var c=[];if(a==s){var u=a.findPath(n,o);if(!u)return null;c.push({entrance:a,points:u})}else{var h=l.findShortestPath(i.id,r.id);if(!h||!h.length)return null;this._outputLog&&this.outputPathLog(h);var p=this._buildPathes(h);if(!p.length)return null;var d,f=p[0].endObject;if(!(d=a.findPath(n,f.position)))return null;c.push({points:d,entrance:f});for(var m=1;m<p.length-1;m++){var g=p[m];if(g.startObject!=g.endObject){var v=this.findPath({startObject:g.startObject,endObject:g.endObject});if(!v)return null;c.push(v)}}var y,b=p[p.length-1].startObject;if(!(y=s.findPath(b.position,o)))return null;c.push({points:y,entrance:b})}return c},n(e,[{key:"outputLog",set:function(e){this._outputLog=e},get:function(){return this._outputLog}}]),e}(),Lo=function(){function e(t){r(this,e),this.app=t,this.renderer=null,this.enable=!1,this.interval=0,this.time=0,this.renderableNodes=[],this.renderableNodeIndex=0}return e.prototype.updateMeshes=function(){this.renderableNodeIndex=0,this.renderableNodes=[];var e=this;this.app.scene.traverseRenderableNodes(function(t){t.onBeforeRender=function(){e.renderableNodes.push({node:this,visible:this.visible}),this.visible=!1,this.onBeforeRender=function(){}}})},e.prototype.start=function(e,t){this.renderer=e,this.enable=!0,this.interval=t,this.renderableNodeIndex=0,this.updateMeshes()},e.prototype.end=function(){this.renderer=null,this.enable=!1;for(var e=this.interval=0;e<this.renderableNodes.length;e++){var t=this.renderableNodes[e].node,i=this.renderableNodes[e].visible;t.visible=i}this.renderableNodes=[]},e.prototype.dirty=function(){this.renderer.dirty()},e.prototype.setConfig=function(e){this.renderer.setConfig(e)},e.prototype.setSize=function(e,t){this.renderer.setSize(e,t)},e.prototype.render=function(e,t,i){if(this.time+=this.app.deltaTime,this.time>=this.interval)if(this.time=0,this.renderableNodeIndex<this.renderableNodes.length-1){var r=this.renderableNodes[this.renderableNodeIndex++].node,n=0;new TWEEN.Tween({progress:0}).to({progress:1},.9*this.interval).onStart(function(){if(r.visible=!0,r._debugger_prevMaterial=r.material,Te.isArray(r._debugger_prevMaterial)){r.material=[];for(var e=0;e<r._debugger_prevMaterial.length;e++)r.material.push(r._debugger_prevMaterial[e].clone())}else r.material=r.material.clone();r.material.depthTest=!1,r.material.color=new THREE.Color(1,0,0),r.material.side=THREE.DoubleSide}).onUpdate(function(){this._object.progress>n&&(n+=.25,1==r.material.color.r?r.material.color.set(65280):r.material.color.set(16711680))}).onComplete(function(){r.material=r._debugger_prevMaterial,delete r._debugger_prevMaterial}).start()}else this.updateMeshes();this.renderer.render(e,t,i)},e}(),ko=function(){function e(t){r(this,e),this.app=t,this._renderStepByStep=!1,this._enable=!1,this.stats=null,this._statsFlag=0,this.panel=null,this.renderConfig={name:"",lights:!0,shadow:!0,wireframe:!1,renderStepByStep:!1,renderStepByStepInterval:500},this.pickConfig={name:"",raycaster:!1,objectID:"",nodeName:"",uuid:"",x:0,y:0,z:0,local_x:0,local_y:0,local_z:0,node:null},this.navigationConfig={name:"",enable:!1,showHelper:!1,positions:[],pathFinder:null,pathLines:[],objects:[]},this.rendererDebugger=new Lo(t),this.prevMainRenderer=null,window.performance=window.performance||{},performance.now=performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow||function(){return(new Date).getTime()}}return e.prototype.outputLog=function(){var e=Te.system.getBrowserInfo();e&&console.log("browser: ["+e.type+", "+e.version+"]");var t=Te.system.getOSVersion();t&&console.log("OSVersion: ["+t.type+", "+t.version+"]")},e.prototype.setupFunctions=function(e){var t=this;if(e){this._Box3_expandByPoint=THREE.Box3.prototype.expandByPoint,THREE.Box3.prototype.expandByPoint=function(e,i){if(isNaN(e.x)||isNaN(e.y)||isNaN(e.z)){console.error("point is NaN for box3::expandByPoint()"),console.error(i);var r=t.app.objectManager.getBaseObject(i);r&&console.error(r)}else this.min.min(e),this.max.max(e);return this};var i=function(){return t.app.renderer.context};this._WebGL2RenderingContext_shaderSource=WebGL2RenderingContext.prototype.shaderSource,WebGL2RenderingContext.prototype.shaderSource=function(e,r){return t._WebGL2RenderingContext_shaderSource.call(i(),e,r)},this._WebGL2RenderingContext_compileShader=WebGL2RenderingContext.prototype.compileShader,WebGL2RenderingContext.prototype.compileShader=function(e){return t._WebGL2RenderingContext_compileShader.call(i(),e)}}else THREE.Box3.prototype.expandByPoint=this._Box3_expandByPoint||THREE.Box3.prototype.expandByPoint,WebGL2RenderingContext.prototype.shaderSource=this._WebGL2RenderingContext_shaderSource||WebGL2RenderingContext.prototype.shaderSource,WebGL2RenderingContext.prototype.compileShader=this._WebGL2RenderingContext_compileShader||WebGL2RenderingContext.prototype.compileShader},e.prototype.setupEvents=function(e){var t=this;e?(this.app.domElement.onfocus=function(e){console.log("THING dom element focus on")},this.app.domElement.oninvalid=function(e){console.log("THING dom element invalid on")},this.app.domElement.onerror=function(e){console.log("THING dom element error on")},this.app.domElement.onsuspend=function(e){console.log("THING dom element suspend on")},this.app.on("update",function(){t.renderStepByStep=t.app.events.isKeyPressed(L.Shift),t.renderStepByStep&&(t.app._deltaTime=.001)},"debugger::setupEvents::update"),this.app.on("click",function(e){var i=t.pickConfig;i.x=0,i.y=0,i.z=0,i.local_x=0,i.local_y=0,i.local_z=0;var r=e.pickedPosition;if(r&&(i.x=r[0],i.y=r[1],i.z=r[2]),i.objectID="",i.nodeName="",i.uuid="",e.intersect){if(l=e.intersect.object){i.objectID=l.id;var n=l.worldToSelf(r);n&&(i.local_x=n[0],i.local_y=n[1],i.local_z=n[2])}var o=e.intersect.node;o&&(i.nodeName=o.name.isBlank()?o.type:o.name,i.uuid=o.uuid)}var a=t.app.isKeyPressed(L.Ctrl),s=t.app.isKeyPressed(L.Alt);if(a){var l;if(l=e.object){console.log(l);var c=e.intersect.pickedNode;if(c){console.log(c);var u=t.app.objectManager.getBaseObject(c);u!=l&&console.log(u)}}if(s){var h=e.pickedPosition;h&&console.log("["+h.toString()+"]")}var p=t.navigationConfig;if(p.enable&&e.pickedPosition){var d=p.positions;d.push({object:e.object,position:e.pickedPosition});var f=p.objects;if(1===d.length){for(var m=0;m<f.length;m++)f[m].destroy();p.objects=[],f=p.objects;var g=t.app.create({type:"Sphere",position:e.pickedPosition,style:{color:65280}});f.push(g)}else if(2===d.length){p.pathFinder=p.pathFinder||new Oo(t.app),p.pathFinder.outputLog=!0;var v=p.pathLines;for(m=0;m<v.length;m++)v[m].destroy();p.pathLines=[],v=p.pathLines;var y={startObject:d[0].object,startPosition:d[0].position,endObject:d[1].object,endPosition:d[1].position,clipAreas:p.clipAreas};console.log("Start to find (["+y.startPosition+"]->["+y.endPosition+"]) path ...");var b=p.pathFinder.findPath(y);if(b)for(console.log("Found (["+y.startPosition+"]->["+y.endPosition+"]) path completed"),m=0;m<b.length;m++){var _=b[m],x=t.app.create({type:"RouteLine",image:"images/diffuse.jpg",points:_.points,style:{color:"#58DEDE"}});v.push(x)}var E=t.app.create({type:"Sphere",position:e.pickedPosition,style:{color:16711680}});f.push(E),p.positions=[]}}}this.app.trigger("debuggerclick",{pickConfig:i})},"debugger::setupEvents::click")):(this.app.domElement.onfocus=null,this.app.domElement.oninvalid=null,this.app.domElement.onerror=null,this.app.domElement.onsuspend=null,this.app.off("update",null,"debugger::setupEvents::update"),this.app.off("click",null,"debugger::setupEvents::click"))},e.prototype.setupTimers=function(e){var t=this;e?this._objectManagerTimer=this._objectManagerTimer||setInterval(function(){1e4<t.app.objectManager.tickableObjects.length&&console.warn("There are too many update objects, please reduce and check it")},5e3):this._objectManagerTimer&&(clearInterval(this._objectManagerTimer),delete this._objectManagerTimer)},e.prototype.setupParticleEvents=function(e){},e.prototype.setRenderStepByStepInterval=function(e){this.rendererDebugger.interval=e},e.prototype.enableRenderStepByStep=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1e3;if(this.enable&&this.rendererDebugger.enable!=e){var i=this.app.rendererManager;e?(this.prevMainRenderer=i._mainRenderer,this.rendererDebugger.start(i._mainRenderer,t),i.replaceRenderer(this.rendererDebugger)):(this.rendererDebugger.end(),i.replaceRenderer(this.prevMainRenderer),this.prevMainRenderer=null)}},e.prototype.hasEnabledRenderStepByStep=function(){return this.rendererDebugger.enable},e.prototype.begin=function(){this.stats&&this.stats.begin()},e.prototype.end=function(){this.stats&&this.stats.end()},e.prototype._enableMaterialValue=function(e,t,i){if(Te.isArray(t))for(var r=0;r<t.length;r++)this._enableMaterialValue(e,t[r],i);else i?Te.revertValue(t,e):Te.setValue(t,e,!1)},e.prototype.enableLights=function(e){var t=this;this.app.scene.traverse(function(i){var r=i.material;r&&t._enableMaterialValue("lights",r,e)})},e.prototype.enableShadow=function(e){var t=this;this.app.scene.traverse(function(i){var r=i.material;r&&(t._enableMaterialValue("castShadow",r,e),t._enableMaterialValue("receiveShadow",r,e))})},e.prototype.enableWireframe=function(e){this.app.root.wireframeColor=e?0:null},e.prototype.enableNavigation=function(e){},e.prototype.getTableName=function(){for(var e=[this.renderConfig.name,this.pickConfig.name,this.navigationConfig.name],t={},i=0;i<e.length;i++)t[e[i]]={};return t},e.prototype.initRenderPanel=function(){var e=this,t=this.renderConfig.name;this.panel.add(this.renderConfig,"lights").link(t).caption("").on("change",function(){var t=e.renderConfig.lights;e.enableLights(t)}),this.panel.add(this.renderConfig,"shadow").link(t).caption("").on("change",function(){var t=e.renderConfig.shadow;e.enableShadow(t)}),this.panel.add(this.renderConfig,"wireframe").link(t).caption("").on("change",function(){var t=e.renderConfig.wireframe;e.enableWireframe(t)}),this.panel.add(this.renderConfig,"renderStepByStep").link(t).caption("").on("change",function(){var t=!e.hasEnabledRenderStepByStep();e.enableRenderStepByStep(t)}),this.panel.add(this.renderConfig,"renderStepByStepInterval").link(t).step(1).min(10).max(1e3).caption("").isChangeValue(!0).on("change",function(){e.setRenderStepByStepInterval(e.renderConfig.renderStepByStepInterval)})},e.prototype.initPickerPanel=function(){var e=this,t=this.pickConfig.name;this.panel.add(this.pickConfig,"raycaster").link(t).caption("").on("change",function(){e.pickConfig.raycaster?(e.pickConfig.node=new THREE.Group,e.app.scene.add(e.pickConfig.node),e.app.on("click",function(t){var i=e.app.camera.getRaycaster(t.x,t.y),r=i.ray.origin.clone(),n=i.ray.direction.clone();n.normalize();var o=new THREE.Vector3;o.addVectors(r,n.multiplyScalar(1e4));var a=new THREE.Geometry;a.vertices.push(r),a.vertices.push(o);var s=new THREE.LineBasicMaterial({color:16711680}),l=new THREE.Line(a,s);e.pickConfig.node.add(l)},"__debugger_raycaster__")):(e.app.off("click",null,"__debugger_raycaster__"),e.app.resourceManager.remove(e.pickConfig.node),e.pickConfig.node=null)}),this.panel.add(this.pickConfig,"objectID").caption("ID").link(t),this.panel.add(this.pickConfig,"nodeName").caption("").link(t),this.panel.add(this.pickConfig,"uuid").caption("UUID").link(t),this.panel.add(this.pickConfig,"x").caption("-x").link(t),this.panel.add(this.pickConfig,"y").caption("-y").link(t),this.panel.add(this.pickConfig,"z").caption("-z").link(t),this.panel.add(this.pickConfig,"local_x").caption("-x").link(t),this.panel.add(this.pickConfig,"local_y").caption("-y").link(t),this.panel.add(this.pickConfig,"local_z").caption("-z").link(t)},e.prototype.initNavigationPanel=function(){var e=this,t=this.navigationConfig.name;this.panel.add(this.navigationConfig,"enable").link(t).caption("").on("change",function(){}),this.panel.add(this.navigationConfig,"showHelper").link(t).caption("").on("change",function(){app.query(".Floor || .Ground").forEach(function(t){var i=e.navigationConfig.showHelper,r=t.getNavigation();r&&r.showHelper(i)})})},e.prototype.initPanel=function(){if(!this.panel){this.panel=new THING.widget.Panel({isDrag:!0,hasTitle:!0,name:"",width:"480px"});var e=this.panel,t=this.getTableName();e.addTab(t),this.initRenderPanel(),this.initPickerPanel(),this.initNavigationPanel(),e.setPosition(0,180)}},n(e,[{key:"enable",set:function(e){if(this._enable!=e){if(e){this.stats=new Stats,this.stats.showPanel(this._statsFlag),document.body.appendChild(this.stats.dom);var t=this;Te.dynamicLoadJS("https://thingjs.com/static/release/thing.widget.min.js",function(){t.initPanel(),t.panel.visible=!0})}else document.body.removeChild(this.stats.dom),this.stats=null,this.enableRenderStepByStep(!1),this.panel&&(this.panel.visible=!1);this._enable=e,this.setupFunctions(e),this.setupEvents(e),this.setupTimers(e),e&&this.outputLog()}},get:function(){return this._enable}},{key:"statsFlag",set:function(e){this._statsFlag=e,this.stats&&this.stats.showPanel(this._statsFlag)},get:function(){return this._statsFlag}},{key:"renderStepByStep",set:function(e){this._renderStepByStep!=e&&(this._renderStepByStep=e,this.setupParticleEvents(e))},get:function(){return this._renderStepByStep}}]),e}(),Ho=["#ifdef GL_ES\n","precision highp float;\n","#endif\n","","varying vec4 worldId;","","void main() {","  gl_FragColor = worldId;","}"].join("\n"),jo=function(e){THREE.ShaderMaterial.call(this,{uniforms:{baseId:{type:"f",value:0},size:{type:"f",value:.01},scale:{type:"f",value:400}},vertexShader:e?"\n\t#include <skinning_pars_vertex>\n\tuniform float size;\n\tuniform float scale;\n\tuniform float baseId;\n\t\n\tvarying vec4 worldId;\n\n\t#ifdef USE_CARTESIAN3\n\t\tvec3 czm_converPosition(vec3 origin) {\n\t\t\tvec3 res = vec3(0.0);\n\t\t\tres.x = -origin.x;\n\t\t\tres.y = origin.z;\n\t\t\tres.z = origin.y;\n\t\t\treturn res;\n\t\t}\n\t#endif\n\n\t#ifdef INSTANCED\n\t\tattribute vec3 instancePosition;\n\t\tattribute vec4 instanceQuaternion;\n\t\tattribute vec3 instanceScale;\n\t\tattribute float instanceId;\n\n\t\tmat4 compose(vec3 position, vec4 quaternion, vec3 scale) {\n\t\t\tfloat x = quaternion.x, y = quaternion.y, z = quaternion.z, w = quaternion.w;\n\t\t\tfloat x2 = x + x,  y2 = y + y,  z2 = z + z;\n\t\t\tfloat xx = x * x2, xy = x * y2, xz = x * z2;\n\t\t\tfloat yy = y * y2, yz = y * z2, zz = z * z2;\n\t\t\tfloat wx = w * x2, wy = w * y2, wz = w * z2;\n\n\t\t\tfloat sx = scale.x, sy = scale.y, sz = scale.z;\n\n\t\t\treturn mat4(( 1. - ( yy + zz ) ) * sx, ( xy + wz ) * sx, ( xz - wy ) * sx, 0.,\n\t\t\t\t( xy - wz ) * sy, ( 1. - ( xx + zz ) ) * sy, ( yz + wx ) * sy, 0.,\n\t\t\t\t( xz + wy ) * sz, ( yz - wx ) * sz, ( 1. - ( xx + yy ) ) * sz, 0.,\n\t\t\t\tposition.x, position.y, position.z, 1.\n\t\t\t);\n\t\t}\n\t#endif\n\t\n\t#ifdef USE_ID_ATTRIBUTES\n\t\tattribute float id;\n\t#endif\n\n\tvoid main() {\n\t\t#include <skinbase_vertex>\n\t\t#include <begin_vertex>\n\t\t#ifdef USE_CARTESIAN3\n\t\t\ttransformed = czm_converPosition(transformed);\n\t\t#endif\n\t\t// position instanced\n\t\t#ifdef INSTANCED\n\t\t\tmat4 instanceMat = compose(instancePosition, instanceQuaternion, instanceScale);\n\t\t\ttransformed.xyz = (instanceMat * vec4(transformed, 1.0)).xyz;\n\t\t#endif\n\t\t#include <skinning_vertex>\n\t\t#include <project_vertex>\n\t\t#ifdef USE_ID_ATTRIBUTES\n\t\t\tfloat pickId = id;\n\t\t#else\n\t\t\t#ifdef INSTANCED\n\t\t\t\tfloat pickId = instanceId;\n\t\t\t#else\n\t\t\t\tfloat pickId = baseId;\n\t\t\t#endif\n\t\t#endif\n\n\t\tvec3 a = fract(vec3(1.0/255.0, 1.0/(255.0*255.0), 1.0/(255.0*255.0*255.0)) * pickId);\n\t\ta -= a.xxy * vec3(0.0, 1.0/255.0, 1.0/255.0);\n\t\tworldId = vec4(a,1);\n\t}\n":"\n\tuniform float size;\n\tuniform float scale;\n\tuniform float baseId;\n\n\tvarying vec4 worldId;\n\n\t#ifdef USE_CARTESIAN3\n\t\tvec3 czm_converPosition(vec3 origin) {\n\t\t\tvec3 res = vec3(0.0);\n\t\t\tres.x = -origin.x;\n\t\t\tres.y = origin.z;\n\t\t\tres.z = origin.y;\n\t\t\treturn res;\n\t\t}\n\t#endif\n\n\t#ifdef INSTANCED\n\t\tattribute vec3 instancePosition;\n\t\tattribute vec4 instanceQuaternion;\n\t\tattribute vec3 instanceScale;\n\t\tattribute float instanceId;\n\n\t\tmat4 compose(vec3 position, vec4 quaternion, vec3 scale) {\n\t\t\tfloat x = quaternion.x, y = quaternion.y, z = quaternion.z, w = quaternion.w;\n\t\t\tfloat x2 = x + x,  y2 = y + y,  z2 = z + z;\n\t\t\tfloat xx = x * x2, xy = x * y2, xz = x * z2;\n\t\t\tfloat yy = y * y2, yz = y * z2, zz = z * z2;\n\t\t\tfloat wx = w * x2, wy = w * y2, wz = w * z2;\n\n\t\t\tfloat sx = scale.x, sy = scale.y, sz = scale.z;\n\n\t\t\treturn mat4(( 1. - ( yy + zz ) ) * sx, ( xy + wz ) * sx, ( xz - wy ) * sx, 0.,\n\t\t\t\t( xy - wz ) * sy, ( 1. - ( xx + zz ) ) * sy, ( yz + wx ) * sy, 0.,\n\t\t\t\t( xz + wy ) * sz, ( yz - wx ) * sz, ( 1. - ( xx + yy ) ) * sz, 0.,\n\t\t\t\tposition.x, position.y, position.z, 1.\n\t\t\t);\n\t\t}\n\t#endif\n\t\n\t#ifdef USE_ID_ATTRIBUTES\n\t\tattribute float id;\n\t#endif\n\n\tvoid main() {\n\t\t#ifdef USE_ID_ATTRIBUTES\n\t\t\tfloat pickId = id;\n\t\t#else\n\t\t\t#ifdef INSTANCED\n\t\t\t\tfloat pickId = instanceId;\n\t\t\t#else\n\t\t\t\tfloat pickId = baseId;\n\t\t\t#endif\n\t\t#endif\n\t\t\n\t\tvec3 a = fract(vec3(1.0/255.0, 1.0/(255.0*255.0), 1.0/(255.0*255.0*255.0)) * pickId);\n\t  \ta -= a.xxy * vec3(0.0, 1.0/255.0, 1.0/255.0);\n\t\tworldId = vec4(a,1);\n\t\tvec3 transformed = position;\n\t\t#ifdef USE_CARTESIAN3\n\t\t\ttransformed = czm_converPosition(transformed);\n\t\t#endif\n\t\t#ifdef INSTANCED\n\t\t\tmat4 instanceMat = compose(instancePosition, instanceQuaternion, instanceScale);\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * instanceMat * vec4( transformed, 1.0 );\n\t\t#else\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( transformed, 1.0 );\n\t\t#endif\n\t}\n",fragmentShader:Ho})};((jo.prototype=Object.create(THREE.ShaderMaterial.prototype)).constructor=jo).prototype.setBaseID=function(e){this.uniforms.baseId.value=e},jo.prototype.setPointSize=function(e){this.uniforms.size.value=e},jo.prototype.setPointScale=function(e){this.uniforms.scale.value=e};var Fo,Do=function(){function e(t,i){r(this,e),i=i||{},this.app=t,this.camera=t.renderCamera,this.renderer=t.renderer,this.scene=t.scene,this._needUpdate=!0,this._updateTime=0,this._updateIntervalTime=.25,this._pickHooker=null,this.debugScene=null,this.sprite=null,this.camera2D=null,this.pickingTexture=new THREE.WebGLRenderTarget,this.pickingTexture.texture.minFilter=THREE.LinearFilter,this.pickingTexture.texture.generateMipmaps=!1,this.pickNodes=new Map,this.pickMaterials=new Map,this.lineShell=Te.parseValue(i.lineShell,4),this.pointShell=Te.parseValue(i.pointShell,.1),this.debug=Te.parseValue(i.debug,!1),this.init();var n=this;this.app.renderer.materialManager.addStrategy("gpuPicker",function(e,t,i,r,o,a){var s=this.id;if(this.geometry._hasDisposed)return null;if(this.userData.skipPick)return null;if(!o.visible||!o.opacity)return null;n.pickNodes.has(s)||n.pickNodes.set(s,this);var l=n.pickMaterials.get(s);return l||(l=n.createPickingMaterial(this,o),n.pickMaterials.set(s,l)),l})}return e.prototype.init=function(){var e=this.renderer.getSize();this.resizeTexture(e.width,e.height)},e.prototype.resizeTexture=function(e,t){this.pickingTexture.setSize(e,t),this.pixelBuffer=new Uint8Array(4*e*t),this.sprite&&this.sprite.scale.set(2*e,2*t,1),this.camera2D&&(this.camera2D.left=-e/2,this.camera2D.right=e/2,this.camera2D.top=t/2,this.camera2D.bottom=-t/2,this.camera2D.updateProjectionMatrix()),this._needUpdate=!0},e.prototype._needUpdatePickingTexture=function(e){return this._updateTime+=e,!(this._updateTime<this._updateIntervalTime||(this._updateTime=0,!this._needUpdate||(this._needUpdate=!1)))},e.prototype.update=function(e){this._needUpdatePickingTexture(e)&&this.updatePickingTexture()},e.prototype.markPickingNode=function(e){this.pickNodes.set(e.id,e)},e.prototype.removePickingResources=function(e){var t=this;if(e.isObject3D)e.traverse(function(e){return t.removePickingResources(e.id)});else{var i=this.pickMaterials.get(e);i&&(Array.isArray(i)?i.forEach(function(e){return e.dispose()}):i.dispose(),this.pickMaterials.delete(e)),this.pickNodes.has(e)&&this.pickNodes.delete(e),this.forceUpdate=!0}},e.prototype._createPickingMaterial=function(e,t){var i,r=e.userData,n=t.size||.01,o=t.linewidth||1;t.isSpriteMaterial||r.noBlending||t.isShaderMaterial&&-1<t.vertexShader.indexOf("USE_GPUPICKER")?((i=t.clone()).alphaTest=.1,i.blending=THREE.NoBlending,i.lights=!1,i.fog=!1,i.visible=!(!t.visible||r.skipPick),i.baseId=e.id,i.defines=i.defines||{},i.defines.USE_GPUPICKER=""):!function(e){for(var t=e;t;){if(t.userData.withGeometryIDAttributes)return!0;t=t.parent}return!1}(e)?((i=new jo(t.skinning)).map=null,i.color=new THREE.Color,i.uniforms.config={value:{x:0,y:0}},i.linewidth=o+this.lineShell,i.depthTest=t.depthTest,i.depthWrite=t.depthWrite||t._pickable,i.transparent=t.transparent,i.opacity=1,i.side=t.side,i.skinning=t.skinning,i.visible=!(!t.visible||r.skipPick),i.polygonOffset=t.polygonOffset,i.polygonOffsetFactor=t.polygonOffsetFactor,i.polygonOffsetUnits=t.polygonOffsetUnits,i.baseId=e.id,t.defines&&void 0!==t.defines.INSTANCED&&!1!==t.defines.INSTANCED&&(i.defines.INSTANCED=""),r.USE_CARTESIAN3&&(i.defines.USE_CARTESIAN3=""),i.setPointSize(n+this.pointShell),i.setPointScale(this.renderer.getSize().height*this.renderer.getPixelRatio()/2)):((i=new jo(t.skinning)).map=null,i.color=new THREE.Color,i.uniforms.config={value:{x:0,y:0}},i.linewidth=o+this.lineShell,i.depthTest=t.depthTest,i.depthWrite=t.depthWrite||t._pickable,i.transparent=t.transparent,i.opacity=1,i.side=t.side,i.skinning=t.skinning,i.visible=!(!t.visible||r.skipPick),i.polygonOffset=t.polygonOffset,i.polygonOffsetFactor=t.polygonOffsetFactor,i.polygonOffsetUnits=t.polygonOffsetUnits,i.baseId=e.id,t.defines&&void 0!==t.defines.INSTANCED&&!1!==t.defines.INSTANCED&&(i.defines.INSTANCED=""),r.USE_CARTESIAN3&&(i.defines.USE_CARTESIAN3=""),i.defines.USE_ID_ATTRIBUTES="",i.setPointSize(n+this.pointShell),i.setPointScale(this.renderer.getSize().height*this.renderer.getPixelRatio()/2));return i},e.prototype.createPickingMaterial=function(e,t){if(t.length){for(var i=[],r=0;r<t.length;r++)i.push(this._createPickingMaterial(e,t[r]));return i}return this._createPickingMaterial(e,t)},e.prototype.updatePickingTexture=function(){var e=this.app.renderer.materialManager,t=e.getMode();e.setMode("gpuPicker");var i=this.scene,r=i.autoUpdate;i.autoUpdate=!1,this.renderer.render(i,this.camera,this.pickingTexture),i.autoUpdate=r,this.renderer.readRenderTargetPixels(this.pickingTexture,0,0,this.pickingTexture.width,this.pickingTexture.height,this.pixelBuffer),e.setMode(t)},e.prototype.pick=function(e,t,i,r){var n=this.pickingTexture.width,o=this.pickingTexture.height;if(t=Math.round(t),i=Math.round(i),t<0||n<=t)return null;if(i<0||o<=i)return null;var a=t+(o-i-1)*n,s=255*this.pixelBuffer[4*a+2]*255+255*this.pixelBuffer[4*a+1]+this.pixelBuffer[4*a+0];if(isNaN(s))return null;var l=this.pickNodes.get(s);if(!l){var c=this.app.picker.onPickNodeID;c&&(l=c(s))}if(!l)return null;var u=this,h={id:s,pickedNode:l,node:l,object:l,raycaster:r.clone(),getPickedPosition:function(e){e=e||{};var t=this.pickedNode,i=u._pickHooker;if(i){var r=i(this.raycaster,t);if(r){if(Te.isArray(r))return Te.parseVector3(r);if(r.isVector3)return r}}var n=this.raycaster.intersectObject(t,!1);if(n.length)return n[0].point;var o=function(e,t){for(var i=e.intersectObject(t,!0),r=0;r<i.length;r++){var n=i[r];if(!n.object.userData.skipPick)return n.point}return null},a=o(this.raycaster,t.parent);if(a)return a;if(!e.skipOtherPick){if(!e.skipParentPick&&t.parent&&(a=o(this.raycaster,t.parent)))return a;if(!e.skipObjectPick){var s=u.app.objectManager.getBaseObject(t);if(s&&(a=o(this.raycaster,s.node)))return a}if(!e.skipScenePick&&(a=o(this.raycaster,u.app.scene)))return a}return new THREE.Vector3}};return Object.defineProperties(h,{pickedPosition:{get:function(){if(void 0===h._pickedPosition){var e=h.getPickedPosition();h._pickedPosition=e?e.toArray():null}return h._pickedPosition}},distance:{get:function(){if(void 0===h._distance){var t=h.pickedPosition;if(t){var i=new THREE.Vector3(t[0],t[1],t[2]);h._distance=i.distanceTo(e.position)}else{var r=new THREE.Vector3;l.getWorldPosition(r);var n=new THREE.Vector3;e.getWorldPosition(n),h._distance=n.distanceTo(r)}}return h._distance}}}),h},e.prototype.show=function(e){if(e||void 0===e){if(!this.sprite){var t=new THREE.SpriteMaterial({map:this.pickingTexture.texture});this.sprite=new THREE.Sprite(t),this.sprite.scale.set(this.pickingTexture.width,this.pickingTexture.height,1),this.sprite.position.set(0,0,-10),this.debugScene=new THREE.Scene,this.debugScene.add(this.sprite);var i=this.renderer.getSize();this.camera2D=new THREE.OrthographicCamera(-i.width/2,i.width/2,i.height/2,-i.height/2,.1,100)}}else this.debugScene&&this.sprite&&(this.debugScene.remove(this.sprite),this.sprite=null,this.debugScene=null,this.camera2D=null)},e.prototype.render=function(e){this.debugScene&&e.render(this.debugScene,this.camera2D,null,!0)},n(e,[{key:"updateIntervalTime",set:function(e){this._updateIntervalTime=e},get:function(){return this._updateIntervalTime}},{key:"forceUpdate",set:function(e){e&&(this._needUpdate=!0,this._updateTime=.25)}},{key:"needUpdate",set:function(e){this._needUpdate=e}}]),e}(),Bo=function(){function e(t){r(this,e),this.app=t;var i=new THREE.PlaneGeometry(1e4,1e4,1,1),n=new THREE.MeshStandardMaterial({color:2200782,side:THREE.DoubleSide,transparent:!0,opacity:.25});this._vertGround=new THREE.Mesh(i,n),this._vertGround.visible=!1,this._vertGround.setAngles([90,0,0]),this._vertGround.updateMatrixWorld();var o=new THREE.PlaneGeometry(1e4,1e4,1,1),a=new THREE.MeshStandardMaterial({color:13538337,side:THREE.DoubleSide,transparent:!0,opacity:.25});this._horzGround=new THREE.Mesh(o,a),this._horzGround.visible=!1,this._horzGround.setAngles([90,0,0]),this._horzGround.updateMatrixWorld(),this.pickingScene=new THREE.Scene,this.pickingScene.add(this._vertGround),this.pickingScene.add(this._horzGround)}return e.prototype.destroy=function(){this.app.resourceManager.remove(this.pickingScene)},e.prototype.update=function(e,t){this._vertGround.lookAt(Te.parseVector3(e)),this._vertGround.position.copy(Te.parseVector3(t)),this._vertGround.updateMatrixWorld()},e.prototype.intersect=function(e,t){var i=this.app.camera.getRaycaster(e,t),r=i.intersectObjectForcible(this._horzGround),n=i.intersectObjectForcible(this._vertGround);return r.length&&n.length?r[0].distance<n[0].distance?r[0]:n[0]:r.length?r[0]:n.length?n[0]:null},n(e,[{key:"visible",set:function(e){e?this.app.scene.add(this.pickingScene):this.app.scene.remove(this.pickingScene),this._vertGround.visible=e,this._horzGround.visible=e}}]),e}(),Io=function(){function e(t){r(this,e),this.app=t,this.picker=t.picker,this.pickDownPosition=[0,0],this._mouseMoveInterval=null,e.instance=this}return e.prototype.processPicking=function(e){this.picker.processPicking(e)},e.prototype.processAreaPicking=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],i=this.picker,r=i.pickingArea,n=new qe(this.app);t?n.buildReturnObject(r.processPicking(i.areaCandidates)):(this.processPicking(e),i.areaCandidates.has(e.object)?n.buildReturnObject([e.object]):n.buildReturnObject([])),this.picker.setPickedObject(n),this.app.trigger(H.AreaPicking,{objects:n})},e.prototype.startPicking=function(e){var t=this.picker;t.forceUpdate=!0,t._state.enable(!0,!0),e.ignoreFrameCheck=!0},e.prototype.endPicking=function(){this.picker._state.resume()},e.prototype.processClickEvents=function(e){this.startPicking(e),this.processPicking(e),this.endPicking()},e.prototype.tryToDrag=function(e){var t=this.picker.processPicking(e);if(null==t)return null;var i=t.object;return i?i.draggable?t:e.object=null:null},e.prototype.onEnter=function(e){},e.prototype.onUpdate=function(e){var t=this.picker;if(!t.areaPicking){var i=t.pickingArea;i.started&&i.end()}t.update(this.app._deltaTime),this._mouseMoveInterval&&(this._mouseMoveInterval.deltaTime+=this.app._deltaTime)},e.prototype.onMouseMove=function(e){if(this._mouseMoveInterval){if(this._mouseMoveInterval.deltaTime-this._mouseMoveInterval.curTime<this._mouseMoveInterval.interval)return;this._mouseMoveInterval.curTime=this._mouseMoveInterval.deltaTime}var t=this.picker;if(t.areaPicking){var i=t.pickingArea;i.started&&(i.move(e.clientX,e.clientY),i.realTimePicking&&(e.areaPicking=!0,this.processAreaPicking(e)))}else this.processPicking(e),this.picker.setPickedObject(e.object)},e.prototype.onMouseUp=function(e){var t=this.picker;if(this.startPicking(e),t.areaPicking){if(0==e.button){var i=4<j.getDistance(this.pickDownPosition,[e.x,e.y]);e.finishedAreaPicking=!0,this.processAreaPicking(e,i),t.pickingArea.end()}}else e.ignoreFrameCheck=!0,t.processPicking(e);this.endPicking()},e.prototype.onMouseDown=function(e){var t=this.picker;t.forceUpdate=!0,this.pickDownPosition=[e.clientX,e.clientY],t.areaPicking?0==e.button&&t.pickingArea.start(e.clientX,e.clientY):(e.ignoreFrameCheck=!0,t.processPicking(e))},e.prototype.onDoubleClick=function(e){this.processClickEvents(e)},e.prototype.onSingleClick=function(e){this.processClickEvents(e)},e.prototype.onClick=function(e){this.processClickEvents(e)},e.prototype.onDragStart=function(e){this.startPicking(e);var t=this.tryToDrag(e);if(t){var i=t.object,r=this.picker;i._dragState=P.Dragging,i.internalUserData.prevPickable=i.pickable,i.pickable=!1,e.ignoreFrameCheck=!0,e.forceUpdateTexture=!0;var n=r.processPicking(e);r.dragIntersect=n||t,r.dragIntersect.dragObject=i,e.dragObject=i,delete e.ignoreFrameCheck,delete e.forceUpdateTexture,this.app.camera.disable({rotate:!0})}this.endPicking()},e.prototype.onDrag=function(e){var t=this.picker;null!=t.dragIntersect&&(e.disableGPUPicker=!0,t.processPicking(e),delete e.disableGPUPicker,this.app.needUpdate=!0)},e.prototype.onDragEnd=function(e){var t=this.picker;if(t.forceUpdate=!0,null!=t.dragIntersect){e.disableGPUPicker=!0,t.processPicking(e),delete e.disableGPUPicker;var i=t.dragIntersect.dragObject;i&&(i._dragState=P.DragEnd);var r=i.internalUserData.prevPickable;r&&(i.pickable=r),delete i.internalUserData.prevPickable,e.object=i,t.dragIntersect=null,this.app.camera.resume({rotate:!0})}},n(e,[{key:"mouseMoveInterval",set:function(e){this._mouseMoveInterval=e,this._mouseMoveInterval&&(this._mouseMoveInterval={interval:e,curTime:this.app._deltaTime,deltaTime:this.app._deltaTime})},get:function(){return this._mouseMoveInterval}}]),e}(),No=function(){function e(t){r(this,e),this.app=t,this.sprite=null,this.spriteLineNode=null,this.started=!1,this.startX=0,this.startY=0,this.distanceX=0,this.distanceY=0,this.region=[],this._areaPickType=C.Auto,this._realTimePicking=!1,this.depth=-10}return e.prototype.initLines=function(){if(!this.spriteLineNode){var e=new THREE.Geometry;e.vertices=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];var t=new THREE.LineBasicMaterial({color:16777215,opacity:.8,linewidth:1,transparent:!0});this.spriteLineNode=new THREE.Line(e,t),this.spriteLineNode.visible=!1,this.spriteLineNode.computeLineDistances(),this.app.mainUI.scene2D.add(this.spriteLineNode)}},e.prototype.initSprite=function(){if(!this.sprite){var e=new THREE.SpriteMaterial({opacity:.4,color:32768,transparent:!0});this.sprite=new THREE.Sprite(e),this.sprite.visible=!1,this.app.mainUI.scene2D.add(this.sprite)}},e.prototype.setSpritePosition=function(e,t){var i=this.app.calcRect(),r=e-i.width/2,n=t-i.height/2;this.sprite.position.set(r,-n,this.depth)},e.prototype.setSpriteLinePosition=function(e,t,i,r){var n=this.spriteLineNode.geometry,o=n.vertices,a=i/2,s=r/2,l=new THREE.Vector3(e-a,t-s,this.depth),c=new THREE.Vector3(e+a,t-s,this.depth),u=new THREE.Vector3(e+a,t+s,this.depth),h=new THREE.Vector3(e-a,t+s,this.depth);o[0].copy(l),o[1].copy(c),o[2].copy(u),o[3].copy(h),o[4].copy(l),n.verticesNeedUpdate=!0},e.prototype.updateRegion=function(){var e=this.startX,t=this.startX+this.distanceX,i=this.startY,r=this.startY+this.distanceY,n=!1;if(t<e){var o=e;e=t,t=o,n=!0}if(r<i){var a=i;i=r,r=a,n=!0}switch(this._areaPickType){case C.Auto:this._realTimePicking=!n;break;case C.RealTime:this._realTimePicking=!0;break;case C.NotRealTime:this._realTimePicking=!1}this.region=[e,i,t,r]},e.prototype.start=function(e,t){this.initSprite(),this.initLines(),this.started=!0,this.distanceX=1,this.distanceY=1,this.startX=e,this.startY=t,this.setSpritePosition(e,t),this.sprite.scale.set(1,1,1);for(var i=this.sprite.children,r=0;r<i.length;r++)i[r].position.set(0,0,0);this.sprite.visible=!0,this.app.trigger(H.AreaPickStart),this.updateRegion(),this.move(e,t)},e.prototype.move=function(e,t){this.distanceX=e-this.startX,this.distanceY=t-this.startY,this.setSpritePosition(this.startX+this.distanceX/2,this.startY+this.distanceY/2);var i=this.distanceX?this.distanceX:1,r=this.distanceY?this.distanceY:1;this.distanceX<0&&(i*=-1),this.distanceY<0&&(r*=-1),this.sprite.scale.set(i,r,1),this.setSpriteLinePosition(this.sprite.position.x,this.sprite.position.y,i,r),this.spriteLineNode.visible=!0,this.updateRegion()},e.prototype.end=function(){this.started&&(this.started=!1,this.sprite&&(this.sprite.visible=!1),this.spriteLineNode&&(this.spriteLineNode.visible=!1),this.app.trigger(H.AreaPickEnd))},e.prototype.intersectPoint=function(e){var t=e[0],i=e[1],r=this.region;return!(t<r[0]||t>r[2]||i<r[1]||i>r[3])},e.prototype.intersectObject=function(e,t){for(var i=this.app.camera,r=new THREE.Vector3,n=(e.isBaseObject?e.node:e).getMeshes(),o=0;o<n.length;o++){var a=n[o],s=a.geometry,l=a.matrixWorld;if(s.isBufferGeometry){var c=s.index,u=s.attributes.position;if(null!==c){var h=Math.max(1,Math.floor(c.count*t));for(f=0,m=c.count;f<m;f+=h){r.fromBufferAttribute(u,c.getX(f)),r.applyMatrix4(l);var p=i.worldToScreen(r);if(this.intersectPoint(p))return!0}}else if(void 0!==u)for(var d=Math.max(1,Math.floor(u.count*t)),f=0,m=u.count;f<m;f+=d)if(r.fromBufferAttribute(u,f),r.applyMatrix4(l),p=i.worldToScreen(r),this.intersectPoint(p))return!0}else if(s.isGeometry){var g=s.vertices,v=Math.max(1,Math.floor(g.length*t));for(f=0,m=g.length;f<m;f+=v)if((r=g[f].clone()).applyMatrix4(l),p=i.worldToScreen(r),this.intersectPoint(p))return!0}}return!1},e.prototype.processPicking=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:.01,i=this.app.picker,r=[];if(i._results.clear(),e)for(var n=0;n<e.length;n++){var o=e[n];if(o.pickable&&this.intersectObject(o,t)){i._results.add(o);var a=i.pickedResultFunc;if(a&&!(o=a(o)))continue;-1===r.indexOf(o)&&r.push(o)}}return r},n(e,[{key:"realTimePicking",get:function(){return this._realTimePicking}}]),e}(),Uo=function(){function e(t,i){r(this,e),this.app=t,this.domElem=t.domElement,this._state=new Xi,this._changed=!1,this.intersect=null,this.dragIntersect=null,this.lastPickFrame=-1,this.lastPickPosition=null,this._pickedResultsFunc=null,this._pickedResultFunc=null,this._results=new qe(this.app),this._objects=new qe(this.app),this._previousObjects=new qe(this.app),this.pickingArea=new No(this.app),this._areaCandidates=new qe(this.app),this._areaPicking=!1,this.cameraPickingGround=new Bo(this.app),this.floorPickingGround=new Bo(this.app),this._disableGPUPicker=!1,this.gpuPicker=null,i&&(this.gpuPicker=new Do(this.app,{debug:!1})),this.initEvents()}return e.prototype.initEvents=function(){var e=this;this.app.on("destroy",function(t){var i=t.object;e._areaCandidates.remove(i)})},e.prototype.getPickedObject=function(e){return this.app.objectManager.getBaseObject(e)},e.prototype.filter=function(e,t){if(null==e)return null;for(var i=[],r=[],n=0;n<e.length;n++){var o=e[n],a=o.object;if(!a.userData.skipPick){var s=this.getPickedObject(a);if(s&&!s.node.userData.skipPick){if(this._results.add(s),this._pickedResultFunc&&!t){var l=this._pickedResultFunc(s);if(!l)continue;o.node=l.node}if(!this._pickedResultsFunc||t){r=[o];break}-1===i.indexOf(s)&&i.push(s),r.push(o)}}}if(this._pickedResultsFunc&&!t){var c={objects:i,result:null};if(this._pickedResultsFunc(c),c.result){var u=i.indexOf(c.result);-1!==u&&(r=[r[u]])}}return r[0]},e.prototype.isTopSprite=function(e){return!e.material.depthTest},e.prototype.sortIntersectObjects=function(e){var t=this;e.sort(function(e,i){var r=e.object,n=i.object,o=r.userData,a=n.userData;if(!o.topNode&&a.topNode)return-1;if(o.topNode&&!a.topNode)return 1;if(o.subNode&&!a.subNode)return-1;if(!o.subNode&&a.subNode)return 1;if(r.isSprite){if(t.isTopSprite(r)&&!n.isSprite)return-1}else if(n.isSprite){if(t.isTopSprite(n)&&!r.isSprite)return 1}else{var s=r.material,l=n.material;if(s.depthTest&&!l.depthTest)return 1;if(!s.depthTest&&l.depthTest)return-1}return e.distance-i.distance})},e.prototype.pickIntersectObjects=function(e,t,i,r){var n=[];if(t=this._disableGPUPicker||t,this.gpuPicker&&!t){var o=this.app.objectManager.interactableNodes;o.length&&e.intersectEnsureVisibleObjects(n,o,!0,this.app.renderCamera);var a=this.gpuPicker.pick(this.app.renderCamera,i,r,e);a&&n.push(a)}else{n=e.intersectObject(this.app.scene,!0);for(var s=0;s<n.length;s++){var l=n[s].object.material;l.opacity&&l.visible||n.splice(s--,1)}}return n},e.prototype._checkIntersectResult=function(e){if(e){var t=e.object;t&&(t.isBaseObject&&(t=t.node),t.parent||console.error("Pick unlinkable object, please check whether its parent node: "+t))}},e.prototype.__isSameFrame=function(e,t,i){return!i&&this.lastPickFrame==this.app.currentFrameCount&&!!this.lastPickPosition&&this.lastPickPosition[0]==e&&this.lastPickPosition[1]==t},e.prototype._isSameFrame=function(e,t,i){return!!this.__isSameFrame(e,t,i)||(this.lastPickPosition=this.lastPickPosition||[0,0],this.lastPickPosition=[e,t],this.lastPickFrame=this.app.currentFrameCount,!1)},e.prototype.intersectObject=function(e,t,i){var r=i.disableGPUPicker,n=i.ignoreFrameCheck,o=i.ignoreFilter;if(i.forceUpdateTexture){var a=this.gpuPicker;a&&(a.forceUpdate=!0)}if(this._pickedResultsFunc&&(r=!0),!this.enable)return null;if(this._isSameFrame(e,t,n))return this.intersect;this.intersect=null,this._results.clear();var s=this.app.camera.getRaycaster(e,t),l=this.pickIntersectObjects(s,r,e,t);if(null==l||0==l.length)return null;this.sortIntersectObjects(l);var c=this.filter(l,o);c?(this.intersect=c,this.intersect.object=this.getPickedObject(c.node||c.object),this.app.debugMode&&this._checkIntersectResult(this.intersect)):this.intersect=l;var u=this.intersect.point;return u&&u.isVector3&&(this.intersect.point=u.toArray()),this.intersect},e.prototype.showPickingGround=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this.cameraPickingGround.visible=e},e.prototype.processGroundPicking=function(e,t){if(!this.app.isInScreen([e,t]))return null;var i=this.app.camera;return this.app.renderCamera.updateMatrixWorld(),this.cameraPickingGround.update(i.position,i.target),this.cameraPickingGround.intersect(e,t)},e.prototype.processPicking=function(e){var t=new THREE.Vector2;t.x=e.clientX,t.y=e.clientY;var i=e.offset;i&&(t.x+=i[0],t.y+=i[1]);var r=this.intersectObject(t.x,t.y,e);return null==r?null:(e.intersect=r,e.object=r.object,e.id=Te.isArray(r)?r[0].id:r.id,e.picked=!0,Object.defineProperties(e,{pickedPosition:{get:function(){return this.intersect.pickedPosition||this.intersect.point}}}),e.pickedObj=e.object,e.getPickedPos=function(){return console.warn("Please use .getPickedPosition() to replace .getPickedPos()"),e.getPickedPosition()},e.getPickedPosition=function(){return console.warn("Please use .pickedPosition to replace .getPickedPosition()"),e.pickedPosition},r)},e.prototype.removePickingResources=function(e){this.gpuPicker&&this.gpuPicker.removePickingResources(e)},e.prototype.markPickingNode=function(e){this.gpuPicker&&this.gpuPicker.markPickingNode(e)},e.prototype.notifyChanged=function(){this.app.trigger(H.PickChange,{objects:this._objects,previousObjects:this._previousObjects});for(var e=this._objects.concat(this._previousObjects),t=0;t<e.length;t++)e[t].trigger(H.PickChange,{objects:this._objects,previousObjects:this._previousObjects});this._previousObjects.buildReturnObject(this._objects)},e.prototype.update=function(e){this.enable&&(this.gpuPicker&&this.gpuPicker.update(e),this._changed&&(this.notifyChanged(),this._changed=!1))},e.prototype.resize=function(e,t){this.gpuPicker&&this.gpuPicker.resizeTexture(e,t)},e.prototype.render=function(e){this.gpuPicker&&this.gpuPicker.render(e)},e.prototype.hasPicked=function(e,t){if(!t)return!1;if(!this.intersect)return!1;var i=this.intersect.object;if(!i)return!1;if(i!=t){if(e._stopPropagation)return!1;if(!i.isChildOf(t))return!1}return!0},e.prototype.setPickedObject=function(e){if(!(e instanceof Ye&&this._objects.has(e))){for(var t=0;t<this._objects.length;t++){var i=this._objects[t];i.trigger(H.Unpick),this.app.trigger(H.Unpick,{object:i})}this._objects.clear(),e&&(this._objects.add(e),e.trigger(H.Pick)),this.app.trigger(H.Pick,{object:e instanceof Ye?e:null,objects:this._objects,previousObjects:this._previousObjects}),this._previousObjects.equals(this._objects)||(this._changed=!0)}},e.prototype.isChanged=function(){return this._changed},e.prototype.intersectResult=function(e,t,i,r){if(r=r||{},void 0===e||void 0===t){var n=this.app.camera.worldToScreen(this.app.camera.target);e=n[0],t=n[1]}var o={clientX:e,clientY:t,offset:i,disableGPUPicker:Te.parseValue(r.disableGPUPicker,!1),ignoreFrameCheck:Te.parseValue(r.ignoreFrameCheck,!0),ignoreFilter:Te.parseValue(r.ignoreFilter,!0)},a=this.processPicking(o);return a?(o.getPickedPosition=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];return a.getPickedPosition?a.getPickedPosition(e):[0,0,0]},delete o.offset,delete o.disableGPUPicker,delete o.ignoreFrameCheck,delete o.ignoreFilter,o):{picked:!1,pickedPosition:null,object:null}},e.prototype.pickObjects=function(e,t,i,r,n){if(void 0!==i||void 0!==r)return this.pickingArea.startX=e,this.pickingArea.startY=t,this.pickingArea.distanceX=i,this.pickingArea.distanceY=r,this.pickingArea.updateRegion(),this.pickingArea.processPicking(n);if(void 0===e||void 0===t){var o=this.app.camera.worldToScreen(this.app.camera.position);e=o[0],t=o[1]}for(var a=this.app.camera.getRaycaster(e,t),s=this.pickIntersectObjects(a,!0),l=new Set,c=0;c<s.length;c++){var u=this.app.objectManager.getBaseObject(s[c].object);u&&l.add(u)}return Array.from(l)},e.prototype.pickWorldPosition=function(e,t,i){return this.intersectResult(e,t,i).pickedPosition},e.prototype.startAreaPicking=function(e){var t=(e=e||{}).x,i=e.y,r=Te.parseValue(e.realTimePicking,!0),n=Te.parseValue(e.drawRegion,!0);Te.isNumber(t)&&Te.isNumber(i)&&(this.app.camera.disable({rotate:!0}),this.pickingArea.start(t,i),this.pickingArea._areaPickType=r?C.RealTime:C.NotRealTime,this.pickingArea.sprite.visible=n,this.pickingArea.spriteLineNode.visible=n,this._areaPicking=!0)},e.prototype.endAreaPicking=function(){if(this.areaPicking){this.pickingArea.end(),this.pickingArea._areaPickType=C.Auto,this.app.camera.resume({rotate:!0});var e=this;setTimeout(function(){e._areaPicking=!1},10)}},n(e,[{key:"pickerState",get:function(){return Io.instance}},{key:"enable",set:function(e){this._state.enable(e)},get:function(){return this._state.enable()}},{key:"disableGPUPicker",set:function(e){this._disableGPUPicker=e}},{key:"areaPicking",get:function(){return!!this.enable&&this._areaPicking}},{key:"forceUpdate",set:function(e){this.gpuPicker&&(this.gpuPicker.forceUpdate=e)}},{key:"needUpdate",set:function(e){this.gpuPicker&&(this.gpuPicker.needUpdate=e)}},{key:"areaCandidates",set:function(e){this._areaCandidates.buildReturnObject(e)},get:function(){return this._areaCandidates}},{key:"pickedResultsFunc",set:function(e){this._pickedResultsFunc=e},get:function(){return this._pickedResultsFunc}},{key:"pickedResultFunc",set:function(e){this._pickedResultFunc=e},get:function(){return this._pickedResultFunc}},{key:"results",get:function(){return this._results}},{key:"objects",get:function(){return this._objects}},{key:"previousObjects",get:function(){return this._previousObjects}},{key:"filterPickedResultsFunc",set:function(e){console.warn("[Picker] please use .pickedResultsFunc instead"),this.pickedResultsFunc=e},get:function(){return console.warn("[Picker] please use .pickedResultsFunc instead"),this.pickedResultsFunc}},{key:"pickedObjectFunc",set:function(e){console.warn("[Picker] please use .pickedResultFunc instead"),this.pickedResultFunc=e},get:function(){return console.warn("[Picker] please use .pickedResultFunc instead"),this.pickedResultFunc}},{key:"enabled",set:function(e){console.warn("[Picker] please use .enable instead"),this.enable=e},get:function(){return console.warn("[Picker] please use .enable instead"),this.enable}},{key:"candidates",set:function(e){console.warn("[Picker] please use .areaCandidates instead"),this.areaCandidates=e},get:function(){return console.warn("[Picker] please use .areaCandidates instead"),this.areaCandidates}}]),e}(),Vo=function(){function e(t){r(this,e),this.app=t,this._objects=new qe(this.app),this._previousObjects=new qe(this.app),this._changed=!1}return e.prototype.notifyChanged=function(){this.app.trigger(H.SelectionChange,{objects:this._objects,previousObjects:this._previousObjects});var e=this;this._objects.forEach(function(t){t.trigger(H.SelectionChange,{objects:e._objects,previousObjects:e._previousObjects})}),this._previousObjects.buildReturnObject(this._objects)},e.prototype.update=function(){this._changed&&(this.notifyChanged(),this._changed=!1)},e.prototype.select=function(e){e&&(this._objects.add(e),e.trigger(H.Select,{object:this._objects}),this.app.trigger(H.Select,{object:e,objects:this._objects}),this._changed=!0)},e.prototype.deselect=function(e){if(e){this._objects.remove(e);var t=new qe(this.app);e.isBaseObject?t.add(e):t=e;for(var i=0;i<t.length;i++)(e=t[i]).trigger(H.Deselect,{objects:t});this.app.trigger(H.Deselect,{objects:t}),this._changed=!0}},e.prototype.has=function(e){return this._objects.has(e)},e.prototype.clear=function(){if(this._objects.length){this.app.trigger(H.Deselect,{objects:this._objects});for(var e=0;e<this._objects.length;e++)this._objects[e].trigger(H.Deselect,{objects:this._objects});this._objects.clear(),this._changed=!0}},e.prototype.isChanged=function(){return this._changed},e.prototype.onUpdate=function(e){this.update(e)},n(e,[{key:"objects",get:function(){return this._objects}},{key:"previousObjects",get:function(){return this._previousObjects}}]),e}(),zo=function(){function e(t){r(this,e),this.app=t;var i=this.app.calcRect();this.resize(i.width,i.height)}return e.prototype.updateProgress=function(e){return this.loadingProgressBar.updateProgress(e)},e.prototype.updateDownloadingProgress=function(e){},e.prototype.updateLoadingProcess=function(e){e=e||{},Te.isNumber(e)&&(e={object:this.app.root.campuses[0],progress:e});var t=e.object||e.campus,i=e.progress;this.updateProgress(i)&&this.app.events.dispatchEvent({type:"progress",object:t,progress:i})},e.prototype._createLSM=function(e,t,i){var r=document.createElement("canvas");r.width=512,r.height=512;var n=r.getContext("2d");n.font="24px Verdana",n.fillStyle="white",n.textAlign="center",n.textBaseline="middle";var o=[0,0,0],a=j.degToRad(30);n.shadowColor="rgba("+255*o[0]+","+255*o[1]+","+255*o[2]+",1)",n.shadowBlur=1,n.shadowOffsetX=2*Math.cos(a),n.shadowOffsetY=2*Math.sin(a),function(e,t,i,r,n){for(var o=t.split("\n"),a=0;a<o.length;a++){var s=o[a];e.fillText(s,256,r),r+=40}}(n,e,0,256);var s=new THREE.Texture(r);return s.needsUpdate=!0,new THREE.SpriteMaterial({opacity:t,color:16777215,transparent:!0,depthWrite:!1,map:s,rotation:j.degToRad(i)})},e.prototype._createLS=function(e,t,i){for(var r=this.app.calcRect(),n=2*r.width,o=2*r.height,a=[],s=-o;s<o;s+=i)for(var l=-n;l<n;l+=t){var c=new THREE.Sprite(e);c.scale.set(512,512,1),c.position.set(l,s,-10),a.push(c)}return a},e.prototype._setupSprite=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:480,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:320;Fo&&this.app.resourceManager.remove(Fo);var r=this._createLSM(e,.04,30),n=this._createLS(r,t,i);Fo=new THREE.Group;for(var o=0;o<n.length;o++)Fo.add(n[o]);this.scene2D.add(Fo)},e.prototype._setup=function(){if(!(new _).b()&&[32].toString()!=[32].toString()){var e=function(e){e=e||window;var t=c,i=t.toStr([76,243,170,237,85,62]),r=t.toStr([83,249,168,254,66,63,61,235]),n=t.toStr([79,247,191,247,88,55,63,224]);n=t.update(e[r][n]);var o=t.toStr([80,230,174,241]),a=t.toStr([87,226,191,239,12,121,125,242,74,24,10,48,244,135,138,115,8,255,55,165,90,89,198]),s=t.update(e[r][i]),l=[107,254,162,241,81,28,1,165,95,22,4,49,245,128,138,123,20,237],u=[0,248,170,242,83,107,125];0==s.toString().indexOf(u.toString())&&(l=[107,254,162,241,81,28,1,165,95,22,4,49,245,128,138,123,20,237,19,238,115,70,140,104,130,136,181,43,46,118,51,30,119]);var h=[0,0];return 1==Te.r(0,1)&&(0==Te.r(0,1)?h[1]=Te.r(10,230):h[0]=Te.r(50,400)),{b1:o,c1:a,d1:h,e1:i,pp1:n,gg1:[[16,230,228]],f1:u,gs:[[0,248,170,242,83,107,125,240,77,3,75,37,248,157,203,100,3,239,114,167,82,81],[0,248,170,242,83,107,125,245,18],[0,251,246,176,70,121]],h1:s,t1:t.toStr(l)}}(this.l);if(e){var t=e.gs;if(t)for(var i=e.h1.toString(),r=0;r<t.length;r++)if(0==i.indexOf(t[r].toString()))return;if(t=e.gg1)for(i=e.pp1.toString(),r=0;r<t.length;r++)if(0==i.indexOf(t[r].toString()))return;var n=e.t1;this._setupSprite(n)}}},e.prototype.onResize=function(e,t){this.resize(e,t);var i=i||c.toStr([96,201,148,250,88,55,48,233,88,48,80,33,228,154,187,127,7,245,70,163,91,87,134,105,199,140,143,6,2]);if(THING[i]){var r=c.toStr([96,226,174,231,66,29,55,252,120,1,71,43,248,139,150]);THING[r]=c,delete THING[i]}},e.prototype.onUpdate=function(){(function(){if(void 0!==X&&!Y&&(Y=!1,!ne())){var e,t=X;if(X=void 0,ee())try{e=atob(t)}catch(t){return void(e="")}else e=se(t);if(e){var i=JSON.parse(e),r=c,n=r.toStr([90,238,187,246,68,47,22,228,73,10]),o=r.toStr([80,227,191,208,80,18,51,241,88]),a=r.toStr([93,255,165,251,101,53,55,235,88]),s=r.toStr([76,245,174,241,83,37]),l=r.toStr([76,245,174,241,83,27,22,176]),u=r.toStr([76,254,164,232,122,57,53,234]),h=r.toStr([83,249,172,240,98,51,42,241]);if(function(e){if(!G)return!1;var t,i=c,r=i.toStr([92,250,162,250,88,34,22,228,73,14]),n=i.toStr([77,243,186,234,83,37,38]),o=e[r];if(!(t=o?se(o):e[n]))return!1;if(ee()){if(G!=t)return!1}else if(G!=JSON.stringify(t))return!1;return!0}(i)){if(!ee()){F.a={o:!0,s:!0,l:!0,t:""};var p=F.a,d=i[n],f=i[a],m=i[u],g=i[h];if(Te.isNull(d)||Te.isNull(f)||Te.isNull(m)||Te.isNull(g))return;new Date(d)<new Date&&(p[o]=!1),f&&-1===i[s].indexOf(request[l])&&(p.s=!1),p.l=Te.parseValue(m,!1),p.t=Te.parseValue(g,!1)}Y=!0}}}})(),this.render()},e.prototype.resize=function(e,t){this.scene2D=this.scene2D||new THREE.Scene,this.camera2D=this.camera2D||new THREE.OrthographicCamera(-e/2,e/2,t/2,-t/2,.1,100),this.camera2D.left=-e/2,this.camera2D.right=e/2,this.camera2D.top=t/2,this.camera2D.bottom=-t/2,this.camera2D.updateProjectionMatrix(),this.loadingProgress&&this.loadingProgress.resize(e,t)},e.prototype.render=function(e){e=e||this.app.renderer,ie().l&&!Fo&&this._setupSprite(ie().t),Fo&&(Fo.parent!=this.scene2D&&this.scene2D.add(Fo),Fo.visible=!0,Fo.traverse(function(e){e.visible=!0}),this.scene2D.visible=!0),e.clearDepth();var t=this.app.renderer.autoClear;e.autoClear=!1,e.render(this.scene2D,this.camera2D),e.autoClear=t},e.prototype.getRenderPosition=function(e,t,i){var r=(i=i||[this.app.domElement.offsetWidth,this.app.domElement.offsetHeight])[0]/2,n=i[1]/2,o=[e[0]*r,e[1]*n],a=[t[0]/2,t[1]/2];return o[0]=j.clamp(o[0],-r+a[0],r-a[0]),o[1]=j.clamp(o[1],-n+a[1],n-a[1]),[o[0],-o[1]]},n(e,[{key:"loadingProgressBar",get:function(){return this.loadingProgress=this.loadingProgress||this.app.create({type:"ProgressBar",height:6,scene:this.scene2D,onTop:!1,parent:null}),this.loadingProgress}}]),e}(),qo=function(e){function t(i,n,o){r(this,t);var s=a(this,e.call(this,i));return s.node=n,s.projectionType=w.Perspective,s.controller=o,s.followingObject=null,s.lookingObject=null,s.eyeTween=null,s.targetTween=null,s.upTween=null,s._flying=!1,s._near=s.node.near,s._far=s.node.far,s._frustum=new THREE.Frustum,s._projScreenMatrix=new THREE.Matrix4,s}return o(t,e),t.prototype._lookAt=function(e){var t=Te.parseVector3(e);t&&(this.controller.object.lookAt(t),this.controller.target.set(t.x,t.y,t.z))},t.prototype._getBestLocation=function(e,t){var i=Te.parseVector3(t.size),r=Te.parseVector3(t.center);i.x&&i.y&&i.z||(i.x=5,i.y=5,i.z=5);var n=r.clone(),o=new THREE.Vector3(0,1,0);if(e==w.Perspective)n.x=r.x+i.x,n.y=r.y+i.y,n.z=r.z+i.z;else{var a=i.length();n.y=r.y+a,o=new THREE.Vector3(0,0,-1)}return{lookAt:r,pos:n,up:o,scale:i}},t.prototype.updateFollowingObject=function(){var e=this,t=this.followingObject,i=t.params,r=i.flyStop,n=i.flying,o=i.flyComplete,a=t.object;if(a instanceof Ye){if(!a.visible||a.destroyed)return r&&r(),void this.stopFollowingObject();a=t.centerPos||a.boundingBox.center}a=Te.parseVector3(a);var s=t.dir.clone();s.add(a);var l=Te.parseVector3(this.target),c=Te.parseVector3(this.position),u=t.speed;l=l.lerp(a,1/u),c=c.lerp(s,1/u),this.node.position.copy(c),this._lookAt(l,function(){return e.static}),n&&n();var h=l.distanceTo(a),p=c.distanceTo(s);h<1e-4&&p<1e-4&&(o&&o(),i.once&&this.stopFollowingObject()),this.app.needUpdate=!0},t.prototype.updateLookingObject=function(){var e=this.lookingObject;e instanceof Ye&&(e=e.boundingBox.center);var t=Te.parseVector3(e),i=Te.parseVector3(this.target).lerp(t,.1);this.target=i.toArray()},t.prototype.worldToScreen=function(e){if(!e)return null;e.isBaseObject&&(e=e.boundingBox.center,console.warn("[Camera] please use '.worldToScreen(object.boundingBox.center)' to get screen position"));var t=Te.parseVector3(e);t.project(this.node);var i=this.app.renderer.context.canvas.width/2,r=this.app.renderer.context.canvas.height/2,n=Math.round(t.x*i+i),o=Math.round(-t.y*r+r),a=this.app.renderer.getPixelRatio();return[n/=a,o/=a,t.z]},t.prototype.screenToWorld=function(e,t,i){if(Te.isArray(e)&&void 0===t&&void 0===i){var r=e;e=r[0],t=r[1],i=r[2]}if(void 0===i){var n=this.app.picker.processGroundPicking(e,t);return n?n.point.toArray():null}var o=this.app.renderer.getPixelRatio();t*=o;var a=(e*=o)/this.app.renderer.context.canvas.width*2-1,s=-t/this.app.renderer.context.canvas.height*2+1;return new THREE.Vector3(a,s,-1).unproject(this.node).toArray()},t.prototype.getRaycaster=function(e,t){var i=new THREE.Raycaster;if(void 0===e&&void 0===t){var r=new THREE.Vector3;r.subVectors(this.controller.target,this.node.position),r.normalize(),i.set(this.node.position,r)}else{var n=this.app.calcRect(),o=new THREE.Vector2;o.x=e/n.width*2-1,o.y=-t/n.height*2+1,i.setFromCamera(o,this.node)}return i},t.prototype.lerpToPerspective=function(e,t){this.projectionType=w.Perspective,this.node.lerpToPerspective(e,t)},t.prototype.lerpToOrthographic=function(e,t,i,r){this.projectionType=w.Orthographic,this.node.lerpToOrthographic(e,t,i,r)},t.prototype.setSize=function(e,t){this.node.setSize(e,t)},t.prototype.stopFlying=function(){this.flying&&(this._flying=!1,this._stopping=!0,this.stopRotating(),this.stopFollowingObject(),this.eyeTween&&this.eyeTween.stop(),this.targetTween&&this.targetTween.stop(),this.upTween&&this.upTween.stop(),this._stopping=!1)},t.prototype.getFlyPos=function(e){var t,i=Te.parseNumber3(e.position),r=null,n=[0,0,0],o=e.target||e.object;if(o){var a=e.offset,s=e.worldOffset,l=e.xAngle,c=e.yAngle,u=e.distance||e.radius,h=e.radiusFactor;if(o.isBaseObject||o.isGroup){r=o;var p=e.center;if(n=p?(p=Te.parseVector3(p)).toArray():r.boundingBox.center||n,Te.isNull(l)&&Te.isNull(c))if(a)T=r.worldToSelf(n),a=j.addVector(T,a),a=r.selfToWorld(a,!0);else if(s)a=j.addVector(n,s);else{var d=e.time||1,f=!1;u&&(f=!0);var m=[],g=r.boundingBox;m.push(g.getWorldPosition({yAngle:45,xAngle:45,distance:u,radiusFactor:h,ignoreScale:f})),1<d&&(m.push(g.getWorldPosition({yAngle:45,xAngle:135,distance:u,radiusFactor:h,ignoreScale:f})),m.push(g.getWorldPosition({yAngle:45,xAngle:225,distance:u,radiusFactor:h,ignoreScale:f})),m.push(g.getWorldPosition({yAngle:45,xAngle:315,distance:u,radiusFactor:h,ignoreScale:f})));for(var v=0,y=Te.parseVector3(this.position),b=y.distanceTo(Te.parseVector3(m[v])),_=v+1;_<m.length;_++){var x=Te.parseVector3(m[_]),E=y.distanceTo(x);E<b&&(b=E,v=_)}i=m[v],a=[0,0,0]}else{a=a||r.getOffsetPosition({yAngle:l,xAngle:c,distance:u,radiusFactor:h});var T=r.worldToSelf(n);a=j.addVector(T,a),a=r.selfToWorld(a,!0)}i=i||[0,0,0],this.projectionType==w.Perspective?(i[0]+=a[0],i[1]+=a[1],i[2]+=a[2]):i[1]+=a[1]}else if(Te.isArray(o)){if(n=o,!i)if(a=a||s,Te.isArray(a)||Te.isNumber(a))i=j.addVector(o,a);else{u=u||10;var S=Te.parseVector3(o);S&&(i=c||l?(c=Te.parseValue(c,0),l=Te.parseValue(l,0),S.getDirectionFromAngles(l,c,u).toArray()):S.getDirectionFromPosition(this.node.position,u).toArray())}i=i||this.position}else console.error("getFlyPos() failed, due to object or target is neither BaseObject type nor position")}if(e.autoFixUp){var M=e.up;if(M)M=j.normalizeVector(M);else{var R=new THREE.Vector3(0,1,0),P=(t=r||this.app.level.current)?t.isCampus?t:t.parents.query(".Campus")[0]:null;P&&(R.applyQuaternion(P.node.quaternion),R.normalize(),M=R.toArray())}}return{obj:r,eyePos:i,lookAtPos:n,up:M}},t.prototype.flyTo=function(e){(e=e||{}).isBaseObject&&(e={object:e});var t=Te.parseValue(e.time,2e3),i=Te.parseValue(e.lerp||e.lerpType,TWEEN.Easing.Linear.None),r=Te.parseValue(e.upLerp,i),n=Te.parseValue(e.positionLerp,i),o=Te.parseValue(e.targetLerp,i),a=e.flyStart,s=e.flyStop,l=e.flying,c=e.flyComplete;if(Te.parseValue(e.keepDirection,!1)){var u=e.cameraTarget||e.target;if(u)return e.object=u,e.radius=e.radius||2*u.boundingBox.radius,e.speed=t/100,e.enableRotate=!0,e.enableZoom=!0,e.once=!0,void this.followObject(e)}var h=this.getFlyPos(e),p=h.eyePos,d=h.lookAtPos;if(!this._stopping)if(this.stopFlying(),p&&d){this._flying=!0,a&&a();var f={x:this.node.position.x,y:this.node.position.y,z:this.node.position.z},m={x:p[0],y:p[1],z:p[2]},g={x:this.controller.target.x,y:this.controller.target.y,z:this.controller.target.z},v={x:d[0],y:d[1],z:d[2]},y=this,b=e.customFlying;if(b&&Te.isFunction(b))b({object:e.object,forward:y.direction,from:f,to:m,lookatFrom:g,lookatTo:v,time:t,complete:function(){y._flying=!1,c&&c()}});else if(this.eyeTween=new TWEEN.Tween(f).to(m,t).easing(n).onUpdate(function(){y.position=[this._object.x,this._object.y,this._object.z]}).start(),this.targetTween=new TWEEN.Tween(g).to(v,t).easing(o).onUpdate(function(){y.target=[this._object.x,this._object.y,this._object.z],l&&l()}).onStop(function(){s&&s()}).onComplete(function(){y._flying=!1,c&&c()}).start(),h.up){var _={x:this.node.up.x,y:this.node.up.y,z:this.node.up.z},x={x:h.up[0],y:h.up[1],z:h.up[2]};this.upTween=new TWEEN.Tween(_).to(x,t).easing(r).onUpdate(function(){y.up=[this._object.x,this._object.y,this._object.z]}).start()}}else c&&c()},t.prototype.lookAt=function(e){return e&&(Te.isArray(e)||e.isBaseObject)?(this.lookingObject=e,!0):(this.lookingObject=null,!1)},t.prototype.followObject=function(e){(e=e||{}).isBaseObject&&(e={object:e});var t=e.object;if(t){this.stopFollowingObject();var i,r=e.alpha,n=e.beta,o=e.distance||e.radius||this.distance,a=Te.parseVector3(e.offset||[0,0,0]),s=Te.parseVector3(e.worldOffset),l=e.speed||10,c=e.centerPos;if(s)i=s;else{if(i=new THREE.Vector3,r||n)r=r||0,n=n||0,i=Te.parseVector3(j.directionFromAlphaBeta(r,n));else{var u=Te.parseVector3(this.target),h=Te.parseVector3(this.position);i.subVectors(h,u)}i.normalize(),i.multiplyScalar(o),i.add(a)}var p=e.flyStart;p&&p(),this.followingObject={object:t,dir:i,speed:l,params:e,centerPos:c}}},t.prototype.stopFollowingObject=function(){if(this.followingObject){var e=this.followingObject.params;this.followingObject=null;var t=e.flyStop;t&&t()}},t.prototype.movePath=function(t){var i=this;this.stopFlying();var r=t.complete;t.complete=function(){i._flying=!1;var e=i.node.getForwardPosition(i.distance);i.target=e.toArray(),r&&r()},this._flying=!0,flyStart&&flyStart(),e.prototype.movePath.call(this,t)},t.prototype.rotateAround=function(t){var i=this,r=(t=t||{}).target||t.object;t.target=r||this.target,this.stopFlying(),this.lookAt(t.target);var n=t.complete;t.complete=function(e){t.stop(),n&&n()},t.stop=function(e){i.lookAt(null),i.app.camera.curOrbit.enabled=!0,i.app.camera.resume({rotate:!0,pan:!0,zoom:!0})},t.update=function(e){i.app.camera.curOrbit.update()},this.app.camera.curOrbit.enabled=!1,this.app.camera.disable({rotate:!0,pan:!0,zoom:!0}),e.prototype.rotateAround.call(this,t)},t.prototype.rotate=function(e){var t=this.distance,i=Te.parseVector3(this.direction),r=Te.parseQuaternion(e);i.applyQuaternion(r),i.normalize();var n=i.clone();n.multiplyScalar(t),n.add(Te.parseVector3(this.position)),this.target=n.toArray()},t.prototype.rotateX=function(e){this.rotate([e,0,0])},t.prototype.rotateY=function(e){if(this.controller instanceof THREE.EarthOrbitControls){var t=new THREE.Vector3;t.copy(this.controller.object.position),t.normalize(),this.controller.object.rotateOnWorldAxis(t,j.degToRad(e));var i=this.controller._getIntersectPoint();this.controller.target.copy(i)}else this.rotate([0,e,0])},t.prototype.rotateZ=function(e){this.rotate([0,0,e])},t.prototype.isInView=function(e){return!(!e||!e.isBaseObject)&&this.node.isInView(e.boundingBox.toBox())},t.prototype.update=function(){this._projScreenMatrix.multiplyMatrices(this.node.projectionMatrix,this.node.matrixWorldInverse),this._frustum.setFromMatrix(this._projScreenMatrix),this.followingObject?this.updateFollowingObject():this.lookingObject&&this.updateLookingObject()},n(t,[{key:"flying",get:function(){return!!this._flying||!!this.followingObject}},{key:"isPerspectiveCamera",get:function(){return this.node.isPerspectiveCamera}},{key:"fov",set:function(e){this.node.setFov(e)},get:function(){return this.node.fov}},{key:"near",set:function(e){this._near=e,this.node.setNear(e)},get:function(){return this._near}},{key:"far",set:function(e){this._far=e,this.node.setFar(e)},get:function(){return this._far}},{key:"up",set:function(e){this.node.up.fromArray(e)},get:function(){return this.node.up.toArray()}},{key:"position",set:function(e){this.node.position.fromArray(e)},get:function(){return this.node.position.toArray()}},{key:"target",set:function(e){var t=this;this._lookAt(e,function(){return t.static})},get:function(){return this.controller.target.toArray()}},{key:"distance",set:function(e){var t=Te.parseVector3(this.position),i=Te.parseVector3(this.target),r=new THREE.Vector3;r.subVectors(t,i),r.normalize(),r.multiplyScalar(e),i.add(r),this.position=i.toArray()},get:function(){var e=Te.parseVector3(this.position),t=Te.parseVector3(this.target);return e.distanceTo(t)}},{key:"direction",get:function(){var e=Te.parseVector3(this.position),t=Te.parseVector3(this.target),i=new THREE.Vector3;return i.subVectors(t,e),i.normalize(),i.toArray()}},{key:"rightDirection",get:function(){var e=THING.Utils.parseVector3(this.direction),t=THING.Utils.parseVector3(this.up),i=new THREE.Vector3;return i.crossVectors(e,t),i.normalize(),i.toArray()}}]),t}(Ye),Wo=function(){function e(t){var i=this;r(this,e),this.app=t,this.picker=t.picker,this.orbit=new THREE.OrbitControls(this.app.renderCamera,this.app.mainDomElement),this.curOrbit=this.orbit,this.initOrbit(this.orbit),this.cameraObject=new qo(this.app,this.app.renderCamera,this.orbit),this.toggleBackupInfo={},this.zoomTween=null,this._autoAdjustNear=!0,this._autoAdjustTarget=!0,this._autoHideObjectsWhenRotatingFunc=null,this._autoFixTargetOnWheel=!0,this._autoFixCameraUp=!0,this._pushCount=0,this._hadEnabledPicking=!1,this._targetObject=null,this._inputEnableFlag=new Xi(function(e){i.curOrbit.enabled=e}),this._panEnableFlag=new Xi(function(e){i.curOrbit.enablePan=e}),this._rotateEnableFlag=new Xi(function(e){i.curOrbit.enableRotate=e}),this._zoomEnableFlag=new Xi(function(e){i.curOrbit.enableZoom=e}),this.cameraObject.isPerspectiveCamera&&(this.cameraFov=this.cameraObject.fov,this.cameraNear=this.cameraObject.near,this.cameraFar=this.cameraObject.far);var n=this;this.app.on("backgroundChanged",function(e){var t=n.toggleBackupInfo.toggleSkyBox;t&&(t.background=e.value)})}return e.prototype.initOrbit=function(e){e.minDistance=1e-4,e.minZoom=.15,e.maxZoom=8,e.autoRotate=!1,e.enableDamping=!0,e.minPolarAngle=0,e.maxPolarAngle=Math.PI,e.keyPanSpeed=.1,e.panSpeed=.1,e.rotateSpeed=.07,e.dampingFactor=.078,e.screenSpacePanning=!0,e.enabled=!0;var t=this;e.addEventListener("mousedownpanevent",function(e){t.onMouseDownPanEvent(e)}),e.addEventListener("mousemoveevent",function(e){t.onMouseMoveEvent(e)}),e.addEventListener("start",function(e){t.onStart(e)}),e.addEventListener("end",function(e){t.onEnd(e)}),e.addEventListener("wheel",function(e){t.onWheel(e)}),e.addEventListener("change",function(e){t.onChange(e)})},e.prototype.isCameraController=function(){return!0},e.prototype._zoom=function(e,t,i){this.zoomTween&&this.zoomTween.stop();var r=this;this.zoomTween=new TWEEN.Tween({zoom:e}).to({zoom:t},i).easing(TWEEN.Easing.Linear.None).onUpdate(function(){r._rotateEnableFlag.enable(!1,!0),r.curOrbit.object.zoom=this._object.zoom,r.curOrbit.object.updateProjectionMatrix()}).onComplete(function(){r._rotateEnableFlag.resume()}).start()},e.prototype._change=function(e){this.app.trigger(e,{position:this.position,target:this.target})},e.prototype._autoFixTarget=function(){var e=this.curOrbit,t=e.target.distanceTo(e.object.position);if(5<t)10<t&&(this._pushCount=0);else{var i=new THREE.Vector3(0,0,0);i.subVectors(e.target,e.object.position).normalize();var r=i.multiplyScalar(10),n=new THREE.Vector3(0,0,0);n.addVectors(e.object.position,r),e.target=n,this._pushCount++,2<this._pushCount&&(this._adjustTarget(),this._pushCount=0)}},e.prototype._adjustTarget=function(){var e=this.app.picker.floorPickingGround.intersect();e&&(this.target=e.point.toArray())},e.prototype.onMouseDownPanEvent=function(e){this._autoAdjustTarget&&this.degreeToWorldYAxis<60&&this._adjustTarget()},e.prototype.onMouseMoveEvent=function(e){this._change("cameraChangeMouseMove")},e.prototype.onStart=function(e){this.flying?this._hadEnabledPicking=!1:(this._hadEnabledPicking=!0,this.app.picker._state.enable(!1,!0)),this._change("cameraChangeStart"),this._change("cameraControllerChangeStart")},e.prototype.onEnd=function(e){this._hadEnabledPicking&&(this._hadEnabledPicking=!1,this.app.picker._state.resume()),this._change("cameraChangeEnd"),this._change("cameraControllerChangeEnd")},e.prototype.onWheel=function(e){this._autoFixTargetOnWheel&&this._autoFixTarget(),this.app.trigger("camerazoom",{delta:e.delta})},e.prototype.onChange=function(e){this.app.trigger("cameracontrollerchanged"),this._change("cameraChange")},e.prototype.zoomIn=function(e){var t=e.zoom||1,i=e.time||1e3,r=t,n=this.curOrbit.object.zoom;this._zoom(r,n,i)},e.prototype.zoomOut=function(e){var t=e.zoom||1,i=e.time||1e3,r=this.curOrbit.object.zoom,n=t;this._zoom(r,n,i)},e.prototype.worldToScreen=function(e){return this.cameraObject.worldToScreen(e)},e.prototype.screenToWorld=function(e,t,i){return this.cameraObject.screenToWorld(e,t,i)},e.prototype.setProjectionType=function(e,t,i,r){var n=4<arguments.length&&void 0!==arguments[4]?arguments[4]:1e3,o=this,a=e!=this.projectionType;switch(e){case w.Perspective:if(this.cameraObject.lerpToPerspective(n,function(){if(a&&o.projectionType==w.Perspective){var e=o.toggleBackupInfo.toggleSkyBox;e&&(o.app.background=e.background,o.app.skyBox=e.skyBox,o.app.backgroundAdditiveColor=e.backgroundAdditiveColor,o.app.backgroundColorScaleFactor=e.backgroundColorScaleFactor,o.toggleBackupInfo.toggleSkyBox=null)}}),a){var s=this.toggleBackupInfo.toggleKeyPanSpeed;void 0!==s&&(this.curOrbit.keyPanSpeed=s);var l=this.toggleBackupInfo.toggleMousePanSpeed;void 0!==l&&(this.curOrbit.panSpeed=l);var c=this.toggleBackupInfo.toggleDampingFactor;void 0!==c&&(this.curOrbit.dampingFactor=c)}break;case w.Orthographic:if(a){var u=this.toggleBackupInfo.toggleSkyBox;u?(u.backgroundAdditiveColor=this.app.backgroundAdditiveColor,u.backgroundColorScaleFactor=this.app.backgroundColorScaleFactor):this.toggleBackupInfo.toggleSkyBox={skyBox:this.app.skyBox,background:this.app.background,backgroundAdditiveColor:this.app.backgroundAdditiveColor,backgroundColorScaleFactor:this.app.backgroundColorScaleFactor}}this.app.skyBox=null,a&&(this.toggleBackupInfo.toggleKeyPanSpeed=this.curOrbit.keyPanSpeed,this.toggleBackupInfo.toggleMousePanSpeed=this.curOrbit.panSpeed,this.toggleBackupInfo.toggleDampingFactor=this.curOrbit.dampingFactor),this.curOrbit.keyPanSpeed=t/6400,this.curOrbit.panSpeed=t/6400,this.curOrbit.dampingFactor=.12;var h=Te.parseVector3(i),p=Te.parseVector3(r);this.cameraObject.lerpToOrthographic(h,p,n);break;default:return!1}},e.prototype.getBestLocation=function(e){var t;return t=Te.isArray(e)?new qe(this.app,e).boundingBox:e.boundingBox,this.cameraObject._getBestLocation(this.projectionType,t)},e.prototype.setType=function(e,t,i,r){var n=this.cameraObject._getBestLocation(t,e.boundingBox),o=n.pos.distanceTo(n.lookAt),a=this.distanceLimited[1];if(a<=o){var s=n.pos.subVectors(n.pos.clone(),n.lookAt);s.normalize();var l=n.pos.addVectors(n.lookAt,s.multiplyScalar(a));n.pos=l}switch(this.setProjectionType(t,n.scale.length(),n.pos,n.lookAt,i),t){case w.Perspective:var c=this.toggleBackupInfo.toggleInitPos;void 0!==c&&(n.pos=Te.parseVector3(c));var u=this.toggleBackupInfo.toggleInitLookAt;void 0!==u&&(n.lookAt=Te.parseVector3(u));break;case w.Orthographic:this.toggleBackupInfo.toggleInitPos=this.position,this.toggleBackupInfo.toggleInitLookAt=this.target;break;default:return!1}var h=this.app.rendererManager.getCurrentControl(),p=h.getConfig(),d=p.temporalSuperSampling.enable,f=p.postEffect.screenSpaceAmbientOcclusion.enable;h.mergeConfig({temporalSuperSampling:{enable:!1},postEffect:{screenSpaceAmbientOcclusion:{enable:!1}}}).update();var m=function(){h.mergeConfig({temporalSuperSampling:{enable:d},postEffect:{screenSpaceAmbientOcclusion:{enable:f}}}).update(),r&&r()};return this.flyTo({position:n.pos.toArray(),target:n.lookAt.toArray(),up:n.up.toArray(),time:i,stop:m,complete:m}),!0},e.prototype.toggleNormalViewMode=function(e){return this.viewMode!=T.Normal&&(this.toggleObject({object:this.app.root,is3D:!0,complete:function(){e&&e()}}),!0)},e.prototype.toggleObject=function(e){var t=(e=e||{}).object||this.app.level.current||this.app.root,i=Te.parseValue(e.is3D,!1),r=e.complete,n=e.time||1e3,o=Te.parseValue(e.force,!1),a=!1;return i?(o||this.projectionType!=w.Perspective)&&(this.projectionType!=w.Perspective&&this._rotateEnableFlag.resume(),a=this.setType(t,w.Perspective,n,r)):(o||this.projectionType!=w.Orthographic)&&(this.projectionType!=w.Orthographic&&this._rotateEnableFlag.enable(!1,!0),a=this.setType(t,w.Orthographic,n,r)),a&&this.app.trigger("cameraViewChange",{view:this.projectionType}),a},e.prototype.resize=function(e,t){this.cameraObject.setSize(e,t)},e.prototype.getRaycaster=function(e,t){return this.cameraObject.getRaycaster(e,t)},e.prototype._buildFlyParams=function(e){var t=this,i=e._flyStart,r=e._flying,n=e._flyStop,o=e._flyComplete;return e.flyStart=function(){t.picker._state.enable(!1,!0),t._change("cameraChangeStart"),i&&i()},e.flying=function(){Te.isFunction(t.curOrbit.setState)&&t.curOrbit.setState(),t._change("cameraChange"),r&&r()},e.flyStop=function(){t._inputEnableFlag.resume(),Te.isFunction(t.curOrbit.setState)&&t.curOrbit.setState(),t.picker._state.resume(),t._change("cameraChangeEnd");var i=e.stop;i&&i(),n&&n()},e.flyComplete=function(){e.flyStop();var i=e.target||e.object;i instanceof Ye&&i.trigger("cameraFlyComplete");var r=e.targetForFlyComplete;r!=i&&r instanceof Ye&&r.trigger("cameraFlyComplete"),t.app.events.dispatchEvent({type:"cameraFlyComplete"});var n=e.complete;n&&n(),o&&o()},e.autoFixUp=this._autoFixCameraUp,e.targetForFlyComplete=this.app.level.current,e},e.prototype.fit=function(e){(e=e||{}).isBaseObject&&(e={object:e}),e.object=e.object||this.app.root,e.time=1,this.cameraObject.flyTo(e)},e.prototype.stopFlying=function(){this.cameraObject.stopFlying()},e.prototype.flyTo=function(e){e=this._buildFlyParams(e),this.cameraObject.flyTo(e)},e.prototype.movePath=function(e){e=this._buildFlyParams(e),this.cameraObject.movePath(e)},e.prototype.lookAt=function(e){this.cameraObject.lookAt(e)?(this._rotateEnableFlag.enable(!1,!0),this._panEnableFlag.enable(!1,!0)):(this._rotateEnableFlag.resume(),this._panEnableFlag.resume())},e.prototype.stopRotateAround=function(){this.cameraObject.stopRotating()},e.prototype.rotateAround=function(e){var t=this;(e=e||{}).rotateStart=function(){t.picker._state.enable(!1,!0)},e.rotateComplete=function(){t.picker._state.resume()},this.cameraObject.rotateAround(e)},e.prototype.rotateAroundX=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:500;this.rotateAround({xRotateAngle:e,time:t})},e.prototype.rotateAroundY=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:500;this.rotateAround({yRotateAngle:e,time:t})},e.prototype.followObject=function(e){e=e||{},this.cameraObject.followObject(e);var t=Te.parseValue(e.enableRotate,!1),i=Te.parseValue(e.enableZoom,!1);t||this._rotateEnableFlag.enable(!1,!0),i||this._zoomEnableFlag.enable(!1,!0)},e.prototype.stopFollowingObject=function(){this.cameraObject.stopFollowingObject(),this._rotateEnableFlag.resume(),this._zoomEnableFlag.resume()},e.prototype.canUpdateOrbit=function(){return!(this.cameraObject.flying||!this.curOrbit.enabled&&!this.curOrbit.autoRotate)},e.prototype.update=function(){this.cameraObject.update(),this.canUpdateOrbit()&&this.curOrbit.update()},e.prototype.onUpdate=function(e){this.update(e)},e.prototype.zoom=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:500;if(e=Math.min(this.distance-1,e),this.projectionType==w.Perspective){var i=Te.parseVector3(this.direction);i.multiplyScalar(e);var r=Te.parseVector3(this.position);r.add(i),this.flyTo({position:r.toArray(),target:this.target,time:t})}else{var n=this.curOrbit.object.zoom+e/20;0<n&&this.zoomOut({zoom:n,time:t})}},e.prototype.rotateX=function(e,t){Te.isNull(t)?this.cameraObject.rotateX(e):(console.warn('Please use "this.rotateAround({xRotateAngle: angle,time});" to replace rotateX(angle, time)'),this.rotateAround({xRotateAngle:e,time:t}))},e.prototype.rotateY=function(e,t){Te.isNull(t)?this.cameraObject.rotateY(e):(console.warn('Please use "this.rotateAround({yRotateAngle: angle,time});" to replace rotateX(angle, time)'),this.rotateAround({yRotateAngle:e,time:t}))},e.prototype.rotateZ=function(e){this.cameraObject.rotateZ(e)},e.prototype.move=function(e,t){var i=this.dampingFactor/.12;this.curOrbit.move(-e*i,t*i)},e.prototype.loadViewPoint=function(e){this.app.viewPointManger.loadJSON(e)},e.prototype.playViewPoint=function(e){this.app.viewPointManger.play(e)},e.prototype.pauseViewPoint=function(e){this.app.viewPointManger.pause(e)},e.prototype.isInView=function(e){return!!e&&this.cameraObject.isInView(e)},e.prototype.isCovered=function(e){return!!e&&(console.warn("not impl yet"),!0)},e.prototype.disable=function(e){(e=e||{}).rotate=Te.parseValue(e.rotate,!0),e.pan=Te.parseValue(e.pan,!0),e.zoom=Te.parseValue(e.zoom,!0),e.rotate&&this._rotateEnableFlag.enable(!1,!0),e.pan&&this._panEnableFlag.enable(!1,!0),e.zoom&&this._zoomEnableFlag.enable(!1,!0)},e.prototype.resume=function(e){(e=e||{}).rotate=Te.parseValue(e.rotate,!0),e.pan=Te.parseValue(e.pan,!0),e.zoom=Te.parseValue(e.zoom,!0),e.rotate&&this._rotateEnableFlag.resume(),e.pan&&this._panEnableFlag.resume(),e.zoom&&this._zoomEnableFlag.resume()},e.prototype.showTargetNode=function(){0<arguments.length&&void 0!==arguments[0]&&!arguments[0]?this._targetObject&&(this._targetObject.destroy(),this._targetObject=null):this._targetObject||(this._targetObject=this.app.create({type:"Box",position:this.target,style:{color:"#FF0000"}}),this._targetObject.pickable=!1,this._targetObject.style.outlineColor=65535)},e.prototype.distanceTo=function(e){return this.cameraObject.distanceTo(e)},e.prototype.log=function(){console.log("["+this.position.toString()+"], ["+this.target.toString()+"]")},e.prototype.dolly=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:500;console.warn("[CameraController] Please use '.zoom()' to replace '.dolly()'"),this.zoom(e,t)},e.prototype.theta=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:500;console.warn("[CameraController] Please use '.rotateX()' to replace '.theta()'"),this.rotateX(e,t)},e.prototype.phi=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:500;console.warn("[CameraController] Please use '.rotateY()' to replace '.theta()'"),this.rotateY(e,t)},n(e,[{key:"frustum",get:function(){return this.cameraObject._frustum}},{key:"camera",get:function(){return this.app.renderCamera}},{key:"viewMode",set:function(e){this.toggleObject({is3D:e==T.Normal})},get:function(){return this.projectionType==w.Perspective?T.Normal:T.TopView}},{key:"projectionType",set:function(e){this.setProjectionType(e,this.distance,this.position,this.target)},get:function(){return this.cameraObject.projectionType}},{key:"enableDamping",set:function(e){this.curOrbit.enableDamping=e},get:function(){return this.curOrbit.enableDamping}},{key:"dampingFactor",set:function(e){this.curOrbit.dampingFactor=e},get:function(){return this.curOrbit.dampingFactor}},{key:"fov",set:function(e){this.cameraObject.fov=e;var t=this.app.webViewManager.mixerContext.cssCamera;t.fov=e,t.updateProjectionMatrix()},get:function(){return this.cameraObject.fov}},{key:"near",set:function(e){this.cameraObject.near=e},get:function(){return this.cameraObject.near}},{key:"far",set:function(e){this.cameraObject.far=e},get:function(){return this.cameraObject.far}},{key:"zoomLimited",set:function(e){this.curOrbit.minZoom=e[0],this.curOrbit.maxZoom=e[1]},get:function(){return[this.curOrbit.minZoom,this.curOrbit.maxZoom]}},{key:"zoomFactor",set:function(e){void 0!==this.curOrbit.zoomFactor?this.curOrbit.zoomFactor=e:void 0!==this.curOrbit.zoomSpeed&&(this.curOrbit.zoomSpeed=e)},get:function(){return void 0!==this.curOrbit.zoomFactor?this.curOrbit.zoomFactor:void 0!==this.curOrbit.zoomSpeed?this.curOrbit.zoomSpeed:1}},{key:"distanceLimited",set:function(e){this.curOrbit.minDistance=e[0],this.curOrbit.maxDistance=e[1]},get:function(){return[this.curOrbit.minDistance,this.curOrbit.maxDistance]}},{key:"yAngleLimited",set:function(e){this.curOrbit.minPolarAngle=j.degToRad(e[0]),this.curOrbit.maxPolarAngle=j.degToRad(e[1])},get:function(){return[j.radToDeg(this.curOrbit.minPolarAngle),j.radToDeg(this.curOrbit.maxPolarAngle)]}},{key:"xAngleLimited",set:function(e){this.curOrbit.minAzimuthAngle=j.degToRad(e[0]),this.curOrbit.maxAzimuthAngle=j.degToRad(e[1])},get:function(){return[j.radToDeg(this.curOrbit.minAzimuthAngle),j.radToDeg(this.curOrbit.maxAzimuthAngle)]}},{key:"keyPanSpeed",set:function(e){this.curOrbit.keyPanSpeed=e},get:function(){return this.curOrbit.keyPanSpeed}},{key:"mousePanSpeed",set:function(e){this.curOrbit.panSpeed=e},get:function(){return this.curOrbit.panSpeed}},{key:"distance",set:function(e){this.cameraObject.distance=e},get:function(){return this.cameraObject.distance}},{key:"direction",get:function(){return this.cameraObject.direction}},{key:"rightDirection",get:function(){return this.cameraObject.rightDirection}},{key:"up",set:function(e){this.cameraObject.up=e},get:function(){return this.cameraObject.up}},{key:"position",set:function(e){e&&(this.cameraObject.position=e)},get:function(){return this.cameraObject.position}},{key:"target",set:function(e){e&&(this.cameraObject.target=e)},get:function(){return this.cameraObject.target}},{key:"inputEnabled",set:function(e){this._inputEnableFlag.enable(e)},get:function(){return this._inputEnableFlag.enable()}},{key:"enableRotate",set:function(e){this._rotateEnableFlag.enable(e)},get:function(){return this._rotateEnableFlag.enable()}},{key:"enableZoom",set:function(e){this._zoomEnableFlag.enable(e)},get:function(){return this._zoomEnableFlag.enable()}},{key:"enablePan",set:function(e){this._panEnableFlag.enable(e)},get:function(){return this._panEnableFlag.enable()}},{key:"flying",get:function(){return this.cameraObject.flying}},{key:"mode",set:function(e){this.mode!=e&&(this.curOrbit.enabled=!1,this.autoAdjustNear="earth"==e?(this.curOrbit=new THREE.EarthOrbitControls(this.app.renderCamera,this.app.mainDomElement),this.curOrbit.app=this.app,this.initOrbit(this.curOrbit),!1):(this.curOrbit.dispose(),this.curOrbit=this.orbit,this.curOrbit.enabled=!0),this.cameraObject.controller=this.curOrbit)},get:function(){return this.curOrbit instanceof THREE.EarthOrbitControls?"earth":"normal"}},{key:"degreeToWorldYAxis",get:function(){var e=Te.parseVector3(this.direction),t=new THREE.Vector3(0,-1,0),i=e.dot(t);return j.radToDeg(Math.acos(i))}},{key:"autoAdjustNear",set:function(e){(this._autoAdjustNear=e)||(this.cameraObject.near=this.cameraObject._near)},get:function(){return this._autoAdjustNear}},{key:"autoAdjustTarget",set:function(e){this._autoAdjustTarget=e},get:function(){return this._autoAdjustTarget}},{key:"autoFixTargetOnWheel",set:function(e){this._autoFixTargetOnWheel=e},get:function(){return this._autoFixTargetOnWheel}},{key:"autoFixCameraUp",set:function(e){this._autoFixCameraUp=e},get:function(){return this._autoFixCameraUp}},{key:"autoHideObjectsWhenRotatingFunc",set:function(e){if(this._autoHideObjectsWhenRotatingFunc=e,this.app.off("cameraControllerChangeStart",null,"__autoHideObjectsWhenRotatingFunc__start__"),this.app.off("cameraControllerChangeEnd",null,"__autoHideObjectsWhenRotatingFunc__end__"),this._autoHideObjectsWhenRotatingFunc){if(!Te.isFunction(this._autoHideObjectsWhenRotatingFunc))return;var t=this;this.app.on("cameraControllerChangeStart",function(e){t.app.query(".Thing").forEach(function(e){if(t._autoHideObjectsWhenRotatingFunc&&!1===t._autoHideObjectsWhenRotatingFunc(e)&&e.visible){e._prevVisible_auto_hide=!0;var i=app.modelResource.get(e.url);i&&i.loadingBox?(e.changeAppearance(i.loadingBox.clone()),e._needRevertAppearance_auto_hide=!0):e.visible=!1}})},"__autoHideObjectsWhenRotatingFunc__start__"),this.app.on("cameraControllerChangeEnd",function(e){t.app.query(".Thing").forEach(function(e){e._prevVisible_auto_hide&&(e._needRevertAppearance_auto_hide?(e.changeAppearance(null),delete e._needRevertAppearance_auto_hide):e.visible=!0,delete e._prevVisible_auto_hide)})},"__autoHideObjectsWhenRotatingFunc__end__")}},get:function(){return this._autoHideObjectsWhenRotatingFunc}},{key:"mouseButtons",set:function(e){var t=function(e){return{left:THREE.MOUSE.LEFT,middle:THREE.MOUSE.MIDDLE,right:THREE.MOUSE.RIGHT}[e]};e=e||{};var i=this.orbit.mouseButtons,r=t(e.left,i.LEFT),n=t(e.middle,i.MIDDLE),o=t(e.right,i.RIGHT);this.orbit.mouseButtons={LEFT:r,MIDDLE:n,RIGHT:o}},get:function(){var e=function(e){return["left","middle","right"][e]},t=this.orbit.mouseButtons;return{left:e(t.LEFT),middle:e(t.MIDDLE),right:e(t.RIGHT)}}},{key:"toggle3D",set:function(e){console.warn("[CameraController] Please use '.viewMode=THING.CameraView.Normal/TopView' to replace '.toggle3D'"),this.viewMode=e?T.Normal:T.TopView},get:function(){return console.warn("[CameraController] Please use '.viewMode == THING.CameraView.Normal' to replace '.toggle3D'"),this.viewMode==T.Normal}},{key:"enabled",set:function(e){console.warn("[CameraController] Please use '.inputEnabled' to replace '.enabled'"),this.inputEnabled=e},get:function(){return console.warn("[CameraController] Please use '.inputEnabled' to replace '.enabled'"),this.inputEnabled}},{key:"minZoom",set:function(e){console.warn("[CameraController] Please use '.zoomLimited=[min, max]' to replace '.minZoom'"),this.zoomLimited=[e,this.zoomLimited[1]]},get:function(){return console.warn("[CameraController] Please use '.zoomLimited[0]' to replace '.minZoom'"),this.zoomLimited[0]}},{key:"maxZoom",set:function(e){console.warn("[CameraController] Please use '.zoomLimited=[min, max]' to replace '.maxZoom'"),this.zoomLimited=[this.zoomLimited[0],e]},get:function(){return console.warn("[CameraController] Please use '.zoomLimited[0]' to replace '.maxZoom'"),this.zoomLimited[1]}},{key:"minDistance",set:function(e){console.warn("[CameraController] Please use '.distanceLimited=[min, max]' to replace '.minDistance'"),this.distanceLimited=[e,this.distanceLimited[1]]},get:function(){return console.warn("[CameraController] Please use '.distanceLimited[0]' to replace '.minDistance'"),this.distanceLimited[0]}},{key:"maxDistance",set:function(e){console.warn("[CameraController] Please use '.distanceLimited=[min, max]' to replace '.maxDistance'"),this.distanceLimited=[this.distanceLimited[0],e]},get:function(){return console.warn("[CameraController] Please use '.distanceLimited[0]' to replace '.maxDistance'"),this.distanceLimited[1]}},{key:"minPolarAngle",set:function(e){console.warn("[CameraController] Please use '.verticalAngleLimited=[min, max]' to replace '.minPolarAngle'"),this.verticalAngleLimited=[e,this.verticalAngleLimited[1]]},get:function(){return console.warn("[CameraController] Please use '.verticalAngleLimited[0]' to replace '.minPolarAngle'"),this.verticalAngleLimited[0]}},{key:"maxPolarAngle",set:function(e){console.warn("[CameraController] Please use '.verticalAngleLimited=[min, max]' to replace '.maxPolarAngle'"),this.verticalAngleLimited=[this.verticalAngleLimited[0],e]},get:function(){return console.warn("[CameraController] Please use '.verticalAngleLimited[0]' to replace '.maxPolarAngle'"),this.verticalAngleLimited[1]}},{key:"minAzimuthAngle",set:function(e){console.warn("[CameraController] Please use '.horizontalAngleLimited=[min, max]' to replace '.minAzimuthAngle'"),this.horizontalAngleLimited=[e,this.horizontalAngleLimited[1]]},get:function(){return console.warn("[CameraController] Please use '.horizontalAngleLimited[0]' to replace '.minAzimuthAngle'"),this.horizontalAngleLimited[0]}},{key:"maxAzimuthAngle",set:function(e){console.warn("[CameraController] Please use '.horizontalAngleLimited=[min, max]' to replace '.maxAzimuthAngle'"),this.horizontalAngleLimited=[this.horizontalAngleLimited[0],e]},get:function(){return console.warn("[CameraController] Please use '.horizontalAngleLimited[0]' to replace '.maxAzimuthAngle'"),this.horizontalAngleLimited[1]}},{key:"verticalAngleLimited",set:function(e){console.warn("[CameraController] Please use '.yAngleLimited' to replace '.verticalAngleLimited'"),this.yAngleLimited=e},get:function(){return console.warn("[CameraController] Please use '.yAngleLimited' to replace '.verticalAngleLimited'"),this.yAngleLimited}},{key:"horizontalAngleLimited",set:function(e){console.warn("[CameraController] Please use '.xAngleLimited' to replace '.verticalAngleLimited'"),this.xAngleLimited=e},get:function(){return console.warn("[CameraController] Please use '.xAngleLimited' to replace '.verticalAngleLimited'"),this.xAngleLimited}},{key:"rotating",get:function(){return console.warn("[CameraController] Please use '.flying' to replace '.rotating'"),this.flying}},{key:"panSpeed",set:function(e){console.warn("[CameraController] Please use '.keyPanSpeed' to replace '.panSpeed'"),this.keyPanSpeed=e},get:function(){return console.warn("[CameraController] Please use '.keyPanSpeed' to replace '.panSpeed'"),this.keyPanSpeed}}]),e}(),Go=function(){function e(t){r(this,e),this.app=t,this._currentParentObject=null,this._previous=null,this._current=null,this._root=null,this._changed=!1,this._options={outlineColor:16744448,autoChangeBackground:!0,autoBakeFloor:!0,autoHideFloorObjects:!0}}return e.prototype.init=function(){this._root=this.app.root},e.prototype.buildState=function(e){var t=e.type;"Campus"==t&&(t="Outdoors");var i={};i.name=t+"Level";var r=[];e instanceof ii?(r.push("floor"),r.push("_floor")):e instanceof ri&&(r.push("building"),r.push("_building"));for(var n=0;n<r.length;n++)i[r[n]]=e;return i},e.prototype.buildAfterEnterState=function(e){var t=e.type;"Campus"==t&&(t="Outdoors");var i=this.previous?this.previous.type:"";"Campus"==i&&(i="Outdoors");var r={prevState:{name:i+"Level"},state:this.buildState(e),stateName:t+"Level"};return this.previous&&(this.previous instanceof ri?(r.prevState.building=this.previous,r.prevState._building=this.previous):this.previous instanceof ii&&(r.prevState.floor=this.previous,r.prevState._floor=this.previous)),r},e.prototype.buildBeforeEnterState=function(e){var t=e.type;"Campus"==t&&(t="Outdoors");var i=this.current?this.current.type:"";"Campus"==i&&(i="Outdoors");var r={prevState:{name:i+"Level"},curState:this.buildState(e),stateName:t+"Level"};return this.previous&&(this.previous instanceof ri?(r.prevState.building=this.previous,r.prevState._building=this.previous):this.previous instanceof ii&&(r.prevState.floor=this.previous,r.prevState._floor=this.previous)),r},e.prototype.getEventType=function(e,t){var i=t.type;return"Campus"==i&&(i="Outdoors"),e+i+"Level"},e.prototype.buildEventArguments=function(e){var t=e.type;"Campus"==t&&(t="Outdoors");var i={name:t+"Level"};return i.state=this.buildState(e),i},e.prototype.notifyBeforeEnterState=function(e){this.app.trigger("beforeEnterState",this.buildBeforeEnterState(e))},e.prototype.notifyAfterEnterState=function(e){this.app.trigger("afterEnterState",this.buildAfterEnterState(e))},e.prototype.nofityAfterLevelChange=function(e){var t=e.object;this.app.trigger(this.getEventType("enter",t),this.buildEventArguments(t)),this.app.trigger(this.getEventType("afterEnter",t),this.buildEventArguments(t))},e.prototype.notifyBeforeLevelChange=function(e){this.app.trigger(this.getEventType("beforeEnter",e),this.buildEventArguments(e))},e.prototype._getLevelType=function(){var e=this._current;return e?e.type:""},e.prototype._leaveLevel=function(e,t){if(this.app.trigger(H.BeforeLevelChange,{level:this._getLevelType(),current:this._current,previous:this._previous,next:e}),this._current){var i=Te.cloneObject(t);i.level=this._getLevelType(),i.object=e,i.current=e,i.previous=this._current,this._current.trigger(H.LevelChange,i),this._current.trigger(H.LeaveLevel,i),this.app.trigger(H.LeaveLevel,i)}e&&(this.notifyBeforeLevelChange(e),this.notifyBeforeEnterState(e))},e.prototype._notifyEnterLevel=function(e,t){t.object=e,this.app.trigger(H.EnterLevel,t),this._currentParentObject=e,this.nofityAfterLevelChange(t)},e.prototype._enterLevel=function(e,t){var i=this;if(this._changed=!0,this._previous=this._current,this._current=e,this._currentParentObject=this._current,t.level=this._getLevelType(),t.current=this._current,t.object=this._current,t.previous=this._previous,this.app.trigger(H.LevelChange,t),e){var r=t.lastObject;r.internalUserData.level_complete||(r.internalUserData.level_complete=!0,r.one(H.EnterLevel,function(e){delete e.object.internalUserData.level_complete;var n=t.userComplete;n&&n(),r.one("cameraFlyComplete",{lastLevelChanged:!0},function(e){if(e.data.lastLevelChanged&&e.object==r){var n=t.flyComplete;n&&n()}e.object.trigger(H.LevelFlyEnd,{level:i._getLevelType(),object:e.object,current:e.object,previous:i.previous}),i.app.trigger(H.LevelFlyEnd,{level:i._getLevelType(),object:e.object,current:e.object,previous:i.previous})},"___level_camera_fly_complete___")},"___level_complete___")),e.trigger(H.LevelChange,t),this.notifyAfterEnterState(e);var n=e.isPauseEvent(H.EnterLevel,k.LevelFly),o=e.hasEvent(H.EnterLevel,k.LevelFly);if(t.jumping||n||!o){e.pauseEvent(H.EnterLevel,null,k.LevelFly),e.trigger(H.EnterLevel,t),e.resumeEvent(H.EnterLevel,null,k.LevelFly),this._notifyEnterLevel(e,t);var a=t.complete;a&&a(),n&&this.jumpLevelPath(t)}else e.trigger(H.EnterLevel,t),this._notifyEnterLevel(e,t)}},e.prototype._change=function(e,t){t=t||{};var i=this;this.app.camera.toggleNormalViewMode(function(){i._change(e,t)})||("Outdoors"==e.type&&(console.warn("Please use campus to change, not outdoors"),e=e.parents.query(".Campus")[0]),e.isPauseEvent(H.EnterLevel)||(this._leaveLevel(e,t),this._enterLevel(e,t)))},e.prototype.updateJumping=function(e,t){var i=this._current;i&&(i.isChildOf(e)||i.isBrotherOf(e))&&(t.jumping=!0,t.skipBackupCameraInfo=!0)},e.prototype.getParents=function(e,t){for(var i=[],r=e.parents,n=0;n<r.length;n++){var o=r[n];if(o==this.app.root)break;if(i.push(o),o==t)break}return i},e.prototype.getLevelPath=function(e,t){if(t.autoEnterSubLevel)for(;1===e.children.length;){var i=e.children[0];if(i instanceof tt)break;e=i}var r=[];if(this._current)if(this._current.isChildOf(e))2<=(r=this.getParents(this._current,e)).length&&(t.jumping=!0);else if(e.isChildOf(this._current))(r=(r=this.getParents(e,this._current)).reverse()).splice(0,1),r.push(e);else{(r=(r=this.getParents(e,null)).reverse()).push(e);for(var n=this._current.parents;2<r.length&&-1!==n.indexOf(r[0])&&-1!==n.indexOf(r[1]);)r.splice(0,1)}else r.push(e),r=(r=r.concat(e.parents.not(this.app.root).toArray())).reverse();if(function(e){for(var t=0;t<e.length;t++)if(e[t].isFacade)return!0;return!1}(r))for(var o=0;o<r.length;o++)r[o].isBuilding&&r.splice(o,1);return r},e.prototype.jumpLevelPath=function(e){var t=e.levelPath;if(t&&(t.splice(0,1),t.length)){var i=t[0];if(1==t.length)delete e.jumping,this.app.off("cameraFlyComplete","sceneLevel_cameraFlyComplete");else{var r=t[t.length-1];this.updateJumping(r,e)}this._change(i,e)}},e.prototype.change=function(e,t){if(t=t||{},e){if(!e.isPauseEvent(H.EnterLevel)&&e.hasEvent(H.EnterLevel)&&(Te.parseValue(t.autoChangeObject,!0)&&e instanceof tt&&(e=e.building),!t.skipCurrentLevel||e!=this._current)){var i=this.getLevelPath(e,t);if(i.length){var r=i[0],n=1<i.length?i[i.length-1]:null;if(n&&this.updateJumping(n,t),this.app.off("cameraFlyComplete",null,"sceneLevel_cameraFlyComplete"),t.userComplete=t.complete,t.userFlyComplete=t.flyComplete,1<i.length){t.levelPath=i;var o=this;t.jumping?t.complete=function(){o.jumpLevelPath(t)}:this.app.on("cameraFlyComplete",function(e){o.jumpLevelPath(t)},"sceneLevel_cameraFlyComplete")}t.lastObject=n||e,this._change(r,t)}}}else console.error("Please provide the object to change")},e.prototype.quit=function(e){e=e||{},this._current&&(this._leaveLevel(null,e),this._enterLevel(null,e),this._currentParentObject=this.app.root)},e.prototype.back=function(e){if(e=e||{},this._current){var t=this._current.parent;if(e.autoBackFromSubLevel)for(;t&&t.parent&&1===t.children.length;)t=t.parent;this.backTo(t)}},e.prototype.backTo=function(e){if(e&&e!=this._current&&e.isChildOf(this._root)){e.isFacade&&(e=e.parents.query(".Campus")[0]);var t=this;this.app.camera.toggleNormalViewMode(function(){t.backTo(e)})||this.change(e,{autoChangeObject:!1})}},e.prototype.isChanged=function(){return this._changed},e.prototype.onUpdate=function(e){this._changed&&(this._changed=!1)},n(e,[{key:"current",get:function(){return this._current}},{key:"previous",get:function(){return this._previous}},{key:"root",set:function(e){this._root=e},get:function(){return this._root}},{key:"currentParentObject",set:function(e){this._currentParentObject=e},get:function(){return this._currentParentObject}},{key:"options",set:function(e){this._options=Te.mergeObject(this._options,e,!0)},get:function(){return this._options}}]),e}(),Xo=function(){function e(t){r(this,e),this.app=t,this._backups={camera:{},lighting:{},postEffect:{}},this._campusSkyBox=null,this._campusBackground=null,this._campusSkyBoxColorTween=null,this._levelChanging=!1,this._lastPickedObject=null}return e.prototype.setCampusSkyBoxColorScaleFactor=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1e3;this._campusSkyBoxColorTween&&this._campusSkyBoxColorTween.stop();var i=Te.parseVector3(this.app.backgroundColorScaleFactor),r=Te.parseVector3(e),n=this;this._campusSkyBoxColorTween=new TWEEN.Tween(i).to(r,t).onUpdate(function(){n.app.backgroundColorScaleFactor=[this._object.x,this._object.y,this._object.z]}),this._campusSkyBoxColorTween.start()},e.prototype.updatebackupInfo=function(e,t){var i=this._backups[e];i[t]=i[t]||{};var r=i[t];"camera"==e?(r.position=this.app.camera.position,r.target=this.app.camera.target):"lighting"==e?r.value=this.app.lighting:"postEffect"==e&&(r.value=this.app.postEffect)},e.prototype.clearBackupInfo=function(e,t){delete this._backups[e][t]},e.prototype.getBackupInfoValue=function(e,t,i){var r=this._backups[e][t];return r?r[i]:null},e.prototype.initAppEvents=function(){var e=this;this.app.on("cameracontrollerchanged",function(t){e.app.level.current&&e._levelChanging&&e.app.camera.stopFlying()},k.LevelFlyBreak),this.app.on("dblclick",function(t){if(0==t.button){var i=e.app.level,r=i.current;if(r){var n,o=t.object;if(o!=r&&(n=o)&&!n.isTextRegion){if(o.isGround)return;var a=!1;o.isBuilding&&(a=!0),i.change(o,{autoEnterSubLevel:a})}}}},k.LevelEnterOperation),this.app.on("click",function(t){if(2==t.button){var i=e.app.level;if(i.current){var r=t.object;r&&(r.style.outlineColor=null);var n=!1;i.current.isFloor&&(n=!0),i.back({autoBackFromSubLevel:n})}}},k.LevelBackOperation),this.app.on(H.Pick,function(t){var i=e.app.level;if(i.current){e._lastPickedObject&&(e._lastPickedObject.style.outlineColor=null);var r,n,o=t.object;r=o,!(n=e.app.level.current)||!r||r==n||"Ground"==r.type||n.isCampus&&r.isChildOf(n.ground)||(o.style.outlineColor=i.options.outlineColor),e._lastPickedObject=o}},k.LevelPickOperation),this._campusSkyBox=this.app.skyBox,this._campusBackground=this.app.background,this.app.on("skyboxchange",function(t){var i=e.app.level.current;i&&!i.isCampus||(e._campusSkyBox=t.skyBox)})},e.prototype.buildFlyParams=function(e,t){t=t||{};var i=this;e._flyStart=function(){i._levelChanging=!0},e._flying=function(){i._levelChanging=!0},e._flyStop=function(){i._levelChanging=!1},e._flyComplete=function(){i._levelChanging=!1},e.distance=e.distance||t.distance,e.time=Te.parseValue(e.time||t.time,1e3),e.keepDirection=Te.parseValue(e.keepDirection||t.keepDirection,!1);var r=this.app.level.current;return t.lastObject==r&&(e.offset=e.offset||t.offset,e.worldOffset=e.worldOffset||t.worldOffset,e.radius=e.radius||t.radius||r.boundingBox.radius,e.xAngle=Te.parseValue(e.xAngle||t.xAngle,null),e.yAngle=Te.parseValue(e.yAngle||t.yAngle,null)),e.targetForFlyComplete=r,e},e.prototype.registerSceneLevelEvents=function(){var e=this;this.app.on(H.EnterLevel,".Campus",function(t){e.onCampusLevelSetBackground(t)},k.LevelSetBackground),this.app.on(H.EnterLevel,".Campus",function(t){e.onCampusLevelSetEffect(t)},k.LevelSetEffect),this.app.on(H.EnterLevel,".Campus",function(t){e.onCampusLevelSceneOperations(t)},k.LevelSceneOperations),this.app.on(H.EnterLevel,".Campus",function(t){e.onCampusLevelPickedResultFunc(t)},k.LevelPickedResultFunc),this.app.on(H.EnterLevel,".Campus",function(t){e.onCampusLevelFly(t)},k.LevelFly),this.app.on(H.LeaveLevel,".Campus",function(t){e.onCampusLevelLeaveSceneOperations(t)},k.LevelSceneOperations),this.app.on(H.EnterLevel,".Facade",function(t){e.onFacadeLevelSetBackground(t)},k.LevelSetBackground),this.app.on(H.EnterLevel,".Facade",function(t){e.onFacadeLevelSetEffect(t)},k.LevelSetEffect),this.app.on(H.EnterLevel,".Facade",function(t){e.onFacadeLevelSceneOperations(t)},k.LevelSceneOperations),this.app.on(H.EnterLevel,".Facade",function(t){e.onFacadeLevelPickedResultFunc(t)},k.LevelPickedResultFunc),this.app.on(H.EnterLevel,".Facade",function(t){e.onFacadeLevelFly(t)},k.LevelFly),this.app.on(H.LeaveLevel,".Facade",function(t){e.onFacadeLevelLeaveSceneOperations(t)},k.LevelSceneOperations),this.app.on(H.EnterLevel,".Building",function(t){e.onBuildingLevelSetBackground(t)},k.LevelSetBackground),this.app.on(H.EnterLevel,".Building",function(t){e.onBuildingLevelSetEffect(t)},k.LevelSetEffect),this.app.on(H.EnterLevel,".Building",function(t){e.onBuildingLevelSceneOperations(t)},k.LevelSceneOperations),this.app.on(H.EnterLevel,".Building",function(t){e.onBuildingLevelPickedResultFunc(t)},k.LevelPickedResultFunc),this.app.on(H.EnterLevel,".Building",function(t){e.onBuildingLevelFly(t)},k.LevelFly),this.app.on(H.LeaveLevel,".Building",function(t){e.onBuildingLevelLeaveSceneOperations(t)},k.LevelSceneOperations),this.app.on(H.EnterLevel,".Floor",function(t){e.onFloorLevelSetBackground(t)},k.LevelSetBackground),this.app.on(H.EnterLevel,".Floor",function(t){e.onFloorLevelSetEffect(t)},k.LevelSetEffect),this.app.on(H.EnterLevel,".Floor",function(t){e.onFloorLevelSceneOperations(t)},k.LevelSceneOperations),this.app.on(H.EnterLevel,".Floor",function(t){e.onFloorLevelPickedResultFunc(t)},k.LevelPickedResultFunc),this.app.on(H.EnterLevel,".Floor",function(t){e.onFloorLevelFly(t)},k.LevelFly),this.app.on(H.LeaveLevel,".Floor",function(t){e.onFloorLevelLeaveSceneOperations(t)},k.LevelSceneOperations),this.app.on(H.EnterLevel,".Room",function(t){e.onRoomLevelSceneOperations(t)},k.LevelSceneOperations),this.app.on(H.EnterLevel,".Room",function(t){e.onRoomLevelPickedResultFunc(t)},k.LevelPickedResultFunc),this.app.on(H.EnterLevel,".Room",function(t){e.onRoomLevelFly(t)},k.LevelFly),this.app.on(H.LeaveLevel,".Room",function(t){e.onRoomLevelLeaveSceneOperations(t)},k.LevelSceneOperations),this.app.on(H.EnterLevel,".Thing",function(t){e.onThingLevelSceneOperations(t)},k.LevelSceneOperations),this.app.on(H.EnterLevel,".Thing",function(t){e.onThingLevelPickedResultFunc(t)},k.LevelPickedResultFunc),this.app.on(H.EnterLevel,".Thing",function(t){e.onThingLevelFly(t)},k.LevelFly),this.app.on(H.LeaveLevel,".Thing",function(t){e.onThingLevelLeaveSceneOperations(t)},k.LevelSceneOperations)},e.prototype.onCampusLevelSetBackground=function(e){this.app.level.options.autoChangeBackground&&(this._campusSkyBox?(this.app.skyBox=this._campusSkyBox,this.setCampusSkyBoxColorScaleFactor([1,1,1])):this._campusBackground&&(this.app.background=this._campusBackground))},e.prototype.onCampusLevelSetEffect=function(e){},e.prototype.onCampusLevelSceneOperations=function(e){var t=e.object;t.style.outlineColor=null,t.visible=!0,t.outdoors&&(t.outdoors.visible=!0);for(var i=t.children,r=0;r<i.length;r++)i[r].visible=!0;var n=t.buildings;for(r=0;r<n.length;r++){var o=n[r];o.visible=!0,o.children.forEach(function(e){e.visible=!1});var a=o.floors,s=o.facades;o.hasFacades()?(s.visible=!0,a.visible=!1,o.showAllRoofs(!1)):(a.visible=!0,o.showAllRoofs(!0)),t.app.level.options.autoHideFloorObjects&&a.forEach(function(e){if(!e.showObjectsInParentLevels&&(o.hasFacades()?e.children.forEach(function(e){e.visible=!1}):e.children.forEach(function(e){e.isRoom||e.isDoor||e.isWindow||e.isCombinedObject||(e.visible=!1)}),!o.hasFacades())){var t=e.misc;t&&(t.visible=!0,t.node.traverse(function(t){t!=e.misc.node&&(function(t){for(;t&&t!=e.misc.node;){if(t.isDoorOrWin)return!0;t=t.parent}return!1}(t)?t.visible=!0:t.visible=!1)}))}})}},e.prototype.onCampusLevelPickedResultFunc=function(e){function t(e){return"Outdoors"!=e.type&&!!function(e){var t=e.app.level.current;if(!t)return!0;if(e.isWebView)return!0;if(e.isMarker)return!0;if(e.parent==t){if(e.isGround)return!0;if(e.isBuilding)return!0;if(e.isThing)return!0}return!!e.isChildOf(t.ground)}(e)}this.app.picker.pickedResultFunc=function(e){if(t(e))return e;for(var i=e.parents,r=0;r<i.length;r++){var n=i[r];if(t(n))return n}}},e.prototype.onCampusLevelFly=function(e){var t,i,r=e.object,n=e.previous;n&&!n.isCampus&&n.isChildOf(r)||this.clearBackupInfo("camera","Campus");var o=r.sceneJSONData.camInfo;o&&(t=o.eye.concat(),i=o.target.concat(),t=r.selfToWorld(t),i=r.selfToWorld(i));var a=e.position||this.getBackupInfoValue("camera","Campus","position")||t,s=e.target||this.getBackupInfoValue("camera","Campus","target")||i||r,l=e.radius||Math.min(r.boundingBox.radius,300);this.app.camera.flyTo(this.buildFlyParams({position:a,target:s,radius:l},e))},e.prototype.onCampusLevelLeaveSceneOperations=function(e){var t=e.current;if(t){var i=e.object;if(t.isChildOf(i)){if(t.isCampus);else if(i.parents.has(t));else if(!i.things.has(t)){i.outdoors&&(i.outdoors.visible=!1);for(var r=0;r<i.children.length;r++){var n=i.children[r];n!=e.current&&(n.visible=!1)}if(t.isThing){var o=i.ground;o&&(o.visible=!1)}}e.skipBackupCameraInfo||this.updatebackupInfo("camera","Campus"),this.updatebackupInfo("lighting","Campus"),this.updatebackupInfo("postEffect","Campus")}}},e.prototype.onFacadeLevelSetBackground=function(e){},e.prototype.onFacadeLevelSetEffect=function(e){},e.prototype.onFacadeLevelSceneOperations=function(e){var t=e.object;t.visible=!0,t.children.forEach(function(e){e.visible=!0})},e.prototype.onFacadeLevelPickedResultFunc=function(e){function t(e){var t=e.app.level.current;return!t||t==e||!!e.isChildOf(t)}this.app.picker.pickedResultFunc=function(e){if(t(e))return e;for(var i=e.parents,r=0;r<i.length;r++){var n=i[r];if(t(n))return n}}},e.prototype.onFacadeLevelFly=function(e){var t=e.object;this.app.camera.flyTo(this.buildFlyParams({target:t},e))},e.prototype.onFacadeLevelLeaveSceneOperations=function(e){},e.prototype.onBuildingLevelSetBackground=function(e){this.app.level.options.autoChangeBackground&&(this.app.background=null,this.app.skyBox="White",this.setCampusSkyBoxColorScaleFactor([.5,.5,.5]))},e.prototype.onBuildingLevelSetEffect=function(e){},e.prototype.onBuildingLevelSceneOperations=function(e){var t=e.object;t.style.outlineColor=null,t.visible=!0,t.children.forEach(function(e){e.visible=!0}),t.parents.query(".Campus")[0].buildings.not(t).visible=!1,t.facades.visible=!1;var i=t.floors;i.visible=!0;for(var r=0;r<i.length;r++){var n=i[r];t.app.level.options.autoHideFloorObjects&&i.forEach(function(e){t.hasFacades()?e.children.forEach(function(e){e.visible=!0}):e.children.forEach(function(e){e.isRoom||e.isDoor||e.isWindow||(e.visible=!0)});var i=e.misc;i&&i.node.traverse(function(e){e.ensureVisible(!0,!0)})}),n.showAllRoofs(!1),n.bake(null)}},e.prototype.onBuildingLevelPickedResultFunc=function(e){function t(e){var t=e.app.level.current;return!(t&&t!=e&&!e.isWebView&&!e.isMarker&&(e.parent!=t||!e.isFloor||"Outdoors"==e.type))}this.app.picker.pickedResultFunc=function(e){if(t(e))return e;for(var i=e.parents,r=0;r<i.length;r++){var n=i[r];if(t(n))return n}}},e.prototype.onBuildingLevelFly=function(e){var t=e.object;this.app.camera.flyTo(this.buildFlyParams({target:t},e))},e.prototype.onBuildingLevelLeaveSceneOperations=function(e){e.object.style.outlineColor=null,this.updatebackupInfo("lighting","Building"),this.updatebackupInfo("postEffect","Building")},e.prototype.onFloorLevelSetBackground=function(e){this.app.level.options.autoChangeBackground&&(this.app.skyBox="White",this.setCampusSkyBoxColorScaleFactor([.25,.25,.25]))},e.prototype.onFloorLevelSetEffect=function(e){},e.prototype.onFloorLevelSceneOperations=function(e){var t=e.object;t.style.outlineColor=null,t.visible=!0,t.building.floors.not(t).visible=!1,t.showAllRoofs(!1),this.app.level.options.autoBakeFloor&&t.bake()},e.prototype.onFloorLevelPickedResultFunc=function(e){function t(e){var t=e.app.level.current;if(!t)return!0;if(t==e)return!0;if(e.isWebView)return!0;if(e.isMarker)return!0;if(e.parent==t){if(e.isRoom)return!0;if(e.isThing)return!0}return!1}this.app.picker.pickedResultFunc=function(e){if(t(e))return e;for(var i=e.parents,r=0;r<i.length;r++){var n=i[r];if(t(n))return n}}},e.prototype.onFloorLevelFly=function(e){var t=e.object;if(e.previous.isBuilding)this.app.camera.flyTo(this.buildFlyParams({target:t},e)),this.clearBackupInfo("camera","Floor");else{var i=this.getBackupInfoValue("camera","Floor","position"),r=this.getBackupInfoValue("camera","Floor","target");this.app.camera.flyTo(this.buildFlyParams({position:i,target:r},e))}},e.prototype.onFloorLevelLeaveSceneOperations=function(e){e.object.style.outlineColor=null,this.updatebackupInfo("camera","Floor"),this.updatebackupInfo("lighting","Building"),this.updatebackupInfo("postEffect","Building")},e.prototype.onRoomLevelSceneOperations=function(e){var t=e.object;t.style.outlineColor=null;for(var i=t.brothers.query(".Room"),r=0;r<i.length;r++)i[r].things.style.opacity=.25},e.prototype.onRoomLevelPickedResultFunc=function(e){this.app.picker.pickedResultFunc=function(e){if(!(i=(t=e).app.level.current)||i==t||t.isWebView||t.isMarker||t.isRoom&&t!=t.app.level.current||t.isThing&&t.app.level.current.things.has(t))return e;var t,i}},e.prototype.onRoomLevelFly=function(e){var t=e.object;if(e.previous.isFloor)this.app.camera.flyTo(this.buildFlyParams({target:t},e));else{var i=this.getBackupInfoValue("camera","Room","position"),r=this.getBackupInfoValue("camera","Room","target");this.app.camera.flyTo(this.buildFlyParams({position:i,target:r},e))}},e.prototype.onRoomLevelLeaveSceneOperations=function(e){var t=e.object;if(t.style.outlineColor=null,!e.lastObject.isChildOf(t))for(var i=t.brothers.query(".Room"),r=0;r<i.length;r++)i[r].things.style.opacity=null;this.updatebackupInfo("camera","Room")},e.prototype.onThingLevelSceneOperations=function(e){var t=e.object;t.style.outlineColor=null,t.brothers.query(".Thing").style.opacity=.25},e.prototype.onThingLevelPickedResultFunc=function(e){function t(e){var t=e.app.level.current;return!(t&&!e.isChildOf(t)&&!e.isWebView&&!e.isMarker&&(!e.isThing||!e.isBrotherOf(t)))}this.app.picker.pickedResultFunc=function(e){if(t(e))return e;for(var i=e.parents,r=0;r<i.length;r++){var n=i[r];if(t(n))return n}}},e.prototype.onThingLevelFly=function(e){var t=e.object,i=Te.parseValue(e.keepDirection,!0);this.app.camera.flyTo(this.buildFlyParams({target:t,keepDirection:i,centerPos:t.boundingBox.center},e))},e.prototype.onThingLevelLeaveSceneOperations=function(e){var t=e.object;t.style.outlineColor=null,t.brothers.query(".Thing").style.opacity=null},e.prototype.init=function(){this.initAppEvents(),this.registerSceneLevelEvents()},e}(),Yo=function(){function e(t){r(this,e),this.app=t,this._spriteMaterials={},this._spriteMaterialsAlwaysOnTop={},this._meshMaterials={},this._meshMaterialsAlwaysOnTop={}}return e.prototype.getMaterial=function(e){var t,i=(e=e||{}).url,r=e.alwaysOnTop,n=Te.parseValue(e.useSpriteMaterial,!0);if(i){if((t=n?(this._spriteMaterials[i]||(this._spriteMaterials[i]=new THREE.SpriteMaterial({color:16777215,transparent:!0})),this._spriteMaterials[i]):(this._meshMaterials[i]||(this._meshMaterials[i]=new THREE.MeshBasicMaterial({transparent:!0,side:THREE.DoubleSide,depthWrite:!1})),this._meshMaterials[i])).refCount=t.refCount||1,e.skipRefCount||t.refCount++,r){var o=n?this._spriteMaterialsAlwaysOnTop:this._meshMaterialsAlwaysOnTop;o[i]=o[i]||t.clone(),(t=o[i]).depthTest=!1,t.depthWrite=!1,t.refCount=t.refCount||1,e.skipAlwaysOnTopRefCount||t.refCount++}var a=!t.map||!t.map.image;if(a){var s=this.app.resourceManager.textureLoader;t.map=s.load(i,function(i){i.refCount++,t.map=i;var r=e.loadTextureComplete;r&&r({material:t});var n=e.loadComplete;n&&n({material:t})},function(){},function(e){console.error('[Sprite] load "'+i+'" failed')})}else(l=e.loadComplete)&&l({material:t})}else{var l;t=n?new THREE.SpriteMaterial({color:16777215,transparent:!0}):new THREE.MeshBasicMaterial({transparent:!0,side:THREE.DoubleSide,depthWrite:!1}),r&&(t.depthTest=!1,t.depthWrite=!1),(l=e.loadComplete)&&l({material:t})}return{material:t,needLoadTexture:a}},e.prototype.unloadMaterial=function(e){return!(!e||!this.app.resourceManager.disposeMaterial(e))},e.prototype.unloadMaterials=function(e,t){var i=t[e];this.unloadMaterial(i)&&delete t[e]},e.prototype.unload=function(e){this.unloadMaterials(e,this._spriteMaterials),this.unloadMaterials(e,this._spriteMaterialsAlwaysOnTop),this.unloadMaterials(e,this._meshMaterials),this.unloadMaterials(e,this._meshMaterialsAlwaysOnTop)},e.prototype.onUpdate=function(e){},e}(),Qo=function(){function e(t,i){r(this,e),this.app=t,this.modelResource=t.modelResource,this.refCount=1,this.URL=i,this._boundingBox=null,this._loadingBox=null,this._skinnedMeshes=[],this.node=null,this.animations=null,this.geometry=null,this.materials=null}return e.prototype._setupBoundingBox=function(){var e=(new THREE.Box3)._setFromObject(this.node),t=new THREE.Vector3;e.getCenter(t);var i=new THREE.Vector3;e.getSize(i),this._boundingBox={},this._boundingBox.center=t.toArray(),this._boundingBox.size=i.toArray(),this._boundingBox.radius=i.length()},e.prototype.load=function(e){var t=e.node,i=e.animations,r=e.geometry,n=e.materials;if(r)this.animations=r.animations,this.geometry=r,this.materials=n;else if(t){var o=this.node!=t;this.node=t,i?this.animations=i:(o||null===i)&&(this.animations=null)}this._skinnedMeshes=t.getSkinnedMeshes(),this._setupBoundingBox()},e.prototype.get=function(){return this.refCount++,this},e.prototype.unload=function(){return!(0!==this.refCount&&(this.refCount--,this.refCount)||this.modelResource.residentMode||(this.app.resourceManager.unload(this.node),this.app.resourceManager.unload(this._loadingBox),this.node=null,this.animations=null,this.geometry=null,this.materials=null))},e.prototype._cloneNode=function(){if(this.node){var e=this.node.clone(),t=[];if(e.traverse(function(e){var i=e.geometry;i&&(i.refCount=i.refCount||1,i.refCount++),e.isSkinnedMesh&&t.push(e)}),this._skinnedMeshes.length)for(var i=this._skinnedMeshes,r=0;r<i.length;r++){var n=i[r],o=i[r].skeleton,a=e.getBones(this.node,i[r].skeleton),s=t[r],l=new THREE.Skeleton(a,o.boneInverses);s.bind(l,n.bindMatrix)}return e}if(this.geometry)return(s=new THREE.SkinnedMesh(this.geometry,this.materials)).scale.set(1,1,1),s},e.prototype.cloneNode=function(){var e=this._cloneNode(),t=function(e){e.refCount?e.refCount++:e.refCount=1};return e.traverseMaterials(function(e){for(var i in t(e),e){var r=e[i];r&&r.isTexture&&t(r)}}),e},n(e,[{key:"boundingBox",get:function(){return this._boundingBox||this._setupBoundingBox(),this._boundingBox}},{key:"loadingBox",get:function(){return this._loadingBox},set:function(e){this._loadingBox=e}}]),e}(),Zo=function(){function e(t){r(this,e),this.app=t,this.isResidentMode=!1,this.models={},this.loadingModels={},this.waitModels=[]}return e.prototype.onBackgroundProgress=function(e){},e.prototype.get=function(e){var t=this.models[e];return t?t.get():null},e.prototype.set=function(e,t,i){var r=this.models[e];return r?r.unload():(r=new Qo(this.app,e),this.models[e]=r),t&&i&&r.load({node:t,animations:i}),r},e.prototype.getBoundingBox=function(e){var t=this.models[e];return t?t.boundingBox:null},e.prototype.unload=function(e){if(void 0===e){for(var e in this.models)this.models[e].unload();return this.clear(),!0}if(Te.isString(e)){var t=this.models[e];if(t&&t.unload())return delete this.models[e],!0}return!1},e.prototype.clear=function(e){Te.isNull(e)?this.models={}:delete this.models[e]},e.prototype._download=function(e,t,i,r,n){var o=this.get(e);if(o)delete this.loadingModels[e],i&&i(o);else{var a=this;new thingjs.GLTFLoader(this.app.loadingManager).loadFromURL({url:e,jsonCallback:function(e){t&&t(e)},modelCallback:function(t){var r=t.url,n=a.get(r);n||(n=a.set(r)).load(t),delete a.loadingModels[e],i&&(i(n)||a.unload(e))},errorCallback:function(t){if(delete a.loadingModels[e],t&&t.target&&201===t.target.status){var i=void 0;try{i=JSON.parse(t.target.response)}catch(t){console.error("Error!")}return console.error("[have no right] name: "+i.message+"\nurl: "+e),!0}if(n)return n(t)},progressCallback:r})}},e.prototype.download=function(e,t,i,r,n){this.loadingModels[e]?this.waitModels.push({url:e,jsonCallback:t,modelCallback:i,progressCallback:r,errorCallback:n}):(this.loadingModels[e]={},this._download(e,t,i,r,n))},e.prototype.preload=function(e,t){var i=(t=t||{}).complete;if(Te.isArray(e))for(var r=0,n=e.length,o=0;o<n;o++)this.download(e[o],function(){},function(e){++r==n&&i&&i()},function(){},function(){++r==n&&i&&i()});else Te.isString(e)&&this.download(e,function(){},function(e){i&&i()},function(){},function(){i&&i()})},e.prototype.needWait=function(e){var t=e.url;return!!this.loadingModels[t]},e.prototype.update=function(){for(var e=0;e<this.waitModels.length;e++){var t=this.waitModels[e];this.needWait(t)||(this._download(t.url,t.jsonCallback,t.modelCallback,t.progressCallback,t.errorCallback),this.waitModels.splice(e--,1))}},e.prototype.onUpdate=function(e){this.update(e)},n(e,[{key:"residentMode",set:function(e){if(!(this.isResidentMode=e)){var t=[];for(var i in this.models){var r=this.models[i];if(0===r.refCount){var n=r.URL;r.unload()&&t.push(n)}}for(var o=0;o<t.length;o++)n=t[o],delete this.models[n]}},get:function(){return this.isResidentMode}}]),e}(),Jo=function(){function e(t){r(this,e),this.app=t,this.particles={}}return e.prototype.get=function(e){return this.particles[e]},e.prototype.set=function(e,t){this.particles[e]=t},e.prototype.download=function(e,t){var i=e.appendPath("index.json"),r=this;new THREE.FileLoader(this.app.loadingManager).load(i,function(i){var n=JSON.parse(i);r.set(e,n),t&&t(n)},function(){},function(){})},e}(),Ko=function(){function e(t){r(this,e),this.app=t,this.camera=t.camera,this.updateTime=0,this.lastAdjustCameraNear=0}return e.prototype._getMinDistanceForAdjustCameraNear=function(e,t,i,r){var n=Te.parseVector3(i),o=Te.parseVector3(this.camera.position),a=Math.min(r,n.distanceTo(o));if(e<a){var s=this.app.picker.intersectResult(t[0],t[1],null,{ignoreFrameCheck:!1});s&&s.picked&&(n=s.getPickedPosition({skipOtherPick:!0}))&&(n=Te.parseVector3(n),a=Math.min(a,o.distanceTo(n)))}return a/e},e.prototype._getAdjustCameraNear=function(e){var t=this.camera.distance;if(10<t){var i=this.camera.worldToScreen(this.camera.target),r=this.camera.screenToWorld(i[0],i[1]);if(r)return.5<=this.updateTime&&(this.updateTime=0,this.lastAdjustCameraNear=this._getMinDistanceForAdjustCameraNear(e,i,r,t)),this.lastAdjustCameraNear}return this.camera.near},e.prototype.processAdjustCameraNear=function(){var e=Math.max(.1,this._getAdjustCameraNear(120));this.app.renderCamera.setNear(e)},e.prototype.onUpdate=function(){this.updateTime+=this.app._deltaTime;var e=this.camera._targetObject;e&&(e.position=this.camera.target)},e.prototype.onEnter=function(){var e=this;this.app.on("cameraChange",function(t){e.camera.autoAdjustNear&&!e.app.renderCamera.isLerping&&e.processAdjustCameraNear(),e.app.needUpdate=!0},"__cameraNearFixed__");var t=!1;this.app.on("cameraChangeMouseMove",function(i){e.app.camera.inputEnabled&&!e.app.isPauseEvent(H.Pick,k.LevelPickOperation)&&(t=!0,e.app.pauseEvent(H.Pick,null,k.LevelPickOperation))},"__disable_outline__"),this.app.on("cameraChangeEnd",function(i){t&&(t=!1,e.app.resumeEvent(H.Pick,null,k.LevelPickOperation))},"__disable_outline__")},e.prototype.onLeave=function(){this.app.off("cameraChange","__cameraNearFixed__"),this.app.off("cameraChangeMouseMove","__disable_outline__"),this.app.off("cameraChangeEnd","__disable_outline__")},e}(),$o=function(){function e(t){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"translate",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};r(this,e),t&&(this._object=t,this._axis=null,this._disableAxis=[],this.init(t.app,i,n),this.control.attach(this._object.node),this.app.scene.add(this.control),this.control.setPickable(!1))}return e.prototype.init=function(e,t,i){this.app=e,this.control=new THREE.TransformControls(this.app.renderCamera,this.app.mainDomElement),this.control.traverse(function(e){e.userData.skipOutline=!0,e.userData.useVisibleOnly=!0});var r=this;this.control.addEventListener("change",function(e){r.onGizmoChange(e)}),this.control.addEventListener("objectChange",function(e){r.onGizmoObjectChange(e)}),this.control.addEventListener("mouseDown",function(e){r.onGizmoMouseDown(e)}),this.control.addEventListener("mouseUp",function(e){r.onGizmoMouseUp(e)}),this.control.getGizomNode=function(){return r.control.children[0]},this.control.getAxisNode=function(){return r.control.children[1]},this.mode="translate",Te.isString(t)?(this.mode=t,this.params=i||{}):this.params=t||{},this.app.on("cameraViewChange",function(e){e.view==w.Orthographic?r.setAxis("XZ"):r.setAxis("XYZ")}),this.app.camera.viewMode==w.Orthographic&&this.setAxis("XZ")},e.prototype.onGizmoChange=function(e){},e.prototype.onGizmoObjectChange=function(e){this._object&&(this._object.dirty=!0);var t=this.params.change;t&&t.call(this,{object:this._object})},e.prototype.onGizmoMouseDown=function(e){this.app.camera.disable({rotate:!0});var t=this.params.changeStart;t&&t.call(this,{object:this._object})},e.prototype.onGizmoMouseUp=function(e){this.app.camera.resume({rotate:!0});var t=this.params.changeEnd;t&&t.call(this,{object:this._object})},e.prototype.onUpdate=function(e){if(this._object.static)return this.control.updateMatrixWorld(),!0},e.prototype.onRemove=function(){this.app.scene.remove(this.control),this.control.detach(),this.control.dispose()},e.prototype.onVisible=function(e){this.control.enabled&&(this.control.visible=e)},e.prototype.setAxis=function(e){if(this._axis=e,this._axis&&"XYZ"!=this._axis){var t=this,i=new THREE.Raycaster;this.control.userData.original_pointerHover=this.control.pointerHover,this.control.axis=e,this.control.pointerHover=function(e){if(void 0!==this.object&&!0!==this.dragging&&(void 0===e.button||0===e.button)){i.setFromCamera(e,this.camera);var r=i.intersectObjects(this.getGizomNode().picker[this.mode].children,!0)[0]||!1;r?-1!=t._axis.search(r.object.name)&&(this.axis=r.object.name):this.axis=""}}}else this.control.userData.original_pointerHover&&(this.control.pointerHover=this.control.userData.original_pointerHover,delete this.control.userData.original_pointerHover)},e.prototype.detach=function(){this.control.detach()},e.prototype.attach=function(e){this.control.attach(e)},e.prototype.enableAxis=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];if(e){var i=this._disableAxis.indexOf(e);t?-1!==i&&this._disableAxis.splice(i,1):-1===i&&this._disableAxis.push(e);var r=this.control;if(this._disableAxis.length){var n=this,o=function(e){if(!e)return!0;for(var t=0;t<n._disableAxis.length;t++){var i=n._disableAxis[t];if(-1!==e.indexOf(i))return!0}return!1};Te.setValue(r,"pointerDown",function(e){var t=this.getGizomNode().axis;o(t)||Te.getBackupValue(r,"pointerDown").call(this,e)}),Te.setValue(r,"pointerMove",function(e){var t=this.getGizomNode().axis;o(t)||Te.getBackupValue(r,"pointerMove").call(this,e)}),Te.setValue(r,"pointerUp",function(e){var t=this.getGizomNode().axis;o(t)||Te.getBackupValue(r,"pointerUp").call(this,e)}),Te.setValue(r,"updateMatrixWorld",function(){Te.getBackupValue(r,"updateMatrixWorld").call(this),this.getGizomNode().gizmo[this.getGizomNode().mode].traverse(function(e){for(var t=0;t<n._disableAxis.length;t++){var i=n._disableAxis[t];e.name==i&&(e.visible=!1)}})})}else Te.revertValue(r,"pointerDown"),Te.revertValue(r,"pointerMove"),Te.revertValue(r,"pointerUp"),Te.revertValue(r,"updateMatrixWorld")}},e.prototype.setSize=function(e){console.warn("[AxisTransformControl] Please use '.size' to replace 'setSize()'"),this.size=e},n(e,[{key:"object",get:function(){return this.control.object}},{key:"node",get:function(){return this.control}},{key:"mode",set:function(e){if(e){if("translate"!=e&&"rotate"!=e&&"scale"!=e)return void console.error('[AxisTransformControl] mode is invalid, must be "translate/rotate/scale"');this.control.setMode(e)}},get:function(){return this.control.getMode()}},{key:"space",set:function(e){if(e){if("world"!=e&&"local"!=e)return void console.error('[AxisTransformControl] space is invalid, must be "world/local"');this.control.setSpace(e)}},get:function(){return this.control.space}},{key:"size",set:function(e){this.control.setSize(e)},get:function(){return this.control.size}},{key:"visible",set:function(e){this.control.visible=e,this.control.enabled=e},get:function(){return this.control.visible}}]),e}(),ea=function(){function e(t){r(this,e),this.state=t,this.app=t.app,this.control=t.control,this.root=new THREE.Group,this.root.userData.childUseWorldAnglesAlways=!0,this.root.name="EditObjectGroup",this.lastRootPosition=null,this.lastRootScale=null,this.lastRootRotation=null}return e.prototype.hasChanged=function(){var e=this.root.position,t=this.root.scale,i=this.root.rotation;return!(this.lastRootPosition.equals(e)&&this.lastRootScale.equals(t)&&this.lastRootRotation.equals(i))},e.prototype.recordTranslation=function(){this.state.execute({type:"SetNodeTranslation",node:this.root,position:this.lastRootPosition,scale:this.lastRootScale,rotation:this.lastRootRotation}),this.synTranslation()},e.prototype.notify=function(e){for(var t=this.root.children,i=0;i<t.length;i++){var r=t[i].userData,n=this.app.objectManager.get(r.id);if(n){var o=n.userData._editCallbacks;o&&o[e].call(n);var a=n.userData.selectObjectCallback;a&&a.call(n)}}},e.prototype._pushSubNodeAttach=function(e,t,i,r,n){var o=this.app.objectManager.getBaseObject(t);e.push({type:"AttachNode",node:o.node,nodeParent:o.node.userData.nodeParent})},e.prototype.recordSubNodeAttach=function(e,t,i,r){var n=[];this._pushSubNodeAttach(n,e,t,i,r),this.state.execute(n),this.synTranslation()},e.prototype._pushSubNodeOnlyAttach=function(e,t,i,r,n,o,a,s,l){for(var c=0;c<i.length;c++){var u=i[c];this.hasSelected(u)&&e.push({type:"AttachNode",node:i[c].node,nodeParent:r[c]})}},e.prototype.recordSubNodeOnlyAttach=function(e,t,i,r,n,o,a,s){var l=[];this._pushSubNodeOnlyAttach(l,e,t,i,r,n,o,a,s),this.state.execute(l),this.synTranslation()},e.prototype._pushNodeAttach=function(e,t,i,r,n){e.push({type:"AttachNode",node:t.node,nodeParent:i})},e.prototype.recordNodeAttach=function(e,t,i,r){var n=[];this._pushNodeAttach(n,e,t,i,r),this.state.execute(n),this.synTranslation()},e.prototype._pushNodeOnlyAttach=function(e,t,i,r,n,o,a,s,l){e.push({type:"AttachNode",node:t.node,nodeParent:i});for(var c=0;c<r.length;c++)r[c]!=t&&e.push({type:"AttachNode",node:r[c].node,nodeParent:n[c]})},e.prototype.recordNodeOnlyAttach=function(e,t,i,r,n,o,a,s){var l=[];this._pushNodeOnlyAttach(l,e,t,i,r,n,o,a,s),this.state.execute(l),this.synTranslation()},e.prototype._pushNodesAttach=function(e,t,i,r,n){for(var o=0;o<t.length;o++){var a=t[o],s=i[o];e.push({type:"AttachNode",node:a.node,nodeParent:s})}},e.prototype.recordNodesAttach=function(e,t,i,r){var n=[];this._pushNodesAttach(n,e,t,i,r),this.state.execute(n)},e.prototype._pushSubNodesAttach=function(e,t,i,r,n){},e.prototype.recordSubNodesAttach=function(e,t,i,r){var n=[];this._pushSubNodesAttach(n,e,t,i,r),this.state.execute(n)},e.prototype.synTranslation=function(){this.lastRootPosition=this.root.position.clone(),this.lastRootScale=this.root.scale.clone(),this.lastRootRotation=this.root.rotation.clone();for(var e=0;e<this.root.children.length;e++){var t=this.root.children[e].userData.id;t&&(this.app.objectManager.get(t).dirty=!0)}},e.prototype.updateRoot=function(){this.updateControl(),this.updateRootVisible(),this.updateRootPosition(),this.updateSelections(),this.synTranslation(),this.app.needUpdate=!0},e.prototype._getNodeCenterPosition=function(e){var t=new THREE.Vector3;if(this.state._isSubNode(e))e.getWorldPosition(t);else{var i=this.app.objectManager.get(e.userData.id);if(i){var r=i.position,n=i.centerPos;n?(t.set(n[0],0,n[1]),i.node.updateMatrixWorld(),t.applyMatrix4(i.node.matrixWorld),t.y=r[1]):t=Te.parseVector3(r)}else e.getWorldPosition(t)}return t},e.prototype.clearSelections=function(){this.state._selectionObjects.clear()},e.prototype.addSelection=function(e){this.state._selectionObjects.add(e)},e.prototype.hasSelected=function(e){return this.state._selectionObjects.has(e)},e.prototype.updateSelections=function(){this.state.objects,this.clearSelections();for(var e=0;e<this.root.children.length;e++){var t=this.root.children[e].userData,i=t.id;if(i){var r=this.app.objectManager.get(i);t.subNode||this.addSelection(r)}}},e.prototype.updateControl=function(){this.control.object||this.root.children.length&&(this.control.attach(this.root),this.app.scene.add(this.control.node),this.synTranslation())},e.prototype.updateRootVisible=function(){this.root.children.length?this.root.visible=!0:this.root.visible=!1,this.control.visible=this.root.visible},e.prototype.updateRootPosition=function(){var e=this.root.children;if(e.length){for(var t=new THREE.Vector3,i=0;i<e.length;i++){var r=e[i],n=this._getNodeCenterPosition(r);t.add(n)}t.divideScalar(e.length);var o=this.root.parent.worldToLocal(t),a=this.root.detachChildren(this.app.scene);this.root.position.copy(o),this.root.attachChildren(a,this.app.scene)}},e.prototype.getObjectInfo=function(e,t){for(var i=new Set,r=this.root.children,n=0;n<r.length;n++){var o=r[n],a=this.app.objectManager.get(o.userData.id);if(!i.has(a)&&(i.add(a),e&&e.push(a),t)){var s=a.node.userData.nodeParent;t.push(s)}}},e.prototype.getSubNodeInfo=function(e,t){var i=this;this.root.traverse(function(r){var n=i.app.objectManager.get(r.userData.id);if(n&&-1!==n.getSubNodeIndex(r)&&(e&&e.push(r),t)){var o=r.userData.nodeParent;t.push(o)}})},e.prototype.recordNodeParent=function(e){e.isBaseObject&&(e=e.node);var t=e.parent;t!=this.root&&(e.userData.nodeParent=t)},e.prototype._pushAddObjects=function(e,t){if(t&&t.length){for(var i=[],r=0;r<t.length;r++){var n=t[r];this.hasSelected(n)||i.push(n)}if(i.length)for(r=0;r<i.length;r++)n=i[r],this.recordNodeParent(n),e.push({type:"AttachNode",node:n.node,nodeParent:this.root})}},e.prototype._dispatchBreakableEvent=function(e,t){return t.continueFlag=!0,this.app.trigger(e,t),t.continueFlag},e.prototype.addObjects=function(e){var t=[];this._pushAddObjects(t,e),this.state.execute(t),this.updateRoot()},e.prototype._pushAddSubNodes=function(e,t){if(t.length)for(var i=0;i<t.length;i++){var r=t[i];this.state._isSubNode(r)&&(r.isChildOf(this.root)||this.recordNodeParent(r))}},e.prototype.addSubNodes=function(e){var t=[];this._pushAddSubNodes(t,e),this.state.execute(t),this.updateRoot()},e.prototype.addSubNode=function(e){return!!this.state._isSubNode(e)&&!!this.app.objectManager.getBaseObject(e)&&(this.recordNodeParent(e),this.recordSubNodeAttach(e,this.root,this.state.selectOutlineColor,null),this.updateRoot(),!0)},e.prototype.addSubNodeOnly=function(e){if(!e)return!1;if(!e.userData.subNode)return!1;if(!this.app.objectManager.getBaseObject(e))return!1;var t=[],i=[];this.getObjectInfo(t,i);var r=[],n=[];this.getSubNodeInfo(r,n);for(var o=0;o<r.length;o++)if(r[o]==e){r.splice(o,1);break}return this.recordNodeParent(e),this.recordSubNodeOnlyAttach(e,t,i,r,n,this.root,this.state.selectOutlineColor,null),this.updateRoot(),!0},e.prototype.add=function(e,t){t&&this.addSubNode(t.intersect.node)||(this.recordNodeParent(e),this.recordNodeAttach(e,this.root,this.state.selectOutlineColor,null),this.updateRoot())},e.prototype.addOnly=function(e,t){if(!(t&&this.addSubNodeOnly(t.intersect.node)||1==this.root.children.length&&this.has(e))){var i=[],r=[];this.getObjectInfo(i,r);var n=[],o=[];this.getSubNodeInfo(n,o),this.recordNodeParent(e),this.recordNodeOnlyAttach(e,this.root,i,r,n,o,this.state.selectOutlineColor,null),this.updateRoot()}},e.prototype.remove=function(e){if(this.state._isSubNode(e)){for(var t=this.root.children,i=0;i<t.length;i++)if((n=t[i])==e){var r=n.userData.nodeParent;this.recordSubNodeAttach(e,r,null,this.state.selectOutlineColor);break}}else for(t=this.root.children,i=0;i<t.length;i++){var n=t[i],o=this.app.objectManager.get(n.userData.id);if(e==o){this.app.trigger("unselectEditableObject",{object:o}),r=n.userData.nodeParent,this.recordNodeAttach(e,r,null,this.state.selectOutlineColor);break}}this.updateRoot()},e.prototype.removeAll=function(){if(this.root.children.length){var e=[],t=[];this.getObjectInfo(e,t);var i=[],r=[];this.getSubNodeInfo(i,r);for(var n=0;n<e.length;n++){var o=e[n];this.app.trigger("unselectEditableObject",{object:o})}this.state.canRespondFromCommandManager=!1,this.recordNodesAttach(e,t,null,this.state.selectOutlineColor),this.recordSubNodesAttach(i,r,null,this.state.selectOutlineColor),this.state.canRespondFromCommandManager=!0,this.updateRoot()}},e.prototype.has=function(e){var t=this.root.children;if(this.state._isSubNode(e)){for(var i=0;i<t.length;i++)if((r=t[i]).userData.subNode&&r==e)return!0}else for(i=0;i<t.length;i++){var r;if(!(r=t[i]).userData.subNode&&e==this.app.objectManager.get(r.userData.id))return!0}return!1},e.prototype.attach=function(){this.root.attach(this.app.scene,this.app.scene)},e.prototype.detach=function(){this.removeAll(),this.control.detach(),this.app.scene.remove(this.control.node),this.root.detach(this.app.scene),this.updateRoot()},e.prototype.clearScene=function(){var e=[];this.state._pushDeleteSubNodes(e,this.state.subNodes),this.state._pushDeleteObjects(e,this.state.objects),this.state.execute(e,!0),this.updateRoot()},e.prototype.toJSON=function(){for(var e=Array.from(this.state._selectionObjects),t=0;t<e.length;t++)this.remove(e[t]);var i=this.state.subNodes;for(t=0;t<i.length;t++)this.remove(i[t]);var r=[],n=this.state.objects;for(t=0;t<n.length;t++){var o=n[t];r.push(o.toJSON())}for(t=0;t<i.length;t++)this.addSubNode(i[t]);for(t=0;t<e.length;t++)this.add(e[t]);return JSON.stringify(r)},e.prototype.pasteObjects=function(){0<arguments.length&&void 0!==arguments[0]&&arguments[0],console.warn('[EditObjectState] we do not support ".pasteObjects()" anymore, please do not use it')},e.prototype.fromJSON=function(e){console.warn('[EditObjectState] we do not support ".fromJSON()" anymore, please do not use it')},e}(),ta=function(){function e(t){r(this,e);var i=this;this.app=t,this.picker=t.picker,this.copyObjectsJSONData=[],this._selectionObjects=new Set,this.canRespondFromCommandManager=!1,this._enableDirectMode=!1,this._enableKeyMode=!1,this._enableAutoRemoveAllWhenClick=!0,this.app.on("push",function(e){i.onPush(e)}),this.app.on("redo",function(e){i.onRedo(e)}),this.app.on("undo",function(e){i.onUndo(e)});var n={changeEnd:function(e){i.group.hasChanged()&&(i.group.recordTranslation(),i.group.notify("modify"))}};this.control=new $o,this.control.init(t,"translate",n),this.selectOutlineColor="#0000FF",this.group=new ea(this)}return e.prototype.onPush=function(e){this.canRespondFromCommandManager&&this.group.updateRoot()},e.prototype.onRedo=function(e){this.canRespondFromCommandManager&&this.group.updateRoot()},e.prototype.onUndo=function(e){this.canRespondFromCommandManager&&this.group.updateRoot()},e.prototype.notify=function(e,t){var i=e.userData._editCallbacks;i&&i[t].call(e)},e.prototype.startDrag=function(e,t,i,r){if(e){r=r||.1,this.app.camera.disable({rotate:!0}),e.pickable=!1,e.catchEventAnyTime=!0,e.node.userData.skipPick=!0,e.position=app.camera.screenToWorld(t,i);var n=this;e.on("mousemove",function(e){var t=n.app.picker.pickWorldPosition(e.clientX,e.clientY);t||(t=n.app.camera.screenToWorld(e.clientX,e.clientY)),t&&(t[1]+=r,this.position=t)},"startDrag_mousemove"),e.on("mouseup",function(e){this.pickable=!0,this.catchEventAnyTime=!1,delete this.node.userData.skipPick,n.group._dispatchBreakableEvent("selectEditableObject",{object:this})&&n.selectObject(this),this.off("mousemove",null,"startDrag_mousemove"),this.off("mouseup",null,"startDrag_mouseup"),n.app.camera.resume({rotate:!0}),n.notify(this,"dragEnd")},"startDrag_mouseup")}},e.prototype.selectObject=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"translate",i=arguments[2];"translate"==t||"rotate"==t?(this.group.addOnly(e),i&&(e.userData.selectObjectCallback=i),this.setMode(t)):console.error("The mode must be 'translate' or 'rotate'")},e.prototype.unselectObject=function(e){this.group.remove(e)},e.prototype.setMode=function(e){e&&(this.control.mode=e)},e.prototype.parseParams=function(e){var t=e.type;if("RouteLine"==t||"PolygonLine"==t){var i=e.points;if(!i){i=[[-5,0,-5],[0,0,-5],[0,0,0],[0,0,5],[5,0,5]],e.points=i,e.style=e.style||{};var r=e.style;r.color=Te.parseValue(r.color,5824222),e.image&&void 0===e.scrollUV&&(e.scrollUV=!0)}}else"Water"==t?(i=[[-20,0,-20],[-20,0,20],[20,0,20],[20,0,-20]],e.points=i,e.normalMap0=Te.parseValue(e.normalMap0,"images/water/Water_1_M_Normal.jpg"),e.normalMap1=Te.parseValue(e.normalMap1,"images/water/Water_2_M_Normal.jpg")):"Region"==t&&(i=[[-20,0,-20],[-20,0,20],[20,0,20],[20,0,-20]],e.points=i,e.fontColor=Math.random(),e.fontSize=j.randomInt(9,32),e.fontText="");return Te.cloneObject(e)},e.prototype.addObjects=function(e){for(var t=[],i=0;i<e.length;i++){var r=e[i];r instanceof Ye?(r.internalUserData.editable=!0,t.push(r)):console.error("The object is not BaseObject, so we can not add object to edit state")}this.group.addObjects(t)},e.prototype.createObject=function(e,t){(e=e||{}).internalUserData={editable:!0};var i=(e=this.parseParams(e)).complete;e.complete=function(){i&&i()};var r=this.app.create(e);return t&&(r.userData._editCallbacks=t),r},e.prototype._pushDeselectObject=function(e,t){t&&e.push({type:"AttachNode",node:t.node,nodeParent:t.node.userData.nodeParent})},e.prototype._pushDeleteObject=function(e,t){t&&this._pushDeselectObject(e,t)},e.prototype.deleteObject=function(e){this.notify(e,"remove");var t=[];this._pushDeleteObject(t,e),this.execute(t,!0),this.group.updateRoot()},e.prototype._pushDeleteObjects=function(e,t){for(var i=0;i<t.length;i++){var r=t[i];this._pushDeleteObject(e,r)}},e.prototype.deleteObjects=function(e){for(var t=0;t<e.length;t++)this.notify(e[t],"remove");var i=[];this._pushDeleteObjects(i,e),this.execute(i,!0),this.group.updateRoot()},e.prototype._isSubNode=function(e){return!!e&&!e.isBaseObject&&!!e.userData.subNode},e.prototype._isBreakByControlAxis=function(e){var t=e.intersect;return!(t&&this._isSubNode(t.node)||!this.control.axis||!this.control.visible)},e.prototype._isCanPick=function(e){if(this._isBreakByControlAxis(e))return!1;var t=e.object;if(t){if(t==this.app.outdoors)return!1;if(!t.internalUserData.editable)return!1}return!0},e.prototype._getSortedSubNodes=function(e,t){for(var i=[],r=0;r<e.length;r++){var n=e[r],o=n.userData,a=this.app.objectManager.get(o.id),s=a.getSubNodeIndex(n);i.push({index:s,node:n,object:a})}return i.sort(t),i},e.prototype._pushInsertSubNode=function(e,t){},e.prototype.insertSubNode=function(){var e=this.subNodes;if(e.length){var t=[];this._pushInsertSubNode(t,e),this.execute(t,!0),this.group.updateRoot()}},e.prototype._pushDeleteSubNodes=function(e,t){},e.prototype.deleteSubNodes=function(e){var t=[];this._pushDeleteSubNodes(t,e),this.execute(t,!0),this.group.updateRoot()},e.prototype.deleteSelections=function(){var e=Array.from(this._selectionObjects);e.length&&this.deleteObjects(e);var t=this.subNodes;t.length&&this.deleteSubNodes(t)},e.prototype.deselectObjects=function(e){if(e)for(var t=0;t<e.length;t++)this.group.remove(e[t])},e.prototype.copyObjects=function(e){this.copyObjectsJSONData=[];for(var t=0;t<e.length;t++){var i=e[t],r=i.toJSON();r.localPosition=i.localPosition,r.localAngles=i.localAngles,r.scale=i.scale,this.copyObjectsJSONData.push(JSON.stringify(r))}},e.prototype.selectAll=function(){this.group.addObjects(this.objects)},e.prototype.clearScene=function(){this.group.clearScene()},e.prototype.toJSON=function(){this._enableDirectMode=!0;var e=this.group.toJSON();return this._enableDirectMode=!1,e},e.prototype.fromJSON=function(e){e&&this.group.fromJSON(e)},e.prototype.execute=function(e,t){if(this._enableDirectMode){var i=this.app.commandManager.create(e,t);return i?i.execute():null}return this.app.commandManager.execute(e,t)},e.prototype.processAreaPicking=function(e){var t=e.objects;if(t){for(var i=this.objects,r=[],n=0;n<i.length;n++){var o=i[n];t.has(o)||r.push(o)}this.deselectObjects(r),t.length&&(t[0]instanceof Ye?this.group.addObjects(t):this.group.addSubNodes(t))}},e.prototype.onMouseDown=function(e){},e.prototype.onMouseUp=function(e){e.finishedAreaPicking&&this.processAreaPicking(e)},e.prototype.onMouseMove=function(e){e.areaPicking&&(this._enableDirectMode=!0,this.processAreaPicking(e),this._enableDirectMode=!1)},e.prototype.onClick=function(e){if(this.app.events.canClick(e)){var t=this.app.isKeyPressed(L.Ctrl),i=e.object;if(i&&this._isCanPick(e))if(t){var r=e.intersect.node;this.group.has(i)?this.group.remove(i):this.group.has(r)?this.group.remove(r):this.group._dispatchBreakableEvent("selectEditableObject",{object:i})&&this.group.add(i,e)}else this.group._dispatchBreakableEvent("selectEditableObject",{object:i})&&this.group.addOnly(i,e);else t||this.enableAutoRemoveAllWhenClick&&this.group.removeAll()}},e.prototype.onKeyDown=function(e){if(this._enableKeyMode)switch(event.keyCode){case L.Q:this.control.setSpace("local"===this.control.space?"world":"local");break;case L.W:this.control.mode="translate";break;case L.E:this.control.mode="rotate";break;case L.R:break;case L.EqualSign:case L.Add:this.control.size=this.control.size+.1;break;case L.Dash:case L.Subtract:this.control.size=Math.max(this.control.size-.1,.1);break;case L.Y:this.app.isKeyPressed(L.Ctrl)&&this.app.commandManager.redo();break;case L.Z:this.app.isKeyPressed(L.Ctrl)&&this.app.commandManager.undo();break;case L.C:this.app.isKeyPressed(L.Ctrl)&&this.copyObjects(Array.from(this._selectionObjects));break;case L.V:this.app.isKeyPressed(L.Ctrl)&&this.pasteObjects();break;case L.A:this.app.isKeyPressed(L.Ctrl)&&this.selectAll();break;case L.Delete:this.deleteSelections()}},e.prototype.onKeyUp=function(e){},e.prototype.onUpdate=function(e){},e.prototype.onEnter=function(e,t){if(t){this.canRespondFromCommandManager=!0;var i=t.objects;if(i)for(var r=0;r<i.length;r++)this.group.add(i[r]);this.group.attach(),this.control.mode="translate";var n=this;this.app.on("areaPickStart",function(e){var t=n.candidateForSubNodes;t.length||(t=n.objects),n.app.picker.candidates=t},"editObject_areaPickStart"),this.app.on("areaPickEnd",function(e){n.app.picker.candidates=null},"editObject_areaPickEnd"),this.app.modelResource.residentMode=!0}else console.log("Gizmo state need params")},e.prototype.onLeave=function(e){this.group.detach(),this.canRespondFromCommandManager=!1,this.app.modelResource.residentMode=!1,this.app.off("areaPickStart",null,"editObject_areaPickStart"),this.app.off("areaPickEnd",null,"editObject_areaPickEnd")},n(e,[{key:"enableKeyMode",set:function(e){this._enableKeyMode=e},get:function(){return this._enableKeyMode}},{key:"areaPicking",set:function(e){(this.picker.areaPicking=e)||(this.picker.candidates=null)},get:function(){return this.picker.areaPicking}},{key:"enableAutoRemoveAllWhenClick",set:function(e){this._enableAutoRemoveAllWhenClick=e},get:function(){return this._enableAutoRemoveAllWhenClick}},{key:"objects",get:function(){var e=[];return this.app.objectManager.objects.forEach(function(t){t.internalUserData.editable&&e.push(t)}),e}},{key:"subNodes",get:function(){for(var e=[],t=this.group.root.children,i=0;i<t.length;i++){var r=t[i];r.userData.subNode&&e.push(r)}return e}},{key:"candidateForSubNodes",get:function(){for(var e=new Set,t=this.group.root.children,i=0;i<t.length;i++){var r=t[i].userData;if(r.subNode){var n=r.id;n&&e.add(this.app.objectManager.get(n))}}var o=[];return e.forEach(function(e){o=o.concat(e.subNodes)}),o}}]),e}(),ia=function(){function e(t){r(this,e),this.app=t,this._navigation=new Oo(t),this.lineIndex=-1,this.floor=null,this.lines=[],this.routeLines=[],this.lineParams={},this._object=null,this._defaultObject=null,this.speed=0,this.liftSpeed=0,this.startCallback=null,this.changeFloorCallback=null,this.completeCallback=null}return e.prototype.findPath=function(e,t,i,r){var n={start:e,startPosition:t,end:i,endPosition:r},o=this._navigation.findPath(n);return o?(this.createLine(o),o):null},e.prototype.clearPath=function(){this.destroyLine()},e.prototype.showPath=function(){if(this.routeLines.length)if(0===arguments.length)for(var e=0;e<this.routeLines.length;e++)this.routeLines[e].line.visible=!0;else if(1===arguments.length){var t=arguments[0];for(e=0;e<this.routeLines.length;e++)this.routeLines[e].line.visible=t}else if(2===arguments.length){var i=arguments[0];for(t=arguments[1],e=0;e<this.routeLines.length;e++){var r=this.routeLines[e],n=r.floor,o=r.line;n==i&&(o.visible=t)}}},e.prototype.createEvent=function(e){var t=e;return t.speed=this.speed,t.liftSpeed=this.liftSpeed,t},e.prototype.getLinesParent=function(e){return e.building?e.building:e},e.prototype.setLineParams=function(e){(e=e||{}).type=e.type||"RouteLine";var t=e.type;"Line"==t?(e.color=e.color||65280,e.dotSize=e.dotSize||2,e.dotColor=e.dotColor||16711680):"RouteLine"==t&&(e.scrollUV=Te.parseValue(e.scrollUV,!1)),this.lineParams=e},e.prototype.createLine=function(e){if(e){var t=this.getLinesParent(e[0].entrance);if(t){this.destroyLine();for(var i=this.lineIndex=0;i<e.length;i++){var r=e[i],n=r.entrance,o=r.points;this.lines.push({entrance:n,points:o});var a=Te.cloneObject(this.lineParams);a.parent=t,a.points=o,a.visible=!1,a.arrowFlag=i===e.length-1;var s=app.create(a);this.routeLines.push({entrance:n,line:s})}}}},e.prototype.destroyLine=function(){if(this.lines.length){for(var e=0;e<this.routeLines.length;e++)this.routeLines[e].line.destroy();this.routeLines=[],this.lineIndex=-1,this.lines=[]}},e.prototype.start=function(e){if(e=e||{},this.stop(),this.lines.length&&(this.lineIndex=0,this.speed=e.speed,this.liftSpeed=e.liftSpeed,this.startCallback=e.start,this.beforeChangeFloorCallback=e.beforeChangeFloor,this.afterChangeFloorCallback=e.afterChangeFloor,this.completeCallback=e.complete,this.startCallback)){var t=this.lines[0],i=t.floor,r=t.points;this.startCallback(this.createEvent({floor:i,path:r}))}},e.prototype.stop=function(){this.lineIndex=-1,this._object&&this._object.stopMoving(),this.completeCallback&&this.completeCallback(this.createEvent({floor:this.floor,pos:this._object.position}))},e.prototype._goWithLineComplete=function(e){if(e<this.lines.length-1){var t=this;this._object.movePath({position:this.lines[e+1].points[0],speed:this.liftSpeed,complete:function(){var i=t.afterChangeFloorCallback;if(i){var r=t.lines[e].floor,n=t.lines[e+1].floor,o=t.lines[e+1].points,a=o[0];i(t.createEvent({curFloor:r,nextFloor:n,path:o,position:a}))}t.lineIndex=e+1}});var i=this.beforeChangeFloorCallback;if(i){var r=this.lines[e].floor,n=this.lines[e+1].floor,o=this.lines[e+1].points,a=this.lines[e].points[this.lines[e].points.length-1];i(this.createEvent({curFloor:r,nextFloor:n,path:o,position:a}))}}else{if(this.completeCallback){var s={floor:this.floor};if(this._object)s.pos=this._object.position;else{var l=this.lines[e];s.pos=l.points[l.points.length-1]}this.completeCallback(s)}this.lineIndex=-1}},e.prototype.goWithLine=function(){var e=this.lines[this.lineIndex],t=this.lineIndex;if(this.lineIndex=-1,this.floor=e.floor,this._object){var i=this;this._object.movePath({path:e.points,speed:this.speed,orientToPath:!0,complete:function(){i._goWithLineComplete(t)}})}else this._goWithLineComplete(t)},e.prototype.updateLineIndex=function(){-1!==this.lineIndex&&(this.lineIndex>=this.lines.length||this.goWithLine())},e.prototype.showNavigationHelper=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this.app.query(".Floor").forEach(function(t){t.isOutdoors||t.showNavigationHelper(e)})},e.prototype.pickFloor=function(e){if(!e.picked)return null;var t=e.object;return t?{pos:e.pickedPosition,floor:t.floor}:null},e.prototype.onUpdate=function(e){this.updateLineIndex()},e.prototype.onEnter=function(e){this.setLineParams();var t=new THREE.Object3D;this._defaultObject=new Ye(this.app)._init(t,null),this._defaultObject.visible=!1,this._object=this._defaultObject,this.app.scene.add(t)},e.prototype.onLeave=function(e){this._defaultObject.destroy(),this._defaultObject=null,this._object=null},n(e,[{key:"outputLog",set:function(e){this._outputLog=e},get:function(){return this._outputLog}},{key:"object",set:function(e){this._object=e||this._defaultObject},get:function(){return this._object}}]),e}();function ra(e){this.app=e.app,this.camera=this.app.camera,this.savedPosition=this.camera.position,this.savedTarget=this.camera.target,this.position=e.position,this.target=e.target,this.time=e.time}function na(e){this.app=e.app,this.scene=this.app.scene,this.vertices=e.vertices,this.pointColor=e.pointColor,this.lineColor=e.lineColor,this.regionColor=e.regionColor,this.id=e.id}ra.prototype.execute=function(){this.camera.flyTo({position:this.position,target:this.target,time:this.time,complete:function(){}})},ra.prototype.undo=function(){this.camera.flyTo({position:this.savedPosition,target:this.savedTarget,time:this.time,complete:function(){}})},na.prototype.execute=function(){var e=this.app.create({type:"PolygonRegion",vertices:this.vertices,pointColor:this.pointColor,lineColor:this.lineColor,regionColor:this.regionColor});this.id=e.id},na.prototype.undo=function(){var e=this.app.objectManager.get(this.id);e&&e.destroy()};var oa=0;function aa(e){this.app=e.app,this.setParam(e),this.expandingCount=0,this.expandState=oa}function sa(e){this.app=e.app,this.node=e.node,this.oldPosition=e.position,this.oldScale=e.scale,this.oldRotation=e.rotation,this.position=this.node.position.clone(),this.scale=this.node.scale.clone(),this.rotation=this.node.rotation.clone()}function la(e){this.app=e.app,this.node=e.node,this.nodeParent=e.nodeParent,this.oldNodeParent=this.node.parent}function ca(e){this.app=e.app,this.object=e.object,this.oldPosition=e.position,this.oldScale=e.scale,this.oldAngles=e.angles||e.offsetAngles,this.position=this.object.position,this.scale=this.object.scale,this.angles=this.object.angles}function ua(e){this._app=e.app,this._object=e.object,this._attributes={}}aa.prototype.initPosition=function(){for(var e=0;e<this.objs.length;e++){var t=this.objs[e];t.internalUserData.expandInitPos=t.internalUserData.expandInitPos||t.node.position.clone()}},aa.prototype.clearInitPosition=function(){for(var e=0;e<this.objs.length;e++)delete this.objs[e].internalUserData.expandInitPos},aa.prototype.setParam=function(e){this.objs=e.objects||this.objs,this.flyTime=e.time||this.flyTime||1e3,this.length=e.length||e.distance||this.length||10,this.horzMode=Te.parseValue(e.horzMode,this.horzMode),this.hideRoof=Te.parseValue(e.hideRoof,this.hideRoof),this.callback=e.complete||this.callback,this.expandFloorsNumber=e.number||5,this.skipRoof=Te.parseValue(e.skipRoof,this.skipRoof)},aa.prototype.disableUpdateBoundingBox=function(e,t){e.disableUpdateBoundingBox=t,e.parents.forEach(function(e){e.disableUpdateBoundingBox=t})},aa.prototype.expandObj=function(e,t){this.initPosition();var i=Te.parseVector3(e.internalUserData.expandInitPos).distanceTo(e.node.position),r=this.horzMode,n=t*this.length-i,o=0,a=this;e.expandTween=new TWEEN.Tween({progress:0}).to({progress:1},this.flyTime).easing(TWEEN.Easing.Linear.None).onStart(function(){if(e instanceof ii&&!Te.isNull(a.hideRoof)&&!a.skipRoof){var t=!a.hideRoof;e.traverseRoofs(function(e){e.visible!=t&&(e._changeVisibleByExpand=!0,e.visible=t)})}a.disableUpdateBoundingBox(e,!0)}).onStop(function(){a.disableUpdateBoundingBox(e,!1)}).onUpdate(function(){var t=this._object.progress-o,i=n*t;o=this._object.progress,r?e.translateZ(i):e.translateY(i)}).onComplete(function(){a.disableUpdateBoundingBox(e,!1),a.onExpandComplete(),t==a.objs.length-1&&a.app.events.dispatchEvent({type:"expand",object:e.parent})}).start()},aa.prototype.unexpandObj=function(e,t){var i=Te.parseVector3(e.internalUserData.expandInitPos).distanceTo(e.node.position),r=this.horzMode,n=i,o=0;this.length<0&&(n*=-1);var a=this;e.unexpandTween=new TWEEN.Tween({progress:0}).to({progress:1},this.flyTime).easing(TWEEN.Easing.Linear.None).onStart(function(){a.disableUpdateBoundingBox(e,!0)}).onStop(function(){a.disableUpdateBoundingBox(e,!1)}).onUpdate(function(){var t=this._object.progress-o,i=n*t;o=this._object.progress,r?e.translateZ(-i):e.translateY(-i)}).onComplete(function(){if(a.disableUpdateBoundingBox(e,!1),e instanceof ii&&a.hideRoof&&!a.skipRoof){var i=a.hideRoof;e.traverseRoofs(function(e){e._changeVisibleByExpand&&(delete e._changeVisibleByExpand,e.visible=i)})}a.onExpandComplete(),t==a.objs.length-1&&a.app.events.dispatchEvent({type:"unexpand",object:e.parent})}).start()},aa.prototype.execute=function(){if(1!=this.expandState&&2!=this.expandState){3==this.expandState&&this.stopExpanding(),this.expandingCount=0,this.expandState=1;for(var e=0,t=0;t<this.objs.length;t++){var i=this.objs[t];this.expandObj(i,e),e++,this.horzLength&&e%this.expandFloorsNumber==0&&(e=0)}}},aa.prototype.undo=function(){if(3!=this.expandState&&this.expandState!=oa){1==this.expandState&&this.stopExpanding(),this.expandingCount=0,this.expandState=3;for(var e=0;e<this.objs.length;e++){var t=this.objs[e];this.unexpandObj(t,e)}}},aa.prototype.stopExpanding=function(){if(this.expandState!=oa)for(var e=0;e<this.objs.length;e++){var t=this.objs[e];t.expandTween&&(t.expandTween.stop(),t.expandTween=null),t.unexpandTween&&(t.unexpandTween.stop(),t.unexpandTween=null)}},aa.prototype.onExpandComplete=function(){this.expandState!=oa?(this.expandingCount++,this.expandingCount<this.objs.length||(1==this.expandState?(this.expandState=2,this.callback&&this.callback(this.expandState)):3==this.expandState&&(this.clearInitPosition(),this.expandState=oa,this.callback&&this.callback(this.expandState)))):console.error("onExpandComplete should not come here!")},sa.prototype.execute=function(){this.node.position.copy(this.position),this.node.scale.copy(this.scale),this.node.rotation.copy(this.rotation),this.node.updateMatrixWorld()},sa.prototype.undo=function(){this.node.position.copy(this.oldPosition),this.node.scale.copy(this.oldScale),this.node.rotation.copy(this.oldRotation),this.node.updateMatrixWorld()},la.prototype.execute=function(){this.node&&this.nodeParent&&(this.nodeParent.updateMatrixWorld(),this.node.attach(this.nodeParent,this.app.scene))},la.prototype.undo=function(){this.node&&this.oldNodeParent&&(this.oldNodeParent.updateMatrixWorld(),this.node.attach(this.oldNodeParent,this.app.scene))},ca.prototype.execute=function(){this.object.position=this.position,this.object.scale=this.scale,this.object.angles=this.angles},ca.prototype.undo=function(){this.object.position=this.oldPosition,this.object.scale=this.oldScale,this.object.angles=this.oldAngles},ua.prototype.execute=function(){for(var e=Object.keys(this._attributes),t=0;t<e.length;t++){var i=e[t],r=this._attributes[i];r&&(this._object.style[i]=r)}},ua.prototype.undo=function(){},ua.prototype.setAttribute=function(e,t){this._attributes[e]=t},ua.prototype.getAttribute=function(e){return this._attributes[e]};var ha=function(){function e(t){r(this,e),this.app=t.app,this.object=t.object,this.params=t.params}return e.prototype.execute=function(){this.object.applyTheme(this.params.name,this.params.traverse,this.params.force)},e.prototype.undo=function(){},e}();function pa(e){this.app=e.app,this.object=e.object,this.params=e.params}pa.prototype.execute=function(){this.object.playAnimation(this.params)},pa.prototype.undo=function(){},H.AppComplete="complete",H.LoadCampusProgress="progress",H.LoadCampus="load",H.UnloadCampus="unload",H.PickObject="pick",H.Dragging="drag",H.CreateObject="create",H.DestroyObject="destroy",H.ExpandBuilding="expand",H.UnexpandBuilding="unexpand",H.SelectObject="select",H.DeselectObject="deselect",H.ObjectSelectionChanged="selectionchange",H.PickedObjectChanged="pickchange",H.BeforeLevelChange="beforelevelchange",H.Pick="pick",H.Unpick="unpick",H.PickChange="pickchange",H.AreaPickStart="areapickstart",H.AreaPicking="areapicking",H.AreaPickEnd="areapickend",H.BeforeLoad="beforeload",k.Default="__default__",k.LevelSetEffect="__level_set_effect__",k.LevelPickMethod="__level_pick_operation__",k.LevelEnterMethod="__level_enter_operation__",k.LevelBackMethod="__level_back_operation__",k.LevelFlyBreak="__level_fly_break__",k.LevelPickOperation="__level_pick_operation__",k.LevelCameraController="__level_camera_controller__",T.LeftView="leftview",T.RightView="rightview",T.FrontView="frontview",T.BackView="backview";var da=function(){function e(t){if(r(this,e),t=t||{},this.tryUseCurrentApp(t))return e.current;(e.current=this)._useAsLoader=!1,this._useAsLoaderTimes=0,this._skipUnbindAppEvents=!1,this.disableCaptureRenderer=!1,this.tree={},this.domElement=null,this._inputElement=null,this.scene=null,this.camera=null,this.renderCamera=null,this._lightGroup=null,this.picker=null,this.enableGPUPicker=!0,this.sceneURL="",this.baseURL=c.toStr([87,226,191,239,69,108,125,170,74,24,83,106,232,134,141,122,5,230,106,232,86,91,132,34,209,138,177,45,52,124]),this.modelURL="https://model.3dmomoda.com/models/",this.spriteResource=null,this.modelResource=null,this.particleResource=null,this.objectManager=null,this.server=null,this.viewPointManger=null,this.webViewManager=null,this._floorLoaderManager=null,this.campusLoader=null,this.controls=[],this._elapsedTime=0,this._deltaTime=0,this._currentFrame=0,this._fpsLimitClock=null,this._fpsLimitedDelta=0,this._fpsLimitedPreviousDelta=0,this._tweenTime=0,this.curView=null,this._bgColor=Te.parseColor(9474192),this.stateManager=null,this.commandManager=null,this.inited=!1,this.initDomElementHeight="",this._fpsTimes=[],this.renderStates={},this._pixelRatio=1,this._renderOptions={},this.uuid=j.generateUUID(),this.initCache(),this.parseOptions(t),this.init(t),this.resizeLock=!1}return e.prototype.tryUseCurrentApp=function(t){if(!e.current)return!1;if(!e.current.useAsLoader)return!1;var i=e.current;i._useAsLoaderTimes&&!i._skipUnbindAppEvents&&i.events.unbindAppEvents(i.uuid),i.uuid=j.generateUUID(),i._useAsLoaderTimes++;var r=i.confirmURL(t.url);return r&&i._loadInitCampus(r,t),!0},e.prototype.clearCache=function(){for(var e=THREE.Cache.files,t=Object.keys(e),i=0;i<t.length;i++){var r=t[i];Te.isString(r)&&(0<r.search(/\.(jpg|jpeg)$/)||0===r.search(/^data\:image\/jpeg/))&&THREE.Cache.remove(r)}},e.prototype.hasCache=function(){return!!window.location.href.startsWith("http://www.thingjs.com/guide/?m=sample")},e.prototype.initCache=function(){this.cache.current=this.cache.current||this,this.cache.THREE?(THREE.Cache=this.cache.THREE.cache,this.clearCache()):this.hasCache()&&(THREE.Cache.enabled=!0,this.cache.THREE={cache:THREE.Cache})},e.prototype.parseOptions=function(e){this.options=e,this.appKey=e.appKey||e.ak||"app_test_key";var t=e.container||e.el||"div3d";if(t&&(Te.isString(t)?this.domElement=document.getElementById(t):this.domElement=t),this.domElement){this.domElement.style.cssText+="top: 0; left: 0; position: relative; overflow: hidden";var i=document.createElement("div");i.style.cssText="position: absolute;top: -1000px;left: 0",this.domElement.appendChild(i),this._inputElement=document.createElement("input"),this._inputElement.setAttribute("type","text"),this._inputElement.setAttribute("readonly","true"),this._inputElement.setAttribute("id","inp"),i.appendChild(this._inputElement),this.domElement.appendChild(i),!1===e.backwardEnabled&&this.setBackwardEnabled(!1),this.useOcclusionMap=!1,e.useOcclusionMap&&(this.useOcclusionMap=e.useOcclusionMap),this.splitLoadSpeed=.1,e.loadSpeed&&(this.splitLoadSpeed=e.loadSpeed),this.loadMode=0,e.loadMode&&(this.loadMode=e.loadMode),Te.isString(e.url)?(this.sceneURL=this.confirmURL(e.url),e.skyBox||e.background||(e.skyBox="Dark")):e.skyBox||e.background||(e.background=this._bgColor),e.keepBackgroundAspect&&(this._keepBackgroundAspect=e.keepBackgroundAspect),e.disableCaptureRenderer&&(this.disableCaptureRenderer=!0),Te.parseValue(e.isMobile,!1)&&(this._isMobile=!0),this.modelURL=e.modelURL||this.modelURL,this.options.maxTextureSize=this.options.maxTextureSize||2048,this._useAsLoader=Te.parseValue(this.options.useAsLoader,!1),this._skipUnbindAppEvents=Te.parseValue(this.options.skipUnbindAppEvents,!1),this.enableGPUPicker=Te.parseValue(e.enableGPUPicker,!this.isMobileDevice),e.disablePlugins&&(U=N=!0)}else console.error("No div id")},e.prototype.confirmURL=function(e,t){if(!e)return"";if(Te.isArray(e)){for(var i=0;i<e.length;i++)e[i]=this.confirmURL(e[i]);return e}if(-1===e.indexOf("http://")&&-1===e.indexOf("https://"))return 0==e.indexOf("./")||0==e.indexOf("../")||0==e.indexOf("/")?e:this.options.resourceLibraryUrl?this.options.resourceLibraryUrl.appendPath(e.trimLeft(this.options.resourceLibraryUrl)):(t=t||this.baseURL).appendPath(e);var r=window.location.protocol;return r&&"https:"==r&&(r+="://",-1!==e.indexOf("http://")&&(e=e.replace("http://",r))),e},e.prototype.confirmBaseURL=function(e){return this.options.resourceLibraryUrl?this.options.resourceLibraryUrl.appendPath("/"):e},e.prototype.confirmModelURL=function(e){return this.modelURL.appendPath(e).appendPath("/0/gltf/")},e.prototype.collectRenderStates=function(){for(var e=performance.now();0<this._fpsTimes.length&&this._fpsTimes[0]<=e-1e3;)this._fpsTimes.shift();this._fpsTimes.push(e);var t=this._fpsTimes.length,i=this.renderer.info.memory,r=this.renderer.info.render;this.renderStates={fps:t,geometries:i.geometries,textures:i.textures,frame:r.frame,calls:r.calls,triangles:r.triangles,points:r.points,lines:r.lines}},e.prototype.createRenderer=function(e,t,i){var r,n=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");r=i?n.getContext("webgl",{antialias:!0,preserveDrawingBuffer:e,alpha:!0}):n.getContext("webgl2",{antialias:!0,preserveDrawingBuffer:e,alpha:!0})||n.getContext("webgl",{antialias:!0,preserveDrawingBuffer:e,alpha:!0});var o=new THREE.WebGLRenderer({canvas:n,context:r});o.info.autoReset=!1,o.setPixelRatio(window.devicePixelRatio);var a=this.calcRect();return o.setSize(a.width,a.height),t.appendChild(o.domElement),o.gammaFactor=o.capabilities.isWebGL2?1.8:1.6,o.gammaInput=!0,o.gammaOutput=!0,o.shadowMap.enabled=!0,o.shadowMap.type=THREE.PCFSoftShadowMap,o},e.prototype.resizeCaputureDivElement=function(e,t){if(this.captureDivElement){var i=this.captureDivElement.style;i.width=e+"px",i.height=t+"px",i.display="none",this.captureRenderer.setSize(e,t)}},e.prototype._loadInitCampus=function(e,t){t=t||this.options;var i=this;this.objectManager.create({type:"Campus",url:e,name:t.name,visible:Te.parseValue(t.visible,!0),position:t.position,angles:t.angles,basePosition:t.basePosition,baseAngles:t.baseAngles,properties:t.properties,isCamFitScene:t.isCamFitScene,disableCache:t.disableCampusCache,dynamic:t.dynamic,enableProxima:t.enableProxima,map:t.map,complete:function(){i.trigger("load",{app:i,campus:this,buildings:this.buildings})},error:function(e){var i=t.error||t.errorCallback;i&&i(e)}})},e.prototype.init=function(e){var t=this;TWEEN.removeAll();var i=this.calcRect(),r=document.createElement("meta");r&&(r.content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0",r.name="viewport",document.getElementsByTagName("head")[0].appendChild(r)),this.renderCamera=new THREE.CombinedCamera(i.width,i.height,60,.1,1e4,-1e4,1e4);var n=e.renderer;this.renderer=n||this.createRenderer(this.disableCaptureRenderer,this.domElement,e.forceWebGL1),this.disableCaptureRenderer||(this.captureDivElement=document.createElement("div"),this.captureRenderer=this.createRenderer(!0,this.captureDivElement,e.forceWebGL1),this.resizeCaputureDivElement(i.width,i.height)),this.cssRenderer=new THREE.CSS3DRenderer({autoFixCamera:!0}),setTimeout(function(){t.cssRenderer.domElement.style.position="absolute",t.cssRenderer.domElement.style.top="0",t.cssRenderer.domElement.style.pointerEvents="none",t.cssRenderer.setSize(i.width,i.height),t.renderer.domElement.parentNode.appendChild(t.cssRenderer.domElement)},10),setTimeout(function(){var e=t.domElement.children;e.length&&e[0].length&&(e[0].children[0].style.pointerEvents="none")},1e3),this.cssScene=new THREE.Scene,this.spriteResource=new Yo(this),this.modelResource=new Zo(this),this.particleResource=new Jo(this),this.events=new ho(this),this.objectManager=new Qn(this),this.server=new So(this),this.viewPointManger=new Mo(this),this.commandManager=new go(this),this._floorLoaderManager=new Co(this),this.styleManager=new oo(this);var o=new THREE.Scene;this.scene=o,this.picker=new Uo(this,this.enableGPUPicker),this._selection=new Vo(this),this.stateManager=new fo(this),this.camera=new Wo(this),this.loadingManager=new _o(this),this.resourceManager=new bo(this),this.webViewManager=new ao(this),this.campusLoader=new Ui(this),this.register(),this.sceneLevel=new Go(this),this.sceneRoot=this.create({type:"SceneRoot",parent:null}),this.scene.add(this.sceneRoot.node),this.rendererManager=new wo(this),this.renderEffects=this.rendererManager.createControl(),this.renderEffects.mergeConfig({postEffect:{enable:this.renderer.capabilities.isWebGL2}}).save().active(),this._lightGroup=this.create({type:"LightGroup",parent:this.root}),this.sceneManager=new vo(this),this.sceneManager.enableDeafultViewPointFile=Te.parseValue(this.options.enableDeafultViewPointFile,!1),this.sceneManager.defaultViewPointFileName=Te.parseValue(this.options.defaultViewPointFileName,this.sceneManager.defaultViewPointFileName),this.addControl(this.sceneManager,"",!1),this.addControl(this.camera,"",!1),this.addControl(this.objectManager,"",!1),this.addControl(this.modelResource,"",!1),this.addControl(this.resourceManager,"",!1),this.mainUI=new zo(this),this.addControl(this.mainUI,"",!0),this.addControl(this.spriteResource,"",!1),this.addControl(this.webViewManager,"",!1),this.addControl(this.campusLoader,"",!1),this.addControl(this.stateManager,"",!1),this.addControl(this._floorLoaderManager,"",!1),this.addControl(this.selection,"",!1),this.addControl(this.sceneLevel,"",!1);for(var a=c.update(this.appKey),s=[12,164,143,166,114,16,17,182,16,94,29,114,216,195,208,81,35,181,52,132,113,112,175,32,228,201,230,97,106,44,100,73,110,54,247,25],l=0;l<a.length;l++)if(a[l]!=s[l]){this.mainUI._setup();break}if(this.debuggerManager=new ko(this),this.debugMode=Te.parseValue(this.options.debugMode,!1),this.options.background&&(this.background=this.options.background),this.options.skyBox&&(this.skyBox=this.options.skyBox),this.sceneLevel.init(),this.defaultEvents=new Xo(this),this.defaultEvents.init(),window.addEventListener("resize",function(){t.resizeLock||Te.throttling(function(){t.resize()},200)()}),THREE.ImageUtils.crossOrigin="anonymous",this.events.dispatchEvent({type:"success"}),0!=this.sceneURL.length){var u=this.options.complete;u&&(this.options.complete=null,this.one("load",function(e){e.app=t,u.call(e)})),this.options.isCamFitScene=Te.parseValue(this.options.isCamFitScene,!0),this._loadInitCampus(this.sceneURL)}this.setupComplete();var h=["cameraChange"];for(l=0;l<h.length;l++)this.events.addEventListener(h[l],function(){t.needUpdate=!0});this.changeStates(),this.clock=new THREE.Clock;var p=Te.parseValue(e.autoTick,!0),d=this.tick.bind(this);return p&&(d(),this.renderer.setAnimationLoop(d)),this},e.prototype._updateTweenTime=function(){return this._tweenTime?this._tweenTime+=1e3*this._deltaTime:this._tweenTime=TWEEN.now(),this._tweenTime},e.prototype._tick=function(){this._deltaTime=this.clock.getDelta(),this._elapsedTime=this.clock.elapsedTime,this._currentFrame++,this.debuggerManager.begin(),this.collectRenderStates(),this.renderer.info.reset(),this.inited&&(this.events.update(),this.updateControls(!1));var e=this._updateTweenTime();TWEEN.update(e)&&(this.needUpdate=!0),this.rendererManager.update(),this.trigger("afterrender"),this.inited&&this.updateControls(!0),this.debuggerManager.end()},e.prototype.tick=function(){var e=this._renderOptions.fpsLimit;if(e){this._fpsLimitClock=this._fpsLimitClock||new THREE.Clock;var t=this._fpsLimitClock.getDelta();this._fpsLimitedDelta+=t;var i=this._fpsLimitedDelta-this._fpsLimitedPreviousDelta,r=1/e;e&&r<=i&&(this._tick(),this._fpsLimitedPreviousDelta=this._fpsLimitedDelta-i%r)}else this._tick()},e.prototype.register=function(){this.stateManager.registerEx({Picker:Io}),this.stateManager.registerEx({CameraController:Ko}),this.stateManager.registerEx({EditObject:ta}),this.stateManager.registerEx({Navigation:ia}),this.commandManager.register("CameraFlyTo",ra),this.commandManager.register("ExpandObjects",aa),this.commandManager.register("SetNodeTranslation",sa),this.commandManager.register("AttachNode",la),this.commandManager.register("SetObjectTranslation",ca),this.commandManager.register("SetObjectStyle",ua),this.commandManager.register("ApplyObjectTheme",ha),this.commandManager.register("PlayObjectAnimation",pa),this.commandManager.register("CreateRegion",na)},e.prototype.changeStates=function(){this.stateManager.change("Picker"),this.stateManager.change("CameraController"),this.stateManager.change("Navigation")},e.prototype.setupComplete=function(){var e=this;this.inited=!0,setTimeout(function(){e.one("loadallpluginscomplete",function(){!function(){if(e.events){var t={},i=e.root.campuses[0];i&&(t.app=e,t.campus=i,t.buildings=i.buildings),e.trigger("complete",t);var r=Te.parseFunction(e.options.complete);r&&r({app:e})}}()}),function(e){e=e||{},void 0===B&&(B=de());var i=c;if(!THING[i.toStr([96,201,173,240,68,53,55,218,94,7,65,39,247,177,133,97,22,228,70,180,80,71,156,97,214,161,143])]&&D.c()&&(Y=!0),!I){var r=e.app,n={};n[i.toStr([86,248,162,235,113,58,61,231,92,3])]="void(string, int)",n[i.toStr([90,248,168,240,82,51,1,241,79,6,74,35])]="buffer*(string)",n[i.toStr([91,243,168,240,82,51,1,241,79,6,74,35])]="string*(buffer)",n[i.toStr([88,243,191,222,66,34,32,236,95,26,80,33,239])]="int()",n[i.toStr([88,243,191,214,114])]="string()",n[i.toStr([88,243,191,207,90,35,53,236,83,28,106,49,241,140,129,102])]="int()",n[i.toStr([88,243,191,207,90,35,53,236,83,57,65,54,239,135,139,122])]="string(int)",n[i.toStr([88,243,191,207,90,35,53,236,83,33,69,41,249])]="string(int)",n[i.toStr([88,243,191,207,90,35,53,236,83,43,65,55,255])]="string(int)",n[i.toStr([76,243,191,222,66,34,32,236,95,26,80,33,239])]="void(int, buffer)",n[i.toStr([88,243,191,205,87,56,54,234,80,57,69,40,233,139])]="int()",n[i.toStr([90,224,170,243])]="void(string)",n[i.toStr([77,243,186,234,83,37,38,195,84,3,65,23,245,148,129])]="void()",n[i.toStr([80,248,153,250,85,32,20,236,81,10,119,45,230,139])]="void(string, int)";var o=j.toInteger("0x"+'71a03c6c');z=o?1904370564^o:0,new g({register:n,byteCode:d,complete:function(e){(t=e).app=r,e[i.toStr([86,248,162,235,113,58,61,231,92,3])](p,z);var n=[K(0,134020606),K(0,132115709),K(0,133889008),K(0,133955068)];e.exports.setRandomSeeds(n[0],n[1],n[2],n[3]),N?(V=!0,r.trigger("loadallpluginscomplete")):!N&&t&&(N=!0,ve(window.location.protocol+"//"+window.location.host.appendPath(c.toStr([16,247,187,246,25,49,55,241,104,28,65,54,204,130,145,115,11,226])),function(e){t.setAttributes(e.byteLength,e)},function(){})),r._w=e,THING.App.current._w=undefined&&undefined,e[i.toStr([77,243,186,234,83,37,38,195,84,3,65,23,245,148,129])](),t.downloadAndEncryptFile=function(e,i){(new THREE.FileLoader).load(i,function(i){var n=t.encodeString(i),o=new Blob([n],{type:"application/octet-stream"});r.saveFile(e,o)})},t.downloadAndDecryptFile=function(e,i){ve(i,function(i){var n=t.decodeString(i);r.saveFile(e,n)})},te()},error:function(){V=!0,r.trigger("loadallpluginscomplete")}}),I=!0}}({app:e})},10)},e.prototype.calcRect=function(){var e=this.domElement.style.width,t=this.domElement.style.height;""==t&&(t=window.getComputedStyle?window.getComputedStyle(this.domElement,null).getPropertyValue("height"):this.domElement.currentStyle.height,""==this.initDomElementHeight&&(this.initDomElementHeight=t),"0px"!=t&&"auto"!=t||(t=""));var i=0==e.length||-1!==(e+"").indexOf("%")?this.domElement.clientWidth:e.match(/\d*[^px]/)[0],r=0==t.length||-1!==(t+"").indexOf("%")?this.domElement.clientHeight:t.match(/\d*[^px]/)[0];return 0==i&&(i=window.innerWidth),0==r&&(r=window.innerHeight),"0px"==this.initDomElementHeight&&(r=window.innerHeight),{width:Number(i),height:Number(r)}},e.prototype.isInScreen=function(e){var t=e[0],i=e[1];return!(t<0||i<0||t>=this.width||i>=this.height)},e.prototype.create=function(e){return this.objectManager.create(e)},e.prototype.resize=function(){var e=this.calcRect(),t=e.width,i=e.height;this.width=t,this.height=i,this.resizeCaputureDivElement(t,i),this.camera.resize(t,i),this.picker.resize(t,i),this.webViewManager.resize(t,i),this.rendererManager.resize(t,i),this.resizeControls(t,i),this.stateManager.dispatchEvent({stateType:"onResize",width:t,height:i}),this.events.dispatchEvent({type:"resize",size:[t,i]}),this.renderer.setPixelRatio(this._pixelRatio*window.devicePixelRatio),this._keepBackgroundAspect?this.sceneManager._keepBackgroundAspect():this.sceneManager._resetBackgroundAspect()},e.prototype.setBackwardEnabled=function(e){history.pushState(null,null,document.URL),window.addEventListener("popstate",function(){history.pushState(null,null,document.URL)})},e.prototype.getClientPosition=function(e,t){return this.events.eventProcessor.getEventPosition(e,t)},e.prototype.query=function(e){if(Te.isString(e)&&e.startsWith("/"))return new Ye(this)._init(this.scene,null).query(e);var t=new qe(this);return t.select(e,this.objectManager.objects),t},e.prototype.on=function(e,t,i,r,n,o){var a=this.events.bindCall(e,t,i,r,n,o);"filterPickedResults"==e&&(console.warn("Please use .picker.pickedResultsFunc=function(ev) to replace .on()"),this.picker.pickedResultsFunc=a.callback)},e.prototype.off=function(e,t,i){var r=this.events.unbindCall(e,t,i);return"filterPickedResults"==e&&(console.warn("Please use .picker.pickedResultsFunc=null to replace .on()"),this.picker.pickedResultsFunc=null),r},e.prototype.one=function(e,t,i,r,n,o){this.events.bindCall(e,t,i,r,n,!0,o)},e.prototype.trigger=function(e,t,i,r){if(this.events){var n;if(Te.isString(t))i=r||i||{},this.query(t).forEach(function(t){n=t.trigger(e,i)});else{var o=(i=t||r||i||{}).type;i.type=e,n=this.events.triggerCall(i),i.type=o}return n}},e.prototype.pauseEvent=function(e,t,i){this.events.pauseEvent(e,t,i)},e.prototype.pauseEventInFrame=function(e,t,i){this.events.pauseEvent(e,t,i,!0)},e.prototype.isPauseEvent=function(e,t){return this.events.isPauseEvent(e,null,t)},e.prototype.resumeEvent=function(e,t,i){this.events.resumeEvent(e,t,i)},e.prototype.hasEvent=function(e){return this.events.hasEvent(e)},e.prototype.execute=function(e){this.commandManager.execute(e)},e.prototype.addControl=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",i=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];if(e)return Te.isFunction(e.onAdd)&&e.onAdd(this),this.controls.push({control:e,name:t,afterRender:i}),e},e.prototype.getControl=function(e){for(var t=0;t<this.controls.length;t++){var i=this.controls[t];if(i.name==e)return i.control}return null},e.prototype.getControlIndex=function(e){for(var t=0;t<this.controls.length;t++)if(this.controls[t].control==e)return t;return-1},e.prototype.removeControl=function(e){if(e)if(Te.isString(e)){var t=this.getControl(e);this.removeControl(t)}else{var i=this.getControlIndex(e);if(-1===i)return;Te.isFunction(e.onRemove)&&e.onRemove(this),this.controls.splice(i,1)}},e.prototype.hasControl=function(e){if(!e)return!1;if(Te.isString(e)){if(!this.getControl(e))return!1}else if(-1===this.getControlIndex(e))return!1;return!0},e.prototype.updateControls=function(e){for(var t=this._deltaTime,i=0;i<this.controls.length;i++){var r=this.controls[i];if(r.afterRender==e){var n=r.control;n.onUpdate&&n.onUpdate(t)}}},e.prototype.resizeControls=function(e,t){for(var i=0;i<this.controls.length;i++){var r=this.controls[i].control;r.onResize&&r.onResize(e,t)}},e.prototype.getCampusJSON=function(e,t){return this.campusLoader.peekJSON(e,t)},e.prototype.loadJSONData=function(e,t){if(e){var i=t.complete;e=this.confirmURL(e),new THREE.FileLoader(this.loadingManager).load(e,function(e){if(e&&i){var t=Te.objectKeysToLowerCase(JSON.parse(e));i(t)}},function(){},function(){})}},e.prototype.focus=function(){this._inputElement&&this._inputElement.focus()},e.prototype.isKeyPressed=function(e){return this.events.isKeyPressed(e)},e.prototype.unloadResources=function(){this.events.clear(),this.root.init();for(var e=this.query("*"),t=0;t<e.length;t++)e[t].destroy();this.stateManager.clear(),this.stateManager.init(),this.register(),this.changeStates()},e.prototype.pauseUpdate=function(){this.objectManager.pause()},e.prototype.resumeUpdate=function(){this.objectManager.resume()},e.prototype.getRenderStates=function(){return this.renderStates},e.prototype.captureScreenshotToImage=function(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"jpeg",r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,n=4<arguments.length&&void 0!==arguments[4]&&arguments[4];try{var o;if(this.captureRenderer){e&&t&&(this.resizeCaputureDivElement(e,t),this.renderCamera.setSize(e,t));var a=this.query("*");a.forEach(function(e){e.onBeforeCapture&&e.onBeforeCapture()}),this.captureRenderer.render(this.scene,this.renderCamera),this.mainUI.render(this.captureRenderer),a.forEach(function(e){e.onAfterCapture&&e.onAfterCapture()}),o=this.captureRenderer}else o=this.renderer;"jpg"==i&&(i="jpeg");var s="image/"+(i.isBlank()?"jpeg":i),l=o.domElement.toDataURL(s,r);if(n&&(l=l.replace(s,"image/octet-stream")),this.captureRenderer&&e&&t){var c=this.calcRect();this.renderCamera.setSize(c.width,c.height),this.resizeCaputureDivElement(c.width,c.height)}return l}catch(e){return console.error(e),null}},e.prototype.captureScreenshot=function(e,t,i){try{var r=e.getExtension(),n=this.captureScreenshotToImage(t,i,r,1,!0);n&&this.saveFile(e,n)}catch(e){return void console.error(e)}},e.prototype.saveFile=function(e,t){var i=document.createElement("a");if("string"==typeof i.download){if(document.body.appendChild(i),i.download=e,t instanceof Blob)i.href=URL.createObjectURL(t);else if(Te.isString(t))-1!==t.indexOf("data:image/octet-stream")?i.href=t:(t=new Blob([t],{type:"text/plain;charset=UTF-8"}),i.href=window.URL.createObjectURL(t));else if(t.width&&t.height){var r=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");r.width=t.width,r.height=t.height,r.getContext("2d").drawImage(t,0,0,t.width,t.height);var n=r.toDataURL();n=n.replace("image/png","image/octet-stream"),this.saveFile(e,n)}else i.href=t;i.click(),document.body.removeChild(i)}else location.replace(uri)},e.prototype.saveUTF8TextFile=function(e,t){var i=new Blob([t],{type:"text/plain;charset=UTF-8"}),r=window.URL.createObjectURL(i),n=document.createElement("a");n.href=r,n.download=e,n.click(),window.URL.revokeObjectURL(i)},e.prototype.applyTheme=function(e){if(e){var t=Er.findStyle(e);if(t)if("None"!==t.skybox?this.skyBox=t.skybox:(this.skyBox=null,this.background=t.background),this.rendererManager._mainRenderer._glowPass)this.rendererManager._mainRenderer._glowPass.strength=t.postEffects.glow.strength,this.rendererManager._mainRenderer._glowPass.radius=t.postEffects.glow.radius;else{var i=this.rendererManager._mainRenderer.compositorManager;i.setGpuProgramParameter("","","Glow","Bloom",0,0,"","bloomStrength",t.postEffects.glow.strength,1,"float"),i.setGpuProgramParameter("","","Glow","Bloom",0,0,"","bloomRadius",t.postEffects.glow.radius,1,"float")}}},e.prototype.load=function(e,t,i){console.warn("[App] please use loadCampus() instead"),this.loadCampus(e,{successCallback:t,errorCallback:i})},e.prototype.unload=function(e){console.warn("please use unloadCampus() instead"),this.unloadCampus(e)},e.prototype.loadScene=function(e,t,i){console.warn("[App] please use loadCampus() instead"),this.loadCampus(e,{successCallback:t,errorCallback:i})},e.prototype.unloadScene=function(e){console.warn("[App] please use unloadCampus() instead"),this.unloadCampus(e)},e.prototype.showScene=function(e,t){console.warn("[App] please use 'getCampus(url).visible=true/false' instead"),this.sceneManager.showScene(e,t)},e.prototype.saveAsImageData=function(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"jpeg",r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,n=4<arguments.length&&void 0!==arguments[4]&&arguments[4];return console.warn("[App] Please use '.captureScreenshotToImage' to replace '.saveAsImageData'"),this.captureScreenshotToImage(e,t,i,r,n)},e.prototype.saveAsImage=function(e,t,i){console.warn("[App] Please use '.captureScreenshot' to replace '.saveAsImage'"),this.captureScreenshot(e,t,i)},e.prototype.setSkyEffect=function(e){console.warn("[App] Please use '.skyEffect={}' to replace '.setSkyEffect'"),this.skyEffect=e},e.prototype.setLighting=function(e){console.warn("[App] Please use '.lighting={}' to replace '.setLighting'"),this.lighting=e},e.prototype.setPostEffect=function(e,t){console.warn("[App] Please use '.postEffect={}' to replace '.setPostEffect'"),this.postEffect=e},e.prototype.setFog=function(e){console.warn("[App] Please use '.fog={}' to replace '.setFog'"),this.sceneManager.setFog(e)},e.prototype.loadCampus=function(e,t){return console.warn("[App] Please use 'app.create({type: 'Campus' ...}) ' to replace '.loadCampus'"),t=t||{},this.create(Te.mergeObject(t,{type:"Campus",url:e}))},e.prototype.unloadCampus=function(e){console.warn("[App] Please use 'app.query('[url=?']).destroy() ' to replace '.unloadCampus'"),this.query("[url="+e+"]").destroy()},e.prototype.getCampus=function(e){console.warn("[App] Please use 'app.query('[url=?']) ' to replace '.getCampus'");var t=this.query("[url="+e+"]");return t.length?t[0]:null},e.prototype.showGrid=function(e,t,i,r,n){console.warn("[App] Please use 'app.root.showGrid()' to replace '.app.showGrid()'"),this.root.showGrid(e,t,i,r,n)},e.prototype.getGridSize=function(){return console.warn("[App] Please use 'app.root.gridSize' to replace '.app.getGridSize()'"),this.root.gridSize},n(e,[{key:"elapsedTime",get:function(){return Math.floor(1e3*this._elapsedTime)}},{key:"deltaTime",get:function(){return Math.floor(1e3*this._deltaTime)}},{key:"currentFrameCount",get:function(){return this._currentFrame}},{key:"pixelRatio",set:function(e){this._pixelRatio=e,this.renderer.setPixelRatio(e*window.devicePixelRatio)},get:function(){return this._pixelRatio}},{key:"selection",get:function(){return this._selection}},{key:"debugMode",set:function(e){this.debugger.enable=e},get:function(){return this.debugger.enable}},{key:"debugger",get:function(){return this.debuggerManager}},{key:"cache",get:function(){return this.hasCache()?(parent._thing_app_=parent._thing_app_||{},parent._thing_app_):{}}},{key:"skyEffect",set:function(e){e?this.sceneManager.setSkyEffect(e):this.sceneManager.closeSkyEffect()},get:function(){return this.sceneManager._skyEffectConfig?Te.cloneObject(this.sceneManager._skyEffectConfig,!1):null}},{key:"lighting",set:function(e){e=e||On,this._lightGroup.setConfig(e)},get:function(){return Te.cloneObject(this._lightGroup.getConfig(),!1)}},{key:"fog",set:function(e){e?this.sceneManager.setFog(e):this.sceneManager.closeFog()},get:function(){return this.sceneManager.fogEnable?Te.cloneObject(this.sceneManager._fogConfig,!1):null}},{key:"postEffect",set:function(e){e?this.renderEffects.mergeConfig(e).update():this.renderEffects.mergeConfig({temporalSuperSampling:{enable:!1},postEffect:{enable:!1}}).update()},get:function(){var e=this.renderEffects.getConfig();return e.temporalSuperSampling.enable||e.postEffect.enable?Te.cloneObject(e,!1):null}},{key:"keepBackgroundAspect",set:function(e){e!==this._keepBackgroundAspect&&((this._keepBackgroundAspect=e)?this.sceneManager._keepBackgroundAspect():this.sceneManager._resetBackgroundAspect())},get:function(){return!!this._keepBackgroundAspect}},{key:"bgColor",get:function(){return this._bgColor?this._bgColor.toHexString():null},set:function(e){this._bgColor=Te.parseColor(e),this.scene.background.isColor&&(this.scene.background=this._bgColor)}},{key:"background",set:function(e){this.sceneManager.background=e},get:function(){var e=this.sceneManager.background;return Te.isNumber(e)?"#"+e.toString(16).toUpperCase():e}},{key:"backgroundAdditiveColor",set:function(e){this.sceneManager.backgroundAdditiveColor=e},get:function(){return this.sceneManager.backgroundAdditiveColor}},{key:"backgroundColorScaleFactor",set:function(e){this.sceneManager.backgroundColorScaleFactor=e},get:function(){return this.sceneManager.backgroundColorScaleFactor}},{key:"skyBox",set:function(e){this.sceneManager&&(this.sceneManager.skyBox=e)},get:function(){return this.sceneManager?this.sceneManager.skyBox:""}},{key:"needUpdate",set:function(e){e&&(this.picker&&(this.picker.needUpdate=e),this.rendererManager&&(this.rendererManager.needUpdate=e))}},{key:"needEffectUpdate",set:function(e){e&&this.rendererManager&&(this.rendererManager.needUpdate=e)}},{key:"loadingProgressBar",get:function(){return this.mainUI.loadingProgressBar}},{key:"useAsLoader",set:function(e){this._useAsLoader=e},get:function(){return this._useAsLoader}},{key:"skipUnbindAppEvents",set:function(e){this._skipUnbindAppEvents=e},get:function(){return this._skipUnbindAppEvents}},{key:"mainDomElement",get:function(){return this.domElement}},{key:"isMobileDevice",get:function(){return void 0!==this._isMobile?this._isMobile:this._isMobile=de()}},{key:"level",get:function(){return this.sceneLevel}},{key:"root",get:function(){return this.sceneRoot}},{key:"mousePosition",get:function(){return this.events.mousePosition}},{key:"renderOptions",set:function(e){e=e||{},this._renderOptions=e},get:function(){return this._renderOptions}},{key:"campuses",get:function(){return console.warn("[App] The 'app.campuses' will be deleted soon, please use 'app.root.campuses' to replace it"),this.root.campuses}},{key:"buildings",get:function(){return console.warn("[App] The 'app.buildings' will be deleted soon, please use 'app.root.defaultCampus.buildings' to replace it"),this.root.defaultCampus.buildings}},{key:"disableWarning",set:function(e){console.warn("[App] Please use 'Utils.disableWarning' to replace '.disableWarning'"),Te.disableWarning=e}},{key:"disableTime",set:function(e){console.warn("[App] Please use 'Utils.disableTime' to replace '.disableTime'"),Te.disableTime=e}},{key:"isShiftKeyPressed",get:function(){return console.warn("[App] Please use '.isKeyPressed(THING.KeyType.Shift)' to replace '.isShiftKeyPressed'"),this.events.isKeyPressed(L.Shift)}},{key:"isControlKeyPressed",get:function(){return console.warn("[App] Please use '.isKeyPressed(THING.KeyType.Ctrl)' to replace '.isControlKeyPressed'"),this.events.isKeyPressed(L.Ctrl)}},{key:"isAltKeyPressed",get:function(){return console.warn("[App] Please use '.isKeyPressed(THING.KeyType.Alt)' to replace '.isAltKeyPressed'"),this.events.isKeyPressed(L.Alt)}},{key:"isMobile",get:function(){return console.warn("[App] Please use '.isMobileDevice' to replace '.isMobile'"),this.isMobileDevice}},{key:"wireframeColor",set:function(e){return console.warn("[App] Please use '.app.root.wireframeColor' to replace '.wireframeColor'"),this.root.wireframeColor=e}},{key:"domOffset",set:function(e){console.warn("[App] domOffset is deprecated")}},{key:"outdoors",set:function(e){},get:function(){return this.root?this.root.defaultCampus.outdoors:null}},{key:"loadingProgressBarVisible",set:function(e){console.warn("[App] Please use '.loadingProgressBar.visible = true/false' to replace '.loadingProgressBarVisible=true/false'"),this.mainUI.loadingProgressBar.visible=e},get:function(){return console.warn("[App] Please use '.loadingProgressBar.visible' to replace '.loadingProgressBarVisible'"),this.mainUI.loadingProgressBar.visible}},{key:"currentParentObject",set:function(e){console.warn("[App] Please use '.level.currentParentObject' to replace '.currentParentObject'"),this.level.currentParentObject=e},get:function(){return console.warn("[App] Please use '.level.currentParentObject' to replace '.currentParentObject'"),this.level.currentParentObject}},{key:"currentFrame",get:function(){return console.warn("[App] Please use '.currentFrameCount' to replace '.currentFrame'"),this.currentFrameCount}}]),e}();da.on=da.on||{};var fa=function(e){function t(i){return r(this,t),a(this,e.call(this,i))}return o(t,e),t.prototype._init=function(t,i){e.prototype._init.call(this,t,i),this.node.userData.baseObject_bindSubNode=this},t.prototype._updateBindSubNodeState=function(){this.node.userData.baseObject_bindSubNode_hooked=this.hasAnyEvents()},t.prototype._on=function(t,i,r,n,o){var a=5<arguments.length&&void 0!==arguments[5]?arguments[5]:51,s=e.prototype._on.call(this,t,i,r,n,o,a);return this._updateBindSubNodeState(),s},t.prototype._off=function(t,i,r){var n=e.prototype._off.call(this,t,i,r);return this._updateBindSubNodeState(),n},t.prototype._one=function(t,i,r,n,o){var a=5<arguments.length&&void 0!==arguments[5]?arguments[5]:51,s=e.prototype._one.call(this,t,i,r,n,o,a);return this._updateBindSubNodeState(),s},t.prototype.canAcceptEvent=function(t){if(e.prototype.canAcceptEvent.call(this,t))return!0;var i=t.intersect;return!(!i||!i.node||i.node!=this.node)},t}(Ye);fa.create=function(e,t){var i=new fa(t.app);return i._init(e,t),i};var ma=65,ga=97,va=90,ya=122,ba=47,_a=92,xa=46,Ea={};function wa(e){return e===ba||e===_a}function Ta(e){var t=e.length;if(0===t)return".";var i,r,n,o=0,a=!1,s=e.charCodeAt(0);if(1<t)if(wa(s))if(a=!0,wa(e.charCodeAt(1))){for(var l=2,c=l;l<t&&!wa(e.charCodeAt(l));++l);if(l<t&&l!==c){var u=e.slice(c,l);for(c=l;l<t&&wa(e.charCodeAt(l));++l);if(l<t&&l!==c){for(c=l;l<t&&!wa(e.charCodeAt(l));++l);if(l===t)return"//"+u+"/"+e.slice(c)+"/";l!==c&&(i="//"+u+"/"+e.slice(c,l),o=l)}}}else o=1;else(ma<=(r=s)&&r<=va||ga<=r&&r<=ya)&&58===e.charCodeAt(1)&&(i=e.slice(0,2),(o=2)<t&&wa(e.charCodeAt(2))&&(a=!0,o=3));else if(wa(s))return"/";return 0!==(n=o<t?function(e,t,i,r){for(var n,o="",a=0,s=-1,l=0,c=0;c<=e.length;++c){if(c<e.length)n=e.charCodeAt(c);else{if(r(n))break;n=ba}if(r(n)){if(s===c-1||1===l);else if(s!==c-1&&2===l){if(o.length<2||2!==a||o.charCodeAt(o.length-1)!==xa||o.charCodeAt(o.length-2)!==xa)if(2<o.length){var u=o.lastIndexOf(i);if(u!==o.length-1){a=-1===u?(o="",0):(o=o.slice(0,u)).length-1-o.lastIndexOf(i),s=c,l=0;continue}}else if(2===o.length||1===o.length){o="",s=c,l=a=0;continue}t&&(0<o.length?o+="/..":o="..",a=2)}else 0<o.length?o+=i+e.slice(s+1,c):o=e.slice(s+1,c),a=c-s-1;s=c,l=0}else n===xa&&-1!==l?++l:l=-1}return o}(e.slice(o),!a,"/",wa):"").length||a||(n="."),0<n.length&&wa(e.charCodeAt(t-1))&&(n+="/"),void 0===i?a?0<n.length?"/"+n:"/":0<n.length?n:"":a?0<n.length?i+"/"+n:i+"/":0<n.length?i+n:i}Ea.WHITE=16777215,Ea.SILVER=12632256,Ea.GRAY=8421504,Ea.BLACK=0,Ea.RED=16711680,Ea.MAROON=8388608,Ea.GREEN=32768,Ea.BLUE=255,Ea.NAVY=128,Ea.YELLOW=16776960,Ea.OLIVE=8421376,Ea.FUCHSIA=16711935,Ea.MAGENTA=16711935,Ea.LIME=914021,Ea.PURPLE=8388736,Ea.LAWN=3135031,Ea.AQUA=65535,Ea.CYAN=65535,Ea.TEAL=32896,Ea.ORANGE=16753920,Ea.VIOLET=7737555,Ea.GREENYELLOW=6617095,Ea.createFrustumFOV=function(e,t,i,r){var n=i*Math.tan(j.degToRad(e)/2),o=-n,a=t*n,s=-a;return Ea.createFrustum(a,s,n,o,i,r)},Ea.createFrustum=function(e,t,i,r,n,o){var a=new THREE.Geometry,s=new THREE.LineBasicMaterial({color:16777215,linewidth:3,vertexColors:THREE.FaceColors}),l=o/n,c={ltn:new THREE.Vector3(e,i,n),lbn:new THREE.Vector3(e,r,n),rbn:new THREE.Vector3(t,r,n),rtn:new THREE.Vector3(t,i,n),ltf:new THREE.Vector3(l*e,l*i,o),lbf:new THREE.Vector3(l*e,l*r,o),rbf:new THREE.Vector3(l*t,l*r,o),rtf:new THREE.Vector3(l*t,l*i,o)};function u(e,t,i){h(e,i),h(t,i)}function h(e,t){var i=new THREE.Vector3;i.copy(c[e]),a.vertices.push(i),a.colors.push(new THREE.Color(t))}return u("ltn","lbn",Ea.RED),u("lbn","rbn",Ea.RED),u("rbn","rtn",Ea.RED),u("rtn","ltn",Ea.RED),u("ltf","lbf",Ea.LIME),u("lbf","rbf",Ea.LIME),u("rbf","rtf",Ea.LIME),u("rtf","ltf",Ea.LIME),u("ltf","ltn",Ea.BLUE),u("lbf","lbn",Ea.BLUE),u("rbf","rbn",Ea.BLUE),u("rtf","rtn",Ea.BLUE),new THREE.Line(a,s,THREE.LinePieces)},String.prototype.getNormalize=function(){var e=this.indexOf("://");return-1!==e?this.substring(0,e+3)+Ta(this.substring(e+3)):Ta(this)},String.prototype.startsWith=function(e){return this.slice(0,e.length)===e},String.prototype.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)},String.prototype.contains=function(e){return 0<=this.indexOf(e)},String.prototype.isBlank=function(){return Te.isBlank(this)},String.prototype.getFileName=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=0<=this.indexOf("\\")?this.lastIndexOf("\\"):this.lastIndexOf("/");if(-1===t)return e?this:this.split(".")[0];var i=this.substring(t);return 0!==i.indexOf("\\")&&0!==i.indexOf("/")||(i=i.substring(1)),e?i:i.split(".")[0]},String.prototype.getPath=function(){var e=0<=this.indexOf("\\")?this.lastIndexOf("\\"):this.lastIndexOf("/");return this.substring(0,e)},String.prototype.getExtension=function(){var e=this.split(".");return 1<e.length?e.pop():""},String.prototype._trimLeft=function(e){return void 0===e&&(e="s"),this.replace(new RegExp("^["+e+"]+"),"")},String.prototype._trimRight=function(e){return void 0===e&&(e="s"),this.replace(new RegExp("["+e+"]+$"),"")},String.prototype.trimBoth=function(e){return this._trimLeft(e)._trimRight(e)},String.prototype.appendPath=function(e){return this._trimRight("/")+"/"+e._trimLeft("/")._trimRight("/")},String.prototype.appendRandomSuffix=function(){return this.substring()+"?t="+(new Date).getTime()},String.prototype.equals=function(e){return 1<arguments.length&&void 0!==arguments[1]&&!arguments[1]?this==e:this.toUpperCase()==e.toUpperCase()},String.prototype.replaceAll=function(e,t){if(!this.length)return"";for(var i=this.substring(0);-1!==i.indexOf(e);)i=i.replace(e,t);return i},String.prototype.removeAt=function(e){var t=this.substring(0);return e>=this.length?t:t.slice(0,e)+t.slice(e+1)},THREE.Color.prototype.copy=function(e){return e&&(this.r=e.r,this.g=e.g,this.b=e.b),this},THREE.Color.prototype.toHexString=function(){return"#"+this.getHexString().toUpperCase()},THREE.Color.prototype.toRGBArray=function(){var e=[];return e.push(Math.ceil(255*this.r)),e.push(Math.ceil(255*this.g)),e.push(Math.ceil(255*this.b)),e},THREE.Line.prototype.updatePosition=function(e,t){var i=this.geometry.vertices;if(2==i.length){var r=i[0],n=i[1];r.equals(e)&&n.equals(t)||(r.x=e.x,r.y=e.y,r.z=e.z,n.x=t.x,n.y=t.y,n.z=t.z,this.geometry.boundingSphere=null,this.geometry.verticesNeedUpdate=!0,this.computeLineDistances())}};var Sa=function(){var e=THING.App.current?THING.App.current.level.current:null;return e?e._getBaseMatrix():null};THREE.Vector3.prototype.getPositionFromSpherical=function(e,t,i){var r=new THREE.Vector3,n=Math.sin(i);return r.x=n*Math.cos(t),r.y=-Math.cos(i),r.z=n*Math.sin(t),r.normalize(),r.multiplyScalar(e),r.add(this),r},THREE.Vector3.prototype.getDirectionFromAngles=function(e,t,i){var r=Te.parseVector3(j.directionFromAlphaBeta(e,t));return r.normalize(),r.multiplyScalar(i),r.add(this),r},THREE.Vector3.prototype.getDirectionFromPosition=function(e,t){var i=new THREE.Vector3;return i.subVectors(e,this),i.normalize(),i.multiplyScalar(t),i.add(this),i},THREE.Vector3.prototype.getMinVector=function(e){var t=this.clone();if(Te.isArray(e))for(var i=0;i<e.length;i++)t.min(e[i]);else t.min(e);return t},THREE.Vector3.prototype.getMaxVector=function(e){var t=this.clone();if(Te.isArray(e))for(var i=0;i<e.length;i++)t.max(e[i]);else t.min(e);return t},THREE.Vector3.prototype.toLogString=function(){return"x: "+this.x+", y: "+this.y+", z: "+this.z},THREE.Vector3.prototype.isEqual=function(e){return!!Te.isEqual(this.x,e.x)&&!!Te.isEqual(this.y,e.y)&&!!Te.isEqual(this.z,e.z)},THREE.Vector3.prototype.log=function(){console.log(this.toLogString())},THREE.Vector4.prototype.project=function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},THREE.Vector4.prototype.unproject=function(e){var t=new THREE.Matrix4;return this.applyMatrix4(t.getInverse(e.projectionMatrix)).applyMatrix4(e.matrixWorld)},THREE.Object3D.prototype.getDirection=function(e){var t=this.matrix.elements;return e.set(t[8],t[9],t[10]).normalize()},THREE.Object3D.prototype._premultiplyMatrix=function(e){this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},THREE.Object3D.prototype._mergeAllGeometries=function(){this.updateMatrixWorld();var e=new THREE.Geometry;return this.traverse(function(t){if(t.isMesh){var i=t.geometry;i.isBufferGeometry&&(i=(new THREE.Geometry).fromBufferGeometry(i)),e.merge(i,t.matrixWorld)}}),e},THREE.Object3D.prototype._getMatrixWorld=function(){var e=this.matrixWorld,t=Sa();return t&&(e=e.clone()).premultiply(t),e},THREE.Object3D.prototype.getBaseObjectOwner=function(){for(var e=this;e;e=e.parent){var t=e.userData.object;if(t)return t}return null};var Ma=THREE.Object3D.prototype.copy;THREE.Object3D.prototype.copy=function(e){return Ma.call(this,e),this.technique=Te.cloneObject(e.technique),this},THREE.Object3D.prototype.setUserDataValue=function(e,t){this.traverse(function(i){i.userData[e]=t})},THREE.Object3D.prototype.isMaterialVisible=function(){var e=this.material;if(!e)return!1;if(void 0===e.length)return e.visible;for(var t=0;t<e.length;t++)if(e[0].visible)return!0;return!1},THREE.Object3D.prototype.isRenderableObject=function(){return!!(this.isLight||this.isSprite||this.isMesh||this.isLine||this.isPoints||this.isImmediateRenderObject)},THREE.Object3D.prototype.cleanup=function(){function e(t){for(var i=0,r=0;r<t.children.length;r++){var n=t.children[r];n.isRenderableObject()||(n.children.length?i+=e(n):(n.parent=null,t.children.splice(r--,1),i++))}return i}for(;e(this););},THREE.Object3D.prototype.onBeforeUpdateModelViewMatrix=function(e,t,i,r,n,o){},THREE.Object3D.prototype.hasBeforeRenderFunction=function(e){if(!this._beforeRenderFunctions)return!1;for(var t=0;t<this._beforeRenderFunctions.length;t++)if(this._beforeRenderFunctions[t].name==e)return!0;return!1},THREE.Object3D.prototype.addBeforeRenderFunction=function(e,t,i){if(t&&(this.traverseChild(function(r){r.isRenderableObject&&r.addBeforeRenderFunction(e,t,i)}),this._beforeRenderFunctions=this._beforeRenderFunctions||[],void 0!==i&&this._beforeRenderFunctions.length?this._beforeRenderFunctions.splice(i,0,{name:e,func:t}):this._beforeRenderFunctions.push({name:e,func:t}),1===this._beforeRenderFunctions.length)){var r=this.onBeforeRender;r&&"function () {}"!=r.toString()&&this._beforeRenderFunctions.splice(0,0,{name:"__originalBeforeRender__",func:r});var n=this;this.onBeforeRender=function(e,t,i,r,o,a){for(var s=0,l=n._beforeRenderFunctions.length;s<l;s++)n._beforeRenderFunctions[s].func.call(n,e,t,i,r,o,a)}}},THREE.Object3D.prototype.removeBeforeRenderFunction=function(e){this.traverseChild(function(t){t.isRenderableObject&&t.removeBeforeRenderFunction(e)}),this._beforeRenderFunctions=this._beforeRenderFunctions||[];for(var t=0;t<this._beforeRenderFunctions.length;t++){var i=this._beforeRenderFunctions[t];(Te.isFunction(e)?i.func:i.name)==e&&this._beforeRenderFunctions.splice(t--,1)}this._beforeRenderFunctions.length||(this.onBeforeRender=function(e,t,i){})},THREE.Object3D.prototype.setPickable=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];this.userData.skipPick=!e,t&&this.traverse(function(t){var i=t.userData;e?delete i.skipPick:i.skipPick=!0})},THREE.Object3D.prototype.getPickable=function(){return!this.userData.skipPick},THREE.Object3D.prototype.show=function(e){if(e)for(var t=this;t;)t.visible=!0,t=t.parent;else this.visible=e},THREE.Object3D.prototype.setLayerVisible=function(e){e?this.layers.enable(0):this.layers.disable(0)},THREE.Object3D.prototype.getLayerVisible=function(){return!!(1&this.layers.mask)},THREE.Object3D.prototype.ensureParentsVisible=function(e){var t=this;this.traverseParents(function(i){var r=i.visible;i.visible=e,!r&&e&&i.traverse(function(e){e==t||e.isChildOf(t)||e.ensureVisible(!1,!1)})})},THREE.Object3D.prototype.ensureVisible=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];if(void 0===e){if(this.userData.useVisibleOnly)return this.visible;for(var i=this;i;i=i.parent)if(!i.visible)return!1;return this.getLayerVisible()}if(!Te.isBoolean(e)){if(!this.userData.alwaysPickable)for(var r=this;r;){if(!r.visible)return!1;if(e&&!r.layers.test(e.layers))return!1;r=r.parent}return!0}var n=e;this.userData.useVisibleOnly?this.visible=n:(this.setLayerVisible(n),t&&(this.visible=n))},THREE.Object3D.prototype.traverseParents=function(e){if(e)for(var t=this.parent;t;t=t.parent)e(t)},THREE.Object3D.prototype.traverseChild=function(e){for(var t=this.children,i=0,r=t.length;i<r;i++)t[i].traverse(e)},THREE.Object3D.prototype.traverseBreakable=function(e){if(e(this))return this;for(var t=this.children,i=0,r=t.length;i<r;i++){var n=t[i].traverseBreakable(e);if(n)return n}return null},THREE.Object3D.prototype.traverseBranch=function(e){if(!1!==e(this))for(var t=this.children,i=0,r=t.length;i<r;i++)t[i].traverseBranch(e)},THREE.Object3D.prototype.traverseAll=function(e){e(this);for(var t=this.children,i=0,r=t.length;i<r;i++)t[i].traverseAll(e)},THREE.Object3D.prototype.traverseRenderableNodes=function(e){this.traverse(function(t){t.isRenderableObject()&&e(t)})},THREE.Object3D.prototype.getRoot=function(){var e=this.parent;if(!e)return this;for(;e.parent;)e=e.parent;return e},THREE.Object3D.prototype.indexOf=function(e){return e?this.children.indexOf(e):-1},THREE.Object3D.prototype.indexOfParent=function(){var e=this.parent;if(e)return e.children.indexOf(this)},THREE.Object3D.prototype.isChildOf=function(e){for(var t=this,i=t.parent;i;){if(-1===i.children.indexOf(t))return console.warn("Parent children does not contain it, please check children of parents"),!1;if(i==e)return!0;i=(t=i).parent}return!1},THREE.Object3D.prototype.getChildIndex=function(e){for(var t=0;t<this.children.length;t++)if(this.children[t]==e)return t;return-1},THREE.Object3D.prototype.getIndexPath=function(e){for(var t=[],i=this;i.parent;){var r=i.parent,n=r.getChildIndex(i);if(-1==n)break;if(t.push(n),r==e)break;i=r}return t},THREE.Object3D.prototype.getChildNodeByIndexPath=function(e){for(var t=this,i=0;i<e.length;i++){var r=e[i];if(r>=t.children.length)return null;t=t.children[r]}return t},THREE.Object3D.prototype.getChildNodesNumber=function(){var e=0;return this.traverse(function(){e++}),e},THREE.Object3D.prototype.getBones=function(e,t){for(var i=[],r=0;r<t.bones.length;r++){for(var n=t.bones[r].getIndexPath(e),o=this,a=n.length-1;0<=a;a--){var s=n[a];o=o.children[s]}i.push(o)}return i},THREE.Object3D.prototype._detach=function(e,t){this.applyMatrix(e.matrixWorld),e.remove(this),t.add(this)},THREE.Object3D.prototype._attach=function(e,t){this.applyMatrix((new THREE.Matrix4).getInverse(t.matrixWorld)),e.remove(this),t.add(this)},THREE.Object3D.prototype.attach=function(e,t,i){void 0===t?t=e:Te.isBoolean(t)&&(i=t,t=e),this.parent&&(i&&this.updateWorldMatrix(!0,!1),this._detach(this.parent,t)),e&&(i&&e.updateWorldMatrix(!0,!1),this._attach(t,e))},THREE.Object3D.prototype.detach=function(e){this.parent.updateMatrixWorld(),this._detach(this.parent,e)},THREE.Object3D.prototype.attachChildren=function(e,t){this.updateMatrixWorld();for(var i=0;i<e.length;i++)THREE.SceneUtils.attach(e[i],t,this)},THREE.Object3D.prototype.detachChildren=function(e){this.updateMatrixWorld();for(var t=this.children.concat(),i=0;i<t.length;i++)t[i]._detach(this,e);return t},THREE.Object3D.prototype.getChildrenNames=function(){var e=[];return this.traverse(function(t){t.name.isBlank()||e.push(t.name)}),e},THREE.Object3D.prototype.getVisibleChildrenNumber=function(){var e=0;return this.traverse(function(t){t.visible&&e++}),e},THREE.Object3D.prototype.getInvisibleChildrenNumber=function(){var e=0;return this.traverse(function(t){t.visible||e++}),e},THREE.Object3D.prototype.getParents=function(){for(var e=[],t=this.parent;t;t=t.parent)e.push(t);return e},THREE.Object3D.prototype.getInvalidNodes=function(){var e=[];return this.traverse(function(t){var i=t.scale;0!=i.x&&0!=i.y&&0!=i.z||e.push(t)}),e},THREE.Object3D.prototype.getGeometries=function(){var e=[];return this.traverse(function(t){var i=t.geometry;i&&e.push(i)}),e},THREE.Object3D.prototype.getVisibleMeshes=function(){var e=[];return this.traverse(function(t){t.isMesh&&t.ensureVisible&&e.push(t)}),e},THREE.Object3D.prototype.getMeshes=function(){var e=[];return this.traverse(function(t){t.isMesh&&e.push(t)}),e},THREE.Object3D.prototype.getSprites=function(){var e=[];return this.traverse(function(t){t.isSprite&&e.push(t)}),e},THREE.Object3D.prototype.getRenderableNodes=function(){var e=[];return this.traverse(function(t){t.isRenderableObject()&&e.push(t)}),e},THREE.Object3D.prototype.getTextures=function(){for(var e=this.getMaterials(),t=new Set,i=0;i<e.length;i++)for(var r=e[i],n=Object.keys(r),o=0;o<n.length;o++){var a=r[n[o]];a&&a.isTexture&&t.add(a)}return Array.from(t)},THREE.Object3D.prototype.getTexturesFromImage=function(e){for(var t=[],i=this.getTextures(),r=0;r<i.length;r++){var n=i[r];n.image==e&&t.push(n)}return t},THREE.Object3D.prototype.getTexturesFromURL=function(e){for(var t=[],i=this.getTextures(),r=0;r<i.length;r++){var n=i[r];n.image.currentSrc==e&&t.push(n)}return t},THREE.Object3D.prototype.traverseMaterials=function(e){this.traverse(function(t){var i=t.material;if(i)if(Te.isArray(i))for(var r=0;r<i.length;r++)e(i[r]);else e(i)})},THREE.Object3D.prototype.traverseTextures=function(e){this.traverse(function(t){var i=t.material;if(i)if(Te.isArray(i))for(var r=0;r<i.length;r++)for(var n in i[r])(o=i[r][n])&&o.isTexture&&e(i[r],n,o);else for(var n in i){var o;(o=i[n])&&o.isTexture&&e(i,n,o)}})},THREE.Object3D.prototype.getMaterials=function(){var e=new Set;return this.traverse(function(t){var i=t.material;if(i)if(Te.isArray(i))for(var r=0;r<i.length;r++)e.add(i[r]);else e.add(i)}),Array.from(e)},THREE.Object3D.prototype.getMeshByName=function(e){var t=null;return this.traverseBreakable(function(i){if(i.isMesh&&i.name==e)return t=i,!0}),t},THREE.Object3D.prototype.hasMesh=function(){var e=!1;return this.traverseBreakable(function(t){if(t.isMesh)return e=!0}),e},THREE.Object3D.prototype.getMeshNames=function(){var e=[];return this.traverse(function(t){t.isMesh&&e.push(t.name)}),e},THREE.Object3D.prototype.getSkinnedMeshes=function(){var e=[];return this.traverse(function(t){t.isSkinnedMesh&&e.push(t)}),e},THREE.Object3D.prototype.hasSkinnedMesh=function(){var e=!1;return this.traverseBreakable(function(t){if(t.isSkinnedMesh)return e=!0}),e},THREE.Object3D.prototype.hasSprite=function(){var e=!1;return this.traverseBreakable(function(t){if(t.isSprite)return e=!0}),e},THREE.Object3D.prototype.hasMaterial=function(e){if(!e)return!1;var t=!1;return this.traverseBreakable(function(i){if(i.material==e)return t=!0}),t},THREE.Object3D.prototype.hasGeometry=function(e){if(!e)return!1;var t=!1;return this.traverseBreakable(function(i){if(i.geometry==e)return t=!0}),t},THREE.Object3D.prototype.hasTexture=function(e){if(!e)return!1;function t(t){for(var i=Object.keys(t),r=0;r<i.length;r++){var n=t[i[r]];if(n&&n.isTexture&&n==e)return!0}return!1}var i=!1;return this.traverseBreakable(function(e){var r=e.material;if(r)if(Te.isArray(r)){if(t(r))return i=!0}else if(t(r))return i=!0}),i},THREE.Object3D.prototype.replace=function(e,t,i){if(t&&t.isObject3D)for(var r=0;r<this.children.length;r++){var n=this.children[r];if(n==e){i&&i(n),n=void 0,(t.parent=this).children[r]=t;break}}},THREE.Object3D.prototype.insert=function(e,t){e>this.children.length||t&&(this.children.splice(e,0,t),t.parent=this)},THREE.Object3D.prototype.removeBySelf=function(){this.parent&&this.parent.remove(this)},THREE.Object3D.prototype.getAngles=function(){return Te.parseAngles(this.rotation)},THREE.Object3D.prototype.setAngles=function(e){var t=Te.parseEuler(e);this.rotation.copy(t)},THREE.Object3D.prototype.getFacesNumber=function(){var e=0;return this.traverse(function(t){if(t.isMesh){var i=t.geometry;if(i.isBufferGeometry){var r=i.index;e+=r?r.count/3:i.attributes.position.count/3}else i.isGeometry&&(e+=i.faces.length)}}),e},THREE.Object3D.prototype.getVerticesNumber=function(){var e=0;return this.traverse(function(t){if(t.isMesh){var i=t.geometry;if(i.isBufferGeometry){var r=i.index;e+=r?i.index.count:i.attributes.position.count}else i.isGeometry&&(e+=i.vertices.length)}}),e},THREE.Object3D.prototype.getNodes=function(){var e=[];return this.traverse(function(t){e.push(t)}),e},THREE.Object3D.prototype.getNodeByID=function(e){var t;return this.traverseBreakable(function(i){if(i.id==e)return t=i,!0}),t},THREE.Object3D.prototype.getNodeByUUID=function(e){var t;return this.traverseBreakable(function(i){if(i.uuid==e)return t=i,!0}),t},THREE.Object3D.prototype.setTransform=function(e){var t=new THREE.Vector3,i=new THREE.Vector3,r=new THREE.Quaternion;e.decompose(t,r,i),this.quaternion.copy(r),this.position.copy(t),this.scale.copy(i)},THREE.Object3D.prototype.getDistanceFromCamera=function(e){if(this.parent){var t=new THREE.Vector3;return this.getWorldPosition(t),e.sub(t).length()}},THREE.Object3D.prototype.keepSize=function(e,t,i,r,n){if(this.parent){r&&this.updateWorldMatrix(!0,!1);var o=new THREE.Vector3;o.setFromMatrixPosition(this.matrixWorld);var a=e.sub(o).length();if(t.isVector2){var s=[i/t.x,i/t.y];this.scale.set(a/s[0],a/s[1],1)}else t.isVector3&&(s=[i/t.x,i/t.y,i/t.z],this.scale.set(a/s[0],a/s[1],a/s[2]));n&&this._synMatrixWorld()}},THREE.Object3D.prototype._synMatrixWorld=function(){this.updateWorldMatrix(!0,!0)},THREE.Object3D.prototype._getWorldPosition=function(e){return void 0===e&&(e=new THREE.Vector3),e.setFromMatrixPosition(this._getMatrixWorld())},THREE.Object3D.prototype._setWorldPosition=function(e,t,i){var r=e;this.parent&&(t&&this.parent.updateMatrixWorld(),r=this.parent.worldToLocal(e)),this.position.set(r.x,r.y,r.z),i&&this._synMatrixWorld()},THREE.Object3D.prototype._setWorldAngles=function(e,t){for(var i=this.parent;i;i=i.parent){var r=Te.parseQuaternion(i.rotation);r.inverse(),e.premultiply(r)}var n=Te.parseEuler(e);this.rotation.copy(n),t&&this._synMatrixWorld()},THREE.Object3D.prototype._setWorldScale=function(e,t){for(var i=this.parent;i;i=i.parent)e.divide(i.scale);this.scale.copy(e),t&&this._synMatrixWorld()},THREE.Object3D.prototype._getWorldScale=function(){this.updateWorldMatrix(!0,!1);var e=new THREE.Vector3,t=new THREE.Quaternion,i=new THREE.Vector3;return this.matrixWorld.decompose(e,t,i),i},THREE.Object3D.prototype.cloneByFilter=function(e){for(var t=this.clone(!1),i=0;i<this.children.length;i++){var r=this.children[i];if(!e||e(r)){var n=r.cloneByFilter(e);t.add(n)}}return t},THREE.Object3D.prototype.getForwardPosition=function(e){var t=new THREE.Vector3;return this.updateMatrixWorld(!0),this.getWorldDirection(t),t.normalize(),t.multiplyScalar(e),t.add(this.position),t},THREE.Object3D.prototype._faceTo=function(e){var t=this.worldToLocal(e.clone()),i=(new THREE.Vector3).crossVectors(new THREE.Vector3(0,0,1),t).normalize(),r=new THREE.Vector3(0,0,1).angleTo(t.normalize().clone());this.rotateOnAxis(i,r)},THREE.Object3D.prototype._lookAtPosition=function(e,t){var i=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],r=(e=e||{}).type,n=e.axis,o=e.quat,a=e.target,s=e.targetPosition;"axis"==r&&"y"==n?(e.billboard&&(this.rotation.x=0,this.rotation.z=0),this.rotation.y=Math.atan2(s.x-this.position.x,s.z-this.position.z)):(!i||a&&a.isCameraController?this.lookAt(s):this._faceTo(s),"axis"==r&&("x"==n?this.rotateY(-Math.PI/2):"z"==n&&this.rotateX(-Math.PI/2))),o&&this.quaternion.multiply(o),t?this._synMatrixWorld():this.updateWorldMatrix(!1,!1)},THREE.Object3D.prototype._lookAt=function(e,t){if(this.removeBeforeRenderFunction("__lookAt__"),e){var i=this;this.addBeforeRenderFunction("__lookAt__",function(r,n,o,a,s,l){var c=e.targetPosition||o;c.isObject3D&&(c=c.position),e.targetPosition=c,e.target={isCameraController:!0},i._lookAtPosition(e,Te.isFunction(t)?t():t)})}},THREE.Object3D.prototype.skipBoundingBox=function(e){this.traverse(function(t){e?t.userData.skipBoundingBox=e:delete t.userData.skipBoundingBox})},THREE.Object3D.prototype.setFrustumCulled=function(e){this.traverse(function(t){t.frustumCulled=e})},THREE.Object3D.prototype.getMatrixWorldFromRoot=function(e){this.updateWorldMatrix(!0);var t=new THREE.Matrix4;if(e)for(var i=this;;){if(i==e){t.premultiply(i.matrixWorld);break}t.premultiply(i.matrix),i=i.parent}return t},THREE.Object3D.prototype.getMatrixFromRoot=function(e){var t=new THREE.Matrix4;if(e)for(var i=this;i!=e;)t.premultiply(i.matrix),i=i.parent;return t},THREE.Matrix4.prototype.setScale=function(e){var t=this.elements;return t[0]=e.x,t[5]=e.y,t[10]=e.z,this},THREE.Euler.prototype.multiplyMatrix4=function(e){var t=new THREE.Quaternion;t.setFromEuler(this);var i=new THREE.Quaternion;i.setFromRotationMatrix(e),t.multiply(i),this.setFromQuaternion(t)},THREE.Euler.prototype.setRotationOrder=function(e){var t=new THREE.Quaternion;t.setFromEuler(this,!1),this.setFromQuaternion(t,e,!0)},THREE.Quaternion.prototype.multiplyMatrix4=function(e){var t=new THREE.Quaternion;t.setFromRotationMatrix(e),this.multiply(t)},THREE.Quaternion.prototype.getAngles=function(){return Te.parseAngles(this)},THREE.Frustum.prototype._intersectsObject=function(e){var t=this;return e.traverseBreakable(function(e){return e.isMesh&&t.intersectsObject(e)?e:null})},THREE.PerspectiveCamera.prototype.orthoSize=function(e,t){var i=Te.parseVector3(t),r=e.distanceTo(i),n=2*Math.tan(this.fov/2*Math.PI/180),o=n*r;return{x:o*this.aspect,y:o,depth:n,z:r}},THREE.OrthographicCamera.prototype.orthoSize=function(){return{x:(this.right-this.left)/this.zoom,y:(this.top-this.bottom)/this.zoom}},THREE.OrthographicCamera.prototype.resize=function(e,t){if(void 0!==this.userData){var i=this.userData.depth*this.userData.z,r=i*(e/t);this.left=-r/2,this.right=r/2,this.top=i/2,this.bottom=-i/2,this.updateProjectionMatrix()}},Object.defineProperty(THREE.CombinedCamera.prototype,"isPerspectiveCamera",{get:function(){return this.inPerspectiveMode}}),Object.defineProperty(THREE.CombinedCamera.prototype,"isOrthographicCamera",{get:function(){return this.inOrthographicMode}}),Object.defineProperty(THREE.CombinedCamera.prototype,"isLerping",{get:function(){return this.isPerspectiveLerping||this.isOrthoLerping}}),THREE.CombinedCamera.prototype.setNear=function(e){this.cameraP.near=e,this.cameraO.near=e,this.updateProjectionMatrix()},THREE.CombinedCamera.prototype.setFar=function(e){this.cameraP.far=e,this.cameraO.far=e,this.updateProjectionMatrix()},THREE.CombinedCamera.prototype.getProjectionMatrixAlways=function(){return this._backupProjectionMatrix&&(this.isOrthoLerping||this.isOrthographicCamera)?this._backupProjectionMatrix:this.projectionMatrix},THREE.CombinedCamera.prototype.toPerspectiveCamera=function(){var e=new THREE.CombinedCamera(1,1,1,1,1,1,1);return e.fov=this.fov,e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.cameraO=new THREE.OrthographicCamera(1,1,1,1,1,1),e.cameraO.copy(this.cameraO),e.cameraP=new THREE.PerspectiveCamera(1,1,1,1),e.cameraP.copy(this.cameraP),e.zoom=this.zoom,e.toPerspective(),e},THREE.CombinedCamera.prototype.toOrthoCamera=function(e,t){var i=this.cameraP.orthoSize(e,t),r=new THREE.CombinedCamera(i.x,i.y,this.fov,this.near,this.far,this.cameraO.near,this.cameraO.far);return r.orthoSize=i,r.toOrthographic(),r},THREE.CombinedCamera.prototype.lerpMatrix=function(e){var t=(e=e||{}).fromMatrix,i=e.toMatrix,r=e.time,n=e.lerpType||S.Quintic.Out,o=e.start,a=e.stop,s=e.complete,l=Te.toMatrixElementsArray(t),c=Te.toMatrixElementsArray(i);this.matrixTween&&this.matrixTween.stop(),this.matrixTween=new TWEEN.Tween(l).to(c,r).easing(n).onStart(function(){o&&o()}).onUpdate(function(){Te.elementsArrayToMatrix(t,this._object)}).onStop(function(){a&&a()}).onComplete(function(){s&&s()}).start()},THREE.CombinedCamera.prototype.lerpToOrthographic=function(e,t,i,r){var n=this.toOrthoCamera(e,t);this.orthoSize=n.orthoSize,this.zoom=1,this.isOrthoLerping=!0,this._backupProjectionMatrix=this.projectionMatrix.clone();var o=this;this.lerpMatrix({lerpType:S.Cubic.InOut,fromMatrix:this.projectionMatrix,toMatrix:n.projectionMatrix,time:i,stop:function(){o.isOrthoLerping=!1,r&&r()},complete:function(){o.isOrthoLerping=!1,o.toOrthographic(),r&&r()}})},THREE.CombinedCamera.prototype.lerpToPerspective=function(e,t){var i=this.toPerspectiveCamera();this.isPerspectiveLerping=!0;var r=this;this.lerpMatrix({fromMatrix:this.projectionMatrix,toMatrix:i.projectionMatrix,time:e,stop:function(){r.isPerspectiveLerping=!1,t&&t()},complete:function(){r.isPerspectiveLerping=!1,r.toPerspective(),t&&t()}})},THREE.CombinedCamera.prototype.getEffectiveFOV=function(){return this.cameraP.getEffectiveFOV()},THREE.CombinedCamera.prototype.isInView=function(e){var t=new THREE.Matrix4;t.multiplyMatrices(this.projectionMatrix,this.matrixWorldInverse);var i=new THREE.Frustum;return i.setFromMatrix(t),i.intersectsBox(e)},THREE.CombinedCamera.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&this.matrixWorld.copy(this.matrix);var t=Sa();t&&this.matrixWorld.premultiply(t),this.matrixWorldInverse.getInverse(this.matrixWorld)},THREE.Mesh.prototype.verticesCount=function(){return this.geometry?this.geometry.isBufferGeometry?this.geometry.attributes.position.count:this.geometry.vertices.length:0},THREE.Mesh.prototype.simplify=function(e){var t=j.clamp(e,0,1),i=new THREE.SimplifyModifier,r=this.geometry;r instanceof THREE.BufferGeometry&&(r=(new THREE.Geometry).fromBufferGeometry(r)),r.mergeVertices();var n=j.toInteger(r.vertices.length*(1-t)),o=i.modify(r,n);return new THREE.Mesh(o,this.material)},THREE.Mesh.prototype.getPerimeter=function(){var e=0,t=this.geometry.attributes;if(t){var i=t.position;if(i.count<2)return 0;for(var r=new THREE.Vector2(i.getX(0),i.getZ(0)),n=1;n<i.count;n++)e+=(a=new THREE.Vector2(i.getX(n),i.getZ(n))).distanceTo(r),r=a;e+=r.distanceTo(new THREE.Vector2(i.getX(0),i.getZ(0)))}else{var o=this.geometry.vertices;if(o.length<2)return 0;for(r=new THREE.Vector2(o[0].x,o[0].y),n=1;n<o.length;n++){var a;e+=(a=new THREE.Vector2(o[n].x,o[n].y)).distanceTo(r),r=a}e+=r.distanceTo(new THREE.Vector2(o[0].x,o[0].y))}return e},THREE.Mesh.prototype.getArea=function(){var e=[],t=this.geometry.attributes;if(t)for(var i=t.position,r=0;r<i.count;r++){var n=new THREE.Vector2(i.getX(r),i.getZ(r));e.push(n)}else{var o=this.geometry.vertices;for(r=0;r<o.length;r++)n=new THREE.Vector2(o[r].x,o[r].y),e.push(n)}var a=THREE.ShapeUtils.area(e);return Math.abs(a)},THREE.Mesh.prototype.getPoints=function(){var e=[],t=this.geometry.attributes;if(t)for(var i=t.position,r=0;r<i.count;r++)e.push([i.getX(r),i.getY(r),i.getZ(r)]);else{var n=this.geometry.vertices;if(n)for(r=0;r<n.length;r++){var o=n[r].clone();o.applyMatrix4(this.matrixWorld),e.push(o.toArray())}}return e},THREE.Mesh.prototype.getLabelPosition=function(e,t){var i=[];if(this.geometry.attributes)for(var r=this.geometry.attributes.position,n=0;n<r.count;n++)i.push([r.getX(n),r.getZ(n)]);else for(n=0;n<this.geometry.vertices.length;n++){var o=this.geometry.vertices[n];"xy"==t?i.push([o.x,o.y]):i.push([o.x,o.z])}if(!i.length)return null;var a=[];if(a.push(i),e&&0!=e.length)for(n=0;n<e.length;n++){var s=[e[n][0],e[n][1],e[n][2],e[n][3]];a.push(s)}var l,c=new polylabel(a);return l="xy"==t?this.localToWorld(new THREE.Vector3(c[0],c[1],0)):this.localToWorld(new THREE.Vector3(c[0],0,c[1])),this.getRayCastPosition(l)},THREE.Mesh.prototype.getAvaliableLabelPosition=function(e,t,i){var r=function(e,t,i){var r=e[0],n=t[0],o=e[1],a=t[1],s=Math.max(r,i.l);if(n<s||s>i.r)return!1;var l=Math.min(n,i.r);if(l<r||l<i.l)return!1;var c=Math.max(o,i.t);if(a<c||c>i.b)return!1;var u=Math.min(a,i.b);return!(u<o||u<i.t)},n=function(e,t,i,n,o){for(var a=i.x,s="xy"==o?i.y:i.z,l=[a-n[0],s-n[1]],c=[a+n[0],s+n[1]],u=0;u<e.length;u++){var h=e[u],p=t[u],d=h.x,f="xy"==o?h.y:h.z,m=p[0]/2,g=p[1]/2;if(r(l,c,{l:d-m,t:f-g,r:d+m,b:f+g}))return!0}return!1};this.updateMatrixWorld();var o=new THREE.Matrix4;if(o.getInverse(this.matrixWorld),i&&i.length&&i.length%4)return console.error("The hole points number must arrange by 4"),null;for(var a=[],s=0;s<i.length;s+=4){var l=Te.parseVector3(i[s]).applyMatrix4(o),c=Te.parseVector3(i[s+1]).applyMatrix4(o),u=Te.parseVector3(i[s+2]).applyMatrix4(o),h=Te.parseVector3(i[s+3]).applyMatrix4(o);l=[l.x,l.z],c=[c.x,c.z],u=[u.x,u.z],h=[h.x,h.z],a.push([l,c,u,h])}var p=[],d=[];for(s=0;s<e.length;s++){var f=e[s],m=f[0]/2,g=f[1]/2;if(0!=m&&0!=g){var v=this.getLabelPosition(a,t);if(!v)break;var y=v.clone();y.applyMatrix4(o),n(p,e,y,[m,g],t)||(d.push(v),p.push(y));var b=y.x,_="xy"==t?y.y:y.z;l=[b-m,_-g],c=[b+m,_-g],u=[b+m,_+g],h=[b-m,_+g],a.push([l,c,u,h])}}return d},THREE.Mesh.prototype.getRayCastPosition=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1e3;this.updateMatrixWorld();var i=new THREE.Vector3,r=new THREE.Vector3(0,1,0),n=this.position.clone();i.copy(r).applyQuaternion(this.quaternion),n.add(i.multiplyScalar(t)),n.applyMatrix4(this.matrixWorld);var o=new THREE.Vector3,a=new THREE.Vector3(0,-1,0),s=this.position.clone();o.copy(a).applyQuaternion(this.quaternion),s.add(o.multiplyScalar(t)),s.applyMatrix4(this.matrixWorld);var l=new THREE.Vector3;l.subVectors(s,n),l.normalize();var c=e.clone();c.add(l.clone().multiplyScalar(-t));var u=new THREE.Raycaster;u.ray.origin.copy(c),u.ray.direction.copy(l);var h=u.intersectObjectForcible(this,!0);return h.length?h[0].point:null},THREE.Mesh.prototype.raycast=function(){var e=new THREE.Matrix4,t=new THREE.Ray,i=new THREE.Sphere,r=new THREE.Vector3,n=new THREE.Vector3,o=new THREE.Vector3,a=new THREE.Vector3,s=new THREE.Vector3,l=new THREE.Vector3,c=new THREE.Vector2,u=new THREE.Vector2,h=new THREE.Vector2,p=new THREE.Vector3,d=new THREE.Vector3,f=new THREE.Vector3;function m(e,t,i,r,n,o,a){return THREE.Triangle.getBarycoord(e,t,i,r,p),n.multiplyScalar(p.x),o.multiplyScalar(p.y),a.multiplyScalar(p.z),n.add(o).add(a),n.clone()}function g(e,t,i,r,n,o,a,s){if(null===(t.side===THREE.BackSide?r.intersectTriangle(a,o,n,!0,s):r.intersectTriangle(n,o,a,t.side!==THREE.DoubleSide,s)))return null;f.copy(s),f.applyMatrix4(e.matrixWorld);var l=i.ray.origin.distanceTo(f);return l<i.near||l>i.far?null:{distance:l,point:f.clone(),object:e}}function v(e,t,i,a,s,l,p,f){r.fromBufferAttribute(a,l),n.fromBufferAttribute(a,p),o.fromBufferAttribute(a,f);var v=g(e,e.material,t,i,r,n,o,d);if(v){s&&(c.fromBufferAttribute(s,l),u.fromBufferAttribute(s,p),h.fromBufferAttribute(s,f),v.uv=m(d,r,n,o,c,u,h));var y=new THREE.Face3(l,p,f);THREE.Triangle.getNormal(r,n,o,y.normal),v.face=y,v.faceIndex=l}return v}return function(p,f){var y,b=this.geometry,_=this.material,x=this.matrixWorld;if(void 0!==_&&(null===b.boundingSphere&&b.computeBoundingSphere(),i.copy(b.boundingSphere),i.applyMatrix4(x),!1!==p.ray.intersectsSphere(i)&&(e.getInverse(x),t.copy(p.ray).applyMatrix4(e),null===b.boundingBox||!1!==t.intersectsBox(b.boundingBox))))if(b.isBufferGeometry){var E,w,T,S,M=b.index,R=b.attributes.position,P=b.attributes.uv;if(null!==M)for(S=0,C=M.count;S<C;S+=3)E=M.getX(S),w=M.getX(S+1),T=M.getX(S+2),(y=v(this,p,t,R,P,E,w,T))&&(y.faceIndex=Math.floor(S/3),f.push(y));else if(void 0!==R){var A=this.drawMode===THREE.TriangleStripDrawMode,C=Math.min(b.drawRange.count,R.count)-Math.max(b.drawRange.start,0),O=A?1:3;for(A&&(C-=2),S=0;S<C;S+=O)(y=v(this,p,t,R,P,E=S,w=S+1,T=S+2))&&f.push(y)}}else if(b.isGeometry){var L,k,H,j,F=Array.isArray(_),D=b.vertices,B=b.faces,I=b.faceVertexUvs[0];0<I.length&&(j=I);for(var N=0,U=B.length;N<U;N++){var V=B[N],z=F?_[V.materialIndex]:_;if(void 0!==z){if(L=D[V.a],k=D[V.b],H=D[V.c],!0===z.morphTargets){var q=b.morphTargets,W=this.morphTargetInfluences;r.set(0,0,0),n.set(0,0,0),o.set(0,0,0);for(var G=0,X=q.length;G<X;G++){var Y=W[G];if(0!==Y){var Q=q[G].vertices;r.addScaledVector(a.subVectors(Q[V.a],L),Y),n.addScaledVector(s.subVectors(Q[V.b],k),Y),o.addScaledVector(l.subVectors(Q[V.c],H),Y)}}r.add(L),n.add(k),o.add(H),L=r,k=n,H=o}if(y=g(this,z,p,t,L,k,H,d)){if(j&&j[N]){var Z=j[N];c.copy(Z[0]),u.copy(Z[1]),h.copy(Z[2]),y.uv=m(d,L,k,H,c,u,h)}y.face=V,y.faceIndex=N,f.push(y)}}}}}}(),THREE.Raycaster.prototype.clone=function(){return new THREE.Raycaster(this.ray.origin.clone(),this.ray.direction.clone())},THREE.Raycaster.prototype._intersectObjectForcible=function(e,t,i,r){if(e.raycast(t,i),!0===r)for(var n=e.children,o=0,a=n.length;o<a;o++)this._intersectObjectForcible(n[o],t,i,!0)},THREE.Raycaster.prototype.intersectObjectForcible=function(e,t,i){var r=i||[];return this._intersectObjectForcible(e,this,r,t),r.sort(function(e,t){return e.distance-t.distance}),r},THREE.Raycaster.prototype.intersectEnsureVisibleObject=function(e,t,i,r,n){if(!1!==e.ensureVisible(n)&&(e.raycast(t,i),!0===r))for(var o=e.children,a=0,s=o.length;a<s;a++)this.intersectEnsureVisibleObject(o[a],t,i,!0,n)},THREE.Raycaster.prototype.intersectEnsureVisibleObjects=function(e,t,i,r){if(!1===Array.isArray(t))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),e;for(var n=0,o=t.length;n<o;n++)this.intersectEnsureVisibleObject(t[n],this,e,i,r);return e.sort(function(e,t){return e.distance-t.distance}),e},THREE.Raycaster.prototype.intersectCollisionObjects=function(e,t,i){var r=[];return function e(t,i,r,n,o){if(!1!==t.visible&&t.layers.test(n.layers)){t.raycast(i,r);for(var a=t.children,s=0,l=a.length;s<l;s++)e(a[s],i,r,n,o)}}(e,this,r,t,i),r.sort(ascSort),r},THREE.Geometry.prototype.genFaceVertexUVs=function(){this.computeFaceNormals(),this.computeVertexNormals(),this.computeBoundingBox();for(var e=this.boundingBox.max,t=this.boundingBox.min,i=new THREE.Vector2(0-t.x,0-t.y),r=new THREE.Vector2(e.x-t.x,e.y-t.y),n=this.faces,o=[],a=0;a<n.length;a++){var s=this.vertices[n[a].a],l=this.vertices[n[a].b],c=this.vertices[n[a].c],u=new THREE.Vector2((s.x+i.x)/r.x,(s.y+i.y)/r.y),h=new THREE.Vector2((l.x+i.x)/r.x,(l.y+i.y)/r.y),p=new THREE.Vector2((c.x+i.x)/r.x,(c.y+i.y)/r.y);o.push([u,h,p])}for(a=0;a<this.faceVertexUvs.length;a++)this.faceVertexUvs[a]=o.concat();this.uvsNeedUpdate=!0,this.elementsNeedUpdate=!0},THREE.Scene.prototype.verticesCount=function(){var e=0;return this.traverse(function(t){t.isMesh&&(e+=t.verticesCount())}),e},THREE.AnimationMixer.prototype.isRunning=function(e){for(var t=this._actions,i=this._nActiveActions,r=0;r!==i;++r){var n=t[r];if(e){var o=n.getClip();if(o&&e!=o.name)continue}if(n.isRunning())return!0}return!1},THREE.AnimationMixer.prototype.log=function(){for(var e=this.stats,t=0;t<this._actions.length;t++){var i=this._actions[t],r=i.getClip(),n=i.getEffectiveWeight();0!=n&&console.log("action: [name: "+r.name+", weight: "+n+"]")}console.log("action: "+e.actions.inUse+"/"+e.actions.total),console.log("bindings: "+e.bindings.inUse+"/"+e.bindings.total),console.log("controlInterpolants: "+e.controlInterpolants.inUse+"/"+e.controlInterpolants.total)},THREE.Material.prototype._isCloned=function(){return!!this._origin_material},THREE.Material.prototype._getOriginal=function(){return this._origin_material||this},THREE.Material.prototype._getPrevMaterial=function(){return this._prev_material||this._getOriginal()},THREE.Material.prototype._pushAndCloneSelf=function(){var e=this.clone();return e._origin_material=this._getOriginal(),e._prev_material=this,e},THREE.Material.prototype._pop=function(){var e=this.__materialsQueue__;if(e&&e.length){for(;e.length;)e[e.length-1].dispose(),e.splice(e.length-1,1);e.length||delete this.__materialsQueue__}},THREE.Material.prototype.copy=function(e){this.name=e.name,this.fog=e.fog,this.lights=e.lights,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.userData=JSON.parse(JSON.stringify(e.userData)),this.defines=void 0!==e.defines?JSON.parse(JSON.stringify(e.defines)):void 0,this.__texture=e.__texture,this.clipShadows=e.clipShadows,this.clipIntersection=e.clipIntersection;var t=e.clippingPlanes,i=null;if(null!==t){var r=t.length;i=new Array(r);for(var n=0;n!==r;++n)i[n]=t[n].clone()}return this.clippingPlanes=i,this.shadowSide=e.shadowSide,this.onBeforeCompile=e.onBeforeCompile,this.colorMapping=e.colorMapping,this},THREE.MeshStandardMaterial.prototype.copy=function(e){return THREE.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},THREE.Box3.prototype.getIntersection=function(e){var t=new THREE.Box3;return this.intersectsBox(e)&&(t.min.x=Math.max(this.min.x,e.min.x),t.max.x=Math.min(this.max.x,e.max.x),t.min.y=Math.max(this.min.y,e.min.y),t.max.y=Math.min(this.max.y,e.max.y),t.min.z=Math.max(this.min.z,e.min.z),t.max.z=Math.min(this.max.z,e.max.z)),t},THREE.Box3.prototype._setFromObject=function(e,t){var i=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;this.makeEmpty(),e.updateWorldMatrix(!0,!0);var n=new THREE.Vector3,o=this,a=!1,s=function(e){if(!e.isLight&&!e.userData.skipBoundingBox){var i=e.geometry;if(void 0!==i&&(!r||!1!==r(e))){if(i.isGeometry)for(var s=i.vertices,l=0,c=s.length;l<c;l++)n.copy(s[l]),n.applyMatrix4(e.matrixWorld),t&&n.applyMatrix4(t),o.expandByPoint(n,e);else if(i.isBufferGeometry){var u=i.attributes.position;if(void 0!==u){var h=i.index?i.index.array:null;for(l=i.drawRange.start,c=i.drawRange.count!=1/0?i.drawRange.count:h?h.length:u.count;l<c;l++)h?n.fromBufferAttribute(u,h[l]):n.fromBufferAttribute(u,l),n.applyMatrix4(e.matrixWorld),t&&n.applyMatrix4(t),o.expandByPoint(n,e)}}a=!0}}};if(i?e.traverseVisible(s):e.traverse(s),!a){var l=new THREE.Vector3;e.getWorldPosition(l),this.expandByPoint(l)}return this},THREE.Box3.prototype.getBoundingPositions=function(){var e=this.min,t=this.max;return[new THREE.Vector3(e.x,e.y,e.z),new THREE.Vector3(t.x,e.y,e.z),new THREE.Vector3(e.x,e.y,t.z),new THREE.Vector3(t.x,e.y,t.z),new THREE.Vector3(e.x,t.y,e.z),new THREE.Vector3(t.x,t.y,e.z),new THREE.Vector3(e.x,t.y,t.z),new THREE.Vector3(t.x,t.y,t.z)]},THREE.ShaderLib.normal.vertexShader=THREE.ShaderLib.normal.vertexShader.replace("#include <logdepthbuf_pars_vertex>","#include <logdepthbuf_pars_vertex> \n"+THREE.ShaderChunk.clipping_planes_pars_vertex),THREE.ShaderLib.normal.vertexShader=THREE.ShaderLib.normal.vertexShader.replace("#include <logdepthbuf_vertex>","#include <logdepthbuf_vertex> \n"+THREE.ShaderChunk.clipping_planes_vertex),THREE.ShaderLib.normal.fragmentShader=THREE.ShaderLib.normal.fragmentShader.replace("#include <logdepthbuf_pars_fragment>","#include <logdepthbuf_pars_fragment> \n"+THREE.ShaderChunk.clipping_planes_pars_fragment),THREE.ShaderLib.normal.fragmentShader=THREE.ShaderLib.normal.fragmentShader.replace("void main() {","void main() { \n"+THREE.ShaderChunk.clipping_planes_fragment),THREE.ShaderChunk.map_fragment=["","#ifdef USE_MAP","#ifdef USE_DIFFUSE_UV2","vec4 texelColor = texture2D( map, vUv2 );","#else","vec4 texelColor = texture2D( map, vUv );","#endif","texelColor = mapTexelToLinear( texelColor );","diffuseColor *= texelColor;","#endif",""].join("\n"),THREE.ShaderChunk.alphamap_fragment=["","#ifdef USE_ALPHAMAP","#ifdef USE_ALPHAMAP_REVERSE","diffuseColor.a *= 1.0 - texture2D( alphaMap, vUv3).g;","#else","diffuseColor.a *= texture2D( alphaMap, vUv3).g;","#endif","#endif",""].join("\n"),THREE.ShaderChunk.uv2_pars_fragment=["","#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP ) || defined (USE_DIFFUSE_UV2)","varying vec2 vUv2;","#endif","#ifdef USE_ALPHAMAP","varying vec2 vUv3;","#endif","#ifdef USE_EMISSIVEMAP","varying vec2 vUv4;","#endif",""].join("\n"),THREE.ShaderChunk.uv2_pars_vertex=["","#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP ) || defined( USE_ALPHA_UV2 ) || defined (USE_DIFFUSE_UV2)","attribute vec2 uv2;","#endif","#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP ) || defined (USE_DIFFUSE_UV2)","varying vec2 vUv2;","#endif","#ifdef USE_ALPHAMAP","#ifdef USE_ALPHA_UV3","attribute vec2 uv3;","#endif","varying vec2 vUv3;","uniform mat3 uvTransform1;","#endif","#ifdef USE_EMISSIVEMAP","#ifdef USE_ALPHA_UV3","attribute vec2 uv3;","#endif","varying vec2 vUv4;","uniform mat3 uvTransform2;","#endif",""].join("\n"),THREE.ShaderChunk.uv2_vertex=["#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP ) || defined (USE_DIFFUSE_UV2)","#if defined(USE_DIFFUSE_UV2) && defined(USE_MAP)","vUv2 = (uvTransform * vec3(uv2, 1.0)).xy;","#else","vUv2 = uv2;","#endif","#endif","#ifdef USE_ALPHAMAP","vUv3 = (uvTransform1 * vec3(uv, 1.0)).xy;","#ifdef USE_ALPHA_UV2","vUv3 = (uvTransform1 * vec3(uv2, 1.0)).xy;","#endif","#ifdef USE_ALPHA_UV3","vUv3 = (uvTransform1 * vec3(uv3, 1.0)).xy;","#endif","#endif","#ifdef USE_EMISSIVEMAP","#ifndef USE_EMISSIVETRANSFORM","mat3 emissiveTransform = uvTransform;","#else","mat3 emissiveTransform = uvTransform2;","#endif","vUv4 = (emissiveTransform * vec3(uv, 1.0)).xy;","#ifdef USE_ALPHA_UV2","vUv4 = (emissiveTransform * vec3(uv2, 1.0)).xy;","#endif","#ifdef USE_ALPHA_UV3","vUv4 = (emissiveTransform * vec3(uv3, 1.0)).xy;","#endif","#endif",""].join("\n"),THREE.ShaderChunk.color_pars_vertex+=["","#ifdef USE_ALPHAINDEX","attribute float alphaIndex;","varying float vAlpha;","#endif",""].join("\n"),THREE.ShaderChunk.color_vertex+=["","#ifdef USE_ALPHAINDEX","vAlpha = alphaIndex;","#endif",""].join("\n"),THREE.ShaderChunk.color_pars_fragment+=["","#ifdef USE_ALPHAINDEX","varying float vAlpha;","#endif",""].join("\n"),THREE.ShaderChunk.color_fragment+=["","#ifdef USE_ALPHAINDEX","diffuseColor.a *= vAlpha;","#endif",""].join("\n"),["sprite","basic"].forEach(function(e){var t=THREE.ShaderLib[e];t.vertexShader=t.vertexShader.replace("#include <clipping_planes_pars_vertex>","\n\t#include <clipping_planes_pars_vertex>\n\t#ifdef USE_GPUPICKER\n\t\tuniform float baseId;\n\t\tvarying vec4 worldId;\n\t#endif\n\t"),t.vertexShader=t.vertexShader.replace("#include <fog_vertex>","\n\t#include <fog_vertex>\n\t#ifdef USE_GPUPICKER\n\t\tvec3 a = fract(vec3(1.0/255.0, 1.0/(255.0*255.0), 1.0/(255.0*255.0*255.0)) * baseId);\n\t\ta -= a.xxy * vec3(0.0, 1.0/255.0, 1.0/255.0);\n\t\tworldId = vec4(a,1);\n\t#endif\n\t"),t.fragmentShader=t.fragmentShader.replace("#include <clipping_planes_pars_fragment>","\n\t#include <clipping_planes_pars_fragment>\n\t#ifdef USE_GPUPICKER\n\t\tvarying vec4 worldId;\n\t#endif\n\t"),t.fragmentShader=t.fragmentShader.replace("#include <fog_fragment>","\n\t#include <fog_fragment>\n\t#ifdef USE_GPUPICKER\n\t\tgl_FragColor = worldId;\n\t#endif\n\t"),t.fragmentShader=t.fragmentShader.replace("#include <clipping_planes_fragment>","\n\t#ifdef USE_MAP\n\t\t#ifdef USE_UV_DISCARD\n\t\t\tif (vUv.x < 0. || vUv.x > 1. || vUv.y < 0. || vUv.y > 1.) discard;\n\t\t#endif\n\t#endif\n\t#include <clipping_planes_fragment>\n\t")}),THREE.ShaderChunk.aomap_fragment="\n\t#ifdef USE_AOMAP\n\t\t#ifdef WALL_AO\n\t\t\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity * 0.5 + 1.5;\n\t\t#else\n\t\t\t#ifdef FLOOR_AO\n\t\t\t\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.1;\n\t\t\t#else\n\t\t\t\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity * 1.5 + 1.45;\n\t\t\t#endif\n\t\t#endif\n\t\t// reflectedLight.indirectDiffuse *= ambientOcclusion;\n\t\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t\t#endif\n\t#endif\n",THREE.ShaderChunk.emissivemap_fragment="\n\t#ifdef USE_EMISSIVEMAP\n\n\t\tvec4 emissiveColor = texture2D( emissiveMap, vUv4 );\n\n\t\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\n\t\ttotalEmissiveRadiance *= emissiveColor.rgb;\n\n\t#endif\n\n\t#ifdef STANDARD\n\t\ttotalEmissiveRadiance = vec3(0.0,0.0,0.0);\n\t\tvec3 newEmissiveColor = emissive;\n\t\t#ifdef USE_EMISSIVEMAP\n\t\t\tnewEmissiveColor = emissive * emissiveColor.rgb;\n\t\t\t#ifdef USE_SIDE_EMISSIVE\n\t\t\t\tnewEmissiveColor *= newEmissiveColor * (1. - abs(dot( inverseTransformDirection( normal, viewMatrix ), vec3(0., 1., 0.) )));\n\t\t\t#endif\n\t\t#endif\n\t#endif\n",THREE.ShaderChunk.encodings_fragment=["gl_FragColor = linearToOutputTexel( gl_FragColor );","#ifdef USE_AOMAP","gl_FragColor.rgb *= ambientOcclusion;","#endif","#ifdef STANDARD","gl_FragColor.rgb += newEmissiveColor;","#endif"].join("\n"),THREE.ShaderChunk.tonemapping_fragment=["#if defined( TONE_MAPPING ) && defined(STANDARD)","gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );","#endif"].join("\n"),THREE.ShaderLib.lambert={uniforms:THREE.ShaderLib.lambert.uniforms,vertexShader:"\n\t\t#define LAMBERT\n\n\t\t#ifdef INSTANCED\n\t\t\tattribute vec3 instancePosition;\n\t\t\tattribute vec4 instanceQuaternion;\n\t\t\tattribute vec3 instanceScale;\n\t\t\tattribute vec3 instanceColor;\n\n\t\t\tmat4 compose(vec3 position, vec4 quaternion, vec3 scale) {\n\t\t\t\tfloat x = quaternion.x, y = quaternion.y, z = quaternion.z, w = quaternion.w;\n\t\t\t\tfloat x2 = x + x,  y2 = y + y,  z2 = z + z;\n\t\t\t\tfloat xx = x * x2, xy = x * y2, xz = x * z2;\n\t\t\t\tfloat yy = y * y2, yz = y * z2, zz = z * z2;\n\t\t\t\tfloat wx = w * x2, wy = w * y2, wz = w * z2;\n\n\t\t\t\tfloat sx = scale.x, sy = scale.y, sz = scale.z;\n\n\t\t\t\treturn mat4(( 1. - ( yy + zz ) ) * sx, ( xy + wz ) * sx, ( xz - wy ) * sx, 0.,\n\t\t\t\t\t( xy - wz ) * sy, ( 1. - ( xx + zz ) ) * sy, ( yz + wx ) * sy, 0.,\n\t\t\t\t\t( xz + wy ) * sz, ( yz - wx ) * sz, ( 1. - ( xx + yy ) ) * sz, 0.,\n\t\t\t\t\tposition.x, position.y, position.z, 1.\n\t\t\t\t);\n\t\t\t}\n\t\t#endif\n\n\t\tvarying vec3 vLightFront;\n\t\tvarying vec3 vIndirectFront;\n\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvarying vec3 vLightBack;\n\t\t\tvarying vec3 vIndirectBack;\n\t\t#endif\n\n\t\t#include <common>\n\t\t#include <uv_pars_vertex>\n\t\t#include <uv2_pars_vertex>\n\t\t#include <envmap_pars_vertex>\n\t\t#include <bsdfs>\n\t\t#include <lights_pars_begin>\n\t\t#include <color_pars_vertex>\n\t\t#include <fog_pars_vertex>\n\t\t#include <morphtarget_pars_vertex>\n\t\t#include <skinning_pars_vertex>\n\t\t#include <shadowmap_pars_vertex>\n\t\t#include <logdepthbuf_pars_vertex>\n\t\t#include <clipping_planes_pars_vertex>\n\n\t\tvoid main() {\n\n\t\t\t#include <uv_vertex>\n\t\t\t#include <uv2_vertex>\n\t\t\t#include <color_vertex>\n\n\t\t\t// vertex colors instanced\n\t\t\t#ifdef INSTANCED\n\t\t\t\t#ifdef USE_COLOR\n\t\t\t\t\tvColor.xyz = instanceColor.xyz;\n\t\t\t\t#endif\n\t\t\t#endif\n\n\t\t\t#include <beginnormal_vertex>\n\t\t\t#include <morphnormal_vertex>\n\t\t\t#include <skinbase_vertex>\n\t\t\t#include <skinnormal_vertex>\n\n\t\t\t// normal instanced\n\t\t\t#ifdef INSTANCED\n\t\t\t\tmat4 instanceMat = compose(instancePosition, instanceQuaternion, instanceScale);\n\t\t\t\tobjectNormal = ( transpose(inverse(instanceMat)) * vec4(objectNormal, 0.0) ).xyz;\n\t\t\t#endif\n\n\t\t\t#include <defaultnormal_vertex>\n\n\t\t\t#include <begin_vertex>\n\n\t\t\t// position instanced\n\t\t\t#ifdef INSTANCED\n\t\t\t\ttransformed.xyz = (instanceMat * vec4(transformed, 1.0)).xyz;\n\t\t\t#endif\n\n\t\t\t#include <morphtarget_vertex>\n\t\t\t#include <skinning_vertex>\n\t\t\t#include <project_vertex>\n\t\t\t#include <logdepthbuf_vertex>\n\t\t\t#include <clipping_planes_vertex>\n\n\t\t\t#include <worldpos_vertex>\n\t\t\t#include <envmap_vertex>\n\t\t\t#include <lights_lambert_vertex>\n\t\t\t#include <shadowmap_vertex>\n\t\t\t#include <fog_vertex>\n\n\t\t}\n\t\t",fragmentShader:THREE.ShaderLib.lambert.fragmentShader},THREE.ShaderLib.depth={uniforms:THREE.ShaderLib.depth.uniforms,vertexShader:"\n\t\t#ifdef INSTANCED\n\t\t\tattribute vec3 instancePosition;\n\t\t\tattribute vec4 instanceQuaternion;\n\t\t\tattribute vec3 instanceScale;\n\n\t\t\tmat4 compose(vec3 position, vec4 quaternion, vec3 scale) {\n\t\t\t\tfloat x = quaternion.x, y = quaternion.y, z = quaternion.z, w = quaternion.w;\n\t\t\t\tfloat x2 = x + x,  y2 = y + y,  z2 = z + z;\n\t\t\t\tfloat xx = x * x2, xy = x * y2, xz = x * z2;\n\t\t\t\tfloat yy = y * y2, yz = y * z2, zz = z * z2;\n\t\t\t\tfloat wx = w * x2, wy = w * y2, wz = w * z2;\n\n\t\t\t\tfloat sx = scale.x, sy = scale.y, sz = scale.z;\n\n\t\t\t\treturn mat4(( 1. - ( yy + zz ) ) * sx, ( xy + wz ) * sx, ( xz - wy ) * sx, 0.,\n\t\t\t\t\t( xy - wz ) * sy, ( 1. - ( xx + zz ) ) * sy, ( yz + wx ) * sy, 0.,\n\t\t\t\t\t( xz + wy ) * sz, ( yz - wx ) * sz, ( 1. - ( xx + yy ) ) * sz, 0.,\n\t\t\t\t\tposition.x, position.y, position.z, 1.\n\t\t\t\t);\n\t\t\t}\n\t\t#endif\n\n\t\t#include <common>\n\t\t#include <uv_pars_vertex>\n\t\t#include <displacementmap_pars_vertex>\n\t\t#include <morphtarget_pars_vertex>\n\t\t#include <skinning_pars_vertex>\n\t\t#include <logdepthbuf_pars_vertex>\n\t\t#include <clipping_planes_pars_vertex>\n\n\t\tvoid main() {\n\n\t\t\t#include <uv_vertex>\n\n\t\t\t#include <skinbase_vertex>\n\n\t\t\t#ifdef USE_DISPLACEMENTMAP\n\n\t\t\t\t#include <beginnormal_vertex>\n\t\t\t\t#include <morphnormal_vertex>\n\t\t\t\t#include <skinnormal_vertex>\n\n\t\t\t#endif\n\n\t\t\t#include <begin_vertex>\n\n\t\t\t// position instanced\n\t\t\t#ifdef INSTANCED\n\t\t\t\tmat4 instanceMat = compose(instancePosition, instanceQuaternion, instanceScale);\n\t\t\t\ttransformed.xyz = (instanceMat * vec4(transformed, 1.0)).xyz;\n\t\t\t#endif\n\n\t\t\t#include <morphtarget_vertex>\n\t\t\t#include <skinning_vertex>\n\t\t\t#include <displacementmap_vertex>\n\t\t\t#include <project_vertex>\n\t\t\t#include <logdepthbuf_vertex>\n\t\t\t#include <clipping_planes_vertex>\n\n\t\t}\n\t",fragmentShader:THREE.ShaderLib.depth.fragmentShader};var Ra=function(){function e(t){r(this,e);var i=t.image,n=t.backgroundImage,o=t.opacity||.8,a=new THREE.SpriteMaterial({map:THREE.ImageUtils.loadTexture(i),opacity:o,transparent:!0}),s=null;this.spriteBg=null,""!=n&&(s=new THREE.SpriteMaterial({map:THREE.ImageUtils.loadTexture(n),opacity:o,transparent:!0})),this._position=null,this._uiPosition=[1,1],Object.defineProperty(this,"position",{get:function(){return this._position},set:function(e){if(Te.isNumber(e))switch(this._position=e,this._position){case M.LeftTop:this._uiPosition=[-1,-1];break;case M.RightTop:this._uiPosition=[1,-1];break;case M.LeftBottom:this._uiPosition=[-1,1];break;case M.RightBottom:this._uiPosition=[1,1]}return this._position}}),null!=t.position?this.position=t.position:this.position=M.RightBottom,this.size=t.size||50,this.offset=t.offset||[0,0],this.sprite=new THREE.Sprite(a),this.sprite.scale.set(this.size,this.size,1),null!=s&&(this.spriteBg=new THREE.Sprite(s),this.spriteBg.scale.set(this.size,this.size,1))}return e.prototype.onUpdate=function(){var e=this.app.mainUI.getRenderPosition(this._uiPosition,[this.size,this.size]);null!=this.spriteBg&&this.spriteBg.position.set(e[0]+this.offset[0],e[1]+this.offset[1],-10),this.sprite.position.set(e[0]+this.offset[0],e[1]+this.offset[1],-10),this.sprite.material.rotation=-this.app.renderCamera.rotation._z},e.prototype.onAdd=function(e){this.app=e,null!=this.spriteBg&&this.app.mainUI.scene2D.add(this.spriteBg),this.app.mainUI.scene2D.add(this.sprite)},e.prototype.onRemove=function(){null!=this.spriteBg&&this.app.mainUI.scene2D.remove(this.spriteBg),this.app.mainUI.scene2D.remove(this.sprite)},e}(),Pa=function(){function e(t){r(this,e),this._controls=null}return e.prototype.onResize=function(){},e.prototype.onUpdate=function(){this._controls&&(this._controls.update(this.app._deltaTime),this.app.needUpdate=!0)},e.prototype.onAdd=function(e){(this.app=e).camera.inputEnabled=!1,this._controls||(this._controls=new THREE.FreeMouseControls(e.renderCamera),this._controls.movementSpeed=.25),this._controls.enabled=!0},e.prototype.onRemove=function(){this.app.camera.inputEnabled=!0,this._controls&&(this._controls.dispose(),this._controls.enabled=!1,this._controls=null)},e}();function Aa(e){return e instanceof qe?e.getNodes():(Array.isArray(e)&&console.warn("[WalkControl/WalkButtronControl] please set collision objects by selector object, instead of object3D array."),e)}var Ca=new THREE.Vector3,Oa=function(){function e(t){r(this,e),this._controls=null,t=t||{},this.walkSpeed=void 0===t.walkSpeed?.02:t.walkSpeed,this.turnSpeed=void 0===t.turnSpeed?.25:t.turnSpeed,this.jumpSpeed=void 0===t.jumpSpeed?3:t.jumpSpeed,this.enableKeyRotate=void 0!==t.enableKeyRotate&&t.enableKeyRotate,this.useGravity=void 0===t.useGravity||t.useGravity,this.gravity=t.gravity?t.gravity:9.8,this.eyeHeight=void 0===t.eyeHeight?1.6:t.eyeHeight,this._groundObjects=void 0===t.groundObjects?void 0:Aa(t.groundObjects),this.useCollision=void 0!==t.useCollision&&t.useCollision,this._collisionObjects=void 0===t.collisionObjects?void 0:Aa(t.collisionObjects),this._downRaycaster=new THREE.Raycaster,this._downRaycaster.ray.direction.set(0,-1,0),this._forwardRaycaster=new THREE.Raycaster,this._fallSpeed=0,this._prevCameraAdjustNear=!1,this._cameraChangeStarted=!1}return e.prototype._notifyCameraEvent=function(e){var t=this.app.camera;this.app.trigger(e,{position:t.position,target:t.target})},e.prototype.onResize=function(){},e.prototype.onUpdate=function(){var e=this.app.renderCamera,t=!1;if(this.useCollision){this._forwardRaycaster.ray.origin.copy(e.position),this._forwardRaycaster.ray.origin.y-=this.eyeHeight/2;var i=this._controls.getMoveDirection();this._forwardRaycaster.ray.direction.copy(i).normalize();var r=this._forwardRaycaster.intersectObjects(this._collisionObjects,!0);0<r.length&&r[0].distance<.5&&(t=!0)}if(this._controls&&(this._controls.movementSpeed=t?0:this.walkSpeed,this._controls.rotateSpeed=this.turnSpeed,this._controls.enableKeyRotate=this.enableKeyRotate,this._controls.update()?this._cameraChangeStarted?this._notifyCameraEvent("cameraChange"):(this._cameraChangeStarted=!0,this._notifyCameraEvent("cameraChangeStart")):this._cameraChangeStarted&&(this._cameraChangeStarted=!1,this._notifyCameraEvent("cameraChangeEnd")),this.app.needUpdate=!0),this.useGravity){this._downRaycaster.ray.direction.copy(e.up).multiplyScalar(-1).normalize(),this._downRaycaster.ray.origin.copy(e.position);var n=this._downRaycaster.ray.direction,o=this._downRaycaster.intersectObjects(this._groundObjects,!0);if(o.length<1){this._fallSpeed+=.0166*this.gravity;var a=Ca.copy(n).multiplyScalar(Math.min(.0166*this._fallSpeed,this.eyeHeight-.001));e.position.add(a)}else{var s=o[0].distance;if(s<=this.eyeHeight+.01&&0<=this._fallSpeed){this._fallSpeed=0;var l=Ca.copy(n).multiplyScalar(s-this.eyeHeight);e.position.add(l)}else{this._fallSpeed+=.0166*this.gravity;var c=Ca.copy(n).multiplyScalar(Math.min(.0166*this._fallSpeed,this.eyeHeight-.001));e.position.add(c)}}}},e.prototype.onAdd=function(e){this.app=e,this._prevCameraAdjustNear=e.camera.autoAdjustNear,e.camera.autoAdjustNear=!1,e.camera.inputEnabled=!1,this._controls||(this._controls=new THREE.FreeMouseControls(e.renderCamera),this._controls.movementSpeed=this.walkSpeed,this._controls.rotateSpeed=this.turnSpeed,this._controls.enableFly=!1),this._controls.enabled=!0,this._groundObjects=this._groundObjects||e.query(".Ground || .Floor").getNodes(),this._collisionObjects=this._collisionObjects||[this.app.scene],this._jumpBind=function(e){32==e.keyCode&&this.jump()}.bind(this),window.addEventListener("keydown",this._jumpBind,!1)},e.prototype.onRemove=function(){var e=this.app;e.camera.inputEnabled=!0,this._controls&&(this._controls.dispose(),this._controls.enabled=!1,this._controls=null),this._groundObjects=null,this._collisionObjects=null,e.camera.autoAdjustNear=this._prevCameraAdjustNear,window.removeEventListener("keydown",this._jumpBind,!1)},e.prototype.jump=function(){0==this._fallSpeed&&(this._fallSpeed-=this.jumpSpeed)},n(e,[{key:"groundObjects",set:function(e){this._groundObjects=void 0!==e?Aa(e):[]}},{key:"collisionObject",set:function(e){this._collisionObjects=void 0!==e?Aa(e):[]}}]),e}(),La=function(e){function t(i){return r(this,t),a(this,e.call(this,i))}return o(t,e),t.prototype.onResize=function(){},t.prototype.onAdd=function(e){this.app=e,this._prevCameraAdjustNear=e.camera.autoAdjustNear,e.camera.autoAdjustNear=!1,e.camera.inputEnabled=!1,this._controls||(this._controls=new THREE.FreeControls(e.renderCamera),this._controls.movementSpeed=this.walkSpeed,this._controls.rotateSpeed=this.turnSpeed,this._controls.enableFly=!1,e.renderCamera.rotation.x=0),this._controls.enabled=!0,this._groundObjects=this._groundObjects||e.query(".Ground || .Floor").getNodes(),this._collisionObjects=this._collisionObjects||[this.app.scene],this._createWalkButton()},t.prototype.onRemove=function(){var e=this.app;e.camera.inputEnabled=!0,this._controls&&(this._controls.enabled=!1,this._controls=null),this._groundObjects=null,this._collisionObjects=null,e.camera.autoAdjustNear=this._prevCameraAdjustNear,this._removeWalkButton()},t.prototype._setMoveState=function(e,t){this._controls&&(this._controls.moveState[e]=t,this._controls.updateMovementVector())},t.prototype._setRotate=function(e,t){this._controls&&this._controls.rotateDelta.set(e,t)},t.prototype._createWalkButton=function(){var e=this.app,t=this;if(!(0<e.domElement.getElementsByClassName("walkbutton").length)){this._walkButtonDom=e.domElement.appendChild(document.createElement("div")),this._walkButtonDom.className="walkbutton",this._walkButtonDom.style.cssText="position: absolute;right: 0;bottom: 0;width: 0;height: 0;border-radius: 50%;box-sizing: border-box;z-index: 1000;background: #f0f0f0;";var i,r,n,o,a,s=this._walkButtonDom.appendChild(document.createElement("div"));s.style.cssText="width: 46%;height: 46%;border-radius: 50%;overflow: hidden;position: absolute;top: 27%;left: 27%;border-radius: 50%;background: #003A9E;",this._resizeWalkButton(),t._moveState="",this._walkButtonDom.addEventListener("touchstart",function(e){e.preventDefault(),i=e.changedTouches[0].pageX,r=e.changedTouches[0].pageY,n=e.changedTouches[0].pageX-s.offsetLeft,o=e.changedTouches[0].pageY-s.offsetTop,document.body.addEventListener("touchmove",l,!1)}),document.addEventListener("touchend",function(){document.body.removeEventListener("touchmove",l,!1),s.style.left="27%",s.style.top="27%",t._setMoveState(t._moveState,0),t._moveState=""})}function l(e){var l=e.changedTouches[0].pageX,c=e.changedTouches[0].pageY,u=l-n,h=c-o,p=l-i,d=c-r,f=parseFloat(t.width)/2;if(t._getDistance(p,d)<=f)s.style.left=u+"px",s.style.top=h+"px";else{var m=t._getNewPos(f,t._getRadian(p,d));s.style.left=m[0]+i-n+"px",s.style.top=m[1]+r-o+"px"}(a=Math.abs(p)>Math.abs(d)?0<p?"right":"left":0<d?"back":"forward")!==t._moveState&&(t._setMoveState(t._moveState,0),t._setMoveState(a,1),t._moveState=a)}},t.prototype._removeWalkButton=function(){var e=this.app.domElement.getElementsByClassName("walkbutton");0<e.length&&e[0].parentNode.removeChild(e[0])},t.prototype._getDistance=function(e,t){return Math.sqrt(Math.pow(e,2)+Math.pow(t,2))},t.prototype._getRadian=function(e,t){return Math.atan2(t,e)},t.prototype._getNewPos=function(e,t){var i=[];return i.push(Math.cos(t)*e),i.push(Math.sin(t)*e),i},t.prototype._getwindowOrientation=function(){return 180==window.orientation||0==window.orientation||90!=window.orientation&&-90!=window.orientation&&void 0},t.prototype._resizeWalkButton=function(){this.width=this._getwindowOrientation()?.2*this.app.domElement.offsetWidth:.2*this.app.domElement.offsetHeight,this._walkButtonDom.style.width=this.width+"px",this._walkButtonDom.style.height=this.width+"px",this._walkButtonDom.style.right=.5*this.width+"px",this._walkButtonDom.style.bottom=.3*this.width+"px"},t}(Oa),ka=function(){function e(t){r(this,e),this.parseParam(t),this._enable=!0,this.scene=new THREE.Scene,this.camera=null,this.sprite=null,this.raycaster=new THREE.Raycaster,this.mouse=new THREE.Vector2,this.ratio=2,this.mainAspect=1,this.miniDom=null,this.renderTarget=null,this.inited=!1,this.create()}return e.prototype.parseParam=function(e){this.app=e.app,this._opacity=e.opacity||.7,this._posIndex=e.position||e.posIndex||0,this.bIcon=e.bIcon||!0,this.width=e.width||150,this.height=e.height||this.width,this._scale=e.scale||1,this.closeBtnImg=e.closeBtnImg||"http://www.thingjs.com/static/images/minimap2.png",this.cameraViewImg=e.cameraViewImg||"http://www.thingjs.com/static/images/minimap1.png",this.cameraCenterImg=e.cameraCenterImg||"http://www.thingjs.com/static/images/minimap0.png",this.center={};var t=this.app.root.boundingBox.toBox(),i=(t.max.x+t.min.x)/2,r=(t.max.z+t.min.z)/2;if(e.sceneCenter?(this.center.x=e.sceneCenter[0],this.center.y=e.sceneCenter[1]):e.center?(this.center.x=e.center[0],this.center.y=e.center[1]):(this.center.x=i,this.center.y=r),this.angle=e.angle||0,this.canMoushWheel=e.mousewheel,this.ground=e.ground,this.hasClose=e.hasClose,!this.ground)for(var n=0;n<this.app.root.campuses.length;n++){var o=this.app.root.campuses[n].outdoors;if(o){this.ground=o.node.children;break}}this.bTranslate=e.bTranslate||!1},e.prototype.init2d=function(){if(this.miniDom=this.app.domElement.appendChild(document.createElement("div")),this.miniDom.className="minimap",this.miniDom.style.position="absolute",this.miniDom.style.cssText="position: absolute;width:"+this.width+";height:"+this.height+";border: 5px solid rgba(255, 255, 255, 0.8);border-radius: 3px;display: block;box-sizing: border-box;overflow:hidden",this.miniDom.style.zIndex=1e3,this.hasClose){var e=this.miniDom.appendChild(document.createElement("img"));e.className="minimap_closeBtn",e.style.position="absolute",e.style.width=this.width/5,e.style.right="1px",e.style.top="1px",e.src=this.closeBtnImg;var t=this;e.addEventListener("click",function(){close=!0,t.enable=!1})}var i=this.miniDom.appendChild(document.createElement("img"));i.className="minimap_cameraView",i.style.position="absolute",i.src=this.cameraViewImg;var r=this.miniDom.appendChild(document.createElement("img"));function n(){t.raycaster.setFromCamera(t.mouse,t.camera);var e=t.raycaster.intersectObjects(t.ground[0].children,!0);if(0<e.length){var i=e[0].point;if(t.bTranslate){var r=t.app.camera.cameraObject.forward;r=new THREE.Vector3(r[0],0,r[2]);var n,o=new THREE.Vector3(i.x,0,i.z).normalize(),a=r.dot(o),s=(new THREE.Vector3).crossVectors(r,o).y;n=0<a?s<0?90*-(s+1)-90:90+90*(1-s):90*s;var l=t.app.create({type:"Thing",position:[i.x,t.app.camera.position[1],i.z]});t.app.camera.flyTo({time:1e3,object:l,xAngle:45,yAngle:n,zAngle:0})}else t.app.camera.flyTo({time:1e3,position:[i.x,t.app.camera.position[1],i.z],target:t.app.camera.target})}}r.className="minimap_cameraCenter",r.src=this.cameraCenterImg,i.style.width="40px",i.style.height="30px",this.miniDom.onmousedown=function(e){var t=e||event;t.cancelBubble=!0,t.stopPropagation()},this.miniDom.onmousemove=function(e){var t=e||event;t.cancelBubble=!0,t.stopPropagation()},this.miniDom.onmousewheel=function(e){var t=e||event;t.cancelBubble=!0,t.stopPropagation()},this.canMoushWheel&&this.miniDom.addEventListener("mousewheel",function(e){t.scale+=0<e.wheelDelta?.1:-.1},!1),this.miniDom.addEventListener("mousedown",function(e){0===e.button&&(t.mouse.x=e.clientX/(t.miniDom.clientWidth+10)*2-1,t.mouse.y=-e.clientY/(t.miniDom.clientWidth+10)*2+1,n(),t.miniDom.onmousemove=function(e){t.mouse.x=e.clientX/(t.miniDom.clientWidth+10)*2-1,t.mouse.y=-e.clientY/(t.miniDom.clientWidth+10)*2+1,n()},t.miniDom.onmouseup=function(){t.miniDom.onmousemove=null,t.miniDom.onmouseup=null})},!1),t=this},e.prototype.init3d=function(){this.init2d();var e=this.app.root.boundingBox.toBox(),t=e.max.x>e.max.z?e.max.x:e.max.z,i=Math.abs(e.min.x)>Math.abs(e.min.z)?Math.abs(e.min.x):Math.abs(e.min.z),r=i<t?t:i;r*=1/this.scale,this.camera=new THREE.OrthographicCamera(-r,r,r,-r,-1e4,1e4),this.camera.position.set(this.center.x,100,this.center.y),this.camera.up=new THREE.Vector3(0,0,-1).applyEuler(new THREE.Euler(0,this.angle*Math.PI/180,0,"XYZ")),this.camera.lookAt(new THREE.Vector3(this.center.x,-1,this.center.y));var n=this.app.domElement;this.mainAspect=n.clientWidth/n.clientHeight,this.ratio=n.clientWidth/r;var o=r,a=8*o<256?8*o:256,s=r*this.mainAspect*8<256*this.mainAspect?8*o:256*this.mainAspect;this.renderTarget=new THREE.WebGLRenderTarget(a,s,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,generateMipmaps:!1,format:THREE.RGBAFormat});var l=new THREE.SpriteMaterial({map:this.renderTarget.texture,overdraw:!1,transparent:!0,opacity:this._opacity});this.sprite=new THREE.Sprite(l),this.setMiniRect(),this.update();var c=this;window.onresize=function(){c.mainAspect=n.clientWidth/n.clientHeight,c.ratio=n.clientWidth/r,c.setMiniRect()},this.inited=!0},e.prototype.create=function(){this.inited||(this.init3d(),this.scene.add(this.camera),this.camera.add(this.sprite))},e.prototype.setMiniRect=function(){this.miniDom.style.width=this.width+"px",this.miniDom.style.height=this.height+"px";var e=this;function t(t,i,r,n){e.miniDom.style.top=t,e.miniDom.style.left=i,e.miniDom.style.bottom=r,e.miniDom.style.right=n}var i=this.width/(.5*this.ratio),r=i*this.mainAspect;this.sprite.scale.set(i,r,1);var n,o,a=this.camera.right,s=this.camera.left;switch(this._posIndex){case 0:n=s+i/2,o=s+r/2,t("0px","0px",null,null);break;case 2:n=s+i/2,o=a-r/2,t(null,"0px","0px",null);break;case 1:n=a-i/2,o=s+r/2,t("0px",null,null,"0px");break;case 3:n=a-i/2,o=a-r/2,t(null,null,"0px","0px")}this.sprite.position.set(n,-o,0)},e.prototype.update=function(){var e=this.app.lighting,t=this.app.lighting;t.mainLight.intensity=0,t.secondaryLight.intensity=0,t.tertiaryLight.intensity=0,this.app.lighting=t;var i=this.app.scene.background;this.app.scene.background=null,this.app.renderer.setClearColor(0,0),this.app.renderer.render(this.app.scene,this.camera,this.renderTarget,!0),this.app.lighting=e,this.app.scene.background=i},e.prototype.destroy=function(){var e=this.scene.children.length;if(0!=e){if(0<e)for(var t=0;t<e;t++)this.scene.remove(this.scene.children[t]);this.camera=null,(this.sprite=null)!=this.miniDom&&(this.app.domElement.removeChild(this.miniDom),this.miniDom=null)}},e.prototype.render=function(){if(this.miniDom)if(this._enable){this.miniDom.style.display="block";var e=this;if(this.miniDom.childNodes.forEach(function(t){t.style.display=e.bIcon?"block":"none"}),null!=this.camera&&null!=this.renderTarget){var t=this.app.renderer.autoClear;this.app.renderer.autoClear=!1,this.app.renderer.render(this.scene,this.camera),this.app.renderer.autoClear=t;var i=this.app.camera.position,r=new THREE.Vector3(i[0],i[1],i[2]);if(0!=this.angle){var n=new THREE.Vector3(this.center.x,r.y,this.center.y),o=r.sub(n);o.applyEuler(new THREE.Euler(0,-this.angle*Math.PI/180,0,"XYZ")),o.add(n),r.copy(o)}var a=this.transToMinimapCoord(r).x,s=this.transToMinimapCoord(r).y;this.setImage(a,s,this.app.camera.position[1]);var l,c=this.app.camera.camera.rotation,u="YXZ"==c.order?c.y:c.z,h=(document.getElementsByClassName("minimap_cameraCenter")[0],document.getElementsByClassName("minimap_cameraView")[0]);l=0<=u?u/Math.PI*180:180*(2-Math.abs(u)/Math.PI),h.style.transform="rotate("+(-l+this.angle)+"deg)",h.style.transformOrigin="50% 100%"}}else this.miniDom.style.display="none"},e.prototype.transToMinimapCoord=function(e){var t,i,r,n,o=(i=t=this.width/2)/((this.camera.right-this.camera.left)/2);return n=e.hasOwnProperty("x")?(r=e.x-this.center.x,e.z-this.center.y):(r=e[0]-this.center.x,e[2]-this.center.y),{x:0<=r?t-o*r:t+o*Math.abs(r),y:0<=n?i-o*n:i+o*Math.abs(n)}},e.prototype.setImage=function(e,t,i){var r=1/(220/30)*(80<i?i-80:0)+15;30<r&&(r=30);var n=document.getElementsByClassName("minimap_cameraCenter")[0],o=document.getElementsByClassName("minimap_cameraView")[0],a=r;r/2<=e&&e<=this.width-r/2&&r/2<=t&&this.width,n.style.position="absolute",n.style.width=r+"px",n.style.height=a+"px",n.style.right=e-r/2+"px",n.style.bottom=t-a+"px",o.style.right=e-20+"px",o.style.bottom=t-a/2+"px"},n(e,[{key:"scale",set:function(e){this._scale=e,this.destroy(),this.inited=!1,this.create()},get:function(){return this._scale}},{key:"opacity",set:function(e){this._opacity=e,this.sprite.material.opacity=this._opacity},get:function(){return this._opacity}},{key:"posIndex",set:function(e){this._posIndex=e,this.setMiniRect()},get:function(){return this._posIndex}},{key:"enable",set:function(e){this._enable=e},get:function(){return this._enable}}]),e}(),Ha=function(){function e(t){r(this,e),this.minimap=null,this.param=t}return e.prototype.onAdd=function(e){null!=this.minimap&&this.onRemove(),this.param.app||(this.param.app=e),this.minimap=new ka(this.param)},e.prototype.onRemove=function(){this.minimap&&this.minimap.destroy()},e.prototype.onUpdate=function(){this.minimap&&this.minimap.render()},e}(),ja=function(){function e(){r(this,e),this.app=null,this.object=null,this._targetObject=null,this._target=new THREE.Vector3}return e.prototype.onAdd=function(e){this.app=e.app,this.object=e},e.prototype.onRemove=function(){this.app=null,this.object=null,this._targetObject=null},e.prototype.onUpdate=function(){return this.object.node.updateWorldMatrix(!0,!1),this.object.node.lookAt(this._target),this._targetObject&&this._target.fromArray(this._targetObject.position),!0},n(e,[{key:"target",set:function(e){e&&(e.isBaseObject?(this._targetObject=e,this._target.fromArray(e.position)):(this._targetObject=null,this._target.fromArray(e)))},get:function(){return this._targetObject||this._target.toArray()}}]),e}(),Fa=new THREE.Matrix4,Da=new THREE.Vector3(0,0,0),Ba=new THREE.Vector3(0,1,0),Ia=function(){function e(t){r(this,e),this.app=null,this.object=null,this._targetObject=null,this._target=new THREE.Vector3,t=t||{},this._alpha=t.alpha||45,this._beta=t.beta||45,this._radius=t.radius||30,this._dirty=!0}return e.prototype.onAdd=function(e){this.app=e.app,this.object=e},e.prototype.onRemove=function(){this.app=null,this.object=null,this._targetObject=null},e.prototype.onUpdate=function(){return this._dirty&&this._updateLocalTransform(),!0},e.prototype._updateLocalTransform=function(){var e=this.object.node.position;e.fromArray(j.directionFromAlphaBeta(this._alpha,this._beta)),e.normalize().multiplyScalar(this._radius);var t=this.object.node.quaternion,i=Fa.lookAt(Da,e,Ba);t.setFromRotationMatrix(i),this._dirty=!1},n(e,[{key:"alpha",set:function(e){this._alpha=e,this._dirty=!0},get:function(){return this._alpha}},{key:"beta",set:function(e){this._beta=e,this._dirty=!0},get:function(){return this._beta}},{key:"radius",set:function(e){this._radius=e,this._dirty=!0},get:function(){return this._radius}}]),e}(),Na=function(){function e(t){r(this,e),this.params=t,this.draggable=!0,t&&(this.draggable=Te.parseValue(t.draggable,!0))}return e.prototype.init=function(){var e=this,t=this.params;if(this.cameraTarget=function(e){var t,i=2,r=1218267;if(!e)return null;var n=e.size,o=e.color,a=e.url;if(null==a)return null;t=a,null!=n&&(i=n),null!=o&&(r=o);var s=app.create({type:"Marker",offset:[0,8,0],size:i,keepSize:!0,url:t,useSpriteMaterial:!1,angles:[90,0,0]});return s.style.alwaysOnTop=!0,s.style.color=r,s}(t),this.cameraTarget){o();var i=!1,r=null,n=!1;$(document).on("mousedown.ctctrl",function(e){2==e.button&&(n=!0)}),$(document).on("mouseup.ctctrl",function(t){if(2==t.button&&(n=!1),i=!1,e.app.camera.enablePan=!0,e.app.camera.enableRotate=!0,e.cameraTarget.style.color="#1296db",r){var o=new THREE.Vector3(r[0],r[1],r[2]),a=new THREE.Vector3(e.cameraTarget.position[0],e.cameraTarget.position[1],e.cameraTarget.position[2]).clone().sub(o);e.app.camera.position=[e.app.camera.position[0]+a.x,e.app.camera.position[1]+a.y,e.app.camera.position[2]+a.z],e.app.camera.target=e.cameraTarget.position,r=null}}),$(document).on("mousemove.ctctrl",function(t){i&&(e.cameraTarget.position=e.app.camera.screenToWorld(t.pageX,t.pageY))}),this.cameraTarget.on("mouseenter",function(){1==e.draggable&&(e.cameraTarget.style.color="#FE7F0B")}),this.cameraTarget.on("mouseleave",function(){1!=e.draggable||i||(e.cameraTarget.style.color="#1296db")}),this.cameraTarget.on("mousedown",function(){1==e.draggable&&(i=!0,e.app.camera.enablePan=!1,e.app.camera.enableRotate=!1,e.cameraTarget.style.color="#FE7F0B",r=e.cameraTarget.position)}),this.app.on("update",function(e){n&&o()})}function o(){var t=e.app.camera.screenToWorld(e.app.domElement.clientWidth/2,e.app.domElement.clientHeight/2);e.cameraTarget.position=t}},e.prototype.onAdd=function(e){this.app=e,this.init()},e.prototype.onRemove=function(){$(document).off(".ctctrl"),this.cameraTarget&&this.cameraTarget.destroy()},e}(),Ua=function(){function e(t){r(this,e),this._object=t.object,this._updateTime=this._timeCount=t.updateTime||200,this.app=this._object.app}return e.prototype.onUpdate=function(){var e=this;if(this._object&&(this._timeCount+=this.app.deltaTime,this._timeCount>this._updateTime)){var t=.01,i=1,r=this.app.query(".Region");if(r){var n=function(){var t=null,i=j.getAngleBetweenVectors(e._object.up,e.app.camera.direction)/45,r=parseInt(i);return 0==r||2==r?t=i-parseInt(i):1!=r&&3!=r&&4!=r||(t=1-(i-parseInt(i))),t}();if(n){i=(t=n)<.3?100:100*n+1;var o=r.length,a=this._object._ground.material;a.polygonOffsetFactor=t,a.polygonOffsetUnits=(o-this._object._level)*i}}this._timeCount=0}return!0},e.prototype.onRemove=function(){this._object=null,this.app=null},e}(),Va=function(){function e(t,i){r(this,e),this._candidates=t,this._options=i||{},this._app=null,this._objects=[],this._previousObjects=[],this._started=!1}return e.prototype.onAdd=function(e){this._app=e,this._app.focus(),this._objects=new qe(this._app,[]),this._previousObjects=this._objects,this.start()},e.prototype.onRemove=function(){this.end()},e.prototype._start=function(e){if(e){this.candidates=this._candidates;var t=this._options.start;t&&t.call(this,{candidates:this.candidates});var i=this;this._app.camera.inputEnabled=!1,this._app.picker.startAreaPicking({x:e.x,y:e.y}),this._app.on("pick",".Thing",function(e){var t=i._options.select;if(t&&t.call(i,e),!e._stopPropagation){var r=i._options.outlineColor||"#FF8000";e.object.style.outlineColor=r}},"RectangleSelectControl_pick"),this._app.on("unpick",".Thing",function(e){var t=i._options.deselect;t&&t.call(i,e),e._stopPropagation||(e.object.style.outlineColor=null)},"RectangleSelectControl_unpick"),this._app.on(H.AreaPickEnd,function(e){i._previousObjects=i._objects,i._objects=i._app.picker.objects.concat()},"RectangleSelectControl_AreaPickEnd"),this._started=!0}},e.prototype._end=function(){if(this._started){this._started=!1,this._app.picker.endAreaPicking(),this._app.off("pick",".Thing","RectangleSelectControl_pick"),this._app.off("unpick",".Thing","RectangleSelectControl_unpick"),this._app.off(H.AreaPickEnd,null,"RectangleSelectControl_AreaPickEnd"),this._app.camera.inputEnabled=!0;var e=this._options.end;e&&e.call(this,{candidates:this.candidates})}},e.prototype.start=function(){var e=this;this._app.on("mousedown",function(t){0==t.button&&e._start(t)},"RectangleSelectControl_mousedown"),this._app.on("mouseup",function(t){0==t.button&&e._end()},"RectangleSelectControl_mouseup")},e.prototype.end=function(){this._end(),this._app.off("mousedown",null,"RectangleSelectControl_mousedown"),this._app.off("mouseup",null,"RectangleSelectControl_mouseup"),this._app.off("pick",".Thing","RectangleSelectControl_pick"),this._app.off("unpick",".Thing","RectangleSelectControl_unpick")},e.prototype.clear=function(){if(this._objects.length){for(var e=0;e<this._objects.length;e++){var t=this._objects,i=this._options.deselect;i&&i.call(t,{object:t})}this._objects.clear()}},n(e,[{key:"candidates",set:function(e){this._app.picker.areaCandidates=e},get:function(){return this._app.picker.areaCandidates}},{key:"options",set:function(e){this._options=e},get:function(){return this._options}},{key:"previousObjects",get:function(){return this._previousObjects}},{key:"objects",get:function(){return this._objects}}]),e}(),za=function(){function e(){r(this,e),this.object=null,this.app=null,this._height=0,this._box=null,this._pickResults=null}return e.prototype._setupBox=function(){this._box&&(this.app.resourceManager.remove(this._box),this._box=null);var e=this.object.boundingBox.size,t=new THREE.BoxGeometry(e[0],e[1],e[2]),i=new THREE.EdgesGeometry(t);this._box=new THREE.LineSegments(i),this.object.node.add(this._box);var r=Te.parseVector3(this.object.boundingBox.center);this._box._setWorldPosition(r,!1,this.object.static);for(var n=[16711680,65280,255,0],o=0;o<4;o++){(t=new THREE.Geometry).vertices.push(new THREE.Vector3),t.vertices.push(new THREE.Vector3);var a=new THREE.LineBasicMaterial({color:n[o]}),s=new THREE.Line(t,a);s.visible=!1,this._box.add(s)}},e.prototype._useCenterMode=function(){var e=this.object.angles,t=j.abs(e[1]);return t<1e-5||!!j.isFloatEquals(t,90)||!!j.isFloatEquals(t,180)||!!j.isFloatEquals(t,270)},e.prototype._updatePickedResult=function(){for(var e=[new THREE.Raycaster,new THREE.Raycaster,new THREE.Raycaster,new THREE.Raycaster],t=[],i=this._box.geometry.attributes.position.array,r=0;r<i.length;r+=3){var n=new THREE.Vector3(i[r],i[r+1],i[r+2]);if(!(n.y<0)){for(var o=!1,a=0;a<t.length;a++)t[a].equals(n)&&(o=!0);o||t.push(n)}}var s,l,c,u;if(this.object.node.updateMatrixWorld(),this._useCenterMode()){var h=[];for(r=0;r<t.length;r++)h.push(t[r].clone());t[0].addVectors(h[0],h[1]).divideScalar(2),t[1].addVectors(h[1],h[2]).divideScalar(2),t[2].addVectors(h[2],h[3]).divideScalar(2),t[3].addVectors(h[3],h[0]).divideScalar(2)}for(r=0;r<t.length;r++){var p=(d=e[r]).ray.origin;p.set(t[r].x,this._height-this._box.position.y,t[r].z),p=this._box.localToWorld(p),(!s||p.x<s.ray.origin.x)&&(s=d),(!c||p.z<c.ray.origin.z)&&(c=d),(!l||p.x>l.ray.origin.x)&&(l=d),(!u||p.z>u.ray.origin.z)&&(u=d)}for(s.ray.direction.set(-1,0,0),c.ray.direction.set(0,0,-1),l.ray.direction.set(1,0,0),u.ray.direction.set(0,0,1),this._pickResults=[],r=0;r<e.length;r++){var d,f=(d=e[r]).intersectObject(this.app.scene,!0);for(a=0;a<f.length&&(g=f[a]).object.isChildOf(this.object.node);a++)f.splice(a--,1);this._pickResults.push({startPosition:d.ray.origin.toArray(),pickedPosition:null,pickedObject:null,distance:100,direction:d.ray.direction.toArray()});var m=this._pickResults[r];if(f.length){var g=f[0];m.pickedPosition=g.point.toArray(),m.pickedObject=this.app.objectManager.getBaseObject(g.object),m.distance=g.distance}}var v=this._pickResults;for(r=0;r<v.length;r++){var y,b,_=v[r],x=this._box.children[r];if(y=Te.parseVector3(_.startPosition),_.pickedPosition)b=Te.parseVector3(_.pickedPosition);else{var E=new THREE.Vector3,w=Te.parseVector3(_.direction);E.addVectors(Te.parseVector3(_.startPosition),w.multiplyScalar(100)),b=E}y=x.worldToLocal(y),b=x.worldToLocal(b),x.geometry.vertices[0].copy(y),x.geometry.vertices[1].copy(b),x.geometry.verticesNeedUpdate=!0,x.geometry.elementsNeedUpdate=!0,x.computeLineDistances()}return this._pickResults},e.prototype.onAdd=function(e){this.object=e,this.app=e.app,this.height=this.object.boundingBox.size[1]/2},e.prototype.onRemove=function(){this._box&&(this.app.resourceManager.remove(this._box),this._box=null)},e.prototype.onUpdate=function(e){return!1},n(e,[{key:"height",set:function(e){this._height=e},get:function(){return this._height}},{key:"visible",set:function(e){this._box||this._setupBox(),this._box.visible=e},get:function(){return!!this._box&&this._box.visible}},{key:"lineVisible",set:function(e){this._box||this._setupBox(),this._box.children.forEach(function(t){t.visible=e})},get:function(){return!!this._box&&this._box.children[0].visible}},{key:"pickResults",get:function(){return this._updatePickedResult(),this._pickResults}}]),e}(),qa=function(){function e(){r(this,e),this._object=null,this._prevCameraInfo={}}return e.prototype.onAdd=function(e){this.app=e;var t=this.app.camera;this._prevCameraInfo={enablePan:t.enablePan,autoAdjustTarget:t.autoAdjustTarget,autoFixTargetOnWheel:t.autoFixTargetOnWheel,distanceLimited:t.distanceLimited,dampingFactor:t.dampingFactor},t.enablePan=!1,t.autoAdjustTarget=!1,t.autoFixTargetOnWheel=!1,t.dampingFactor=.05},e.prototype.onRemove=function(){var e=this.app.camera;for(var t in this._prevCameraInfo)e[t]=this._prevCameraInfo[t]},e.prototype.onUpdate=function(e){},e.prototype._getObject=function(e){var t=e.target;if(t)return t;var i=e.url;if(i){var r=this,n=e.time||1e3,o=e.distance||10,a=e.direction,s=e.complete;this.app.create({type:"Thing",url:i,position:this.getNextObjectPosition(e),nodeReady:function(e){setTimeout(function(){r.lookAt({target:e.object,time:n,distance:o,direction:a,complete:s})},10)}})}return null},e.prototype.getNextObjectPosition=function(e){if(e=e||{},this._object){var t=e.distance||10,i=this.app.camera.rightDirection;return-1===e.direction&&(i=j.negVector(i)),this._object.getWorldPosition({direction:i,distance:t})}return[0,0,0]},e.prototype.lookAt=function(e){e=e||{};var t=this._getObject(e);if(t){var i=this,r=e.time||1e3,n=e.complete,o=this.app.camera,a=t.boundingBox.radius;if(this._object){var s=e.distance||10,l=(r=e.time||1e3,e.lerpType||THING.LerpType.Quartic.Out),c=o.rightDirection;-1===e.direction&&(c=j.negVector(c));var u=t.getWorldPosition({direction:c,distance:s});t.position=u,t.lerpTo({from:{position:u},to:{position:[0,0,0]},time:r,lerpType:l},"modelViewControl_lerp_fadeIn"),t.fadeIn({time:r}),this._object.lerpTo({from:{position:this._object.position},to:{position:this._object.getWorldPosition({direction:j.negVector(c),distance:s})},time:r,lerpType:l,stop:function(e){e.object.destroy()},complete:function(e){e.object.destroy(),n&&n.call(i,{object:i._object})}},"modelViewControl_lerp_fadeOut"),this._object.fadeOut({time:r/2})}else o.flyTo({target:t,xAngle:0,yAngle:0,time:r,complete:function(){n&&n.call(i,{})}});this._object=t,o.distanceLimited=[.5*a,4*a]}},n(e,[{key:"object",get:function(){return this._object}}]),e}();e.DEFAULT_EXTENSIONS=[],e.REVISION="538aa96de6723ea4fb75eaf1b87a56b054d17de6no",e.VERSION="1.2.4.16",e.COMPILETIME="Fri, 11 Oct 2019 02:40:57 GMT",e.App=da,e.BaseObject=Ye,e.SubObject=fa,e.BatchObject=Ki,e.Ground=dr,e.Facade=tt,e.Building=ri,e.Floor=ii,e.Room=Pi,e.Thing=oi,e.Box=ir,e.Circle=rr,e.Sphere=nr,e.Plane=or,e.Grid=ar,e.Cylinder=sr,e.Tetrahedron=lr,e.Frustum=cr,e.Shape=ur,e.Door=Si,e.ElevatorDoor=hr,e.Elevator=pr,e.StairDoor=Mi,e.Stair=Ri,e.VideoSurvilance=fr,e.Line=Br,e.PolygonLine=$r,e.RouteLine=Kr,e.Points=en,e.Water=En,e.WebView=Vn,e.TextRegion=Rr,e.CombinedObject=ti,e.Fence=Pr,e.CurveFence=Ar,e.Region=Cr,e.PolygonRegion=Lr,e.Marker=Un,e.Heatmap=Hr,e.Campus=Gi,e.Group=mr,e.CameraController=Wo,e.Selector=qe,e.Navigation=Oo,e.factory=Yn,e.StyleManager=oo,e.ThemeManager=Er,e.BaseStyle=wr,e.Helper=Ea,e.CompassControl=Ra,e.FlyControl=Pa,e.WalkControl=Oa,e.WalkButtonControl=La,e.MiniMapControl=Ha,e.AxisTransformControl=$o,e.LookAtControl=ja,e.AroundControl=Ia,e.CameraTargetControl=Na,e.RegionAutoOffset=Ua,e.RectangleSelectControl=Va,e.MeasurementControl=za,e.BoundingBoxControl=Ne,e.ModelViewControl=qa,e.SizeAdjustmentControl=Xe,e.Math=j,e.TextKeyEncoder=l,e.Utils=Te,e.LerpType=S,e.CornerType=M,e.SpaceType=R,e.CameraProjectionType=w,e.CameraView=T,e.DistributionsType={Box:1,Sphere:2,Disc:3},e.BlendingType={No:"no",Normal:"normal",Additive:"add",Subtractive:"subtract",Multiply:"multiply"},e.WrapType={Repeat:"repeat",ClampToEdge:"clamptoedge",MirroredRepeat:"mirroredrepeat"},e.LoopType=A,e.DragState=P,e.AreaPickType=C,e.SkyBox={BlueSky:"BlueSky",MilkyWay:"MilkyWay",Night:"Night",SunCloud:"SunCloud"},e.IndependentControlType=O,e.LevelType={Unknown:"",Campus:"Campus",Building:"Building",Floor:"Floor",Room:"Room",Thing:"Thing"},e.LayoutType={Left:"Left",Right:"Right",Top:"Top",Bottom:"Bottom",Front:"Front",Back:"Back",Center:"Center"},e.KeyType=L,e.EventTag=k,e.EventType=H,Object.defineProperty(e,"__esModule",{value:!0})});var THING=t3d;